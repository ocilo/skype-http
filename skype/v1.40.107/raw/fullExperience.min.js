/**
 * ----------------- ThirdPartyNotices -----------------------------------------
 * This file is based on or incorporates material from the projects listed below
 * (collectively, “Third Party Code”).
 * Skype is not the original author of the Third Party Code.
 * The original copyright notice and the license, under which Skype received
 * such Third Party Code, are set forth below.
 * Such licenses and notices are provided for informational purposes only.
 * Skype, not the third party, licenses the Third Party Code to you
 * under the terms set forth in the Terms of Use for the Skype Product.
 * Skype reserves all other rights not expressly granted under this agreement,
 * whether by implication, estoppel or otherwise.
 */

/** License
*The JavaScript Canvas to Blob script is released under the
*MIT license: http://www.opensource.org/licenses/MIT.
*/

/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*! elementQuery | Author: Tyson Matanich (http://matanich.com), 2013 | License: MIT */

/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
 * @version   2.3.0
 */

/*!
 * Knockout JavaScript library v3.2.0
 * (c) Steven Sanderson - http://knockoutjs.com/
 * License: MIT (http://www.opensource.org/licenses/mit-license.php)
 */

/**
 * @license
 * lodash 3.6.0 (Custom Build) <https://lodash.com/>
 * Build: `lodash compat -o ./lodash.js`
 * Copyright 2012-2015 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.8.2 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <https://lodash.com/license>
 */

/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */

/*!
 * Reqwest! A general purpose XHR connection manager
 * license MIT (c) Dustin Diaz 2013
 * https://github.com/ded/reqwest
 ** version 1.0.2
 */

/*!
 * Sizzle CSS Selector Engine v@VERSION
 * http://sizzlejs.com/
 *
 * Copyright 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: @DATE
 */

/**
 * Copyright (c) 2011-2014 Felix Gnass
 * Licensed under the MIT license
 * http://spin.js.org/
 */

//
// usertiming.js
//
// A polyfill for UserTiming (http://www.w3.org/TR/user-timing/)
//
// Copyright 2013 Nic Jansma
// http://nicj.net
//
// https://github.com/nicjansma/usertiming.js
//
// Licensed under the MIT license
//

/* ***********************************
*  * Share on Skype *
*  * THIRD PARTY CODE NOTICE *
*  ***********************************
* This file is based on or incorporates material from the projects listed below (collectively, “Third Party Code”).   Skype is not the original author of the Third Party Code.   The original copyright * notice and the license, under which Skype received such Third Party Code, are set forth below.  Such licenses and notices are provided for informational purposes only.  Skype, not the third party, * licenses the Third Party Code to you under the terms set forth in the Terms of Use for the Skype Product.  Skype reserves all other rights not expressly granted under this agreement, whether by * implication, estoppel or otherwise.
* ------------------------------------------------------------------------------------------------------------------------
* React 0.13.3
*
* Copyright (c) 2013-2015, Facebook, Inc.
*
* For informational purposes only.
*
* All rights reserved.
*
* Redistribution and use in source and binary forms, with or without modification,
* are permitted provided that the following conditions are met:
*
*  * Redistributions of source code must retain the above copyright notice, this
*    list of conditions and the following disclaimer.
*
*  * Redistributions in binary form must reproduce the above copyright notice,
*    this list of conditions and the following disclaimer in the documentation
*    and/or other materials provided with the distribution.
*
*  * Neither the name Facebook nor the names of its contributors may be used to
*    endorse or promote products derived from this software without specific
*    prior written permission.
*
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
* ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
* WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
* DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
* ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
* (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
* LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
* ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
* (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
* ------------------------------------------------------------------------------------------------------------------------
* through 2.3.8
*
* Copyright (c) 2011 Dominic Tarr
*
* Provided for Informational Purposes Only
* MIT License
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE..
* ------------------------------------------------------------------------------------------------------------------------
* base62 0.1.1
*
* Copyright (c) 2012 Andrew Nesbitt
* Provided for Informational Purposes Only
* MIT License
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* ------------------------------------------------------------------------------------------------------------------------
*
* amdefine 1.0.0
*
* Copyright (c) 2011-2015 The Dojo Foundation
* Provided for Informational Purposes Only
* MIT License
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* ------------------------------------------------------------------------------------------------------------------------
*
* source-map 0.1.31
* Copyright (c) 2009-2011, Mozilla Foundation and contributors
* All rights reserved.
* Provided for Informational Purposes Only
* BSD License
*
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions are met:
*
* * Redistributions of source code must retain the above copyright notice, this
*   list of conditions and the following disclaimer.
*
* * Redistributions in binary form must reproduce the above copyright notice,
*   this list of conditions and the following disclaimer in the documentation
*   and/or other materials provided with the distribution.
*
* * Neither the names of the Mozilla Foundation nor the names of project
*   contributors may be used to endorse or promote products derived from this
*   software without specific prior written permission.
*
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
* ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
* WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
* DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
* FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
* SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
* CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
* OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
* OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
* ------------------------------------------------------------------------------------------------------------------------
* esprima-fb 13001.1001.0-dev-harmony-fb
*
* Copyright (c) Facebook
* Provided for Informational Purposes Only
* BSD License
*
* All rights reserved.
*
* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
*
* Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
*
* Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
*
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS ""AS IS"" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*
* ------------------------------------------------------------------------------------------------------------------------
*
* jstransform 10.1.0
*
* Copyright (c) 2013-present, Facebook, Inc.
*
* Provided for Informational Purposes Only
* BSD License
*
* All rights reserved.
*
* Redistribution and use in source and binary forms, with or without modification,
* are permitted provided that the following conditions are met:
*  * Redistributions of source code must retain the above copyright notice, this
*    list of conditions and the following disclaimer.
*  * Redistributions in binary form must reproduce the above copyright notice,
*    this list of conditions and the following disclaimer in the documentation
*    and/or other materials provided with the distribution.
*  * Neither the name Facebook nor the names of its contributors may be used to
*    endorse or promote products derived from this software without specific
*    prior written permission.
*
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS ""AS IS"" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
* ------------------------------------------------------------------------------------------------------------------------
*
* envify 3.4.0
*
* Copyright (c) Hugh Kennedy and Andres Suarez
*
* Provided for Informational Purposes Only
* MIT License
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

/**
 * ----------------- End of ThirdPartyNotices ----------------------------------
 */
(function(){var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("amd",function(){}),define("utils/common/stringPolyfills",["require","exports","module"],function(e,t){t.localeCompare=function(e){var t=this;return t<e?-1:t>e?1:0}}),function(){function e(e){return typeof e=="function"||typeof e=="object"&&e!==null}function t(e){return typeof e=="function"}function n(e){return typeof e=="object"&&e!==null}function l(e){a=e}function c(e){f=e}function g(){var e=process.nextTick,t=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(t)&&t[1]==="0"&&t[2]==="10"&&(e=setImmediate),function(){e(x)}}function y(){return function(){u(x)}}function b(){var e=0,t=new d(x),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function w(){var e=new MessageChannel;return e.port1.onmessage=x,function(){e.port2.postMessage(0)}}function E(){return function(){setTimeout(x,1)}}function x(){for(var e=0;e<s;e+=2){var t=S[e],n=S[e+1];t(n),S[e]=undefined,S[e+1]=undefined}s=0}function T(){try{var e=require,t=e("vertx");return u=t.runOnLoop||t.runOnContext,y()}catch(n){return E()}}function C(){}function M(){return new TypeError("You cannot resolve a promise with itself")}function _(){return new TypeError("A promises callback cannot return that same promise.")}function D(e){try{return e.then}catch(t){return O.error=t,O}}function P(e,t,n,r){try{e.call(t,n,r)}catch(i){return i}}function H(e,t,n){f(function(e){var r=!1,i=P(n,t,function(n){if(r)return;r=!0,t!==n?F(e,n):q(e,n)},function(t){if(r)return;r=!0,R(e,t)},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,R(e,i))},e)}function B(e,t){t._state===L?q(e,t._result):t._state===A?R(e,t._result):U(t,undefined,function(t){F(e,t)},function(t){R(e,t)})}function j(e,n){if(n.constructor===e.constructor)B(e,n);else{var r=D(n);r===O?R(e,O.error):r===undefined?q(e,n):t(r)?H(e,n,r):q(e,n)}}function F(t,n){t===n?R(t,M()):e(n)?j(t,n):q(t,n)}function I(e){e._onerror&&e._onerror(e._result),z(e)}function q(e,t){if(e._state!==k)return;e._result=t,e._state=L,e._subscribers.length!==0&&f(z,e)}function R(e,t){if(e._state!==k)return;e._state=A,e._result=t,f(I,e)}function U(e,t,n,r){var i=e._subscribers,s=i.length;e._onerror=null,i[s]=t,i[s+L]=n,i[s+A]=r,s===0&&e._state&&f(z,e)}function z(e){var t=e._subscribers,n=e._state;if(t.length===0)return;var r,i,s=e._result;for(var o=0;o<t.length;o+=3)r=t[o],i=t[o+n],r?$(n,r,i,s):i(s);e._subscribers.length=0}function W(){this.error=null}function V(e,t){try{return e(t)}catch(n){return X.error=n,X}}function $(e,n,r,i){var s=t(r),o,u,a,f;if(s){o=V(r,i),o===X?(f=!0,u=o.error,o=null):a=!0;if(n===o){R(n,_());return}}else o=i,a=!0;n._state===k&&(s&&a?F(n,o):f?R(n,u):e===L?q(n,o):e===A&&R(n,o))}function J(e,t){try{t(function(n){F(e,n)},function(n){R(e,n)})}catch(n){R(e,n)}}function K(e,t){var n=this;n._instanceConstructor=e,n.promise=new e(C),n._validateInput(t)?(n._input=t,n.length=t.length,n._remaining=t.length,n._init(),n.length===0?q(n.promise,n._result):(n.length=n.length||0,n._enumerate(),n._remaining===0&&q(n.promise,n._result))):R(n.promise,n._validationError())}function G(e){return(new Q(this,e)).promise}function Z(e){function s(e){F(n,e)}function o(e){R(n,e)}var t=this,n=new t(C);if(!i(e))return R(n,new TypeError("You must pass an array to race.")),n;var r=e.length;for(var u=0;n._state===k&&u<r;u++)U(t.resolve(e[u]),undefined,s,o);return n}function tt(e){var t=this;if(e&&typeof e=="object"&&e.constructor===t)return e;var n=new t(C);return F(n,e),n}function rt(e){var t=this,n=new t(C);return R(n,e),n}function ot(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function ut(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function ft(e){this._id=st++,this._state=undefined,this._result=undefined,this._subscribers=[],C!==e&&(t(e)||ot(),this instanceof ft||ut(),J(this,e))}function lt(){var e;if(typeof global!="undefined")e=global;else if(typeof self!="undefined")e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;if(n&&Object.prototype.toString.call(n.resolve())==="[object Promise]"&&!n.cast)return;e.Promise=at}var r;Array.isArray?r=Array.isArray:r=function(e){return Object.prototype.toString.call(e)==="[object Array]"};var i=r,s=0,o={}.toString,u,a,f=function(t,n){S[s]=t,S[s+1]=n,s+=2,s===2&&(a?a(x):N())},h=typeof window!="undefined"?window:undefined,p=h||{},d=p.MutationObserver||p.WebKitMutationObserver,v=typeof process!="undefined"&&{}.toString.call(process)==="[object process]",m=typeof Uint8ClampedArray!="undefined"&&typeof importScripts!="undefined"&&typeof MessageChannel!="undefined",S=new Array(1e3),N;v?N=g():d?N=b():m?N=w():h===undefined&&typeof require=="function"?N=T():N=E();var k=void 0,L=1,A=2,O=new W,X=new W;K.prototype._validateInput=function(e){return i(e)},K.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},K.prototype._init=function(){this._result=new Array(this.length)};var Q=K;K.prototype._enumerate=function(){var e=this,t=e.length,n=e.promise,r=e._input;for(var i=0;n._state===k&&i<t;i++)e._eachEntry(r[i],i)},K.prototype._eachEntry=function(e,t){var r=this,i=r._instanceConstructor;n(e)?e.constructor===i&&e._state!==k?(e._onerror=null,r._settledAt(e._state,t,e._result)):r._willSettleAt(i.resolve(e),t):(r._remaining--,r._result[t]=e)},K.prototype._settledAt=function(e,t,n){var r=this,i=r.promise;i._state===k&&(r._remaining--,e===A?R(i,n):r._result[t]=n),r._remaining===0&&q(i,r._result)},K.prototype._willSettleAt=function(e,t){var n=this;U(e,undefined,function(e){n._settledAt(L,t,e)},function(e){n._settledAt(A,t,e)})};var Y=G,et=Z,nt=tt,it=rt,st=0,at=ft;ft.all=Y,ft.race=et,ft.resolve=nt,ft.reject=it,ft._setScheduler=l,ft._setAsap=c,ft._asap=f,ft.prototype={constructor:ft,then:function(e,t){var n=this,r=n._state;if(r===L&&!e||r===A&&!t)return this;var i=new this.constructor(C),s=n._result;if(r){var o=arguments[r-1];f(function(){$(r,i,o,s)})}else U(n,i,e,t);return i},"catch":function(e){return this.then(null,e)}};var ct=lt,ht={Promise:at,polyfill:ct};typeof define=="function"&&define.amd?define("es6-promise/dist/es6-promise",[],function(){return ht}):typeof module!="undefined"&&module.exports?module.exports=ht:typeof this!="undefined"&&(this.ES6Promise=ht),ct()}.call(this),define("es6-promise",["es6-promise/dist/es6-promise"],function(e){return e}),function(e){var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,n=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),r=n&&e.Uint8Array&&function(){try{return(new Blob([new Uint8Array(100)])).size===100}catch(e){return!1}}(),i=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,s=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,o=(n||i)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,o,u,a,f,l,c,h,p;t=e.match(s);if(!t)throw new Error("invalid data URI");o=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),u=!!t[4],a=e.slice(t[0].length),u?f=atob(a):f=decodeURIComponent(a),l=new ArrayBuffer(f.length),c=new Uint8Array(l);for(h=0;h<f.length;h+=1)c[h]=f.charCodeAt(h);return n?new Blob([r?c:l],{type:o}):(p=new i,p.append(l),p.getBlob(o))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,n,r){r&&t.toDataURL&&o?e(o(this.toDataURL(n,r))):e(this.mozGetAsFile("blob",n))}:t.toDataURL&&o&&(t.toBlob=function(e,t,n){e(o(this.toDataURL(t,n)))})),typeof define=="function"&&define.amd?define("blueimp-canvas-to-blob/js/canvas-to-blob",[],function(){return o}):typeof module=="object"&&module.exports?module.exports=o:e.dataURLtoBlob=o}(window),define("blueimp-canvas-to-blob",["blueimp-canvas-to-blob/js/canvas-to-blob"],function(e){return e}),define("helpers/polyfills",["require","utils/common/stringPolyfills","es6-promise","blueimp-canvas-to-blob"],function(e){var t=e("utils/common/stringPolyfills");e("es6-promise").polyfill(),e("blueimp-canvas-to-blob"),Function.prototype.name===undefined&&Object.defineProperty(Function.prototype,"name",{get:function(){try{return this.toString().match(/\s*function\s+([_\$\w\d]*)\.*/)[1]}catch(e){return""}}}),String.prototype.localeCompare===undefined&&(String.prototype.localeCompare=t.localeCompare)}),function(){function At(e,t){if(e!==t){var n=e===e,r=t===t;if(e>t||!n||typeof e=="undefined"&&r)return 1;if(e<t||!r||typeof t=="undefined"&&n)return-1}return 0}function Ot(e,t,n){var r=e.length,i=n?r:-1;while(n?i--:++i<r)if(t(e[i],i,e))return i;return-1}function Mt(e,t,n){if(t!==t)return Ut(e,n);var r=n-1,i=e.length;while(++r<i)if(e[r]===t)return r;return-1}function _t(e){return typeof e=="function"||!1}function Dt(e){return typeof e=="string"?e:e==null?"":e+""}function Pt(e){return e.charCodeAt(0)}function Ht(e,t){var n=-1,r=e.length;while(++n<r&&t.indexOf(e.charAt(n))>-1);return n}function Bt(e,t){var n=e.length;while(n--&&t.indexOf(e.charAt(n))>-1);return n}function jt(e,t){return At(e.criteria,t.criteria)||e.index-t.index}function Ft(e,t,n){var r=-1,i=e.criteria,s=t.criteria,o=i.length,u=n.length;while(++r<o){var a=At(i[r],s[r]);if(a)return r>=u?a:a*(n[r]?1:-1)}return e.index-t.index}function It(e){return gt[e]}function qt(e){return yt[e]}function Rt(e){return"\\"+Et[e]}function Ut(e,t,n){var r=e.length,i=t+(n?0:-1);while(n?i--:++i<r){var s=e[i];if(s!==s)return i}return-1}function Wt(e){return!!e&&typeof e=="object"}function Xt(e){return e<=160&&e>=9&&e<=13||e==32||e==160||e==5760||e==6158||e>=8192&&(e<=8202||e==8232||e==8233||e==8239||e==8287||e==12288||e==65279)}function Vt(e,t){var n=-1,r=e.length,i=-1,s=[];while(++n<r)e[n]===t&&(e[n]=b,s[++i]=n);return s}function $t(e,t){var n,r=-1,i=e.length,s=-1,o=[];while(++r<i){var u=e[r],a=t?t(u,r,e):u;if(!r||n!==a)n=a,o[++s]=u}return o}function Jt(e){var t=-1,n=e.length;while(++t<n&&Xt(e.charCodeAt(t)));return t}function Kt(e){var t=e.length;while(t--&&Xt(e.charCodeAt(t)));return t}function Qt(e){return bt[e]}function Gt(C){function zn(e){if(Wt(e)&&!ru(e)&&!(e instanceof $n)){if(e instanceof Xn)return e;if(nn.call(e,"__chain__")&&nn.call(e,"__wrapped__"))return ls(e)}return new Xn(e)}function Wn(){}function Xn(e,t,n){this.__wrapped__=e,this.__actions__=n||[],this.__chain__=!!t}function $n(e){this.__wrapped__=e,this.__actions__=null,this.__dir__=1,this.__dropCount__=0,this.__filtered__=!1,this.__iteratees__=null,this.__takeCount__=Dn,this.__views__=null}function Jn(){var e=this.__actions__,t=this.__iteratees__,n=this.__views__,r=new $n(this.__wrapped__);return r.__actions__=e?sr(e):null,r.__dir__=this.__dir__,r.__filtered__=this.__filtered__,r.__iteratees__=t?sr(t):null,r.__takeCount__=this.__takeCount__,r.__views__=n?sr(n):null,r}function Kn(){if(this.__filtered__){var e=new $n(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Qn(){var e=this.__wrapped__.value();if(!ru(e))return oi(e,this.__actions__);var t=this.__dir__,n=t<0,r=Vi(0,e.length,this.__views__),i=r.start,s=r.end,o=s-i,u=n?s:i-1,a=kn(o,this.__takeCount__),f=this.__iteratees__,l=f?f.length:0,c=0,h=[];e:while(o--&&c<a){u+=t;var p=-1,d=e[u];while(++p<l){var y=f[p],b=y.iteratee,w=y.type;if(w==v){y.done&&(n?u>y.index:u<y.index)&&(y.count=0,y.done=!1),y.index=u;if(!y.done){var E=y.limit;if(!(y.done=E>-1?y.count++>=E:!b(d)))continue e}}else{var S=b(d);if(w==g)d=S;else if(!S){if(w==m)continue e;break e}}}h[c++]=d}return h}function Gn(){this.__data__={}}function Yn(e){return this.has(e)&&delete this.__data__[e]}function Zn(t){return t=="__proto__"?e:this.__data__[t]}function er(e){return e!="__proto__"&&nn.call(this.__data__,e)}function tr(e,t){return e!="__proto__"&&(this.__data__[e]=t),this}function nr(e){var t=e?e.length:0;this.data={hash:xn(null),set:new mn};while(t--)this.push(e[t])}function rr(e,t){var n=e.data,r=typeof t=="string"||hu(t)?n.set.has(t):n.hash[t];return r?0:-1}function ir(e){var t=this.data;typeof e=="string"||hu(e)?t.set.add(e):t.hash[e]=!0}function sr(e,t){var n=-1,r=e.length;t||(t=O(r));while(++n<r)t[n]=e[n];return t}function or(e,t){var n=-1,r=e.length;while(++n<r)if(t(e[n],n,e)===!1)break;return e}function ur(e,t){var n=e.length;while(n--)if(t(e[n],n,e)===!1)break;return e}function ar(e,t){var n=-1,r=e.length;while(++n<r)if(!t(e[n],n,e))return!1;return!0}function fr(e,t){var n=-1,r=e.length,i=-1,s=[];while(++n<r){var o=e[n];t(o,n,e)&&(s[++i]=o)}return s}function lr(e,t){var n=-1,r=e.length,i=O(r);while(++n<r)i[n]=t(e[n],n,e);return i}function cr(e){var t=-1,n=e.length,r=_n;while(++t<n){var i=e[t];i>r&&(r=i)}return r}function hr(e){var t=-1,n=e.length,r=Dn;while(++t<n){var i=e[t];i<r&&(r=i)}return r}function pr(e,t,n,r){var i=-1,s=e.length;r&&s&&(n=e[++i]);while(++i<s)n=t(n,e[i],i,e);return n}function dr(e,t,n,r){var i=e.length;r&&i&&(n=e[--i]);while(i--)n=t(n,e[i],i,e);return n}function vr(e,t){var n=-1,r=e.length;while(++n<r)if(t(e[n],n,e))return!0;return!1}function mr(e){var t=e.length,n=0;while(t--)n+=+e[t]||0;return n}function gr(e,t){return typeof e=="undefined"?t:e}function yr(e,t,n,r){return typeof e=="undefined"||!nn.call(r,n)?t:e}function br(e,t,n){var r=ju(t);if(!n)return Er(t,e,r);var i=-1,s=r.length;while(++i<s){var o=r[i],u=e[o],a=n(u,t[o],o,e,t);if((a===a?a!==u:u===u)||typeof u=="undefined"&&!(o in e))e[o]=a}return e}function wr(t,n){var r=-1,i=t.length,s=Zi(i),o=n.length,u=O(o);while(++r<o){var a=n[r];s?(a=parseFloat(a),u[r]=Qi(a,i)?t[a]:e):u[r]=t[a]}return u}function Er(e,t,n){n||(n=t,t={});var r=-1,i=n.length;while(++r<i){var s=n[r];t[s]=e[s]}return t}function Sr(e,t,n){var r=typeof e;return r=="function"?typeof t=="undefined"?e:fi(e,t,n):e==null?Ea:r=="object"?Wr(e):typeof t=="undefined"?Jr(e+""):Xr(e+"",t)}function xr(e,t,n,r,i,s,o){var u;n&&(u=i?n(e,r,i):n(e));if(typeof u!="undefined")return u;if(!hu(e))return e;var a=ru(e);if(a){u=$i(e);if(!t)return sr(e,u)}else{var f=sn.call(e),l=f==N;if(!(f==L||f==w||l&&!i))return vt[f]?Ki(e,f,t):i?e:{};if(zt(e))return i?e:{};u=Ji(l?{}:e);if(!t)return Er(e,u,ju(e))}s||(s=[]),o||(o=[]);var c=s.length;while(c--)if(s[c]==e)return o[c];return s.push(e),o.push(u),(a?or:jr)(e,function(r,i){u[i]=xr(r,t,n,i,e,s,o)}),u}function Nr(t,n,r){if(typeof t!="function")throw new Tt(y);return gn(function(){t.apply(e,r)},n)}function Cr(e,t){var n=e?e.length:0,r=[];if(!n)return r;var i=-1,s=Xi(),o=s==Mt,u=o&&t.length>=200?yi(t):null,a=t.length;u&&(s=rr,o=!1,t=u);e:while(++i<n){var f=e[i];if(o&&f===f){var l=a;while(l--)if(t[l]===f)continue e;r.push(f)}else s(t,f,0)<0&&r.push(f)}return r}function Ar(e,t){var n=!0;return kr(e,function(e,r,i){return n=!!t(e,r,i),n}),n}function Or(e,t,n,r){var i=e.length;n=n==null?0:+n||0,n<0&&(n=-n>i?0:i+n),r=typeof r=="undefined"||r>i?i:+r||0,r<0&&(r+=i),i=n>r?0:r>>>0,n>>>=0;while(n<i)e[n++]=t;return e}function Mr(e,t){var n=[];return kr(e,function(e,r,i){t(e,r,i)&&n.push(e)}),n}function _r(e,t,n,r){var i;return n(e,function(e,n,s){if(t(e,n,s))return i=r?n:e,!1}),i}function Dr(e,t,n){var r=-1,i=e.length,s=-1,o=[];while(++r<i){var u=e[r];if(Wt(u)&&Zi(u.length)&&(ru(u)||nu(u))){t&&(u=Dr(u,t,n));var a=-1,f=u.length;o.length+=f;while(++a<f)o[++s]=u[a]}else n||(o[++s]=u)}return o}function Br(e,t){return Pr(e,t,Fu)}function jr(e,t){return Pr(e,t,ju)}function Fr(e,t){return Hr(e,t,ju)}function Ir(e,t){var n=-1,r=t.length,i=-1,s=[];while(++n<r){var o=t[n];cu(e[o])&&(s[++i]=o)}return s}function qr(e,t,n,r,i,s){if(e===t)return e!==0||1/e==1/t;var o=typeof e,u=typeof t;return o!="function"&&o!="object"&&u!="function"&&u!="object"||e==null||t==null?e!==e&&t!==t:Rr(e,t,qr,n,r,i,s)}function Rr(e,t,n,r,i,s,o){var u=ru(e),a=ru(t),f=E,l=E;u||(f=sn.call(e),f==w?f=L:f!=L&&(u=Eu(e))),a||(l=sn.call(t),l==w?l=L:l!=L&&(a=Eu(t)));var c=(f==L||i&&f==N)&&!zt(e),h=(l==L||i&&l==N)&&!zt(t),p=f==l;if(p&&!u&&!c)return Ii(e,t,f);if(i){if(!p&&(!c||!h))return!1}else{var d=c&&nn.call(e,"__wrapped__"),v=h&&nn.call(t,"__wrapped__");if(d||v)return n(d?e.value():e,v?t.value():t,r,i,s,o);if(!p)return!1}s||(s=[]),o||(o=[]);var m=s.length;while(m--)if(s[m]==e)return o[m]==t;s.push(e),o.push(t);var g=(u?Fi:qi)(e,t,n,r,i,s,o);return s.pop(),o.pop(),g}function Ur(t,n,r,i,s){var o=-1,u=n.length,a=!s;while(++o<u)if(a&&i[o]?r[o]!==t[n[o]]:!(n[o]in t))return!1;o=-1;while(++o<u){var f=n[o],l=t[f],c=r[o];if(a&&i[o])var h=typeof l!="undefined"||f in t;else h=s?s(l,c,f):e,typeof h=="undefined"&&(h=qr(c,l,s,!0));if(!h)return!1}return!0}function zr(e,t){var n=[];return kr(e,function(e,r,i){n.push(t(e,r,i))}),n}function Wr(e){var t=ju(e),n=t.length;if(!n)return wa(!0);if(n==1){var r=t[0],i=e[r];if(es(i))return function(e){return e!=null&&e[r]===i&&(typeof i!="undefined"||r in fs(e))}}var s=O(n),o=O(n);while(n--)i=e[t[n]],s[n]=i,o[n]=es(i);return function(e){return e!=null&&Ur(fs(e),t,s,o)}}function Xr(e,t){return es(t)?function(n){return n!=null&&n[e]===t&&(typeof t!="undefined"||e in fs(n))}:function(n){return n!=null&&qr(t,n[e],null,!0)}}function Vr(t,n,r,i,s){if(!hu(t))return t;var o=Zi(n.length)&&(ru(n)||Eu(n));return(o?or:jr)(n,function(n,u,a){if(Wt(n))return i||(i=[]),s||(s=[]),$r(t,a,u,Vr,r,i,s);var f=t[u],l=r?r(f,n,u,t,a):e,c=typeof l=="undefined";c&&(l=n),(o||typeof l!="undefined")&&(c||(l===l?l!==f:f===f))&&(t[u]=l)}),t}function $r(t,n,r,i,s,o,u){var a=o.length,f=n[r];while(a--)if(o[a]==f){t[r]=u[a];return}var l=t[r],c=s?s(l,f,r,t,n):e,h=typeof c=="undefined";h&&(c=f,Zi(f.length)&&(ru(f)||Eu(f))?c=ru(l)?l:l&&l.length?sr(l):[]:yu(f)||nu(f)?c=nu(l)?Tu(l):yu(l)?l:{}:h=!1),o.push(f),u.push(c);if(h)t[r]=i(c,f,s,o,u);else if(c===c?c!==l:l===l)t[r]=c}function Jr(t){return function(n){return n==null?e:n[t]}}function Kr(e,t){return e+hn(Mn()*(t-e+1))}function Qr(e,t,n,r,i){return i(e,function(e,i,s){n=r?(r=!1,e):t(n,e,i,s)}),n}function Yr(e,t,n){var r=-1,i=e.length;t=t==null?0:+t||0,t<0&&(t=-t>i?0:i+t),n=typeof n=="undefined"||n>i?i:+n||0,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;var s=O(i);while(++r<i)s[r]=e[r+t];return s}function Zr(e,t){var n;return kr(e,function(e,r,i){return n=t(e,r,i),!n}),!!n}function ei(e,t){var n=e.length;e.sort(t);while(n--)e[n]=e[n].value;return e}function ti(t,n,r){var i=-1,s=t.length,o=Zi(s)?O(s):[];return kr(t,function(t){var r=n.length,s=O(r);while(r--)s[r]=t==null?e:t[n[r]];o[++i]={criteria:s,index:i,value:t}}),ei(o,function(e,t){return Ft(e,t,r)})}function ni(e,t){var n=0;return kr(e,function(e,r,i){n+=+t(e,r,i)||0}),n}function ri(e,t){var n=-1,r=Xi(),i=e.length,s=r==Mt,o=s&&i>=200,u=o?yi():null,a=[];u?(r=rr,s=!1):(o=!1,u=t?[]:a);e:while(++n<i){var f=e[n],l=t?t(f,n,e):f;if(s&&f===f){var c=u.length;while(c--)if(u[c]===l)continue e;t&&u.push(l),a.push(f)}else r(u,l,0)<0&&((t||o)&&u.push(l),a.push(f))}return a}function ii(e,t){var n=-1,r=t.length,i=O(r);while(++n<r)i[n]=e[t[n]];return i}function si(e,t,n,r){var i=e.length,s=r?i:-1;while((r?s--:++s<i)&&t(e[s],s,e));return n?Yr(e,r?0:s,r?s+1:i):Yr(e,r?s+1:0,r?i:s)}function oi(e,t){var n=e;n instanceof $n&&(n=n.value());var r=-1,i=t.length;while(++r<i){var s=[n],o=t[r];dn.apply(s,o.args),n=o.func.apply(o.thisArg,s)}return n}function ui(e,t,n){var r=0,i=e?e.length:r;if(typeof t=="number"&&t===t&&i<=Bn){while(r<i){var s=r+i>>>1,o=e[s];(n?o<=t:o<t)?r=s+1:i=s}return i}return ai(e,t,Ea,n)}function ai(e,t,n,r){t=n(t);var i=0,s=e?e.length:0,o=t!==t,u=typeof t=="undefined";while(i<s){var a=hn((i+s)/2),f=n(e[a]),l=f===f;if(o)var c=l||r;else u?c=l&&(r||typeof f!="undefined"):c=r?f<=t:f<t;c?i=a+1:s=a}return kn(s,Hn)}function fi(e,t,n){if(typeof e!="function")return Ea;if(typeof t=="undefined")return e;switch(n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)};case 5:return function(n,r,i,s,o){return e.call(t,n,r,i,s,o)}}return function(){return e.apply(t,arguments)}}function li(e){return fn.call(e,0)}function ci(e,t,n){var r=n.length,i=-1,s=Cn(e.length-r,0),o=-1,u=t.length,a=O(s+u);while(++o<u)a[o]=t[o];while(++i<r)a[n[i]]=e[i];while(s--)a[o++]=e[i++];return a}function hi(e,t,n){var r=-1,i=n.length,s=-1,o=Cn(e.length-i,0),u=-1,a=t.length,f=O(o+a);while(++s<o)f[s]=e[s];var l=s;while(++u<a)f[l+u]=t[u];while(++r<i)f[l+n[r]]=e[s++];return f}function pi(e,t){return function(n,r,i){var s=t?t():{};r=Ui(r,i,3);if(ru(n)){var o=-1,u=n.length;while(++o<u){var a=n[o];e(s,a,r(a,o,n),n)}}else kr(n,function(t,n,i){e(s,t,r(t,n,i),i)});return s}}function di(e){return function(){var t=arguments,n=t.length,r=t[0];if(n<2||r==null)return r;var i=t[n-2],s=t[n-1],o=t[3];n>3&&typeof i=="function"?(i=fi(i,s,5),n-=2):(i=n>2&&typeof s=="function"?s:null,n-=i?1:0),o&&Gi(t[1],t[2],o)&&(i=n==3?null:i,n=2);var u=0;while(++u<n){var a=t[u];a&&e(r,a,i)}return r}}function vi(e,t){return function(n,r){var i=n?n.length:0;if(!Zi(i))return e(n,r);var s=t?i:-1,o=fs(n);while(t?s--:++s<i)if(r(o[s],s,o)===!1)break;return n}}function mi(e){return function(t,n,r){var i=fs(t),s=r(t),o=s.length,u=e?o:-1;while(e?u--:++u<o){var a=s[u];if(n(i[a],a,i)===!1)break}return t}}function gi(e,t){function r(){var i=this&&this!==Lt&&this instanceof r?n:e;return i.apply(t,arguments)}var n=wi(e);return r}function bi(e){return function(t){var n=-1,r=ga(Yu(t)),i=r.length,s="";while(++n<i)s=e(s,r[n],n);return s}}function wi(e){return function(){var t=Tr(e.prototype),n=e.apply(t,arguments);return hu(n)?n:t}}function Ei(e){function t(n,r,i){i&&Gi(n,r,i)&&(r=null);var s=ji(n,e,null,null,null,null,null,r);return s.placeholder=t.placeholder,s}return t}function Si(e,t){return function(n,r,i){i&&Gi(n,r,i)&&(r=null);var s=Ui(),o=r==null;if(s!==Sr||!o)o=!1,r=s(r,i,3);if(o){var u=ru(n);if(!!u||!wu(n))return e(u?n:as(n));r=Pt}return Ri(n,r,t)}}function xi(t,n){return function(r,i,s){i=Ui(i,s,3);if(ru(r)){var o=Ot(r,i,n);return o>-1?r[o]:e}return _r(r,i,t)}}function Ti(e){return function(t,n,r){return!t||!t.length?-1:(n=Ui(n,r,3),Ot(t,n,e))}}function Ni(e){return function(t,n,r){return n=Ui(n,r,3),_r(t,n,e,!0)}}function Ci(e){return function(){var t=arguments.length;if(!t)return function(){return arguments[0]};var n,r=e?t:-1,i=0,s=O(t);while(e?r--:++r<t){var o=s[i++]=arguments[r];if(typeof o!="function")throw new Tt(y);var u=n?"":Wi(o);n=u=="wrapper"?new Xn([]):n}r=n?-1:t;while(++r<t){o=s[r],u=Wi(o);var a=u=="wrapper"?zi(o):null;a&&Yi(a[0])?n=n[Wi(a[0])].apply(n,a[3]):n=o.length==1&&Yi(o)?n[u]():n.thru(o)}return function(){var e=arguments;if(n&&e.length==1&&ru(e[0]))return n.plant(e[0]).value();var r=0,i=s[r].apply(this,e);while(++r<t)i=s[r].call(this,i);return i}}}function ki(e,t){return function(n,r,i){return typeof r=="function"&&typeof i=="undefined"&&ru(n)?e(n,r):t(n,fi(r,i,3))}}function Li(e){return function(t,n,r){if(typeof n!="function"||typeof r!="undefined")n=fi(n,r,3);return e(t,n,Fu)}}function Ai(e){return function(t,n,r){if(typeof n!="function"||typeof r!="undefined")n=fi(n,r,3);return e(t,n)}}function Oi(e){return function(t,n,r){return t=Dt(t),t&&(e?t:"")+Pi(t,n,r)+(e?"":t)}}function Mi(e){var t=Qo(function(n,r){var i=Vt(r,t.placeholder);return ji(n,e,null,r,i)});return t}function _i(e,t){return function(n,r,i,s){var o=arguments.length<3;return typeof r=="function"&&typeof s=="undefined"&&ru(n)?e(n,r,i,o):Qr(n,Ui(r,s,4),i,o,t)}}function Di(t,l,c,h,p,d,v,m,g,y){function k(){var i=arguments.length,s=i,o=O(i);while(s--)o[s]=arguments[s];h&&(o=ci(o,h,p)),d&&(o=hi(o,d,v));if(S||T){var f=k.placeholder,L=Vt(o,f);i-=L.length;if(i<y){var A=m?sr(m):null,M=Cn(y-i,0),_=S?L:null,D=S?null:L,P=S?o:null,H=S?null:o;l|=S?u:a,l&=~(S?a:u),x||(l&=~(n|r));var B=[t,l,c,P,_,H,D,A,g,M],j=Di.apply(e,B);return Yi(t)&&ss(j,B),j.placeholder=f,j}}var F=w?c:this;E&&(t=F[C]),m&&(o=is(o,m)),b&&g<o.length&&(o.length=g);var I=this&&this!==Lt&&this instanceof k?N||wi(t):t;return I.apply(F,o)}var b=l&f,w=l&n,E=l&r,S=l&s,x=l&i,T=l&o,N=!E&&wi(t),C=t;return k}function Pi(e,t,n){var r=e.length;t=+t;if(r>=t||!Tn(t))return"";var i=t-r;return n=n==null?" ":n+"",ua(n,ln(i/n.length)).slice(0,i)}function Hi(e,t,r,i){function u(){var t=-1,n=arguments.length,a=-1,f=i.length,l=O(n+f);while(++a<f)l[a]=i[a];while(n--)l[a++]=arguments[++t];var c=this&&this!==Lt&&this instanceof u?o:e;return c.apply(s?r:this,l)}var s=t&n,o=wi(e);return u}function Bi(e){return function(t,n,r,i){var s=Ui(r);return s===Sr&&r==null?ui(t,n,e):ai(t,n,s(r,i,1),e)}}function ji(t,i,s,o,f,l,c,h){var p=i&r;if(!p&&typeof t!="function")throw new Tt(y);var d=o?o.length:0;d||(i&=~(u|a),o=f=null),d-=f?f.length:0;if(i&a){var v=o,m=f;o=f=null}var g=p?null:zi(t),b=[t,i,s,o,f,v,m,l,c,h];g&&(ts(b,g),i=b[1],h=b[9]),b[9]=h==null?p?0:t.length:Cn(h-d,0)||0;if(i==n)var w=gi(b[0],b[2]);else i!=u&&i!=(n|u)||!!b[4].length?w=Di.apply(e,b):w=Hi.apply(e,b);var E=g?Gr:ss;return E(w,b)}function Fi(t,n,r,i,s,o,u){var a=-1,f=t.length,l=n.length,c=!0;if(f!=l&&!(s&&l>f))return!1;while(c&&++a<f){var h=t[a],p=n[a];c=e,i&&(c=s?i(p,h,a):i(h,p,a));if(typeof c=="undefined")if(s){var d=l;while(d--){p=n[d],c=h&&h===p||r(h,p,i,s,o,u);if(c)break}}else c=h&&h===p||r(h,p,i,s,o,u)}return!!c}function Ii(e,t,n){switch(n){case S:case x:return+e==+t;case T:return e.name==t.name&&e.message==t.message;case k:return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case A:case M:return e==t+""}return!1}function qi(t,n,r,i,s,o,u){var a=ju(t),f=a.length,l=ju(n),c=l.length;if(f!=c&&!s)return!1;var h=s,p=-1;while(++p<f){var d=a[p],v=s?d in n:nn.call(n,d);if(v){var m=t[d],g=n[d];v=e,i&&(v=s?i(g,m,d):i(m,g,d)),typeof v=="undefined"&&(v=m&&m===g||r(m,g,i,s,o,u))}if(!v)return!1;h||(h=d=="constructor")}if(!h){var y=t.constructor,b=n.constructor;if(y!=b&&"constructor"in t&&"constructor"in n&&!(typeof y=="function"&&y instanceof y&&typeof b=="function"&&b instanceof b))return!1}return!0}function Ri(e,t,n){var r=n?Dn:_n,i=r,s=i;return kr(e,function(e,o,u){var a=t(e,o,u);if((n?a<i:a>i)||a===r&&a===s)i=a,s=e}),s}function Ui(e,t,n){var r=zn.callback||ba;return r=r===ba?Sr:r,n?r(e,t,n):r}function Xi(e,t,n){var r=zn.indexOf||Ts;return r=r===Ts?Mt:r,e?r(e,t,n):r}function Vi(e,t,n){var r=-1,i=n?n.length:0;while(++r<i){var s=n[r],o=s.size;switch(s.type){case"drop":e+=o;break;case"dropRight":t-=o;break;case"take":t=kn(t,e+o);break;case"takeRight":e=Cn(e,t-o)}}return{start:e,end:t}}function $i(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&nn.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Ji(e){var t=e.constructor;return typeof t=="function"&&t instanceof t||(t=Et),new t}function Ki(e,t,n){var r=e.constructor;switch(t){case D:return li(e);case S:case x:return new r(+e);case P:case H:case B:case j:case F:case I:case q:case R:case U:r instanceof r&&(r=Rn[t]);var i=e.buffer;return new r(n?li(i):i,e.byteOffset,e.length);case k:case M:return new r(e);case A:var s=new r(e.source,tt.exec(e));s.lastIndex=e.lastIndex}return s}function Qi(e,t){return e=+e,t=t==null?Fn:t,e>-1&&e%1==0&&e<t}function Gi(e,t,n){if(!hu(n))return!1;var r=typeof t;if(r=="number")var i=n.length,s=Zi(i)&&Qi(t,i);else s=r=="string"&&t in n;if(s){var o=n[t];return e===e?e===o:o!==o}return!1}function Yi(e){var t=Wi(e);return!!t&&e===zn[t]&&t in $n.prototype}function Zi(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Fn}function es(e){return e===e&&(e===0?1/e>0:!hu(e))}function ts(e,t){var r=e[1],o=t[1],u=r|o,a=u<f,c=o==f&&r==s||o==f&&r==l&&e[7].length<=t[8]||o==(f|l)&&r==s;if(!a&&!c)return e;o&n&&(e[2]=t[2],u|=r&n?0:i);var h=t[3];if(h){var p=e[3];e[3]=p?ci(p,h,t[4]):sr(h),e[4]=p?Vt(e[3],b):sr(t[4])}return h=t[5],h&&(p=e[5],e[5]=p?hi(p,h,t[6]):sr(h),e[6]=p?Vt(e[5],b):sr(t[6])),h=t[7],h&&(e[7]=sr(h)),o&f&&(e[8]=e[8]==null?t[8]:kn(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=u,e}function ns(e,t){e=fs(e);var n=-1,r=t.length,i={};while(++n<r){var s=t[n];s in e&&(i[s]=e[s])}return i}function rs(e,t){var n={};return Br(e,function(e,r,i){t(e,r,i)&&(n[r]=e)}),n}function is(t,n){var r=t.length,i=kn(n.length,r),s=sr(t);while(i--){var o=n[i];t[i]=Qi(o,r)?s[o]:e}return t}function os(e){var t,n=zn.support;if(!Wt(e)||sn.call(e)!=L||!!zt(e)||!nn.call(e,"constructor")&&(t=e.constructor,typeof t=="function"&&!(t instanceof t))||!n.argsTag&&nu(e))return!1;var r;return n.ownLast?(Br(e,function(e,t,n){return r=nn.call(n,t),!1}),r!==!1):(Br(e,function(e,t){r=t}),typeof r=="undefined"||nn.call(e,r))}function us(e){var t=Fu(e),n=t.length,r=n&&e.length,i=zn.support,s=r&&Zi(r)&&(ru(e)||i.nonEnumStrings&&wu(e)||i.nonEnumArgs&&nu(e)),o=-1,u=[];while(++o<n){var a=t[o];(s&&Qi(a,r)||nn.call(e,a))&&u.push(a)}return u}function as(e){return e==null?[]:Zi(e.length)?zn.support.unindexedChars&&wu(e)?e.split(""):hu(e)?e:Et(e):Vu(e)}function fs(e){if(zn.support.unindexedChars&&wu(e)){var t=-1,n=e.length,r=Et(e);while(++t<n)r[t]=e.charAt(t);return r}return hu(e)?e:Et(e)}function ls(e){return e instanceof $n?e.clone():new Xn(e.__wrapped__,e.__chain__,sr(e.__actions__))}function cs(e,t,n){(n?Gi(e,t,n):t==null)?t=1:t=Cn(+t||1,1);var r=0,i=e?e.length:0,s=-1,o=O(ln(i/t));while(r<i)o[++s]=Yr(e,r,r+=t);return o}function hs(e){var t=-1,n=e?e.length:0,r=-1,i=[];while(++t<n){var s=e[t];s&&(i[++r]=s)}return i}function ds(e,t,n){var r=e?e.length:0;if(!r)return[];if(n?Gi(e,t,n):t==null)t=1;return Yr(e,t<0?0:t)}function vs(e,t,n){var r=e?e.length:0;if(!r)return[];if(n?Gi(e,t,n):t==null)t=1;return t=r-(+t||0),Yr(e,0,t<0?0:t)}function ms(e,t,n){return e&&e.length?si(e,Ui(t,n,3),!0,!0):[]}function gs(e,t,n){return e&&e.length?si(e,Ui(t,n,3),!0):[]}function ys(e,t,n,r){var i=e?e.length:0;return i?(n&&typeof n!="number"&&Gi(e,t,n)&&(n=0,r=i),Or(e,t,n,r)):[]}function Es(t){return t?t[0]:e}function Ss(e,t,n){var r=e?e.length:0;return n&&Gi(e,t,n)&&(t=!1),r?Dr(e,t):[]}function xs(e){var t=e?e.length:0;return t?Dr(e,!0):[]}function Ts(e,t,n){var r=e?e.length:0;if(!r)return-1;if(typeof n=="number")n=n<0?Cn(r+n,0):n;else if(n){var i=ui(e,t),s=e[i];return(t===t?t===s:s!==s)?i:-1}return Mt(e,t,n||0)}function Ns(e){return vs(e,1)}function Cs(){var e=[],t=-1,n=arguments.length,r=[],i=Xi(),s=i==Mt;while(++t<n){var o=arguments[t];if(ru(o)||nu(o))e.push(o),r.push(s&&o.length>=120?yi(t&&o):null)}n=e.length;var u=e[0],a=-1,f=u?u.length:0,l=[],c=r[0];e:while(++a<f){o=u[a];if((c?rr(c,o):i(l,o,0))<0){t=n;while(--t){var h=r[t];if((h?rr(h,o):i(e[t],o,0))<0)continue e}c&&c.push(o),l.push(o)}}return l}function ks(t){var n=t?t.length:0;return n?t[n-1]:e}function Ls(e,t,n){var r=e?e.length:0;if(!r)return-1;var i=r;if(typeof n=="number")i=(n<0?Cn(r+n,0):kn(n||0,r-1))+1;else if(n){i=ui(e,t,!0)-1;var s=e[i];return(t===t?t===s:s!==s)?i:-1}if(t!==t)return Ut(e,i,!0);while(i--)if(e[i]===t)return i;return-1}function As(){var e=arguments,t=e[0];if(!t||!t.length)return t;var n=0,r=Xi(),i=e.length;while(++n<i){var s=0,o=e[n];while((s=r(t,o,s))>-1)yn.call(t,s,1)}return t}function Ms(e,t,n){var r=-1,i=e?e.length:0,s=[];t=Ui(t,n,3);while(++r<i){var o=e[r];t(o,r,e)&&(s.push(o),yn.call(e,r--,1),i--)}return s}function _s(e){return ds(e,1)}function Ds(e,t,n){var r=e?e.length:0;return r?(n&&typeof n!="number"&&Gi(e,t,n)&&(t=0,n=r),Yr(e,t,n)):[]}function Bs(e,t,n){var r=e?e.length:0;if(!r)return[];if(n?Gi(e,t,n):t==null)t=1;return Yr(e,0,t<0?0:t)}function js(e,t,n){var r=e?e.length:0;if(!r)return[];if(n?Gi(e,t,n):t==null)t=1;return t=r-(+t||0),Yr(e,t<0?0:t)}function Fs(e,t,n){return e&&e.length?si(e,Ui(t,n,3),!1,!0):[]}function Is(e,t,n){return e&&e.length?si(e,Ui(t,n,3)):[]}function Rs(e,t,n,r){var i=e?e.length:0;if(!i)return[];t!=null&&typeof t!="boolean"&&(r=n,n=Gi(e,t,r)?null:t,t=!1);var s=Ui();if(s!==Sr||n!=null)n=s(n,r,3);return t&&Xi()==Mt?$t(e,n):ri(e,n)}function Us(e){var t=-1,n=(e&&e.length&&cr(lr(e,tn)))>>>0,r=O(n);while(++t<n)r[t]=lr(e,Jr(t));return r}function Ws(){var e=-1,t=arguments.length;while(++e<t){var n=arguments[e];if(ru(n)||nu(n))var r=r?Cr(r,n).concat(Cr(n,r)):n}return r?ri(r):[]}function Vs(e,t){var n=-1,r=e?e.length:0,i={};r&&!t&&!ru(e[0])&&(t=[]);while(++n<r){var s=e[n];t?i[s]=t[n]:s&&(i[s[0]]=s[1])}return i}function $s(e){var t=zn(e);return t.__chain__=!0,t}function Js(e,t,n){return t.call(n,e),e}function Ks(e,t,n){return t.call(n,e)}function Qs(){return $s(this)}function Gs(){return new Xn(this.value(),this.__chain__)}function Ys(e){var t,n=this;while(n instanceof Wn){var r=ls(n);t?i.__wrapped__=r:t=r;var i=r;n=n.__wrapped__}return i.__wrapped__=e,t}function Zs(){var e=this.__wrapped__;return e instanceof $n?(this.__actions__.length&&(e=new $n(this)),new Xn(e.reverse(),this.__chain__)):this.thru(function(e){return e.reverse()})}function eo(){return this.value()+""}function to(){return oi(this.__wrapped__,this.__actions__)}function io(e,t,n){var r=ru(e)?ar:Ar;n&&Gi(e,t,n)&&(t=null);if(typeof t!="function"||typeof n!="undefined")t=Ui(t,n,3);return r(e,t)}function so(e,t,n){var r=ru(e)?fr:Mr;return t=Ui(t,n,3),r(e,t)}function ao(e,t){return oo(e,Wr(t))}function ho(e,t,n,r){var i=e?e.length:0;return Zi(i)||(e=Vu(e),i=e.length),i?(typeof n!="number"||r&&Gi(t,n,r)?n=0:n=n<0?Cn(i+n,0):n||0,typeof e=="string"||!ru(e)&&wu(e)?n<i&&e.indexOf(t,n)>-1:Xi(e,t,n)>-1):!1}function mo(e,t,n){var r=ru(e)?lr:zr;return t=Ui(t,n,3),r(e,t)}function yo(e,t){return mo(e,Jr(t))}function Eo(e,t,n){var r=ru(e)?fr:Mr;return t=Ui(t,n,3),r(e,function(e,n,r){return!t(e,n,r)})}function So(t,n,r){if(r?Gi(t,n,r):n==null){t=as(t);var i=t.length;return i>0?t[Kr(0,i-1)]:e}var s=xo(t);return s.length=kn(n<0?0:+n||0,s.length),s}function xo(e){e=as(e);var t=-1,n=e.length,r=O(n);while(++t<n){var i=Kr(0,t);t!=i&&(r[t]=r[i]),r[i]=e[t]}return r}function To(e){var t=e?e.length:0;return Zi(t)?t:ju(e).length}function No(e,t,n){var r=ru(e)?vr:Zr;n&&Gi(e,t,n)&&(t=null);if(typeof t!="function"||typeof n!="undefined")t=Ui(t,n,3);return r(e,t)}function Co(e,t,n){if(e==null)return[];var r=-1,i=e.length,s=Zi(i)?O(i):[];return n&&Gi(e,t,n)&&(t=null),t=Ui(t,n,3),kr(e,function(e,n,i){s[++r]={criteria:t(e,n,i),index:r,value:e}}),ei(s,jt)}function ko(){var e=arguments,t=e[0],n=e[3],r=0,i=e.length-1;if(t==null)return[];var s=O(i);while(r<i)s[r]=e[++r];return n&&Gi(e[1],e[2],n)&&(s=e[1]),ti(t,Dr(s),[])}function Lo(e,t,n,r){return e==null?[]:(r&&Gi(t,n,r)&&(n=null),ru(t)||(t=t==null?[]:[t]),ru(n)||(n=n==null?[]:[n]),ti(e,t,n))}function Ao(e,t){return so(e,Wr(t))}function Mo(e,t){if(typeof t!="function"){if(typeof e!="function")throw new Tt(y);var n=e;e=t,t=n}return e=Tn(e=+e)?e:0,function(){if(--e<1)return t.apply(this,arguments)}}function _o(e,t,n){return n&&Gi(e,t,n)&&(t=null),t=e&&t==null?e.length:Cn(+t||0,0),ji(e,f,null,null,null,null,t)}function Do(e,t){var n;if(typeof t!="function"){if(typeof e!="function")throw new Tt(y);var r=e;e=t,t=r}return function(){return--e>0?n=t.apply(this,arguments):t=null,n}}function Io(t,n,r){function v(){f&&cn(f),s&&cn(s),s=f=l=e}function m(){var r=n-(Oo()-u);if(r<=0||r>n){s&&cn(s);var h=l;s=f=l=e,h&&(c=Oo(),o=t.apply(a,i),!f&&!s&&(i=a=null))}else f=gn(m,r)}function g(){f&&cn(f),s=f=l=e;if(p||h!==n)c=Oo(),o=t.apply(a,i),!f&&!s&&(i=a=null)}function b(){i=arguments,u=Oo(),a=this,l=p&&(f||!d);if(h===!1)var e=d&&!f;else{!s&&!d&&(c=u);var r=h-(u-c),v=r<=0||r>h;v?(s&&(s=cn(s)),c=u,o=t.apply(a,i)):s||(s=gn(g,r))}return v&&f?f=cn(f):!f&&n!==h&&(f=gn(m,n)),e&&(v=!0,o=t.apply(a,i)),v&&!f&&!s&&(i=a=null),o}var i,s,o,u,a,f,l,c=0,h=!1,p=!0;if(typeof t!="function")throw new Tt(y);n=n<0?0:+n||0;if(r===!0){var d=!0;p=!1}else hu(r)&&(d=r.leading,h="maxWait"in r&&Cn(+r.maxWait||0,n),p="trailing"in r?r.trailing:p);return b.cancel=v,b}function Wo(e,t){if(typeof e!="function"||t&&typeof t!="function")throw new Tt(y);var n=function(){var r=arguments,i=n.cache,s=t?t.apply(this,r):r[0];if(i.has(s))return i.get(s);var o=e.apply(this,r);return i.set(s,o),o};return n.cache=new Wo.Cache,n}function Xo(e){if(typeof e!="function")throw new Tt(y);return function(){return!e.apply(this,arguments)}}function Vo(e){return Do(e,2)}function Qo(e,t){if(typeof e!="function")throw new Tt(y);return t=Cn(typeof t=="undefined"?e.length-1:+t||0,0),function(){var n=arguments,r=-1,i=Cn(n.length-t,0),s=O(i);while(++r<i)s[r]=n[t+r];switch(t){case 0:return e.call(this,s);case 1:return e.call(this,n[0],s);case 2:return e.call(this,n[0],n[1],s)}var o=O(t+1);r=-1;while(++r<t)o[r]=n[r];return o[t]=s,e.apply(this,o)}}function Go(e){if(typeof e!="function")throw new Tt(y);return function(t){return e.apply(this,t)}}function Yo(e,t,n){var r=!0,i=!0;if(typeof e!="function")throw new Tt(y);return n===!1?r=!1:hu(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),mt.leading=r,mt.maxWait=+t,mt.trailing=i,Io(e,t,mt)}function Zo(e,t){return t=t==null?Ea:t,ji(t,u,null,[e],[])}function eu(e,t,n,r){return t&&typeof t!="boolean"&&Gi(e,t,n)?t=!1:typeof t=="function"&&(r=n,n=t,t=!1),n=typeof n=="function"&&fi(n,r,1),xr(e,t,n)}function tu(e,t,n){return t=typeof t=="function"&&fi(t,n,1),xr(e,!0,t)}function nu(t){var n=Wt(t)?t.length:e;return Zi(n)&&sn.call(t)==w}function iu(e){return e===!0||e===!1||Wt(e)&&sn.call(e)==S}function su(e){return Wt(e)&&sn.call(e)==x}function ou(e){return!!e&&e.nodeType===1&&Wt(e)&&(zn.support.nodeTag?sn.call(e).indexOf("Element")>-1:zt(e))}function uu(e){if(e==null)return!0;var t=e.length;return Zi(t)&&(ru(e)||wu(e)||nu(e)||Wt(e)&&cu(e.splice))?!t:!ju(e).length}function au(t,n,r,i){r=typeof r=="function"&&fi(r,i,3);if(!r&&es(t)&&es(n))return t===n;var s=r?r(t,n):e;return typeof s=="undefined"?qr(t,n,r):!!s}function fu(e){return Wt(e)&&typeof e.message=="string"&&sn.call(e)==T}function hu(e){var t=typeof e;return t=="function"||!!e&&t=="object"}function pu(e,t,n,r){var i=ju(t),s=i.length;if(!s)return!0;if(e==null)return!1;n=typeof n=="function"&&fi(n,r,3);if(!n&&s==1){var o=i[0],u=t[o];if(es(u))return u===e[o]&&(typeof u!="undefined"||o in fs(e))}var a=O(s),f=O(s);while(s--)u=a[s]=t[i[s]],f[s]=es(u);return Ur(fs(e),i,a,f,n)}function du(e){return gu(e)&&e!=+e}function vu(e){return e==null?!1:sn.call(e)==N?un.test(en.call(e)):Wt(e)&&(zt(e)?un:rt).test(e)}function mu(e){return e===null}function gu(e){return typeof e=="number"||Wt(e)&&sn.call(e)==k}function bu(e){return hu(e)&&sn.call(e)==A}function wu(e){return typeof e=="string"||Wt(e)&&sn.call(e)==M}function Eu(e){return Wt(e)&&Zi(e.length)&&!!dt[sn.call(e)]}function Su(e){return typeof e=="undefined"}function xu(e){var t=e?e.length:0;return Zi(t)?t?zn.support.unindexedChars&&wu(e)?e.split(""):sr(e):[]:Vu(e)}function Tu(e){return Er(e,Fu(e))}function Cu(e,t,n){var r=Tr(e);return n&&Gi(e,t,n)&&(t=null),t?Er(t,r,ju(t)):r}function Pu(e){return Ir(e,Fu(e))}function Hu(e,t){return e?nn.call(e,t):!1}function Bu(e,t,n){n&&Gi(e,t,n)&&(t=null);var r=-1,i=ju(e),s=i.length,o={};while(++r<s){var u=i[r],a=e[u];t?nn.call(o,a)?o[a].push(u):o[a]=[u]:o[a]=u}return o}function Fu(e){if(e==null)return[];hu(e)||(e=Et(e));var t=e.length,n=zn.support;t=t&&Zi(t)&&(ru(e)||n.nonEnumStrings&&wu(e)||n.nonEnumArgs&&nu(e))&&t||0;var r=e.constructor,i=-1,s=cu(r)&&r.prototype||kt,o=s===e,u=O(t),a=t>0,f=n.enumErrorProps&&(e===Ct||e instanceof gt),l=n.enumPrototypes&&cu(e);while(++i<t)u[i]=i+"";for(var c in e)(!l||c!="prototype")&&(!f||c!="message"&&c!="name")&&(!a||!Qi(c,t))&&(c!="constructor"||!o&&!!nn.call(e,c))&&u.push(c);if(n.nonEnumShadows&&e!==kt){var h=e===Xt?M:e===Ct?T:sn.call(e),p=Un[h]||Un[L];h==L&&(s=kt),t=ht.length;while(t--){c=ht[t];var d=p[c];(!o||!d)&&(d?nn.call(e,c):e[c]!==s[c])&&u.push(c)}}return u}function Iu(e,t,n){var r={};return t=Ui(t,n,3),jr(e,function(e,n,i){r[n]=t(e,n,i)}),r}function Uu(e){var t=-1,n=ju(e),r=n.length,i=O(r);while(++t<r){var s=n[t];i[t]=[s,e[s]]}return i}function Wu(t,n,r){var i=t==null?e:t[n];return typeof i=="undefined"&&(i=r),cu(i)?i.call(t):i}function Xu(e,t,n,r){var i=ru(e)||Eu(e);t=Ui(t,r,4);if(n==null)if(i||hu(e)){var s=e.constructor;i?n=ru(e)?new s:[]:n=Tr(cu(s)&&s.prototype)}else n={};return(i?or:jr)(e,function(e,r,i){return t(n,e,r,i)}),n}function Vu(e){return ii(e,ju(e))}function $u(e){return ii(e,Fu(e))}function Ju(e,t,n){return t=+t||0,typeof n=="undefined"?(n=t,t=0):n=+n||0,e>=t&&e<n}function Ku(e,t,n){n&&Gi(e,t,n)&&(t=n=null);var r=e==null,i=t==null;n==null&&(i&&typeof e=="boolean"?(n=e,e=1):typeof t=="boolean"&&(n=t,i=!0)),r&&i&&(t=1,i=!1),e=+e||0,i?(t=e,e=0):t=+t||0;if(n||e%1||t%1){var s=Mn();return kn(e+s*(t-e+parseFloat("1e-"+((s+"").length-1))),t)}return Kr(e,t)}function Gu(e){return e=Dt(e),e&&e.charAt(0).toUpperCase()+e.slice(1)}function Yu(e){return e=Dt(e),e&&e.replace(it,It).replace(Z,"")}function Zu(e,t,n){e=Dt(e),t+="";var r=e.length;return n=typeof n=="undefined"?r:kn(n<0?0:+n||0,r),n-=t.length,n>=0&&e.indexOf(t,n)==n}function ea(e){return e=Dt(e),e&&K.test(e)?e.replace($,qt):e}function ta(e){return e=Dt(e),e&&ut.test(e)?e.replace(ot,"\\$&"):e}function ra(e,t,n){e=Dt(e),t=+t;var r=e.length;if(r>=t||!Tn(t))return e;var i=(t-r)/2,s=hn(i),o=ln(i);return n=Pi("",o,n),n.slice(0,s)+e+n}function oa(e,t,n){return n&&Gi(e,t,n)&&(t=0),On(e,t)}function ua(e,t){var n="";e=Dt(e),t=+t;if(t<1||!e||!Tn(t))return n;do t%2&&(n+=e),t=hn(t/2),e+=e;while(t);return n}function la(e,t,n){return e=Dt(e),n=n==null?0:kn(n<0?0:+n||0,e.length),e.lastIndexOf(t,n)==n}function ca(t,n,r){var i=zn.templateSettings;r&&Gi(t,n,r)&&(n=r=null),t=Dt(t),n=br(br({},r||n),i,yr);var s=br(br({},n.imports),i.imports,yr),o=ju(s),u=ii(s,o),a,f,l=0,c=n.interpolate||st,h="__p += '",p=St((n.escape||st).source+"|"+c.source+"|"+(c===Y?et:st).source+"|"+(n.evaluate||st).source+"|$","g"),d="//# sourceURL="+("sourceURL"in n?n.sourceURL:"lodash.templateSources["+ ++pt+"]")+"\n";t.replace(p,function(e,n,r,i,s,o){return r||(r=i),h+=t.slice(l,o).replace(at,Rt),n&&(a=!0,h+="' +\n__e("+n+") +\n'"),s&&(f=!0,h+="';\n"+s+";\n__p += '"),r&&(h+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),l=o+e.length,e}),h+="';\n";var v=n.variable;v||(h="with (obj) {\n"+h+"\n}\n"),h=(f?h.replace(z,""):h).replace(W,"$1").replace(X,"$1;"),h="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(a?", __e = _.escape":"")+(f?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var m=ya(function(){return yt(o,d+"return "+h).apply(e,u)});m.source=h;if(fu(m))throw m;return m}function ha(e,t,n){var r=e;return e=Dt(e),e?(n?Gi(r,t,n):t==null)?e.slice(Jt(e),Kt(e)+1):(t+="",e.slice(Ht(e,t),Bt(e,t)+1)):e}function pa(e,t,n){var r=e;return e=Dt(e),e?(n?Gi(r,t,n):t==null)?e.slice(Jt(e)):e.slice(Ht(e,t+"")):e}function da(e,t,n){var r=e;return e=Dt(e),e?(n?Gi(r,t,n):t==null)?e.slice(0,Kt(e)+1):e.slice(0,Bt(e,t+"")+1):e}function va(e,t,n){n&&Gi(e,t,n)&&(t=null);var r=c,i=h;if(t!=null)if(hu(t)){var s="separator"in t?t.separator:s;r="length"in t?+t.length||0:r,i="omission"in t?Dt(t.omission):i}else r=+t||0;e=Dt(e);if(r>=e.length)return e;var o=r-i.length;if(o<1)return i;var u=e.slice(0,o);if(s==null)return u+i;if(bu(s)){if(e.slice(o).search(s)){var a,f,l=e.slice(0,o);s.global||(s=St(s.source,(tt.exec(s)||"")+"g")),s.lastIndex=0;while(a=s.exec(l))f=a.index;u=u.slice(0,f==null?o:f)}}else if(e.indexOf(s,o)!=o){var p=u.lastIndexOf(s);p>-1&&(u=u.slice(0,p))}return u+i}function ma(e){return e=Dt(e),e&&J.test(e)?e.replace(V,Qt):e}function ga(e,t,n){return n&&Gi(e,t,n)&&(t=null),e=Dt(e),e.match(t||ft)||[]}function ba(e,t,n){return n&&Gi(e,t,n)&&(t=null),Wt(e)?Sa(e):Sr(e,t)}function wa(e){return function(){return e}}function Ea(e){return e}function Sa(e){return Wr(xr(e,!0))}function xa(e,t){return Xr(e+"",xr(t,!0))}function Ta(e,t,n){if(n==null){var r=hu(t),i=r&&ju(t),s=i&&i.length&&Ir(t,i);if(s?!s.length:!r)s=!1,n=t,t=e,e=this}s||(s=Ir(t,ju(t)));var o=!0,u=-1,a=cu(e),f=s.length;n===!1?o=!1:hu(n)&&"chain"in n&&(o=n.chain);while(++u<f){var l=s[u],c=t[l];e[l]=c,a&&(e.prototype[l]=function(t){return function(){var n=this.__chain__;if(o||n){var r=e(this.__wrapped__),i=r.__actions__=sr(this.__actions__);return i.push({func:t,args:arguments,thisArg:e}),r.__chain__=n,r}var s=[this.value()];return dn.apply(s,arguments),t.apply(e,s)}}(c))}return e}function Na(){return C._=on,this}function Ca(){}function ka(e){return Jr(e+"")}function La(t){return function(n){return t==null?e:t[n]}}function Aa(e,t,n){n&&Gi(e,t,n)&&(t=n=null),e=+e||0,n=n==null?1:+n||0,t==null?(t=e,e=0):t=+t||0;var r=-1,i=Cn(ln((t-e)/(n||1)),0),s=O(i);while(++r<i)s[r]=e,e+=n;return s}function Oa(e,t,n){e=+e;if(e<1||!Tn(e))return[];var r=-1,i=O(kn(e,Pn));t=fi(t,n,1);while(++r<e)r<Pn?i[r]=t(r):t(r);return i}function Ma(e){var t=++rn;return Dt(e)+t}function _a(e,t){return e+t}function Ha(e,t,n){n&&Gi(e,t,n)&&(t=null);var r=Ui(),i=t==null;if(r!==Sr||!i)i=!1,t=r(t,n,3);return i?mr(ru(e)?e:as(e)):ni(e,t)}C=C?Yt.defaults(Lt.Object(),C,Yt.pick(Lt,ct)):Lt;var O=C.Array,_=C.Date,gt=C.Error,yt=C.Function,bt=C.Math,wt=C.Number,Et=C.Object,St=C.RegExp,xt=C.String,Tt=C.TypeError,Nt=O.prototype,Ct=gt.prototype,kt=Et.prototype,Xt=xt.prototype,Zt=(Zt=C.window)&&Zt.document,en=yt.prototype.toString,tn=Jr("length"),nn=kt.hasOwnProperty,rn=0,sn=kt.toString,on=C._,un=St("^"+ta(sn).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),an=vu(an=C.ArrayBuffer)&&an,fn=vu(fn=an&&(new an(0)).slice)&&fn,ln=bt.ceil,cn=C.clearTimeout,hn=bt.floor,pn=vu(pn=Et.getPrototypeOf)&&pn,dn=Nt.push,vn=kt.propertyIsEnumerable,mn=vu(mn=C.Set)&&mn,gn=C.setTimeout,yn=Nt.splice,bn=vu(bn=C.Uint8Array)&&bn,wn=vu(wn=C.WeakMap)&&wn,En=function(){try{var e=vu(e=C.Float64Array)&&e,t=new e(new an(10),0,1)&&e}catch(n){}return t}(),Sn=vu(Sn=O.isArray)&&Sn,xn=vu(xn=Et.create)&&xn,Tn=C.isFinite,Nn=vu(Nn=Et.keys)&&Nn,Cn=bt.max,kn=bt.min,Ln=vu(Ln=_.now)&&Ln,An=vu(An=wt.isFinite)&&An,On=C.parseInt,Mn=bt.random,_n=wt.NEGATIVE_INFINITY,Dn=wt.POSITIVE_INFINITY,Pn=bt.pow(2,32)-1,Hn=Pn-1,Bn=Pn>>>1,jn=En?En.BYTES_PER_ELEMENT:0,Fn=bt.pow(2,53)-1,In=wn&&new wn,qn={},Rn={};Rn[P]=C.Float32Array,Rn[H]=C.Float64Array,Rn[B]=C.Int8Array,Rn[j]=C.Int16Array,Rn[F]=C.Int32Array,Rn[I]=C.Uint8Array,Rn[q]=C.Uint8ClampedArray,Rn[R]=C.Uint16Array,Rn[U]=C.Uint32Array;var Un={};Un[E]=Un[x]=Un[k]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},Un[S]=Un[M]={constructor:!0,toString:!0,valueOf:!0},Un[T]=Un[N]=Un[A]={constructor:!0,toString:!0},Un[L]={constructor:!0},or(ht,function(e){for(var t in Un)if(nn.call(Un,t)){var n=Un[t];n[e]=nn.call(n,e)}});var Vn=zn.support={};(function(e){var t=function(){this.x=1},n={0:1,length:1},r=[];t.prototype={valueOf:1,y:1};for(var i in new t)r.push(i);Vn.argsTag=sn.call(arguments)==w,Vn.enumErrorProps=vn.call(Ct,"message")||vn.call(Ct,"name"),Vn.enumPrototypes=vn.call(t,"prototype"),Vn.funcDecomp=/\bthis\b/.test(function(){return this}),Vn.funcNames=typeof yt.name=="string",Vn.nodeTag=sn.call(Zt)!=L,Vn.nonEnumStrings=!vn.call("x",0),Vn.nonEnumShadows=!/valueOf/.test(r),Vn.ownLast=r[0]!="x",Vn.spliceObjects=(yn.call(n,0,1),!n[0]),Vn.unindexedChars="x"[0]+Et("x")[0]!="xx";try{Vn.dom=Zt.createDocumentFragment().nodeType===11}catch(s){Vn.dom=!1}try{Vn.nonEnumArgs=!vn.call(arguments,1)}catch(s){Vn.nonEnumArgs=!0}})(0,0),zn.templateSettings={escape:Q,evaluate:G,interpolate:Y,variable:"",imports:{_:zn}};var Tr=function(){function e(){}return function(t){if(hu(t)){e.prototype=t;var n=new e;e.prototype=null}return n||C.Object()}}(),kr=vi(jr),Lr=vi(Fr,!0),Pr=mi(),Hr=mi(!0),Gr=In?function(e,t){return In.set(e,t),e}:Ea;fn||(li=!an||!bn?wa(null):function(e){var t=e.byteLength,n=En?hn(t/jn):0,r=n*jn,i=new an(t);if(n){var s=new En(i,0,n);s.set(new En(e,0,n))}return t!=r&&(s=new bn(i,r),s.set(new bn(e,r))),i});var yi=!xn||!mn?wa(null):function(e){return new nr(e)},zi=In?function(e){return In.get(e)}:Ca,Wi=function(){return Vn.funcNames?wa.name=="constant"?Jr("name"):function(e){var t=e.name,n=qn[t],r=n?n.length:0;while(r--){var i=n[r],s=i.func;if(s==null||s==e)return i.name}return t}:wa("")}(),ss=function(){var e=0,t=0;return function(n,r){var i=Oo(),s=d-(i-t);t=i;if(s>0){if(++e>=p)return n}else e=0;return Gr(n,r)}}(),ps=Qo(function(e,t){return ru(e)||nu(e)?Cr(e,Dr(t,!1,!0)):[]}),bs=Ti(),ws=Ti(!0),Os=Qo(function(e,t){e||(e=[]),t=Dr(t);var n=t.length,r=wr(e,t);t.sort(At);while(n--){var i=parseFloat(t[n]);if(i!=s&&Qi(i)){var s=i;yn.call(e,i,1)}}return r}),Ps=Bi(),Hs=Bi(!0),qs=Qo(function(e){return ri(Dr(e,!1,!0))}),zs=Qo(function(e,t){return ru(e)||nu(e)?Cr(e,t):[]}),Xs=Qo(Us),no=Qo(function(e,t){var n=e?e.length:0;return Zi(n)&&(e=as(e)),wr(e,Dr(t))}),ro=pi(function(e,t,n){nn.call(e,n)?++e[n]:e[n]=1}),oo=xi(kr),uo=xi(Lr,!0),fo=ki(or,kr),lo=ki(ur,Lr),co=pi(function(e,t,n){nn.call(e,n)?e[n].push(t):e[n]=[t]}),po=pi(function(e,t,n){e[n]=t}),vo=Qo(function(t,n,r){var i=-1,s=typeof n=="function",o=t?t.length:0,u=Zi(o)?O(o):[];return kr(t,function(t){var o=s?n:t!=null&&t[n];u[++i]=o?o.apply(t,r):e}),u}),go=pi(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]}),bo=_i(pr,kr),wo=_i(dr,Lr),Oo=Ln||function(){return(new _).getTime()},Po=Qo(function(e,t,r){var i=n;if(r.length){var s=Vt(r,Po.placeholder);i|=u}return ji(e,i,t,r,s)}),Ho=Qo(function(e,t){t=t.length?Dr(t):Pu(e);var r=-1,i=t.length;while(++r<i){var s=t[r];e[s]=ji(e[s],n,e)}return e}),Bo=Qo(function(e,t,i){var s=n|r;if(i.length){var o=Vt(i,Bo.placeholder);s|=u}return ji(t,s,e,i,o)}),jo=Ei(s),Fo=Ei(o),qo=Qo(function(e,t){return Nr(e,1,t)}),Ro=Qo(function(e,t,n){return Nr(e,t,n)}),Uo=Ci(),zo=Ci(!0),$o=Mi(u),Jo=Mi(a),Ko=Qo(function(e,t){return ji(e,l,null,null,null,Dr(t))});Vn.argsTag||(nu=function(t){var n=Wt(t)?t.length:e;return Zi(n)&&nn.call(t,"callee")&&!vn.call(t,"callee")});var ru=Sn||function(e){return Wt(e)&&Zi(e.length)&&sn.call(e)==E};Vn.dom||(ou=function(e){return!!e&&e.nodeType===1&&Wt(e)&&!yu(e)});var lu=An||function(e){return typeof e=="number"&&Tn(e)},cu=_t(/x/)||bn&&!_t(bn)?function(e){return sn.call(e)==N}:_t,yu=pn?function(e){if(!e||sn.call(e)!=L||!zn.support.argsTag&&nu(e))return!1;var t=e.valueOf,n=vu(t)&&(n=pn(t))&&pn(n);return n?e==n||pn(e)==n:os(e)}:os,Nu=di(br),ku=Qo(function(t){var n=t[0];return n==null?n:(t.push(gr),Nu.apply(e,t))}),Lu=Ni(jr),Au=Ni(Fr),Ou=Li(Pr),Mu=Li(Hr),_u=Ai(jr),Du=Ai(Fr),ju=Nn?function(e){if(e)var t=e.constructor,n=e.length;return typeof t=="function"&&t.prototype===e||(typeof e=="function"?zn.support.enumPrototypes:n&&Zi(n))?us(e):hu(e)?Nn(e):[]}:us,qu=di(Vr),Ru=Qo(function(e,t){if(e==null)return{};if(typeof t[0]!="function"){var t=lr(Dr(t),xt);return ns(e,Cr(Fu(e),t))}var n=fi(t[0],t[1],3);return rs(e,function(e,t,r){return!n(e,t,r)})}),zu=Qo(function(e,t){return e==null?{}:typeof t[0]=="function"?rs(e,fi(t[0],t[1],3)):ns(e,Dr(t))}),Qu=bi(function(e,t,n){return t=t.toLowerCase(),e+(n?t.charAt(0).toUpperCase()+t.slice(1):t)}),na=bi(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),ia=Oi(),sa=Oi(!0);On(lt+"08")!=8&&(oa=function(e,t,n){return(n?Gi(e,t,n):t==null)?t=0:t&&(t=+t),e=ha(e),On(e,t||(nt.test(e)?16:10))});var aa=bi(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}),fa=bi(function(e,t,n){return e+(n?" ":"")+(t.charAt(0).toUpperCase()+t.slice(1))}),ya=Qo(function(t,n){try{return t.apply(e,n)}catch(r){return fu(r)?r:new gt(r)}}),Da=Si(cr),Pa=Si(hr,!0);return zn.prototype=Wn.prototype,Xn.prototype=Tr(Wn.prototype),Xn.prototype.constructor=Xn,$n.prototype=Tr(Wn.prototype),$n.prototype.constructor=$n,Gn.prototype["delete"]=Yn,Gn.prototype.get=Zn,Gn.prototype.has=er,Gn.prototype.set=tr,nr.prototype.push=ir,Wo.Cache=Gn,zn.after=Mo,zn.ary=_o,zn.assign=Nu,zn.at=no,zn.before=Do,zn.bind=Po,zn.bindAll=Ho,zn.bindKey=Bo,zn.callback=ba,zn.chain=$s,zn.chunk=cs,zn.compact=hs,zn.constant=wa,zn.countBy=ro,zn.create=Cu,zn.curry=jo,zn.curryRight=Fo,zn.debounce=Io,zn.defaults=ku,zn.defer=qo,zn.delay=Ro,zn.difference=ps,zn.drop=ds,zn.dropRight=vs,zn.dropRightWhile=ms,zn.dropWhile=gs,zn.fill=ys,zn.filter=so,zn.flatten=Ss,zn.flattenDeep=xs,zn.flow=Uo,zn.flowRight=zo,zn.forEach=fo,zn.forEachRight=lo,zn.forIn=Ou,zn.forInRight=Mu,zn.forOwn=_u,zn.forOwnRight=Du,zn.functions=Pu,zn.groupBy=co,zn.indexBy=po,zn.initial=Ns,zn.intersection=Cs,zn.invert=Bu,zn.invoke=vo,zn.keys=ju,zn.keysIn=Fu,zn.map=mo,zn.mapValues=Iu,zn.matches=Sa,zn.matchesProperty=xa,zn.memoize=Wo,zn.merge=qu,zn.mixin=Ta,zn.negate=Xo,zn.omit=Ru,zn.once=Vo,zn.pairs=Uu,zn.partial=$o,zn.partialRight=Jo,zn.partition=go,zn.pick=zu,zn.pluck=yo,zn.property=ka,zn.propertyOf=La,zn.pull=As,zn.pullAt=Os,zn.range=Aa,zn.rearg=Ko,zn.reject=Eo,zn.remove=Ms,zn.rest=_s,zn.restParam=Qo,zn.shuffle=xo,zn.slice=Ds,zn.sortBy=Co,zn.sortByAll=ko,zn.sortByOrder=Lo,zn.spread=Go,zn.take=Bs,zn.takeRight=js,zn.takeRightWhile=Fs,zn.takeWhile=Is,zn.tap=Js,zn.throttle=Yo,zn.thru=Ks,zn.times=Oa,zn.toArray=xu,zn.toPlainObject=Tu,zn.transform=Xu,zn.union=qs,zn.uniq=Rs,zn.unzip=Us,zn.values=Vu,zn.valuesIn=$u,zn.where=Ao,zn.without=zs,zn.wrap=Zo,zn.xor=Ws,zn.zip=Xs,zn.zipObject=Vs,zn.backflow=zo,zn.collect=mo,zn.compose=zo,zn.each=fo,zn.eachRight=lo,zn.extend=Nu,zn.iteratee=ba,zn.methods=Pu,zn.object=Vs,zn.select=so,zn.tail=_s,zn.unique=Rs,Ta(zn,zn),zn.add=_a,zn.attempt=ya,zn.camelCase=Qu,zn.capitalize=Gu,zn.clone=eu,zn.cloneDeep=tu,zn.deburr=Yu,zn.endsWith=Zu,zn.escape=ea,zn.escapeRegExp=ta,zn.every=io,zn.find=oo,zn.findIndex=bs,zn.findKey=Lu,zn.findLast=uo,zn.findLastIndex=ws,zn.findLastKey=Au,zn.findWhere=ao,zn.first=Es,zn.has=Hu,zn.identity=Ea,zn.includes=ho,zn.indexOf=Ts,zn.inRange=Ju,zn.isArguments=nu,zn.isArray=ru,zn.isBoolean=iu,zn.isDate=su,zn.isElement=ou,zn.isEmpty=uu,zn.isEqual=au,zn.isError=fu,zn.isFinite=lu,zn.isFunction=cu,zn.isMatch=pu,zn.isNaN=du,zn.isNative=vu,zn.isNull=mu,zn.isNumber=gu,zn.isObject=hu,zn.isPlainObject=yu,zn.isRegExp=bu,zn.isString=wu,zn.isTypedArray=Eu,zn.isUndefined=Su,zn.kebabCase=na,zn.last=ks,zn.lastIndexOf=Ls,zn.max=Da,zn.min=Pa,zn.noConflict=Na,zn.noop=Ca,zn.now=Oo,zn.pad=ra,zn.padLeft=ia,zn.padRight=sa,zn.parseInt=oa,zn.random=Ku,zn.reduce=bo,zn.reduceRight=wo,zn.repeat=ua,zn.result=Wu,zn.runInContext=Gt,zn.size=To,zn.snakeCase=aa,zn.some=No,zn.sortedIndex=Ps,zn.sortedLastIndex=Hs,zn.startCase=fa,zn.startsWith=la,zn.sum=Ha,zn.template=ca,zn.trim=ha,zn.trimLeft=pa,zn.trimRight=da,zn.trunc=va,zn.unescape=ma,zn.uniqueId=Ma,zn.words=ga,zn.all=io,zn.any=No,zn.contains=ho,zn.detect=oo,zn.foldl=bo,zn.foldr=wo,zn.head=Es,zn.include=ho,zn.inject=bo,Ta(zn,function(){var e={};return jr(zn,function(t,n){zn.prototype[n]||(e[n]=t)}),e}(),!1),zn.sample=So,zn.prototype.sample=function(e){return!this.__chain__&&e==null?So(this.value()):this.thru(function(t){return So(t,e)})},zn.VERSION=t,or(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){zn[e].placeholder=zn}),or(["dropWhile","filter","map","takeWhile"],function(e,t){var n=t!=g,r=t==v;$n.prototype[e]=function(e,i){var s=this.__filtered__,o=s&&r?new $n(this):this.clone(),u=o.__iteratees__||(o.__iteratees__=[]);return u.push({done:!1,count:0,index:0,iteratee:Ui(e,i,1),limit:-1,type:t}),o.__filtered__=s||n,o}}),or(["drop","take"],function(e,t){var n=e+"While";$n.prototype[e]=function(n){var r=this.__filtered__,i=r&&!t?this.dropWhile():this.clone();n=n==null?1:Cn(hn(n)||0,0);if(r)t?i.__takeCount__=kn(i.__takeCount__,n):ks(i.__iteratees__).limit=n;else{var s=i.__views__||(i.__views__=[]);s.push({size:n,type:e+(i.__dir__<0?"Right":"")})}return i},$n.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()},$n.prototype[e+"RightWhile"]=function(e,t){return this.reverse()[n](e,t).reverse()}}),or(["first","last"],function(e,t){var n="take"+(t?"Right":"");$n.prototype[e]=function(){return this[n](1).value()[0]}}),or(["initial","rest"],function(e,t){var n="drop"+(t?"":"Right");$n.prototype[e]=function(){return this[n](1)}}),or(["pluck","where"],function(e,t){var n=t?"filter":"map",r=t?Wr:Jr;$n.prototype[e]=function(e){return this[n](r(e))}}),$n.prototype.compact=function(){return this.filter(Ea)},$n.prototype.reject=function(e,t){return e=Ui(e,t,1),this.filter(function(t){return!e(t)})},$n.prototype.slice=function(e,t){e=e==null?0:+e||0;var n=e<0?this.takeRight(-e):this.drop(e);return typeof t!="undefined"&&(t=+t||0,n=t<0?n.dropRight(-t):n.take(t-e)),n},$n.prototype.toArray=function(){return this.drop(0)},jr($n.prototype,function(e,t){var n=zn[t];if(!n)return;var r=/^(?:filter|map|reject)|While$/.test(t),i=/^(?:first|last)$/.test(t);zn.prototype[t]=function(){var t=arguments,s=t.length,o=this.__chain__,u=this.__wrapped__,a=!!this.__actions__.length,f=u instanceof $n,l=t[0],c=f||ru(u);c&&r&&typeof l=="function"&&l.length!=1&&(f=c=!1);var h=f&&!a;if(i&&!o)return h?e.call(u):n.call(zn,this.value());var p=function(e){var r=[e];return dn.apply(r,t),n.apply(zn,r)};if(c){var d=h?u:new $n(this),v=e.apply(d,t);if(!i&&(a||v.__actions__)){var m=v.__actions__||(v.__actions__=[]);m.push({func:Ks,args:[p],thisArg:zn})}return new Xn(v,o)}return this.thru(p)}}),or(["concat","join","pop","push","replace","shift","sort","splice","split","unshift"],function(e){var t=(/^(?:replace|split)$/.test(e)?Xt:Nt)[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=!Vn.spliceObjects&&/^(?:pop|shift|splice)$/.test(e),i=/^(?:join|pop|replace|shift)$/.test(e),s=r?function(){var e=t.apply(this,arguments);return this.length===0&&delete this[0],e}:t;zn.prototype[e]=function(){var e=arguments;return i&&!this.__chain__?s.apply(this.value(),e):this[n](function(t){return s.apply(t,e)})}}),jr($n.prototype,function(e,t){var n=zn[t];if(n){var r=n.name,i=qn[r]||(qn[r]=[]);i.push({name:t,func:n})}}),qn[Di(null,r).name]=[{name:"wrapper",func:null}],$n.prototype.clone=Jn,$n.prototype.reverse=Kn,$n.prototype.value=Qn,zn.prototype.chain=Qs,zn.prototype.commit=Gs,zn.prototype.plant=Ys,zn.prototype.reverse=Zs,zn.prototype.toString=eo,zn.prototype.run=zn.prototype.toJSON=zn.prototype.valueOf=zn.prototype.value=to,zn.prototype.collect=zn.prototype.map,zn.prototype.head=zn.prototype.first,zn.prototype.select=zn.prototype.filter,zn.prototype.tail=zn.prototype.rest,zn}var e,t="3.6.0",n=1,r=2,i=4,s=8,o=16,u=32,a=64,f=128,l=256,c=30,h="...",p=150,d=16,v=0,m=1,g=2,y="Expected a function",b="__lodash_placeholder__",w="[object Arguments]",E="[object Array]",S="[object Boolean]",x="[object Date]",T="[object Error]",N="[object Function]",C="[object Map]",k="[object Number]",L="[object Object]",A="[object RegExp]",O="[object Set]",M="[object String]",_="[object WeakMap]",D="[object ArrayBuffer]",P="[object Float32Array]",H="[object Float64Array]",B="[object Int8Array]",j="[object Int16Array]",F="[object Int32Array]",I="[object Uint8Array]",q="[object Uint8ClampedArray]",R="[object Uint16Array]",U="[object Uint32Array]",z=/\b__p \+= '';/g,W=/\b(__p \+=) '' \+/g,X=/(__e\(.*?\)|\b__t\)) \+\n'';/g,V=/&(?:amp|lt|gt|quot|#39|#96);/g,$=/[&<>"'`]/g,J=RegExp(V.source),K=RegExp($.source),Q=/<%-([\s\S]+?)%>/g,G=/<%([\s\S]+?)%>/g,Y=/<%=([\s\S]+?)%>/g,Z=/[\u0300-\u036f\ufe20-\ufe23]/g,et=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,tt=/\w*$/,nt=/^0[xX]/,rt=/^\[object .+?Constructor\]$/,it=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,st=/($^)/,ot=/[.*+?^${}()|[\]\/\\]/g,ut=RegExp(ot.source),at=/['\n\r\u2028\u2029\\]/g,ft=function(){var e="[A-Z\\xc0-\\xd6\\xd8-\\xde]",t="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(e+"+(?="+e+t+")|"+e+"?"+t+"|"+e+"+|[0-9]+","g")}(),lt=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",ct=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","document","isFinite","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","window"],ht=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],pt=-1,dt={};dt[P]=dt[H]=dt[B]=dt[j]=dt[F]=dt[I]=dt[q]=dt[R]=dt[U]=!0,dt[w]=dt[E]=dt[D]=dt[S]=dt[x]=dt[T]=dt[N]=dt[C]=dt[k]=dt[L]=dt[A]=dt[O]=dt[M]=dt[_]=!1;var vt={};vt[w]=vt[E]=vt[D]=vt[S]=vt[x]=vt[P]=vt[H]=vt[B]=vt[j]=vt[F]=vt[k]=vt[L]=vt[A]=vt[M]=vt[I]=vt[q]=vt[R]=vt[U]=!0,vt[T]=vt[N]=vt[C]=vt[O]=vt[_]=!1;var mt={leading:!1,maxWait:0,trailing:!1},gt={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},yt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},bt={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},wt={"function":!0,object:!0},Et={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},St=wt[typeof exports]&&exports&&!exports.nodeType&&exports,xt=wt[typeof module]&&module&&!module.nodeType&&module,Tt=St&&xt&&typeof global=="object"&&global,Nt=wt[typeof self]&&self&&self.Object&&self,Ct=wt[typeof window]&&window&&window.Object&&window,kt=xt&&xt.exports===St&&St,Lt=Tt||Ct!==(this&&this.window)&&Ct||Nt||this,zt=function(){try{Object({toString:0}+"")}catch(e){return function(){return!1}}return function(e){return typeof e.toString!="function"&&typeof (e+"")=="string"}}(),Yt=Gt();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Lt._=Yt,define("lodash-compat/index",[],function(){return Yt})):St&&xt?kt?(xt.exports=Yt)._=Yt:St._=Yt:Lt._=Yt}.call(this),define("lodash-compat",["lodash-compat/index"],function(e){return e}),function(e){typeof e=="undefined"&&(e={}),typeof e.performance=="undefined"&&(e.performance={}),e._perfRefForUserTimingPolyfill=e.performance,e.performance.userTimingJsNow=!1,e.performance.userTimingJsNowPrefixed=!1,e.performance.userTimingJsUserTiming=!1,e.performance.userTimingJsUserTimingPrefixed=!1,e.performance.userTimingJsPerformanceTimeline=!1,e.performance.userTimingJsPerformanceTimelinePrefixed=!1;var t=[],n=[],r=null,i,s;if(typeof e.performance.now!="function"){e.performance.userTimingJsNow=!0,n=["webkitNow","msNow","mozNow"];for(i=0;i<n.length;i++)if(typeof e.performance[n[i]]=="function"){e.performance.now=e.performance[n[i]],e.performance.userTimingJsNowPrefixed=!0;break}var o=+(new Date);e.performance.timing&&e.performance.timing.navigationStart&&(o=e.performance.timing.navigationStart),typeof e.performance.now!="function"&&(Date.now?e.performance.now=function(){return Date.now()-o}:e.performance.now=function(){return+(new Date)-o})}var u=function(){},a=function(){},f=[],l=!1,c=!1;if(typeof e.performance.getEntries!="function"||typeof e.performance.mark!="function"){typeof e.performance.getEntries=="function"&&typeof e.performance.mark!="function"&&(c=!0),e.performance.userTimingJsPerformanceTimeline=!0,t=["webkit","moz"],n=["getEntries","getEntriesByName","getEntriesByType"];for(i=0;i<n.length;i++)for(s=0;s<t.length;s++)r=t[s]+n[i].substr(0,1).toUpperCase()+n[i].substr(1),typeof e.performance[r]=="function"&&(e.performance[n[i]]=e.performance[r],e.performance.userTimingJsPerformanceTimelinePrefixed=!0);u=function(e){f.push(e),e.entryType==="measure"&&(l=!0)};var h=function(){if(!l)return;f.sort(function(e,t){return e.startTime-t.startTime}),l=!1};a=function(e,t){i=0;while(i<f.length){if(f[i].entryType!==e){i++;continue}if(typeof t!="undefined"&&f[i].name!==t){i++;continue}f.splice(i,1)}};if(typeof e.performance.getEntries!="function"||c){var p=e.performance.getEntries;e.performance.getEntries=function(){h();var t=f.slice(0);return c&&p&&(Array.prototype.push.apply(t,p.call(e.performance)),t.sort(function(e,t){return e.startTime-t.startTime})),t}}if(typeof e.performance.getEntriesByType!="function"||c){var d=e.performance.getEntriesByType;e.performance.getEntriesByType=function(t){if(typeof t=="undefined"||t!=="mark"&&t!=="measure")return c&&d?d.call(e.performance,t):[];t==="measure"&&h();var n=[];for(i=0;i<f.length;i++)f[i].entryType===t&&n.push(f[i]);return n}}if(typeof e.performance.getEntriesByName!="function"||c){var v=e.performance.getEntriesByName;e.performance.getEntriesByName=function(t,n){if(n&&n!=="mark"&&n!=="measure")return c&&v?v.call(e.performance,t,n):[];typeof n!="undefined"&&n==="measure"&&h();var r=[];for(i=0;i<f.length;i++){if(typeof n!="undefined"&&f[i].entryType!==n)continue;f[i].name===t&&r.push(f[i])}return c&&v&&(Array.prototype.push.apply(r,v.call(e.performance,t,n)),r.sort(function(e,t){return e.startTime-t.startTime})),r}}}if(typeof e.performance.mark!="function"){e.performance.userTimingJsUserTiming=!0,t=["webkit","moz","ms"],n=["mark","measure","clearMarks","clearMeasures"];for(i=0;i<n.length;i++)for(s=0;s<t.length;s++)r=t[s]+n[i].substr(0,1).toUpperCase()+n[i].substr(1),typeof e.performance[r]=="function"&&(e.performance[n[i]]=e.performance[r],e.performance.userTimingJsUserTimingPrefixed=!0);var m={};typeof e.performance.mark!="function"&&(e.performance.mark=function(t){var n=e.performance.now();if(typeof t=="undefined")throw new SyntaxError("Mark name must be specified");if(e.performance.timing&&t in e.performance.timing)throw new SyntaxError("Mark name is not allowed");m[t]||(m[t]=[]),m[t].push(n),u({entryType:"mark",name:t,startTime:n,duration:0})}),typeof e.performance.clearMarks!="function"&&(e.performance.clearMarks=function(e){e?m[e]=[]:m={},a("mark",e)}),typeof e.performance.measure!="function"&&(e.performance.measure=function(t,n,r){var i=e.performance.now();if(typeof t=="undefined")throw new SyntaxError("Measure must be specified");if(!n){u({entryType:"measure",name:t,startTime:0,duration:i});return}var s=0;if(e.performance.timing&&n in e.performance.timing){if(n!=="navigationStart"&&e.performance.timing[n]===0)throw new Error(n+" has a timing of 0");s=e.performance.timing[n]-e.performance.timing.navigationStart}else{if(!(n in m))throw new Error(n+" mark not found");s=m[n][m[n].length-1]}var o=i;if(r){o=0;if(e.performance.timing&&r in e.performance.timing){if(r!=="navigationStart"&&e.performance.timing[r]===0)throw new Error(r+" has a timing of 0");o=e.performance.timing[r]-e.performance.timing.navigationStart}else{if(!(r in m))throw new Error(r+" mark not found");o=m[r][m[r].length-1]}}var a=o-s;u({entryType:"measure",name:t,startTime:s,duration:a})}),typeof e.performance.clearMeasures!="function"&&(e.performance.clearMeasures=function(e){a("measure",e)})}typeof define!="undefined"&&define.amd?define("usertiming/src/usertiming",[],function(){return e.performance}):typeof module!="undefined"&&typeof module.exports!="undefined"&&(module.exports=e.performance)}(typeof window!="undefined"?window:undefined),define("usertiming",["usertiming/src/usertiming"],function(e){return e}),define("browser/window",[],function(){return window}),define("utils/common/version",["require","exports","module"],function(e,t){function n(e){function i(){if(!e){t=[n,n],r=!1;return}var i=o();i?(t=e.split(i),s()):(t=[e,n],r=!1)}function s(){var e=0;for(e=0;e<t.length;++e)if(!t[e]||isNaN(t[e])){t.push(n),r=!1;break}}function o(){return e.indexOf(".")>-1?".":e.indexOf("_")>-1?"_":null}var t,n="U",r=!0;i(),this.getMajor=function(){return t[0]},this.getMinor=function(){return t[1]},this.getAllComponents=function(){return t},this.getOriginalString=function(){return e},this.isValid=function(){return r},this.compareTo=function(e){var n=0,r=0,i=0,s=e.getAllComponents();if(!this.isValid()||!e.isValid())throw new Error("Invalid version cannot be compared");for(n=0;n<s.length;++n){r=parseInt(t[n],10),i=parseInt(s[n],10);if(!r||r<i)return-1;if(r>i)return 1}return 0}}t.parse=function(e){return new n(e)}}),define("browser/detect",["require","browser/window","utils/common/version"],function(e){function h(){return t.navigator.userAgent}function p(e){return h().indexOf(e)>-1}function d(){return p("Trident")}function v(){return p(r.EDGE)}function m(){return p("OPR/")}function g(){return m()?r.UNKNOWN:p(r.PHANTOMJS)?r.PHANTOMJS:v()?r.EDGE:p(r.ELECTRON)?r.ELECTRON:p(r.CHROME)?r.CHROME:p(r.FIREFOX)?r.FIREFOX:p(r.SAFARI)?r.SAFARI:p(r.SKYPE_SHELL)?r.SKYPE_SHELL:d()?r.MSIE:r.UNKNOWN}function y(){function e(){var e,t=h(),n=t.match(new RegExp(r.MSIE+" "+l));if(n)return n[1];e=t.match(new RegExp("rv:"+l));if(e)return e[1]}function t(e){var t;return e===r.SAFARI&&(e="Version"),t=h().match(new RegExp(e+"/"+l)),t?t[1]:a}return d()?e():t(g())}function b(){var e=/(android|ipod|windows phone|wpdesktop|windows ce|blackberry\w*|meego|webos|palm|symbian|pda|\w*?mobile\w*?|\w*?phone\w*?)/i,t=/tablet|ipad/i;return h().match(e)?s.MOBILE:h().match(t)?s.TABLET:s.DESKTOP}function w(){var e=/(windows|win32)/i,t=/ arm;/i,n=/windows\sphone\s\d+\.\d+/i,r=/(macintosh|mac os x)/i,s=/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i,o=/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|cros)/i,u=/android/i;return h().match(n)?i.WINDOWS_PHONE:h().match(t)?i.WINDOWS_RT:h().match(s)?i.IOS:h().match(u)?i.ANDROID:h().match(o)?i.LINUX:h().match(r)?i.MACOSX:h().match(e)?i.WINDOWS:i.UNKNOWN}function E(){function e(){var e=h().match(new RegExp("Windows NT "+l));return e&&o[e[1]]?o[e[1]]:a}function t(){var e=h().match(new RegExp(i.MACOSX+" "+c));return e?n.parse(e[1].replace(/_/g,".")).getMajor():a}return w()===i.WINDOWS?e():w()===i.MACOSX?t():a}function S(){return p("WOW64")||p("Win64")}function x(){return{width:t.screen&&t.screen.width||0,height:t.screen&&t.screen.height||0,pixelRatio:t.devicePixelRatio||0,colorDepth:t.screen&&t.screen.colorDepth||0,isTouchEnabled:Object.prototype.hasOwnProperty.call(t,"ontouchstart")||t.navigator.MaxTouchPoints>0||t.navigator.msMaxTouchPoints>0}}function T(){return{deviceType:b(),osName:w(),osVersion:E(),is64bit:S(),platform:t.navigator.platform}}function N(){return g()===r.MSIE&&C()?t.external.msIsSiteMode():"n/a"}function C(){return t.hasOwnProperty("external")&&t.external.hasOwnProperty("msIsSiteMode")}function k(){return g()===r.SKYPE_SHELL}function L(){return g()===r.ELECTRON}function A(){return(t.navigator.getUserMedia||t.navigator.mozGetUserMedia||t.navigator.webkitGetUserMedia)&&(typeof t.RTCPeerConnection!="undefined"||typeof t.RTCIceGatherer!="undefined"||typeof t.mozRTCPeerConnection!="undefined"||typeof t.webkitRTCPeerConnection!="undefined")}function O(){return A()}function M(){return g()===r.EDGE||g()===r.PHANTOMJS?!1:g()===r.CHROME&&P()>=f?!1:!0}function _(){var e=g();return e===r.FIREFOX||e===r.CHROME}function P(){var e=n.parse(y()).getMajor();return isNaN(e)?e:parseInt(e)}function H(e){return e in t.document.documentElement.style}var t=e("browser/window"),n=e("utils/common/version"),r={MSIE:"MSIE",CHROME:"Chrome",FIREFOX:"Firefox",SAFARI:"Safari",EDGE:"Edge",ELECTRON:"Electron",SKYPE_SHELL:"SkypeShell",PHANTOMJS:"PhantomJS",UNKNOWN:"Unknown"},i={WINDOWS:"Windows",MACOSX:"Mac OS X",WINDOWS_PHONE:"Windows Phone",WINDOWS_RT:"Windows RT",IOS:"iOS",ANDROID:"Android",LINUX:"Linux",UNKNOWN:"Unknown"},s={DESKTOP:1,MOBILE:2,TABLET:8},o={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},u={OBJECT_FIT:"objectFit"},a="U",f="42",l="([\\d,.]+)",c="([\\d,_,.]+)",D=function(){var e={};if(!t.location.search)return e;var n=t.location.search.substring(1).split("&");if(!n)return e;for(var r=0;r<n.length;r++){var i=n[r].split("=");if(!i[1])continue;e[i[0]]=i[1]||!0}return e};return{getBrowserInfo:function(){return{browserName:g(),browserVersion:y(),browserMajorVersion:P(),isPinnedSite:N(),isIeEngine:d(),isEdge:v(),isShellApp:k(),isElectron:L(),isInBrowserPluginSupported:M(),isPluginlessCallingSupported:O(),isBrowserDefaultToBlockPlugin:_(),getUrlParams:D,getUserAgent:h}},getScreenInfo:x,getSystemInfo:T,supportsCssProperty:H,supportsPinnedSites:C,BROWSERS:r,OPERATING_SYSTEMS:i,DEVICE_TYPES:s,CSS_PROPERTIES:u}}),define("constants/common",{storageKeys:{ENDPOINT_ID:"endpointId",PRESENCE_DATA:"presenceData",RESURECTION_KEY:"isResurected",RECENT_COUNTRY:"swx|recentCountry"},browserProperties:{DEFAULT:{HIDDEN:"hidden",VISIBILITY_CHANGE:"visibilitychange"},MS:{HIDDEN:"msHidden",VISIBILITY_CHANGE:"msvisibilitychange"},MOZ:{HIDDEN:"mozHidden",VISIBILITY_CHANGE:"mozvisibilitychange"},WEBKIT:{HIDDEN:"webkitHidden",VISIBILITY_CHANGE:"webkitvisibilitychange"}},permission:{DEFAULT:"default",GRANTED:"granted",DENIED:"denied"},events:{actions:{subscriptionCreation:"subscriptioncreation",getUserPresence:"getuserpresence",setUserPresence:"setuserpresence",getSelfProperties:"getselfproperties",messageSubmitted:"messagesubmitted"},auth:{SIGNIN_FAILED:"signInFailed",SIGN_OUT:"signOut"},callScreen:{CONTROLS_VISIBLE:"controlsVisible",VIDEO_STATE_CHANGED:"videoStateChanged",VIDEO_SIZE_CHANGED:"videoSizeChanged",SIDEBAR_TOGGLED:"sidebarToggled",VIDEO_ZOOMED_IN:"videoZoomedIn",TOGGLE_FULLSCREEN:"toggleFullscreen",TOGGLE_NARROW_MENU:"toggleNarrowMenu",BUTTON_FOCUSED:"buttonFocused",BUTTONS_WIDTH_CHANGED:"buttonsWidthChanged",ROSTER_WIDTH_CHANGED:"rosterWidthChanged",ADD_PARTICIPANT:"addParticipant",ADD_PARTICIPANT_VISIBLE:"addParticipantVisible",CALL_ESCALATED_TO_GROUP:"callEscalatedToGroup"},contacts:{CONTACTS_LOADED:"contactsLoaded",CONTACT_REQUEST_SENT:"contactRequestSent",CONTACT_REQUEST_ACCEPTED:"contactRequestAccepted",CONTACT_REQUEST_DECLINED:"contactRequestDeclined"},message:{RENDERED:"message:rendered",QUOTE:"message:quote",EDIT:"message:edit",AFTER_EXPANDED:"message:afterExpanded",BEFORE_EXPANDED:"message:beforeExpanded"},resourceTypes:{userPresence:"userpresence"},navigation:{OPEN_CONVERSATION:"navigate:conversation",NAVIGATE:"navigate:navigate",NAVIGATE_TO_PREVIOUS_PAGE:"navigate:previousPage",COMPONENT_RENDERED:"component:rendered",FRAGMENT_SHOW:"fragment:show",FRAGMENT_HIDE:"fragment:hide",FRAGMENT_BEFORE_SHOW:"fragment:beforeShow",FRAGMENT_BEFORE_HIDE:"fragment:beforeHide",FRAGMENT_LOADED:"fragment:loaded",FRAGMENT_REMOVE:"fragment:remove",FRAGMENT_REMOVE_ALL_HIDDEN:"fragment:removeAllHidden",LEAVE_EDIT_MODE:"leave:edit:mode",NOTIFICATIONS_CENTER:"navigate:notificationsCenter"},search:{QUERY_CHANGED:"search",QUERY_EXECUTED:"searchFinished",RESET:"reset",DIRECTORY_SEARCH_RESULTS:"search:directory:results",DIRECTORY_SEARCH_RESULTS_RENDERED:"search:directory:results:rendered",DIRECTORY_SEARCH_ACTIVATED:"search:directory:activated",DIRECTORY_SEARCH_DEACTIVATED:"search:directory:deactivated",GROUPS_SEARCH_RESULTS:"search:groups:results",LOCAL_SEARCH_RESULTS:"search:local:results",LOCAL_SEARCH_RESULTS_RENDERED:"search:local:results:rendered",INPUT_FOCUS:"searchInput:focus",INPUT_BLUR:"searchInput:blur"},roster:{ROSTER_QUERY_CHANGED:"roster:participants:search",ROSTER_QUERY_EXECUTED:"roster:participants:searchFinished",ROSTER_SELECTION_REMOVED:"roster:selection:removed",PICKER_CONTACT_SELECTED:"people:picker:selected",PICKER_CONTACT_DESELECTED:"people:picker:deselected",EDIT_ROSTER_MODE:"roster:editRosterMode"},conversation:{JOINING_ENABLED:"conversation:joining:enabled",OPEN_PROFILE:"conversation:open:profile",CLOSE_PROFILE:"conversation:close:profile",COPY_LINK:"conversation:copy:link",EMAIL_LINK:"conversation:mail:link",SHARED:"conversation:shared",MARK_AS_READ:"conversation:mark:read",VIEWPORT_CHANGED:"conversation:viewport:changed",MESSAGES_LOADED:"conversation:messages:loaded",OVERLAY_CLOSED:"conversation:overlay:closed"},expressionPicker:{ITEM_PREVIEW_REQUEST:"pes:picker:previewRequest",ITEM_SELECT_REQUEST:"pes:picker:selectRequest",ITEM_SEND_REQUEST:"pes:picker:sendRequest",ITEM_CANCEL_REQUEST:"pes:picker:cancelRequest",TAB_SELECT_REQUEST:"pes:tabs:selectRequest",CLOSE_REQUEST:"pes:picker:close",OPEN_REQUEST:"pes:picker:open",MRUITEM_ADD_REQUEST:"pes:mruitem:addRequest",MRUITEM_ADD_EMOTICON_REQUEST:"pes:mruitem:addEmoticonRequest"},textarea:{SUBMIT_AND_FOCUS:"textarea:submitAndFocus",CHANGED:"textarea:changed",KEY_DOWN:"textarea:keyDown",KEY_PRESS:"textarea:keyPress",INPUT:"textarea:input",HAS_INPUT:"textarea:hasInput",INITIALIZATION_COMPLETE:"textarea:initializationComplete",SET_ATTRIBUTION:"textarea:setAttribution"},chatInput:{INITIALIZATION_COMPLETE:"chatInput:initializationComplete"},emoticonPicker:{EMOTICON_SELECTED:"emoticon:selected",CLOSE:"emoticon:close"},errors:{SERVICE_FAILURE:"serviceFailure"},system:{EXPERIENCE_INITIALIZED:"experienceInitialized",EXPERIENCE_READY:"experienceReady",BUTTON_CLICK:"buttonClick",FORCE_RESYNC:"webapi:forceResync",ONLINE_STATE_CHANGED:"webapi:onlineStateChanged",DATE_CHANGED:"dateChanged"},trouter:{CONTACTLIST_CHANGE:6,OFFLINE_AUTHREQUEST:14,INCOMING_CALL:100,INCOMING_SKYPE_NGC_CALL:107,INCOMING_SKYPE_NGC_GVC_CALL:109,INCOMING_LYNC_NGC_CALL:105,INCOMING_STOP_RINGER:104,INCOMING_SKYPE_NGC_STOP_RINGER:110,USER_SERVICES_CHANGE:601},newConversation:{CONFIRMED:"newConversation:confirmed",CANCELLED:"newConversation:cancelled"},narrowMode:{SIDEBAR_STATE_CHANGED:"narrowMode:sidebarStateChanged",SHOW_SIDEBAR:"narrowMode:showSidebar",HIDE_SIDEBAR:"narrowMode:hideSidebar",SIDEBAR_TRANSITION_ENDED:"narrowMode:sidebarTransitionEnded"},interaction:{SCROLL_START:"interaction:scrollStart"},browser:{CLICK:"click",RESIZE:"resize",SCROLL:"scroll",FOCUS:"focus",BLUR:"blur",KEYDOWN:"keydown",MOUSEMOVE:"mousemove",MOUSEDOWN:"mousedown",BEFOREUNLOAD:"beforeunload",VISIBILITYCHANGE:"visibilitychange",TRANSITIONEND:"transitionend",MESSAGE:"message",CONTEXTMENU:"contextmenu"},personalExpression:{CONFIG_INITIALIZED:"pes:configInitialized",CONFIG_PROCESSED:"pes:configProcessed",CDN_TOKEN_UPDATED:"pes:cdnTokenUpdated",store:{LOAD_PACKS:"pesStore:loadPacks",PACK_PURCHASED:"pesStore:packPurchased"}},mediaPicker:{CLOSE_PICKER:"mediaPicker:closePicker",FILE_PICKER_SELECTED:"mediaPicker:filePickerSelected",SEND_CONTACTS_SELECTED:"mediaPicker:sendContactsSelected",POLL_BUTTON_SELECTED:"mediaPicker:pollButtonSelected"},shareControl:{SHARE_CONTROL_SHOW:"shareControl:show",SHARE_CONTROL_HIDE:"shareControl:hide"},skypeOut:{DIAL_BUTTON_CLICKED:"skypeOut:dialButtonClicked",INPUT_CHANGED:"skypeOut:inputChanged",INPUT_TYPE_TOUCH:"touch",INPUT_TYPE_MOUSE:"mouse",INPUT_TYPE_KEYBOARD:"keyboard"},selectBox:{TOGGLE:"selectBox:toggle"},userListPopup:{POPUP_TOGGLE:"userListPopup:toggle"},videoPlayer:{FULLSCREEN_ON:"videoPlayer:fullscreenOn",FULLSCREEN_OFF:"videoPlayer:fullscreenOff"},me:{PRESENCE_POPUP_SHOW:"presencePopup:show"},flags:{SET_FLAG:"setFlag"}},styleMode:{breakpoint:{NARROW:420,MEDIUM:600,WIDE:800},NARROW:"style:narrow",MEDIUM:"style:medium",WIDE:"style:wide"},notifications:{ERROR:"shellError",SUCCESS:"shellSuccess",WARNING:"shellWarning",INCOMING_CALL:"incomingCall",INCOMING_CALL_WITH_NO_PLUGIN:"incomingCallWithNoPlugin",INCOMING_CALL_BROWSER_NOT_SUPPORTED:"incomingCallBrowserNotSupported",INCOMING_CALL_OS_NOT_SUPPORTED:"incomingCallOsrNotSupported",DEVICE_MISSING_CAMERA:"cameraMissing",DEVICE_MISSING_MICROPHONE:"microphoneMissing",DEVICE_MISSING_SPEAKER:"speakerMissing",UNREAD_MESSAGE:"UnreadMessage",CONTACT_REQUEST:"ContactRequest",SIGN_IN_REQUEST:"SignInRequest",CHAT:"Chat",AUDIO:"Audio",AUDIO_CALL:"AudioCall",AVATAR_NOT_SUPPORTED_IMAGE_TYPE:"AvatarNotSupportedImageType",AVATAR_UPLOAD_ERROR:"AvatarUploadError"},serviceLocator:{FEATURE_FLAGS:"featureFlagApi",CONTROLS_BUILDER:"controlsBuilder",NAVIGATION_CONTEXT:"navigation",PUBSUB:"pubSub",MODEL_UI_OBSERVER:"webClientModelObserver",SPLASH_SCREEN:"spashScreen",SUBSCRIPTION_PROVIDER:"subscriptionProvider",ACTION_TELEMETRY:"actionTelemetry",PES_MRU_SERVICE:"pesMRUService",PES_BING_SEARCH_SERVICE:"pesBingSearchService",PES_GIPHY_SEARCH_SERVICE:"pesGiphySearchService",URL_PREVIEW_SERVICE:"urlPreviewService",PES_CONFIG_SERVICE:"pesConfigService",PES_2_CONFIG_SERVICE:"pesConfigService:v2",PES_2_MRU_SERVICE:"pesMRUService:v2",PES_STORE_SERVICE:"pesStoreService",PROGRESSIVE_TIMEOUT:"progressiveTimeout"},userOptions:{pluginAutoUpdateOptOutOption:"OPT_WEB_OPTOUT_AUTOUPDATE"},msnpErrors:{nonExistingConverstion:730,redirectionOverride:752,missingEndpoint:729},callingErrors:{AUTO_CALL_FAILED:"AUTO_CALL_FAILED"},httpStatusCodes:{OK:200,created:201,badRequest:400,unauthorized:401,notFound:404,forbidden:403,preconditionFailed:412,unprocessableEntity:422,internalServerError:500},onlineStates:{ONLINE:"state:online",OFFLINE:"state:offline"},translatorServiceState:{NotReady:"NotReady",Authenticated:"Authenticated",Error:"Error"},isTyping:{THROTTLE:5e3,EXPIRY:7e3,DETAILED_PARTICIPANTS_MAX_COUNT:2,MESSAGE_TYPE:{SET_TYPING:"Control/Typing",CLEAR_TYPING:"Control/ClearTyping"}},activityItemGroups:{PARTICIPANT:"participant",TEXT:"text",CALL:"live-session",NGC_UPGRADE:"ngc-upgrade",PLUGIN_FREE:"plugin-free",MEDIA:"media",CONTACT_REQUEST:"contact-request",MOJI:"moji",CONTACT_INFO:"contact-info",TRANSACTION:"transaction",POLL:"poll",PSTN:"pstn",CUSTOM:"custom"},customActivityItemTemplates:{SPACES_WELCOME_MESSAGE:"spacesWelcomeMessage"},featureFlags:{AGENTS_ENABLED:"agentsEnabled",AGENTS_DISCOVERABLE:"agentsDiscoverable",CONTACTS_SERVICE_V2:"contactsServiceV2",SHOW_AGENT_RATING_ON_PROFILE:"showAgentRatingOnProfile",URL_OVERRIDE_ENABLED:"urlOverrideEnabled",CONTACTLIST_CHANGE_NOTIFICATION:"contactListChangeNotification",SHOW_SPLASH_SCREEN:"showSplashScreen",BLOCK_CONTACT:"blockContact",DEACTIVATE_CACHE:"deactivateCache",HAS_TIMELINE_BADGE:"hasTimelineBadge",HAS_BETA_LABEL:"hasBetaLabel",HAS_FEEDBACK_LINK:"hasFeedbackLink",HAS_FEEDBACK_LINK_ON_ERROR:"hasFeedbackLinkOnError",HAS_FEEDBACK_ICON:"hasFeedbackIcon",DISABLE_KES:"disableKes",SKYPE_DIRECTORY_SEARCH:"skypeDirectorySearch",MUTE_NOTIFICATIONS:"muteNotifications",LAST_SEEN:"lastSeen",MOBILE_INDICATOR:"mobileIndicator",MOBILE_ACTIVE:"mobileActive",NEW_CONVERSATION_V2:"newConversationV2",SPACES:"spaces",SHOW_SPACES_WELCOME_MESSAGE:"showSpacesWelcomeMessage",SHOW_CONTACTS_PAGE_HINT:"showContactsPageHint",SHOW_CONTACTS_PAGE_INFORMATIONAL_MESSAGE:"showContactsPageInformationalMessage",INCOMING_SCREEN_SHARING:"incomingScreenSharing",OUTGOING_SCREEN_SHARING:"outgoingScreenSharing",INCOMING_WIKI_MARKUP:"incomingWikiMarkup",MESSAGE_ENFORCE_TEXT_FORMAT:"messageEnforceTextFormat",PHOTO_SHARING_ENABLED:"photoSharingEnabled",DELETE_CONTACT_USING_CONTACTS_SERVICE:"deleteContactUsingContactsService",SPACE_TOPIC_EDITOR:"spaceTopicEditor",HEADER_CONTROLS_DISABLED:"headerControlsDisabled",HIDE_SIDEBAR_ON_START:"hideSidebarOnStart",SINGLE_CONVERSATION_MODE:"singleConversationMode",DISABLE_POLLING_ON_KAHUNA:"disablePollingOnKahuna",ENABLE_RAW_EMOTICONS_RENDERING:"enableRawEmoticonsRendering",CONTENT_SEARCH:"contentSearch",SWIFT_CARD_COMMAND:"swiftCardCommand",SWIFT_CARD_RENDERING:"swiftCardRendering",UNREAD_MSG_LOGGING:"enableUnreadMessagesLogging",SEND_SKYPE_INITIATING_USERNAME:"sendSkypeInitiatingUsername",SHOW_MESSAGE_DELIVERY_INDICATOR_SW4B:"showMessageDeliveryIndicator",SHOW_MESSAGE_DELIVERY_STATUS:"showMessageDeliveryStatus",HIDE_EMOTICON_PICKER_BUTTON:"hideEmoticonPickerButton",IS_TYPING_INDICATOR:"isTypingIndicator",SERVICE_FAILURE_REPORTING:"serviceFailureReporting",CALLING:"calling",INCLUDE_SELF_IN_PARTICIPANTS_COUNT:"includeSelfInParticipantsCount",HIDE_USER_ROLE:"hideUserRole",SHOW_ALTERNATE_SHARE_DIALOG_EXPERIENCE:"showAlternateShareDialogExperience",IS_FLIK_MESSAGE_ENABLED:"isFlikMessageEnabled",PES_CDN_AUTH_ENABLED:"pesCDNAuthEnabled",PINNING_TO_DOGFOOD_CLOUD:"pinningToDogfoodCloud",NOTIFICATIONS_CENTER:"notificationsCenter",POLLS_ENABLED:"pollsEnabled",SUPPORT_MESSAGE_PROPERTIES:"supportMessageProperties",ENABLE_PING_ECS_CONFIG:"enablePingEcsConfig",ENABLE_ENDPOINT_ECS_CONFIG:"enableEndpointEcsConfig",SUPPORT_STANDBY_MODE:"supportStandbyMode",MENTIONS_ENABLED:"mentionsEnabled",ALTERNATIVE_SIDEBAR_LAYOUT_ENABLED:"alternativeSidebarLayout",CONTEXT_MENU_QUOTE_MESSAGES_ENABLED:"contextMenuQuoteMessagesEnabled",CONTEXT_MENU_SAVE_VIDEO_MESSAGES_ENABLED:"contextMenuSaveVideoMessagesEnabled",SHOW_CONTACTS_PAGE_SIGN_IN:"showContactsPageSignIn",HIDE_CONVERSATION_HEADER:"hideConversationHeader",SKIP_CHAT_CAPABILITY_CHECK:"skipChatCapabilityCheck",DISABLE_PERSISTENT_CONTACT_PRESENCE_SUBSCRIPTION:"disablePersistentContactPresenceSubscription",ENABLE_BUSINESS_CONTACT_MANAGEMENT:"enableBusinessContactManagement",URL_PREVIEWS:"urlPreviews",SILENT_LINKING:"silentLinking",REMOVE_CONVERSATION_HISTORY:"removeConversationHistory",DISABLE_LEAVE_CONVERSATION:"disableLeaveConversation",PES_CDN_AUTH_URL_FALLBACK_ENABLED:"pesCDNAuthUrlFallbackEnabled",PES_FETCH_SMALL_ASSETS_ON_DEMAND:"pesFetchSmallAssetsOnDemand",PES_FETCH_MEDIUM_ASSETS_ON_DEMAND:"pesFetchMediumAssetsOnDemand",PES_FETCH_LARGE_ASSETS_ON_DEMAND:"pesFetchLargeAssetsOnDemand",PES_FETCH_MOJI_ASSETS_ON_DEMAND:"pesFetchMojiAssetsOnDemand",PES_USE_EXTRA_LARGE_EMOTICONS:"pesUseExtraLargeEmoticons",PES_BING_IMAGE_SEARCH_ENABLED:"pesBingImageSearchEnabled",PES_GIPHY_IMAGE_SEARCH_ENABLED:"pesGiphyImageSearchEnabled",PES_LOCAL_SEARCH_ENABLED:"pesLocalSearchEnabled",PES_V2_ENABLED:"pesV2Enabled",EMOTICON_SUGGESTION_ENABLED:"emoticonSuggestionEnabled",EMOTICON_IMPLICIT_SUGGESTION_DISABLED:"emoticonImplicitSuggestionDisabled",SUGGEST_HIDDEN_EMOTICONS:"suggestHiddenEmoticons",PES_STORE_ENABLED:"pesStoreEnabled",YOUTUBE_PLAYER_ENABLED:"youtubePlayer",FILE_DRAG_DROP_ENABLED:"fileDragDropEnabled",FILE_PASTE_ENABLED:"filePasteEnabled",USE_BUSINESS_WORDING:"useBusinessWording",ENABLE_BUSINESS_PRESENCE_MAPPING:"enableBusinessPresenceMapping",FILE_TRANSFER_ENABLED:"fileTransferEnabled",CONTEXT_MENU_LIKE_MESSAGES_ENABLED:"contextMenuLikeMessagesEnabled",SHOW_DEFAULT_AVATAR_IN_NOTIFICATIONS:"showDefaultAvatarInNotifications",MEDIA_BAR_ENABLED:"mediaBarEnabled",SHOW_SEARCH_QUERY_MORE_RESULTS_AVAILABLE:"showSearchQueryMoreResultsAvailable",PSTN_ENABLED:"PSTN",CQF_ENABLED:"CQF",CONSOLE_LOGGING:"consoleLogging",ISSUE_REPORTING:"issueReporting",CALL_INFO_COMMAND:"callInfoCommand",ERROR_LOG_REPORTING:"errorLogReporting",AGGRESSIVE_IMPLICT_MENTIONS_MATCHING:"aggressiveImplicitMentionsMatching",ENABLE_AGGRESSIVE_MENTIONS_TOAST:"enableAggressiveMentionsToast",SEND_CONTACT_CARD_ENABLED:"sendContactCardEnabled",NOTIFY_HOST_EVEN_WHEN_ME_NOTAVAILABLE:"notifyHostEvenWhenMeNotAvailable",HEARTS_ENABLED:"heartsEnabled",HEARTS_NOTIFICATION_ENABLED:"heartsNotificationEnabled",SHOW_CHAT_INTRO_TEXT:"showChatIntroText",TRANSLATOR_SENDING_ENABLED:"translatorSendingEnabled",RE_AUTH_ENABLED:"reAuthEnabled",CONTACT_CARD_RENDERING_ENABLED:"contactCardRenderingEnabled",NEW_URLP_DOMAIN_ENABLED:"newUrlPreviewDomainEnabled",IS_CLOUD_VIDEO_MESSAGE_ENABLED:"isCloudVideoMessageEnabled",CREDIT_GIFTING:"creditGifting",AUTO_CALLING:"autoCalling",GVC_ESCALATION:"GVCEscalation",GVC_LOCAL_ESCALATION:"GVCLocalEscalation",GVC_JOINING:"GVCJoining",GVC_OUTGOING:"GVCOutgoing",PERSISTENT_PLUGIN:"persistentPlugin",PERSISTENT_SHELL_APP:"persistentShellApp",PLUGINLESS_CALLING_CHROME:"pluginlessCallingChrome",PLUGINLESS_CALLING_CHROME_LINUX:"pluginlessCallingChromeLinux",PLUGINLESS_CALLING_EDGE:"pluginlessCallingEdge",PLUGINLESS_CALLING_FIREFOX:"pluginlessCallingFirefox",PLUGINLESS_CALLING_ELECTRON:"pluginlessCallingElectron",PRELOAD_PLUGIN:"preloadPlugin",PRELOAD_SHELL_APP:"preloadShellApp",NG_CALLING:"NGCalling",FAIL_INITIALIZATION_FOR_IE_AND_EDGE:"failInitializationOnIE",SHELL_APP_LOGS:"shellAppLogs",INVITE_FREE:"inviteFree",INVITE_FREE_IMPLICIT_INCOMING_CONTACT_REQUEST:"inviteFreeImplicitIncomingContactRequest",SHORT_CIRCUIT:"shortCircuit",USER_SETTINGS_ENABLED:"userSettingsEnabled",SHOW_UNLISTED_SETTINGS:"showUnlistedSettings",ABOUT_PAGE_ENABLED:"aboutPageEnabled",LOCATION_MESSAGE_SUPPORT:"locationMessageSupport",READ_RECEIPT_ENABLED:"readReceiptEnabled",URL_PREVIEW_LOAD_YOUTUBE_PLAYER:"urlPreviewLoadYoutubePlayer",SEARCH_EDUCATION_BUBBLE:"searchEducationBubble",SEARCH_EDUCATION_BUBBLE_BUSINESS:"searchEducationBubbleBusiness",CHAT_EDUCATION_BUBBLE:"chatEducationBubble",CHAT_EDUCATION_BUBBLE_BUSINESS:"chatEducationBubbleBusiness",CALL_EDUCATION_BUBBLE:"callEducationBubble",SCHEDULE_CALL_EDUCATION_BUBBLE_1:"scheduleCallEducationBubble1",SCHEDULE_CALL_EDUCATION_BUBBLE_2:"scheduleCallEducationBubble2",WELCOME_DIALOG:"welcomeDialog",TELEMETRY_SEARCH_ENABLED:"telemetrySearchEnabled",TELEMETRY_UIACTIONPERF_ENABLED:"uiActionPerfTelemetryEnabled",TELEMETRY_RUNTIME_ERRORS_ENABLED:"runtimeErrorsTelemetryEnabled",DO_NOT_SEND_CONTACTS_TO_CHAT_SERVICE:"doNotSendContactsToChatService",CONTACT_PROFILE_CACHE:"contactProfileCache",PRESENCE_DATA_CACHE:"presenceDataCache",SCHEDULE_CALL_FROM_CONVERSATION:"scheduleCallFromConversation",USE_LEGACY_SCHEDULER_URI_FORMAT:"useLegacySchedulerUriFormat",DIRECTORY_SEARCH_SKYPE_AND_LYNC:"directorySearchSkypeAndLync",CONTACT_PROFILE:"contactProfile",GIPHY:"giphy",SKYPE_CALL_POLICY_SUPPORT:"skypeCallPolicySupport",SKYPE_VIDEO_CALLING_POLICY_SUPPORT:"skypeVideoCallingPolicySupport",SHORT_CIRCUIT_SUPPORT:"shortCircuit",NEW_SELF_PRESENCE:"newSelfPresence",BATCH_PROFILES_V2:"batchProfilesV2",CONTACT_PAGE_FILTER_TABS:"contactPageFilterTabs",USE_AZURE_BASED_SILENT_LOGIN:"useAzureBasedSilentLogin",KEY_ENCRYPTION_SERVICE_V2_ENABLED:"keyEncryptionServiceV2Enabled",NAVIGATION_MENU_ICONS_ENABLED:"navigationMenuIconsEnabled",FAVORITES_CONVERSATION_ENABLED:"favoritesConversationsEnabled",SYNC_THREAD_BEFORE_JOIN_CONVERSATION_FLOW_ENABLED:"syncThreadBeforeJoinConversationEnabled"},autoCallingMode:{call:"Call",join:"Join",golive:"GoLive"},autoCallingThreadId:"autoCallingThreadId",capabilities:{chat:"im.receive",audio:"audio.receive",video:"video.receive",screenSharing:"screen_share",groupAdd:"group.add"},modalityType:{CHAT:"Chat",AUDIO:"Audio",VIDEO:"Video",SCREENSHARING:"ScreenSharing",DATACOLLABORATION:"DataCollaboration"},apiUIEvents:{SWX_TIMELINE_LOADED:"swx:timeline:loaded",SWX_CONTENT_LOADED:"swx:content:loaded",SWX_SPLASHSCREEN_LOADED:"swx:splashscreen:loaded",SWX_CALLSCREEN_MAXIMIZE:"swx:callscreen:maximize",SWX_ON_SIGN_OUT:"swx:on:sign:out",SWX_SINGLE_CONVERSATION:"swx:single:conversation"},chat:{messageType:{OUTGOING:"Outgoing",INCOMING:"Incoming"}},telemetry:{APP_SOURCE_NAME:"SWX",uiActions:{TYPE:"ui_action"},runtimeErrors:{TYPE:"runtime_error"},calling:{MASTER_EVENT:"calling",CALL_INFO:"CallInfo",START_CALL:"StartCall",END_CALL:"EndCall",RINGING_CALL:"RingingCall",CONNECTED_CALL:"ConnectedCall",UNKNOWN_CONTACT_TYPE:"unknown",PARTICIPANTS_COUNT_PREFIX:"participantsCount_",direction:{OUTGOING:"Outgoing call",INCOMING:"Incoming call"},P2P_TO_NGC_NOTIFICATION_DURATION:"P2PtoNGCNotificationDuration",callType:{S2S:"S2S",SkypeOut:"SkypeOut",SkypeIn:"SkypeIn"},AVAILABLE:"Available",UNAVAILABLE:"Unavailable",NA:"N/A"},callQualityFeedback:{MASTER_EVENT:"callQualityFeedback",CANCEL_SCORE:3,NA:"N/A",PROBLEM_TOKEN_PREFIX:"checks=",reason:{CANCEL:"cancel",RANDOM:"random"}},autoCalling:{MASTER_EVENT:"autoCalling",SERVICE_FAILURE:"serviceFailure",AUTO_CALL_ENDED:"autoCallEnded",AUTO_CALL_PAYLOAD_INVALID:"autoCallPayloadInvalid",AUTO_CALL_HANDLING_ERROR:"autoCallHandlingError",HOST_JOINED:"hostJoined",PARTICIPANT_JOINED:"participantJoined",ATTEMPT_TO_JOIN:"attemptToJoin"},chat:{UI_SEND_MESSAGE:"ui_sendMessage",UI_EDIT_MESSAGE:"ui_editMessage",FILE_TRANSFER:"file_transfer",VIDEO_MESSAGE:{TYPE:"video_message",action:{FIRST_PLAY:"firstPlay",PLAY:"play",FULLSCREEN:"fullscreen",SEEK:"seeking",REPLAY:"replay"},eventName:{LOADED:"loaded"}}},contacts:{type:{CONTACTS:"Contacts",CONTACT_REQUESTS:"ContactRequests"},name:{GET_CONTACT_LIST:"GetContactList",GET_CONTACT_LIST_DELTA:"GetContactListDelta",CONTACT_REQUEST_READ:"ContactRequestRead",CONTACT_REQUEST_ACCEPTED:"AcceptContact",CONTACT_REQUEST_DECLINED:"DeclineContact",CONTACT_BLOCKED:"ContactBlocked",CONTACT_UNBLOCKED:"ContactUnblocked",CONTACT_DELETED:"ContactDeleted",GET_PROFILES:"GetProfiles",ADD_CONTACT:"AddContact",CONTACTS_PAGE_PERFORMANCE:"ContactsPagePerformance",DISCOVER_AGENTS_PAGE_PERFORMANCE:"DiscoverAgentsPagePerformance",PROFILE_OPENED:"contact_profile_opened"},shortCircuit:{START:"log_sc_start",FINISHED:"log_sc_finished"}},agents:{type:{AGENTS:"Agents"},name:{DISCOVER_AGENTS_PAGE_PERFORMANCE:"DiscoverAgentsPagePerformance"}},pes:{eventName:{MOJI_SENT:"moji_sent",MOJI_PLAYED:"moji_played",EMO_SENT:"emo_sent",IMAGE_SENT:"image_sent"},section:{FEATURED:"FEATURED",REGULAR:"REGULAR"},source:{TYPED:"TYPED",ROSTER:"ROSTER",RECENTS:"RECENTS"},UNKNOWN:"N/A"},presence:{TYPE:"Presence",name:{SET_ME_PRESENCE:"SetMePresence",GET_CONTACTS_PRESENCE:"GetContactsPresence"}},search:{TYPE:"Search"},promiseInvalidStateException:{TYPE:"PromiseInvalidStateException",feature:{GROUP_SEARCH:"GroupSearch",CONTACT_PICKER:"ContactPicker",PEOPLE_SEARCH:"PeopleSearch"}},NOT_AVAILABLE:"n/a",trouter:{NEW_CONNECTION:"newConnection",ENDPOINT_REGISTRATION_FAILED:"endpointRegistrationFailed",TROUTER_READY_TIMEOUT:"trouterReadyTimeout",TROUTER_READY_EVENT:"trouterReadyEvent",TROUTER_AUTH_EVENT:"trouterAuthEvent",RENEWAL:"renewal",AUTHENTICATION_FAILED:"authenticationFailed",AUTHENTICATION_SUCCEEDED:"authenticationSucceeded",TROUTER_RECONNECTING:"trouterReconnecting",TROUTER_INIT:"trouterinit"},conversationJoined:{TYPE:"weblauncher_join",result:{SIGNED_IN:"signed_in",SIGNED_OUT:"signed_out",SUCCESS:"success",INCONCLUSIVE:"inconclusive"},milestoneType:{CLIENT_INIT:"client_init",ERROR:"error",END:"end"}},guestActionsInHeader:{TYPE:"chat_guest_headerActions",cta:{PROFILE_TOGGLED:"profileToggled",COPY_LINK:"copyLink",EMAIL_LINK:"emailLink"},telemetryItem:{AVATAR:"telemetryItemAvatar",TOPIC:"telemetryItemTopic",CHEVRON_DOWN:"telemetryItemChevronDown",CHEVRON_UP:"telemetryItemChevronUp"},parent:{GROUP_PROFILE_VIEW_MODEL:"GroupProfileViewModel",HEADER_VIEW_MODEL:"HeaderViewModel"}},removeConversationHistory:{TYPE:"swx_conversation_removeHistory",cta:{TIMELINE_MENU:"timeline",PROFILE:"profile"},action:{CANCELED:"canceled",CONFIRMED:"confirmed"}},leaveConversation:{TYPE:"swx_conversation_leave",cta:{TIMELINE_MENU:"timeline",PROFILE:"profile"},action:{CANCELED:"canceled",CONFIRMED:"confirmed"}},sendContacts:{TYPE:"message_contactInfo_send",cta:{MEDIABAR:"mediabar"},action:{CANCELED:"canceled",CONFIRMED:"confirmed"}},urlPreviewShown:{TYPE:"message_urlpreview_show"},urlPreviewClicked:{TYPE:"message_urlpreview_action"},contactInfo:{TYPE:"message_contactinfo_receive",action:{SHOW:"showed",CLICK:"clicked"}},menuItemClicked:{TYPE:"menu_item_clicked"},messageSent:{TYPE:"kpi_message_sent"},mediaBarEvent:{TYPE:"media_bar_event"},timelineLoadEvent:{TYPE:"chat_timeline_load"},conversationHistoryLoadEvent:{TYPE:"chat_conversation_historyLoad"},splashScreenEvent:{TYPE:"experience_load_times"},notificationActionsEvent:{TYPE:"notificationActions",action:{accept:"accept",decline:"decline",open:"open"}},translator:{eventType:{OUTGOING:"translator_message_outgoing",INCOMING:"translator_message_incoming",SETTINGS_SHOW:"translator_settings_show",SETTINGS_HIDE:"translator_settings_hide",SETTINGS_BUTTON_ENABLED:"translator_settings_button_enabled",ME_LANGUAGE_CHANGED:"translator_me_language_changed",PARTICIPANT_LANGUAGE_CHANGED:"translator_participant_language_changed"},action:{CLICK_SEE_ORIGINAL:"click_see_original",CLICK_SEE_TRANSLATION:"click_see_translation",TRANSLATE:"translate",RETRANSLATE:"re-translate",SHOW:"show"},initiator:{ESCAPE_KEY:"escape_key",CLICK_GLOBE_BUTTON:"click_globe_button"}},performanceMarks:{EXPERIENCE:{INIT_START:"swx_timeline_initStart",INIT_END_OK:"swx_timeline_initEnd_ok",INIT_END_404:"swx_timeline_initEnd_404",INIT_END_ERROR:"swx_timeline_initEnd_err",TTL_START:"swx_experience_ttl_start",CONTENT_INIT:"swx_content_initStart"},TIMELINE:{RENDER_END:"swx_timeline_renderEnd",SYNC_START:"swx_timeline_syncStart",SYNC_END_OK:"swx_timeline_syncEnd_ok",SYNC_END_404:"swx_timeline_syncEnd_404",SYNC_END_ERROR:"swx_timeline_syncEnd_err"},CONVERSATION:{TTP:"swx_conversation_ttp"},NEW_CONVERSATION:{FLOW_START:"swx_newConversation_flowStart",CREATION_START:"swx_newConversation_creationStart",CREATION_END_OK:"swx_newConversation_creationEnd_ok",CREATION_END_404:"swx_newConversation_creationEnd_404",CREATION_END_ERROR:"swx_newConversation_creationEnd_err",RENDER_END:"swx_newConversation_renderEnd"},CONVERSATION_UPDATE:{UPDATE_START:"swx_conversationupdate_start",UPDATE_END:"swx_conversationupdate_end",SYNC_END:"swx_conversationupdate_syncEnd"},IM_SEND:{POST_START:"swx_imSend_postStart",POST_END_OK:"swx_imSend_postEnd_ok",POST_END_404:"swx_imSend_postEnd_404",POST_END_ERROR:"swx_imSend_postEnd_err"},CONTACTS:{LIST_LOAD:{START:"swx_contact_list_load",END:"swx_contact_list_end"},PAGE:{OPENED:"swx_contacts_page_opened",INITIALIZED:"swx_contacts_page_initialized",RENDERED:"swx_contacts_page_rendered"}},DISCOVER_AGENTS:{LIST_LOAD:{START:"swx_discover_agents_list_load",END:"swx_discover_agents_list_end"},PAGE:{OPENED:"swx_discover_agents_page_opened",INITIALIZED:"swx_discover_agents_page_initialized",RENDERED:"swx_discover_agents_page_rendered"}},CALLING:{INCOMING:{P2P_IN_PLUGINLESS_START:"swx_calling_incoming_p2p_in_pluginless_start",P2P_IN_PLUGINLESS_END:"swx_calling_incoming_p2p_in_pluginless_end"}},SEARCH:{LOCAL:{START:"swx_search_local_start",END:"swx_search_local_end",RESULTS_RENDERED:"swx_search_local_results_rendered"},GLOBAL:{START:"swx_search_global_start",END:"swx_search_global_end",RESULTS_RENDERED:"swx_search_global_results_rendered"}},SKYPEOUT:{PAGE:{OPENED:"swx_skypeout_page_opened"}},USER_SETTINGS:{PAGE:{OPENED:"swx_settings_page_opened"}}},measurements:{EXPERIENCE:{TTL:"swx_experience_ttl",TTL404:"swx_experience_ttl",SPLASH_TIME:"swx_experience_splash_screen_time"},TIMELINE:{TTL:"swx_timeline_ttl",TTL404:"swx_timeline_ttl",TTR:"swx_timeline_ttr"},NEW_CONVERSATION:{TTC:"swx_newConversation_ttc",TTS:"swx_newConversation_tts",TTR:"swx_newConversation_ttr"},CONVERSATION_UPDATE:{TTC:"swx_conversationupdate_ttc",TTS:"swx_conversationupdate_tts"},IM_SEND:{TTS:"swx_imsend_tts",TTS404:"swx_imsend_tts_404",TTR:"swx_imsend_ttr"},CONTACTS:{LIST_LOAD:{TTC:"swx_contacts_list_load_ttc"},PAGE:{TTC:"swx_contacts_page_ttc",TTR:"swx_contacts_page_ttr"}},DISCOVER_AGENTS:{LIST_LOAD:{TTC:"swx_discover_agents_list_load_ttc"},PAGE:{TTC:"swx_discover_agents_page_ttc",TTR:"swx_discover_agents_page_ttr"}},CALLING:{INCOMING:{TBN:"swx_calling_incoming_tbn"}},SEARCH:{LOCAL:{TTR:"swx_search_local_ttr"},GLOBAL:{TTR:"swx_search_global_ttr"}}},stages:{NEW_CONVERSATION:{STARTED:1,CREATED:2,REDIRECTED:3,ABANDONED:4},CONVERSATION_UPDATE:{COMPLETED:1,CANCELLED:2,ABANDONED:3}},conversationType:{UNKNOWN:-1,DIALOG:0,GROUP:1},persona:{NEWBEE:1,RETURNING:2,CLASSIC_IM:3,POWER_IM:4},historyLoadOrigin:{TIMELINE_INIT:1,NOTIFICATION_CONV:2,NOTIFICATION_AGGR:3,CONTACT_SEARCH:4,GROUP_SEARCH:5,DIRECTORY_SEARCH:6,NEW_CHAT_OPEN_EXISTING:7,PAGING:8,CALLING:9,AUTHOR_SWITCH:10,ROSTER:11,CONVERSATION_TO_THREAD:12,NEW_CHAT_CREATION:13,TIMELINE_CLICK:14,CONTACT_REQUEST_DECLINED:15,NEW_CHAT_DUMMY:16,NEW_CHAT_API_START_CONVERSATION:17,CONTACTS_PAGE:18,SKYPEOUT_PAGE:19,NEW_CONVERSATION_API:20,CONVERSATION_HEADER_BUTTON:21,CREATE_CONVERSATION_FOR_SCHEDULED_CALL:22,DISCOVER_AGENTS_PAGE:23,SKYPEOUT_PAGE_API:24,MENTION_ME:99},timelineLoadOrigin:{LOAD:1,RELOAD:2,RESSURECT:3},messageTypes:{MEDIA_VIDEO:1,MEDIA_PICTURE:2,MEDIA_LOCATION:4,CALLING_OTHER:8,FILES_MASK:4080,FILES_PICTURE:16,FILES_VIDEO:32,FILES_OFFICE:64,FILES_ARCHIVE:128,FILES_BINARY:256,FILES_PDF:512,FILES_OTHER:1024,FILES_AUDIO:2048,RICHTEXT_MASK:61440,RICHTEXT_FORMAT:4096,RICHTEXT_EMOTICONS:8192,RICHTEXT_ME:16384,RICHTEXT_OTHER:32768,CONTACT_OTHER:65536,TEXT_MASK:15728640,TEXT_ME:1048576,TEXT_OTHER:2097152,OTHER_TYPES:16777216},subCategories:{LOCAL_CONTACT_SEARCH:"LocalContactSearch",GLOBAL_CONTACT_SEARCH:"GlobalContactSearch",LOAD_CONTACTS:"LoadContacts"},poll:{eventName:{DESIGNER_OPENED:"poll_ui_designer_opened",STICKY_MESSAGE_CLICKED:"poll_ui_sticky_message_clicked",AVATAR_ELIPSIS_CLICKED:"poll_ui_avatar_elipsis_clicked",ERROR:"poll_error",ANSWER_LENGTH:"poll_ui_answer_length",ACTIVITY:"poll_activity"},activityType:{SEND:"send",VOTE:"vote",QUOTE:"quote",EDIT:"edit",REMOVE:"remove",CLOSE:"close"},errorType:{PARSING:"parsing",SEND:"send",OTHER:"other"},property:{CONVERSATION_ID:"conversation_id",MESSAGE_ID:"message_id",ACTIVITY_TYPE:"activity_type",ERROR_TYPE:"error_type",XMM_TYPE:"xmm_type",QUESTION_LENGTH:"question_length",ANSWER_LENGTH:"answer_length",ANSWERS_COUNT:"answers_count",MULTI_VOTE:"multi_vote",IS_NEW_VOTE:"is_new_vote",TOTAL_VOTES:"total_votes",TIME_SINCE_CREATION:"time_since_creation"}},userSettings:{eventName:{PREFERENCE_FETCHED:"user_settings_preference_fetched",PREFERENCE_CHANGED:"user_settings_preference_changed",PANEL_SHOWN:"user_settings_panel_shown",PAGE_DISMISSED:"user_settings_page_dismissed"},outcomeNames:{SUCCESS:"success",FAILURE:"failure"},property:{ITEM_NAME:"name",ITEM_VALUE:"value",OPERATION_OUTCOME:"outcome",OPERATION_DURATION:"duration"},UNKNOWN:"N/A"},inappActivity:{KPI_INAPP_ACTIVITY_START:"kpi_inapp_activity_start",KPI_INAPP_ACTIVITY_END:"kpi_inapp_activity_end"},pstn:{eventName:{PSTN_BUTTON_CLICKED:"kpi_pstn_button_clicked",PSTN_CALL_INITIATED:"kpi_pstn_call_initiated",ADD_CREDIT:"kpi_pstn_add_credit",ADD_SUBSCRIPTION:"kpi_pstn_add_subscription",CREDIT_BALANCE_UPDATE_CALL_END:"kpi_pstn_credit_balance_latency_call_end"},entryPoint:{CONTACT_LIST:"Contact List",SKYPE_OUT_PAGE:"Skype Out Page",CONVERSATION:"Conversation",RECENTS:"Recents",SEARCH:"Search Results",NO_CREDIT_CALL_START:"No Credit Call Start",NO_CREDIT_CALL_END:"No Credit Call End",NO_SUBSCRIPTION_CALL_START:"No Subscription Call Start",NO_SUBSCRIPTION_CALL_END:"No Subscription Call End"},cssClasses:{ADD_CREDIT:"js-addCredit",ADD_SUBSCRIPTION:"js-addSubscription"}}},globalizationFormatKeys:{time:{CALL_DURATION:"duration",SHORT:"short"},date:{DAY_MONTH:"dayMonth",DAY_MONTH_YEAR:"dayMonthYear",DAY_ABBREVIATION:"dayAbbr",DAY_NAME:"dayName",DATE_ABBREVIATION:"dateAbbr",SHORT_DATE_ABBREVIATION:"shortDateAbbr"}},api:{renderConversation:{errorMessages:{CONTAINER_UNDEFINED:"Container is undefined",CONTAINER_NOT_ELEMENT_NOT_SELECTOR:"Container is not a DOM element or CSS selector",PARTICIPANTS_WRONG_FORMAT:"Participants are expected to be an array",CONVERSATION_ID_WRONG_FORMAT:"Conversation ID is expected to be a string",PARTICIPANTS_AND_CONVERSATION_ID_UNDEFINED:"Participants or Conversation ID can't be undefined"}},conversation:{errorMessages:{NO_PARTICIPANTS:"Cannot start, at least one participant is required",SEARCH_FAILED:"Search for Person failed",URI_NOT_VALID:"Uri not a string",SUCCESS_CALLBACK_ERROR:"Unexpected error in success callback"}},modality:{errorMessages:{INVALID_MODALITIES:"Invalid modalities format provided",MODALITY_TYPE_NOT_SUPPORTED:"Modality type not supported",MODALITY_START_FAILED:"Modality cannot be started",ERROR_CALLBACK_ERROR:"Unexpected error in error callback"}},auth:{errorTypes:{TOO_MANY_CONNECTIONS_ERROR:"TooManyConnectionsError",NOT_LINKED:"AccountNotLinkedError",AGE_RESTRICTION_ERROR:"underage",OAUTH_FAILED_ERROR:"OAuthFailed",LOGIN_REQUIRED_ERROR:"login_required",SIGN_IN_CANCELED_ERROR:"Canceled",SIGNED_OUT_ERROR:"SignedOut"},errorMessages:{AUTH_DISABLED:"authentication disabled",ALREADY_SIGNED_IN:"user already signed in",ALREADY_SIGNED_OUT:"user already signed out",NOT_LINKED:"not-linked"},accountLinking:{WELCOME_FLOW:"welcome",RELINK_FLOW:"relink",INLINE_NEW_USER_FLOW:"inlineNewUser"},authProviderType:{SKYPE_TOKEN:"skypeToken",IMPLICIT_AUTH:"implicitOAuth",PASSWORD:"password",ANONYMOUS:"anonymous"},DEFAULT_SIGNIN_TIMEOUT:15e3}},silentLogin:{errorMessages:{NOT_LINKED:"not_linked",TIMED_OUT:"timed_out",INVALID_GRANT:"invalid_grant"}},conversation:{TOPIC_DELIMITER:", ",NUMBER_OF_PARTICIPANT_NAMES_IN_TOPIC:4},uiMode:{NARROW:"narrow"},cache:{VERSION:"1.8",PREFIX_KEYWORD:"swx",INTERNAL_KEYS:{VERSION:"version",ENCRYPTION_KEY:"encryptionKey",KEYS_MAP:"keysMap"},DEFAULT_BUFFER_TIMEOUT:300},experience:{RENDERER_CLASS:"swx"},disposableGroups:{PUB_SUB:"PUB_SUB",GENERIC_DISPOSABLE:"GENERIC_DISPOSABLE",INTERVAL:"INTERVAL",TIMEOUT:"TIMEOUT",DOM_EVENT:"DOM_EVENT"},urlValidator:{ALLOW_EMPTY:{}},i18n:{EMBEDDED_LOCALE:"en-us"},mentions:{"class":"mention(?: me)?",meIdentifier:/class\s?=\s?["']mention me["']/},fileTransfer:{MAX_RESOLUTION:16e3,MAX_FILE_SIZE:104857600,SUPPORTED_PICTURE_TYPES:"image/x-png, image/png, image/jpeg",MAX_PHOTO_SIZE:20971520,FILE_DOWNLOAD_WARNING_FLAG_API_ID:19},annotationType:{EMOTIONS:"emotions"},emotionTypes:{HEART:"heart"},sidebar:{position:{LEFT:"left",RIGHT:"right"},cssClasses:{SLIDE_LEFT_TO_RIGHT:"slideLeftToRight",SLIDE_RIGHT_TO_LEFT:"slideRightToLeft"}},textarea:{MAX_LENGTH:2e3},urlPreviewType:{WWW:"urlp-www",YT:"utlp-yt",GIF:"urlp-gif"},userSettings:{categories:{MESSAGING:"messaging",PRIVACY:"privacy",UNLISTED:"unlisted",CONTACTS:"contacts"},preferences:{URL_PREVIEWS:"urlPreviews",YOUTUBE_PLAYER:"youTubePlayer",MENTIONS:"mentions",FILE_PASTE:"filePaste",SKYPE_CALL_POLICY_SUPPORT:"skypeCallPolicySupport",SKYPE_VIDEO_CALLING_POLICY_SUPPORT:"skypeVideoCallingPolicySupport",READ_RECEIPT:"readReceipt",AUTO_BUDDY:"autoBuddy",AUTO_BUDDY_DISCOVERY:"autoBuddyDiscovery",DYNAMIC_DISCOVERY:"dynamicDiscovery"}},proofTypes:{EMAIL:"email",PHONE:"phone"},shortCircuit:{scenarios:{ADD_VERIFIED_PHONE:"settingspnv",MANAGE_ADDRESSBOOKS:"settingsaddressbooks"}},window:{BLANK_NAME:"_blank"},educationBubbles:{ORIENTATION:{TOP:"TOP",BOTTOM:"BOTTOM",LEFT:"LEFT",RIGHT:"RIGHT"},SIZE:{LARGE:"LARGE"}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-enums/lib/enums",["require","exports"],e)}(function(e,t){(function(e){e[e.ParticipantJoined="ParticipantJoined"]="ParticipantJoined",e[e.ParticipantLeft="ParticipantLeft"]="ParticipantLeft",e[e.ParticipantJoinFailed="ParticipantJoinFailed"]="ParticipantJoinFailed",e[e.ParticipantRoleUpdate="ParticipantRoleUpdate"]="ParticipantRoleUpdate",e[e.ParticipantTopicUpdate="ParticipantTopicUpdate"]="ParticipantTopicUpdate",e[e.ParticipantPictureUpdate="ParticipantPictureUpdate"]="ParticipantPictureUpdate",e[e.ParticipantHistoryDisclosed="ParticipantHistoryDisclosed"]="ParticipantHistoryDisclosed",e[e.ParticipantJoiningEnabled="ParticipantJoiningEnabled"]="ParticipantJoiningEnabled",e[e.ParticipantLegacyMemberAdded="ParticipantLegacyMemberAdded"]="ParticipantLegacyMemberAdded",e[e.ParticipantLegacyMemberUpgraded="ParticipantLegacyMemberUpgraded"]="ParticipantLegacyMemberUpgraded",e[e.CallStarted="CallStarted"]="CallStarted",e[e.CallEnded="CallEnded"]="CallEnded",e[e.CallMissed="CallMissed"]="CallMissed",e[e.NgcUpgradeMessage="NgcUpgradeMessage"]="NgcUpgradeMessage",e[e.PluginFreeFallbackWindowsUpdate="PluginFreeFallbackWindowsUpdate"]="PluginFreeFallbackWindowsUpdate",e[e.PluginFreeFallbackScreenSharing="PluginFreeFallbackScreenSharing"]="PluginFreeFallbackScreenSharing",e[e.PluginFreeFallbackMicrophoneAccess="PluginFreeFallbackMicrophoneAccess"]="PluginFreeFallbackMicrophoneAccess",e[e.PluginFreeFallbackOutgoingP2PCall="PluginFreeFallbackOutgoingP2PCall"]="PluginFreeFallbackOutgoingP2PCall",e[e.PluginFreeFallbackIncomingP2PCall="PluginFreeFallbackIncomingP2PCall"]="PluginFreeFallbackIncomingP2PCall",e[e.PluginFreeNoVideoCapability="PluginFreeNoVideoCapability"]="PluginFreeNoVideoCapability",e[e.PstnInsufficientFunds="InsufficientFunds"]="PstnInsufficientFunds",e[e.PstnInvalidNumber="InvalidNumber"]="PstnInvalidNumber",e[e.PstnForbiddenNumber="ForbiddenNumber"]="PstnForbiddenNumber",e[e.TextMessage="TextMessage"]="TextMessage",e[e.VideoMessage="VideoMessage"]="VideoMessage",e[e.PictureMessage="PictureMessage"]="PictureMessage",e[e.ContactRequestIncoming="ContactRequestIncoming"]="ContactRequestIncoming",e[e.ContactRequestIncomingInviteFree="ContactRequestIncomingInviteFree"]="ContactRequestIncomingInviteFree",e[e.ContactRequestOutgoing="ContactRequestOutgoing"]="ContactRequestOutgoing",e[e.ContactRequestOutgoingResend="ContactRequestOutgoingResend"]="ContactRequestOutgoingResend",e[e.ContactRequestOutgoingAgent="ContactRequestOutgoingAgent"]="ContactRequestOutgoingAgent",e[e.ContactRequestIsNowContact="ContactRequestIsNowContact"]="ContactRequestIsNowContact",e[e.SuggestedContact="SuggestedContact"]="SuggestedContact",e[e.UnblockContact="UnblockContact"]="UnblockContact",e[e.MojiMessage="MojiMessage"]="MojiMessage",e[e.FileTransfer="FileTransfer"]="FileTransfer",e[e.ContactInfoMessage="ContactInfoMessage"]="ContactInfoMessage",e[e.CreditTransaction="CreditTransaction"]="CreditTransaction",e[e.PollMessage="PollMessage"]="PollMessage",e[e.SystemMessage="SystemMessage"]="SystemMessage",e[e.CustomMessage="CustomMessage"]="CustomMessage"})(t.activityType||(t.activityType={}));var n=t.activityType;(function(e){e[e.Pending="Pending"]="Pending",e[e.Succeeded="Succeeded"]="Succeeded",e[e.Failed="Failed"]="Failed"})(t.activityStatus||(t.activityStatus={}));var r=t.activityStatus;(function(e){e[e.Pending="Pending"]="Pending",e[e.Succeeded="Succeeded"]="Succeeded",e[e.Failed="Failed"]="Failed"})(t.transactionStatus||(t.transactionStatus={}));var i=t.transactionStatus;(function(e){e[e.Incoming="Incoming"]="Incoming",e[e.Outgoing="Outgoing"]="Outgoing"})(t.direction||(t.direction={}));var s=t.direction;(function(e){e[e.Text="Text"]="Text",e[e.Html="Html"]="Html"})(t.messageFormat||(t.messageFormat={}));var o=t.messageFormat;(function(e){e[e.Text="Text"]="Text",e[e.Html="Html"]="Html"})(t.messageType||(t.messageType={}));var u=t.messageType;(function(e){e[e.Disconnected="Disconnected"]="Disconnected",e[e.Notified="Notified"]="Notified",e[e.Connecting="Connecting"]="Connecting",e[e.Ringing="Ringing"]="Ringing",e[e.EarlyMedia="EarlyMedia"]="EarlyMedia",e[e.Connected="Connected"]="Connected",e[e.Disconnecting="Disconnecting"]="Disconnecting"})(t.callConnectionState||(t.callConnectionState={}));var a=t.callConnectionState;(function(e){e[e.Terminated="Terminated"]="Terminated",e[e.FullSession="FullSession"]="FullSession",e[e.Busy="Busy"]="Busy",e[e.Refused="Refused"]="Refused",e[e.Missed="Missed"]="Missed",e[e.Dropped="Dropped"]="Dropped",e[e.InvalidNumber="InvalidNumber"]="InvalidNumber",e[e.ForbiddenNumber="ForbiddenNumber"]="ForbiddenNumber",e[e.EmergencyCallDenied="EmergencyCallDenied"]="EmergencyCallDenied",e[e.VoiceMailFailed="VoiceMailFailed"]="VoiceMailFailed",e[e.TransferFailed="TransferFailed"]="TransferFailed",e[e.InsufficientFunds="InsufficientFunds"]="InsufficientFunds",e[e.Failed="Failed"]="Failed",e[e.MissingSpeaker="MissingSpeaker"]="MissingSpeaker",e[e.CallEscalated="CallEscalated"]="CallEscalated",e[e.OutOfBrowserCall="OutOfBrowserCall"]="OutOfBrowserCall",e[e.AutoCallFailed="AutoCallFailed"]="AutoCallFailed",e[e.AutoCallTimeout="AutoCallTimeout"]="AutoCallTimeout",e[e.Canceled="Canceled"]="Canceled"})(t.callDisconnectionReason||(t.callDisconnectionReason={}));var f=t.callDisconnectionReason;(function(e){e[e.Skype="Skype"]="Skype"})(t.ecsClientNames||(t.ecsClientNames={}));var l=t.ecsClientNames;(function(e){e[e.Camera="Camera"]="Camera",e[e.Microphone="Microphone"]="Microphone",e[e.Speaker="Speaker"]="Speaker"})(t.deviceType||(t.deviceType={}));var c=t.deviceType;(function(e){e[e.Root="Root"]="Root",e[e.Custom="Custom"]="Custom",e[e.Others="Others"]="Others",e[e.Favorites="Favorites"]="Favorites",e[e.Distribution="Distribution"]="Distribution",e[e.PrivacyRelationship="PrivacyRelationship"]="PrivacyRelationship"})(t.groupType||(t.groupType={}));var h=t.groupType;(function(e){e[e.None="None"]="None",e[e.Blocked="Blocked"]="Blocked",e[e.Colleagues="Colleagues"]="Colleagues",e[e.Workgroup="Workgroup"]="Workgroup",e[e.External="External"]="External",e[e.FriendsAndFamily="FriendsAndFamily"]="FriendsAndFamily"})(t.groupPrivacyRelationshipLevel||(t.groupPrivacyRelationshipLevel={}));var p=t.groupPrivacyRelationshipLevel;(function(e){e[e.Started="Started"]="Started",e[e.Active="Active"]="Active",e[e.Inactive="Inactive"]="Inactive",e[e.Stopped="Stopped"]="Stopped"})(t.mediaStreamState||(t.mediaStreamState={}));var d=t.mediaStreamState;(function(e){e[e.Unknown="Unknown"]="Unknown",e[e.Video="Video"]="Video",e[e.Video_WMV="Video_WMV"]="Video_WMV",e[e.Video_MOV="Video_MOV"]="Video_MOV",e[e.Video_MP4="Video_MP4"]="Video_MP4",e[e.Picture="Picture"]="Picture"})(t.mediaType||(t.mediaType={}));var v=t.mediaType;(function(e){e[e.Unknown="Unknown"]="Unknown",e[e.Pending="Pending"]="Pending",e[e.Completed="Completed"]="Completed",e[e.Failed="Failed"]="Failed"})(t.mediaStatus||(t.mediaStatus={}));var m=t.mediaStatus;(function(e){e[e.Attendee="Attendee"]="Attendee",e[e.Leader="Leader"]="Leader"})(t.participantRole||(t.participantRole={}));var g=t.participantRole;(function(e){e[e.Disconnected="Disconnected"]="Disconnected",e[e.Connecting="Connecting"]="Connecting",e[e.InLobby="InLobby"]="InLobby",e[e.Connected="Connected"]="Connected",e[e.Disconnecting="Disconnecting"]="Disconnecting"})(t.participantState||(t.participantState={}));var y=t.participantState;(function(e){e[e.Online="Online"]="Online",e[e.Offline="Offline"]="Offline",e[e.Hidden="Hidden"]="Hidden",e[e.Busy="Busy"]="Busy",e[e.Idle="Idle"]="Idle",e[e.BeRightBack="BeRightBack"]="BeRightBack",e[e.Away="Away"]="Away",e[e.DoNotDisturb="DoNotDisturb"]="DoNotDisturb",e[e.Unknown="Unknown"]="Unknown",e[e.OnThePhone="OnThePhone"]="OnThePhone",e[e.OutForLunch="OutForLunch"]="OutForLunch"})(t.onlineStatus||(t.onlineStatus={}));var b=t.onlineStatus;(function(e){e[e.Home="Home"]="Home",e[e.Work="Work"]="Work",e[e.Cell="Cell"]="Cell",e[e.Other="Other"]="Other"})(t.phoneType||(t.phoneType={}));var w=t.phoneType;(function(e){e[e.autoBuddy="autoBuddy"]="autoBuddy",e[e.linkedMSA="linkedMSA"]="linkedMSA"})(t.selfSettings||(t.selfSettings={}));var E=t.selfSettings;(function(e){e[e.Personal="Personal"]="Personal",e[e.Work="Work"]="Work",e[e.Other="Other"]="Other"})(t.emailType||(t.emailType={}));var S=t.emailType;(function(e){e[e.Home="Home"]="Home",e[e.Work="Work"]="Work",e[e.Other="Other"]="Other",e[e.Unknown="Unknown"]="Unknown"})(t.locationType||(t.locationType={}));var x=t.locationType;(function(e){e[e.Personal="Personal"]="Personal",e[e.OutOfOffice="OutOfOffice"]="OutOfOffice"})(t.noteType||(t.noteType={}));var T=t.noteType;(function(e){e[e.Desktop="Desktop"]="Desktop",e[e.Mobile="Mobile"]="Mobile",e[e.Web="Web"]="Web",e[e.Unknown="Unknown"]="Unknown"})(t.endpointType||(t.endpointType={}));var N=t.endpointType;(function(e){e[e.RequestFailed="RequestFailed"]="RequestFailed"})(t.reasonCode||(t.reasonCode={}));var C=t.reasonCode;(function(e){e[e.Desktop="Desktop"]="Desktop",e[e.Application="Application"]="Application",e[e.Window="Window"]="Window"})(t.sharedResourceType||(t.sharedResourceType={}));var k=t.sharedResourceType;(function(e){e[e.Agent="Agent"]="Agent",e[e.AddressBook="AddressBook"]="AddressBook",e[e.SkypeDirectory="SkypeDirectory"]="SkypeDirectory",e[e.All="All"]="All"})(t.searchScope||(t.searchScope={}));var L=t.searchScope;(function(e){e[e.SignedOut="SignedOut"]="SignedOut",e[e.SigningIn="SigningIn"]="SigningIn",e[e.SignedIn="SignedIn"]="SignedIn",e[e.SigningOut="SigningOut"]="SigningOut"})(t.loginState||(t.loginState={}));var A=t.loginState;(function(e){e[e.NotReady="NotReady"]="NotReady",e[e.Authenticated="Authenticated"]="Authenticated",e[e.Error="Error"]="Error"})(t.translatorServiceState||(t.translatorServiceState={}));var O=t.translatorServiceState;(function(e){e[e.Password="Password"]="Password",e[e.Token="Token"]="Token",e[e.Passive="Passive"]="Passive",e[e.ImplicitOAuth="ImplicitOAuth"]="ImplicitOAuth",e[e.Guest="Guest"]="Guest",e[e.Integrated="Integrated"]="Integrated",e[e.OutOfBrowser="OutOfBrowser"]="OutOfBrowser"})(t.authType||(t.authType={}));var M=t.authType;(function(e){e[e.PluginNotInstalled="PluginNotInstalled"]="PluginNotInstalled",e[e.PluginOutOfDate="PluginOutOfDate"]="PluginOutOfDate",e[e.BrowserNotSupported="BrowserNotSupported"]="BrowserNotSupported",e[e.PluginBlocked="PluginBlocked"]="PluginBlocked",e[e.PluginAlreadyRunning="PluginAlreadyRunning"]="PluginAlreadyRunning",e[e.OSNotSupported="OSNotSupported"]="OSNotSupported",e[e.FeatureDisabled="FeatureDisabled"]="FeatureDisabled",e[e.TooManyParticipants="TooManyParticipants"]="TooManyParticipants",e[e.NotInConversation="NotInConversation"]="NotInConversation",e[e.CameraUnavailable="CameraUnavailable"]="CameraUnavailable",e[e.TrouterNotInitialized="TrouterNotInitialized"]="TrouterNotInitialized"})(t.callingNotSupportedReasons||(t.callingNotSupportedReasons={}));var _=t.callingNotSupportedReasons;(function(e){e[e.Uploading="Uploading"]="Uploading",e[e.FileMissing="FileMissing"]="FileMissing",e[e.Failed="Failed"]="Failed",e[e.FailedMalwareScan="FailedMalwareScan"]="FailedMalwareScan",e[e.Cancelled="Cancelled"]="Cancelled",e[e.Sent="Sent"]="Sent"})(t.fileUploadState||(t.fileUploadState={}));var D=t.fileUploadState;(function(e){e[e.Premium="Premium"]="Premium",e[e.Skypein="Skypein"]="Skypein",e[e.Calling="Calling"]="Calling",e[e.CallingLegacy="CallingLegacy"]="CallingLegacy",e[e.StickerPack="StickerPack"]="StickerPack"})(t.marketplaceSkuType||(t.marketplaceSkuType={}));var P=t.marketplaceSkuType;(function(e){e[e.None="None"]="None",e[e.P2P="P2P"]="P2P",e[e.NGC="NGC"]="NGC"})(t.callTechnology||(t.callTechnology={}));var H=t.callTechnology;(function(e){e[e.Unknown="Unknown"]="Unknown",e[e.PluginBasedP2P="PluginBasedP2P"]="PluginBasedP2P",e[e.PluginBasedNGC="PluginBasedNGC"]="PluginBasedNGC",e[e.Pluginless="Pluginless"]="Pluginless"})(t.mediaConnectionType||(t.mediaConnectionType={}));var B=t.mediaConnectionType;(function(e){e[e.Plan="plan"]="Plan",e[e.Package="package"]="Package"})(t.subscriptionType||(t.subscriptionType={}));var j=t.subscriptionType;(function(e){e[e.Unknown="Unknown"]="Unknown",e[e.Unset="Unset"]="Unset",e[e.Defined="Defined"]="Defined",e[e.Saving="Saving"]="Saving"})(t.preferenceValueState||(t.preferenceValueState={}));var F=t.preferenceValueState;(function(e){e[e.URL_PREVIEWS=11]="URL_PREVIEWS",e[e.YOUTUBE_PLAYER=12]="YOUTUBE_PLAYER",e[e.MENTIONS=13]="MENTIONS",e[e.FILE_PASTE=14]="FILE_PASTE",e[e.ALLOW_VIDEO_CALLS_FROM_CONTACTS_ONLY=15]="ALLOW_VIDEO_CALLS_FROM_CONTACTS_ONLY",e[e.DONT_ALLOW_VIDEO_CALLS=16]="DONT_ALLOW_VIDEO_CALLS"})(t.skypeFlagsApiMappings||(t.skypeFlagsApiMappings={}));var I=t.skypeFlagsApiMappings;(function(e){e[e.Boolean="Boolean"]="Boolean",e[e.Number="Number"]="Number",e[e.String="String"]="String",e[e.CallPolicy="CallPolicy"]="CallPolicy",e[e.VideoPolicy="VideoPolicy"]="VideoPolicy",e[e.AutoBuddy="AutoBuddy"]="AutoBuddy",e[e.AutoBuddyDiscovery="AutoBuddyDiscovery"]="AutoBuddyDiscovery",e[e.AutoBuddyDiscoveryEmail="AutoBuddyDiscoveryEmail"]="AutoBuddyDiscoveryEmail",e[e.AutoBuddyDiscoveryPhone="AutoBuddyDiscoveryPhone"]="AutoBuddyDiscoveryPhone"})(t.preferenceType||(t.preferenceType={}));var q=t.preferenceType;(function(e){e[e.Anyone=0]="Anyone",e[e.ContactsOnly=1]="ContactsOnly",e[e.NoOne=2]="NoOne"})(t.privacyPolicyValues||(t.privacyPolicyValues={}));var R=t.privacyPolicyValues}),define("swx-enums",["swx-enums/lib/enums"],function(e){return e}),define("cafe/applicationInstance",[],function(){function t(t){e=t}function n(){if(!e)throw new Error("Instance does not exist yet!");return e}var e;return{set:t,get:n}}),define("jSkype/client",[],function(){function t(t){e=t}function n(){if(!e)throw new Error("Instance does not exist yet!");return e}var e;return{set:t,get:n}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("jcafe-property-model/lib/propertyModel",["require","exports"],e)}(function(e,t){var n=null;try{n=window}catch(r){}!n&&global&&(global.window=global);var i=function(){function N(e,t){return t=Y({code:e},t),Y(Error(this||e),t)}function C(e,t){var n=e+" is not a "+t;return N.call(n,"WrongType",{value:e})}function k(e,t,n){var r="`"+e+"` = "+t+" is not a "+n;return N.call(r,"WrongArgType",{arg:e,value:t})}function L(e,t){var n=e+" != "+t;return N.call(n,"DoesNotEqual",{lhs:e,rhs:t})}function A(e,t){var n="`"+e+"` is invalid: "+t;return N.call(n,"InvalidArgument",{arg:e,reason:t})}function O(e,t){var n="Invalid state: "+e+" (expected "+t+")";return N.call(n,"InvalidState",{actual:e,expected:t})}function M(e,t){var n="the `"+e+"` property is missing";return N.call(n,"KeyMissing",{key:e,object:t})}function _(e){return N("AlreadyExists",{item:e})}function D(e){return N("DoesNotExist",{item:e})}function P(e){return N("NotSupported",{reason:e})}function H(e,t,n){if(!e){if(!E)debugger;throw N(t||"AssertionFailed",n)}}function B(e,t,n){if(!e)throw N(t||"RuntimeCheckFailed",n)}function j(e){return E?e:e+":"+tt()}function F(e,t){x.replacePrototype?e.__proto__?e.__proto__=t:Object.setPrototypeOf?Object.setPrototypeOf(e,t):Y(e,t):Y(e,t)}function I(){function r(e,t){v(e,0)}function i(){var n=w();while(e.length){var r=e.shift();r();var i=w()-n;if(i>=t||i<0)return}}function s(){n=!0;try{i()}finally{n=!1,e.length&&r(s,!1)}}function o(){if(n||e.length>1)return;r(s,!0)}function u(t){e.push(t),o()}var e=[],t=16,n=!1;return u}function R(e){var t=[];for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];e=e.bind.apply(e,[this].concat(t)),E?e():q(e)}function U(e){t(e>=0);var n=o(e+" sec timeout",{cancel:function(e){m(r),n.reject(e)}}),r=v(function(){n.resolve()},e*1e3|0);return n.promise}function z(e){return Wt(e)().then(function(){return Y(z(e),{locked:!0})})}function W(e,n){return t(St(n)&&n>0),e=Wt(e),z(function(){return e().then(V(U,n))})}function X(e,t,n){return t in e?e[t]:n}function V(e){var t=[];for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this;return e.bind?e.bind.apply(e,[r].concat(t)):function(){return e.apply(r,t.concat([].slice.call(arguments,0)))}}function $(e,t){var n;if(e.indexOf)return e.indexOf(t);for(n=0;n<e.length;n++)if(e[n]==t)return n;return-1}function J(e,t){e.splice(t,1)}function K(e,t,n){e.splice(t,0,n)}function Q(e){var t;return Object.keys?t=Object.keys(e):(t=[],it(e,function(e,n){t.push(n)})),t}function G(e,t){for(var n in e)if(!t(e[n],n))return!1;return!0}function Y(e){var t=[];for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r,i,s,o=t[t.length-1];e=e||{},o=Et(o)?o:"";for(i=0;i<t.length;i++){r=t[i]||{};if(r!==o)for(s in r)if(o!="append"||!(s in e))e[s]=r[s]}return e}function Z(e,n,r){r===void 0&&(r=null);var i,s=r||window,o=e.split(".");for(i=0;i<o.length;i++)s=s[o[i]]||(s[o[i]]={});for(i in n)t(!(i in s),e+"."+i+" already exists"),s[i]=n[i];return s}function et(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=y.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})}function tt(){return y.random().toString(16).slice(2)}function nt(e,t,n,r){try{Object.defineProperty(e,t,{value:n,enumerable:!1,writable:!r})}catch(i){e[t]=n}}function rt(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/gm,"")}function it(e,n){t(bt(e)||yt(e)),t(xt(n));var r,i,s;if(bt(e))for(i=0;i<e.length;++i)n(e[i],i);else for(s in e)r=n(e[s],s),t(r===void 0)}function st(e,n){t(bt(e)||yt(e)),t(xt(n));var r;return bt(e)?(r=[],it(e,function(e,t){n(e,t)&&r.push(e)})):(r={},it(e,function(e,t){n(e,t)&&(r[t]=e)})),r}function ot(e){t(yt(e));var n=[];return it(e,function(e){n.push(e)}),n}function ut(e){return t(bt(e)||yt(e)),bt(e)?e.length:Q(e).length}function at(e,n){t(bt(e)||yt(e)),t(xt(n));var r;if(bt(e)){for(r=0;r<e.length;++r)if(n(e[r],r))return!0}else for(r in e)if(n(e[r],r))return!0;return!1}function ft(e,n){t(bt(e)||yt(e)),t(xt(n));var r,i={};if(bt(e)){for(r=0;r<e.length;++r)if(n(e[r],r))return e[r]}else for(r in e)if(n(e[r],r))return i[r]=e[r],i;return null}function lt(e){return Object.freeze?Object.freeze(e):e}function ct(){var e={},t,n;for(n=0;n<arguments.length;n++)t=arguments[n],e[t]=t;return lt(e)}function ht(){var e,t;if(arguments.length==1&&yt(arguments[0]))e=arguments[0];else{e={};for(t=0;t<arguments.length;t++)e[arguments[t]]=t}return lt(e)}function pt(e,t){for(var n in e)if(e[n]==t)return n;return""}function dt(e,t,n){var r,i;if(bt(e)){r=[];for(i=0;i<e.length;i++)r.push(t.call(n,e[i],i,e))}else if(yt(e)){r={};for(i in e)r[i]=t.call(n,e[i],i,e)}return r}function vt(e,t,n){var r,i={};e=e||{},t=t||{};for(r in t)if(!(r in e)||n!="append")i[r]={value:t[r],writable:!0,enumerable:!0,configurable:!0};return Object.create(e,i)}function mt(e){return e&&JSON.parse(JSON.stringify(e))}function gt(e){return e&&Object.prototype.toString.call(e)=="[object Object]"}function yt(e){return gt(e)}function bt(e){return Object.prototype.toString.call(e)=="[object Array]"}function wt(e,t){if(!bt(e))return!1;for(var n=0;n<e.length;n++)if(!t(e[n]))return!1;return!0}function Et(e){return Object.prototype.toString.call(e)=="[object String]"}function St(e){return Object.prototype.toString.call(e)=="[object Number]"}function xt(e){return Object.prototype.toString.call(e)=="[object Function]"}function Tt(e){return Object.prototype.toString.call(e)=="[object Boolean]"}function Nt(e){return Et(e)&&e.length>0}function Ct(e){return e===null||e===undefined}function kt(e){return St(e)&&(e|0)==e}function Lt(e,t){return kt(e)&&bt(t)&&e>=0&&e<t.length}function At(e,t,n){return St(n)&&n>=e&&n<=t}function Ot(e){return gt(e)&&Nt(e.type)&&Nt(e.url)}function Mt(e){return yt(e)&&"status"in e}function _t(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function Dt(e){return e&&e[S]}function Pt(e){return e instanceof Jt}function Ht(e){return e&&e.constructor===p}function Bt(e){return e&&e.constructor===h}function jt(e){return e&&e.constructor===ln}function Ft(e,t){var n,i=t.split("|");for(n=0;n<i.length;n++)if(i[n]in r.types&&r.types[i[n]](e))return!0;return!1}function It(e){return e&&xt(e.then)}function qt(e,t){var n,r=typeof e,i=typeof t;if(e===t)return!0;if(r!==i||r!=="object"&&r!=="function")return!1;if(e===null||t===null)return e===t;if(e instanceof g&&t instanceof g)return+e==+t;for(n in e)if(!(n in t)||e[n]!==t[n])return!1;for(n in t)if(!(n in e)||e[n]!==t[n])return!1;return!0}function Rt(e){return e.replace(/[<>&;#/]/gm,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/\r\n|\n/gm,function(){return"<br>"})}function Ut(e){return a("<root>"+e+"</root>").text()}function zt(e){return e.replace(/&(#?\w+);/gm,function(e,t){return t.charAt(0)=="#"?String.fromCharCode(+t.slice(1)):i.entities[t]})}function Wt(e,t){var n=e[S]?e:function(){try{return o.wait(e.apply(this,arguments),t)}catch(n){return o().reject(n).promise}};return nt(n,S,!0),n}function Xt(e){function i(e,n){return t.on(e,n),xt(n)&&n(this),new Vt(t,e)}var t=i,n,r=e||{};return this instanceof s?(n=this,Y(n,r),n._listeners=[],n._modes=[],n._locked=!1,n.observer=t,F(t,s.prototype.observer),t._event=n,n):new s(e)}function Vt(e,t){this.event=e,this.listener=t}function $t(e,t){if(!(this instanceof o))return new o(e,t);Et(e)||(t=e,e=void 0),t=t||{};var n=this,r={};r.leafs=[],r.state="pending",r.status=h({value:e}),t.mode&&(r.mode=t.mode),t.cancel&&(r.fnCancel=t.cancel),r.promise=new o.Promise(n),Y(n,{_:r,status:r.status,promise:r.promise})}function Jt(e){var t=o();try{e(function(e){t.resolve(e)},function(e){t.reject(e)},t.status)}catch(n){t.promise.state()=="pending"&&t.reject(n)}return t.promise}function Kt(e){return vt(Kt.prototype,{exec:function(t,n){var r=e(t,n||0);return arguments.length==2?r:!r||r.pos!=t.length?null:r.res}})}function Qt(e){return Kt(function(t,n){if(t.slice(n,n+e.length)==e)return{res:e,pos:n+e.length}})}function Gt(e){return Kt(function(t,n){var r=e.exec(t.slice(n));if(r&&r.index==0)return{res:r[0],pos:n+r[0].length}})}function Yt(e,t){return Kt(function(n,r){return e.exec(n,r)||{res:t,pos:r}})}function Zt(e,t){return Kt(function(n,r){return!t.exec(n,r)&&e.exec(n,r)})}function en(){var e=[];for(var t=0;t<arguments.length;t++)e[t-0]=arguments[t];return Kt(function(t,n){var r,i,s=[];for(r=0;r<e.length;r++){i=e[r].exec(t,n);if(!i)return;s.push(i.res),n=i.pos}return{res:s,pos:n}})}function tn(){var e=[];for(var t=0;t<arguments.length;t++)e[t-0]=arguments[t];return Kt(function(t,n){var r,i;for(r=0;r<e.length&&!i;r++)i=e[r].exec(t,n);return i})}function nn(e){return Kt(function(t,n){var r,i=[];while(r=e.exec(t,n))i.push(r.res),n=r.pos;return{res:i,pos:n}})}function rn(e,t){var n=en(t,e).select(1),r=en(e,nn(n)).then(function(e){return[e[0]].concat(e[1])});return Yt(r,[])}function sn(e,t){var n=Gt(/\\./).then(function(e){return e.slice(1)}),r=tn(n,Zt(Gt(/./),t));return en(e,nn(r),t).select(1).merge()}function on(e){var t=u.pattern.exec(e);if(!t)throw new SyntaxError("Invalid data URL: "+e);return t.base64=!!t.attributes.base64,t}function un(e){if(!(Et(e)||e&&e.ast))throw new Error("Invalid argument: "+e);if(!(this instanceof a))return new a(e);var t,n;try{t=e.ast||a.pattern.exec(e);if(!t)throw void 0}catch(r){throw n=new SyntaxError("Invalid XML: "+e),n.reason=r,n}var i=t.attrs||{},s=(t.nodes||[]).map(function(e){return a({ast:Et(e)?{text:e}:e})}),o=function(e,t){return e+t.text()},u=function(){return t.name},f=function(){return t.text||s.reduce(o,"")};this.attrs=i,this.nodes=s,this.name=u,this.text=f}function an(e){return{root:a(rt(e.replace(/^<\?.+?\?>/,"")))}}function fn(e){var t=f.pattern.exec(e||"");if(t)return t;throw new SyntaxError("Invalid WWW-Authenticate header:\n"+e)}function ln(e,t){function r(){var t;if(!n.enabled()){t=N("CommandDisabled",{reason:n.enabled.reason});if(Dt(e))return o().reject(t).promise;throw t}return e.apply(this,arguments)}function i(){return"[Command: enabled = "+n.enabled()+"]"}function s(e){return ln(function(){return n.apply(e,arguments)},n.enabled)}var n=r;return Y(n,{constructor:ln,enabled:t&&t.asReadOnly(),bind:s,toString:i})}function cn(e){return Y(e,{constructor:ln,toString:function(){return"[Command: enabled = true]"},enabled:mn(!0)})}function hn(e){return e!==void 0?ln(function(){},mn(!1,e)):(l.instance||(l.instance=ln(function(){},mn(!1))),l.instance)}function pn(e){return e!==void 0?ln(Wt(function(){}),mn(!1,e)):(c.instance||(c.instance=ln(Wt(function(){}),mn(!1))),c.instance)}function dn(e,t){var n=0;return function(){var r=!1;return n++,n==1&&e&&e(),{dispose:function(){if(r)throw N("AlreadyDisposed");r=!0,n--,n==0&&t&&t()}}}}function vn(e){function s(e,n){return arguments.length==0?t._value:(t._write(e,n),this)}var t=s,n=e&&e.get,r=e&&e.set,i=e&&e.readOnly;return e&&e.value!==void 0&&(t._value=e.value),e&&e.reason!==void 0&&(t.reason=e.reason),e&&e.check&&(t._check=e.check),n&&(t._getter=Wt(n)),i&&(t._ro=t),r&&(t._setter=Wt(r,"sync")),e&&e.subscribed&&(t._subscribed=e.subscribed),e&&e.unsubscribed&&(t._unsubscribed=e.unsubscribed),F(t,h.prototype),Y(t,{get:jt(n)?ln(t._getAsync,n.enabled):cn(t._getAsync),set:i?c():jt(r)?ln(t._setAsync,r.enabled):cn(t._setAsync)}),Object.defineProperty(t,"changed",{get:t._getChanged,set:function(e){t._getChanged(),t._changed.observer=e}}),t}function mn(e,t){if(t===void 0){if(e===null)return h.null;if(e===!0)return h.true;if(e===!1)return h.false}return h({value:e,reason:t,readOnly:!0})}function gn(e,t){var n=h();return n(e,t),n.inc=function(){n(n()+1)},n.dec=function(){n(n()-1)},n}function yn(e,t){var n=h();return n(e,t),n}function bn(e){function r(e){return arguments.length==0?t._asArray():bt(e)?(t.empty(),t._addArray(e),this):t._getFromCache(e)}var t=r,n=t._=Y({},e);return e&&e.get&&(n.get=Wt(e.get)),n.vals=[],n.keys=[],n.idxs={},F(t,p.prototype),t._init(),t}function wn(e){function f(n,r){t(!s[n]),t(n>e),t(xt(r)),s[n]=Wt(r)}function l(e){n(e>=i(),"InvalidTargetState",{currentTarget:i(),requestedTarget:e});if(e==r())return;return e>i()&&(u=o("advancing to target state "+e,{cancel:c}),i.set(e),p(u)),u.promise}function c(e){a.cancel(e),a=null}function p(e){if(a)return;var t=r()+1;e.status("advancing to state "+t),a=s[t].call(null),a.then(function(n){a=null,r.set(t),r()<i()?p(e):e.resolve(n)},function(t){a=null,e.reject(t)})}var r=h({value:e}),i=h({value:e}),s={},u,a;return{defineState:f,advanceTo:Wt(l),state:r.asReadOnly(),target:i.asReadOnly()}}function En(e,n){function l(){t(r<=n);while(r<n&&i.length>0)c()}function c(){var t=i.splice(0,1)[0],n=u[t],o=s[t];delete u[t],delete s[t],a.splice(0,1),r++,f[t]=e(n),f[t].then(function(e){o.resolve(e)},function(e){o.reject(e)},o.status).then(function(){r--,delete f[t],l()})}function h(e,t){var n=a.length;while(n>0&&t>a[n-1])n--;a.splice(n,0,t),i.splice(n,0,e)}function p(e,t){var n;if(f[e])f[e].cancel(t);else{s[e].reject(t),delete u[e],delete s[e];for(n=0;n<i.length;n++)if(i[n]==e){i.splice(n,1),a.splice(n,1);break}}}t(xt(e)),t(n>0),e=Wt(e);var r=0,i=[],s={},u={},a=[],f={};return function(e,t){var n=tt(),r=o("Waiting in the throttling queue.",{cancel:V(p,n)});return s[n]=r,u[n]=e,h(n,t),l(),r.promise}}function Sn(e){t(xt(e));var n=null;return function(){return n||(n=e())}}function xn(e,n){function s(e,n,i){t(St(e)),t(i instanceof o);var s=0;while(s<r.length&&e>r[s].priority)s++;r.splice(s,0,{priority:e,request:n,task:i})}function u(e){t(e>0),t(r.length>0);var n,i=[],s=[];for(n=r.length-1;n>=0&&i.length<e;n--)i.push(r[n].request),s.push(r[n].task);return r.splice(n+1,e),{requests:i,tasks:s}}function a(e,t){var n;for(n=0;n<r.length;n++)if(r[n].task===e)break;n<r.length?(r.splice(n,1),e.reject(t)):(e.cancelled=!0,e.reject(t))}function f(){function r(e){it(t.tasks,function(t,n){t.cancelled||e(t,n)})}var t=u(n);o.wait(e(t.requests)).then(function(e){r(function(t,n){var r=bt(e)?e[n]:e;o.wait(r).then(function(e){t.resolve(e)},function(e){t.reject(e)},t.status)})},function(e){r(function(t){t.reject(e)})},function(e){r(function(t){t.status(e)})})}t(n>0);var r=[],i;return function(e,t){var n=o("Waiting in the batching queue.",{cancel:function(e){a(n,e)}});return i||(i=v(function(){i=null;while(r.length>0)f()},0)),s(t,e,n),n.promise}}function Cn(e){function n(e){t(Et(e));var n=e.split("\r\n"),r,i,o,u;for(var a=0;a<n.length;a++)if(u=rt(n[a]))r=u.indexOf(":"),r>=0&&(i=rt(u.substr(0,r)),o=rt(u.substr(r+1)),s(i,o))}function r(e){t(yt(e));for(var n in e)s(n,e[n]+"")}function i(e){return t(Nt(e)),u[e.toLowerCase()]}function s(e,n){t(Nt(e)),t(Nt(n)),e=e.toLowerCase(),u[e]?u[e]+="\n"+n:u[e]=n}function o(){var e,t,n,r="";for(t in u){n=u[t].split("\n");for(e=0;e<n.length;e++)n[e]&&(r+=t+": "+n[e]+"\r\n")}return r+"\r\n"}var u={};return Nt(e)?n(e):yt(e)&&r(e),{get:i,add:s,toString:o}}function kn(e){var t=u("data:"+e.replace(/\s/g,"")+",");return{mimeType:t.mime,attributes:t.attributes}}function Ln(e){if(!e)return e;var t=/\d+/.exec(e);return new g(t&&+t[0])}function An(e){return e?"/Date("+ +e+")/":e}function On(e,t){function n(e,t){for(var n=0;n<e.length;n++)if($(t,e[n])<0)return!1;return!0}return n(e,t)&&n(t,e)}var e=this,t=H,n=B,r=Ft,i=zt,s=Xt,o=$t,u=on,a=un,f=fn,l=hn,c=pn,h=vn,p=bn,d=window.ttt?ttt.window:window,v=d.setTimeout,m=d.clearTimeout,g=d.Date,y=d.Math,b=d.console,w=d.performance&&d.performance.now?function(){return performance.now()}:function(){return g.now()};d=null;var E=typeof SkypeWebTests!="undefined",S=j("async"),x=Z("Skype.Web.Utils",{replacePrototype:!0}),T={log:function(){if(!E)try{b.log.apply(b,arguments)}catch(e){}}};t.is=function(e,n){if(n instanceof RegExp)t(n.test(e),"DoesNotMatchPattern",{value:e,pattern:n});else if(n&&!r(e,n)){debugger;throw C(e,n)}},t.args=function(e,t){it(t,function(t,n){var i=e&&e[n];if(!r(i,t)){debugger;throw k(n,i,t)}})},n.equals=function(e,t){if(e!=t)throw L(e,t)},n.state=function(e,t){if(bt(t)){if($(t,e)==-1)throw O(e,t)}else if(e!=t)throw O(e,t)},n.belongs=function(e,t){if(!(e in t))throw M(e,t)};var q=I();r.types={String:Et,NotEmptyString:Nt,Function:xt,Dictionary:yt,Object:gt,Array:bt,Boolean:Tt,Void:Ct,Number:St},i.entities={lt:"<",gt:">",amp:"&",nbsp:" ",quot:'"'},Y(Vt.prototype,{dispose:function(){this.event.off(this.listener)}}),s.prototype=function(){},Y(s.prototype,{constructor:s,fire:function(){var e=this;if(e._enqueue(e,e._fire,arguments))return;e._fire.apply(e,arguments),e._dequeue()},_fire:function(){var e,t=this;for(e=0;e<t._listeners.length;e++)t._invoke(t._listeners[e],arguments,t._modes[e])},_invoke:function(e,t,n){var r=this;if(n=="async"&&!E)R.call(r,r.invoke,e,t,"sync");else try{e.apply(null,t)}catch(i){if(i!==r._ie){b&&b.log;debugger}}},_enqueue:function(e,t,n){var r=this;return r._locked?(r._queue=r._queue||[],r._queue.push([e,t,n])):r._locked=!0,r._queue&&r._queue.length>0},_dequeue:function(){var e,t=this;if(t._queue){while(e=t._queue.shift())e[1].apply(e[0],e[2]);t._queue=null}t._locked=!1},observed:function(){return this._listeners.length>0},observer:{toString:function(){var e=this._event._listeners.length;return"[Event"+(e?": "+e+" listener"+(e==1?"":"s"):"")+"]"},on:function(e,t){var n=this._event;if(n._enqueue(this,this._addListener,[e,t]))return;this._addListener(e,t),n._dequeue()},_addListener:function(e,n){var r=this._event;t(xt(e)),r.adding&&r.adding.call(r.context,e),r._listeners.push(e),r._modes.push(n),r.added&&r.added.call(r.context,e),r._listeners.length==1&&r.subscribed&&r.subscribed.call(r.context)},off:function(e){var t=this._event;if(t._enqueue(this,this._removeListener,[e]))return;this._removeListener(e),t._dequeue()},_removeListener:function(e){var t=this._event,n=$(t._listeners,e);n>=0&&(t._listeners.splice(n,1),t._modes.splice(n,1),t._listeners.length==0&&t.unsubscribed&&t.unsubscribed.call(t.context))}}}),Y(o.prototype,{resolve:function(e){var t=this,r=t._;return n.state(r.state,"pending"),r.value=e,r.state="resolved",r.$state&&r.$state._set(r.state),r.promise.result=e,t._complete()},reject:function(e){var t=this,r=t._;return n.state(r.state,"pending"),r.value=e,r.state="rejected",r.$state&&r.$state._set(r.state),r.promise.error=e,t._complete()},_complete:function(){var e=this,t=e._;t.status(null);for(var n=0;n<t.leafs.length;n++)t.leafs[n]();return t.fnCancel=null,e}}),o.Promise=function(e){this.task=e,Object.defineProperty(this,"state",{get:this._getState}),Object.defineProperty(this,"status",{get:this._getStatus})},o.Promise.prototype=vt(Jt.prototype,{_getState:function(){var e=this.task._;return e.$state||(e.$state=h({value:e.state,readOnly:!0})),e.$state},_getStatus:function(){var e=this.task._;return e.status.asReadOnly()},from:function(e){var t=this.task,n=t._;this.locked?this.target.from(e):(n.source=e,n.source.then(function(e){t.resolve(e)},function(e){t.reject(e)},n.status),n.fnCancel=function(e){n.source.cancel(e)},n.source.locked&&(n.source.target=this))},cancel:function(e){var t=this.task,r=t._;n.state(r.state,"pending"),r.fnCancel?r.fnCancel(e):t.reject(e)},then:function(e,t,n){function f(){i.status.changed.off(l);try{if(i.state=="resolved")s=xt(e)?e(i.value):i.value;else{if(!xt(t)){u.reject(i.value);return}s=t(i.value)}}catch(n){u.reject(n);return}It(s)?u.promise.from(o.wait(s)):u.resolve(s)}function l(e,t){i.state=="pending"&&(u.status(e,t),xt(n)&&n(e,t))}function c(e){if(i.leafs.length<2)i.promise.cancel(e);else{J(i.leafs,$(i.leafs,a)),i.status.changed.off(l);try{xt(t)?u.promise.from(o.wait(t(e))):u.reject(e)}catch(n){u.reject(n)}}}var r=this.task,i=r._,s,u=o({cancel:c}),a=i.mode=="sync"?f:V(R,f);return i.state=="pending"?(i.status.changed(l),i.leafs.push(a)):a(),u.promise}}),o.waitAny=function(e){function i(t){it(e,function(e){try{e.cancel(t)}catch(n){}})}var t=e.length,n=o({cancel:i}),r=n.promise;return t==1?r=o.wait(e[0]):t==0?n.reject(Error()):it(e,function(r){r.then(function(e){t--,n&&(n.resolve(e),n=null,i(N("CompetingTaskResolved")))},function(e){t--,t||(n.reject(e),n=null)},function(){var t=dt(e,function(e,t){return e.status()||"#"+t});n.status(t.join(" || "))})}),r},o.waitAll=function(e){function u(t){for(var n=0;n<e.length;n++)try{e[n].state()=="pending"&&e[n].cancel(t)}catch(r){debugger}}function a(){var e=dt(s,function(e,t){return e.status()||"#"+t});r.status(ot(e).join(" && "))}var t=e.length,n=[],r=o({cancel:u}),i=r.promise,s={};return n.length=e.length,t==0?r.resolve([]):t==1?i=o.wait(e[0]).then(function(e){return[e]}):(it(e,function(t,n){s[n]=e[n]=o.wait(t)}),a(),it(e,function(e,i){e.then(function(e){n[i]=e,delete s[i],a(),t--,t||(r.resolve(n),r=null)},function(e){delete s[i],t--,r&&(r.reject(e),r=null,u(e))},a)})),i},o.wait=function(e,t){return Pt(e)?e:It(e)?Jt(V.call(e,e.then)):o({mode:t}).resolve(e).promise},Y(Jt.prototype,{"catch":function(e){return this.then(null,e||function(){})},"finally":function(e){return this.then(function(t){return o.wait(e()).then(function(){return t})},function(t){return o.wait(e()).then(function(){throw t})})}}),Y(Kt.prototype,{then:function(e){var t=this.exec;return Kt(function(n,r){var i=t(n,r);return i&&{res:e(i.res),pos:i.pos}})},select:function(e){return this.then(function(t){return t[e]})},merge:function(e){return this.then(function(t){return t.join(e||"")})},join:function(e,t){return this.then(function(n){var r,i={};for(r=0;r<n.length;r++)i[n[r][e]]=n[r][t];return i})},as:function(e){return this.then(function(t){var n,r={};for(n in e)r[n]=t[e[n]];return r})}}),u.encodeData=function(e){return encodeURIComponent(e).replace(/%20/gm,"+")},u.decodeData=function(e){return decodeURIComponent(e.replace(/\+/gm," "))},u.pattern=function(){var e=Gt(/[^()<>@,;:\\\x22/\[\]?=\s]+/),t=en(e,Qt("/"),e).merge(),n=Gt(/[^\uffff]*/).then(u.decodeData),r=sn(Qt('"'),Qt('"')),i=en(Gt(/\s*=\s*/),tn(r,e)).select(1),s=en(Gt(/\s*;\s*/),e,Yt(i,!0));return en(Qt("data:"),Yt(t),nn(s).join(1,2),Gt(/\s*,\s*/),n).as({mime:1,attributes:2,data:4})}(),a.prototype.toString=function(){return"[object XmlNode]"},a.prototype.attr=function(e){return t(e in this.attrs,"Attribute does not exist: "+this.name()+"."+e),this.attrs[e]},a.prototype.selectOne=function(e,n){var r=st(this.nodes,xt(e)?e:function(t){var r,i;if(n)for(r in n){i=r.toLowerCase();if(n[i]!=t.attrs[i])return!1}return t.name()==e.toLowerCase()});return t(r.length==1,"Single node expected: "+e),r[0]},a.pattern=function(){var e,t=Gt(/[\x00-\x20]*/),n=Gt(/\x22[^\x22]*\x22/).then(function(e){return e.slice(1,-1)}),r=Gt(/[^\s<>\x22]+/),s=tn(n,r).then(i),o=Gt(/[^<]+/m).then(i),u=Gt(/[\w\d:-]+/).then(function(e){return e.toLowerCase()}),a=en(u,Yt(en(t,Qt("="),t,s).select(3))),f=rn(a,t).join(0,1),l=en(Qt("<"),t,u,t,f,t,Qt(">")).as({name:2,attrs:4}),c=en(Qt("<"),t,u,t,f,t,Qt("/>")).as({name:2,attrs:4}),h=en(Qt("</"),t,u,t,Qt(">")).select(2),p=Kt(function(t,n){return e.exec(t,n)}),d=en(l,nn(tn(p,o)),h).then(function(e){if(e[0].name==e[2])return{name:e[2],nodes:e[1],attrs:e[0].attrs};throw new SyntaxError("</"+e[2]+"> does not match <"+e[0].name+">")});return e=tn(d,c)}(),f.pattern=function(){var e=Gt(/[\s,]*/),t=Gt(/[^\s,=]+/),n=sn(Qt('"'),Qt('"')),r=en(t,Gt(/\s*=\s*/),n),i=rn(r,e).join(0,2),s=en(t,e,i);return rn(s,e).join(0,2)}(),h.sUpdated={},h.prototype=function(){},Y(h.prototype,{constructor:h,toString:function(){return"[Property: value = "+this()+"]"},map:function(e){var t=this,n,r=h({get:ln(function(){return t.get().then(e)},t.get.enabled),subscribed:function(){n=t.subscribe()},unsubscribed:function(){n.dispose()}});return t.changed(function(t,n){r(e(t),n)}),r.asReadOnly()},when:function(e,t){function s(e,n,s){i(e)&&t.call(r,n,s)}var n=this.changed,r={dispose:function(){n.off(s)}},i=xt(e)?e:function(t){return t===e};return n(s),r},once:function(e,t){return this.when(e,function(){this.dispose(),t.apply(null,arguments)})},equals:function(e){return this.map(function(t){return t==e})},equalsAny:function(){var e=[].slice.call(arguments);return this.map(function(t){return at(e,function(e){return e==t})})},fork:function(e){var t=this,n,r=e.enabled||mn(!0),i=r===mn(!1),s=h({value:t(),reason:t.reason,readOnly:i,set:!i&&ln(function(n,r){return Wt(e)(n,r).then(function(e){return t.set(e,r)})},r),get:t.get.bind(t),subscribed:function(){n=t.subscribe()},unsubscribed:function(){n.dispose()}});return(t._forks=t._forks||[]).push(s),s},asReadOnly:function(){var e=this;return e._ro||(e._ro=e.fork(c())),e._ro},observed:function(){var e=this,t=e._changed;return t&&t.observed()},subscribe:function(){var e=this;return e.subscribe=dn(e._subscribed,e._unsubscribed),e.subscribe()}}),Y(h.prototype,{_set:function(e,t){var n=this,r=n._value,i,s=n._forks,o=n._changed;if(!qt(e,r)||!qt(t,n.reason)){n._value=e,n.reason=t,o&&o.fire(e,t,r);if(s)for(i=0;i<s.length;i++)s[i]._set(e,t)}return e},_getChanged:function(){var e=this;return e._changed||(e._changed=new s({context:e,added:e._listenerAdded})),e._changed.observer},_listenerAdded:function(e){var t=this,n=t._value,r=t.reason;n!==void 0&&e(n,r)},_getAsync:Wt(function(){var e=this,t=e._getter,n=e._value;return t?t.call(e,n,e.reason).then(function(t){return e._set(t,e.reason),e._value}):n}),_setAsync:Wt(function(e,n){var r=this,i=r._check,s=r._setter;return t(arguments.length>0),i&&i(e),s?s.call(r,e,n).then(function(e){return r._set(e,n)}):r._set(e,n)},"sync"),_write:function(e,t){var n=this,r=n._check,i=n._setter;r&&r(e);if(!n.set.enabled())throw Error("This is a read-only property.");i&&t!==h.sUpdated?i.call(n,e,t).then(function(e){n._set(e,t)}):n._set(e,t)}}),h.true=h({value:!0,readOnly:!0}),h.false=h({value:!1,readOnly:!0}),h.true.get.enabled=h.true,h.true.set.enabled=h.false,h.false.get.enabled=h.true,h.false.set.enabled=h.false,c.instance.enabled=h.false,h.null=h({value:null,readOnly:!0}),p.prototype=function(){},Y(p.prototype,{_init:function(){var e=this;Object.defineProperties(e,{added:{enumerable:!0,get:e._initAddedEvent,set:function(t){e._initAddedEvent(),e._.added.observer=t}},removed:{enumerable:!0,get:e._initRemovedEvent,set:function(t){e._initRemovedEvent(),e._.removed.observer=t}},changed:{enumerable:!0,get:e._initChangedEvent,set:function(t){e._initChangedEvent(),e._.changed.observer=t}},size:{enumerable:!0,get:e._initSizeProperty,set:function(t){e._initSizeProperty(),e._.size.observer=t}}})},_initAddedEvent:function(){var e=this,t=e._,n="added",r;return t[n]=t[n]||new s({context:e,adding:e._addedListenerAdding}),r=t[n].observer,r},_addedListenerAdding:function(e){var t=this,n=t._;it(n.vals,function(t,r){e(t,n.keys[r],r)})},_initRemovedEvent:function(){var e=this,t=e._,n="removed",r;return t[n]=t[n]||new s,r=t[n].observer,r},_initChangedEvent:function(){var e=this,t=e._,n="changed",r;return t[n]=t[n]||new s({added:e._changedListenerAdded}),r=t[n].observer,r},_changedListenerAdded:function(e){e()},_initSizeProperty:function(){var e=this,t=e._,n="size",r;return t[n]=t[n]||gn(t.vals.length),r=t[n].asReadOnly(),r},subscribe:function(){var e=this,t=e._;return e.subscribe=dn(t.subscribed,t.unsubscribed),e.subscribe()},observed:function(){var e=this._,t=e.added,n=e.removed,r=e.changed;return t&&t.observed()||n&&n.observed()||r&&r.observed()},_insert:function(e,t,n){var r,i=this._,s=i.vals.length;for(r=n;r<s;r++)i.idxs[i.keys[r]]++;K(i.vals,n,e),K(i.keys,n,t),i.idxs[t]=n},add:function(e,t,n){var r=this._,i=r.vals.length;t=t||(r.key||tt)(e);if(t in r.idxs)throw _(t);return n=kt(n)?n:i,n<0&&(n=0),n>i&&(n=i),this._insert(e,t,n),r.size&&r.size.inc(),r.added&&r.added.fire(e,t,n),r.changed&&r.changed.fire(),t},remove:function(e){var t=this._,n,r,i;kt(e)?(n=e,e=t.keys[n]):n=t.idxs[e],r=t.vals[n];if(n>=0&&n<t.vals.length){for(i=n+1;i<t.keys.length;i++)t.idxs[t.keys[i]]--;J(t.vals,n),J(t.keys,n),delete t.idxs[e],t.size&&t.size.dec(),t.removed&&t.removed.fire(r,e,n),t.changed&&t.changed.fire()}},_getFromCache:function(e){var t=this._;return Et(e)?t.vals[t.idxs[e]]:t.vals[e]},get:function(e){var t=this,n=t._.get,r=n&&n().then(function(e){return t._setNewItems(e)});return o.wait(r).then(function(){return Ct(e)?t._asArray():t._getFromCache(e)})},index:function(e){return this._.idxs[e]},key:function(e){return this._.keys[e]},_setNewItems:function(e){var t=this,n=t._,r;if(!yt(e))return;for(r in n.idxs)(!(r in e)||n.vals[n.idxs[r]]!==e[r])&&t.remove(r);for(r in e)r in n.idxs||t.add(e[r],r)},empty:function(){var e=this._,t;if(e.removed)for(t=0;t<e.vals.length;t++)e.removed.fire(e.vals[t],e.keys[t]);e.vals=[],e.keys=[],e.idxs={},e.size&&e.size(0),e.changed&&e.changed.fire()},_addArray:function(e){for(var t=0;t<e.length;t++)this.add(e[t])},_asArray:function(){return this._.vals.slice(0)},asReadOnly:function(){function n(e){return arguments.length==0?t._asArray():t._getFromCache(e)}var e=n,t=this;return F(e,t),e._init(),e.add=null,e.remove=null,e.empty=null,e},fork:function(e){function r(e){return jt(e)?ln(Wt(e),e.enabled):xt(e)?cn(Wt(e)):c(P())}function i(e){return arguments.length==0?n():n(e)}var t=i,n=this;return F(t,n),Y(t,{add:r(e.add),remove:r(e.remove)}),t._init(),t},asWritable:function(e){return this.fork(e)}}),Y(p.prototype,{constructor:p,toString:function(){return"[Collection: "+this.size()+" items]"},each:function(e){return this.added(e),this.added.off(e),this},contains:function(e){var t=!1;return this.each(function(n){e(n)&&(t=!0)}),t},observe:function(e){function s(e,t){r[t]=e,delete i[t],u()}function o(e,t){i[t]=e,delete r[t],u()}function u(){t||(t=v(function(){var n=r,s=i;r={},i={},t=null,e(n,s)},0))}function a(){t&&(m(t),t=null)}var t,n=this,r={},i={};return n.added(s),n.removed(o),{dispose:function(){a(),n.added.off(s),n.removed.off(o)}}},map:function(e){var t=this,n,r=p({get:function(e){return t.get().then(function(){return r(e)})},subscribed:function(){n=t.subscribe()},unsubscribed:function(){n.dispose()}});return t.added(function(t,n,i){r.add(e(t),n,i)}),t.removed(function(e,t){r.remove(t)}),r.asReadOnly()},filter:function(e){var t=this,n,r=p({get:function(e){return t.get().then(function(){return r(e)})},subscribed:function(){n=t.subscribe()},unsubscribed:function(){n.dispose()}});return t.added(function(n,i,s){var o,u,a;if(!e(n))return;o=s+1,u=t.size();while(o<u&&!e(t(o)))o++;a=o<u?r.index(t.key(o)):r.size(),r.add(n,i,a)}),t.removed(function(e,t){r.remove(t)}),r.asReadOnly()},sort:function(e){function i(t,n){return e(t,n)||!e(n,t)}var t=this,n,r=p({get:function(e){return t.get().then(function(){return r(e)})},subscribed:function(){n=t.subscribe()},unsubscribed:function(){n.dispose()}});return t.added(function(e,n,s){var o=r.size(),u=0;while(u<o&&!i(e,r(u)))u++;while(u<o&&i(r(u),e)&&t.index(r.key(u))<s)u++;r.add(e,n,u)}),t.removed(function(e,t){r.remove(t)}),r.asReadOnly()}}),p.empty=p().asReadOnly();var Tn=function(t){function r(e){var t=function(t){return arguments.length==0?(n[e]||"")+"":(n[e]=(t||"")+"",this)};return t.toString=function(){return t()},t}var n;if(!(e instanceof Tn))return new Tn(t);n=Tn.pattern.exec((t||"")+"");if(!n)throw new SyntaxError("Invalid URI: "+t);e.scheme=r("scheme"),e.user=r("user"),e.host=r("host"),e.port=r("port"),e.path=r("path"),e.query=r("query"),e.hash=r("hash")};Tn.prototype.toString=function(){function e(e,t){return t?e+t:""}var t=(this.user()?this.user()+"@":"")+(this.host()||"")+e(":",this.port());return(this.scheme()?this.scheme()+":":"")+e("//",t)+this.path()+e("?",this.query())+e("#",this.hash())},Tn.pattern={regexp:/^(?:([a-zA-Z][\w+-.]*):)?(?:\/\/(?:([^/@]*)@)?([^:/?#]*)(?:\:(\d*))?)?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/,exec:function(e){var t=this.regexp.exec(e);return t&&{scheme:t[1],user:t[2],host:t[3],port:t[4],path:t[5],query:t[6],hash:t[7]}}},Tn.Query=function(e){if(!(this instanceof Tn.Query))return new Tn.Query(e);var t=this;Et(e)?it(e.split("&"),function(e){var n,r,i=e.indexOf("=");i<0?(n=e,r=""):(n=e.slice(0,i),r=e.slice(i+1)),n&&(t[decodeURIComponent(n)]=decodeURIComponent(r))}):e&&it(mt(e),function(e,n){t[n]=e+""})},Tn.Query.prototype.toString=function(){var e=[];return it(mt(this),function(t,n){e.push(t?encodeURIComponent(n)+"="+encodeURIComponent(t):encodeURIComponent(n))}),e.join("&")};var Nn={isInfo:V(At,100,199),isSuccess:V(At,200,299),isRedirection:V(At,300,399),isClientError:V(At,400,499),isServerError:V(At,500,599),isError:V(At,400,599),Unauthorized:401,ProxyAuthenticationRequired:407,ExpectationFailed:417,TooManyRequests:429,InternalServerError:500};try{return{isPromise:Pt,isCommand:jt,isProperty:Bt,isCollection:Ht,command:ln,disabledAsyncCommand:c,disabledCommand:l,enabledCommand:cn,event:s,async:Wt,promise:Jt,task:o,collection:p,property:h,constProperty:mn,boolProperty:yn,numProperty:gn}}catch(Mn){}}();return i}),define("jcafe-property-model",["jcafe-property-model/lib/propertyModel"],function(e){return e}),define("jSkype/modelHelpers/signIn/parameterBuilder",["require","exports","module","swx-enums","lodash-compat"],function(e,t){var n=e("swx-enums"),r=e("lodash-compat");t.createPasswordSignInParameter=function(e){if(!r.isString(e.username))throw new Error("Username not defined");if(!r.isString(e.password))throw new Error("Password not defined");return{username:e.username,password:e.password,type:n.authType.Password}},t.createImplicitOAuthSignInParameter=function(e){if(!r.isString(e.client_id))throw new Error("client_id not defined");return{client_id:e.client_id,type:n.authType.ImplicitOAuth}},t.createTokenImplicitOAuthSignInParameter=function(e){if(!r.isString(e.client_id))throw new Error("client_id not defined");if(!r.isString(e.skypetoken))throw new Error("skypetoken not defined");if(!r.isString(e.rps_token))throw new Error("rps_token not defined");if(!r.isNumber(e.expires_in))throw new Error("expires_in not defined");return{skypetoken:e.skypetoken,rps_token:e.rps_token,expires_in:e.expires_in,client_id:e.client_id,type:n.authType.ImplicitOAuth,site_name:e.site_name}},t.createGuestSignInParameter=function(e){if(!r.isString(e.displayName))throw new Error("DisplayName not defined");return{displayName:e.displayName,type:n.authType.Guest}},t.createTokenSignInParameter=function(e){if(!r.isFunction(e.getToken))throw new Error("getToken method is not defined");return{type:n.authType.Token,getToken:e.getToken}}}),define("jSkype/modelHelpers/propertyModelHelper",["require","exports","module","jcafe-property-model"],function(e,t){var n=e("jcafe-property-model");t.exposeReadOnlyCollection=function(e){function n(e,t){var n;for(n=0;n<e.size();++n)if(t(e(n)))return n;return-1}var t=e.asReadOnly();return t._add=e.add,t._remove=e.remove,t._removeAll=e.empty,t._removeByCondition=function(t){var r=n(e,t);r>=0&&e.remove(r)},t},t.createPropertyWithSetter=function(e,t,r){var i=n.property({value:!!r}),s=n.command(t,i),o=n.property({value:e,set:s});return o.set._enabled=i,o},t.createCommandWithSetter=function(e,t){var r=n.command(e,t);return r._enabled=t,r},t.createResolvedPromise=function(e){var t=n.task();return t.resolve(e),t.promise},t.createRejectedPromise=function(e){var t=n.task();return t.reject(e),t.promise},t.createCancellablePromiseFunction=function(e,n){return function(){return n()?t.createRejectedPromise():e()}}}),define("jSkype/modelHelpers/signIn/handlers/token",["require","exports","module","jSkype/modelHelpers/propertyModelHelper"],function(e,t){function r(e){if(e&&e.getToken)return{getToken:e.getToken};throw"Unknown signIn parameter"}var n=e("jSkype/modelHelpers/propertyModelHelper");t.handler=function(e){return n.createResolvedPromise(r(e))}}),define("jSkype/modelHelpers/signIn/handlers/password",["require","exports","module","jSkype/modelHelpers/propertyModelHelper"],function(e,t){function r(){return{getToken:function(){return!0}}}var n=e("jSkype/modelHelpers/propertyModelHelper");t.handler=function(){return n.createResolvedPromise(r())}}),function(){typeof SKYPE=="undefined"&&(window.SKYPE={}),SKYPE.linking=function(){var e={pre:"https://a.prelogin.skype.net",qa:"https://a.qalogin.skype.net",dogfood:"https://dogfood.login.skype.com",live:"https://a.login.skype.com"},t="/linking",n=null,r,i=null,s=!1,o="",u=!1,a={},f={env:"dogfood",theme:"skype-blue",client_id:null,redirect_uri:null,rps_token:null,setlang:null,welcome:!1,createTechnical:!1,microsoft:!0,hidden:!1,relink:!1,site_name:null},l=function(e){var t=["https://login.skype.com","https://prelogin.skype.net","https://qalogin.skype.net","https://a.pre.lw.skype.net","https://a.qa.lw.skype.net","https://a.lw.skype.com","https://a.prelogin.skype.net","https://a.qalogin.skype.net","https://a.login.skype.com"];return t.push(i),t.indexOf(e)!==-1},c=function(e){var t;if(!l(e.origin))return;var n=e.data;if(typeof n=="string")try{n=JSON.parse(e.data)}catch(r){}var i=n.state||null;if(o!==i)return;t={};for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s]);m(t)},h=function(e){return p(),n=document.createElement("iframe"),n.frameBorder=0,n.width="100%",n.height="100%",n.id="linkingFrame"+Math.floor(Math.random()*10+1),n.style.backgroundColor="#00AFF0",a.hidden&&(n.style.display="none"),n.setAttribute("src",e),n},p=function(){n&&(n.parentNode&&n.parentNode.removeChild(n),n=null)},d=function(){if(!a.client_id||!a.rps_token)throw"[linking.js] client_id not initialized. Call init() first.";if(a.createTechnical&&a.welcome)throw"[linking.js] cannot initialize both createTechnical and welcome flows at the same time.";a.redirect_uri||(a.redirect_uri=window.location.protocol+"//"+window.location.host+window.location.pathname)},v=function(){return"postMessage"in window&&typeof JSON=="object"&&JSON.parse},m=function(e){u=!1,typeof r=="function"&&r(e)},g=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},y=function(){var n,r=(new Date).getTime(),s;return i=e[a.env]||e.dogfood,o="linkingsdk_"+r,n={response_type:"postmessage",client_id:a.client_id,env:a.env,theme:a.theme,redirect_uri:a.redirect_uri,state:o},a.microsoft&&(n.partner="999"),a.setlang&&(n.setlang=a.setlang),a.relink&&(n.scenario="relink"),a.createTechnical&&(n.scenario="silentCreateTechnical"),a.welcome&&(n.scenario="welcome"),a.site_name&&(n.site_name=a.site_name),s=g(n)+"#access_token="+encodeURIComponent(a.rps_token),i+t+"?"+s},b=function(){a={},r=null,s=!1,o="",u=!1,window.addEventListener?window.removeEventListener("message",c):window.detachEvent("onmessage",c),p()},w=function(e){b();if(typeof e=="object"){e=e||{},e.hasOwnProperty("callback")&&E(e.callback);for(var t in f)e.hasOwnProperty(t)?a[t]=e[t]:a[t]=f[t]}return s||(s=!0,window.addEventListener?window.addEventListener("message",c):window.attachEvent("onmessage",c)),this},E=function(e){return typeof e=="function"&&(r=e),this},S=function(){if(u)return;d(),u=!0;if(!v()){m({error:"unsupported_browser"});return}return h(y())},x=function(e){var t=S();t&&e.appendChild(t)};return{init:w,setCallback:E,getIFrame:S,load:x}}()}(),define("swx-xco/lib/linking",function(){}),function(){typeof SKYPE=="undefined"&&(window.SKYPE={}),SKYPE.login=SKYPE.login||{},SKYPE.login.Silent=function(){var e={pre:"https://prelogin.skype.net",qa:"https://qalogin.skype.net",live:"https://login.skype.com"},t={pre:"https://a.pre.lw.skype.net",qa:"https://a.qa.lw.skype.net",live:"https://a.lw.skype.com"},n="/login/silent",r="1.0",i=null,s,o,u={},a=2e4,f=null,l=null,c="",h=!1,p=!1,d=null,v={env:"live",client_id:null,redirect_uri:null,microsoft:!1,use_azure:!1},m=function(e,t){d===null&&(d=window.location.host.match(/^(pre|qa).*\.net$/)||document.cookie.indexOf("debug")>-1||window.location.search.indexOf("debug")>-1);if(!d)return;try{if(typeof t=="object"){var n=[];for(var r in t)r==="skypetoken"?n.push(r+": "+"<HIDDEN>"):n.push(r+": "+JSON.stringify(t[r]));e+=" - "+n.join(", ")}else typeof t=="string"&&(e+=" - "+t);e="[silentlogin.js] - "+e}catch(i){}},g=function(e){m("Received message from "+e.origin);if(!l||e.origin!==l)return;var t=e.data;if(typeof e.data=="string")try{t=JSON.parse(e.data)}catch(n){}m("Message data",t);var r=t.state||null;if(c!==r){m("State "+r+" doesn't match the last submitted state "+c);return}window.clearTimeout(f),u={};for(var i in t)t.hasOwnProperty(i)&&(u[i]=t[i]);S()},y=function(e){b(),typeof s=="undefined"&&(s=document.body||document.head||document.getElementsByTagName("head")[0]),i=document.createElement("iframe"),i.frameBorder=0,i.width="1px",i.height="1px",i.style.display="none",i.style.visibility="hidden",i.id="silentLoginFrame"+Math.floor(Math.random()*10+1),i.setAttribute("tabindex",-1),i.setAttribute("src",e),s.appendChild(i),m("Created iFrame: "+e)},b=function(){i&&(s.removeChild(i),i=null)},w=function(){if(!v.client_id)throw"[silentlogin.js] client_id not initialized. Call init() first.";v.redirect_uri||(v.redirect_uri=window.location.protocol+"//"+window.location.host+window.location.pathname)},E=function(){return"postMessage"in window&&typeof JSON=="object"&&JSON.parse},S=function(){m("Calling callback function",u),p=!1,typeof o=="function"&&o(u)},x=function(){b(),u={},u.error="timeout",S()},T=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},N=function(){var i=(new Date).getTime(),s=e;c="silentloginsdk_"+i;var o={response_type:"postmessage",client_id:v.client_id,redirect_uri:v.redirect_uri,state:c,_accept:r,_nc:i};return v.microsoft&&(o.partner="999",s=v.use_azure?t:e),l=s[v.env]||s.live,l+n+"?"+T(o)},C=function(e){if(typeof e=="object"){e=e||{},e.hasOwnProperty("callback")&&k(e.callback);for(var t in v)e.hasOwnProperty(t)&&(v[t]=e[t])}return h||(h=!0,window.addEventListener?window.addEventListener("message",g,!1):window.attachEvent("onmessage",g)),this},k=function(e){return typeof e=="function"&&(o=e),this},L=function(){if(p)return;w(),p=!0;if(!E()){u={error:"unsupported_browser"},S();return}window.clearTimeout(f),f=window.setTimeout(x,a),y(N())},A=function(){return u.skypetoken||null},O=function(){return u};return{init:C,setCallback:k,load:L,getSkypetoken:A,getFullResponse:O}}()}(),define("swx-xco/lib/silentlogin",function(){}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-xco/lib/index",["require","exports","./linking","./silentlogin"],e)}(function(e,t){e("./linking"),e("./silentlogin"),t.linking=SKYPE.linking,t.silentLogin=SKYPE.login.Silent}),define("swx-xco",["swx-xco/lib/index"],function(e){return e}),define("jSkype/settings",["require","exports","module"],function(e,t){t.settings={flagsApiUrl:"",userOptionsService:{host:"",optionsEndpoint:""},contactsProxyService:{},stratusService:{host:"",avatarUrl:""},peopleService:{appId:"",settingsEndpoint:""},profileService:{appId:"",profileEndpoint:""}},t.isFeatureOn=function(e){return t.settings.featureFlags?Boolean(t.settings.featureFlags[e]):!1}}),define("jSkype/modelHelpers/signIn/handlers/implicitOAuth",["require","exports","module","lodash-compat","swx-xco","jSkype/settings","constants/common"],function(e,t){function u(e){return!!e.skypetoken&&!!e.expires_in&&!!e.rps_token}function a(e){var t=Promise.resolve(c(n.clone(e)));return f(e),t}function f(e){delete e.skypetoken,delete e.expires_in,delete e.rps_token,delete e.site_name}function l(e){var t=new Promise(function(t,n){function o(e){e&&e.skypetoken?t(c(e)):n(e||"unknown_error")}r.init({env:i.settings.xcoEnv,client_id:e.client_id,microsoft:!0,use_azure:i.isFeatureOn(s.featureFlags.USE_AZURE_BASED_SILENT_LOGIN)}),r.setCallback(o),r.load()});return t}function c(e){function r(){return e.skypetoken}function i(){var r=e.expires_in;return n.isNumber(r)?t+h(r):t+h(o)}function s(){return e.rps_token}function u(){return e.site_name}var t=Date.now();return{getToken:r,getExpiryTime:i,getRpsToken:s,getSiteName:u}}function h(e){return e*1e3}var n=e("lodash-compat"),r=e("swx-xco").silentLogin,i=e("jSkype/settings"),s=e("constants/common"),o=3600;t.handler=function(e){var t;return u(e)?t=a(e):t=l(e),t}}),define("jSkype/modelHelpers/signIn/handlers",["require","exports","module","swx-enums","jSkype/modelHelpers/signIn/handlers/token","jSkype/modelHelpers/signIn/handlers/password","jSkype/modelHelpers/signIn/handlers/implicitOAuth"],function(e,t,n){var r=e("swx-enums"),i=e("jSkype/modelHelpers/signIn/handlers/token").handler,s=e("jSkype/modelHelpers/signIn/handlers/password").handler,o=e("jSkype/modelHelpers/signIn/handlers/implicitOAuth").handler;n.exports={},n.exports[r.authType.Token]=i,n.exports[r.authType.Password]=s,n.exports[r.authType.ImplicitOAuth]=o}),define("jSkype/modelHelpers/signIn/skypeTokenManager",["require","exports","module","jcafe-property-model","jSkype/modelHelpers/signIn/handlers","swx-enums"],function(e,t){function o(e){function a(){return t&&!f()?l():p()}function f(){return o===i.authType.ImplicitOAuth?Date.now()>=t.getExpiryTime()-s:!1}function l(){var e={};return e.token=t.getToken?t.getToken():undefined,o===i.authType.ImplicitOAuth&&(e.rpsToken=t.getRpsToken(),e.siteName=t.getSiteName()),e}function c(e){d(e),this.resolve(l())}function h(e){this.reject(e)}function p(){var t=r[o],i=n.task();return o&&t?t(e).then(c.bind(i),h.bind(i)):i.reject("Unknown sign in parameters"),i.promise}function d(e){e&&(t=e)}e=e||{};var t,o=e.type||null,u=n.property({get:a});return{get:u.get.bind(u)}}var n=e("jcafe-property-model"),r=e("jSkype/modelHelpers/signIn/handlers"),i=e("swx-enums"),s=6e5;t.build=function(e){return new o(e)}}),define("jSkype/models/note",["require","jcafe-property-model"],function(e){function n(){this.type=t.property({readOnly:!0}),this.text=t.property({readOnly:!0})}var t=e("jcafe-property-model");return n}),define("jSkype/models/location",["require","jcafe-property-model"],function(e){function n(){this.type=t.property({readOnly:!0}),this.street=t.property({readOnly:!0}),this.city=t.property({readOnly:!0}),this.state=t.property({readOnly:!0}),this.country=t.property({readOnly:!0}),this.postalCode=t.property({readOnly:!0})}var t=e("jcafe-property-model");return n}),define("jSkype/models/capabilities",["require","jcafe-property-model"],function(e){function n(){this.chat=t.property({value:!1,readOnly:!0}),this.audio=t.property({value:!1,readOnly:!0}),this.video=t.property({value:!1,readOnly:!0}),this.groupAdd=t.property({value:!1,readOnly:!0}),this.screenSharing=t.property({value:!1,readOnly:!0}),this.dataCollaboration=t.property({value:!1,readOnly:!0}),this._groupChat=t.property({value:!1,readOnly:!0})}var t=e("jcafe-property-model");return n}),define("jSkype/models/phoneNumber",["require","jcafe-property-model"],function(e){function n(){this.type=t.property({readOnly:!0}),this.telUri=t.property({readOnly:!0}),this.displayString=t.property({readOnly:!0})}var t=e("jcafe-property-model");return n}),define("jSkype/modelHelpers/contacts/dataMappers/dataMaps",["require","exports","module","lodash-compat","swx-enums"],function(e,t){var n=e("lodash-compat"),r=e("swx-enums");t.contactTypeNames={agent:"agent",lync:"lync",msn:"msn",skype:"skype",pstn:"pstn"},t.phoneTypeKeys={Home:"0",Work:"1",Cell:"2",Other:"3"},t.contactTypes={},t.contactTypes[t.contactTypeNames.agent]="28",t.contactTypes[t.contactTypeNames.lync]="2",t.contactTypes[t.contactTypeNames.msn]="1",t.contactTypes[t.contactTypeNames.skype]="8",t.contactTypes[t.contactTypeNames.pstn]="4",t.phoneTypes={},t.phoneTypes[t.phoneTypeKeys.Home]=r.phoneType.Home,t.phoneTypes[t.phoneTypeKeys.Work]=r.phoneType.Work,t.phoneTypes[t.phoneTypeKeys.Cell]=r.phoneType.Cell,t.phoneTypes[t.phoneTypeKeys.Other]=r.phoneType.Other,t.contactTypesByCode=n.invert(t.contactTypes)}),define("jSkype/services/stratus/serviceSettings",["require","exports","module","jSkype/settings","constants/common"],function(e,t){function i(e){return"${"+e+"}"}var n=e("jSkype/settings"),r=e("constants/common");t.getHost=function(){return n.settings.stratusService.host},t.getAvatarEndPoint=function(e){return t.getHost()+n.settings.stratusService.avatarUrl.replace(t.tokens.contactId,encodeURIComponent(e))},t.getAvatarUpdateEndPoint=function(e){return n.settings.stratusService.avatarUpdateUrl.replace(t.tokens.contactId,e)},t.getProfileEndPoint=function(){return n.settings.stratusService.profileEndpoint},t.getProfilesEndPoint=function(){return n.settings.stratusService.profilesEndpoint},t.getProfilesEndPointV2=function(){return n.settings.stratusService.batchProfilesEndpoint},t.getUserInfoEndPoint=function(){return n.settings.stratusService.userInfoEndpoint},t.getContactsEndPoint=function(){return n.settings.stratusService.contactsEndpoint},t.getBlockContactEndpoint=function(e){return n.settings.stratusService.blockContactEndpoint.replace(t.tokens.contactId,encodeURIComponent(e))},t.getUnblockContactEndpoint=function(e){return n.settings.stratusService.unblockContactEndpoint.replace(t.tokens.contactId,encodeURIComponent(e))},t.getDeleteContactEndpoint=function(e){return n.settings.stratusService.deleteContactEndpoint.replace(t.tokens.contactId,encodeURIComponent(e))},t.getContactRequestEndpoint=function(){return n.settings.stratusService.contactRequestEndpoint},t.getTimeIntervalForContactRequests=function(){return n.settings.stratusService.contactRequestTimeInterval},t.getDelayForFirstContactRequest=function(){return n.settings.stratusService.firstContactRequestDelay},t.getDirectorySearchEndpoint=function(e){return n.isFeatureOn(r.featureFlags.DIRECTORY_SEARCH_SKYPE_AND_LYNC)?n.settings.stratusService.directorySearchEndpoint.replace(t.tokens.keyword,encodeURIComponent(e)):n.settings.stratusService.directorySearchEndpointSkypeOnly.replace(t.tokens.keyword,encodeURIComponent(e))},t.getDirectorySearchByIdEndpoint=function(e){return n.settings.stratusService.directorySearchByIdEndpoint.replace(t.tokens.skypeName,encodeURIComponent(e))},t.getRetryPolicy=function(){return n.settings.stratusService.retry},t.tokens={id:i("id"),contactId:i("contactId"),version:i("version"),keyword:i("keyword"),skypeName:i("skypeName"),reason:i("reason")}}),define("jSkype/services/contacts/serviceSettings",["require","exports","module","jSkype/settings"],function(e,t){function r(e,n,r,i){return i=i||t.reasons.default,e.replace(t.tokens.id,encodeURIComponent(n)).replace(t.tokens.version,r).replace(t.tokens.reason,i)}function i(e,t){return e.reduce(function(e,n){return e[n]=t(n),e},{})}function s(e){return t.name+"-"+e}function o(e){return"${"+e+"}"}var n=e("jSkype/settings");t.getHost=function(){return n.settings.contactsProxyService.host},t.getMyContactsEndpoint=function(e,t,i){return r(n.settings.contactsProxyService.myContactsEndpoint,e,t,i)},t.getMyDeltaContactsEndpoint=function(e,t,i){return r(n.settings.contactsProxyService.myDeltaContactsEndpoint,e,t,i)},t.getBlockContactEndpoint=function(e,r,i,s){return n.settings.contactsProxyService.blockContactEndpoint.replace(t.tokens.version,s).replace(t.tokens.id,encodeURIComponent(e)).replace(t.tokens.contactType,i).replace(t.tokens.contactId,r)},t.getUnblockContactEndpoint=function(e,r,i,s){return n.settings.contactsProxyService.unblockContactEndpoint.replace(t.tokens.version,s).replace(t.tokens.id,encodeURIComponent(e)).replace(t.tokens.contactType,i).replace(t.tokens.contactId,r)},t.getDeleteContactEndpoint=function(e,r,i,s){return n.settings.contactsProxyService.deleteContactEndpoint.replace(t.tokens.version,s).replace(t.tokens.id,encodeURIComponent(e)).replace(t.tokens.contactType,i).replace(t.tokens.contactId,r)},t.getRetryPolicy=function(){return n.settings.contactsProxyService.retry},t.name="CBLProxy",t.version="v1",t.actions=i(["getMyContacts","blockContact","deleteContact"],s),t.reasons={"default":"default",notification:"notification"},t.tokens=i(["id","contactId","contactType","version","reason"],o)}),define("jSkype/services/webapi/serviceSettings",["require","exports","module","jSkype/settings"],function(e,t){var n=e("jSkype/settings");t.getHost=function(){return n.settings.webApiServiceHost}}),define("jSkype/services/entitlement/serviceSettings",["require","exports","module","jSkype/settings"],function(e,t){function r(e){return t.name+"-"+e}function i(e){return"${"+e+"}"}var n=e("jSkype/settings");t.getHost=function(){return n.settings.entitlementService.host},t.getEntitlementListingEndpoint=function(e){return n.settings.entitlementService.listingEndpoint.replace(t.tokens.username,encodeURIComponent(e))},t.getEntitlementServiceEndpoint=function(e,r){return n.settings.entitlementService.serviceEndpoint.replace(t.tokens.username,encodeURIComponent(e)).replace(t.tokens.service,r)},t.getRetryPolicy=function(){return n.settings.entitlementService.retry},t.name="Entitlement",t.version="3.0",t.serviceNames={credit:"pstn"},t.actions={getEntitlementService:r("getEntitlementService")},t.tokens={username:i("username"),service:i("service")}}),!function(e,t,n){typeof module!="undefined"&&module.exports?module.exports=n():typeof define=="function"&&define.amd?define("reqwest/reqwest",n):t[e]=n()}("reqwest",this,function(){function succeed(e){var t=protocolRe.exec(e.url);return t=t&&t[1]||context.location.protocol,httpsRe.test(t)?twoHundo.test(e.request.status):!!e.request.response}function handleReadyState(e,t,n){return function(){if(e._aborted)return n(e.request);if(e._timedOut)return n(e.request,"Request is aborted: timeout");e.request&&e.request[readyState]==4&&(e.request.onreadystatechange=noop,succeed(e)?t(e.request):n(e.request))}}function setHeaders(e,t){var n=t.headers||{},r;n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"];var i=typeof FormData!="undefined"&&t.data instanceof FormData;!t.crossOrigin&&!n[requestedWith]&&(n[requestedWith]=defaultHeaders.requestedWith),!n[contentType]&&!i&&(n[contentType]=t.contentType||defaultHeaders.contentType);for(r in n)n.hasOwnProperty(r)&&"setRequestHeader"in e&&e.setRequestHeader(r,n[r])}function setCredentials(e,t){typeof t.withCredentials!="undefined"&&typeof e.withCredentials!="undefined"&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var i=uniqid++,s=e.jsonpCallback||"callback",o=e.jsonpCallbackName||reqwest.getcallbackPrefix(i),u=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),a=r.match(u),f=doc.createElement("script"),l=0,c=navigator.userAgent.indexOf("MSIE 10.0")!==-1;return a?a[3]==="?"?r=r.replace(u,"$1="+o):o=a[3]:r=urlappend(r,s+"="+o),context[o]=generalCallback,f.type="text/javascript",f.src=r,f.async=!0,typeof f.onreadystatechange!="undefined"&&!c&&(f.htmlFor=f.id="_reqwest_"+i),f.onload=f.onreadystatechange=function(){if(f[readyState]&&f[readyState]!=="complete"&&f[readyState]!=="loaded"||l)return!1;f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),t(lastValue),lastValue=undefined,head.removeChild(f),l=1},head.appendChild(f),{abort:function(){f.onload=f.onreadystatechange=null,n({},"Request is aborted: timeout",{}),lastValue=undefined,head.removeChild(f),l=1}}}function getRequest(e,t){var n=this.o,r=(n.method||"GET").toUpperCase(),i=typeof n=="string"?n:n.url,s=n.processData!==!1&&n.data&&typeof n.data!="string"?reqwest.toQueryString(n.data):n.data||null,o,u=!1;return(n["type"]=="jsonp"||r=="GET")&&s&&(i=urlappend(i,s),s=null),n["type"]=="jsonp"?handleJsonp(n,e,t,i):(o=n.xhr&&n.xhr(n)||xhr(n),o.open(r,i,n.async===!1?!1:!0),setHeaders(o,n),setCredentials(o,n),context[xDomainRequest]&&o instanceof context[xDomainRequest]?(o.onload=e,o.onerror=t,o.onprogress=function(){},u=!0):o.onreadystatechange=handleReadyState(this,e,t),n.before&&n.before(o),u?setTimeout(function(){o.send(s)},200):o.send(s),o)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){if(e===null)return undefined;if(e.match("json"))return"json";if(e.match("javascript"))return"js";if(e.match("text"))return"html";if(e.match("xml"))return"xml"}function init(o,fn){function complete(e){o.timeout&&clearTimeout(self.timeout),self.timeout=null;while(self._completeHandlers.length>0)self._completeHandlers.shift()(e)}function success(resp){var type=o.type||resp&&setType(resp.getResponseHeader("Content-Type"));resp=type!=="jsonp"?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=context.JSON?context.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);while(self._fulfillmentHandlers.length>0)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function timedOut(){self._timedOut=!0,self.request.abort()}function error(e,t,n){e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=n,self._erred=!0;while(self._errorHandlers.length>0)self._errorHandlers.shift()(e,t,n);complete(e)}this.url=typeof o=="string"?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){timedOut()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n=e.name,r=e.tagName.toLowerCase(),i=function(e){e&&!e.disabled&&t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))},s,o,u,a;if(e.disabled||!n)return;switch(r){case"input":/reset|button|image|file/i.test(e.type)||(s=/checkbox/i.test(e.type),o=/radio/i.test(e.type),u=e.value,(!s&&!o||e.checked)&&t(n,normalize(s&&u===""?"on":u)));break;case"textarea":t(n,normalize(e.value));break;case"select":if(e.type.toLowerCase()==="select-one")i(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(a=0;e.length&&a<e.length;a++)e.options[a].selected&&i(e.options[a])}}function eachFormElement(){var e=this,t,n,r=function(t,n){var r,i,s;for(r=0;r<n.length;r++){s=t[byTag](n[r]);for(i=0;i<s.length;i++)serial(s[i],e)}};for(n=0;n<arguments.length;n++)t=arguments[n],/input|select|textarea/i.test(t.tagName)&&serial(t,e),r(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}function buildParams(e,t,n,r){var i,s,o,u=/\[\]$/;if(isArray(t))for(s=0;t&&s<t.length;s++)o=t[s],n||u.test(e)?r(e,o):buildParams(e+"["+(typeof o=="object"?s:"")+"]",o,n,r);else if(t&&t.toString()==="[object Object]")for(i in t)buildParams(e+"["+i+"]",t[i],n,r);else r(e,t)}var context=this;if("window"in context)var doc=document,byTag="getElementsByTagName",head=doc[byTag]("head")[0];else{var XHR2;try{XHR2=require("xhr2")}catch(ex){throw new Error("Peer dependency `xhr2` required! Please npm install xhr2")}}var httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",uniqid=0,callbackPrefix="reqwest_"+ +(new Date),lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(e.crossOrigin===!0){var t=context[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(context[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return context[xmlHttpRequest]?new XMLHttpRequest:XHR2?new XHR2:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this},"catch":function(e){return this.fail(e)}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(arguments.length===0)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),e=="map"?t=serializeHash:e=="array"?t=reqwest.serializeArray:t=serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e,t){var n,r,i=t||!1,s=[],o=encodeURIComponent,u=function(e,t){t="function"==typeof t?t():t==null?"":t,s[s.length]=o(e)+"="+o(t)};if(isArray(e))for(r=0;e&&r<e.length;r++)u(e[r].name,e[r].value);else for(n in e)e.hasOwnProperty(n)&&buildParams(n,e[n],i,u);return s.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){e=e||{};for(var t in e)globalSetupOptions[t]=e[t]},reqwest}),define("reqwest",["reqwest/reqwest"],function(e){return e}),define("jSkype/services/serviceAccessLayer/builders/uriBuilder",[],function(){function e(){var e={fqdn:null,resource:null,queryParams:null};this.build=function(){var t=e.fqdn;return t+=e.resource!==null?e.resource:"",t+=e.queryParams!==null?r(e.queryParams):"",t},this.setDomain=function(t){var n=typeof t=="string";if(!n||t==="")throw new TypeError("domain must be a string");e.fqdn=t},this.setResource=function(t){e.fqdn.substring(0,6)==="skype:"?e.resource=t:e.resource=n(e.fqdn,t)},this.setQueryParams=function(t){var n={}.toString.call(t)==="[object Object]";if(!n&&t!==undefined)throw new Error("queryParams must be an object");e.queryParams=t||{}}}function t(e){var t=/^ *$/;if(e!==null&&e!==undefined)return e.toString().replace(t,"")}function n(e,t){var n="/",r=t[0]===n;return e[e.length-1]===n?t=r?t.substring(1):t:t=r?t:n+t,t}function r(e){function i(r){var i=t(e[r]);i&&n.push(r+"="+i)}var n=[],r="";for(var s in e)e.hasOwnProperty(s)&&i(s);return n.length>0&&(r="?"+n.join("&")),r}return e}),define("jSkype/services/serviceAccessLayer/builders/headerBuilder",[],function(){function e(){var e={};this.get=function(t){return t?e[t]:e},this.set=function(t,n){var r=/\s/;if(!t||!n)throw new Error('incorrect number of arguments supplied - expecting "key" and "value"');if(typeof t!="string"||typeof n!="string")throw new TypeError('"key" and "value" arguments must be of type String');if(r.test(t))throw new SyntaxError("header name cannot contain any whitespace");e[t]=n},this.populate=function(e){function r(){for(var t in e)e.hasOwnProperty(t)&&n.set(t,e[t])}var n=this;t(e)&&r()},this.build=function(t){function n(){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}if(typeof t!="function")throw new TypeError("argument must be a callback function");n()}}function t(e){var t={}.toString.call(e)==="[object Object]";return!!e&&t}return e}),define("jSkype/services/serviceAccessLayer/builders/factory",["require","jSkype/services/serviceAccessLayer/builders/uriBuilder","jSkype/services/serviceAccessLayer/builders/headerBuilder"],function(e){var t=e("jSkype/services/serviceAccessLayer/builders/uriBuilder"),n=e("jSkype/services/serviceAccessLayer/builders/headerBuilder"),r={uriBuilder:function(){return new t},headerBuilder:function(){return new n}},i={get:function(e){var t=r[e];if(typeof t=="function")return t()}};return i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-i18n/lib/plurals",["require","exports"],e)}(function(e,t){function a(e,t){t||(t=u);var s,a=null,f="";for(s in o)o[s].languages.indexOf(t)!==-1&&(a=s);switch(a){case"group0":f=e===1?n:r;break;case"group1":f=e===1?n:i;break;case"group2":f=e>1?i:n;break;case"group3":f=e%10===1&&e%100!==11?n:e===0?r:i;break;case"group4":f=e===1||e===11?n:e===2||e===12?r:i;break;case"group5":f=e===1?n:e===0||e%100>0&&e%100<20?r:i;break;case"group6":f=e%10===1&&e%100!==11?n:e%10>=2&&(e%100<10||e%100>=20)?i:r;break;case"group7":f=e%10===1&&e%100!==11?n:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?r:i;break;case"group8":f=e===1?n:e>=2&&e<=4?r:i;break;case"group9":f=e===1?n:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?r:i;break;case"group11":f=e===1?n:e>=2&&e<=10?r:i;break;case"group12":f=e===1?n:e===2?r:i;break;default:f=""}return f}function f(e){u=e}var n="",r="_few",i="_many",s={af:"af",am:"am",ar:"ar",as:"as",az:"az",be:"be",bg:"bg",bn:"bn",bs:"bs",chr:"chr",ca:"ca",cs:"cs",cy:"cy",da:"da",de:"de",el:"el",en:"en",es:"es",et:"et",eu:"eu",fa:"fa",fi:"fi",fil:"fil",fr:"fr",ga:"ga",gd:"gd",gl:"gl",gu:"gu",ha:"ha",he:"he",hi:"hi",hr:"hr",hu:"hu",hy:"hy",id:"id",ig:"ig",is:"is",it:"it",iw:"iw",ja:"ja",ka:"ka",kk:"kk",km:"km",kn:"kn",ko:"ko",kok:"kok",ku:"ku",ky:"ky",lb:"lb",lt:"lt",lv:"lv",mi:"mi",ml:"ml",mn:"mn",mr:"mr",ms:"ms",ne:"ne",nl:"nl",nn:"nn",nb:"nb",no:"no",nso:"nso",or:"or",pa:"pa",pl:"pl",prs:"prs",pt_br:"pt-br",pt_pt:"pt-pt",qps:"qps",qut:"qut",quz:"quz",ro:"ro",ru:"ru",rw:"rw",sd:"sd",si:"si",sl:"sl",sk:"sk",sq:"sq",sr:"sr",sv:"sv",sw:"sw",ta:"ta",te:"te",tg:"tg",th:"th",ti:"ti",tk:"tk",tn:"tn",tr_tr:"tr-tr",tt:"tt",ug:"ug",uk:"uk",ur:"ur",uz:"uz",vi:"vi",wo:"wo",xh:"xh",yo:"yo",zh:"zh",zu:"zu"},o={group0:{languages:[s.ja,s.id,s.ko,s.tr_tr,s.vi,s.zh,s.az,s.ig,s.fa,s.ka,s.km,s.kn,s.ms,s.prs,s.th,s.tt,s.ug,s.wo,s.yo]},group1:{languages:[s.bg,s.ca,s.cy,s.da,s.de,s.el,s.en,s.es,s.et,s.fi,s.he,s.hu,s.it,s.iw,s.nb,s.nl,s.no,s.pt_pt,s.qps,s.sv,s.af,s.as,s.bn,s.chr,s.eu,s.gl,s.gu,s.ha,s.hy,s.is,s.kk,s.kok,s.ku,s.ky,s.lb,s.mi,s.ml,s.mn,s.mr,s.ne,s.nn,s.or,s.pa,s.qut,s.quz,s.rw,s.sd,s.si,s.sq,s.sw,s.ta,s.te,s.tk,s.tn,s.ur,s.xh,s.zu]},group2:{languages:[s.fr,s.pt_br,s.am,s.fil,s.hi,s.nso,s.tg,s.ti,s.uz]},group3:{languages:[s.lv]},group4:{languages:[s.gd]},group5:{languages:[s.ro]},group6:{languages:[s.lt]},group7:{languages:[s.ru,s.uk,s.hr,s.sr,s.be,s.bs,s.sl]},group8:{languages:[s.cs,s.sk]},group9:{languages:[s.pl]},group11:{languages:[s.ga]},group12:{languages:[s.ar]}};t.pluralizationLocale=s;var u=s.en;t.getPluralSuffix=a,t.setLocale=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-i18n/lib/resources",["require","exports","lodash-compat"],e)}(function(e,t){function i(e){if(!e)throw new Error("[i18n / resources] Specified destination for localizations resources is not reachable")}function s(e){i(e),r=e}function o(e){i(e),r=n.merge(r,e)}function u(){return r}var n=e("lodash-compat"),r={};t.set=s,t.merge=o,t.get=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-i18n/lib/localization",["require","exports","./plurals","./resources"],e)}(function(e,t){function i(e){var t=r.get(),n=t&&t[e]||e;return n}var n=e("./plurals"),r=e("./resources");t.fetch=function(e){if(typeof e!="object")throw new Error("[i18n / localization] Argument must be type of object");var t=e.key,r,s,o,u,a;if(!t)throw new Error("[i18n / localization] Missing key");r=i(t),e.count!==undefined&&(s=e.count,e.params=e.params||{},e.params.count=s,o=n.getPluralSuffix(s,e.locale),t+=o);if(e.params){r=i(t);for(u in e.params)if(e.params.hasOwnProperty(u)){a=e.params[u];if(typeof a=="function")throw new Error("[i18n / localization] Replacement value must not be a function");r=r.replace(new RegExp("{"+u+"}","g"),a)}}return r}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-i18n/lib/knockoutBindingExtensions",["require","exports","./localization"],e)}(function(e,t){function r(e){e.bindingHandlers.l10n={update:function(t,r,i,s,o){var u=e.utils.unwrapObservable(r()),a=u.params,f,l;for(l in a)a.hasOwnProperty(l)&&typeof a[l]=="function"&&(a[l]=e.utils.unwrapObservable(a[l]()));f=n.fetch(u),e.bindingHandlers.html.update(t,function(){return f},i,s,o)}},e.bindingHandlers.l10n_attr={update:function(t,r,i,s,o){function l(){var e={};return e[f]=a,e}var u=e.utils.unwrapObservable(r()),a,f;for(f in u)u.hasOwnProperty(f)&&(a=n.fetch({key:u[f]}),e.bindingHandlers.attr.update(t,l,i,s,o))}}}var n=e("./localization");t.init=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-i18n/lib/index",["require","exports","./knockoutBindingExtensions","./localization","./plurals","./resources"],e)}(function(e,t){var n=e("./knockoutBindingExtensions");t.knockoutBindingExtensions=n;var r=e("./localization");t.localization=r;var i=e("./plurals");t.plurals=i;var s=e("./resources");t.resources=s}),define("swx-i18n",["swx-i18n/lib/index"],function(e){return e}),define("services/g11n/default",[],function(){return{calendar:{days:{names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],namesAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},months:{names:["January","February","March","April","May","June","July","August","September","October","November","December"],namesAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},firstDay:0},time:{AM:"am",PM:"pm",separator:":",format:{duration:"mm:ss","short":"h:mm tt","long":"h:mm:ss tt"}},date:{separator:"/",format:{dayMonth:"M/d",dayMonthYear:"M/d/yy",dayAbbr:"dAbbr",dayName:"dName",dateAbbr:"mAbbr d yyyy",shortDateAbbr:"mAbbr d"}},dir:"ltr"}}),define("services/g11n/formatter",[],function(){function n(e){return/HH|H|hh|h/.test(e)}function r(e){return/mm|m/.test(e)}var e=/dName|dAbbr|mName|mAbbr|dd|d|MM|M|yyyy|yy|HH|H|hh|h|mm|m|tt|ss|s|'[^']*'|'[^']*'/g,t=function(t,n,r){var i=r.calendar,s=r.time,o=i.days,u=i.months;return n.replace(e,function(e){var n;switch(e){case"dName":n=o.names[t.getDay()];break;case"dAbbr":n=o.namesAbbr[t.getDay()];break;case"mName":n=u.names[t.getMonth()];break;case"mAbbr":n=u.namesAbbr[t.getMonth()];break;case"tt":n=t.getHours()<12?s.AM:s.PM;break;case"yyyy":n=t.getFullYear();break;case"yy":n=t.getFullYear()%100;break;case"d":n=t.getDate();break;case"dd":n=t.getDate(),n.toString().length===1&&(n="0"+n);break;case"M":n=t.getMonth()+1;break;case"MM":n=t.getMonth()+1,n.toString().length===1&&(n="0"+n);break;case"h":n=t.getHours()%12||12;break;case"hh":n=t.getHours()%12||12,n.toString().length===1&&(n="0"+n);break;case"H":n=t.getHours();break;case"HH":n=t.getHours(),n.toString().length===1&&(n="0"+n);break;case"m":n=t.getMinutes();break;case"mm":n=t.getMinutes(),n.toString().length===1&&(n="0"+n);break;case"s":n=t.getSeconds();break;case"ss":n=t.getSeconds(),n.toString().length===1&&(n="0"+n)}return n!==undefined?n:e.slice(1,e.length-1)})},i=function(t,i){var s,o;return n(i)&&(s=Math.floor(t/60/60),t-=s*60*60),r(i)&&(o=Math.floor(t/60),t-=o*60),i.replace(e,function(e){var n;switch(e){case"h":n=s;break;case"hh":n=s,n.toString().length===1&&(n="0"+n);break;case"H":n=s;break;case"HH":n=s,n.toString().length===1&&(n="0"+n);break;case"m":n=o;break;case"mm":n=o,n.toString().length===1&&(n="0"+n);break;case"s":n=t;break;case"ss":n=t,n.toString().length===1&&(n="0"+n)}return n!==undefined?n:e.slice(1,e.length-1)})};return{formatDate:t,formatDuration:i}}),define("browser/document",[],function(){return document}),define("services/g11n/globalization",["require","exports","module","services/g11n/default","services/g11n/formatter","browser/document"],function(e,t){function s(e,t){e.dir||(e.dir=t)}var n=e("services/g11n/default"),r=e("services/g11n/formatter"),i=e("browser/document");t.init=function(e){n=e},t.initLocaleDirection=function(e){var t=i.documentElement;t.dir?s(e,t.dir):n.dir&&s(e,n.dir)},t.formatDate=function(e,t){var i=n.time.format[t];i||(i=n.date.format[t]);if(!i)throw new Error("No format found with a key:"+t+"in settings of:"+n.locale);return r.formatDate(e,i,n)},t.formatDuration=function(e,t){var i=n.time.format[t];if(!i)throw new Error("No format found with a key:"+t+"in settings of:"+n.locale);return r.formatDuration(e,i)}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-pubsub/lib/pubSub",["require","exports"],e)}(function(e,t){function n(e){for(var t in e)if(!e[t])throw new Error(t+" is mandatory")}function r(e,t){return t&&t.indexOf(e)>=0}function i(e,t){if(!t||!r(e,t))return;t.splice(t.indexOf(e),1)}var s=function(){function e(){this.callbacks={}}return e.prototype.subscribe=function(e,t){n({eventName:e,callback:t}),this.callbacks[e]=this.callbacks[e]||[],r(t,this.callbacks[e])||this.callbacks[e].push(t)},e.prototype.unsubscribe=function(e,t){n({eventName:e,callback:t});var r=this.callbacks[e];i(t,r)},e.prototype.publish=function(e,t){n({eventName:e});if(this.callbacks[e]){var r=this.callbacks[e].slice(0);for(var i=r.length-1;i>=0;i--)r[i](t)}},e.prototype.unsubscribeAll=function(){this.callbacks={}},e}();t.__esModule=!0,t["default"]=s}),define("swx-pubsub",["swx-pubsub/lib/pubSub"],function(e){return e}),define("services/pubSub/pubSub",["require","lodash-compat","swx-pubsub"],function(e){var t=e("lodash-compat"),n=e("swx-pubsub").default,r=new n;return t.bindAll(r,"subscribe","unsubscribe","publish","unsubscribeAll"),r}),define("utils/chat/dateTime",["require","swx-i18n","services/g11n/globalization","constants/common","browser/window","services/pubSub/pubSub"],function(e){function d(e){return e===0||e>0}function v(e,t){var r=p.getDate(e);return n.formatDate(r,t)}function m(e,t){var n=l.time.SHORT,r=e<E(6,t),i=e<t;return r?n=l.date.DAY_MONTH:i&&(n=l.date.DAY_ABBREVIATION),n}function g(e){var t=p.getDate(e).getFullYear(),n=p.getDate().getFullYear();return t===n?l.date.SHORT_DATE_ABBREVIATION:l.date.DATE_ABBREVIATION}function y(){var e=p.getDate(),t=e.getTime(),n=e.setHours(24,0,0,0);return n-t}function b(){var e=p.getDate();e.setHours(0,0,0,0);var t=h<e;return t&&(h=e),t}function w(){i.setTimeout(function(){b()&&s.publish(c),w()},y()+o)}function E(e,t){var n=t?p.getDate(t):p.getDate(),r=n.setDate(n.getDate()-e);return p.getDate(r).setHours(0,0,0,0)}var t=e("swx-i18n").localization,n=e("services/g11n/globalization"),r=e("constants/common"),i=e("browser/window"),s=e("services/pubSub/pubSub"),o=1e3,u=o*60,a=u*60,f=a*24,l=r.globalizationFormatKeys,c=r.events.system.DATE_CHANGED,h,p;return p={amNotifyingDayChange:!1,now:function(){return i.Date.now()},getDate:function(){return arguments.length===1?new i.Date(arguments[0]):new i.Date},formatDate:function(e){return d(e)?v(e,g(e)):""},formatTimestampShort:function(e){return d(e)?v(e,l.time.SHORT):""},formatTimestamp:function(e,t){if(d(e)){var n=t||this.getMidnight(p.getDate().getTime()),r=m(e,n);return v(e,r)}return""},getDateGroup:function(e){if(d(e)){var r=p.getDate(e),i=this.getMidnight(e),s=p.getDate().setHours(0,0,0,0),o=E(1),u=E(7);return i===s?t.fetch({key:"today"}):i===o?t.fetch({key:"yesterday"}):i<u?t.fetch({key:"olderThanAWeek"}):n.formatDate(r,l.date.DAY_NAME)}return""},getMidnight:function(e){return d(e)?p.getDate(e).setHours(0,0,0,0):0},formatCallDuration:function(e){return n.formatDuration(e,l.time.CALL_DURATION)},notifyOnDayChange:function(){this.amNotifyingDayChange||(this.amNotifyingDayChange=!0,h=p.getDate(),h.setHours(0,0,0,0),w())},getTimeSinceTimestamp:function(e,n){n=n||{},n.now=n.now||p.now(),n.key=n.key||"duration";if(d(e)&&d(n.now)){var r=n.now-e;return Math.floor(r/f)>0?t.fetch({key:n.key+"_days",count:Math.floor(r/f),params:n.params}):Math.floor(r/a)>0?t.fetch({key:n.key+"_hours",count:Math.floor(r/a),params:n.params}):Math.floor(r/u)>0?t.fetch({key:n.key+"_minutes",count:Math.floor(r/u),params:n.params}):t.fetch({key:n.key+"_moment",params:n.params})}return""}},p}),define("jSkype/services/serviceAccessLayer/decorations/retry",["require","exports","module","lodash-compat","jSkype/settings","utils/chat/dateTime"],function(e,t){function o(e){return i.now()-e}function u(e,t){return e<t&&r.settings.retry.enabled}function a(e,t,n){return t===s.INCREMENTAL?n*e:t===s.EXPONENTIAL?Math.pow(2,e-1)*n:n}function f(e,t,r,i){function s(){e(++t)}n.delay(s,a(t,r,i))}function l(){return!1}var n=e("lodash-compat"),r=e("jSkype/settings"),i=e("utils/chat/dateTime"),s={INCREMENTAL:"incremental",EXPONENTIAL:"exponential",FIXED:"fixed"};r.settings.retry=r.settings.retry||{},t.STRATEGIES=s,t.build=function(t,n){var a=n.limit||r.settings.retry.limit||1,c=n.delay||r.settings.retry.delay||1e3,h=n.strategy||r.settings.retry.strategy||s.FIXED,p=n.isTransientCheck||l,d=n.isSuccessCheck||l;return function(n){return new Promise(function(e,r){function s(i){t(n).then(function(t){e(l(t,i))},function(t){if(d(t)){var n={request:t};e(l(n,i))}else u(i,a)&&p(t)?f(s,i,h,c):r(l(t,i))})}function l(e,t){return t>1&&(e.retryCount=t,e.ttc=o(v)),e}var v=i.now();s(1)})}}}),define("jSkype/services/serviceAccessLayer/decorations/availability",["require","exports","module","lodash-compat"],function(e,t){function r(e,t){var r=n.clone(e);return r.url=t,r}function i(e,t){return e<t}function s(){return!1}var n=e("lodash-compat");t.build=function(t,n){var o=n.alternateUrls||[],u=n.isTransientCheck||s;return function(n){function f(){return Promise.resolve(t(r(n,a[s])))}function l(e){if(!i(++s,a.length)||!u(e))throw e;f(s).catch(l)}var s=0,a=[n.url].concat(o);return f(s).catch(l)}}}),define("jSkype/services/serviceAccessLayer/serviceQosReporter",["require","exports","module","lodash-compat","jSkype/client","jSkype/settings"],function(e,t){function o(){function u(r,i,s){if(o===0||!r)return!1;s=s||{};var u=r;n.forIn(s,function(e,t){l(t)&&(u+=t+e)}),t[u]||(t[u]={total:0,success:0,serviceName:r,payload:s}),i&&t[u].success++,t[u].total++,e++,e>=o&&(a(),t={},e=0)}function a(){Object.keys(t).forEach(function(e){var t=f(e);r.get()._telemetryManager.sendEvent(i.settings.telemetry.jSkypeTenantToken,s,t)})}function f(e){var r=t[e].success,i=t[e].total,s=t[e].serviceName,o=t[e].payload,u=i-r,a=Math.round(r/i*100),f={service_id:s,qos:a.toString(),success_count:r.toString(),failure_count:u.toString()};return n.forIn(o,function(e,t){l(t)&&e&&(f[t]=e.toString())}),f}function l(e){return!n.includes(["serviceName","service_id","success_count","failure_count"],e)}var e=0,t={},o=i.settings.serviceQosReporter.iterationCountBeforeFlushingQoSMetrics;this.reportSuccess=function(t,n){return u(t,!0,n)},this.reportFail=function(t,n){return u(t,!1,n)}}var n=e("lodash-compat"),r=e("jSkype/client"),i=e("jSkype/settings"),s="service_qos";t.build=function(){return new o}}),define("jSkype/services/serviceAccessLayer/serviceQosReporterFacade",["require","exports","module","jSkype/services/serviceAccessLayer/serviceQosReporter"],function(e,t){var n=e("jSkype/services/serviceAccessLayer/serviceQosReporter"),r=null;t.getInstance=function(){return r||(r=n.build()),r}}),define("telemetry/chat/telemetryEnumerator",["require","constants/common","swx-enums"],function(e){function r(){function u(t,n){if(t===0)return e.enums.CONVERSATION.ZERO;if(t===1)return e.enums.CONVERSATION.ONE;if(t===2)return e.enums.CONVERSATION.TWO;if(t===3)return e.enums.CONVERSATION.THREE;if(t===4)return e.enums.CONVERSATION.FOUR;if(t===5)return e.enums.CONVERSATION.FIVE;if(t>5&&t<=10)return e.enums.CONVERSATION.LESS_10;if(t>10&&t<=15)return e.enums.CONVERSATION.LESS_15;if(t>15&&t<=20)return e.enums.CONVERSATION.LESS_20;if(t>20&&t<=50)return e.enums.CONVERSATION.LESS_50;if(n&&t>50)return Math.round(t/50)+e.enums.CONVERSATION.MORE_50;if(t>50&&t<=100)return e.enums.CONVERSATION.LESS_100;if(t>100)return Math.round(t/100)+e.enums.CONVERSATION.MORE_100}function a(e){return Math.round(e/1e3)}var e=this,r=6e4,i=60*r,s=24*i,o=t.telemetry.NOT_AVAILABLE;e.enums={GROUP_TYPE:{ZERO:"zero",ONE:"1",TWO:"2",LESS_5:"3-5",LESS_10:"5-10",LESS_25:"10-25",LESS_50:"25-50",LESS_100:"50-100",MORE_100:"x100"},TIMEDELTA:{MIN_1:"1MIN",MIN_5:"5MIN",MIN_10:"10MIN",MIN_30:"30MIN",HOUR_1:"1HOUR",HOUR_3:"3HOUR",HOUR_6:"6HOUR",HOUR_9:"9HOUR",HOUR_12:"12HOUR",HOUR_18:"18HOUR",HOUR_24:"24HOUR",DAYS:"DAY"},CONTACTS:{ZERO:"zero",LESS_5:"1-5",LESS_10:"5-10",LESS_25:"10-25",LESS_50:"25-50",LESS_100:"50-100",LESS_150:"100-150",LESS_200:"150-200",MORE_200:"x200"},CONVERSATION:{ZERO:"zero",ONE:"1",TWO:"2",THREE:"3",FOUR:"4",FIVE:"5",LESS_10:"5-10",LESS_15:"10-15",LESS_20:"15-20",LESS_50:"20-50",MORE_50:"x50",LESS_100:"50-100",MORE_100:"x100"},LIFETIME:{MIN:"1MIN",LESS_5MIN:"5MIN",LESS_10MIN:"10MIN",LESS_20MIN:"20MIN",LESS_1HOUR:"1hour",LESS_1DAY:"1DAY",LESS_2DAYS:"2DAYS",LESS_4DAYS:"3_4_DAYS",LESS_6DAYS:"5_6_DAYS",LESS_14DAYS:"7_14_DAYS",LESS_21DAYS:"15_21_DAYS",LESS_29DAYS:"22_29_DAYS"},URL_CONTENT_TYPE:{YOUTUBE:"YT",GIF:"GIF",TWITTER:"TWIT",OTHER:"WWW"},URL_POSITION:{URL_ONLY:"URL",TEXT_WITH_URL:"URL_MID",TEXT_ENDING_WITH_URL:"URL_END"},DURATION:{NA:"n/a",ZERO:"0SEC",ONE:"1SEC",TWO:"2SEC",THREE:"3SEC",FOUR:"4SEC",FIVE:"5SEC",LESS_10:"5-10SEC",MORE_10:"x10SEC"},NET_CODE:{OK:{START:200,END:399},ERROR:{START:400,END:599}},FILE_TYPE_GROUP:{PICTURE:"picture",VIDEO:"video",AUDIO:"audio",OFFICE:"office",ARCHIVE:"archive",BINARY:"binary",PDF:"pdf",OTHER:"other"}},e.getFileTypeGroup=function(t){switch(t){case"png":case"jpg":case"gif":case"bmp":case"tiff":return e.enums.FILE_TYPE_GROUP.PICTURE;case"avi":case"mp4":case"mkv":case"wmv":case"m4v":return e.enums.FILE_TYPE_GROUP.VIDEO;case"mp3":case"cda":case"m4a":case"wav":return e.enums.FILE_TYPE_GROUP.AUDIO;case"xls":case"xlsx":case"xlsm":case"doc":case"docx":case"ppt":case"pptx":return e.enums.FILE_TYPE_GROUP.OFFICE;case"zip":case"rar":case"ace":case"7z":case"dmg":return e.enums.FILE_TYPE_GROUP.ARCHIVE;case"exe":case"msi":case"iso":return e.enums.FILE_TYPE_GROUP.BINARY;case"pdf":return e.enums.FILE_TYPE_GROUP.PDF;default:return e.enums.FILE_TYPE_GROUP.OTHER}},e.getDurationGroup=function(t){if(t<=r)return e.enums.TIMEDELTA.MIN_1;if(t>r&&t<=5*r)return e.enums.TIMEDELTA.MIN_5;if(t>5*r&&t<=10*r)return e.enums.TIMEDELTA.MIN_10;if(t>10*r&&t<=30*r)return e.enums.TIMEDELTA.MIN_30;if(t>30*r&&t<=i)return e.enums.TIMEDELTA.HOUR_1;if(t>i&&t<=3*i)return e.enums.TIMEDELTA.HOUR_3;if(t>3*i&&t<=6*i)return e.enums.TIMEDELTA.HOUR_6;if(t>6*i&&t<=9*i)return e.enums.TIMEDELTA.HOUR_9;if(t>9*i&&t<=12*i)return e.enums.TIMEDELTA.HOUR_12;if(t>12*i&&t<=18*i)return e.enums.TIMEDELTA.HOUR_18;if(t>18*i&&t<=24*i)return e.enums.TIMEDELTA.HOUR_24;if(t>s)return Math.round(t/s)+e.enums.TIMEDELTA.DAYS},e.getParticipantCountGroup=function(t){if(t===0)return e.enums.GROUP_TYPE.ZERO;if(t===1)return e.enums.GROUP_TYPE.ONE;if(t===2)return e.enums.GROUP_TYPE.TWO;if(t>2&&t<=5)return e.enums.GROUP_TYPE.LESS_5;if(t>5&&t<=10)return e.enums.GROUP_TYPE.LESS_10;if(t>10&&t<=25)return e.enums.GROUP_TYPE.LESS_25;if(t>25&&t<=50)return e.enums.GROUP_TYPE.LESS_50;if(t>50&&t<=100)return e.enums.GROUP_TYPE.LESS_100;if(t>100)return Math.round(t/100)+e.enums.GROUP_TYPE.MORE_100},e.getMessageType=function(e){switch(e.model.type()){case n.activityType.TextMessage:if(e.previews){var t=e.previews();if(t.length>0)return t[0].type()}return n.activityType.TextMessage;case n.activityType.VideoMessage:case n.activityType.PictureMessage:case n.activityType.MojiMessage:case n.activityType.FileTransfer:return e.model.type();default:return o}},e.getContactsGroup=function(t){if(t===0)return e.enums.CONTACTS.ZERO;if(t>=1&&t<=5)return e.enums.CONTACTS.LESS_5;if(t>5&&t<=10)return e.enums.CONTACTS.LESS_10;if(t>10&&t<=25)return e.enums.CONTACTS.LESS_25;if(t>25&&t<=50)return e.enums.CONTACTS.LESS_50;if(t>50&&t<=100)return e.enums.CONTACTS.LESS_100;if(t>100&&t<=150)return e.enums.CONTACTS.LESS_150;if(t>150&&t<=200)return e.enums.CONTACTS.LESS_200;if(t>200)return Math.round(t/200)+e.enums.CONTACTS.MORE_200},e.getConversationCountGroup=function(e){return u(e)},e.getMessageCountGroup=function(e){return u(e,!0)},e.getSecondsDurationGroup=function(t){return t===0?e.enums.DURATION.ZERO:t===1?e.enums.DURATION.ONE:t===2?e.enums.DURATION.TWO:t===3?e.enums.DURATION.THREE:t===4?e.enums.DURATION.FOUR:t===5?e.enums.DURATION.FIVE:t>5&&t<=10?e.enums.DURATION.LESS_10:t>10?Math.round(t/10)+e.enums.DURATION.MORE_10:e.enums.DURATION.NA},e.getSecondsDurationGroupFromMs=function(t){return e.getSecondsDurationGroup(a(t))},e.isError=function(t){return e.enums.NET_CODE.OK.START<=t&&t<e.enums.NET_CODE.OK.END?!1:e.enums.NET_CODE.ERROR.START<=t&&t<e.enums.NET_CODE.ERROR.END?!0:o},e.getUrlContentType=function(t){return t.indexOf("www.youtube.com")>-1?e.enums.URL_CONTENT_TYPE.YOUTUBE:/^http.*\.gif$/.exec(t)?e.enums.URL_CONTENT_TYPE.GIF:t.indexOf("twitter.com")>-1?e.enums.URL_CONTENT_TYPE.TWITTER:e.enums.URL_CONTENT_TYPE.OTHER},e.getMessageLifeDurationGroup=function(t){return t<r?e.enums.LIFETIME.MIN:t<5*r?e.enums.LIFETIME.LESS_5MIN:t<10*r?e.enums.LIFETIME.LESS_10MIN:t<20*r?e.enums.LIFETIME.LESS_20MIN:t<i?e.enums.LIFETIME.LESS_1HOUR:t<s?e.enums.LIFETIME.LESS_1DAY:t<2*s?e.enums.LIFETIME.LESS_2DAYS:t<4*s?e.enums.LIFETIME.LESS_4DAYS:t<6*s?e.enums.LIFETIME.LESS_6DAYS:t<14*s?e.enums.LIFETIME.LESS_14DAYS:t<21*s?e.enums.LIFETIME.LESS_21DAYS:t<29*s?e.enums.LIFETIME.LESS_29DAYS:o}}var t=e("constants/common"),n=e("swx-enums");return new r}),define("jSkype/services/serviceAccessLayer/serviceQosRetryReporter",["require","exports","module","jSkype/client","jSkype/settings","telemetry/chat/telemetryEnumerator"],function(e,t){function o(){this.publish=function(e){var t="serviceRetry_qos",s=e;s.ttcGroup=i.getSecondsDurationGroupFromMs(e.ttc),n.get()._telemetryManager.sendEvent(r.settings.telemetry.jSkypeTenantToken,t,s)}}var n=e("jSkype/client"),r=e("jSkype/settings"),i=e("telemetry/chat/telemetryEnumerator"),s;t.get=function(){return s||(s=new o),s}}),define("jSkype/services/webapi/constants",["require","exports","module"],function(e,t){t.SERVICE_CALLS={SET_THREAD_OPTION:"setThreadOption",SET_CONVERSATION_OPTION:"setConversationOption",PIN_TO_DOGFOOD:"pinToDogfood",CREATE_CONVERSATION:"createConversation",POST_MESSAGE:"postMessage",ADD_PARTICIPANT:"addParticipant",REMOVE_PARTICIPANT:"removeParticipant",SET_CONSUMPTION_HORIZON:"setConsumptionHorizon",FETCH_MESSAGES:"fetchMessages",FETCH_MESSAGES_LOAD_MORE:"fetchMessagesLoadMore",FETCH_THREAD:"fetchThread",FETCH_CONVERSATION:"fetchConversation",FETCH_CONVERSATIONS:"fetchConversations",FETCH_CONVERSATIONS_BY_SYNC_STATE:"fetchConversationsBySyncState",REQUEST_ENDPOINT_CREATION:"requestEndpointCreation",REQUEST_ENDPOINT_DELETION:"requestEndpointDeletion",REQUEST_SUBSCRIPTION_CREATION:"requestSubscriptionCreation",REQUEST_POLLING:"requestPolling",SET_ENDPOINT_PRESENCE:"setEndpointPresence",SET_ENDPOINT_PROPERTY:"setEndpointProperty",ACTIVATE_ENDPOINT:"activateEndpoint",SET_USER_PRESENCE:"setUserPresence",GET_USER_PRESENCE:"getUserPresence",SEND_CONTACT_LIST:"sendContactsList",ADD_CONTACT_TO_CONTACTS_LIST:"addContactToContactsList",REMOVE_CONTACT_FROM_CONTACTS_LIST:"removeContactFromContactsList",GET_SELF_PROPERTIES:"getSelfProperties",SET_MESSAGE_PROPERTY:"setMessageProperty",REMOVE_MESSAGE_PROPERTY:"removeMessageProperty",REMOVE_ALL_MESSAGES:"removeAllMessage",SET_FAVORITES:"setFavorites",GET_FAVORITES:"getFavorites"},t.ENDPOINT_PROPERTIES={SUPPORTS_MESSAGE_PROPERTIES:"supportsMessageProperties"},t.MESSAGE_PROPERTIES={GLOBAL:{ACTIVITY_DATA:"activityData",PINNED:"pinned",PROTOTYPE_SKYPEX:"prototype_skypex"},PER_USER:{EMOTIONS:"emotions",POLL:"poll",TRANSLATIONS:"translations"}},t.ACTIVATE_ENDPOINT_TIMEOUT=12e3,t.ACTIVATE_ENDPOINT_TOLERANCE=6e3}),define("jSkype/services/serviceAccessLayer/decorations/reporting",["require","exports","module","lodash-compat","constants/common","jSkype/client","jSkype/services/serviceAccessLayer/serviceQosReporterFacade","jSkype/services/serviceAccessLayer/serviceQosRetryReporter","jSkype/services/webapi/constants","jSkype/settings"],function(e,t){function f(e,t){var n=JSON.parse(t.response);n&&n.errorCode&&(e.errorCode=n.errorCode,e.errorMessage=n.message)}function l(e,t){var r=e.getAllResponseHeaders().toLowerCase();return n.contains(r,t)&&e.getResponseHeader(t)}function c(e,t){if(e.faultCode===404){if(l(t,"location")||t.response===undefined)return;try{f(e,t)}catch(n){}}var s=i.get()._telemetry.eventBus;s.publish(r.events.errors.SERVICE_FAILURE,e)}function h(e){return e&&p()}function p(){return a.isFeatureOn(r.featureFlags.SERVICE_FAILURE_REPORTING)}var n=e("lodash-compat"),r=e("constants/common"),i=e("jSkype/client"),s=e("jSkype/services/serviceAccessLayer/serviceQosReporterFacade"),o=e("jSkype/services/serviceAccessLayer/serviceQosRetryReporter"),u=e("jSkype/services/webapi/constants").SERVICE_CALLS,a=e("jSkype/settings");t.build=function(t,r){var i=r.serviceName,a=s.getInstance();return function(r){function f(e){var t={serviceName:i,verb:r.type,host:m(r.url)};return i==="webapi-"+u.REQUEST_POLLING&&e&&e.response&&e.response.eventMessages&&l(t,e.response),t}function l(e,t){var r=n.map(t.eventMessages,"resourceType");n.uniq(r).forEach(function(t){var i=r.length,s=n.without(r,t).length;e[n.camelCase(t)]=i-s})}function p(e,t){var n=e.request?e.request.status:e.status;return{serviceName:i,retryCount:e.retryCount,responseCode:n,isFailed:t,ttc:e.ttc}}function d(e){a.reportSuccess(i,f(e)),e.retryCount&&o.get().publish(p(e,!1))}function v(e){e.retryCount&&o.get().publish(p(e,!0));if(h(i)){var t=f();e instanceof XMLHttpRequest&&(t.faultCode=e.status),a.reportFail(i,t),c(t,e)}}function m(e){if(!e)return;var t=e.match(/(?:[\s\S]*):\/\/([^\/\r\n]+)(?:\/[^\r\n]*)?/i);if(t&&t.length>0)return t[1]}var s=t(r);return s.then(d,v),s}}}),define("jSkype/services/serviceAccessLayer/requestDecorator",["require","jSkype/services/serviceAccessLayer/decorations/retry","jSkype/services/serviceAccessLayer/decorations/availability","jSkype/services/serviceAccessLayer/decorations/reporting"],function(e){function s(e,t){function r(e){var r=t[e.policyName];r&&(n=e.decoration.build(n,r))}var n=e;return t?(i.forEach(r),n):e}var t=e("jSkype/services/serviceAccessLayer/decorations/retry"),n=e("jSkype/services/serviceAccessLayer/decorations/availability"),r=e("jSkype/services/serviceAccessLayer/decorations/reporting"),i=[{decoration:n,policyName:"availability"},{decoration:t,policyName:"retry"},{decoration:r,policyName:"reporting"}];return{build:s}}),define("jSkype/services/serviceAccessLayer/requestDispatcher",["require","exports","module","lodash-compat","reqwest","jSkype/services/serviceAccessLayer/builders/factory","jSkype/services/serviceAccessLayer/requestDecorator"],function(e,t){function u(e,i,o){function p(e){return u=r.compat(n.cloneDeep(e)),a(u)}function d(e){return function(){e.request.readyState!==t.REQUEST_DONE_READY_STATE&&e.abort()}}var u,l=f(e,i,o),c=s.build(p,o),h=c(l);return h._abort=d(u),h}function a(e){return Promise.resolve(e).then(function(n){return{request:e.request,response:n}},function(){throw e.request})}function f(e,t,n){var r,s=i.get("headerBuilder"),u=typeof n.addContentType=="undefined"||n.addContentType===!0?!0:!1;s.populate(n.headers),r={url:t,type:e,headers:s.get(),timeout:o,dataType:n.dataType||"json",data:n.payload||"",crossOrigin:typeof n.crossOrigin!="undefined"?n.crossOrigin:!0,withCredentials:typeof n.withCredentials!="undefined"?n.withCredentials:!1},u&&(r.contentType=n.contentType||"application/json");if(n.jsonp||n.dataType==="jsonp")r.jsonp=n.jsonp||"callback";return typeof n.processData=="boolean"&&(r.processData=n.processData),r}var n=e("lodash-compat"),r=e("reqwest"),i=e("jSkype/services/serviceAccessLayer/builders/factory"),s=e("jSkype/services/serviceAccessLayer/requestDecorator"),o=45e3;t.get=function(e,t){return u("GET",e,t)},t.post=function(e,t){return u("POST",e,t)},t.put=function(e,t){return u("PUT",e,t)},t.remove=function(e,t){return u("DELETE",e,t)},t.REQUEST_DONE_READY_STATE=4}),define("jSkype/services/serviceAccessLayer/serviceLocator",["require","jSkype/services/serviceAccessLayer/requestDispatcher","jSkype/services/serviceAccessLayer/builders/factory"],function(e){function r(e){typeof e!="string"&&s("serviceUri","string"),this.uriBuilder=n.get("uriBuilder"),this.uriBuilder.setDomain(e)}function i(e,t){var n={}.toString.call(t)==="[object Object]";typeof e!="string"&&s("resource","string"),n||s("options","object")}function s(e,t){throw new TypeError('expected typeof "'+e+'" to be: '+t)}var t=e("jSkype/services/serviceAccessLayer/requestDispatcher"),n=e("jSkype/services/serviceAccessLayer/builders/factory");return r.prototype.get=function(e,t){return this.request("get",e,t)},r.prototype.post=function(e,t){return this.request("post",e,t)},r.prototype.put=function(e,t){return this.request("put",e,t)},r.prototype.remove=function(e,t){return this.request("remove",e,t)},r.prototype.request=function(e,n,r){return i(n,r),this.uriBuilder.setResource(n),this.uriBuilder.setQueryParams(r.params),t[e](this.uriBuilder.build(),r)},{build:function(e){return new r(e)}}}),define("jSkype/constants/data",[],function(){function t(e){return new RegExp("^"+e+"\\|")}var e="contactPresence";return{storageKeys:{ENDPOINT_ID:"endpointId",SKYPE_ID_REG_TOKEN:"skypeIdRegistrationToken",PRESENCE_DATA:"presenceData",RESURECTION_KEY:"isResurected",CONTACT_PROFILES:"contacts",CONTACT_PRESENCE:e,ETAG:"etagContacts"},storageKeyRegExp:{CONTACT_PRESENCE:t(e),CONVERSATION:t("conv")}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-service-locator/lib/serviceLocator",["require","exports","lodash-compat"],e)}(function(e,t){function r(e){if(!n.isString(e)||e==="")throw new Error("You must provide a valid name for this service")}function s(){return new i}var n=e("lodash-compat"),i=function(){function e(){}return e.prototype.contains=function(e){return r(e),e in this},e.prototype.fetchOne=function(e){r(e);if(!this.contains(e))throw new Error("Service '"+e+"' not found");return this[e]},e.prototype.resolve=function(e){return this.fetchOne(e)},e.prototype.register=function(e,t){if(Object.isFrozen(this))throw new Error("Service locator is readonly when registering ' "+e+"'");r(e);if(this.contains(e))throw new Error("Service '"+e+"' already registered");this[e]=t},e.prototype.destroy=function(e){if(Object.isFrozen(this))throw new Error("Service locator is readonly when removing ' "+e+"'");var t=this.resolve(e);if(!this.hasOwnProperty(e))throw new Error("Service '"+e+"' does not belong to this locator");return delete this[e],t},e.prototype.reset=function(){var e=this;if(Object.isFrozen(this))throw new Error("Service locator is readonly when clearing it");Object.keys(this).forEach(function(t){return e.destroy(t)})},e}();t.ServiceLocator=i,t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-service-locator/lib/serviceLocatorBuilder",["require","exports","lodash-compat","./serviceLocator"],e)}(function(e,t){function s(e){var t=new i;return e?t.withOptions(e):t}var n=e("lodash-compat"),r=e("./serviceLocator"),i=function(){function e(){this.options={factories:[],frozen:!1,baseLocator:r.ServiceLocator.prototype}}return e.prototype.withOptions=function(e){return n.assign(this.options,e),this},e.prototype.withService=function(e,t){var r={name:e.name,build:e.build};return t&&n.extend(r,t),this.options.factories.push(r),this},e.prototype.withServiceInstance=function(e,t){return t?this.options.factories.push({name:t.name,build:function(){return e}}):this.options.factories.push({name:e.name,build:function(){return e.instance}}),this},e.prototype.frozen=function(){return this.options.frozen=!0,this},e.prototype.withBase=function(e){return this.options.baseLocator=e,this},e.prototype.build=function(e){var t=this;return Promise.all(this.options.factories.map(function(e){return Promise.resolve(e.build()).then(function(t){return[e.name,t]})})).then(function(n){return n.reduce(function(e,t){var n=t[0],r=t[1];return e.register(n,r),e},e||Object.create(t.options.baseLocator))}).then(function(e){return t.options.frozen?Object.freeze(e):e})},e.prototype.buildSync=function(e){var t=this.options.factories.map(function(e){return[e.name,e.build()]}).map(function(e){var t=e[0],n=e[1];if(n.then===undefined)return[t,n];throw new Error("#buildSync can't build "+t+" because it is asynchronous")}).reduce(function(e,t){var n=t[0],r=t[1];return e.register(n,r),e},e||Object.create(this.options.baseLocator));return this.options.frozen?Object.freeze(t):t},e}();t.serviceLocatorBuilder=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-service-locator/lib/index",["require","exports","./serviceLocator","./serviceLocatorBuilder"],e)}(function(e,t){var n=e("./serviceLocator");t.ServiceLocator=n;var r=e("./serviceLocatorBuilder");t.serviceLocatorBuilder=r.serviceLocatorBuilder}),define("swx-service-locator",["swx-service-locator/lib/index"],function(e){return e}),define("services/serviceLocator",["require","swx-service-locator"],function(e){var t=e("swx-service-locator").ServiceLocator,n=t.build();return n}),define("utils/common/settablePromise",["require","exports","module","helpers/polyfills"],function(e,t){e("helpers/polyfills"),t.build=function(){var e,t,n=new Promise(function(n,r){e=n,t=r});return n.resolve=e,n.reject=t,n}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("msr-crypto/lib/msrcrypto.aes",["require","exports"],e)}(function(){var e="1.3",t=t||function(){function p(e,t,n,r,i){return[]}function w(){function u(e){var t;for(t=e.length-1;t>=0;t-=1){e[t]+=1,e[t]>=256&&(e[t]=0);if(e[t])break}}function a(){t=l.getVector(32),n=l.getVector(16),r=32,i=48,s=1}function f(e,t){t=t||[0];if(t.length>i)throw new Error("Incorrect entropy or additionalEntropy length");t=t.concat(l.getVector(i-t.length)),e=e.concat(l.getVector((i-e.length%i)%i));for(var n=0;n<e.length;n+=i){var r=l.xorVectors(e.slice(n,n+i),t);c(r)}s=1}function c(e){var s=[],o=new m.aes(t);while(s.length<i){u(n);var a=n.slice(0,16),f=o.encrypt(a);s=s.concat(f)}s=l.xorVectors(s,e),t=s.slice(0,r),n=s.slice(r)}function h(e,r){if(e>=65536)throw new Error("too much random requested");if(s>o)throw new Error("Reseeding is required");if(r&&r.length>0){while(r.length<i)r=r.concat(l.getVector(i-r.length));c(r)}else r=l.getVector(i);var a=[],f=new m.aes(t);while(a.length<e){u(n);var h=n.slice(0,n.length),p=f.encrypt(h);a=a.concat(p)}return a=a.slice(0,e),c(r),s+=1,a}if(this instanceof w){var e=!1,t,n,r,i,s=1,o=1<<24;return a(),{reseed:f,init:function(t,n){if(t.length<i)throw new Error("Initial entropy length too short");a(),f(t,n),e=!0},getBytes:function(t,n){if(!e)throw new Error("can't get randomness before initialization");return h(t,n)},getNonZeroBytes:function(t,n){if(!e)throw new Error("can't get randomness before initialization");var r=[],i;while(r.length<t){i=h(t,n);for(var s=0;s<i.length;s+=1)i[s]!==0&&r.push(i[s])}return r.slice(0,t)}}}throw new Error("create MsrcryptoPrng object with new keyword")}function S(){function a(){var n,r=[];for(n=0;n<e;n+=1)r[n]=Math.floor(Math.random()*256);var a=window.crypto||window.msCrypto;if(a&&typeof a.getRandomValues=="function"&&window.Uint8Array){var f=new window.Uint8Array(e);a.getRandomValues(f),r=r.concat(Array.apply(null,f)),o=!0}var h=new XMLHttpRequest;for(n=0;n<u.length;n+=1)try{var p=h.getResponseHeader(u[n]);if(p){var d=l.stringToBytes(p);r=r.concat(d)}}catch(v){}o||(r=r.concat(t.splice(0,t.length)),c.startCollectors()),s?i.reseed(r):i.init(r),s=!0}function f(e){for(var r=0;r<e.length;++r)t.push(e[r]);t.length>=n&&c.stopCollectors()}var e=48,t=[],n=128,r=0,i=new w,s=!1,o=!1,u=["Cookie","RedirectUri","ETag","x-ms-client-antiforgery-id","x-ms-client-request-id","x-ms-client-session-id","SubscriptionPool"],c=function(){return{startCollectors:function(){if(!this.collectorsRegistered){if(window.addEventListener)window.addEventListener("mousemove",this.MouseEventCallBack,!0),window.addEventListener("load",this.LoadTimeCallBack,!0);else{if(!document.attachEvent)throw new Error("Can't attach events for entropy collection");document.attachEvent("onmousemove",this.MouseEventCallBack),document.attachEvent("onload",this.LoadTimeCallBack)}this.collectorsRegistered=1}},stopCollectors:function(){this.collectorsRegistered&&(window.removeEventListener?(window.removeEventListener("mousemove",this.MouseEventCallBack,1),window.removeEventListener("load",this.LoadTimeCallBack,1)):window.detachEvent&&(window.detachEvent("onmousemove",this.MouseEventCallBack),window.detachEvent("onload",this.LoadTimeCallBack)),this.collectorsRegistered=0)},MouseEventCallBack:function(e){var t=(new Date).valueOf(),n=e.x||e.clientX||e.offsetX||0,r=e.y||e.clientY||e.offsetY||0,i=[t&255,t>>8&255,t>>16&255,t>>24&255,n&255,n>>8&255,r&255,r>>8&255];f(i)},LoadTimeCallBack:function(){var e=(new Date).valueOf(),t=[e&255,e>>8&255,e>>16&255,e>>24&255];f(t)}}}();return{init:function(){a();if(!o&&!r)try{c.startCollectors()}catch(e){}},reseed:function(e){i.reseed(e)},read:function(e){if(!s)throw new Error("Entropy pool is not initialized.");var t=i.getBytes(e);return a(),t}}}var e={};e.register=function(t,n,r){e[t]||(e[t]={});var i=e[t];i[n]||(i[n]=r)},e.exists=function(t,n){return e[t]?e[t][n]?!0:!1:!1};var t=function(){if(typeof document!="undefined")try{throw new Error}catch(e){if(e.stack){var t=/\w+:\/\/(.+?\/)*.+\.js/.exec(e.stack);return t&&t.length>0?t[0]:null}}else if(typeof self!="undefined")return self.location.href;return null}(),n=!1,r=typeof Worker!="undefined",i=typeof importScripts!="undefined",s=typeof Uint8Array!="undefined",o=function(){try{return Object.defineProperty({},"oncomplete",{}),!0}catch(e){return!1}}(),u=r,a=function(e,t,n,r,i){if(!o){e[t]=n;return}var s={};r&&(s.get=r),i&&(s.set=i),Object.defineProperty(e,t,s)},f={},l=function(){function n(n,r){var i="";r||(r=!1);if(n.pop||n.subarray)n=String.fromCharCode.apply(null,n);if(t)i=btoa(n);else{var s,o,u,a,f,l,c,h;for(h=0;h<n.length;h+=3)s=n.charCodeAt(h),o=n.charCodeAt(h+1),u=n.charCodeAt(h+2),a=s>>2,f=(s&3)<<4|o>>4,l=(o&15)<<2|u>>6,c=u&63,isNaN(o)?l=c=64:isNaN(u)&&(c=64),i=i+e.charAt(a)+e.charAt(f)+e.charAt(l)+e.charAt(c)}return r?i.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""):i}function r(e){if(t){e=e.replace(/-/g,"+").replace(/_/g,"/");while(e.length%4!==0)e+="=";return atob(e)}return String.fromCharCode.apply(null,i(e))}function i(t){t=t.replace(/-/g,"+").replace(/_/g,"/");while(t.length%4!==0)t+="=";var n=[],r,i,s,o,u,a,f,l;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(l=0;l<t.length;l+=4)o=e.indexOf(t.charAt(l)),u=e.indexOf(t.charAt(l+1)),a=e.indexOf(t.charAt(l+2)),f=e.indexOf(t.charAt(l+3)),r=o<<2|u>>4,i=(u&15)<<4|a>>2,s=(a&3)<<6|f,n.push(r),a!==64&&n.push(i),f!==64&&n.push(s);return n}function s(e){return Object.prototype.toString.call(e).slice(8,-1)}function o(e,t){var n="";typeof t=="undefined"&&(t=!1);for(var r=0;r<e.length;r++){t&&r%4===0&&r!==0&&(n+="-");var i=e[r].toString(16).toUpperCase();i.length===1&&(n+="0"),n+=i}return n}function u(e,t){return t=t||0,e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function a(e){var t=new Array(e.length);for(var n=0;n<t.length;n++)t[n]=e.charCodeAt(n);return t}function f(e){e=e.replace(/\-/g,"");var t=[];while(e.length>=2)t.push(parseInt(e.substring(0,2),16)),e=e.substring(2,e.length);return t}function l(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function c(e,t,n){var r=i(e),s=[],o;if(isNaN(t))return r;for(o=0;o<r.length;o+=t)s.push(r.slice(o,o+t));if(n)for(o=0;o<s.length;o++)s[o]=(s[o][0]<<24)+(s[o][1]<<16)+(s[o][2]<<8)+s[o][3];return s}function h(e){return[e>>>24&255,e>>>16&255,e>>>8&255,e&255]}function p(e){var t=[];for(var n=0;n<e.length;n++)t=t.concat(h(e[n]));return t}function d(e,t){var n=Math.min(e.length,t.length),r=new Array(n);for(var i=0;i<n;i+=1)r[i]=e[i]^t[i];return r}function v(e,t){t||(t=0);var n=new Array(e);for(var r=0;r<e;r+=1)n[r]=t;return n}function m(e){function t(){var t=6e4,n=[],r=[];if(e.length<=t)return Array.apply(null,e);for(var i=0,s=e.length;i<s;i+=t)n.push(e.subarray(i,i+t));return n.forEach(function(e){r=r.concat(Array.apply(null,e))}),r}return e.pop?e:e.length===1?[e[0]]:t()}function g(e,t,n){while(e.length<n)e.push(t);return e}function y(e,t,n){while(e.length<n)e.unshift(t);return e}function b(e,t){var n=!0;e.length!==t.length&&(n=!1);for(var r=0;r<e.length;r++)e[r]!==t[r]&&(n=!1);return n}function w(e){if(s(e)!=="Array")return!1;var t;for(var n=0;n<e.length;n++){t=e[n];if(isNaN(t)||t<0||t>255)return!1}return!0}var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t=typeof btoa!="undefined";return{toBase64:n,base64ToString:r,base64ToBytes:i,getObjectType:s,bytesToHexString:o,bytesToInt32:u,stringToBytes:a,unpackData:c,hexToBytesArray:f,int32ToBytes:h,int32ArrayToBytes:p,toArray:m,arraysEqual:b,clone:l,xorVectors:d,padEnd:g,padFront:y,getVector:v,verifyByteArray:w}}(),c=function(){function t(e){return i&&self.postMessage(e),e}return{jsCryptoRunner:function(n){var r=n.data.operationType,i;if(!e.exists(r,n.data.algorithm.name))throw new Error("unregistered algorithm.");var s=e[r][n.data.algorithm.name],o=n.data;return o.operationSubType==="process"?(s(o),i=t({type:"process"})):i=t(s(o)),i}}}();i&&(self.onmessage=function(e){if(e.data.prngSeed){var t=e.data.prngSeed;E.init(t);return}c.jsCryptoRunner(e)});var h=function(){function t(e){var t=[];for(var n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t[t.length-1]===0&&t.pop(),t}function n(e){var t=e.algorithm.name.slice(0,3).toLowerCase();return t==="rsa"?"RSA":t==="ecd"?"EC":"oct"}function r(r,i){var s={};s.kty=n(r),s.extractable=r.extractable;if(i.pop)s.k=e.toBase64(i,!0);else for(var o in i)i[o].pop&&(s[o]=e.toBase64(i[o],!0));r.algorithm.namedCurve&&(s.crv=r.algorithm.namedCurve);var u=JSON.stringify(s,null,"	");return t(u)}function i(t,n,r){var i=String.fromCharCode.apply(null,t),s=JSON.parse(i);for(var o=0;o<r.length;o+=1){var u=s[r[o]];u&&(s[r[o]]=e.base64ToBytes(u))}return s}var e=l;return{keyToJwk:r,jwkToKey:i}}(),d=function(e,t,n,r,i,s,o){function p(e){var t=Math.floor(e.length/i);for(var n=0;n<t;n++)s(e,n,a,r,f);return h+=t,e.slice(t*i)}function d(){var e=[];for(var t=0;t<a.length;t++)e=e.concat(u.int32ToBytes(a[t]));return e.length=o/8,e}function v(e){var t=i-e.length%i;t<=i/8&&(t+=i);var n=u.getVector(t);n[0]=128;var r=(e.length+h*i)*8;return n[t-4]=r>>>24&255,n[t-3]=r>>>16&255,n[t-2]=r>>>8&255,n[t-1]=r&255,e.concat(n)}function m(e){return c=p(e),y()}function g(e){c=c.concat(e),c.length>=i&&(c=p(c));return}function y(){if(p(v(c)).length!==0)throw new Error("buffer.length !== 0");var e=d();return c=[],a=n.slice(),h=0,e}var u=l,a=n.slice(),f=new Array(i),c=[],h=0;return{name:e,computeHash:m,process:g,finish:y,der:t,hashLen:o,maxMessageSize:4294967295}},v=function(){function t(t,n,r,i,s){var o,u,a,f,l,c=64,h=4294967295,p=r[0],d=r[1],v=r[2],m=r[3],g=r[4],y=r[5],b=r[6],w=r[7];for(u=0;u<16;u++)s[u]=e.bytesToInt32(t,n*c+u*4);for(o=16;o<64;o++)f=s[o-15],l=s[o-2],s[o]=((l>>>17|l<<15)^(l>>>19|l<<13)^l>>>10)+s[o-7]+((f>>>7|f<<25)^(f>>>18|f<<14)^f>>>3)+s[o-16],s[o]=s[o]&h;for(u=0;u<64;u++)a=w+((g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7))+(g&y^~g&b)+i[u]+s[u],m+=a,a+=((p>>>2|p<<30)^(p>>>13|p<<19)^(p>>>22|p<<10))+(p&(d^v)^d&v),w=b,b=y,y=g,g=m,m=v,v=d,d=p,p=a;return r[0]+=p&h,r[1]+=d&h,r[2]+=v&h,r[3]+=m&h,r[4]+=g&h,r[5]+=y&h,r[6]+=b&h,r[7]+=w&h,r}var e=l,n,r,i,s,o,u=e.unpackData;return r=u("wQWe2DZ81QcwcN0X9w5ZOf/ACzFoWBURZPmPp776T6Q",4,1),i=u("agnmZ7tnroU8bvNypU/1OlEOUn+bBWiMH4PZq1vgzRk",4,1),n=u("QoovmHE3RJG1wPvP6bXbpTlWwltZ8RHxkj+CpKscXtXYB6qYEoNbASQxhb5VDH3Dcr5ddIDesf6b3AanwZvxdOSbacHvvkeGD8GdxiQMocwt6SxvSnSEqlywqdx2+YjamD5RUqgxxm2wAyfIv1l/x8bgC/PVp5FHBspjURQpKWcntwqFLhshOE0sbfxTOA0TZQpzVHZqCruBwskuknIshaK/6KGoGmZLwkuLcMdsUaPRkugZ1pkGJPQONYUQaqBwGaTBFh43bAgnSHdMNLC8tTkcDLNO2KpKW5zKT2gub/N0j4LueKVjb4TIeBSMxwIIkL7/+qRQbOu++aP3xnF48g",4,1),s=u("MC0wDQYJYIZIAWUDBAIEBQAEHA"),o=u("MDEwDQYJYIZIAWUDBAIBBQAEIA"),{sha224:d("SHA-224",s,r,n,64,t,224),sha256:d("SHA-256",o,i,n,64,t,256)}}();typeof e!="undefined"&&(v.hash256=function(e){if(e.operationSubType==="process"){v.sha256.process(e.buffer);return}return e.operationSubType==="finish"?v.sha256.finish():v.sha256.computeHash(e.buffer)},v.hash224=function(e){if(e.operationSubType==="process"){v.sha224.process(e.buffer);return}return e.operationSubType==="finish"?v.sha224.finish():v.sha224.computeHash(e.buffer)},e.register("digest","sha-224",v.hash224),e.register("digest","sha-256",v.hash256)),f["sha-224"]=v.sha224,f["sha-256"]=v.sha256;var m=function(){var e,t,n,r,i,s,o,u,a,f;return{aes:function(c){e||(e=l.unpackData("AAIEBggKDA4QEhQWGBocHiAiJCYoKiwuMDI0Njg6PD5AQkRGSEpMTlBSVFZYWlxeYGJkZmhqbG5wcnR2eHp8foCChIaIioyOkJKUlpianJ6goqSmqKqsrrCytLa4ury+wMLExsjKzM7Q0tTW2Nrc3uDi5Obo6uzu8PL09vj6/P4bGR8dExEXFQsJDw0DAQcFOzk/PTMxNzUrKS8tIyEnJVtZX11TUVdVS0lPTUNBR0V7eX99c3F3dWtpb21jYWdlm5mfnZORl5WLiY+Ng4GHhbu5v72zsbe1q6mvraOhp6Xb2d/d09HX1cvJz83DwcfF+/n//fPx9/Xr6e/t4+Hn5QADBgUMDwoJGBseHRQXEhEwMzY1PD86OSgrLi0kJyIhYGNmZWxvaml4e359dHdycVBTVlVcX1pZSEtOTURHQkHAw8bFzM/Kydjb3t3U19LR8PP29fz/+vno6+7t5Ofi4aCjpqWsr6qpuLu+vbS3srGQk5aVnJ+amYiLjo2Eh4KBm5idnpeUkZKDgIWGj4yJiquora6npKGis7C1tr+8ubr7+P3+9/Tx8uPg5ebv7Onqy8jNzsfEwcLT0NXW39zZ2ltYXV5XVFFSQ0BFRk9MSUpraG1uZ2RhYnNwdXZ/fHl6Ozg9Pjc0MTIjICUmLywpKgsIDQ4HBAECExAVFh8cGRoADhwSODYkKnB+bGJIRlRa4O788tjWxMqQnoyCqKa0utvVx8nj7f/xq6W3uZOdj4E7NScpAw0fEUtFV1lzfW9hraOxv5WbiYfd08HP5ev5901DUV91e2lnPTMhLwULGRd2eGpkTkBSXAYIGhQ+MCIslpiKhK6gsrzm6Pr03tDCzEFPXVN5d2VrMT8tIwkHFRuhr72zmZeFi9HfzcPp5/X7mpSGiKKsvrDq5Pb40tzOwHp0ZmhCTF5QCgQWGDI8LiDs4vD+1NrIxpySgI6kqri2DAIQHjQ6KCZ8cmBuREpYVjc5KyUPARMdR0lbVX9xY23X2cvF7+Hz/aepu7WfkYONAA0aFzQ5LiNoZXJ/XFFGS9Ddysfk6f7zuLWir4yBlpu7tqGsj4KVmNPeycTn6v3wa2ZxfF9SRUgDDhkUNzotIG1gd3pZVENOBQgfEjE8Kya9sKeqiYSTntXYz8Lh7Pv21tvMweLv+PW+s6SpioeQnQYLHBEyPyglbmN0eVpXQE3a18DN7uP0+bK/qKWGi5yRCgcQHT4zJClib3h1VltMQWFse3ZVWE9CCQQTHj0wJyqxvKumhYifktnUw87t4Pf6t7qtoIOOmZTf0sXI6+bx/GdqfXBTXklEDwIVGDs2ISwMARYbODUiL2RpfnNQXUpH3NHGy+jl8v+0ua6jgI2alwALFh0sJzoxWFNORXR/Ymmwu6atnJeKgejj/vXEz9LZe3BtZldcQUojKDU+DwQZEsvA3dbn7PH6k5iFjr+0qaL2/eDr2tHMx66luLOCiZSfRk1QW2phfHceFQgDMjkkL42Gm5Chqre81d7DyPny7+Q9NisgERoHDGVuc3hJQl9U9/zh6tvQzcavpLmyg4iVnkdMUVprYH12HxQJAjM4JS6Mh5qRoKu2vdTfwsn48+7lPDcqIRAbBg1kb3J5SENeVQEKFxwtJjswWVJPRHV+Y2ixuqesnZaLgOni//TFztPYenFsZ1ZdQEsiKTQ/DgUYE8rB3Nfm7fD7kpmEj761qKMACRIbJC02P0hBWlNsZX53kJmCi7S9pq/Y0crD/PXu5zsyKSAfFg0Ec3phaFdeRUyrormwj4adlOPq8fjHztXcdn9kbVJbQEk+NywlGhMIAebv9P3Cy9DZrqe8tYqDmJFNRF9WaWB7cgUMFx4hKDM63dTPxvnw6+KVnIeOsbijquzl/vfIwdrTpK22v4CJkpt8dW5nWFFKQzQ9Ji8QGQIL197FzPP64eiflo2Eu7KpoEdOVVxjanF4DwYdFCsiOTCak4iBvrespdLbwMn2/+TtCgMYES4nPDVCS1BZZm90faGos7qFjJee6eD78s3E39YxOCMqFRwHDnlwa2JdVE9GY3x3e/Jrb8UwAWcr/terdsqCyX36WUfwrdSir5ykcsC3/ZMmNj/3zDSl5fFx2DEVBMcjwxiWBZoHEoDi6yeydQmDLBobblqgUjvWsynjL4RT0QDtIPyxW2rLvjlKTFjP0O+q+0NNM4VF+QJ/UDyfqFGjQI+SnTj1vLbaIRD/89LNDBPsX5dEF8Snfj1kXRlzYIFP3CIqkIhG7rgU3l4L2+AyOgpJBiRcwtOsYpGV5HnnyDdtjdVOqWxW9Opleq4IunglLhymtMbo3XQfS72LinA+tWZIA/YOYTVXuYbBHZ7h+JgRadmOlJseh+nOVSjfjKGJDb/mQmhBmS0PsFS7FlIJatUwNqU4v0CjnoHz1/t84zmCmy//hzSOQ0TE3unLVHuUMqbCIz3uTJULQvrDTgguoWYo2SSydluiSW2L0SVy+PZkhmiYFtSkXMxdZbaSbHBIUP3tudpeFUZXp42dhJDYqwCMvNMK9+RYBbizRQbQLB6Pyj8PAsGvvQMBE4prOpERQU9n3OqX8s/O8LTmc5asdCLnrTWF4vk36Bx1325H8RpxHSnFiW+3Yg6qGL4b/FY+S8bSeSCa28D+eM1a9B/dqDOIB8cxsRIQWSeA7F9gUX+pGbVKDS3lep+TyZzvoOA7Ta4q9bDI67s8g1OZYRcrBH66d9Ym4WkUY1UhDH2NAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuNAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuNAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuNAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuNAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuN",256,!1),t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8]);var h=128,p,d,v=4,m,g;switch(c.length*8){case 128:p=128,d=4,m=10;break;case 192:p=192,d=6,m=12;break;case 256:p=256,d=8,m=14;break;default:throw new Error("Unsupported keyLength")}var y=function(e){var t=e[1];e[1]=e[5],e[5]=e[9],e[9]=e[13],e[13]=t,t=e[2],e[2]=e[10],e[10]=t,t=e[6],e[6]=e[14],e[14]=t,t=e[15],e[15]=e[11],e[11]=e[7],e[7]=e[3],e[3]=t},b=function(e){var t=e[13];e[13]=e[9],e[9]=e[5],e[5]=e[1],e[1]=t,t=e[10],e[10]=e[2],e[2]=t,t=e[14],e[14]=e[6],e[6]=t,t=e[3],e[3]=e[7],e[7]=e[11],e[11]=e[15],e[15]=t},w=function(e){var r=e[0],i=e[1],s=e[2],o=e[3],u=e[4],a=e[5],f=e[6],l=e[7],c=e[8],h=e[9],p=e[10],d=e[11],v=e[12],m=e[13],g=e[14],y=e[15];e[0]=t[r]^n[i]^s^o,e[1]=r^t[i]^n[s]^o,e[2]=r^i^t[s]^n[o],e[3]=n[r]^i^s^t[o],e[4]=t[u]^n[a]^f^l,e[5]=u^t[a]^n[f]^l,e[6]=u^a^t[f]^n[l],e[7]=n[u]^a^f^t[l],e[8]=t[c]^n[h]^p^d,e[9]=c^t[h]^n[p]^d,e[10]=c^h^t[p]^n[d],e[11]=n[c]^h^p^t[d],e[12]=t[v]^n[m]^g^y,e[13]=v^t[m]^n[g]^y,e[14]=v^m^t[g]^n[y],e[15]=n[v]^m^g^t[y]},E=function(e){var t=e[0],n=e[1],u=e[2],a=e[3],f=e[4],l=e[5],c=e[6],h=e[7],p=e[8],d=e[9],v=e[10],m=e[11],g=e[12],y=e[13],b=e[14],w=e[15];e[0]=r[t]^s[n]^i[u]^o[a],e[1]=o[t]^r[n]^s[u]^i[a],e[2]=i[t]^o[n]^r[u]^s[a],e[3]=s[t]^i[n]^o[u]^r[a],e[4]=r[f]^s[l]^i[c]^o[h],e[5]=o[f]^r[l]^s[c]^i[h],e[6]=i[f]^o[l]^r[c]^s[h],e[7]=s[f]^i[l]^o[c]^r[h],e[8]=r[p]^s[d]^i[v]^o[m],e[9]=o[p]^r[d]^s[v]^i[m],e[10]=i[p]^o[d]^r[v]^s[m],e[11]=s[p]^i[d]^o[v]^r[m],e[12]=r[g]^s[y]^i[b]^o[w],e[13]=o[g]^r[y]^s[b]^i[w],e[14]=i[g]^o[y]^r[b]^s[w],e[15]=s[g]^i[y]^o[b]^r[w]},S=function(e,t){return[e[0]^t[0],e[1]^t[1],e[2]^t[2],e[3]^t[3]]},x=function(e,t,n){for(var r=0;r<e.length;r+=1)e[r]^=t[r+n]},T=function(e){var t=e[0];e[0]=e[1],e[1]=e[2],e[2]=e[3],e[3]=t},N=function(e){for(var t=0;t<e.length;t+=1)e[t]=u[e[t]]},C=function(e){for(var t=0;t<e.length;t+=1)e[t]=a[e[t]]},k=function(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]},L=function(e,t,n,r){e[4*n]=t[4*r],e[4*n+1]=t[4*r+1],e[4*n+2]=t[4*r+2],e[4*n+3]=t[4*r+3]},A=function(e){var t,n=[],r=0;while(r<4*d)n.push(e[r++]);r=d;while(r<v*(m+1)){t=k(n,r-1);if(r%d===0){var i=r/d,s=[f[i],0,0,0];T(t),N(t),t=S(t,s)}else d>6&&r%d===4&&N(t);var o=S(k(n,r-d),t);L(n,o,r,0),r+=1}return n};return g=A(c),{encrypt:function(e){var t=e,n;x(t,g,0);for(n=1;n<=m-1;n+=1)N(t),y(t),w(t),x(t,g,4*n*v);return N(t),y(t),x(t,g,4*m*v),t},decrypt:function(e){var t=e,n;x(t,g,4*m*v);for(n=m-1;n>=1;n-=1)b(t),C(t),x(t,g,4*n*v),E(t);return b(t),C(t),x(t,g,0),t},clear:function(){},keyLength:p,blockSize:h}}}}(),g=g||{};g.pkcsv7=function(e){function t(t){var n=t.length-1>=0?t.length-1:0,r=t[n],i=r.length,s=i===e;if(s){var o=[],u;for(u=0;u<e;u+=1)o.push(e);t.push(o)}else{var a=e-i&255;while(r.length!==e)r.push(a)}}function n(t){var n=!0;t.length%e!==0&&(n=!1);var r=t.slice(-e),i=r[r.length-1];for(var s=0;s<e;s++){var o=e-s<=i,u=r[s]===i;n=(o?u:!0)&&n}var a=n?i:0;return t.length-=a,n}return{pad:t,unpad:n}};var y=function(e){function i(e){var n=[];a=a.concat(e);var r=Math.floor(a.length/t);for(var i=0;i<r;i++)n.push(a.slice(i*t,(i+1)*t));return a=a.slice(r*t),n}function s(t){var n=[],r;for(var i=0;i<t.length;i++)r=l.xorVectors(c,t[i]),n.push(e.encrypt(r)),c=n[i];return n}function o(t){var n=[],r,i;for(var s=0;s<t.length;s+=1)r=t[s].slice(0,t[s].length),i=e.decrypt(r),n.push(l.xorVectors(c,i)),c=t[s];return n}function u(){a=[],f=[],c=null}var t=e.blockSize/8,n=g.pkcsv7(t),r=function(e){var t=[],n,r;for(n=0;n<e.length;n+=1){var i=e[n];for(r=0;r<i.length;r+=1)t.push(i[r])}return t},a=[],f=[],c;return{init:function(e){if(e.length!==t)throw new Error("Invalid iv size");c=e.slice()},encrypt:function(e){return this.processEncrypt(e),this.finishEncrypt()},processEncrypt:function(e){var t=s(i(e));f=f.concat(r(t));return},finishEncrypt:function(){var e=a.length===1?[[a[0]]]:[a];n.pad(e);var t=f.concat(r(s(e)));return u(),t},decrypt:function(e){return this.processDecrypt(e),this.finishDecrypt()},processDecrypt:function(e){var t=o(i(e));f=f.concat(r(t));return},finishDecrypt:function(){var e=f,t=n.unpad(e);return u(),e}}},b=null;typeof e!="undefined"&&(y.workerEncrypt=function(e){var t;b||(b=y(m.aes(e.keyData)),b.init(e.algorithm.iv));if(e.operationSubType==="process"){b.processEncrypt(e.buffer);return}return e.operationSubType==="finish"?(t=b.finishEncrypt(),b=null,t):(t=b.encrypt(e.buffer),b=null,t)},y.workerDecrypt=function(e){var t;b||(b=y(m.aes(e.keyData)),b.init(e.algorithm.iv));if(e.operationSubType==="process"){b.processDecrypt(e.buffer);return}return e.operationSubType==="finish"?(t=b.finishDecrypt(),b=null,t):(t=b.decrypt(e.buffer),b=null,t)},y.generateKey=function(e){if(e.algorithm.length%8!==0)throw new Error;return{type:"keyGeneration",keyData:E.getBytes(Math.floor(e.algorithm.length/8)),keyHandle:{algorithm:e.algorithm,extractable:e.extractable,keyUsage:e.keyUsage,type:"secret"}}},y.importKey=function(e){var t=h.jwkToKey(e.keyData,e.algorithm,["k"]);return{type:"keyImport",keyData:t.k,keyHandle:{algorithm:e.algorithm,extractable:e.extractable||t.extractable,keyUsage:e.keyUsage,type:"secret"}}},y.exportKey=function(e){var t=h.keyToJwk(e.keyHandle,e.keyData);return{type:"keyExport",keyHandle:t}},e.register("importKey","aes-cbc",y.importKey),e.register("exportKey","aes-cbc",y.exportKey),e.register("generateKey","aes-cbc",y.generateKey),e.register("encrypt","aes-cbc",y.workerEncrypt),e.register("decrypt","aes-cbc",y.workerDecrypt));var E=new w,x;i||(x=function(){function n(){function t(t){try{e=c.jsCryptoRunner({data:t}),(!t.operationSubType||t.operationSubType!=="process")&&this.onmessage({data:e})}catch(n){this.onerror({data:n.description,type:"error"})}}var e;return{postMessage:t,onmessage:null,onerror:null,terminate:function(){}}}function o(e){function s(e,t){}function o(e,t){}function u(e){n=e,this.result&&n({target:this})}function f(e){r=e}function l(){return n}function c(){return r}function h(t){if(t.type==="error"){this.onerror&&this.onerror(t);return}if(t.type==="process")return;this.result=e(t.data),this.oncomplete&&this.oncomplete({target:this});return}var t=null,n=null,r=null,i;return i={dispatchEvent:h,addEventListener:s,removeEventListener:o,result:null},a(i,"oncomplete",null,l,u),a(i,"onerror",null,c,f),i}function f(){function e(e){switch(e.type){case"keyGeneration":case"keyImport":case"keyDerive":return v.add(e.keyHandle,e.keyData),e.keyHandle;case"keyExport":return p(e.keyHandle);case"keyPairGeneration":return v.add(e.keyPair.publicKey.keyHandle,e.keyPair.publicKey.keyData),v.add(e.keyPair.privateKey.keyHandle,e.keyPair.privateKey.keyData),{publicKey:e.keyPair.publicKey.keyHandle,privateKey:e.keyPair.privateKey.keyHandle};default:throw new Error("Unknown key operation")}return}return o(e)}function h(e){function t(e){return e=p(e),e}var n=o(t);return n.process=function(t){e.operationSubType="process",e.buffer=g.toArray(t),m.continueJob(this,g.clone(e))},n.finish=function(){e.operationSubType="finish",e.buffer=[],m.continueJob(this,g.clone(e))},n.abort=function(){m.abortJob(this)},n.onabort=null,n.onprogress=null,n.algorithm=e.algorithm||null,n.key=e.keyHandle||null,n}function p(e){return s&&e.pop?(new Uint8Array(e)).buffer:e}function d(e){e.oncomplete?e.oncomplete({target:e}):setTimeout(function(){d(e)},i)}function y(t,n){if(!e.exists(t,n))throw new Error("unsupported algorithm")}function S(e){var t=v.lookup(e);if(!t)throw new Error("key not found");return t}function x(e,t){var n={operationType:e},r=w[e];for(var i=0;i<r.length;i+=1){var s=b[r[i]],o=t[i];if(!o){if(s.required)throw new Error(s.name);continue}o.subarray&&(o=g.toArray(o));if(l.getObjectType(o)!==s.type)throw new Error(s.name);s.name==="algorithm"&&(o.name=o.name.toLowerCase(),o.iv&&(o.iv=g.toArray(o.iv)),o.salt&&(o.salt=g.toArray(o.salt)),o.additionalData&&(o.additionalData=g.toArray(o.additionalData)),o.hash&&!o.hash.name&&l.getObjectType(o.hash)==="String"&&(o.hash={name:o.hash})),n.hasOwnProperty(s.name)?n[s.name+"1"]=o:n[s.name]=o}return n}function T(e,t,n){var r=x(e,t);y(e,r.algorithm.name),r.keyHandle&&(r.keyData=S(r.keyHandle)),r.keyHandle1&&(r.keyData1=S(r.keyHandle1)),r.algorithm&&r.algorithm.publicKey&&(r.additionalKeyData=S(r.algorithm.publicKey));var i=n?f(r):h(r);return(n||r.buffer||e==="deriveBits"||e==="wrapKey")&&m.runJob(i,r),i}var i=100,v=[];v.add=function(e,t){v.push({keyHandle:e,keyData:t})},v.remove=function(e){for(var t=0;t<v.length;t++)if(v[t].keyHandle===e){v=v.splice(t,1);return}},v.lookup=function(e){for(var t=0;t<v.length;t++)if(v[t].keyHandle===e)return v[t].keyData;return null};var m=function(){function f(){l(!u);for(var e=0;e<s.length;e++)if(!s[e].busy)return s[e];return null}function l(e){for(var t=s.length-1;t>=0;t-=1)s[t].isWebWorker===e&&(s[t].terminate(),s.splice(t,1))}function c(){var e=0;for(var t=0;t<s.length;t++)s[t].busy||(e+=1);return e}function h(e){s.push(e)}function p(e){for(var t=0;t<s.length;t++)if(s[t]===e){e.terminate(),s.splice(t,1);return}}function d(e){for(var t=0;t<s.length;t++)if(s[t].operation===e)return s[t];return null}function v(e,t){o.push({operation:e,data:t,id:a++})}function m(e){e.busy=!1,e.operation=null;if(u)if(o.length>0){var t=o.shift();w(t.operation,t.data)}else c()>i&&p(e)}function g(e){var r;if(u)try{r=new Worker(t),r.postMessage({prngSeed:E.getBytes(48)}),r.isWebWorker=!0}catch(i){u=!1,N.forceSync=!0,r=n(),r.isWebWorker=!1}else r=n(),r.isWebWorker=!1;return r.operation=e,r.busy=!1,r.onmessage=function(e){var t=r.operation;for(var n=0;n<o.length;n++)if(o[n].operation===r.operation){var i=o[n];o.splice(n,1),S(r,i.data);return}t&&e.data.type!=="process"&&(m(r),t.dispatchEvent(e))},r.onerror=function(e){var t=r.operation;m(r),t.dispatchEvent(e)},h(r),r}function y(e){var t=d(e);t&&p(t)}function b(t,n){var i=null;u=r&&!N.forceSync,i=f();if(u&&i===null&&s.length>=e){v(t,n);return}i===null&&(i=g(t));if(i===null)throw v(t,n),new Error("could not create new worker");i.operation=t,i.busy=!0,S(i,n)}function w(e,t){var n=d(e);if(n){S(n,t);return}b(e,t)}function S(e,t){u?(e.data=t,e.postMessage(t)):setTimeout(function(){e.postMessage(t)},0)}var e=15,i=4,s=[],o=[],a=0;return{runJob:b,continueJob:w,abortJob:y}}(),g=l,b=[{name:"algorithm",type:"Object",required:!0},{name:"keyHandle",type:"Object",required:!0},{name:"buffer",type:"Array",required:!1},{name:"signature",type:"Array",required:!0},{name:"format",type:"String",required:!0},{name:"keyData",type:"Array",required:!0},{name:"extractable",type:"Boolean",required:!1},{name:"keyUsages",type:"Array",required:!1},{name:"derivedKeyType",type:"Object",required:!0},{name:"length",type:"Number",required:!1}],w={encrypt:[0,1,2],decrypt:[0,1,2],sign:[0,1,2],verify:[0,1,3,2],digest:[0,2],generateKey:[0,6,7],importKey:[4,5,0,6,7],exportKey:[0,4,1,6,7],deriveKey:[0,1,8,6,7],deriveBits:[0,1,9],wrapKey:[1,1,0],unwrapKey:[2,0,1,6,7]},N={encrypt:function(e,t,n){return T("encrypt",arguments,0)},decrypt:function(e,t,n){return T("decrypt",arguments,0)},sign:function(e,t,n){return T("sign",arguments,0)},verify:function(e,t,n,r){return T("verify",arguments,0)},digest:function(e,t){return T("digest",arguments,0)},generateKey:function(e,t,n){return T("generateKey",arguments,1)},deriveKey:function(e,t,n,r,i){return T("deriveKey",arguments,1)},deriveBits:function(e,t,n){return T("deriveBits",arguments,0)},importKey:function(e,t,n,r,i){return T("importKey",arguments,1)},exportKey:function(e,t){return T("exportKey",[t.algorithm,e,t],1)},wrapKey:function(e,t,n){return T("wrapKey",arguments,0)},unwrapKey:function(e,t,n,r,i){return T("unwrapKey",arguments,1)}};return N}());var T={subtle:x,getRandomValues:function(e){var t,n=E.getBytes(e.length);for(t=0;t<e.length;t+=1)e[t]=n[t];return e},initPrng:function(e){var t=Object.prototype.toString.call(e);if(t!=="[object Array]"&&t!=="[object Uint8Array]")throw new Error("entropyData must be a Array or Uint8Array");N&&N.reseed(e),E.reseed(N.read(48)),n=!0},toBase64:function(e,t){return l.toBase64(e,!1)},base64ToString:function(e){return l.base64ToString(e)},utilities:l,sha256:v.sha256,url:t};typeof cryptoMath!="undefined"&&(T.cryptoMath=cryptoMath),typeof testInterface!="undefined"&&(T.testInterface=testInterface);var N;if(!i){N=N||new S,N.init();var C=N.read(48);E.init(C)}return T}();return t}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("msr-crypto/lib/StringBuilder",["require","exports"],e)}(function(){return function(){function t(e){return this._parts.push(e),this}function n(e){return this._parts.push(typeof e=="undefined"||e===null||e===""?"\r\n":e+"\r\n"),this}function r(){if(arguments.length!==0)throw new Error("InvalidParameterCount");this._parts=[],this._value={},this._len=0}function i(){if(arguments.length!==0)throw new Error("InvalidParameterCount");return this._parts.length===0?!0:this.toString()===""}function s(e){e=e||"";var t=this._parts;this._len!==t.length&&(this._value={},this._len=t.length);var n=this._value;if(typeof n[e]=="undefined"){if(e!=="")for(var r=0;r<t.length;)typeof t[r]=="undefined"||t[r]===""||t[r]===null?t.splice(r,1):r++;n[e]=this._parts.join(e)}return n[e]}var e={};return e.StringBuilder=function(n){this._parts=e.isNullOrEmpty(n)?[]:[n.toString()],this._value={},this._len=0},e.StringBuilder.prototype={append:t,appendLine:n,clear:r,isEmpty:i,toString:s},e.isNullOrEmpty=function(t){return!t||!t.length},e}()}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("msr-crypto/lib/BigInt",["require","exports","./StringBuilder"],e)}(function(e){var t=e("./StringBuilder");return function(){var e="0123456789abcdef",n=16,r=3,i=function(t,n){this._elements=[],this._radix=t,this._elements.splice(0,0,n),this._length=1,this._normalize()};return i.hexRadix=16,i.decRadix=1e3,i._createDec=function(t){return new i(i.decRadix,t)},i._createHex=function(t){return new i(i.hexRadix,t)},i._computeHexNegative=function(t,r){var s,o=[];for(s=0;s<r;s++)o.splice(s,0,t[s]);for(s=0;s<o.length;s++)o[s]>0&&(o[s]=i.hexRadix-o[s],s+1<o.length?o[s+1]=o[s+1]+1:o.length<n&&o.splice(s+1,0,1));return o},i.parseDecInt=function(t,n){switch(t){case i.decRadix:return i._parseDecIntToDecRadixBigInt(n);case i.hexRadix:return i._parseDecIntToHexRadixBigInt(n);default:return null}},i._parseDecIntToHexRadixBigInt=function(n){if(t.isNullOrEmpty(n))return null;var r=n.charAt(0)==="-";r&&(n=n.substr(1));var s=9,o=i._createHex(1e9),u=i._createHex(0),a=Math.ceil(n.length/s),f=i._createHex(1),l=n.length;for(var c=0;c<a;c++){var h=l-s<0?0:l-s,p=parseInt(n.substr(h,l-h),10),d=i._createHex(p);d.multiply(f),u.add(d),f.multiply(o),l-=s}return u._isNegative=r,u},i._parseDecIntToDecRadixBigInt=function(t){if(t.length===0)return i._createDec(0);var n=!1,s=[];t.charAt(0)==="-"&&(n=!0,t=t.substr(1,t.length-1));var o;for(o=0;r*(o+1)<=t.length;o++)s.splice(o,0,parseInt(t.substring(t.length-r*(o+1),t.length-r*o),10));0!==t.length%r&&s.splice(o++,0,parseInt(t.substring(0,t.length%r),10));var u=i._createDec(0);return u._elements=s,u._length=o,u._isNegative=n,u},i._getHexValues=function(t){var n=new Array(t.length);for(var r=0;r<t.length;r++){n[r]=i._hexCharValue(t.charAt(r));if(n[r]<0)return null}return n},i._hexCharValue=function(t){if(t>="0"&&t<="9")return t-"0";switch(t){case"a":return 10;case"b":return 11;case"c":return 12;case"d":return 13;case"e":return 14;case"f":return 15;default:return-1}},i._toNegativeValues=function(t){for(var n=t.length-1;n>=0;n--)t[n]>0&&(t[n]=16-t[n],n>0&&(t[n-1]+=1));return t},i.prototype={_isNegative:!1,_length:0,_radix:0,_normalize:function(){var t;for(t=this._length-1;t>=0;t--){if(this._elements[t]!==0)break;this._length--}for(var n=0;n<2;n++)if(this._length===0)this._isNegative=!1;else{if(this._elements[this._length-1]<0){for(t=0;t<this._length;t++)this._elements[t]=-this._elements[t];this._isNegative=!this._isNegative}for(t=0;t<this._length-1;t++){var r;this._elements[t]<0&&(r=Math.ceil(-this._elements[t]/this._radix),this._elements[t]=this._elements[t]+this._radix*r,this._elements[t+1]=this._elements[t+1]-r),this._elements[t]>=this._radix&&(r=Math.floor(this._elements[t]/this._radix),this._elements[t]=this._elements[t]%this._radix,this._elements[t+1]=this._elements[t+1]+r)}while(this._elements[this._length-1]>=this._radix)this._ensureCapacity(),this._elements[this._length]=Math.floor(this._elements[this._length-1]/this._radix),this._elements[this._length-1]=this._elements[this._length-1]%this._radix,this._length++;if(!(this._elements[this._length-1]<0))break;for(t=0;t<this._length;t++)this._elements[t]=-this._elements[t];this._isNegative=!this._isNegative}},_ensureCapacity:function(){this._length===this._elements.length&&this._elements.push(0)},add:function(t){var n;for(n=0;n<this._length-t._length;n++)t._elements.splice(t._length+n,0,0);for(n=0;n<t._length-this._length;n++)this._elements.splice(this._length+n,0,0);this._length=Math.max(t._length,this._length);if(this._isNegative===t._isNegative)for(n=0;n<this._length;n++)this._elements[n]=this._elements[n]+t._elements[n];else for(n=0;n<this._length;n++)this._elements[n]=this._elements[n]-t._elements[n];this._normalize()},multiply:function(t){var n,r=new i(this._radix,0);for(n=0;n<t._length+this._length;n++)n<r._elements.length?r._elements[n]=0:r._elements.splice(n,0,0);for(n=0;n<t._length;n++){for(var s=0;s<this._length;s++)r._elements[n+s]=r._elements[n+s]+t._elements[n]*this._elements[s],r._elements[n+s]!==0&&(r._length=Math.max(r._length,n+s+1));r._normalize()}r._isNegative=t._isNegative!==this._isNegative,this._elements=r._elements,this._isNegative=r._isNegative,this._length=r._length},modulus:function(t){for(;;){if(t._length===0||this._length===0)break;var n=this._length-t._length;if(n<0)break;var r=this._elements[this._length-1],i=t._elements[t._length-1];if(r>=i){var s=Math.floor(r/i);for(var o=0;o<t._length;o++)this._elements[o+n]=this._elements[o+n]-s*t._elements[o];this._normalize();continue}if(n===0)break;this._elements[this._length-2]=this._elements[this._length-2]+this._radix*this._elements[this._length-1],this._length--}this._isNegative&&(t._isNegative?(t._isNegative=!1,this.add(t),t._isNegative=!0):this.add(t)),this._normalize()},toString:function(){switch(this._radix){case i.hexRadix:return this._toHexString();case i.decRadix:return this._toDecString();default:return""}},_toHexString:function(){if(this._elements.length===0)return"0";var r=this._elements;this._isNegative&&(r=i._computeHexNegative(r,this._length));var s=new t.StringBuilder,o=!1;for(var u=r.length-1;u>=0;u--)o||r[u]!==0&&(o=!0),o&&s.append(e.charAt(r[u]));return s.toString()},_toDecString:function(){if(this._length===0)return"0";var t="";for(var n=0;n<this._length;n++){t=this._elements[n]+t;if(n<this._length-1)for(var r=10;r<this._radix;r*=10)this._elements[n]<r&&(t=0+t)}return this._isNegative&&(t="-"+t),t}},i}()}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("msr-crypto/lib/ConvertHelper",["require","exports"],e)}(function(){return function(){var e={tryParseInt:function(t){var n=parseInt(t,10);return isNaN(n)?-1:n},parseHexInt:function(t){var n=parseInt(t,16);return isNaN(n)?0:n}};return e}()}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("msr-crypto/lib/sha256Auth",["require","exports","./msrcrypto.aes","./StringBuilder","./BigInt","./ConvertHelper"],e)}(function(e){var t=e("./msrcrypto.aes"),n=e("./StringBuilder"),r=e("./BigInt"),i=e("./ConvertHelper");return function(e){function o(e){var n=t.utilities.stringToBytes(e),r=t.sha256.computeHash(n);return t.utilities.bytesToHexString(r)}function u(e,t){var r=e.toString(2),i=t.toString(2),s=new n.StringBuilder,o=new n.StringBuilder,u=Math.abs(r.length-i.length),a;for(a=0;a<u;a++)o.append("0");r.length<i.length?(o.append(r),r=o.toString()):i.length<r.length&&(o.append(i),i=o.toString());for(a=0;a<r.length;a++)s.append(r.charAt(a)===i.charAt(a)?"0":"1");return parseInt(s.toString(),2)}function a(e,t,n){return e.length<t?(n=n||" ",e+f(n,t-e.length)):e.valueOf()}function f(e,t){var n=e;for(var r=1;r<t;r++)n+=e;return n}var s=e.MSP||{};return s._sha256Auth=function(){},s._sha256Auth.prototype={_int32ToHexString:function(t){var r="0123456789abcdef",i=new n.StringBuilder;for(var s=0;s<=3;s++)i.append(r.charAt(t>>s*8+4&15)),i.append(r.charAt(t>>s*8&15));return i.toString()},getMacHash:function(t,n,r){var s=t+n,f=s,l=8-f.length%8;l!==8&&(f=a(f,f.length+l,"0"));var c=f.length/4,h=[],p,d;for(p=0,d=0;p<c;p++)h.splice(p,0,0),h[p]=h[p]+f.charCodeAt(d++)*1,h[p]=h[p]+f.charCodeAt(d++)*256,h[p]=h[p]+f.charCodeAt(d++)*65536,h[p]=h[p]+f.charCodeAt(d++)*16777216;var v=new Array(4),m=o(t+r);for(p=0,d=0;p<v.length;p++)v[p]=0,v[p]+=i.parseHexInt(m.substr(d,2))*1,d+=2,v[p]+=i.parseHexInt(m.substr(d,2))*256,d+=2,v[p]+=i.parseHexInt(m.substr(d,2))*65536,d+=2,v[p]+=i.parseHexInt(m.substr(d,2))*16777216,d+=2;var g=new Array(2);this._cS64_C(h,v,g);var y=u(v[0],g[0]),b=u(v[1],g[1]),w=u(v[2],g[0]),E=u(v[3],g[1]);return this._int32ToHexString(y)+this._int32ToHexString(b)+this._int32ToHexString(w)+this._int32ToHexString(E)},_cS64_C:function(t,n,i){var s=2147483647;if(t.length<2||(t.length&1)===1)return!1;var o=n[0]&s,u=n[1]&s,a=n[2]&s,f=n[3]&s,l=242854337,c=r.parseDecInt(r.decRadix,o.toString()),h=r.parseDecInt(r.decRadix,u.toString()),p=r.parseDecInt(r.decRadix,a.toString()),d=r.parseDecInt(r.decRadix,f.toString()),v=r.parseDecInt(r.decRadix,l.toString()),m=0,g=r.parseDecInt(r.decRadix,s.toString()),y=r.parseDecInt(r.decRadix,"0"),b=r.parseDecInt(r.decRadix,"0"),w=r.parseDecInt(r.decRadix,"0");for(var E=0;E<t.length/2;E++)y=r.parseDecInt(r.decRadix,t[m++].toString()),y.multiply(v),y.modulus(g),b.add(y),b.multiply(c),b.add(h),b.modulus(g),w.add(b),b.add(r.parseDecInt(r.decRadix,t[m++].toString())),b.multiply(p),b.add(d),b.modulus(g),w.add(b);return b.add(h),b.modulus(g),w.add(d),w.modulus(g),i[0]=parseInt(b.toString(),10),i[1]=parseInt(w.toString(),10),!0}},s._sha256Auth}(window)}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("msr-crypto/lib/index",["require","exports","./msrcrypto.aes","./sha256Auth"],e)}(function(e,t){t.aes=e("./msrcrypto.aes"),t.sha256Auth=e("./sha256Auth")}),define("msr-crypto",["msr-crypto/lib/index"],function(e){return e}),define("utils/common/msCryptoAdapter",["require","exports","module","msr-crypto"],function(e,t){function r(e){return new Promise(function(t,n){e.oncomplete=function(e){t(e.target.result)},e.onerror=n})}var n=e("msr-crypto").aes;n.subtle.forceSync=!0,t.getRandomValues=n.getRandomValues,t.subtle={generateKey:function(t,i,s){return r(n.subtle.generateKey(t,i,s))},exportKey:function(t,i){return r(n.subtle.exportKey(t,i))},importKey:function(t,i,s,o,u){return r(n.subtle.importKey(t,i,s,o,u))},encrypt:function(t,i,s){return r(n.subtle.encrypt(t,i,s))},decrypt:function(t,i,s){return r(n.subtle.decrypt(t,i,s))}}}),define("utils/common/encryption",["require","exports","module","utils/common/msCryptoAdapter","browser/window"],function(e,t){function u(e){var t=6e4,n=[],r=[];if(e.length<=t)return Array.apply(null,e);for(var i=0,s=e.length;i<s;i+=t)n.push(e.subarray(i,i+t));return n.forEach(function(e){r=r.concat(Array.apply(null,e))}),r}function a(e){var t=new Uint8Array(e.length);for(var n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function f(e){var t=6e4,n=[],r=new Uint8Array(e),i="";if(r.length<=t)return String.fromCharCode.apply(null,r);for(var s=0,o=r.length;s<o;s+=t)n.push(r.subarray(s,s+t));return n.forEach(function(e){i=i.concat(String.fromCharCode.apply(null,e))}),i}function l(e,t){return{data:f(t),iv:u(e)}}var n=e("utils/common/msCryptoAdapter"),r=e("browser/window"),i="Aes-cbc",s=["encrypt","decrypt"],o;r.crypto?r.crypto.webkitSubtle?o={crypto:{getRandomValues:r.crypto.getRandomValues.bind(r.crypto),subtle:r.crypto.webkitSubtle},importedKeyProcessor:a,exportedKeyProcessor:f}:o={crypto:r.crypto,importedKeyProcessor:JSON.parse,exportedKeyProcessor:JSON.stringify}:o={crypto:n,importedKeyProcessor:a,exportedKeyProcessor:f},t.generateEncryptionKey=function(){return o.crypto.subtle.generateKey({name:i,length:256},!0,s)},t.exportEncryptionKey=function(e){return o.crypto.subtle.exportKey("jwk",e).then(o.exportedKeyProcessor)},t.importEncryptionKey=function(e){return o.crypto.subtle.importKey("jwk",o.importedKeyProcessor(e),{name:i},!0,s)},t.encrypt=function(e,t){var n,r={name:i};return new Promise(function(i,s){function u(e){i(l(r.iv,e))}try{n=a(encodeURI(JSON.stringify(t)))}catch(f){s(f);return}r.iv=o.crypto.getRandomValues(new Uint8Array(16)),o.crypto.subtle.encrypt(r,e,n).then(u,s)})},t.decrypt=function(e,t){var n,r;return!t||!t.data?Promise.reject("Invalid encrypted data"):(n={name:i,iv:new Uint8Array(t.iv)},r=a(t.data),new Promise(function(t,i){function s(e){try{t(JSON.parse(decodeURI(f(e))))}catch(n){i(n);return}}o.crypto.subtle.decrypt(n,e,r).then(s,i)}))}}),define("utils/common/cache/keyHasher",["require","lodash-compat","constants/common"],function(e){function r(e,r){function s(e,t){return t.key===e}function o(e,t){return t.hash===e}var i={cursor:0,map:[]};this.fillMap=function(e){e!==null&&(i=e)},this.getHashByKey=function(o){if(o===n.INTERNAL_KEYS.KEYS_MAP)return o;var u=t.find(i.map,s.bind(null,o));return u&&u.hash?u.hash:(u="key-"+i.cursor,r&&(u+="-"+o),i.cursor++,i.map.push({key:o,hash:u}),e(n.INTERNAL_KEYS.KEYS_MAP,i),u)},this.getKeyByHash=function(e){var n=t.find(i.map,o.bind(null,e));return n&&n.key?n.key:e},this.removeKeyFromMap=function(r){var o=t.remove(i.map,s.bind(null,r));o.length&&e(n.INTERNAL_KEYS.KEYS_MAP,i)}}var t=e("lodash-compat"),n=e("constants/common").cache;return{build:function(e,t){return new r(e,t)}}}),define("utils/common/cache/provider",["require","constants/common","services/serviceLocator","constants/common","browser/window","utils/common/settablePromise","utils/common/encryption","utils/common/cache/keyHasher","lodash-compat"],function(e){function l(){function b(e,t,n){if(!l.log)return}function w(t){if(l.plainData){var n=s.build();return n.resolve(JSON.stringify(t)),n}return o.encrypt(e,t)}function E(t){if(l.plainData){var n=s.build();return n.resolve(JSON.parse(t)),n}return o.decrypt(e,t)}function S(){y.getSensitiveItem(t.INTERNAL_KEYS.KEYS_MAP).then(m.fillMap).then(c.resolve,c.resolve)}function x(e){return i.localStorage.getItem(C(e))}function T(e){return i.localStorage.removeItem(C(e))}function N(e,t){return i.localStorage.setItem(C(e),t)}function C(e){return h+e}function k(e){return i.localStorage.hasOwnProperty(e)&&p.test(e)}function L(e,t){return Object.keys(i.localStorage).reduce(function(n,r){var i=m.getKeyByHash(r.replace(p,""));return A(r,i,e,t)?n.concat(i):n},[])}function A(e,n,r,i){var s=i?i.test(n):!0;return k(e)&&s&&(r||e!==C(t.INTERNAL_KEYS.VERSION))}function O(e){L(e).forEach(function(e){i.localStorage.removeItem(C(e))})}var e,f,l={log:!1,showKeys:!1,plainData:!1},c=s.build(),h=t.PREFIX_KEYWORD+"|",p=new RegExp("^"+t.PREFIX_KEYWORD+"\\|"),d=n.resolve(r.serviceLocator.FEATURE_FLAGS).isFeatureOn(r.featureFlags.DEACTIVATE_CACHE),v={},m,g={},y=this;y.init=function(n,r){function w(n){function u(t){o.importEncryptionKey(t.response).then(function(t){e=t,p("Key decrypted -> initialization completed"),n()},l)}function a(e){N(t.INTERNAL_KEYS.ENCRYPTION_KEY,e.response)}function f(t){e=t,o.exportEncryptionKey(e).then(function(e){s.encrypt(e).then(a)}),p("New key generated -> initialization completed"),n()}function l(){p("KES not reachable, deactivating cache and completing initialization"),d=!0,n()}function c(){p("Starting with fresh cache"),i&&O(),o.generateEncryptionKey().then(f,l)}var r;if(d){p("Cache is deactivated -> initialization completed"),n();return}r=x(t.INTERNAL_KEYS.ENCRYPTION_KEY),r?(p("Getting key from KES"),s.decrypt(r).then(u,c)):c()}var i=!0,s,h,p=b.bind(y,"[Init]"),v=t.VERSION;a.merge(l,r);if(f)return f;a.forEach(l,function(e,t){if(t==="log")return;e&&(v+="|"+t)}),m=u.build(y.setSensitiveItem,l.showKeys),h=x(t.INTERNAL_KEYS.VERSION),s=new n;if(h!==v){h?(p("Version changed from "+h+" to "+v),O()):(p("Version not found"),O(!0)),i=!1;try{N(t.INTERNAL_KEYS.VERSION,v)}catch(g){if(g.name!=="QuotaExceededError")throw g;p("Deactivating cache as storage is locked"),d=!0}}return f=(new Promise(w)).then(S).then(c),f},y.isDeactivated=function(){return d},y.destroy=function(e){!d&&e&&f&&O(),f=null,v={},g={}},y.getAllKeys=function(e){return new Promise(function(t){if(d){t([]);return}c.then(function(){t(L(!1,e))})})},y.setSensitiveItem=function(e,t,n){function u(){function n(t){var n=m.getHashByKey(e);N(n,JSON.stringify(t)),o("encrypted"),s.resolvePromise(),delete v[e]}o("encrypting",t),w(g[e]).then(n,function(e){o("Encryption failed"),s.rejectPromise(e)})}function a(){o("Starting new writing operation with delay of "+n+"ms"),s.promise=new Promise(function(e,t){s.resolvePromise=e,s.rejectPromise=t,s.timeout=i.setTimeout(function(){c.then(u)},n)}),v[e]=s}function f(){o("Resetting writing operation timeout"),i.clearTimeout(s.timeout),s.timeout=i.setTimeout(function(){c.then(u)},n)}var s=v[e]||{},o=b.bind(y,"[SetSensitiveItem: "+e+"]");return isNaN(n)&&(n=r.cache.DEFAULT_BUFFER_TIMEOUT),g[e]=t,d?new Promise(function(e){o("Cache deactivated, resolving"),e()}):(s.promise?f():a(),s.promise)},y.setItem=function(e,t){var n=b.bind(y,"[SetItem: "+e+"]");return new Promise(function(r,i){c.then(function(){g[e]=t;if(d){n("Cache deactivated, resolving"),r();return}try{var s=m.getHashByKey(e);N(s,JSON.stringify(t)),n("stored"),r()}catch(o){n("storage failed",o),i(o)}})})},y.getSensitiveItem=function(e){function r(t,r){var i;n("Getting");if(d){n("Cache deactivated, returning internal value",g[e]),t(g[e]||null);return}if(typeof g[e]!="undefined"){n("Retrieved value already before, returning it",g[e]),t(g[e]);return}var s=m.getHashByKey(e);i=x(s);if(!i){n("No data found in storage"),t(null);return}try{i=JSON.parse(i)}catch(o){n("Parsing of stored data failed"),r(o)}E(i).then(function(r){g[e]=r,n("Decrypted",r),t(r)},function(e){n("Decryption failed",e),r(e)})}var n=b.bind(y,"[GetSensitiveItem: "+e+"]");return new Promise(function(n,i){e===t.INTERNAL_KEYS.KEYS_MAP?r(n,i):c.then(r.bind(null,n,i))})},y.getSensitiveItems=function(e){var t=s.build();return y.getAllKeys(e).then(function(e){var n=e.reduce(function(e,t){return e.concat(y.getSensitiveItem(t))},[]);Promise.all(n).then(t.resolve,t.reject)}).catch(t.reject),t},y.getItem=function(e){function n(n,r){var i;t("Getting");if(d){t("Cache deactivated, returning internal value",g[e]),n(g[e]||null);return}if(typeof g[e]!="undefined"){t("Retrieved value already before, returning it",g[e]),n(g[e]);return}var s=m.getHashByKey(e);i=x(s);if(!i){t("No data found in storage"),n(null);return}try{i=JSON.parse(i),t("Found",i),n(i)}catch(o){t("Parsing of stored data failed"),r(o)}}var t=b.bind(y,"[GetItem: "+e+"]");return new Promise(function(e,t){c.then(n.bind(null,e,t))})},y.removeItem=function(e){var t=b.bind(y,"[RemoveItem: "+e+"]");return new Promise(function(n){c.then(function(){delete g[e],d||(T(m.getHashByKey(e)),m.removeKeyFromMap(e),typeof v[e]!="undefined"&&(t("Item is removed prior encryption timeout finished. Cancelling encryption."),i.clearTimeout(v[e].timeout),v[e].rejectPromise(),delete v[e])),t("Removed"),n()})})}}var t=e("constants/common").cache,n=e("services/serviceLocator"),r=e("constants/common"),i=e("browser/window"),s=e("utils/common/settablePromise"),o=e("utils/common/encryption"),u=e("utils/common/cache/keyHasher"),a=e("lodash-compat"),f="[CacheProvider]";return l}),define("utils/common/cache/instance",["require","exports","module","utils/common/cache/provider"],function(e,t){var n=e("utils/common/cache/provider"),r;t.get=function(){return r||(r=new n),r}}),define("jSkype/services/clientInfo",["require","jSkype/settings","browser/detect"],function(e){function r(){var e=n.getSystemInfo(),r=t.settings.lcid||"en-us",i=t.settings.country||"n/a",s="os="+e.osName+"; osVer="+e.osVersion+"; proc="+e.platform+"; lcid="+r+";";return s+=" deviceType="+e.deviceType+"; country="+i+"; clientName="+t.settings.biAppName+"; clientVer="+t.settings.uiVersion,s}var t=e("jSkype/settings"),n=e("browser/detect");return{getBIAppName:function(){return t.settings.biAppName},getBIVersion:function(){return t.settings.uiVersion},getClientInfo:r}}),define("jSkype/services/contacts/facade",["require","jSkype/client","swx-enums","jSkype/constants/data","utils/common/cache/instance","constants/common","jSkype/settings","jSkype/services/clientInfo","jSkype/services/contacts/serviceSettings"],function(e){function f(e,l,c){function h(e,t){var n=a.getMyContactsEndpoint(e,a.version,t),r=c.build().then(function(e){return l.get(n,e)});return r.then(function(e){var t=e.request.getResponseHeader("ETag");t&&c.setHeader(f.IF_NONE_MATCH,t)}),r}function p(e,t){return i.get().getItem(r.ETAG).then(function(n){return n?c.setHeader(f.IF_NONE_MATCH,n):d(),c.build().then(function(n){var r=a.getMyDeltaContactsEndpoint(e,a.version,t);return l.get(r,n)})})}function d(){c.setHeader(f.IF_NONE_MATCH,"/")}this.init=function(){d(),t.get().signInManager.state.when(n.loginState.SignedOut,function(){c.removeHeader(f.IF_NONE_MATCH)})},this.getMyContacts=function(e,t){return c.setServiceName(a.actions.getMyContacts),o.isFeatureOn(s.featureFlags.CONTACT_PROFILE_CACHE)?p(e,t):h(e,t)},this.blockContact=function(t,n,r){var i=a.getBlockContactEndpoint(e,t,n,a.version);return c.setOption("payload",JSON.stringify({"report-abuse":String(!!r),"ui-version":u.getBIVersion()})),c.setServiceName(a.actions.blockContact),c.build().then(function(e){return l.put(i,e)})},this.unblockContact=function(t,n){var r=a.getUnblockContactEndpoint(e,t,n,a.version);return c.setServiceName(a.actions.unblockContact),c.build().then(function(e){return l.put(r,e)})},this.deleteContact=function(t,n){var r=a.getDeleteContactEndpoint(e,t,n,a.version);return c.setServiceName(a.actions.deleteContact),c.build().then(function(e){return l.remove(r,e)})}}var t=e("jSkype/client"),n=e("swx-enums"),r=e("jSkype/constants/data").storageKeys,i=e("utils/common/cache/instance"),s=e("constants/common"),o=e("jSkype/settings"),u=e("jSkype/services/clientInfo"),a=e("jSkype/services/contacts/serviceSettings");return f.IF_NONE_MATCH="If-None-Match",f}),define("jSkype/services/contacts/main",["require","exports","module","jSkype/services/contacts/facade"],function(e,t){var n=e("jSkype/services/contacts/facade"),r;t.getInstance=function(t,i,s){return r||(r=new n(t,i,s),r.init()),r}}),define("jSkype/services/internalPubSub",["require","lodash-compat","swx-pubsub"],function(e){function i(){return r||(r=new n,t.bindAll(r,"subscribe","unsubscribe","publish","unsubscribeAll")),r}function s(){r=null}var t=e("lodash-compat"),n=e("swx-pubsub").default,r;return{get:i,reset:s}}),define("jSkype/services/stratus/dispatcher",["require","jSkype/services/internalPubSub"],function(e){var t=e("jSkype/services/internalPubSub");return function(n){function r(e){var t={};return t.responseData=e||{},t.moduleName="stratus",t.actionName=n,t}this.success=function(e){var n=r(e.response);t.get().publish("stratus:data",n)},this.error=function(e){var n=r(e);t.get().publish("stratus:error",n)}}}),define("jSkype/services/stratus/actions",{GET_PENDING_CONTACT_REQUESTS:"getIncomingContactRequests",GET_PROFILE:"getProfile",GET_PROFILES:"getProfiles",GET_MY_CONTACTS:"getMyContacts",CONTACT_REQUEST_SENT:"contactRequestSent",CONTACT_REQUEST_ACCEPTED:"contactRequestAccepted",CONTACT_REQUEST_DECLINED:"contactRequestDeclined",SEND_CONTACT_REQUEST:"sendContactRequest",ACCEPT_CONTACT_REQUEST:"acceptContactRequest",DECLINE_CONTACT_REQUEST:"declineContactRequest",DELETE_CONTACT:"deleteContact",SEARCH_DIRECTORY:"searchDirectory",SEARCH_DIRECTORY_BY_ID:"searchDirectoryById"}),define("jSkype/constants/common",{contentTypes:{FORM_URL_ENCODED:"application/x-www-form-urlencoded",JSON_V1_0:"application/json; ver=1.0",JSON_V2_0:"application/json; ver=2.0",JSON_V3_0:"application/json; ver=3.0"}}),define("jSkype/services/stratus/facade",["require","constants/common","jSkype/settings","jSkype/services/stratus/serviceSettings","jSkype/services/stratus/dispatcher","jSkype/services/stratus/actions","jSkype/constants/common"],function(e){function u(e,u){function h(e,t){u.setOption("payload",e),u.setOption("contentType",t)}this.actions=s,this.updateAvatar=function(t,n,o){var f,l=r.getAvatarUpdateEndPoint(t),c=a(s.UPDATE_AVATAR,t),h=new i(c);return u.setServiceName(s.UPDATE_AVATAR),u.setOption("payload",n),u.setOption("contentType",o),u.setOption("processData",!1),f=u.build().then(function(t){return e.put(l,t)}),f.then(h.success,h.error),f},this.getProfile=function(){var t=r.getProfileEndPoint();return u.setServiceName(s.GET_PROFILE),u.build().then(function(n){return e.get(t,n)})},this.getProfiles=function(i){var a;return u.setServiceName(s.GET_PROFILES),n.isFeatureOn(t.BATCH_PROFILES_V2)?(a=r.getProfilesEndPointV2(),h(JSON.stringify({usernames:i}),o.contentTypes.JSON_V1_0)):(a=r.getProfilesEndPoint(),h(l(i.map(f)),o.contentTypes.FORM_URL_ENCODED)),u.build().then(function(t){return e.post(a,t)})},this.getUserInfo=function(){var t=r.getUserInfoEndPoint();return u.setServiceName("getUserInfo"),u.setHeader("Accept",o.contentTypes.JSON_V2_0),u.build().then(function(n){return e.get(t,n)})},this.searchDirectory=function(t){var n=r.getDirectorySearchEndpoint(t);return u.setServiceName(s.SEARCH_DIRECTORY),u.build().then(function(t){return e.get(n,t)})},this.searchDirectoryById=function(t){var n=r.getDirectorySearchByIdEndpoint(t);return u.setServiceName(s.SEARCH_DIRECTORY_BY_ID),u.build().then(function(t){return e.get(n,t)})},this.sendContactRequest=function(t,n){var f,l=a(s.CONTACT_REQUEST_SENT,t),h=new i(l),p=c(r.getContactRequestEndpoint(),encodeURIComponent(t));return u.setServiceName(s.SEND_CONTACT_REQUEST),u.setOption("payload","greeting="+n),u.setOption("contentType",o.contentTypes.FORM_URL_ENCODED),f=u.build().then(function(t){return e.put(p,t)}),f.then(h.success,h.error),f},this.getIncomingContactRequests=function(){var t,n=new i(s.GET_PENDING_CONTACT_REQUESTS),o=r.getContactRequestEndpoint();return u.setServiceName(s.GET_PENDING_CONTACT_REQUESTS),t=u.build().then(function(t){return e.get(o,t)}),t.then(n.success,n.error),t},this.acceptContactRequest=function(t){var n,f=a(s.CONTACT_REQUEST_ACCEPTED,t),l=new i(f),h=c(r.getContactRequestEndpoint(),encodeURIComponent(t),"accept");return u.setServiceName(s.ACCEPT_CONTACT_REQUEST),u.setOption("contentType",o.contentTypes.FORM_URL_ENCODED),n=u.build().then(function(t){return e.put(h,t)}),n.then(l.success,l.error),n},this.declineContactRequest=function(t){var n,f=a(s.CONTACT_REQUEST_DECLINED,t),l=new i(f),h=c(r.getContactRequestEndpoint(),encodeURIComponent(t),"decline");return u.setServiceName(s.DECLINE_CONTACT_REQUEST),u.setOption("contentType",o.contentTypes.FORM_URL_ENCODED),n=u.build().then(function(t){return e.put(h,t)}),n.then(l.success,l.error),n},this.deleteContact=function(t){var n,o=a(s.DELETE_CONTACT,t),f=new i(o),l=r.getDeleteContactEndpoint(t);return u.setServiceName(s.DELETE_CONTACT),n=u.build().then(function(t){return e.remove(l,t)}),n.then(f.success,f.error),n}}function a(e,t){return e+":"+t}function f(e){return{name:"contacts[]",value:e}}function l(e){return e.reduce(function(e,t){return e.concat(t.name+"="+t.value)},[]).join("&")}function c(){return Array.prototype.slice.call(arguments).join("/")}var t=e("constants/common").featureFlags,n=e("jSkype/settings"),r=e("jSkype/services/stratus/serviceSettings"),i=e("jSkype/services/stratus/dispatcher"),s=e("jSkype/services/stratus/actions"),o=e("jSkype/constants/common");return u}),define("jSkype/services/stratus/main",["require","exports","module","jSkype/services/stratus/facade"],function(e,t){var n=e("jSkype/services/stratus/facade"),r;t.getInstance=function(e,t){return r||(r=new n(e,t)),r}}),define("jSkype/services/people/facade",["require","exports","module","jSkype/settings"],function(e,t){function r(e,t){function r(e){t.setServiceName(e),t.setHeader("X-AppId",n.settings.peopleService.appId),t.setHeader("X-SerializeAs","purejson")}this.getSettings=function(){return r("peopleServiceGetSettings"),t.build().then(function(t){return e.get(n.settings.peopleService.settingsEndpoint,t)})},this.setSettings=function(i){var s={Settings:[{Name:"Skype.AutoBuddy",Value:!!i}]};return r("peopleServiceSetSettings"),t.setOption("payload",JSON.stringify(s)),t.build().then(function(t){return e.post(n.settings.peopleService.settingsEndpoint,t)})}}var n=e("jSkype/settings");t.build=function(e,t){return new r(e,t)}}),define("jSkype/services/people/main",["require","exports","module","jSkype/services/people/facade"],function(e,t){var n=e("jSkype/services/people/facade"),r;t.getInstance=function(t,i){return r||(r=n.build(t,i)),r}}),define("jSkype/services/ABCHProfile/facade",["require","exports","module","jSkype/settings"],function(e,t){function r(e,t){function r(e){t.setServiceName(e),t.setHeader("PS-ApplicationId",n.settings.profileService.appId)}this.getProfile=function(){return r("profileServiceGetProfile"),t.build().then(function(t){return e.get(n.settings.profileService.profileEndpoint,t)})},this.updatePhoneNumber=function(i){var s={Attributes:[{Edit:[{Name:i.number,Searchable:i.isSearchable,Country:i.cc}],Name:"PersonalContactProfile.Phones",Delete:null,Add:null}]};return r("profileServiceUpdatePhoneNumber"),t.setOption("payload",JSON.stringify(s)),t.setHeader("Content-Type","application"),t.build().then(function(t){return e.post(n.settings.profileService.profileEndpoint,t)})},this.deletePhoneNumber=function(i){var s={Attributes:[{Edit:null,Name:"PersonalContactProfile.Phones",Delete:[{Name:i.number,Country:i.cc}],Add:null}]};return r("profileServiceDeletePhoneNumber"),t.setOption("payload",JSON.stringify(s)),t.setHeader("Content-Type","application"),t.build().then(function(t){return e.post(n.settings.profileService.profileEndpoint,t)})}}var n=e("jSkype/settings");t.build=function(e,t){return new r(e,t)}}),define("jSkype/services/ABCHProfile/main",["require","exports","module","jSkype/services/ABCHProfile/facade"],function(e,t){var n=e("jSkype/services/ABCHProfile/facade"),r;t.getInstance=function(t,i){return r||(r=n.build(t,i)),r}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/guid",["require","exports"],e)}(function(e,t){function n(e){var t=e.toString(16),n=4-t.length,r;for(r=0;r<n;r+=1)t="0"+t;return t}function r(){var e=new Array(8),t,r;for(r=0;r<e.length;r+=2)t=Math.floor(Math.random()*4294967296),e[r]=n(t&65535),e[r+1]=n(t>>>16),r+1===3&&(e[r+1]="4"+e[r+1].substring(1));return e}function i(){var e=r();return e[0]+e[1]+"-"+e[2]+"-"+e[3]+"-"+e[4]+"-"+e[5]+e[6]+e[7]}function s(){var e=r();return e[0]+e[1]+e[2]+e[3]+e[4]+e[5]+e[6]+e[7]}t.create=i,t.createRaw=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("global-portable/lib/global",["require","exports"],e)}(function(e,t){var n="undefined",r=typeof window!==n?window:typeof global!==n?global:Object.create(null);t.__esModule=!0,t["default"]=r}),define("global-portable",["global-portable/lib/global"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-browser-globals/lib/globals",["require","exports","global-portable"],e)}(function(e,t){function s(){return r}function o(){return i}var n=e("global-portable"),r=n["default"].window,i=n["default"].document;t.getWindow=s,t.getDocument=o}),define("swx-browser-globals",["swx-browser-globals/lib/globals"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/loader",["require","exports","swx-browser-globals"],e)}(function(e,t){function r(e,t){e.getElementsByTagName("head")[0].appendChild(t)}function i(e){var t=n.getDocument(),i=t.createElement("link");return i.href=e,i.type="text/css",i.rel="stylesheet",r(t,i),i}function s(e,t,i){var s=n.getDocument(),o=s.createElement("script");return o.src=e,o.type="text/javascript",o.async=!0,t&&(o.onload=t),i&&(o.onerror=i),r(s,o),o}var n=e("swx-browser-globals");t.loadStyle=i,t.loadScript=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/sessionStorage",["require","exports","swx-browser-globals"],e)}(function(e,t){function r(e,t){var r=n.getWindow();try{r.sessionStorage.setItem(e,t)}catch(i){}}function i(e){var t=n.getWindow();try{return t.sessionStorage.getItem(e)}catch(r){}}function s(e){var t=n.getWindow();try{return t.sessionStorage.removeItem(e)}catch(r){}}function o(){var e=n.getWindow();try{e.sessionStorage.clear()}catch(t){}}var n=e("swx-browser-globals");t.set=r,t.get=i,t.remove=s,t.clear=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/stopwatch",["require","exports"],e)}(function(e,t){function r(){return new n}var n=function(){function e(){this.msElapsed=0,this.isPaused=!1,this.startTime=(new Date).getTime()}return e.prototype.pause=function(){this.isPaused||(this.msElapsed+=(new Date).getTime()-this.startTime,this.isPaused=!0)},e.prototype.resume=function(){this.isPaused&&(this.isPaused=!1,this.startTime=(new Date).getTime())},e.prototype.duration=function(){return this.isPaused?this.msElapsed:this.msElapsed+(new Date).getTime()-this.startTime},e.prototype.durationInMinutes=function(){var e=this.duration()/6e4;return Math.ceil(e)},e.prototype.durationInSeconds=function(){var e=this.duration()/1e3;return Math.ceil(e)},e}();t.Stopwatch=n,t.build=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/stringUtils",["require","exports","lodash-compat"],e)}(function(e,t){function o(e,t){if(!e)return!1;var r=new RegExp("\\b"+n.escapeRegExp(t),"i");return a(e).search(r)!==-1}function u(e){return e.replace(/[\W]+|[\s]+/gi," ").trim()}function a(e){var t=parseInt("0xD800"),r=parseInt("0xDBFF"),i=0,o="",u="",a;if(!e)return e;while(i<e.length){o+=e.charAt(i),a=e.charCodeAt(i);if(a<t||a>r)u+=n.has(s,o)?s[o]:o,o="";i++}return u}function f(e,t,n,r){return typeof r=="undefined"&&(r=n),e.substr(0,n)+t+e.substr(r,e.length)}function l(e){return e===""}function c(e){return n.isString(e)&&e.length>0}function h(e){return e==="\r"}function p(e){return e==="\n"}function d(e){return e===" "}function v(e,t){var n=this.wordBoundariesAt(e,t);return n.start===-1?"":e.substring(n.start,n.end)}function m(e,t){if(t>e.length)return{start:-1,end:-1};if(t===e.length){if(e.search(/\s$/)!==-1)return{start:-1,end:-1};t--}var n=e.substring(0,t).search(/\S+$/),r=e.substring(t).search(/\s/);return n===-1&&(n=t),r===-1?r=e.length:r+=t,{start:n,end:r}}function g(e){return r+e+i}var n=e("lodash-compat"),r="‪",i="‬",s={"ª":"a","º":"o","À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ý":"Y","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ù":"u","ú":"u","û":"u","ü":"u","ý":"y","ÿ":"y","Ā":"A","ā":"a","Ă":"A","ă":"a","Ą":"A","ą":"a","Ć":"C","ć":"c","Ĉ":"C","ĉ":"c","Ċ":"C","ċ":"c","Č":"C","č":"c","Ď":"D","ď":"d","Ē":"E","ē":"e","Ĕ":"E","ĕ":"e","Ė":"E","ė":"e","Ę":"E","ę":"e","Ě":"E","ě":"e","Ĝ":"G","ĝ":"g","Ğ":"G","ğ":"g","Ġ":"G","ġ":"g","Ģ":"G","ģ":"g","Ĥ":"H","ĥ":"h","Ĩ":"I","ĩ":"i","Ī":"I","ī":"i","Ĭ":"I","ĭ":"i","Į":"I","į":"i","İ":"I","Ĳ":"IJ","ĳ":"ij","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","Ĺ":"L","ĺ":"l","Ļ":"L","ļ":"l","Ľ":"L","ľ":"l","Ŀ":"L·","ŀ":"l·","Ń":"N","ń":"n","Ņ":"N","ņ":"n","Ň":"N","ň":"n","ŉ":"ʼn","Ō":"O","ō":"o","Ŏ":"O","ŏ":"o","Ő":"O","ő":"o","Ŕ":"R","ŕ":"r","Ŗ":"R","ŗ":"r","Ř":"R","ř":"r","Ś":"S","ś":"s","Ŝ":"S","ŝ":"s","Ş":"S","ş":"s","Š":"S","š":"s","Ţ":"T","ţ":"t","Ť":"T","ť":"t","Ũ":"U","ũ":"u","Ū":"U","ū":"u","Ŭ":"U","ŭ":"u","Ů":"U","ů":"u","Ű":"U","ű":"u","Ų":"U","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","ź":"z","Ż":"Z","ż":"z","Ž":"Z","ž":"z","ſ":"s","Ơ":"O","ơ":"o","Ư":"U","ư":"u","Ǆ":"DZ","ǅ":"Dz","ǆ":"dz","Ǉ":"LJ","ǈ":"Lj","ǉ":"lj","Ǌ":"NJ","ǋ":"Nj","ǌ":"nj","Ǎ":"A","ǎ":"a","Ǐ":"I","ǐ":"i","Ǒ":"O","ǒ":"o","Ǔ":"U","ǔ":"u","Ǖ":"U","ǖ":"u","Ǘ":"U","ǘ":"u","Ǚ":"U","ǚ":"u","Ǜ":"U","ǜ":"u","Ǟ":"A","ǟ":"a","Ǡ":"A","ǡ":"a","Ǧ":"G","ǧ":"g","Ǩ":"K","ǩ":"k","Ǫ":"O","ǫ":"o","Ǭ":"O","ǭ":"o","ǰ":"j","Ǳ":"DZ","ǲ":"Dz","ǳ":"dz","Ǵ":"G","ǵ":"g","Ǹ":"N","ǹ":"n","Ǻ":"A","ǻ":"a","Ȁ":"A","ȁ":"a","Ȃ":"A","ȃ":"a","Ȅ":"E","ȅ":"e","Ȇ":"E","ȇ":"e","Ȉ":"I","ȉ":"i","Ȋ":"I","ȋ":"i","Ȍ":"O","ȍ":"o","Ȏ":"O","ȏ":"o","Ȑ":"R","ȑ":"r","Ȓ":"R","ȓ":"r","Ȕ":"U","ȕ":"u","Ȗ":"U","ȗ":"u","Ș":"S","ș":"s","Ț":"T","ț":"t","Ȟ":"H","ȟ":"h","Ȧ":"A","ȧ":"a","Ȩ":"E","ȩ":"e","Ȫ":"O","ȫ":"o","Ȭ":"O","ȭ":"o","Ȯ":"O","ȯ":"o","Ȱ":"O","ȱ":"o","Ȳ":"Y","ȳ":"y","ʰ":"h","ʲ":"j","ʳ":"r","ʷ":"w","ʸ":"y","ˡ":"l","ˢ":"s","ˣ":"x"};t.anyWordStartsWith=o,t.clean=u,t.normalize=a,t.inject=f,t.isEmpty=l,t.isNotEmpty=c,t.isCarriageReturn=h,t.isNewLine=p,t.isWhiteSpace=d,t.wordAt=v,t.wordBoundariesAt=m,t.forceLTREmbedding=g}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/settablePromise",["require","exports"],e)}(function(e,t){function n(){var e,t,n=new Promise(function(n,r){e=n,t=r});return n.resolve=e,n.reject=t,n}t.build=n});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/cancelation",["require","exports","lodash-compat"],e)})(function(e,t){function s(e,t){return Promise.race([Promise.resolve(e),t])}function o(e,t){if(!t||!e||!n.isObject(e))return Promise.resolve(e);var r=e;if(n.isFunction(r.makeCancelable))return r.makeCancelable(t);var i=e;if(n.isFunction(i.then))return s(i,t)}function u(e){if(!e||!n.isObject(e)||!n.isFunction(e.abort))return e;var t=e;return t.makeCancelable=function(e){var t=this,n;return e.catch(function(e){n=e,t.abort()}),Promise.resolve(this).catch(function(t){throw e.isCanceled?(n.innerException=t,n):t})},t}function a(){return new r}var n=e("lodash-compat"),r=function(){function e(){}return e.prototype.getToken=function(){var e=this,t=function(){var t=new Promise(function(t,n){e.rejectTokenFn=n});return Object.defineProperty(t,"isCanceled",{get:function(){return e.isCanceled}}),t.throwIfCanceled=function(){if(e.isCanceled)throw new i},e.isCanceled=!1,t};return this.token=this.token||t(),this.token},e.prototype.cancel=function(e){e=e||new i,this.token||this.getToken();if(this.isCanceled)throw new Error("The token is already canceled");this.isCanceled=!0,this.rejectTokenFn(e)},e}();t.CancelationTokenFactory=r;var i=function(e){function t(){e.call(this,"Operation canceled")}return __extends(t,e),t}(Error);t.OperationCanceledError=i,t.makeCancelablePromise=s,t.makeCancelable=o,t.adaptAbortable=u,t.cancelableOperation=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/url",["require","exports","lodash-compat"],e)}(function(e,t){function r(e,t,n){return e.length?e.push("&"):e=["?"],t==null?e.push(encodeURIComponent(n)):e=e.concat([encodeURIComponent(n),"=",encodeURIComponent(t)]),e}function i(e){var t=[];for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];var s=[e].concat(t),o=n.takeWhile(s,n.isString);s.splice(0,o.length);if(o.length===0||s.length>1)throw new RangeError("Query arguments object should be the last parameter");var u=n.head(s),a=n.reduce(o,function(e,t,r){var i=n.last(e);return i&&!n.endsWith(i,"/")&&!n.startsWith(t,"/")&&e.push("/"),e.push(t),e},[]);return a=a.concat(n.flatten(n.reduce(u,r,[]))),a.join("")}var n=e("lodash-compat");t.buildUrl=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/index",["require","exports","./guid","./loader","./sessionStorage","./stopwatch","./stringUtils","./settablePromise","./cancelation","./url"],e)}(function(e,t){var n=e("./guid");t.guid=n;var r=e("./loader");t.loader=r;var i=e("./sessionStorage");t.sessionStorage=i;var s=e("./stopwatch");t.stopwatch=s;var o=e("./stringUtils");t.stringUtils=o;var u=e("./settablePromise");t.settablePromise=u;var a=e("./cancelation");t.cancelation=a;var f=e("./url");t.url=f}),define("swx-utils-common",["swx-utils-common/lib/index"],function(e){return e}),define("constants/people",[],function(){var e={SELF:"self",ECHO_CONTACT_ID:"echo123",searchLimit:20,contactTypes:{USER:"8",AGENT:"28",PSTN:"4"},contactList:{className:{LOCAL:"people",DIRECTORY:"directory"}},contactPicker:{states:{STATE_DEFAULT:"default",STATE_SEARCH:"search"}},authorizationStates:{UNKNOWN:"UNKNOWN",UNAUTHORIZED:"UNAUTHORIZED",PENDING_OUTGOING:"PENDING_OUTGOING",PENDING_INCOMING:"PENDING_INCOMING",AUTHORIZED:"AUTHORIZED",SUGGESTED:"SUGGESTED"},showStrategies:{ALL:"ALL",AVAILABLE_ONLY:"AVAILABLE_ONLY",AGENTS_ONLY:"AGENTS_ONLY"},contactPageTabIds:{AVAILABLE_TAB:"availableTab",ALL_CONTACTS_TAB:"allContactsTab",AGENTS_TAB:"agentsTab"},scopes:{FULL:"full"}};return e}),define("jSkype/constants/people",{SELF:"self",SUGGESTED_CONTACT_ACTIVITY_MESSAGE:"Skype",batch:{MAX_ITEMS:100,MAX_DELAY:500},contactList:{retry:{TIMEOUT:3e4}},endpoints:{MOBILE:"isMobile"},authorizationStates:{UNKNOWN:"UNKNOWN",UNAUTHORIZED:"UNAUTHORIZED",PENDING_OUTGOING:"PENDING_OUTGOING",PENDING_INCOMING:"PENDING_INCOMING",AUTHORIZED:"AUTHORIZED",SUGGESTED:"SUGGESTED"}}),define("jSkype/modelHelpers/personHelper",["require","exports","module","lodash-compat","jSkype/modelHelpers/contacts/dataMappers/dataMaps","jSkype/services/stratus/serviceSettings","constants/people","jSkype/constants/people"],function(e,t){function f(e){return e.match(u)}function l(e,i){return t.isPstnId(e)?c(e,r.contactTypes.pstn):n(r.contactTypes).values().contains(i)?c(e,i):c(e,r.contactTypes.skype)}function c(e,t){return t+":"+e}var n=e("lodash-compat"),r=e("jSkype/modelHelpers/contacts/dataMappers/dataMaps"),i=e("jSkype/services/stratus/serviceSettings"),s=e("constants/people"),o=e("jSkype/constants/people").authorizationStates,u=/^(?:(\d+):)+/,a=/^guest:/;t.getId=function(e){if(n.isString(e))return e.replace(u,"")},t.getKey=function(e,t){if(n.isString(e))return f(e)?e:l(e,t)},t.getAvatarUri=function(e){if(n.isString(e))return i.getAvatarEndPoint(e)},t.isGuest=function(e){return a.test(e.id())},t.isGuestId=function(e){return a.test(e)},t.getTypeFromKey=function(e){var t=u.exec(e);if(t)return t[1]},t.isPstn=function(e){return!!e.phoneNumbers.size()&&e.id()===e.phoneNumbers(0).telUri()},t.isPstnId=function(e){return/^(\+)?\d+$/.test(e)},t.isEchoContact=function(e){return t.isEchoContactId(e.id())},t.isEchoContactId=function(e){return e===s.ECHO_CONTACT_ID},t.canRequestContactAuthorization=function(e){return!t.isPstn(e)&&!e.isBlocked()},t.canAddToChatServiceContactList=function(e){return e._authorization()===o.AUTHORIZED&&!e.isBlocked()&&!t.isPstn(e)&&!t.isEchoContact(e)},t.canRemoveContactFromChatServiceContactList=function(e){return!t.isPstn(e)&&!t.isEchoContact(e)}}),define("jSkype/services/webapi/builders/requestURIBuilder",["require","exports","module","swx-utils-common","jSkype/modelHelpers/personHelper","jSkype/modelHelpers/personsAndGroupsHelper"],function(e,t){function v(e){return u+e}function m(e,t){return t.replace(o,"")+(e||"")}function g(){return"/"+n.get("endpointId")}function y(e){var t=i.getPersonById(e);return r.getKey(e,t?t._type():null)}var n=e("swx-utils-common").sessionStorage,r=e("jSkype/modelHelpers/personHelper"),i=e("jSkype/modelHelpers/personsAndGroupsHelper"),s="v1",o=/http(s)?:\/\/+[\w\-.]*/,u=s+"/users/ME",a="/ng/ping",f="/messages",l="/conversations",c="/threads",h="/members",p="/contacts",d="/endpoints";t.ping=function(){return s+a},t.conversations=function(e){var t=l;return e&&(t+="/"+e),v(t)},t.messageProperties=function(e,t){var n="/"+e+f,r="/"+t+"/properties",i=l+n+r;return v(i)},t.messages=function(e){var t="/"+e+f,n=l+t;return v(n)},t.thread=function(e){return s+c+"/"+e},t.member=function(e,t){return this.thread(e)+h+"/"+y(t)},t.contacts=function(e,t){var n=e?"/"+y(e):"";return t=t||"",v(p+n+t)},t.customResource=function(e,t){var n;return t?n=m(e,t):n=v(e),n},t.constructPresenceEndpointURI=function(e){return u+d+g()+e}}),define("jSkype/services/webapi/builders/headerSelector",["require","exports","module","lodash-compat","swx-utils-common","jSkype/constants/data","jSkype/client","jSkype/services/clientInfo","jcafe-property-model","jSkype/services/webapi/constants"],function(e,t){function p(){var e=r.get(l)||0,s=e<n.now(),o=r.get(i.SKYPE_ID_REG_TOKEN)!==d(),u=r.get(f)!==null;if(s||o)t.clearRegistrationToken(),u=!1;o&&v(),c(u)}function d(){return s.get().personsAndGroupsManager.mePerson.id()}function v(){r.remove(i.ENDPOINT_ID),r.remove(i.PRESENCE_DATA)}function m(){return{ClientInfo:o.getClientInfo(),"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0",ContextId:"tcid="+(new Date).getTime()+(Math.floor(Math.random()*9e4)+1e4),BehaviorOverride:"redirectAs404"}}var n=e("lodash-compat"),r=e("swx-utils-common").sessionStorage,i=e("jSkype/constants/data").storageKeys,s=e("jSkype/client"),o=e("jSkype/services/clientInfo"),u=e("jcafe-property-model"),a=e("jSkype/services/webapi/constants"),f="registrationToken",l=f+"Expiration",c=u.boolProperty(!1),h;t.setLockAndKey=function(e){h=e},t.setRegistrationToken=function(e){var t=/registrationToken=(.+); expires=(\d+)/,n=t.test(e)&&e.match(t),s=n&&(new Date(n[2]*1e3)).getTime();s&&s>0&&(r.set(f,f+"="+n[1]),r.set(l,s),r.set(i.SKYPE_ID_REG_TOKEN,d()),c(!0))},t.clearRegistrationToken=function(){r.remove(f),r.remove(l),c(!1)},t.fetch=function(e){function i(){e===a.SERVICE_CALLS.REQUEST_ENDPOINT_CREATION?s.get().signInManager._skypeToken().then(l,n.reject.bind(n)):c.once(!0,o)}function o(){t.RegistrationToken=r.get(f),n.resolve(t)}function l(e){t.LockAndKey=h,t.Authentication="skypetoken="+e,n.resolve(t)}var t=m(),n=u.task();return p(),c()?o():h?i():n.reject(new Error("no valid authorization token present")),n.promise}}),define("jSkype/services/webapi/utils/exponentialTimeout",["require","exports","module","jSkype/settings","constants/common"],function(e,t){function u(){o&&clearTimeout(o)}var n=e("jSkype/settings"),r=e("constants/common"),i=null,s=1,o;t.execute=function(e){var t=1e3,a=12e4,f=0;n.isFeatureOn(r.featureFlags.ENABLE_ENDPOINT_ECS_CONFIG)&&(t=n.settings.webApiService.endpointRetry.base*1e3,a=n.settings.webApiService.endpointRetry.limit*1e3,f=n.settings.webApiService.endpointRetry.noiseFactor),u(),i===null&&(i=t),o=setTimeout(e,i+Math.random()*f*i),i<a&&(s++,i*=s)},t.reset=function(){u(),i=null,s=1}}),define("jSkype/services/webapi/boundary/facade",["require","lodash-compat","usertiming","constants/common","jSkype/client","jSkype/constants/data","jcafe-property-model","jSkype/services/internalPubSub","jSkype/services/webapi/builders/requestURIBuilder","jSkype/services/webapi/builders/headerSelector","jSkype/services/webapi/constants","jSkype/services/webapi/utils/exponentialTimeout","jSkype/settings","jSkype/services/serviceAccessLayer/serviceQosReporterFacade","swx-utils-common","utils/common/cache/instance"],function(e){function S(e,t){var n=e.getAllResponseHeaders().toLowerCase();return n.indexOf(t)===-1?null:e.getResponseHeader(t)}function x(e){e=e||"";var t=e.match(/^(https?:.+?\.live\.com)/i);return t?t[1]:null}function T(e,t){var n=new RegExp("errorCode[\"']?:[\"']?"+t,"i");return n.test(e)}var t=e("lodash-compat"),n=e("usertiming"),r=e("constants/common"),i=e("jSkype/client"),s=e("jSkype/constants/data").storageKeys,o=e("jcafe-property-model"),u=e("jSkype/services/internalPubSub"),a=e("jSkype/services/webapi/builders/requestURIBuilder"),f=e("jSkype/services/webapi/builders/headerSelector"),l=e("jSkype/services/webapi/constants"),c=e("jSkype/services/webapi/utils/exponentialTimeout"),h=e("jSkype/settings"),p=e("jSkype/services/serviceAccessLayer/serviceQosReporterFacade"),d=e("swx-utils-common").sessionStorage,v=e("utils/common/cache/instance"),m=r.msnpErrors,g=r.httpStatusCodes,y=r.events.system,b=r.onlineStates,w=r.telemetry.performanceMarks,E=["/v1/users/ME/conversations/ALL/properties","/v1/users/ME/conversations/ALL/messages","/v1/users/ME/contacts/ALL","/v1/threads/ALL"];return function(N,C,k){function D(e){return function(){d.get(s.ENDPOINT_ID)!==null&&e.apply(L,arguments)}}function j(e){var t,n=new RegExp(s.ENDPOINT_ID+"=({.+})"),r=e&&e.match(n);r&&(t=r[1],d.set(s.ENDPOINT_ID,t),v.get().setItem(s.ENDPOINT_ID,t),P(!0))}function F(){A.promise.state()==="pending"&&A.resolve()}function I(e,t){var n="chat-4171",r;t?d.set(n,e):(r=d.get(n),d.set(n,r+">"+e))}function q(e,t,r){var i=e.status===g.notFound&&T(e.response,m.redirectionOverride),s;return i?(s=x(S(e,"location")),s?(r&&n.mark(r),k.updateServiceDomain(s),t(),!0):!1):!1}function R(e){if(!h.isFeatureOn(r.featureFlags.PINNING_TO_DOGFOOD_CLOUD))return!1;var t=/https:\/\/.*?-?df-/i,n=t.test(x(e.responseURL)),i=x(S(e,"location")),s=t.test(i),o=e.status===g.notFound&&n&&!s;return o&&(k.updateServiceDomain(i),L.pinUserToDogfoodCloud()),o}function U(e){function n(n){var r=d.get("chat-4171"),s=r.match(/(\d+)x>P$/),o=new Date-H;s?(r=r.replace(/\d+x>P$/,""),I(r+(+s[1]+1)+"x",!0)):I("POK1x"),t.success(n);if(i.get()._standbyMode()&&(B||o>L._internal.POLLING_DURATION)){var u=h.settings.webApiService.standbyPollingDelayTime.min||30,a=h.settings.webApiService.standbyPollingDelayTime.max||60,f=W(u,a),l=new Promise(function(e){setTimeout(e,f*1e3)});Promise.race([M,l]).then(U.bind(null,e)),B=!0}else U(e)}function r(e){t.error(e);if(q(e,L.poll)){I("PERR404");return}e.status===0?(I("PERR0"),L.ping()):(I("PERR"),L.poll())}var t=N("polling");A.promise.then(function(){I("P"),H=new Date,k.requestPolling(e).then(n,r)})}function z(){k.setEndpointProperty(l.ENDPOINT_PROPERTIES.SUPPORTS_MESSAGE_PROPERTIES,!0)}function W(e,t){return Math.floor(Math.random()*Math.abs(t-e)+e)}var L=this,A=o.task(),O=!1,M=new Promise(function(e){i.get()._standbyMode.once(!1,e)}),P=o.property({value:!!d.get(s.ENDPOINT_ID)}),H,B;this._internal={ANNOTATIONS_RETRY_COUNT:50,ANNOTATIONS_RETRY_TIMEOUT:200,POLLING_DURATION:5e3},this.setMessageProperty=function(e,t,n,r,i,s){function o(o){q(o,L.setMessageProperty.bind(L,e,t,n,r,i,s))||s(o)}function a(){u++,u<L._internal.ANNOTATIONS_RETRY_COUNT&&(t._actualId?k.setMessageProperty(e,t._actualId,n,r).then(i,o):setTimeout(a,L._internal.ANNOTATIONS_RETRY_TIMEOUT))}var u=0;a()},this.removeMessageProperty=function(e,t,n,r,i,s){function o(o){q(o,L.removeMessageProperty.bind(L,e,t,n,r,i,s))||s(o)}function a(){u++,u<L._internal.ANNOTATIONS_RETRY_COUNT&&(t._actualId?k.removeMessageProperty(e,t._actualId,n,r).then(i,o):setTimeout(a,L._internal.ANNOTATIONS_RETRY_TIMEOUT))}var u=0;a()},this.removeAllMessages=function(e,t,n){function s(e){r.statusCode=e.response.status,t&&t()}function o(i){q(i,L.removeAllMessages.bind(L,e,t,n))||n(i),r.statusCode=i.status}var r=i.get()._telemetry.context;k.removeAllMessages(e).then(s,o)},this.setConversationOption=function(e,t,n,r,i){function s(s){q(s,L.setConversationOption.bind(L,e,t,n,r,i))||i(s)}k.setConversationOption(e,t,n).then(r,s)},this.setThreadOption=function(e,t,n,r,i){function s(s){q(s,L.setThreadOption.bind(L,e,t,n,r,i))||i(s)}k.setThreadOption(e,t,n).then(r,s)},this.pinUserToDogfoodCloud=function(){function t(t){e.success(t),L.poll()}function n(t){e.error(t),q(t,L.pinUserToDogfoodCloud)}var e=N("pinToDogfood");k.pinToDogfood().then(t,n)},this.ping=function(){var e=u.get();e.publish(y.ONLINE_STATE_CHANGED,b.OFFLINE),I("O");var t=N("ping");k.ping().then(function(r){I("OOK"),e.publish(y.ONLINE_STATE_CHANGED,b.ONLINE),t.success(r),L.poll(),p.getInstance().reportSuccess("webapi-ping")},function(n){var i=d.get("chat-4171"),s=i.match(/(\d+)x>O$/),o=1e3;if(h.isFeatureOn(r.featureFlags.ENABLE_PING_ECS_CONFIG)){var u=h.settings.webApiService.pingDelayTime.min||30,a=h.settings.webApiService.pingDelayTime.max||60;o=W(u*1e3,a*1e3)}s?(i=i.replace(/\d+x>O$/,""),I(i+(+s[1]+1)+"x",!0)):I("OERR1x"),t.error(n),setTimeout(L.ping,o)})},this.createConversation=function(e,t,r){function s(e){n.mark(w.NEW_CONVERSATION.CREATION_END_OK),i.success(e);var r=S(e.request,"location"),s=r.match(/threads\/(19:.*)$/)[1];t(s)}function o(s){n.mark(w.NEW_CONVERSATION.CREATION_END_ERROR),i.error(s),q(s,L.createConversation.bind(L,e,t,r)),r(s)}n.mark(w.NEW_CONVERSATION.CREATION_START);var i=N("createConversation");k.createConversation(e).then(s,o)},this.getUserPresence=function(e){function n(n){t.error(n),q(n,L.getUserPresence.bind(L,e))}var t=N("getUserPresence");k.getUserPresence(e).then(t.success,n)},this.setEndpointPresence=function(){function t(t){e.error(t),q(t,L.setEndpointPresence)}var e=N("setEndpointPresence");k.setEndpointPresence().then(e.success,t)},this.activateEndpoint=function(){function e(){var e=N("activateEndpoint");k.activateEndpoint().then(e.success,e.error)}P.when(!0,e)},this._getEndpointId=function(){return new Promise(function(e){var t=d.get(s.ENDPOINT_ID);v.get().getItem(s.ENDPOINT_ID).then(function(n){n===t?e(t):e()})})},this.poll=function(){function o(e){n.error(e);if(q(e,L.poll)){I("SERR404");return}I("SERR");if(e.status===g.notFound&&T(e.response,m.missingEndpoint))return;c.execute(L.poll)}function l(e){I("SOK"),n.success(e),L.setEndpointPresence(),U(S(e.request,"location"))}function p(t){e.error(t),v(t);if(R(t)){I("EERRdf");return}if(q(t,L.poll)){I("EERR404");return}if(t.status===g.forbidden){f.clearRegistrationToken(),I("EERR403("+t.getResponseHeader("contextId")+';"'+t.responseText+'")'+!!d.get("registrationTokenRealTime")),L.poll();return}I("EERR"),c.execute(L.poll)}function v(e){var t=S(e,"set-registrationtoken");t&&(f.setRegistrationToken(t),j(t))}function b(t){var n=t.response,f=t.request,p=r.telemetry.timelineLoadOrigin,m=i.get()._telemetry.context,g=u.get(),b;v(f),I("EOK"),c.reset(),e.success(t),b=d.get(s.RESURECTION_KEY),b?(d.remove(s.RESURECTION_KEY),m.timelineLoadOrigin=p.RESSURECT):P()?m.timelineLoadOrigin=p.RELOAD:m.timelineLoadOrigin=p.LOAD;if(!h.settings.isPollingEnabled)return;h.isFeatureOn(r.featureFlags.SUPPORT_MESSAGE_PROPERTIES)&&z();if(n.subscriptions&&n.subscriptions.length>0){var S=a.customResource("/endpoints/SELF/subscriptions/")+n.subscriptions[0].id;w().finally(function(){U(S)})}else O&&g.publish(y.FORCE_RESYNC),w().finally(function(){I("S"),k.requestSubscriptionCreation(E).then(l,o)});O=!0}function w(){var e=k.getSelfProperties();return e.then(t.success.bind(t),t.error.bind(t)),e}function x(){var e="Agent";return h.isFeatureOn(r.featureFlags.READ_RECEIPT_ENABLED)&&(e+=",readReceipts"),{endpointFeatures:e}}var e=N("endpointCreation"),t=N("getSelfProperties"),n=N("subscriptionCreation");I("E"+!!d.get(s.ENDPOINT_ID)),L._getEndpointId().then(function(e){k.requestEndpointCreation(e,x()).then(b,p)})},this.reset=function(){function e(){O=!1}return k.abortCurrentPoll(),k.requestEndpointRemoval(d.get(s.ENDPOINT_ID)).then(e,e)},this.postMessage=function(e,t,r,s){function a(e){n.mark(w.IM_SEND.POST_END_OK+o),u.enqueueSentMessageInfo(t),r(e)}function f(i){if(q(i,L.postMessage.bind(L,e,t,r,s)))return;n.mark(w.IM_SEND.POST_END_ERROR+o),u.enqueueSentMessageInfo(t),s(i)}var o=t.clientmessageid,u=i.get()._telemetry.messagesCollector;n.mark(w.IM_SEND.POST_START+o),k.postMessage(e,t).then(a,f)},this.sendContactsList=function(e){k.sendContactsList(e).then(t.noop,function(n){q(n,L.sendContactsList.bind(L,e))})},this.addContactToContactsList=D(function(e){k.addContactToContactsList(e).then(t.noop,function(n){q(n,L.addContactToContactsList.bind(L,e))})}),this.removeContactFromContactsList=D(function(e){k.removeContactFromContactsList(e).then(t.noop,function(n){q(n,L.removeContactFromContactsList.bind(L,e))})}),this.addParticipant=function(e,t,n,r,i){k.addParticipant(e,t,n).then(r,function(o){q(o,L.addParticipant.bind(L,e,t,n,r,i))||typeof i=="function"&&i(o)})},this.removeParticipant=function(e,t,n,r){k.removeParticipant(e,t).then(n,function(s){q(s,L.removeParticipant.bind(L,e,t,n,r))||r(s)})},this.setConsumptionHorizon=function(e,t,n){function i(e){n&&n(e),r.success(e)}function s(n){r.error(n),q(n,L.setConsumptionHorizon.bind(L,e,t))}var r=N("setConsumptionHorizon");k.setConsumptionHorizon(e,t).then(i,s)},this.getFavorites=function(){return new Promise(function(e,t){function r(t){n.success(t),e(t)}function i(e){n.error(e),q(e,L.getFavorites.bind(L))||t()}var n=N("getFavorites");k.getFavorites().then(r,i)})},this.setFavorites=function(e){return new Promise(function(t,n){function i(e){r.success(e),t()}function s(t){r.error(t),q(t,L.setFavorites.bind(L,e))||n()}var r=N("setFavorites");k.setFavorites(e).then(i,s)})},this.setUserPresence=function(e){function n(n){t.error(n),q(n,L.setUserPresence.bind(L,e))}var t=N("setUserPresence");k.setUserPresence(e).then(t.success,n)},this.syncMessages=function(e,t,n,r,s){function a(t){var n=C.buildMessageSuccess(e,r);F(),n(t)}function f(i){u.chatHistoryLoadResult[e]=i.status;var a=q(i,L.syncMessages.bind(L,e,t,n,r,s));a?u.isChatHistoryLoad404=!0:(o.error(i),s&&s())}var o=N("syncMessages"),u=i.get()._telemetry.context;u.chatHistoryLoadResult[e]=g.OK,k.fetchMessages(e,t,n).then(a,f)},this.syncMessagesLoadMore=function(e,t,n,r){function s(t){var r=C.buildMessageSuccess(e,n);r(t)}function o(s){var o=q(s,L.syncMessagesLoadMore.bind(L,e,t,n,r));o||(i.error(s),r(s))}var i=N("syncMessagesLoadMore");k.fetchMessagesLoadMore(e,t).then(s,o)},this.syncRecents=function(e,t,n,r){function i(e){n(e),F()}function s(i){var s=q(i,L.syncRecents.bind(L,e,t,n,r));s||r(i)}k.fetchConversations(e,t).then(i,s)},this.syncRecentsBySyncState=function(e,t,n,i){function s(e){n(e),h.isFeatureOn(r.featureFlags.DISABLE_POLLING_ON_KAHUNA)||F()}function o(r){var s=q(r,L.syncRecentsBySyncState.bind(L,e,t,n,i));s||i(r)}k.fetchConversationsBySyncState(e,t).then(s,o)},this.syncConversation=function(e,t,n){function r(e){t(e),F()}function i(r){var i=q(r,L.syncConversation.bind(L,e,t,n));i||n(r)}k.fetchConversation(e).then(r,i)},this.syncThread=function(e,t,n){function i(e){r.success(e),t(),F()}function s(i){var s=q(i,L.syncThread.bind(L,e,t,n));s||(r.error(i),n())}var r=N("syncThread");t=t||function(){},n=n||function(){},k.fetchThread(e).then(i,s)}}}),define("jSkype/services/webapi/boundary/dispatcher",["require","lodash-compat","jSkype/services/internalPubSub"],function(e){var t=e("lodash-compat"),n=e("jSkype/services/internalPubSub");return function(r){function i(e){return e=e||{},t.isObject(e)&&(e.moduleName="webapi",e.actionName=r),e}this.success=function(e){var t=i(e.response);n.get().publish("webapi:data",t)},this.error=function(e){var t=i(e);n.get().publish("webapi:error",t)}}}),define("jSkype/services/webapi/utils/conversationMetadataStore",[],function(){var e={};return{get:function(t){if(typeof t=="string"&&e[t])return e[t].syncState},set:function(t,n){typeof t=="string"&&(e[t]={syncState:n})},clear:function(t){delete e[t]}}}),define("jSkype/services/webapi/calls/service",["require","lodash-compat","browser/detect","swx-enums","constants/common","jSkype/client","jSkype/modelHelpers/personHelper","jSkype/services/clientInfo","jSkype/services/webapi/constants","jSkype/services/webapi/utils/conversationMetadataStore","jSkype/settings"],function(e){var t=e("lodash-compat"),n=e("browser/detect"),r=e("swx-enums"),i=e("constants/common"),s=e("jSkype/client"),o=e("jSkype/modelHelpers/personHelper"),u=e("jSkype/services/clientInfo"),a=e("jSkype/services/webapi/constants"),f=e("jSkype/services/webapi/utils/conversationMetadataStore"),l=e("jSkype/settings");return function(c,h,p){function v(e,n,r,i,s){function u(e){return p.put(n,e)}var o={params:{},payload:{}};return o.params.name=r,o.payload[r]=i,t.forOwn(s,function(e,t){o.params[t]=e}),h.build(e,o).then(u)}var d;this.updateServiceDomain=function(e){p.uriBuilder.setDomain(e)},this.setConversationOption=function(e,t,n){var r="/conversations/"+e+"/properties",i=c.customResource(r);return v(a.SERVICE_CALLS.SET_CONVERSATION_OPTION,i,t,n)},this.setThreadOption=function(e,t,n){var r="v1/threads/"+e+"/properties";return v(a.SERVICE_CALLS.SET_THREAD_OPTION,r,t,n)},this.ping=function(){var e=c.ping();return p.get(e,{})},this.pinToDogfood=function(){function t(e){return p.put("v1/users/ME/properties",e)}var e={params:{name:"dogfoodUser"},payload:{dogfoodUser:!0}};return h.build(a.SERVICE_CALLS.PIN_TO_DOGFOOD,e).then(t)},this.createConversation=function(e){function n(e){return p.post("v1/threads",e)}var t={payload:{members:e}};return h.build(a.SERVICE_CALLS.CREATE_CONVERSATION,t).then(n)},this.postMessage=function(e,t){function i(e){return p.post(n,e)}function s(e){}var n=c.messages(e),r={payload:t};return h.build(a.SERVICE_CALLS.POST_MESSAGE,r).then(i,s)},this.addParticipant=function(e,t,n){function o(e){return p.put(i,e)}var i=c.member(e,t),s={payload:{role:n===r.participantRole.Leader?"Admin":"User"}};return h.build(a.SERVICE_CALLS.ADD_PARTICIPANT,s).then(o)},this.removeParticipant=function(e,t){function r(e){return p.remove(n,e)}var n=c.member(e,t);return h.build(a.SERVICE_CALLS.REMOVE_PARTICIPANT).then(r)},this.setConsumptionHorizon=function(e,t){var n="/conversations/"+e+"/properties",o=c.customResource(n),u={};return l.isFeatureOn(i.featureFlags.READ_RECEIPT_ENABLED)&&s.get().personsAndGroupsManager.mePerson.status()===r.onlineStatus.Online&&(u.readReceipt=!0),v(a.SERVICE_CALLS.SET_CONSUMPTION_HORIZON,o,"consumptionhorizon",t,u)},this.getFavorites=function(){function t(e){return p.get("v1/users/ME/properties",e)}var e={};if(!l.isFeatureOn(i.featureFlags.FAVORITES_CONVERSATION_ENABLED))return;return h.build(a.SERVICE_CALLS.GET_FAVORITES,e).then(t)},this.setFavorites=function(e){function s(i){i&&i.response&&i.response.favorites?r=JSON.parse(i.response.favorites):r=[],t.indexOf(r,e)!==-1?t.pull(r,e):r.push(e),n={params:{name:"favorites"},payload:{favorites:JSON.stringify(r)}}}function o(e){return p.put("v1/users/ME/properties",e)}var n,r;if(!l.isFeatureOn(i.featureFlags.FAVORITES_CONVERSATION_ENABLED))return;return this.getFavorites().then(s).then(function(){return h.build(a.SERVICE_CALLS.SET_FAVORITES,n).then(o)})},this.fetchMessages=function(e,t,n){function o(e){return p.get(r,e)}var r=c.messages(e),s={params:{startTime:t,pageSize:n,view:"msnp24Equivalent"+(l.isFeatureOn(i.featureFlags.SUPPORT_MESSAGE_PROPERTIES)?"|supportsMessageProperties":""),targetType:"Passport|Skype|Lync|Thread"+(l.isFeatureOn(i.featureFlags.PSTN_ENABLED)?"|PSTN":"")+(l.isFeatureOn(i.featureFlags.AGENTS_ENABLED)?"|Agent":"")}};return h.build(a.SERVICE_CALLS.FETCH_MESSAGES,s).then(o)},this.fetchMessagesLoadMore=function(e,t){function s(e){return p.get(n,e)}var n=c.messages(e),r={params:{syncState:f.get(e),startTime:0,pageSize:t,view:"msnp24Equivalent"+(l.isFeatureOn(i.featureFlags.SUPPORT_MESSAGE_PROPERTIES)?"|supportsMessageProperties":"")}};return h.build(a.SERVICE_CALLS.FETCH_MESSAGES_LOAD_MORE,r).then(s)},this.fetchThread=function(e){function r(e){return p.get(t,e)}var t=c.thread(e),n={params:{view:"msnp24Equivalent"}};return h.build(a.SERVICE_CALLS.FETCH_THREAD,n).then(r)},this.fetchConversation=function(e){function r(e){return p.get(t,e)}var t=c.conversations(e),n={params:{view:"msnp24Equivalent"}};return h.build(a.SERVICE_CALLS.FETCH_CONVERSATION,n).then(r)},this.fetchConversations=function(e,t){function s(e){return p.get(n,e)}var n=c.conversations(),r={params:{startTime:e,pageSize:t,view:"msnp24Equivalent",targetType:"Passport|Skype|Lync|Thread"+(l.isFeatureOn(i.featureFlags.PSTN_ENABLED)?"|PSTN":"")+(l.isFeatureOn(i.featureFlags.AGENTS_ENABLED)?"|Agent":"")}};return h.build(a.SERVICE_CALLS.FETCH_CONVERSATIONS,r).then(s)},this.fetchConversationsBySyncState=function(e,t){function i(e){return p.get(n,e)}var n=c.conversations(),r={params:{syncState:e,pageSize:t,view:"msnp24Equivalent"}};return h.build(a.SERVICE_CALLS.FETCH_CONVERSATIONS_BY_SYNC_STATE,r).then(i)},this.requestEndpointCreation=function(e,t){function s(t){return e?p.put(r,t):p.post(r,t)}var n="/endpoints"+(e?"/"+e:""),r=c.customResource(n),i={payload:t||{}};return h.build(a.SERVICE_CALLS.REQUEST_ENDPOINT_CREATION,i).then(s)},this.requestEndpointRemoval=function(e){function i(e){return p.remove(n,e)}if(!e)return Promise.reject(new Error("invalid endpointID"));var t="/endpoints/"+e,n=c.customResource(t),r={payload:{}};return h.build(a.SERVICE_CALLS.REQUEST_ENDPOINT_DELETION,r).then(i)},this.requestSubscriptionCreation=function(e){function r(e){return p.post(t,e)}var t=c.customResource("/endpoints/SELF/subscriptions"),n={payload:{channelType:"httpLongPoll",template:"raw",interestedResources:e}};return h.build(a.SERVICE_CALLS.REQUEST_SUBSCRIPTION_CREATION,n).then(r)},this.requestPolling=function(e){function n(e){var n=p.post(t,e);return d=n,n}var t=c.customResource("/poll",e);return h.build(a.SERVICE_CALLS.REQUEST_POLLING).then(n)},this.abortCurrentPoll=function(){d&&d._abort()},this.setEndpointPresence=function(){function i(t){return p.put(e,t)}var e=c.constructPresenceEndpointURI("/presenceDocs/messagingService"),t=n.getSystemInfo(),r={id:"messagingService",type:"EndpointPresenceDoc",selfLink:"uri",privateInfo:{epname:"skype"},publicInfo:{capabilities:"video|audio",type:t.deviceType,skypeNameVersion:u.getBIAppName(),nodeInfo:"",version:u.getBIVersion()}};return h.build(a.SERVICE_CALLS.SET_ENDPOINT_PRESENCE,{payload:r}).then(i)},this.setEndpointProperty=function(e,t){function i(e){return p.put(n,e)}var n=c.customResource("/endpoints/SELF/properties"),r={params:{name:e},payload:{}};return r.payload[e]=t,h.build(a.SERVICE_CALLS.SET_ENDPOINT_PROPERTY,r).then(i)},this.activateEndpoint=function(){function n(t){return p.post(e,t)}var e=c.constructPresenceEndpointURI("/active"),t={payload:{timeout:a.ACTIVATE_ENDPOINT_TIMEOUT/1e3}};return h.build(a.SERVICE_CALLS.ACTIVATE_ENDPOINT,t).then(n)},this.setUserPresence=function(e){function i(e){return p.put(n,e)}var n=c.customResource("/presenceDocs/messagingService"),r={payload:{status:t.capitalize(e)}};return h.build(a.SERVICE_CALLS.SET_USER_PRESENCE,r).then(i)},this.getUserPresence=function(e){function r(e){return p.get(n,e)}var t="/presenceDocs/messagingService",n=c.contacts(e,t);return h.build(a.SERVICE_CALLS.GET_USER_PRESENCE).then(r)},this.sendContactsList=function(e){function r(e){return{id:o.getKey(e.id(),e._type())}}function i(e){return p.post(t,e)}var t=c.contacts(),n={payload:{contacts:e.map(r)}};return h.build(a.SERVICE_CALLS.SEND_CONTACT_LIST,n).then(i)},this.addContactToContactsList=function(e){function n(e){return p.put(t,e)}var t=c.contacts(e);return h.build(a.SERVICE_CALLS.ADD_CONTACT_TO_CONTACTS_LIST).then(n)},this.removeContactFromContactsList=function(e){function n(e){return p.remove(t,e)}var t=c.contacts(e);return h.build(a.SERVICE_CALLS.REMOVE_CONTACT_FROM_CONTACTS_LIST).then(n)},this.getSelfProperties=function(){function t(t){return p.get(e,t)}var e=c.customResource("/properties");return h.build(a.SERVICE_CALLS.GET_SELF_PROPERTIES).then(t)},this.setMessageProperty=function(e,t,n,r){function o(e){return p.put(i,e)}var i=c.messageProperties(e,t),s={params:{name:n},payload:{}};return s.payload[n]=JSON.stringify(r),h.build(a.SERVICE_CALLS.SET_MESSAGE_PROPERTY,s).then(o)},this.removeMessageProperty=function(e,t,n,r){function u(e){return s.hasOwnProperty(e)&&s[e]===n}function l(e){return p.remove(i,e)}var i=c.messageProperties(e,t),s=a.MESSAGE_PROPERTIES.PER_USER,o={params:{name:n}};for(var f in s)if(u(f)){o.payload={},o.payload[n]=JSON.stringify({key:r});break}return h.build(a.SERVICE_CALLS.REMOVE_MESSAGE_PROPERTY,o).then(l)},this.removeAllMessages=function(e){function n(e){return p.remove(t,e)}var t=c.messages(e);return h.build(a.SERVICE_CALLS.REMOVE_ALL_MESSAGES).then(n)}}}),define("jSkype/services/serviceAccessLayer/transientFaultPolicy",[],function(){function t(e){return e.status===0}function n(e){return e instanceof XMLHttpRequest}function r(e,t){return t.test(e.status)}var e={success:/^(2)\d{2}/,redirection:/^(3)\d{2}/,serverError:/^(5)\d{2}/};return{isWebApiSuccess:function(t){return n(t)?r(t,e.success)||r(t,e.redirection):!1},isTransientFailure:function(i){return n(i)?t(i)||r(i,e.serverError):!1}}}),define("jSkype/services/webapi/builders/requestOptionsBuilder",["require","jcafe-property-model","jSkype/settings","jSkype/services/serviceAccessLayer/transientFaultPolicy"],function(e){var t=e("jcafe-property-model"),n=e("jSkype/settings"),r=e("jSkype/services/serviceAccessLayer/transientFaultPolicy");return function(i){this.build=function(e,s){function h(t){var n={headers:t,retry:{limit:a,delay:f,strategy:l,isTransientCheck:r.isTransientFailure,isSuccessCheck:r.isWebApiSuccess},reporting:{serviceName:"webapi-"+e}};s&&s.payload&&(n.payload=JSON.stringify(s.payload)),s&&s.params&&(n.params=s.params),o.resolve(n)}var o=t.task(),u=n.settings.webApiService,a=u.retry.limit,f=u.retry.delay,l=u.retry.strategy,c=u.overrides&&u.overrides[e];return i.fetch(e).then(h,o.reject.bind(o)),c&&(f=c.delay||f,a=c.limit||a,l=c.strategy||l),o.promise}}}),define("utils/common/regex",["require","exports","module"],function(e,t){t.escapeSpecialChars=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},t.multilineRegExp=function(e,t){return new RegExp(e.join(""),t)}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-encoder/lib/countryCodes",["require","exports"],e)}(function(e,t){t.CountryCodes={eu:"Europe",uk:"United Kingdom",af:"Afghanistan",ax:"&Aring;land Islands",al:"Albania",dz:"Algeria",as:"American Samoa",ad:"Andorra",ao:"Angola",ai:"Anguilla",aq:"Antarctica",ag:"Antigua and Barbuda",ar:"Argentina",am:"Armenia",aw:"Aruba",au:"Australia",at:"Austria",az:"Azerbaijan",bs:"Bahamas",bh:"Bahrain",bd:"Bangladesh",bb:"Barbados",by:"Belarus",be:"Belgium",bz:"Belize",bj:"Benin",bm:"Bermuda",bt:"Bhutan",bo:"Bolivia, Plurinational State of",ba:"Bosnia and Herzegovina",bw:"Botswana",bv:"Bouvet Island",br:"Brazil",io:"British Indian Ocean Territory",bn:"Brunei Darussalam",bg:"Bulgaria",bf:"Burkina Faso",bi:"Burundi",kh:"Cambodia",cm:"Cameroon",ca:"Canada",cv:"Cabo Verde",ky:"Cayman Islands",cf:"Central African Republic",td:"Chad",cl:"Chile",cn:"China",cx:"Christmas Island",cc:"Cocos (Keeling) Islands",co:"Colombia",km:"Comoros",cg:"Congo",cd:"Congo, the Democratic Republic of the",ck:"Cook Islands",cr:"Costa Rica",ci:"C&ocirc;te d'Ivoire",hr:"Croatia",cu:"Cuba",cy:"Cyprus",cz:"Czech Republic",dk:"Denmark",dj:"Djibouti",dm:"Dominica","do":"Dominican Republic",ec:"Ecuador",eg:"Egypt",sv:"El Salvador",gq:"Equatorial Guinea",er:"Eritrea",ee:"Estonia",et:"Ethiopia",fk:"Falkland Islands (Malvinas)",fo:"Faroe Islands",fj:"Fiji",fi:"Finland",fr:"France",gf:"French Guiana",pf:"French Polynesia",tf:"French Southern Territories",ga:"Gabon",gm:"Gambia",ge:"Georgia",de:"Germany",gh:"Ghana",gi:"Gibraltar",gr:"Greece",gl:"Greenland",gd:"Grenada",gp:"Guadeloupe",gu:"Guam",gt:"Guatemala",gg:"Guernsey",gn:"Guinea",gw:"Guinea-Bissau",gy:"Guyana",ht:"Haiti",hm:"Heard Island and McDonald Islands",va:"Holy See (Vatican City State)",hn:"Honduras",hk:"Hong Kong",hu:"Hungary",is:"Iceland","in":"India",id:"Indonesia",ir:"Iran, Islamic Republic of",iq:"Iraq",ie:"Ireland",im:"Isle of Man",il:"Israel",it:"Italy",jm:"Jamaica",jp:"Japan",je:"Jersey",jo:"Jordan",kz:"Kazakhstan",ke:"Kenya",ki:"Kiribati",kp:"Korea, Democratic People's Republic of",kr:"Korea, Republic of",kw:"Kuwait",kg:"Kyrgyzstan",la:"Lao People's Democratic Republic",lv:"Latvia",lb:"Lebanon",ls:"Lesotho",lr:"Liberia",ly:"Libya",li:"Liechtenstein",lt:"Lithuania",lu:"Luxembourg",mo:"Macao SAR",mk:"Macedonia, the former Yugoslav Republic of",mg:"Madagascar",mw:"Malawi",my:"Malaysia",mv:"Maldives",ml:"Mali",mt:"Malta",mh:"Marshall Islands",mq:"Martinique",mr:"Mauritania",mu:"Mauritius",yt:"Mayotte",mx:"Mexico",fm:"Micronesia, Federated States of",md:"Moldova, Republic of",mc:"Monaco",mn:"Mongolia",me:"Montenegro",ms:"Montserrat",ma:"Morocco",mz:"Mozambique",mm:"Myanmar",na:"Namibia",nr:"Nauru",np:"Nepal",nl:"Netherlands",an:"Netherlands Antilles",nc:"New Caledonia",nz:"New Zealand",ni:"Nicaragua",ne:"Niger",ng:"Nigeria",nu:"Niue",nf:"Norfolk Island",mp:"Northern Mariana Islands",no:"Norway",om:"Oman",pk:"Pakistan",pw:"Palau",ps:"Palestinian Authority",pa:"Panama",pg:"Papua New Guinea",py:"Paraguay",pe:"Peru",ph:"Philippines",pn:"Pitcairn",pl:"Poland",pt:"Portugal",pr:"Puerto Rico",qa:"Qatar",re:"R&eacute;union",ro:"Romania",ru:"Russian Federation",rw:"Rwanda",bl:"Saint Barth&eacute;lemy",sh:"Saint Helena, Ascension and Tristan da Cunha",kn:"Saint Kitts and Nevis",lc:"Saint Lucia",mf:"Saint Martin (French part)",pm:"Saint Pierre and Miquelon",vc:"Saint Vincent and the Grenadines",ws:"Samoa",sm:"San Marino",st:"Sao Tome and Principe",sa:"Saudi Arabia",sn:"Senegal",rs:"Serbia",sc:"Seychelles",sl:"Sierra Leone",sg:"Singapore",sk:"Slovakia",si:"Slovenia",sb:"Solomon Islands",so:"Somalia",za:"South Africa",gs:"South Georgia and the South Sandwich Islands",es:"Spain",lk:"Sri Lanka",sd:"Sudan",sr:"Suriname",sj:"Svalbard and Jan Mayen",sz:"Swaziland",se:"Sweden",ch:"Switzerland",sy:"Syrian Arab Republic",tw:"Taiwan",tj:"Tajikistan",tz:"Tanzania, United Republic of",th:"Thailand",tl:"Timor-Leste",tg:"Togo",tk:"Tokelau",to:"Tonga",tt:"Trinidad and Tobago",tn:"Tunisia",tr:"Turkey",tm:"Turkmenistan",tc:"Turks and Caicos Islands",tv:"Tuvalu",ug:"Uganda",ua:"Ukraine",ae:"United Arab Emirates",gb:"United Kingdom",us:"United States",um:"United States Minor Outlying Islands",uy:"Uruguay",uz:"Uzbekistan",vu:"Vanuatu",ve:"Venezuela, Bolivarian Republic of",vn:"Viet Nam",vg:"Virgin Islands, British",vi:"Virgin Islands, U.S.",wf:"Wallis and Futuna",ye:"Yemen",zm:"Zambia",zw:"Zimbabwe"}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-encoder/lib/encoder",["require","exports","./countryCodes"],e)}(function(e,t){function r(e,t){return typeof e=="undefined"?t:e}function i(e){var t={xml:!0,emoticons:{},countryCodes:{},largeEmoticonClass:"large",init:function(e){e=e||{},this.app=e.app,this.xml=r(e.xml,this.xml),this.emoticons=r(e.emoticons,this.emoticons),this.countryCodes=r(e.countries,n.CountryCodes),this.largeEmoticonClass=r(e.largeEmoticonClass,this.largeEmoticonClass)},encode:function(e,t){t=r(t,!0),!this.xml&&t&&(e=this.private.escapeXml(e)),e.search("<")!==-1&&this.xml&&t&&(e=this.private.escapeXml(e));var n="";for(var i=0;i<e.length;){var s=!0,o=i;i=this.firstLetter(e,i);if(i!==-1){var u=this.firstSeparator(e,i);u===-1&&(u=e.length);var a=e.substring(i,u),f=this.private.encodeWord(a,this);f&&(n+=e.substring(o,i),n+=f,s=!1),i=u}else i=e.length;s&&(++i,n+=e.substring(o,i))}return n},decode:function(e){function i(e,t){t.parentNode&&t.parentNode.replaceChild(e,t)}function s(){var e=r.getElementsByTagName("flag"),s=[];for(n=0;n<e.length;++n){var o=t.private.createFlagElement(a,e[n].getAttribute("country"),e[n].textContent);s.push([o,e[n]])}for(n=0;n<s.length;++n)i(s[n][0],s[n][1])}function o(){var e=r.getElementsByTagName("ss"),s=[],o=e.length<=3&&e.length>0;if(o)for(n=0;n<r.childNodes.length;++n){var u=r.childNodes[n].textContent.replace(" ","").length===0;o=o&&(r.childNodes[n].tagName==="ss"||u)}var f=e.length>20;for(n=0;n<e.length;++n){var l=t.private.createEmoticonElement(a,e[n].getAttribute("type"),e[n].textContent,o,f,t.largeEmoticonClass);s.push([l,e[n]])}for(n=0;n<s.length;++n)i(s[n][0],s[n][1])}function u(){if(!t.app)return;var e=r.getElementsByTagName("at"),s=[];for(n=0;n<e.length;++n){var o=t.private.createMentionElement(t.app,a,e[n].getAttribute("id"),e[n].textContent);s.push([o,e[n]])}for(n=0;n<s.length;++n)i(s[n][0],s[n][1])}var t=this,n,r;try{var a=this.private.parseXML(this.private.encapsulateInRootElement(e));if(a)return r=a.documentElement,s(),o(),u(),this.private.fixInvalidHTML(this.private.decapsulateFromRootElement(this.private.xmlToString(a)))}catch(f){}return e},escapeXml:function(e){return this.private.escapeXml(e)},getNodeTextContent:function(e){var t=this.private.parseXML(this.private.encapsulateInRootElement(e));return t&&t.documentElement?t.documentElement.textContent:e},firstLetter:function(e,t){t=r(t,0);for(var n=t;n<e.length;++n)if(!this.private.separators[e[n]])return n;return-1},firstSeparator:function(e,t){t=r(t,0);for(var n=t;n<e.length;++n)if(this.private.separators[e[n]])return n;return-1},"private":{separators:{"   ":!0,"\n":!0,"\r":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0,"　":!0},createEmoticonXmlTag:function(e,t){return'<ss type="'+e+'">'+this.escapeXml(t)+"</ss>"},createFlagXmlTag:function(e,t){return'<flag country="'+e+'">'+this.escapeXml(t)+"</flag>"},createMentionElement:function(e,t,n,r){var i=e.get().personsAndGroupsManager,s="mention",o,u,a;return n===i.mePerson.id()?(r=i.mePerson.displayName(),s+=" me"):(a=i.all.persons(n),a&&(r=a.displayName())),r=this.escapeXml(r),u=t.createElement("span"),u.setAttribute("title",n),u.textContent=r,o=t.createElement("i"),o.setAttribute("class",s),o.appendChild(u),o},createEmoticonElement:function(e,t,n,r,i,s){var o=e.createElement("span"),u=["emoticon"];u.push(t),i||u.push("animated"),r&&u.push(s),o.setAttribute("class",u.join(" "));var a=e.createElement("span");return a.textContent=n,a.setAttribute("class","emoSprite"),o.appendChild(a),o},createFlagElement:function(e,t,n){var r=e.createElement("span");return r.textContent=n,r.setAttribute("class","flag "+t),r.textContent="(flag:"+t+")",r},encapsulateInRootElement:function(e){var t;while(t!==e)t=e,e=e.replace(/<\s*?root[\s\S]*?>.*?(<\s*?\/\s*?root\s*?>)?/ig,"");return"<root>"+e+"</root>"},decapsulateFromRootElement:function(e){return e.match(/<root ?\/>/)?"":e.length==="</root>".length?"":e.substring("<root>".length,e.length-"</root>".length)},fixInvalidHTML:function(e){return e.replace(/<span class='emoSprite'\s*\/>/g,"<span class='emoSprite'></span>")},encodeWord:function(e,t){function i(e){return t.emoticons.map[e]}function s(e){return t.emoticons.firstLettersMap[e[0]]&&i(e)}function o(e){var t=!0,r=e;while(t){var i=r.replace(/[,.;?]$/,"");t=i!==r;if(t){n=u(i);if(n){n+=e.substring(i.length);break}}r=i}}function u(e){e=t.private.unescapeXml(e);for(var o=e.length-1;o>=0;){var u=!1,a=e.substring(o,r);if(s(a)){while(o>0){var f=e.substring(o-1,r);if(!s(f))break;o--,a=e.substring(o,r)}n=t.private.createEmoticonXmlTag(i(a),a)+n,u=!0}else if(!u&&a[0]==="("){var l=a.match(/^\(flag:(\w\w)\)$/i),c=l&&l[1];c&&t.countryCodes[c]&&(n=t.private.createFlagXmlTag(c,a)+n,u=!0)}u&&(r=o),--o}return n}var n="",r=e.length;return n=u(e),n||o(e),n===""?null:(r!==0&&(n=e.substring(0,r)+n),n)},parseXML:function(e){var t;try{if(window.DOMParser){var n=new DOMParser;n.async=!1,t=n.parseFromString(e,"text/xml")}else{t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1;if(t.loadXML(e))return t}}catch(r){return null}return t.parseError&&t.parseError.errorCode!==0?null:t.getElementsByTagName("parsererror").length>0?null:t},xmlToString:function(e){var t;try{t=(new XMLSerializer).serializeToString(e)}catch(n){t=e.xml}return t},xmlEscapeMap:{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&apos;"},escapeXml:function(e){var t=this.xmlEscapeMap;return e.replace(/[<>&"']/g,function(e){return t[e]})},unescapeXml:function(e){var t={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"};return e.replace(/&lt;|&gt;|&amp;|&quot;|&apos/g,function(e){return t[e]})}}};return t.init(e),t}var n=e("./countryCodes");t.build=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-encoder/lib/index",["require","exports","./countryCodes","./encoder"],e)}(function(e,t){var n=e("./countryCodes");t.CountryCodes=n.CountryCodes;var r=e("./encoder");t.build=r.build}),define("swx-encoder",["swx-encoder/lib/index"],function(e){return e}),define("services/pes/emoticons/encoder",[],function(){function e(){var e=this;e.map={":)":"smile",":-)":"smile",":=)":"smile","(smile)":"smile",":(":"sad",":-(":"sad",":=(":"sad","(sad)":"sad",":<":"sad",":-<":"sad",":D":"laugh",":-D":"laugh",":=D":"laugh",":d":"laugh",":-d":"laugh",":=d":"laugh","(laugh)":"laugh",":>":"laugh",":->":"laugh","(lol)":"laugh","(LOL)":"laugh","(cool)":"cool","8-)":"cool","8=)":"cool","B-)":"cool","B=)":"cool",":O":"surprised",":-O":"surprised",":=O":"surprised",":o":"surprised",":-o":"surprised",":=o":"surprised","(surprised)":"surprised",";)":"wink",";-)":"wink",";=)":"wink","(wink)":"wink",";(":"cry",";-(":"cry",";=(":"cry","(cry)":"cry",":'(":"cry","(:|":"sweat","(sweat)":"sweat",":|":"speechless",":-|":"speechless",":=|":"speechless","(speechless)":"speechless","(kiss)":"kiss",":*":"kiss",":-*":"kiss",":=*":"kiss","(xo)":"kiss","(K)":"kiss","(k)":"kiss",":P":"tongueout",":-P":"tongueout",":=P":"tongueout",":p":"tongueout",":-p":"tongueout",":=p":"tongueout","(tongueout)":"tongueout",":$":"blush",":-$":"blush",":=$":"blush",':">':"blush","(blush)":"blush",":^)":"wonder","(wonder)":"wonder","|-)":"sleepy","I-)":"sleepy","I=)":"sleepy","(snooze)":"sleepy","|-(":"dull","|(":"dull","|=(":"dull","(dull)":"dull","(inlove)":"inlove","(love)":"inlove",":]":"inlove",":-]":"inlove","]:)":"eg",">:)":"eg","(grin)":"eg","(yn)":"fingerscrossed","(fingers)":"fingerscrossed","(fingerscrossed)":"fingerscrossed","(crossedfingers)":"fingerscrossed","(yawn)":"yawn","(puke)":"puke",":&":"puke",":-&":"puke",":=&":"puke","+o(":"puke","(doh)":"doh","(angry)":"angry",":@":"angry",":-@":"angry",":=@":"angry","x(":"angry","x-(":"angry","X(":"angry","X-(":"angry","x=(":"angry","X=(":"angry",";@":"angry",";-@":"angry","(wasntme)":"wasntme","(wm)":"wasntme","(party)":"party","<O)":"party","<o)":"party","<:o)":"party","(worry)":"worry",":S":"worry",":s":"worry",":-s":"worry",":-S":"worry",":=s":"worry",":=S":"worry","(mm)":"mmm","(mmm)":"mmm","(mmmm)":"mmm","(nerd)":"nerdy","8-|":"nerdy","B-|":"nerdy","8|":"nerdy","B|":"nerdy","8=|":"nerdy","B=|":"nerdy",":x":"lipssealed",":-x":"lipssealed",":X":"lipssealed",":-X":"lipssealed",":#":"lipssealed",":-#":"lipssealed",":=x":"lipssealed",":=X":"lipssealed",":=#":"lipssealed","(wave)":"hi","(hi)":"hi","(bye)":"hi","(BYE)":"hi","(Bye)":"hi","(Hi)":"hi","(HI)":"hi","(facepalm)":"facepalm","(fail)":"facepalm","(devil)":"devil","(6)":"devil","(angel)":"angel","(A)":"angel","(a)":"angel","(envy)":"envy","(V)":"envy","(v)":"envy","(wait)":"wait","(hug)":"hug","(bear)":"hug","(makeup)":"makeup","(kate)":"makeup","(chuckle)":"giggle","(giggle)":"giggle","(clap)":"clap","(think)":"think",":-?":"think",":?":"think",":=?":"think","*-)":"think","(bow)":"bow","(rofl)":"rofl","(rotfl)":"rofl","(whew)":"whew","(phew)":"whew","(happy)":"happy","(smirk)":"smirk","(nod)":"nod","(shake)":"shake","(waiting)":"waiting","(forever)":"waiting","(impatience)":"waiting","(emo)":"emo","(y)":"yes","(Y)":"yes","(ok)":"yes","(yes)":"yes","(OK)":"yes","(oK)":"yes","(Ok)":"yes","(n)":"no","(N)":"no","(no)":"no","(handshake)":"handshake","(highfive)":"highfive","(hifive)":"highfive","(h5)":"highfive","(heart)":"heart","(h)":"heart","(H)":"heart","(l)":"heart","(L)":"heart","<3":"heart","(lalala)":"lalala","(lalalala)":"lalala","(lala)":"lalala","(notlistening)":"lalala","(heidy)":"heidy","(squirrel)":"heidy","(F)":"flower","(f)":"flower","(flower)":"flower","(rain)":"rain","(london)":"rain","(st)":"rain","(ST)":"rain","(St)":"rain","(sun)":"sun","(#)":"sun","(tumbleweed)":"tumbleweed","(music)":"music","(8)":"music","(bandit)":"bandit","(tmi)":"tmi","(coffee)":"coffee","(c)":"coffee","(C)":"coffee","(pi)":"pizza","(pizza)":"pizza","(cash)":"cash","(mo)":"cash","($)":"cash","(flex)":"muscle","(muscle)":"muscle","(^)":"cake","(cake)":"cake","(beer)":"beer","(bricklayers)":"beer","(B)":"beer","(b)":"beer","(d)":"drink","(D)":"drink","(drink)":"drink","\\o/":"dance","\\:D/":"dance","\\:d/":"dance","(dance)":"dance","(ninja)":"ninja","(J)":"ninja","(j)":"ninja","(*)":"star","(star)":"star","(headbang)":"headbang","(banghead)":"headbang","(swear)":"swear","(drunk)":"drunk","(finger)":"finger","(poolparty)":"poolparty","(hrv)":"poolparty","(rock)":"rock","(smoking)":"smoke","(smoke)":"smoke","(ci)":"smoke","(bug)":"bug","(toivo)":"toivo","(wfh)":"wfh","(@h)":"wfh","(@H)":"wfh","(hollest)":"hollest","(zilmer)":"priidu","(e)":"mail","(m)":"mail","(mail)":"mail","(E)":"mail","(o)":"time","(O)":"time","(time)":"time","(clock)":"time","(0)":"time","(~)":"movie","(film)":"movie","(movie)":"movie","(mp)":"phone","(ph)":"phone","(phone)":"phone","(talk)":"talk","(call)":"call","(T)":"call","(t)":"call","(punch)":"punch","*|":"punch","*-|":"punch","(skype)":"skype","(ss)":"skype","(u)":"brokenheart","(U)":"brokenheart","(brokenheart)":"brokenheart","(mooning)":"mooning","(oliver)":"oliver","(bartlett)":"bertlett","(football)":"bertlett","(soccer)":"bertlett","(so)":"bertlett","(talktothehand)":"talktothehand","(idea)":"idea",":i":"idea",":I":"idea","*-:)":"idea","(sheep)":"sheep","(bah)":"sheep","(cat)":"cat",":3":"cat","(@)":"cat","(meow)":"cat","(bike)":"bike","(bicycle)":"bike","(sander)":"bike","(dog)":"dog",":o3":"dog","(&)":"dog"},e.maxLength=16,e.minLength=2,e.firstLetters="8:(B;|I]>+xX<*\\",e.firstLettersMap={8:"8",":":":","(":"(",B:"B",";":";","|":"|",I:"I","]":"]",">":">","+":"+",x:"x",X:"X","<":"<","*":"*","\\":"\\"}}return new e}),define("utils/common/encoder",["require","exports","module","swx-encoder","constants/common","services/pes/emoticons/encoder","services/serviceLocator"],function(e,t){var n=e("swx-encoder"),r=e("constants/common"),i=e("services/pes/emoticons/encoder"),s=e("services/serviceLocator");t.build=function(e){var t=s.resolve(r.serviceLocator.FEATURE_FLAGS),o={app:e,emoticons:i};return t.isFeatureOn(r.featureFlags.PES_USE_EXTRA_LARGE_EMOTICONS)&&(o.largeEmoticonClass="extraLarge"),n.build(o)}}),function(e){var t=typeof window=="undefined"?null:window;typeof define=="function"&&define.amd?define("dompurify/src/purify",[],function(){return e(t)}):typeof module!="undefined"?module.exports=e(t):t.DOMPurify=e(t)}(function factory(e){var t=function(e){return factory(e)};t.version="0.7.3";if(!e||!e.document||e.document.nodeType!==9)return t.isSupported=!1,t;var n=e.document,r=n,i=e.DocumentFragment,s=e.HTMLTemplateElement,o=e.NodeFilter,u=e.NamedNodeMap||e.MozNamedAttrMap,a=e.Text,f=e.Comment,l=e.DOMParser;typeof s=="function"&&(n=n.createElement("template").content.ownerDocument);var c=n.implementation,h=n.createNodeIterator,p=n.getElementsByTagName,d=n.createDocumentFragment,v=r.importNode,m={};t.isSupported=typeof c.createHTMLDocument!="undefined"&&n.documentMode!==9;var g=function(e,t){var n=t.length;while(n--)e[t[n]]=!0;return e},y=function(e){var t={},n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},b=null,w=g({},["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr","svg","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","switch","symbol","text","textpath","title","tref","tspan","view","vkern","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","feSpecularLighting","feTile","feTurbulence","math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmuliscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mpspace","msqrt","mystyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","#text"]),E=null,S=g({},["accept","action","align","alt","autocomplete","background","bgcolor","border","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","coords","datetime","default","dir","disabled","download","enctype","face","for","headers","height","hidden","high","href","hreflang","id","ismap","label","lang","list","loop","low","max","maxlength","media","method","min","multiple","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","rows","rowspan","spellcheck","scope","selected","shape","size","span","srclang","start","src","step","style","summary","tabindex","title","type","usemap","valign","value","width","xmlns","accent-height","accumulate","additivive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mode","min","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","surfacescale","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","u1","u2","unicode","values","viewbox","visibility","vert-adv-y","vert-origin-x","vert-origin-y","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","y","y1","y2","z","zoomandpan","accent","accentunder","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","display","displaystyle","fence","frame","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),x=null,T=null,N=!0,C=!1,k=!1,L=!1,A=!1,O=!1,M=!1,_=!0,D=!0,P=g({},["audio","head","math","script","style","svg","video"]),H=null,B=n.createElement("form"),j=function(e){typeof e!="object"&&(e={}),b="ALLOWED_TAGS"in e?g({},e.ALLOWED_TAGS):w,E="ALLOWED_ATTR"in e?g({},e.ALLOWED_ATTR):S,x="FORBID_TAGS"in e?g({},e.FORBID_TAGS):{},T="FORBID_ATTR"in e?g({},e.FORBID_ATTR):{},N=e.ALLOW_DATA_ATTR!==!1,C=e.SAFE_FOR_JQUERY||!1,k=e.SAFE_FOR_TEMPLATES||!1,L=e.WHOLE_DOCUMENT||!1,A=e.RETURN_DOM||!1,O=e.RETURN_DOM_FRAGMENT||!1,M=e.RETURN_DOM_IMPORT||!1,_=e.SANITIZE_DOM!==!1,D=e.KEEP_CONTENT!==!1,O&&(A=!0),e.ADD_TAGS&&(b===w&&(b=y(b)),g(b,e.ADD_TAGS)),e.ADD_ATTR&&(E===S&&(E=y(E)),g(E,e.ADD_ATTR)),D&&(b["#text"]=!0),Object&&"freeze"in Object&&Object.freeze(e),H=e},F=function(e){try{e.parentNode.removeChild(e)}catch(t){e.outerHTML=""}},I=function(e){var t,n;try{t=(new l).parseFromString(e,"text/html")}catch(r){}return t||(t=c.createHTMLDocument(""),n=t.body,n.parentNode.removeChild(n.parentNode.firstElementChild),n.outerHTML=e),typeof t.getElementsByTagName=="function"?t.getElementsByTagName(L?"html":"body")[0]:p.call(t,L?"html":"body")[0]},q=function(e){return h.call(e.ownerDocument||e,e,o.SHOW_ELEMENT|o.SHOW_COMMENT|o.SHOW_TEXT,function(){return o.FILTER_ACCEPT},!1)},R=function(e){return e instanceof a||e instanceof f?!1:typeof e.nodeName=="string"&&typeof e.textContent=="string"&&typeof e.removeChild=="function"&&e.attributes instanceof u&&typeof e.removeAttribute=="function"&&typeof e.setAttribute=="function"?!1:!0},U=/\{\{.*|.*\}\}/gm,z=/<%.*|.*%>/gm,W=function(e){Q("beforeSanitizeElements",e,null);if(R(e))return F(e),!0;var t=e.nodeName.toLowerCase();Q("uponSanitizeElement",e,{tagName:t});if(!b[t]||x[t]){if(D&&!P[t]&&typeof e.insertAdjacentHTML=="function")try{e.insertAdjacentHTML("AfterEnd",e.innerHTML)}catch(n){}return F(e),!0}C&&!e.firstElementChild&&(!e.content||!e.content.firstElementChild)&&(e.innerHTML=e.textContent.replace(/</g,"&lt;"));if(k&&e.nodeType===3){var r=e.textContent;r=r.replace(U," "),r=r.replace(z," "),e.textContent=r}return Q("afterSanitizeElements",e,null),!1},X=/^data-[\w.\u00B7-\uFFFF-]/,V=/^(?:\w+script|data):/i,$=/[\x00-\x20\xA0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,J=function(t){Q("beforeSanitizeAttributes",t,null);var r=t.attributes;if(!r)return;var i={attrName:"",attrValue:"",keepAttr:!0},s=r.length,o,u,a,f,l;while(s--){o=r[s],u=o.name,a=o.value,f=u.toLowerCase(),i.attrName=f,i.attrValue=a,i.keepAttr=!0,Q("uponSanitizeAttribute",t,i),a=i.attrValue,f==="name"&&t.nodeName==="IMG"&&r.id?(l=r.id,r=Array.prototype.slice.apply(r),t.removeAttribute("id"),t.removeAttribute(u),r.indexOf(l)>s&&t.setAttribute("id",l.value)):(u==="id"&&t.setAttribute(u,""),t.removeAttribute(u));if(!i.keepAttr)continue;if(_&&(f==="id"||f==="name")&&(a in e||a in n||a in B))continue;if((E[f]&&!T[f]||!k&&N&&X.test(f))&&(!V.test(a.replace($,""))||f==="src"&&a.indexOf("data:")===0&&t.nodeName==="IMG"))try{k&&(a=a.replace(U," "),a=a.replace(z," ")),t.setAttribute(u,a)}catch(c){}}Q("afterSanitizeAttributes",t,null)},K=function(e){var t,n=q(e);Q("beforeSanitizeShadowDOM",e,null);while(t=n.nextNode()){Q("uponSanitizeShadowNode",t,null);if(W(t))continue;t.content instanceof i&&K(t.content),J(t)}Q("afterSanitizeShadowDOM",e,null)},Q=function(e,n,r){if(!m[e])return;m[e].forEach(function(e){e.call(t,n,r,H)})};return t.sanitize=function(n,s){n||(n=""),typeof n!="string"&&(n=n.toString());if(!t.isSupported)return typeof e.toStaticHTML=="object"||typeof e.toStaticHTML=="function"?e.toStaticHTML(n):n;j(s);if(!A&&!L&&n.indexOf("<")===-1)return n;var o=I(n);if(!o)return A?null:"";var u,a,f=q(o);while(u=f.nextNode()){if(u.nodeType===3&&u===a)continue;if(W(u))continue;u.content instanceof i&&K(u.content),J(u),a=u}var l;if(A){if(O){l=d.call(o.ownerDocument);while(o.firstChild)l.appendChild(o.firstChild)}else l=o;return M&&(l=v.call(r,l,!0)),l}return L?o.outerHTML:o.innerHTML},t.addHook=function(e,t){if(typeof t!="function")return;m[e]=m[e]||[],m[e].push(t)},t.removeHook=function(e){m[e]&&m[e].pop()},t.removeHooks=function(e){m[e]&&(m[e]=[])},t.removeAllHooks=function(){m=[]},t}),define("dompurify",["dompurify/src/purify"],function(e){return e}),define("utils/chat/messageSanitizer",["require","cafe/applicationInstance","services/serviceLocator","constants/common","utils/common/regex","utils/common/encoder","dompurify","lodash-compat"],function(e){function F(e,t,n){return new RegExp("((?:&lt;"+e+' raw_pre="'+t+'"'+(n?"":' raw_post="'+t+'"')+"&gt;)+)([\\s\\S]*?)((?:&lt;/"+e+"&gt;)+)","gi")}function I(e,t,n){var r='<{0} raw_pre="{1}" raw_post="{1}">{2}</{0}>';return r.split("{0}").join(e).split("{1}").join(t).split("{2}").join(n)}function q(){var e="^(https?://)?",t="(([0-9a-z_!~*'()\\.&=+$%-]+:)?[0-9a-z_!~*'()\\.&=+$%-]+@)?",n="(\\d{1,2}|1\\d{2}|2[0-4]\\d|25[0-5])",r="("+n+"\\.){3}"+n,i="([0-9a-z][0-9a-z_-]*)?[0-9a-z]",s="("+i+"\\.)+(com|org|net|edu|gov|mil|aero|arpa|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|pro|tel|travel|[a-z]{2})",o="(:\\d{1,5})?",u="([#/].*)?$",a=[e+t+s+o+u,e+t+r+o+u,e+t+i+o+u];return a.map(function(e){return new RegExp(e,"i")})}function R(e){return B[e]}function U(e){return e.replace(/([<>])/gi,R)}function z(e){return e.replace(/(&lt;|&gt;)/gi,R)}function W(e){return e.replace(/([<>&"'])/gi,R)}function X(e){return e.replace(/&(lt|gt|amp|quot|apos);/gi,R)}function V(e,t){return e.replace(t,z)}function $(e){function f(e,t){return s[i]=t,e.replace(t,"DUMMY"+i++)}function c(e,n){t=t.replace("DUMMY"+n,e)}var t,n,r,i=0,s=[],o,u=new RegExp(l,"gi"),a=new RegExp(l,"i");r=u.exec(e);if(!r)return e;n=e;while(r)o=r[0].match(a).splice(1),t=o.reduce(f,r[0]),t=z(t),s.forEach(c),n=n.replace(r[0],t),r=u.exec(e);return n}function J(e){var t=e.match(E).slice(1);return t.reduce(V,e)}function K(e,t){var n=/(<a|&lt;a)/;return e.search(i.escapeSpecialChars(t))>-1?e:e.replace(n,function(e){return e+" "+t})}function Q(e,t,n,r,i){var s,o;return s=z(t),o=z(i),n.indexOf(j)!==0&&(s=K(s,'target="_blank"')),s=K(s,'tabindex="-1"'),s=K(s,'title="'+n+'"'),s+r+o}function G(e,t){var n,r="&lt;",i=/(\+?[\s\d\-]*\d)&lt;/i;return n=t.match(i)[0],n.slice(0,n.length-r.length)}function Y(e){return W(e.replace(f,Q))}function Z(e){return X(e.replace(f,Q))}function et(e){return e.replace(/<a(:?>|\s.*?>)/g,"").replace(/<\/a>/g,"")}function tt(e){function t(e,t){return e.replace(k[t],"")}return Object.keys(k).reduce(t,e)}function nt(e){function t(e,t,n,r,i){var s=H[e]||H.default;return e==="rawFontColor"&&(n=n.replace(/font(\s+)color/i,"font color")),z(n.substr(0,s.opening))+r+z(i.substr(0,s.closing))}function n(e,n){return e.replace(D[n],t.bind(null,n))}return Object.keys(D).reduce(n,e)}function rt(e,t){function o(){return t&&Object.keys(t).length>0&&!f(e)&&e.length>1}function a(e){return t[e]!==undefined}function f(e){return!e||!/\S/.test(e)}function l(e,t){var n;for(var r=0;r<e.length;r++){n=e[r];if(t!==undefined&&t.length>0&&t.indexOf(n)!==-1)continue;return n===" "}return!0}function c(e){return e.split("").reverse().join("")}function h(e,t,n){var r=[",",".",";",":","?","!","(",")"];return a(t)?l(c(e),r)||l(n,r):!1}function p(e,t,n,r){var i=[",",".",";",":","?","!","(",")"];return n!==e||u.first(r)===e?!1:l(c(t),i)||l(r,i)}function d(e,t,n){for(var r=t;r<=e.length;r++)if(n(e.substring(0,r),e[r],e.substring(r+1,e.length)))return r;return-1}function v(e,t,n){var r=t,i,s;do{r+=1,i=d(e,r,p.bind(null,n));if(i===-1)return-1;s=e.substring(t+1,i)}while(f(s));return i}var n=0,r,i,s;if(!o())return[];do{if(n>=e.length-1)return[];r=d(e,n,h);if(r===-1)return[];s=e.charAt(r),i=v(e,r,s),t=u.omit(t,s),n+=1}while(i===-1);return[r,i]}function it(e,t){var n=rt(t,e),r=n[0],i=n[1],s,o,a,f,l,c,h;return r===undefined||i===undefined||r<0||i<0?t:(s=t.charAt(r),o=e[s],h=t.substring(0,r),a=t.substring(r+1,i),l=t.substring(i+1),f=it(u.omit(e,s),a),f=o(f),c=it(e,l),h+f+c)}function st(e){var t=e.split(/\r?\n/),n;return n=u.map(t,function(e){return it(P,e)}),n.join("\r\n")}function ot(e,t){function r(e){function n(e){return e.test(t)}var t=e.replace(/[\u0080-\u9999]/g,"z");return A.some(n)}function i(e){return e.replace(/(["\''])/gi,R)}function s(e,s){return r(s)?(s=i(s),n=/^w{3}\./i.test(s)?"http://"+s:s,"<a"+(t?"":' tabindex="-1" target="_blank"')+' href="'+n+'">'+s+"</a>"):s}function o(e,t){return r(t)?'<a href="mailto:'+t+'">'+t+"</a>":t}var n;return e.replace(L,s).replace(c,o)}function ut(e,t,n){var r=U(e.replace(/&/g,"&amp;")),i=r.match(t),s;return i?i.forEach(function(e,t){var o=r.indexOf(e),u=o+e.length,a=i[t+1],f;t===0&&(s=n(r.substring(0,o))),s+=r.substring(o,u),r=r.substring(u),f=a?r.indexOf(a):undefined,s+=n(r.substring(0,f))}):s=n(r),z(s.replace(/&amp;/g,"&"))}function at(e){return o.sanitize(e,{ALLOWED_TAGS:[]})}function ft(e){var t=n.resolve(r.serviceLocator.FEATURE_FLAGS),i=t.isFeatureOn(r.featureFlags.INCOMING_WIKI_MARKUP),s=U(e);return s=s.replace(w,J),s=s.replace(S,z),s=$(s),s=s.replace(f,Q),s=s.replace(h,G),i?nt(s):s}function lt(e){return U(e).replace(/&lt;ss type="[^"]*"&gt;/gi,z).replace(/&lt;\/ss&gt;/gi,z).replace(x,z)}function ct(e,t,n){var r=e.match(t),i=[],s=e.split(t),o;if(!r)return e;u.each(r,function(e){i.push(n(e))}),o=s[0];for(var a=0;a<i.length;a++)o+=i[a],o+=s[a+1];return o}function ht(e,t){function i(e){return n+e+r}var n='<span class="notranslate">',r="</span>";return ct(e,t,i)}function pt(e,t){function s(e){var t=e.replace(n,""),i=t.substring(0,t.lastIndexOf(r));return i}var n='<span class="notranslate">',r="</span>",i=new RegExp(n+t.source+"</span>","gi");return ct(e,i,s)}function dt(e){var t;return e&&(t=pt(e,b),t=pt(t,T),t=pt(t,N),t=pt(t,C),t=pt(t,y),t=pt(t,g)),t}function vt(e){var t=/(\r?\n)|(&lt;br\s?\/&gt;)/gm,n="<br/>";return e.replace(t,n)}function mt(e){var t=new RegExp(O,"gi"),n=new RegExp(O,"i"),r,i,s=e;r=t.exec(e);while(r)i=n.exec(r[0]),i&&(s=s.replace(i[0],"@"+i[1])),r=t.exec(e);return s}function gt(e){var t=new RegExp(_,"gi"),n=new RegExp(_,"i"),r,i,s=e;r=t.exec(e);while(r)i=n.exec(r[0]),i&&(s=s.replace(i[0],i[2])),r=t.exec(e);return s}function yt(e){var t=new RegExp(M,"gi"),n=new RegExp(M,"i"),r,i,s=e;r=t.exec(e);while(r)i=n.exec(r[0]),i&&i.length===4&&(s=s.replace(i[0],i[1]+i[3]+i[2])),r=t.exec(e);return s}function bt(e){var n=s.build(t).decode(e),r=tt(n),i=ft(r);return vt(i)}function wt(e){var t=mt(e);return t=yt(t),t=gt(t),t}function Et(e){return e=e.trim(),e=e.replace(/&/g,"&amp;"),e=s.build(t).encode(e),e=lt(e),e=ot(e,!0),e=e.replace(/&amp;amp;/gi,"&amp;"),e=st(e),e}function St(e){var t=Et(e);return t=ht(t,T),t=ht(t,N),t=ht(t,g),t}function xt(e){var t;return t=ht(e,b),t=ht(t,C),t=ht(t,y),t=ht(t,g),t}function Tt(e,t){var n=u.isArray(t)?t:[t];return u.each(n,function(t){e=e.replace(t,"")}),e=e.trim(),!e}function Nt(e){var t=/<at id="(.*?)">.*?<\/at>/g,n=/<i class="(.*?)"><span title="(.*?)">.*?<\/span><\/i>/g;return Tt(e,[t,n])}function Ct(e){return Tt(e,[T,N,b,C])}var t=e("cafe/applicationInstance"),n=e("services/serviceLocator"),r=e("constants/common"),i=e("utils/common/regex"),s=e("utils/common/encoder"),o=e("dompurify"),u=e("lodash-compat"),a='(?:(?:\\s*title=".*?"\\s*)|(?:\\s*tabindex="-1"\\s*)|(?:\\s*target="_blank"\\s*)){0,3}',f=i.multilineRegExp(["(&lt;a ",a,'href="((?:https?://|mailto:)[^"]+?)"',a,"&gt;)","((?:(?!&lt;/a&gt;)[\\s\\S])*)","(&lt;/a&gt;)"],"gi"),l='&lt;i class="'+r.mentions.class+'"&gt;&lt;span title="(.*?)"&gt;(.*?)&lt;/span&gt;&lt;/i&gt;',c=/((([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,}))/gi,h=/(&lt;a href="skype:\+\d+"&gt;(\+?[\s\d\-]*\d)&lt;\/a&gt;)/gi,p=["(",'&lt;span class="emoticon [a-z0-9]+\\s?(?:animated)?\\s?\\s?(?:large|extraLarge)?\\s?"&gt;','&lt;span class="emoSprite"&gt;',")","(?:.+?)","(&lt;/span&gt;&lt;/span&gt;)"],d=['<span class="emoticon [a-z0-9]+\\s?(?:animated)?\\s?\\s?(?:large|extraLarge)?\\s?">','<span class="emoSprite">',"(?:.+?)","</span></span>"],v=['<i class="'+r.mentions.class+'">','<span title="(?:.+?)">',"(?:.+?)","</span></i>"],m=['<a (?:(?:\\s*title=".*?"\\s*)|(?:s*tabindex="-1"\\s*)|(?:\\s*target="_blank"\\s*)){0,3}href="(?:https?://|mailto:)[^"]+?"','(?:(?:\\s*title=".*?"\\s*)|(?:\\s*tabindex="-1"\\s*)|(?:\\s*target="_blank"\\s*)){0,3}>',"(?:(?!</a>)[\\s\\S])*</a>"],g=i.multilineRegExp(m,"gi"),y=i.multilineRegExp(v,"gi"),b=i.multilineRegExp(d,"gi"),w=i.multilineRegExp(p,"gi"),E=i.multilineRegExp(p,"i"),S=/&lt;span class="flag ([^"]{2})"&gt;[\s]*\(flag:\1\)[\s]*&lt;\/span&gt;/gi,x=/&lt;flag country="([^"]{2})"&gt;[\s]*\(flag:\1\)[\s]*&lt;\/flag&gt;/gi,T=/<ss type="\w+">.*?<\/ss>/g,N=/<flag country="[\w+]{2}">(?:.+?)<\/flag>/gi,C=/<span class="flag [^"]{2}">(?:.+?)<\/span>/gi,k={text:/Edited previous message: /,edited:/<e_m [^<>]+>/g,quoted:/(<(?:\/?)(?:quote|legacyquote)[^>]*>)/gi},L=/\b((https?:\/\/|w{3}\.)\S+)/gi,A=q(),O='<i class="'+r.mentions.class+'"><span title="(.*?)">(.*?)</span></i>',M='<.? raw_pre="(.?)" raw_post="(.?)">(.*?)</.?>',_='<ss type="(.*?)">(.*?)</ss>',D={bold:F("b","\\*"),italic:F("i","_"),strike:F("s","~"),code:F("pre","{code}"),codeBlock:F("pre","!! ",!0),rawBold:new RegExp("(&lt;b&gt;)(.*?)(&lt;/b&gt;)","gi"),rawItalic:new RegExp("(&lt;i&gt;)(.*?)(&lt;/i&gt;)","gi"),rawFontColor:new RegExp('(&lt;font\\s+color="#[a-f0-9]{6}"&gt;)(.*?)(&lt;/font&gt;)',"gi")},P={"*":function(e){return I("b","*",e)},_:function(e){return I("i","_",e)},"~":function(e){return I("s","~",e)}},H={code:{opening:46,closing:12},codeBlock:{opening:25,closing:12},rawBold:{opening:9,closing:10},rawItalic:{opening:9,closing:10},rawFontColor:{opening:28,closing:13},"default":{opening:34,closing:10}},B={"<":"&lt;",">":"&gt;","&lt;":"<","&gt;":">","&LT;":"<","&GT;":">","&":"&amp;",'"':"&quot;","'":"&apos;","&amp;":"&","&quot;":'"',"&apos;":"'","&AMP;":"&","&QUOT;":'"',"&APOS;":"'"},j="mailto:";return{validateUnescapedLink:function(e){return U(e).replace(f,Q)},encodeEmoticonsTextRepresentation:function(e){function n(e){var n=s.build(t);return n.decode(n.encode(e))}return ut(e,w,n)},encodeEmoticonsRawRepresentation:function(e){var n=s.build(t);return n.decode(n.encode(e,!1))},encodeLinkTextRepresentation:function(e){return ut(e,f,ot)},unboxHrefContent:function(e){function i(e,t){var r=t.match(n)[1]||"",i=r.replace("&amp;","&");return e.replace(t,i)}var t=/(<a.*?<\/a>)/gi,n=/href="(.*?)"/i,r=e.match(t)||[];return r.reduce(i,e)},processOutgoingTextMessage:Et,escapeIncomingHTML:ft,escapeOutgoingHTML:lt,escapeHTML:Y,unescapeHTML:Z,removeAnchorTags:et,removeMetaData:tt,webify:vt,unwebify:function(e){var t="\r\n",n=/<br\/?>/g;return e.replace(n,t)},getSanitizedTopic:function(e){return Z(et(e))},getMessageSanitizedContent:bt,getEmoticonNamesFromMessage:function(e){var t=[],n=/(?:<ss type=")(\w+)">/g,r;while(r=n.exec(e)){var i=r[1];t.push(i)}return t},stripHTML:at,encode:function(e){return s.build(t).encode(e)},handleWikiMarkup:nt,compactHtml:wt,isMessageWithMentionOnly:Nt,removeNoTranslateTags:dt,processOutgoingTextMessageForTranslation:St,isMessageWithEmoticonsOnly:Ct,processIncomingSanitizedTextMessageForTranslation:xt}}),define("jSkype/utils/chat/parser",["require","utils/chat/messageSanitizer"],function(e){var t=e("utils/chat/messageSanitizer"),n=/\/((?:\d+:|live:)[^\/]+)/;return{parseName:function(e){if(typeof e!="string")throw new TypeError("Expected a string, got: "+typeof e);var t=e.match(n);return t?t[1]:e},parseTopic:function(e){var n=e.replace(/<[^a\/].*?>(.*?)<\/[^a].*?>/gi,"$1"),r=n.replace(/(<.*?\.{3,})$/,"").trim(),i=r===""?"":t.validateUnescapedLink(r);return i},getConversationIdFromUrl:function(e){var t=new RegExp(/\/(\d+:[^?]*)/),n=e&&e.match(t);return n&&n[1]?n[1]:undefined}}}),define("jSkype/utils/chat/message",["require","exports","module","jSkype/modelHelpers/personHelper","jSkype/client","jSkype/utils/chat/parser","swx-enums"],function(e,t){function a(){return o?n.getId(o):r.get().personsAndGroupsManager.mePerson.id()}function f(e){var r=t.getTargets(e),i=r?r.map(function(e){return n.getId(e)}):null;return i}function l(e){var r=e.content?t.getInitiator(e.content):null,i=e.content?f(e.content):null,s=a();return i?e.messagetype==="ThreadActivity/AddMember"&&n.getId(r)!==s&&i.indexOf(s)>-1:!1}function c(e){var r=e.content?t.getInitiator(e.content):null,i=a();return e.messagetype==="ThreadActivity/TopicUpdate"&&n.getId(r)!==i}var n=e("jSkype/modelHelpers/personHelper"),r=e("jSkype/client"),i=e("jSkype/utils/chat/parser"),s=e("swx-enums"),o,u=["ThreadActivity/TopicUpdate","ThreadActivity/AddMember"];t.getInitiator=function(e){var t=/<initiator>(\d+:.+)<\/initiator>/,n=e.match(t);if(n)return n[1]},t.getTargets=function(e){var t=/<target>(.+)<\/target>/,n=e.match(t);if(n)return n[1].split("</target><target>")},t.isMessageReadOnServer=function(e,t,n){if(!e)return!0;var r=Math.floor(n/1e3)*1e3,i=e.lastReadMessageId===t,s=e.lastReadMessageTimestamp>=r;return i||s},t.isMessageOutgoing=function(e){if(typeof e.isOutgoing!="undefined")return e.isOutgoing;var t=i.parseName(e.from),s=r.get().personsAndGroupsManager.mePerson;return o=o||n.getKey(s.id(),s._type()),t===o},t.doesMessageTypeSupportUnreadState=function(e){return e.messagetype&&u.indexOf(e.messagetype)>-1?l(e)||c(e):!(e.messagetype&&e.messagetype.indexOf("ThreadActivity/")>-1||e.contactRequestType&&e.contactRequestType===s.activityType.ContactRequestIsNowContact)},t.canMessageBeMarkedAsUnreadInUI=function(e){return!t.isMessageOutgoing(e)&&t.doesMessageTypeSupportUnreadState(e)}}),define("jSkype/utils/chat/conversation",["require","exports","module","lodash-compat","jSkype/modelHelpers/personHelper","jSkype/client","jSkype/utils/chat/message","constants/people"],function(e,t){var n=e("lodash-compat"),r=e("jSkype/modelHelpers/personHelper"),i=e("jSkype/client"),s=e("jSkype/utils/chat/message"),o=e("constants/people"),u="@p2p.thread.skype",a=/syncState=([^&]+)/;t.isConversationReadOnServer=function(e){var t=this.parseConsumptionHorizon(e.properties.consumptionhorizon),n=this.getMessageKey(e.lastMessage);return s.isMessageReadOnServer(t,n,e.lastMessage.id)},t.parseConsumptionHorizon=function(e){if(!n.isString(e))return{};var t=e.split(";");return{lastReadMessageTimestamp:t[0],modificationTime:t[1],lastReadMessageId:t[2]}},t.getMessageKey=function(e){return e.clientmessageid||e.skypeeditedid||e.messageid||e.id||0},t.isPartiallyMigrated=function(e,t){var n=e.indexOf(u)!==-1,r=t&&t.migrationcompleted&&t.migrationcompleted==="true";return n&&!r},t.isAgentConversation=function(e){return r.getTypeFromKey(e)===o.contactTypes.AGENT},t.isMeConversation=function(e){var t=i.get().personsAndGroupsManager.mePerson;return e===r.getKey(t.id(),t._type())},t.isPstnConversation=function(e){return/^\d:\+/.test(e)},t.isPstnEndpoint=function(e){return/^(\+)?\d+$/.test(e)},t.isPstnOnlyConversation=function(e){var n=e.participants.subscribe();if(!e.participants.size())return n.dispose(),!1;for(var r=0,i=e.participants.size();r<i;r++){var s=e.participants(r);if(!s.audio.endpoint||!t.isPstnEndpoint(s.audio.endpoint()))return n.dispose(),!1}return n.dispose(),!0},t.getSyncStateFromResponse=function(e){var t=e._metadata&&e._metadata.syncState,n=null;return t&&a.test(t)&&(n=t.match(a)[1]),n}}),define("jSkype/services/webapi/actions/handlers",["require","exports","module","jSkype/services/webapi/utils/conversationMetadataStore","jSkype/utils/chat/conversation"],function(e,t){var n=e("jSkype/services/webapi/utils/conversationMetadataStore"),r=e("jSkype/utils/chat/conversation");t.buildMessageSuccess=function(e,t){return function(i){var s=i.response,o=r.getSyncStateFromResponse(s),u=!!s._metadata.backwardLink;n.set(e,o),t(s.messages||[],u)}}}),define("jSkype/services/webapi/utils/lockAndKey",[],function(){"use strict";function n(){var e=window.chatServerTime||(new Date).getTime();return Math.round(e/1e3)}function r(n,r){return n.getMacHash(r,e,t)}function i(t,n){return"appId="+e+"; time="+t+"; lockAndKeyResponse="+n}var e="msmsgs@msnmsgr.com",t="Q1P7W2E4J9R8U3S5";return function(t){this.generate=function(){var e=n(),s=r(t,e);return i(e,s)}}}),define("jSkype/services/webapi/instance",["require","jSkype/services/webapi/boundary/facade","jSkype/services/webapi/boundary/dispatcher","jSkype/services/webapi/calls/service","jSkype/services/webapi/builders/headerSelector","jSkype/services/webapi/builders/requestURIBuilder","jSkype/services/webapi/builders/requestOptionsBuilder","jSkype/services/webapi/actions/handlers","jSkype/services/webapi/utils/lockAndKey","msr-crypto"],function(e){var t=e("jSkype/services/webapi/boundary/facade"),n=e("jSkype/services/webapi/boundary/dispatcher"),r=e("jSkype/services/webapi/calls/service"),i=e("jSkype/services/webapi/builders/headerSelector"),s=e("jSkype/services/webapi/builders/requestURIBuilder"),o=e("jSkype/services/webapi/builders/requestOptionsBuilder"),u=e("jSkype/services/webapi/actions/handlers"),a=e("jSkype/services/webapi/utils/lockAndKey"),f=e("msr-crypto").sha256Auth;return function(l){function v(e){return new n(e)}var c=new f,h=new a(c),p=new o(i),d=new r(s,p,l);return i.setLockAndKey(h.generate()),new t(v,u,d)}}),define("jSkype/services/webapi/main",["require","jSkype/services/webapi/instance"],function(e){var t=e("jSkype/services/webapi/instance"),n;return{getInstance:function(e){return n||(n=new t(e)),n}}}),define("jSkype/services/entitlement/facade",["require","jSkype/services/entitlement/serviceSettings"],function(e){function n(e,n){this.getEntitlementServiceData=function(r,i){var s=t.getEntitlementServiceEndpoint(r,i);return n.build().then(function(t){return e.get(s,t)})},this.getEntitlementListingData=function(r){var i=t.getEntitlementListingEndpoint(r);return n.build().then(function(t){return e.get(i,t)})}}var t=e("jSkype/services/entitlement/serviceSettings");return n}),define("jSkype/services/entitlement/main",["require","exports","module","jSkype/services/entitlement/facade"],function(e,t){var n=e("jSkype/services/entitlement/facade"),r;t.getInstance=function(t,i){return r||(r=new n(t,i)),r}}),define("jSkype/services/stratus/optionsBuilder",["require","lodash-compat","swx-utils-common","jSkype/client","jcafe-property-model","jSkype/services/clientInfo","jSkype/constants/common","jSkype/services/stratus/serviceSettings","jSkype/services/serviceAccessLayer/transientFaultPolicy"],function(e){function c(){this._dynamicOptions={},this._defaultOptions={headers:{Accept:o.JSON_V1_0,"X-Stratus-Caller":s.getBIAppName()},retry:t.merge({isTransientCheck:a.isTransientFailure},u.getRetryPolicy())},this._defaultOptions.headers[f]="",this._defaultOptions.headers[l]=""}function h(e,r){var i;return function(s){var o={makeDefault:!0};this.setHeader(f,s,o),this.setHeader(l,n.create().substring(0,8),o),i=t.merge({},this._defaultOptions,r),e.resolve(i)}.bind(this)}var t=e("lodash-compat"),n=e("swx-utils-common").guid,r=e("jSkype/client"),i=e("jcafe-property-model"),s=e("jSkype/services/clientInfo"),o=e("jSkype/constants/common").contentTypes,u=e("jSkype/services/stratus/serviceSettings"),a=e("jSkype/services/serviceAccessLayer/transientFaultPolicy"),f="X-Skypetoken",l="X-Stratus-Request";return c.prototype.setOption=function(e,t){this._dynamicOptions[e]=t},c.prototype.setHeader=function(e,t,n){n&&n.makeDefault?this._defaultOptions.headers[e]=t:(this._dynamicOptions.headers=this._dynamicOptions.headers||{},this._dynamicOptions.headers[e]=t)},c.prototype.removeHeader=function(e){this._dynamicOptions.headers&&delete this._dynamicOptions.headers[e]},c.prototype.setServiceName=function(e){this._dynamicOptions.reporting={serviceName:e}},c.prototype.build=function(){var e=i.task();return r.get().signInManager._skypeToken().then(h.call(this,e,this._dynamicOptions)),this._dynamicOptions={},e.promise},c}),define("jSkype/services/contacts/optionsBuilder",["require","lodash-compat","jSkype/services/stratus/optionsBuilder","jSkype/services/contacts/serviceSettings","jSkype/services/clientInfo"],function(e){function s(){n.call(this),t.merge(this._defaultOptions.retry,r.getRetryPolicy()),t.merge(this._defaultOptions.headers,{"X-Skype-Caller":i.getBIAppName()}),this._defaultOptions.headers["X-Stratus-Caller"]=undefined}var t=e("lodash-compat"),n=e("jSkype/services/stratus/optionsBuilder"),r=e("jSkype/services/contacts/serviceSettings"),i=e("jSkype/services/clientInfo");return t.assign(s.prototype,n.prototype,{constructor:s}),s}),define("jSkype/services/entitlement/entitlementOptionsBuilder",["require","lodash-compat","jSkype/client","jSkype/constants/common","jSkype/services/entitlement/serviceSettings","jSkype/services/serviceAccessLayer/transientFaultPolicy","jSkype/services/stratus/optionsBuilder","jSkype/services/entitlement/serviceSettings"],function(e){function a(){this._options={headers:{Accept:r.JSON_V3_0,"X-Skypetoken":""},retry:t.merge({},{isTransientCheck:s.isTransientFailure},i.getRetryPolicy()),serviceName:u.actions.getEntitlementService,addContentType:!1}}var t=e("lodash-compat"),n=e("jSkype/client"),r=e("jSkype/constants/common").contentTypes,i=e("jSkype/services/entitlement/serviceSettings"),s=e("jSkype/services/serviceAccessLayer/transientFaultPolicy"),o=e("jSkype/services/stratus/optionsBuilder"),u=e("jSkype/services/entitlement/serviceSettings");return t.assign(a.prototype,o.prototype,{constructor:a,setHeader:function(e,t){this._options.headers[e]=t},build:function(){var e=this;return n.get().signInManager._skypeToken().then(function(t){return e.setHeader("X-Skypetoken",t),e._options})}}),a}),define("jSkype/services/serviceFactory",["require","exports","module","jSkype/client","jSkype/settings","jSkype/services/stratus/serviceSettings","jSkype/services/contacts/serviceSettings","jSkype/services/webapi/serviceSettings","jSkype/services/entitlement/serviceSettings","jSkype/services/serviceAccessLayer/serviceLocator","jSkype/services/contacts/main","jSkype/services/stratus/main","jSkype/services/people/main","jSkype/services/ABCHProfile/main","jSkype/services/webapi/main","jSkype/services/entitlement/main","jSkype/services/stratus/optionsBuilder","jSkype/services/contacts/optionsBuilder","jSkype/services/entitlement/entitlementOptionsBuilder"],function(e,t){var n=e("jSkype/client"),r=e("jSkype/settings"),i=e("jSkype/services/stratus/serviceSettings"),s=e("jSkype/services/contacts/serviceSettings"),o=e("jSkype/services/webapi/serviceSettings"),u=e("jSkype/services/entitlement/serviceSettings"),a=e("jSkype/services/serviceAccessLayer/serviceLocator"),f=e("jSkype/services/contacts/main"),l=e("jSkype/services/stratus/main"),c=e("jSkype/services/people/main"),h=e("jSkype/services/ABCHProfile/main"),p=e("jSkype/services/webapi/main"),d=e("jSkype/services/entitlement/main"),v=e("jSkype/services/stratus/optionsBuilder"),m=e("jSkype/services/contacts/optionsBuilder"),g=e("jSkype/services/entitlement/entitlementOptionsBuilder");t.getStratusService=function(){var e=a.build(i.getHost());return l.getInstance(e,new v)},t.getContactsService=function(){var e=n.get().personsAndGroupsManager.mePerson.id(),t=a.build(s.getHost());return f.getInstance(e,t,new m)},t.getPresenceService=function(){var e=a.build(o.getHost());return p.getInstance(e)},t.getEntitlementService=function(){var e=a.build(u.getHost());return d.getInstance(e,new g)},t.getPeopleService=function(){var e=a.build(r.settings.peopleService.host);return c.getInstance(e,new v)},t.getABCHProfileService=function(){var e=a.build(r.settings.profileService.host);return h.getInstance(e,new v)}}),define("jSkype/modelHelpers/contacts/contactActivityItemHelper",["require","exports","module","lodash-compat","swx-enums"],function(e,t){function s(e){return e.type()===r.activityType.ContactRequestIncoming}function o(e){return e.type()===r.activityType.ContactRequestIncomingInviteFree}function u(e){return i.indexOf(e.type())!==-1}function a(e){return e.type()===r.activityType.UnblockContact}var n=e("lodash-compat"),r=e("swx-enums"),i=[r.activityType.ContactRequestOutgoingResend,r.activityType.ContactRequestOutgoing,r.activityType.ContactRequestOutgoingAgent,r.activityType.ContactRequestIncoming,r.activityType.ContactRequestIsNowContact,r.activityType.SuggestedContact];t.filterContactRequestActivityItems=function(e){return e.filter(u)},t.filterUnblockContactActivityItems=function(e){return e.filter(a)},t.clearContactRequestActivityItems=function(e,n){var r=e.historyService,i=t.filterContactRequestActivityItems(r.activityItems()),s=!1;return i.forEach(function(e){e.type()!==n?r._removeMessage(e):s=!0}),s},t.clearUnblockContactActivityItems=function(e){var n=e.historyService,r=t.filterUnblockContactActivityItems(n.activityItems());r.forEach(function(e){n._removeMessage(e)})},t.getContactRequestIncomingActivityItem=function(e){var t=e.historyService.activityItems();return n.find(t,s)},t.getContactRequestIncomingInviteFreeActivityItem=function(e){var t=e.historyService.activityItems();return n.find(t,o)}}),define("jSkype/modelHelpers/contacts/contactMessageFactory",["require","exports","module","swx-enums","jSkype/constants/people","jSkype/modelHelpers/contacts/contactActivityItemHelper","jSkype/modelHelpers/personHelper"],function(e,t){function o(e,t,n,r,i){return r=r||+(new Date),{id:+r,personId:e.id(),timestamp:r,contactRequestType:n,greeting:i,isOutgoing:t}}var n=e("swx-enums").activityType,r=e("jSkype/constants/people").authorizationStates,i=e("jSkype/modelHelpers/contacts/contactActivityItemHelper"),s=e("jSkype/modelHelpers/personHelper");t.getOutgoing=function(e,t){return e.isAgent()?o(e,!0,n.ContactRequestOutgoingAgent,t):o(e,!0,n.ContactRequestOutgoing,t)},t.getOutgoingResend=function(e,t){return o(e,!0,n.ContactRequestOutgoingResend,t)},t.getIncoming=function(e,t,r){return o(e,!1,n.ContactRequestIncoming,t,r)},t.getIncomingInviteFree=function(e,t){return o(e,!1,n.ContactRequestIncomingInviteFree,t-1)},t.getIsNowContact=function(e){return o(e,!1,n.ContactRequestIsNowContact)},t.getSuggested=function(e,t){return o(e,!0,n.SuggestedContact,t)},t.getUnblockContact=function(e){return o(e,!0,n.UnblockContact)},t.getActivityItemForInitialConversationLoad=function(e,n){function a(){switch(e._authorization()){case r.PENDING_OUTGOING:return t.getOutgoingResend(e);case r.SUGGESTED:return t.getSuggested(e);case r.UNAUTHORIZED:return t.getOutgoing(e);default:return}}var o=i.filterContactRequestActivityItems(n.historyService.activityItems()),u=i.filterUnblockContactActivityItems(n.historyService.activityItems());if(!o.length&&s.canRequestContactAuthorization(e))return a();if(!u.length&&e.isBlocked())return t.getUnblockContact(e)}}),define("jSkype/modelHelpers/contacts/authorizationChange",["require","exports","module","jSkype/client","jSkype/services/serviceFactory","swx-enums","jSkype/constants/people","jSkype/modelHelpers/personHelper","jSkype/modelHelpers/contacts/contactActivityItemHelper","jSkype/modelHelpers/contacts/contactMessageFactory","jSkype/settings","constants/common","jSkype/modelHelpers/personsAndGroupsHelper"],function(e,t){function h(e,t){return e===undefined?t:e}function p(){var e={};return e[s.AUTHORIZED]=function(e,t,n){var r;if(t===s.AUTHORIZED)return;e._authorization._set(s.AUTHORIZED),r=c.getDefaultPresence(e,s.AUTHORIZED),r&&e.status._set(r);switch(t){case s.PENDING_OUTGOING:case s.PENDING_INCOMING:case s.SUGGESTED:case s.UNAUTHORIZED:n&&(u.clearContactRequestActivityItems(n),m(e,n)),y(e)}},e[s.UNAUTHORIZED]=function(e,t,r){var i;if(t===s.UNAUTHORIZED)return;e._authorization._set(s.UNAUTHORIZED),e.status._set(undefined);switch(t){case s.PENDING_INCOMING:r&&(u.clearContactRequestActivityItems(r),n.get().conversationsManager.conversations.remove(r));break;case s.UNKNOWN:case s.PENDING_OUTGOING:case s.SUGGESTED:r&&o.canRequestContactAuthorization(e)&&(i=a.getOutgoing(e),u.clearContactRequestActivityItems(r),r.historyService._processRawMessage(i));break;case s.AUTHORIZED:r&&o.canRequestContactAuthorization(e)&&(i=a.getOutgoing(e),u.clearContactRequestActivityItems(r),r.historyService._processRawMessage(i)),g(e)}},e[s.PENDING_OUTGOING]=function(e,t,n){var r;if(t===s.PENDING_OUTGOING)return;e._authorization._set(s.PENDING_OUTGOING),e.status._set(i.onlineStatus.Unknown);switch(t){case s.UNKNOWN:case s.UNAUTHORIZED:case s.SUGGESTED:n&&(u.clearContactRequestActivityItems(n),r=a.getOutgoingResend(e),n.historyService._processRawMessage(r))}},e[s.SUGGESTED]=function(e,t,n){if(t===s.SUGGESTED)return;e._authorization._set(s.SUGGESTED),n&&(t===s.UNAUTHORIZED||t===s.UNKNOWN)&&(u.clearContactRequestActivityItems(n),n.historyService._processRawMessage(a.getSuggested(e)))},e}function d(e,t){var r=o.getKey(e.id(),e._type());n.get().conversationsManager._conversationBlockedUpdate(r,t)}function v(e){var t=o.getKey(e.id(),e._type());return n.get().conversationsManager._getConversation(t)}function m(e,t){f.isFeatureOn(l.featureFlags.INVITE_FREE_IMPLICIT_INCOMING_CONTACT_REQUEST)||t.historyService._processRawMessage(a.getIsNowContact(e))}function g(e){if(w(e)){var t=r.getPresenceService();t.removeContactFromContactsList(e.id())}}function y(e){if(b(e)){var t=r.getPresenceService();t.addContactToContactsList(e.id())}}function b(e){return!f.isFeatureOn(l.featureFlags.DO_NOT_SEND_CONTACTS_TO_CHAT_SERVICE)&&o.canAddToChatServiceContactList(e)}function w(e){return!f.isFeatureOn(l.featureFlags.DO_NOT_SEND_CONTACTS_TO_CHAT_SERVICE)&&o.canRemoveContactFromChatServiceContactList(e)}function E(e,t,n){t.persons(e.id())||t.persons.add(e,e.id(),undefined,n)}var n=e("jSkype/client"),r=e("jSkype/services/serviceFactory"),i=e("swx-enums"),s=e("jSkype/constants/people").authorizationStates,o=e("jSkype/modelHelpers/personHelper"),u=e("jSkype/modelHelpers/contacts/contactActivityItemHelper"),a=e("jSkype/modelHelpers/contacts/contactMessageFactory"),f=e("jSkype/settings"),l=e("constants/common"),c=e("jSkype/modelHelpers/personsAndGroupsHelper");t.setAuthorization=function(e,n,r){var i=p()[n];return i&&i(e,e._authorization(),v(e)),h(r,!0)&&t.updateGroups(e),e},t.updateGroups=function(e){var t=n.get().personsAndGroupsManager.all,r=t.groups().filter(function(e){return e.relationshipLevel()===i.groupPrivacyRelationshipLevel.Blocked})[0];switch(e._authorization()){case s.AUTHORIZED:case s.PENDING_OUTGOING:case s.SUGGESTED:E(e,t,!0);break;case s.UNAUTHORIZED:t.persons.remove(e.id(),!0)}e.isBlocked()?E(e,r,!1):r.persons.remove(e)},t.setBlocked=function(e,r){var i,o;if(e.isBlocked())return;r=h(r,!0),e.isBlocked._set(!0),i=v(e),d(e,!0);switch(e._authorization()){case s.PENDING_INCOMING:t.sendDeclineRequest(e),i&&(u.clearContactRequestActivityItems(i),n.get().conversationsManager.conversations.remove(i));break;case s.UNAUTHORIZED:i&&(u.clearContactRequestActivityItems(i),n.get().conversationsManager.conversations.remove(i));break;case s.PENDING_OUTGOING:case s.SUGGESTED:i&&(o=a.getUnblockContact(e),u.clearContactRequestActivityItems(i),i.historyService._processRawMessage(o));break;case s.AUTHORIZED:i&&(o=a.getUnblockContact(e),u.clearUnblockContactActivityItems(i),i.historyService._processRawMessage(o)),g(e)}r&&t.updateGroups(e)},t.setUnblocked=function(e,n){var r,i,o;if(!e.isBlocked())return;n=h(n,!0),e.isBlocked._set(!1),r=v(e),d(e,!1);switch(e._authorization()){case s.AUTHORIZED:r&&u.clearUnblockContactActivityItems(r),y(e);break;case s.UNAUTHORIZED:r&&(i=a.getOutgoing(e),u.clearUnblockContactActivityItems(r),r.historyService._processRawMessage(i));break;case s.PENDING_OUTGOING:r&&(o=a.getOutgoingResend(e),u.clearUnblockContactActivityItems(r),r.historyService._processRawMessage(o));break;case s.SUGGESTED:r&&(o=a.getSuggested(e),u.clearUnblockContactActivityItems(r),r.historyService._processRawMessage(o))}n&&t.updateGroups(e)},t.sendDeclineRequest=function(e){var i=e.id(),o=r.getStratusService();return o.declineContactRequest(i).then(function(){var r=f.settings.telemetry.jSkypeTenantToken;t.setAuthorization(e,s.UNAUTHORIZED),n.get()._telemetryManager.sendEvent(r,l.telemetry.contacts.type.CONTACT_REQUESTS,{name:l.telemetry.contacts.name.CONTACT_REQUEST_DECLINED,user_from:[i,window.skypeTelemetryManager.PIIType.Identity]})})}}),define("jSkype/models/agentDetails",["require","jcafe-property-model"],function(e){function n(){this.author=t.property({readOnly:!0}),this.description=t.property({readOnly:!0}),this.certification=t.property({readOnly:!0}),this.rating=t.property({readOnly:!0}),this.website=t.property({readOnly:!0}),this.privacyStatement=t.property({readOnly:!0}),this.termsOfService=t.property({readOnly:!0}),this.extraInfo=t.property({readOnly:!0})}var t=e("jcafe-property-model");return n}),define("jSkype/models/person",["require","jcafe-property-model","jSkype/models/note","jSkype/models/location","jSkype/models/capabilities","jSkype/models/phoneNumber","swx-enums","jSkype/client","constants/common","jSkype/settings","jSkype/modelHelpers/contacts/dataMappers/dataMaps","jSkype/modelHelpers/contacts/authorizationChange","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/modelHelpers/personHelper","jSkype/services/serviceFactory","jSkype/models/agentDetails"],function(e){function m(e){function y(e,n){function p(){var t={},n=a.telemetry.contacts;e?(c.setBlocked(h.getPerson(r)),t.name=n.name.CONTACT_BLOCKED):(c.setUnblocked(h.getPerson(r)),t.name=n.name.CONTACT_UNBLOCKED),u.get()._telemetryManager.sendEvent(f.settings.telemetry.jSkypeTenantToken,n.type.CONTACTS,t),i.resolve(e)}function v(e){i.reject(e)}var r=m.id(),i=t.task(),s=l.contactTypesByCode[m._type()],o=d.getContactsService();return e?o.blockContact(r,s,n).then(p,v):o.unblockContact(r,s).then(p,v),i.promise}function b(e){return e!==undefined?new Date(e):undefined}function w(e){if(p.isPstnId(e)){var t=new s;t.type._set(o.phoneType.Other),t.telUri._set(e),t.displayString._set(e),m.phoneNumbers.add(t,e)}}function E(e){m.capabilities.chat._set(e),m.capabilities.audio._set(e),m.capabilities.video._set(e),m.capabilities.groupAdd._set(e)}var m=this,g=t.enabledCommand(y);this._type=t.property({readOnly:!0,value:l.contactTypes.skype}),this._authorization=t.property({readOnly:!0}),this.id=t.property({readOnly:!0,value:e}),this.isBlocked=t.property({set:g,value:!1}),this.isAgent=t.property({readOnly:!0,value:!1}),this.displayName=t.property({readOnly:!0,value:e}),this.firstName=t.property({readOnly:!0}),this.lastName=t.property({readOnly:!0}),this.title=t.property({readOnly:!0}),this.office=t.property({readOnly:!0}),this.department=t.property({readOnly:!0}),this.company=t.property({readOnly:!0}),this.avatarUrl=t.property({readOnly:!0,value:p.isGuestId(e)?undefined:p.getAvatarUri(e)}),this.emails=t.collection(),this.status=t.property({readOnly:!0}),this.activity=t.property({readOnly:!0}),this.endpointType=t.property({readOnly:!0,value:o.endpointType.Desktop}),this.lastSeenAt=t.property({set:b}),this.note=new n,this.location=new r,this.location.type._set(o.locationType.Unknown),this.capabilities=new i,E(!0),this.phoneNumbers=t.collection(),w(e),this.agentDetails=new v,this.subscribe=t.enabledCommand(function(){})}var t=e("jcafe-property-model"),n=e("jSkype/models/note"),r=e("jSkype/models/location"),i=e("jSkype/models/capabilities"),s=e("jSkype/models/phoneNumber"),o=e("swx-enums"),u=e("jSkype/client"),a=e("constants/common"),f=e("jSkype/settings"),l=e("jSkype/modelHelpers/contacts/dataMappers/dataMaps"),c=e("jSkype/modelHelpers/contacts/authorizationChange"),h=e("jSkype/modelHelpers/personsAndGroupsHelper"),p=e("jSkype/modelHelpers/personHelper"),d=e("jSkype/services/serviceFactory"),v=e("jSkype/models/agentDetails");return m}),define("jSkype/utils/batch",["require","jSkype/constants/people"],function(e){function n(e){function o(){e(n),n=[]}var n=[],r=t.MAX_ITEMS,i=t.MAX_DELAY,s=null;this.add=function(e){clearTimeout(s),n.push(e),n.length>=r?o():s=window.setTimeout(o,i)},this.clear=function(){clearTimeout(s),n=[]}}var t=e("jSkype/constants/people").batch;return{create:function(e){return e?new n(e):null}}}),define("utils/people/userDataProcessor",["require","exports","module","lodash-compat","cafe/applicationInstance","utils/common/encoder","utils/chat/messageSanitizer"],function(e,t){var n=e("lodash-compat"),r=e("cafe/applicationInstance"),i=e("utils/common/encoder"),s=e("utils/chat/messageSanitizer"),o=/(<flag country="\S+">\S+<\/flag>|<ss type="\S+">\S+<\/ss>)/gi;t.sanitize=function(e){if(n.isString(e)){var t=e,u=i.build(r);if(e.match(o)===null){var a=s.escapeIncomingHTML(e);t=u.encode(a,!1)}return s.escapeIncomingHTML(u.decode(t))}return""},t.sanitizeXml=function(e){return n.isString(e)?n.escape(e):""},t.stripAnchors=function(e){return n.isString(e)?s.removeAnchorTags(e):""}}),define("jSkype/modelHelpers/contacts/dataMappers/mappers",["require","exports","module","lodash-compat","jSkype/modelHelpers/contacts/dataMappers/dataMaps","utils/people/userDataProcessor","jSkype/models/phoneNumber","utils/chat/dateTime","constants/common"],function(e,t){function a(e,t,n){e._set(n?n(t):t)}function f(e,t){var n=r.phoneTypes[t.type],o=l(e,t);return o||(o=new s,a(o.telUri,t.number,i.sanitize),e.add(o,o.telUri())),o.type._set(n),a(o.displayString,t.number,i.sanitize),e}function l(e,t){return n.find(e(),function(e){return e.telUri()===t.number})}function c(e){var t="cacheHeaders=1",n=new RegExp(t,"i");return e.match(n)||(e+=(e.split("?").length>1?"&":"?")+t),e}function h(e){var t=/^http:\/\//.test(e);return t?e.replace("http://","https://"):e}function p(e){return e.toUpperCase()}var n=e("lodash-compat"),r=e("jSkype/modelHelpers/contacts/dataMappers/dataMaps"),i=e("utils/people/userDataProcessor"),s=e("jSkype/models/phoneNumber"),o=e("utils/chat/dateTime"),u=e("constants/common");t.mapId=function(e,t){e&&a(t.id,e,i.sanitizeXml)},t.mapAvatarUrl=function(e,t){if(e){var r=n.compose(h,c);a(t.avatarUrl,e,r)}},t.mapDisplayName=function(e,t){e&&a(t.displayName,e,i.sanitizeXml)},t.mapDisplayNameFallback=function(e,t,n){e&&t?a(n.displayName,e+" "+t,i.sanitizeXml):e?a(n.displayName,e,i.sanitizeXml):t&&a(n.displayName,t,i.sanitizeXml)},t.mapFirstName=function(e,t){e&&a(t.firstName,e,i.sanitizeXml)},t.mapLastName=function(e,t){e&&a(t.lastName,e,i.sanitizeXml)},t.mapCity=function(e,t){e&&a(t.location.city,e,i.sanitize)},t.mapState=function(e,t){e&&a(t.location.state,e,i.sanitize)},t.mapCountry=function(e,t){if(e){var r=n.compose(p,i.sanitize);a(t.location.country,e,r)}},t.mapActivity=function(e,t){e&&a(t.activity,e,i.sanitize)},t.mapPhoneNumbers=function(e,t){function i(e,t){return n.some(t,function(t){return e.telUri()===t.number})}if(e&&!!e.length){var r=[];n.forEach(e,function(n){f(t.phoneNumbers,n)}),n.forEach(t.phoneNumbers(),function(s){!i(s,e)&&s.telUri()!==t.id()&&r.push(s)}),n.forEach(r,function(n){t.phoneNumbers.remove(n.telUri())})}},t.mapType=function(e,t){e&&(a(t._type,r.contactTypes[e]),e===r.contactTypeNames.agent&&a(t.isAgent,!0))},t.mapCapabilities=function(e,t){function r(r,i){var s=n.includes(e,r),o=t.capabilities[i];o&&a(o,s)}/cortana/.test(t.id())&&e.push("im.receive"),n.forOwn(u.capabilities,r)},t.mapRegistrationDate=function(e,t){e&&a(t._registeredAt,o.getDate(parseInt(e,10)))},t.mapAgentAuthor=function(e,t){e&&a(t.agentDetails.author,e,i.sanitizeXml)},t.mapAgentDescription=function(e,t){e&&a(t.agentDetails.description,e,i.sanitizeXml)},t.mapAgentWebsite=function(e,t){e&&a(t.agentDetails.website,e,i.sanitizeXml)},t.mapAgentPrivacyStatement=function(e,t){e&&a(t.agentDetails.privacyStatement,e,i.sanitizeXml)},t.mapAgentTermsOfService=function(e,t){e&&a(t.agentDetails.termsOfService,e,i.sanitizeXml)},t.mapAgentExtraInfo=function(e,t){e&&a(t.agentDetails.extraInfo,e,i.sanitizeXml)}}),define("jSkype/modelHelpers/contacts/dataMappers/contactToPerson",["require","exports","module","lodash-compat","jSkype/constants/people","jSkype/constants/people","jSkype/modelHelpers/contacts/authorizationChange","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/modelHelpers/contacts/dataMappers/mappers","jSkype/modelHelpers/contacts/dataMappers/dataMaps"],function(e,t){function l(e){return n.isArray(e)&&n.isPlainObject(e[0])}function c(e){return e.suggested?r.SUGGESTED_CONTACT_ACTIVITY_MESSAGE:e.mood}function h(e,t){u.mapCity(e.city,t),u.mapCountry(e.country,t)}function p(e){return e.type==="agent"?e.agent.capabilities:e.type==="pstn"?["audio.receive","group.add"]:[]}function d(e){return e.authorized===!0?i.AUTHORIZED:e.suggested===!0?i.SUGGESTED:i.PENDING_OUTGOING}function v(e){return e.type===a.contactTypeNames.agent&&m(e)||e.type===a.contactTypeNames.pstn}function m(e){return!!e.agent&&!!e.agent.capabilities}var n=e("lodash-compat"),r=e("jSkype/constants/people"),i=e("jSkype/constants/people").authorizationStates,s=e("jSkype/modelHelpers/contacts/authorizationChange"),o=e("jSkype/modelHelpers/personsAndGroupsHelper"),u=e("jSkype/modelHelpers/contacts/dataMappers/mappers"),a=e("jSkype/modelHelpers/contacts/dataMappers/dataMaps"),f=!1;t.map=function(t,r,i){var a=n.result(t.name,"first"),m=n.result(t.name,"surname"),g=d(t),y=c(t);u.mapType(t.type,r),u.mapAvatarUrl(t.avatar_url,r),u.mapDisplayName(t.display_name,r),u.mapFirstName(a,r),u.mapLastName(m,r),u.mapPhoneNumbers(t.phones,r),u.mapActivity(y,r),v(t)&&u.mapCapabilities(p(t),r),l(t.locations)&&h(t.locations[0],r),r.displayName()===r.id()&&u.mapDisplayNameFallback(a,m,r),i&&r.status._set(o.getDefaultPresence(r,g)),s.setAuthorization(r,g,f),t.blocked?s.setBlocked(r,f):s.setUnblocked(r,f),s.updateGroups(r)}}),define("jSkype/modelHelpers/contacts/dataMappers/profileToPerson",["require","exports","module","jSkype/modelHelpers/contacts/dataMappers/mappers","jSkype/constants/people"],function(e,t){function i(e,t){var i=t.displayName();(i===r||i===t.id())&&n.mapDisplayNameFallback(e.firstname,e.lastname,t)}var n=e("jSkype/modelHelpers/contacts/dataMappers/mappers"),r=e("jSkype/constants/people").SELF;return t.map=function(e,t){n.mapId(e.username,t),n.mapFirstName(e.firstname,t),n.mapLastName(e.lastname,t),n.mapDisplayName(e.displayname,t),n.mapCity(e.city,t),n.mapState(e.state,t),n.mapCountry(e.country,t),n.mapActivity(e.mood,t),n.mapAvatarUrl(e.avatarUrl,t),i(e,t)},t}),define("jSkype/modelHelpers/contacts/dataMappers/userInfo",["require","exports","module","jSkype/modelHelpers/contacts/dataMappers/mappers"],function(e,t){var n=e("jSkype/modelHelpers/contacts/dataMappers/mappers");return t.map=function(e,t){n.mapRegistrationDate(e.registrationDate,t)},t}),define("jSkype/modelHelpers/contacts/dataMappers/directoryResultToPerson",["require","exports","module","lodash-compat","jSkype/modelHelpers/contacts/dataMappers/mappers"],function(e,t){var n=e("lodash-compat"),r=e("jSkype/modelHelpers/contacts/dataMappers/mappers");t.map=function(e,t){e.Skype?r.mapDisplayName(n.result(e.Skype,"DisplayName"),t):e.Lync&&r.mapDisplayName(n.result(e.Lync,"DisplayName"),t),r.mapCity(n.result(e.CurrentLocation,"City"),t),r.mapState(n.result(e.CurrentLocation,"Province"),t),r.mapCountry(n.result(e.CurrentLocation,"Country"),t)}}),define("jSkype/modelHelpers/contacts/dataMappers/directorySearchResultByIdToPerson",["require","exports","module","lodash-compat","jSkype/modelHelpers/contacts/dataMappers/mappers"],function(e,t){var n=e("lodash-compat"),r=e("jSkype/modelHelpers/contacts/dataMappers/mappers");t.map=function(e,t){r.mapDisplayName(n.result(e,"fullname"),t),r.mapCity(n.result(e,"city"),t),r.mapState(n.result(e,"province"),t),r.mapCountry(n.result(e,"key_country"),t)}}),define("jSkype/modelHelpers/contacts/dataMappers/factory",["require","exports","module","jSkype/modelHelpers/contacts/dataMappers/contactToPerson","jSkype/modelHelpers/contacts/dataMappers/profileToPerson","jSkype/modelHelpers/contacts/dataMappers/userInfo","jSkype/modelHelpers/contacts/dataMappers/directoryResultToPerson","jSkype/modelHelpers/contacts/dataMappers/directorySearchResultByIdToPerson"],function(e,t){var n=e("jSkype/modelHelpers/contacts/dataMappers/contactToPerson"),r=e("jSkype/modelHelpers/contacts/dataMappers/profileToPerson"),i=e("jSkype/modelHelpers/contacts/dataMappers/userInfo"),s=e("jSkype/modelHelpers/contacts/dataMappers/directoryResultToPerson"),o=e("jSkype/modelHelpers/contacts/dataMappers/directorySearchResultByIdToPerson");t.getContactMapper=function(){return n},t.getProfileMapper=function(){return r},t.getUserInfoMapper=function(){return i},t.getDirectorySearchMapper=function(){return s},t.getDirectorySearchByIdMapper=function(){return o}}),define("jSkype/modelHelpers/contacts/dataHandlers/meProfile",["require","exports","module","jSkype/client","constants/common","jSkype/settings","jSkype/modelHelpers/propertyModelHelper","jSkype/modelHelpers/contacts/dataMappers/factory"],function(e,t){function u(e){this.onSuccess=function(t){return e.map(t.response,n.get().personsAndGroupsManager.mePerson),a(),s.createResolvedPromise()},this.onError=function(e){return s.createRejectedPromise(e)}}function a(){var e=n.get()._telemetryManager,t={name:r.telemetry.contacts.name.GET_PROFILES,batchCount:1};e.sendEvent(i.settings.telemetry.jSkypeTenantToken,r.telemetry.contacts.type.CONTACTS,t)}var n=e("jSkype/client"),r=e("constants/common"),i=e("jSkype/settings"),s=e("jSkype/modelHelpers/propertyModelHelper"),o=e("jSkype/modelHelpers/contacts/dataMappers/factory");t.build=function(){var e=o.getProfileMapper();return new u(e)}}),define("jSkype/modelHelpers/contacts/dataHandlers/userInfo",["require","exports","module","jSkype/client","jSkype/modelHelpers/propertyModelHelper","jSkype/modelHelpers/contacts/dataMappers/factory"],function(e,t){function s(e){this.onSuccess=function(t){return e.map(t.response,n.get().personsAndGroupsManager.mePerson),r.createResolvedPromise()},this.onError=function(e){return r.createRejectedPromise(e)}}var n=e("jSkype/client"),r=e("jSkype/modelHelpers/propertyModelHelper"),i=e("jSkype/modelHelpers/contacts/dataMappers/factory");t.build=function(){var e=i.getUserInfoMapper();return new s(e)}}),define("jSkype/modelHelpers/contacts/dataHandlers/peopleSettings",["require","exports","module"],function(e,t){function r(){function e(e){return e.response&&e.response.Settings&&e.response.Settings.length>0}function t(t){var i=!1;return e(t)?(t.response.Settings.some(function(e){if(e.Name.toLowerCase()===n){i=r(e);return}}),i):i}function r(e){var t;try{t=JSON.parse(e.Value.toLowerCase())}catch(n){t=!1}return t}this.onSuccess=function(e){return new Promise(function(n){n(t(e))})},this.onError=function(e){return new Promise(function(t,n){n(e)})}}var n="skype.autobuddy";t.build=function(){return new r}}),define("jSkype/modelHelpers/contacts/dataHandlers/ABCHProfileService",["require","exports","module","lodash-compat","constants/common"],function(e,t){function o(){function e(e){var t=[];return!e.response||!e.response.Views?t:(n.map(e.response.Views,"Attributes")[0].filter(u).reduce(f,t),n.sortBy(t,a))}function t(e){return!!(e.response&&e.response.Errors&&e.response.Errors.length>0)}function o(e){return e.response.Errors[0].Message}function u(e){return e.Name===i.EMAIL||e.Name===i.PHONES}function a(e){return e.type}function f(e,t){return t.Name===i.PHONES&&n.forEach(t.Value,function(t){if(t.State!==s.VERIFIED)return;e.push({type:r.proofTypes.PHONE,cc:t.Country,number:t.Name,value:t.Country.replace(/\w+-(\d+)/,"+$1")+t.Name,isSearchable:t.Searchable})}),t.Name===i.EMAIL&&n.forEach(t.Value,function(t){if(t.State!==s.VERIFIED)return;e.push({type:r.proofTypes.EMAIL,value:t.Name,isSearchable:t.Searchable})}),e}this.onSuccess=function(n){return t(n)?Promise.reject(o(n)):Promise.resolve(e(n))},this.onError=function(e){return Promise.reject(e)}}var n=e("lodash-compat"),r=e("constants/common"),i={EMAIL:"PersonalContactProfile.Emails",PHONES:"PersonalContactProfile.Phones"},s={VERIFIED:"Verified"};t.build=function(){return new o}}),define("jSkype/modelHelpers/contacts/dataHandlers/phoneUpdate",["require","exports","module"],function(e,t){function n(){function e(e){return!!(e.response&&e.response.Errors&&e.response.Errors.length>0)}function t(e){return e.response.Errors[0].Message}this.onSuccess=function(n){return e(n)?Promise.reject(t(n)):Promise.resolve()},this.onError=function(e){return Promise.reject(e)}}t.build=function(){return new n}}),define("jSkype/modelHelpers/contacts/dataHandlers/batchProfiles",["require","exports","module","lodash-compat","constants/common","jSkype/settings","jSkype/modelHelpers/propertyModelHelper","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/modelHelpers/contacts/dataMappers/factory","jSkype/client"],function(e,t){function f(e){function u(t){var n=o.getPerson(t.username);n&&e.map(t,n)}function f(e){var t=a.get()._telemetryManager,n=e&&e.response?e.response.length:0,s=r.telemetry.contacts.type.CONTACTS,o={name:r.telemetry.contacts.name.GET_PROFILES,batchCount:n};t.sendEvent(i.settings.telemetry.jSkypeTenantToken,s,o)}var t=n.once(f);this.onSuccess=function(e){var n=e&&e.response?e.response:[];return n.forEach(u),t(e),s.createResolvedPromise()},this.onError=function(e){return s.createRejectedPromise(e)}}var n=e("lodash-compat"),r=e("constants/common"),i=e("jSkype/settings"),s=e("jSkype/modelHelpers/propertyModelHelper"),o=e("jSkype/modelHelpers/personsAndGroupsHelper"),u=e("jSkype/modelHelpers/contacts/dataMappers/factory"),a=e("jSkype/client");t.build=function(){var e=u.getProfileMapper();return new f(e)}}),define("jSkype/modelHelpers/contacts/groupCleaner",["require","exports","module","lodash-compat","jSkype/client","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/constants/people","jSkype/modelHelpers/contacts/authorizationChange","jSkype/modelHelpers/personsRegistry/instance"],function(e,t){function a(e){function u(){return e.filter(a).map(function(e){return e.id()})}function a(e){return!!r.get().personsAndGroupsManager.all.persons(e.id())}var t=this;this.filter=function(e){var r=n.difference(u(),n.pluck(e,"id"));return r.reduce(function(e,n){return t.removeContact(n)?e.concat(n):e},[])},this.removeContact=function(e){var t=i.getPersonById(e);return t?(o.setAuthorization(t,s.UNAUTHORIZED),!0):!1}}var n=e("lodash-compat"),r=e("jSkype/client"),i=e("jSkype/modelHelpers/personsAndGroupsHelper"),s=e("jSkype/constants/people").authorizationStates,o=e("jSkype/modelHelpers/contacts/authorizationChange"),u=e("jSkype/modelHelpers/personsRegistry/instance");t.build=function(){var e=u.build();return new a(e)}}),define("jSkype/modelHelpers/contacts/dataProcessors/authorization",["require","jSkype/constants/people","jSkype/modelHelpers/contacts/authorizationChange","jSkype/modelHelpers/personsRegistry/instance"],function(e){function i(e){this.process=function(r){r.forEach(function(r){r._authorization()===t.UNKNOWN&&(n.setAuthorization(r,t.UNAUTHORIZED),e.add(r))})}}var t=e("jSkype/constants/people").authorizationStates,n=e("jSkype/modelHelpers/contacts/authorizationChange"),r=e("jSkype/modelHelpers/personsRegistry/instance");return{build:function(){var e=r.build();return new i(e)}}}),define("jSkype/modelHelpers/presence/cache/local",["require","exports","module","lodash-compat","utils/common/cache/instance","jSkype/constants/data","jSkype/constants/data","jSkype/modelHelpers/personHelper","jSkype/modelHelpers/personsAndGroupsHelper"],function(e,t){function a(e){return i.CONTACT_PRESENCE+"|"+e}function f(){return r.get().getAllKeys(s.CONTACT_PRESENCE)}function l(e){return e.forEach(function(e){var t=e[1],n=u.getPerson(o.getId(e[0]));if(t.status){var r=u.getDefaultPresence(n);n.status._set(r?r:t.status)}t.lastSeenAt&&n.lastSeenAt(t.lastSeenAt),t.endpointType&&n.endpointType._set(t.endpointType)}),e}var n=e("lodash-compat"),r=e("utils/common/cache/instance"),i=e("jSkype/constants/data").storageKeys,s=e("jSkype/constants/data").storageKeyRegExp,o=e("jSkype/modelHelpers/personHelper"),u=e("jSkype/modelHelpers/personsAndGroupsHelper");t.set=function(e,t){var i=a(e),s=r.get();return s.getItem(i).then(function(e){var r=n.merge(e||{},t);return s.setItem(i,r)})},t.remove=function(e){return r.get().removeItem(a(e))},t.restore=function(){return f().then(function(e){var t=e.reduce(function(e,t){var n=t.split("|")[1];return e.concat(Promise.all([n,r.get().getItem(t)]))},[]);return Promise.all(t).then(l)})},t.destroy=function(){return f().then(function(e){var t=e.reduce(function(e,t){return e.concat(r.get().removeItem(t))},[]);return Promise.all(t)})}}),define("jSkype/modelHelpers/presence/cache/session",["require","exports","module","lodash-compat","jSkype/client","jSkype/constants/people","swx-utils-common","jSkype/constants/data","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/modelHelpers/personHelper","jcafe-property-model"],function(e,t){function l(){s.set(o,"{}")}function c(e,t,n,r,i){e[t]={status:n,lastSeenAt:r,endpointType:i}}function h(e,t,n,r,i){e[t].endpointType=i||e[t].endpointType,e[t].lastSeenAt=r||e[t].lastSeenAt,e[t].status=n||e[t].status}function p(e){return function(n,r){var i=!!r&&!!(r.status||r.lastSeenAt||r.endpointType);i&&e.call(t,n,r)}}function d(){var e=s.get(o);return e?JSON.parse(e):(l(),{})}function v(e,t){var n=e[t.id()];n&&n.status&&t.status(n.status,f.property.sUpdated)}function m(e,t){n.forIn(n.omit(e,[t.id(),i]),function(e,t){var n=u.getPerson(a.getId(t));if(e.status){var r=u.getDefaultPresence(n);n.status._set(r?r:e.status)}e.lastSeenAt&&n.lastSeenAt(e.lastSeenAt),e.endpointType&&n.endpointType._set(e.endpointType)})}function g(e){function r(t,n){return t[n]={status:e[n]},t}if(!n.isEmpty(e)&&y(e)){var t=Object.keys(e).reduce(r,{});s.set(o,JSON.stringify(t)),e=t}return e}function y(e){return Object.keys(e).every(function(t){return n.isString(e[t])})}var n=e("lodash-compat"),r=e("jSkype/client"),i=e("jSkype/constants/people").SELF,s=e("swx-utils-common").sessionStorage,o=e("jSkype/constants/data").storageKeys.PRESENCE_DATA,u=e("jSkype/modelHelpers/personsAndGroupsHelper"),a=e("jSkype/modelHelpers/personHelper"),f=e("jcafe-property-model");t.restore=function(){var e=r.get().personsAndGroupsManager.mePerson,t=d(),n=g(t,e.id());return v(n,e),m(n,e),t},t.set=p(function(e,t){var n=d(),r=t.status,i=t.lastSeenAt,u=t.endpointType;n[e]?h(n,e,r,i,u):c(n,e,r,i,u),s.set(o,JSON.stringify(n))}),t.remove=function(e){var t=d(),n=delete t[e];return s.set(o,JSON.stringify(t)),n},t.destroy=function(){s.remove(o)}}),define("jSkype/modelHelpers/presence/presenceDataStorage",["require","exports","module","lodash-compat","jSkype/settings","constants/common","jSkype/modelHelpers/presence/cache/local","jSkype/modelHelpers/presence/cache/session"],function(e,t){function u(){return r.isFeatureOn(i.featureFlags.PRESENCE_DATA_CACHE)}function a(){return o.destroy(),s.restore()}var n=e("lodash-compat"),r=e("jSkype/settings"),i=e("constants/common"),s=e("jSkype/modelHelpers/presence/cache/local"),o=e("jSkype/modelHelpers/presence/cache/session");t.getCache=function(){return u()?s:o},t.restoreData=function(){if(u()){var e=o.restore();if(!n.isEmpty(e)){var t=Object.keys(e).map(function(t){return s.set(t,e[t])});return Promise.all(t).then(function(){return a()})}return a()}return s.restore().then(function(e){return n.isEmpty(e)||e.forEach(function(e){o.set(e.id,n.omit(e,"id"))}),o.restore(),s.destroy()})}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-agentProvisioningService/lib/agentProvisioningService",["require","exports","reqwest","lodash-compat"],e)}(function(e,t){function i(e,t){function i(r){var i=e().then(function(e){var i={url:t.host+"relationship/me/"+r,type:"PUT",crossOrigin:!0,headers:{"X-SkypeToken":e}};return n.compat(i)});return Promise.resolve(i)}function s(i){var s=e().then(function(e){var s=t.host+"agents",o=r.reduce(r.keys(i),function(e,t){return e.concat([t,i[t]].join("="))},[]).join("&"),u={url:s+(o?"?"+o:""),type:"GET",crossOrigin:!0,headers:{"X-SkypeToken":e}};return n.compat(u)});return Promise.resolve(s)}return{add:i,search:s}}var n=e("reqwest"),r=e("lodash-compat");t.build=i}),define("swx-agentProvisioningService",["swx-agentProvisioningService/lib/agentProvisioningService"],function(e){return e}),define("jSkype/modelHelpers/contacts/dataMappers/agentToPerson",["require","exports","module","lodash-compat","jSkype/modelHelpers/contacts/dataMappers/mappers","jSkype/modelHelpers/contacts/dataMappers/dataMaps"],function(e,t){var n=e("lodash-compat"),r=e("jSkype/modelHelpers/contacts/dataMappers/mappers"),i=e("jSkype/modelHelpers/contacts/dataMappers/dataMaps");t.map=function(e,t){return t.isAgent._set(!0),t._type._set(i.contactTypes[i.contactTypeNames.agent]),t.avatarUrl._set(e.userTileStaticUrl),r.mapDisplayName(e.displayName,t),r.mapAgentAuthor(e.developer,t),r.mapAgentDescription(e.description,t),r.mapAgentWebsite(e.webpage,t),r.mapAgentPrivacyStatement(e.privacyStatement,t),r.mapAgentTermsOfService(e.tos,t),r.mapAgentExtraInfo(e.extra,t),t.agentDetails.certification._set(e.isTrusted),t.agentDetails.rating._set(e.starRating),n(e.capabilities).includes("group_chat")&&t.capabilities._groupChat._set(!0),t}}),define("jSkype/modelHelpers/contacts/dataProcessors/agents",["require","lodash-compat","utils/common/settablePromise","constants/common","jSkype/settings","swx-agentProvisioningService","jSkype/modelHelpers/contacts/dataMappers/agentToPerson","jSkype/client"],function(e){function a(e){function s(t,s){var a={agentId:s.id()},f=n.build();return e.search(a).then(function(e){e.agentDescriptions[0]?f.resolve(o.map(e.agentDescriptions[0],s)):f.resolve(s)},function(e){u.get()._telemetryManager.sendEvent(i.settings.telemetry.jSkypeTenantToken,"ServiceFault",{serviceName:"agents-search",faultCode:e.status,faultContext:r.telemetry.NOT_AVAILABLE,errorCode:e.status||r.telemetry.NOT_AVAILABLE,errorMessage:e.responseText||r.telemetry.NOT_AVAILABLE,verb:"GET",host:i.settings.agentProvisioningService.host}),f.resolve(s)}),t.concat(f),t}this.process=function(e){var n=t.reduce(e,s,[]);return Promise.all(n)}}var t=e("lodash-compat"),n=e("utils/common/settablePromise"),r=e("constants/common"),i=e("jSkype/settings"),s=e("swx-agentProvisioningService"),o=e("jSkype/modelHelpers/contacts/dataMappers/agentToPerson"),u=e("jSkype/client");return{build:function(){var e=u.get().signInManager._skypeToken,t=s.build(e,i.settings.agentProvisioningService);return new a(t)}}}),define("jSkype/modelHelpers/contacts/contactAdder",["require","lodash-compat","jSkype/modelHelpers/contacts/dataMappers/factory","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/settings","constants/common","jSkype/modelHelpers/presence/presenceDataStorage","jSkype/modelHelpers/contacts/dataMappers/dataMaps","jSkype/modelHelpers/contacts/dataProcessors/agents"],function(e){function f(e,n){function o(t){var n=r.getPersonById(t.id);return n?e.map(t,n,!1):(n=r.getPerson(t.id),e.map(t,n,!0)),n}function f(e,t){if(l(t)){var n=o(t);t.type===u.contactTypeNames.agent&&e.push(n)}return e}function l(e){return r.isMePerson(e.id)?!1:e.type===u.contactTypeNames.pstn&&!i.isFeatureOn(s.featureFlags.PSTN_ENABLED)?!1:e.type===u.contactTypeNames.agent&&!i.isFeatureOn(s.featureFlags.AGENTS_ENABLED)?!1:!0}function c(e){n.set(e.id(),{status:e.status()})}this.add=function(e){var n=t.reduce(e,f,[]);return t.forEach(n,c),a.build().process(n)}}var t=e("lodash-compat"),n=e("jSkype/modelHelpers/contacts/dataMappers/factory"),r=e("jSkype/modelHelpers/personsAndGroupsHelper"),i=e("jSkype/settings"),s=e("constants/common"),o=e("jSkype/modelHelpers/presence/presenceDataStorage"),u=e("jSkype/modelHelpers/contacts/dataMappers/dataMaps"),a=e("jSkype/modelHelpers/contacts/dataProcessors/agents");return{build:function(){var e=n.getContactMapper(),t=o.getCache();return new f(e,t)}}}),define("jSkype/modelHelpers/contacts/dataProcessors/contactList",["require","exports","module","lodash-compat","constants/common","constants/people","utils/common/cache/instance","jSkype/client","jSkype/settings","jSkype/constants/data","jSkype/constants/people","jSkype/modelHelpers/contacts/groupCleaner","jSkype/modelHelpers/contacts/dataProcessors/authorization","jSkype/modelHelpers/contacts/contactAdder","jSkype/modelHelpers/personsRegistry/instance","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/services/internalPubSub"],function(e,t){function m(e){function p(e){var t=n.reduce(e.contacts,function(e,t){return t.deleted?(l.build().removeContact(t.id),e):e.concat(t)},[]);return t.length>0&&(h.build().add(t),e.scope===i.scopes.FULL&&l.build().filter(t)),o.get().personsAndGroupsManager.all.persons()}function m(e,t){if(e&&u.isFeatureOn(r.featureFlags.CONTACT_PROFILE_CACHE)){var n=t.map(d.createRawDataFromPerson);return s.get().setSensitiveItem(a.CONTACT_PROFILES,n)}return Promise.resolve()}function g(t){e.defaultPersonAuthorization=f.UNAUTHORIZED,c.build().process(e.toArray()),v.get().publish("contacts:loaded",t.filter(function(e){return e._authorization()===f.AUTHORIZED&&!e.isBlocked()})),o.get().personsAndGroupsManager._initialized(!0)}var t=n.once(g);this.process=function(e){var n=p(e);return t(n),m(e.contacts,n)}}var n=e("lodash-compat"),r=e("constants/common"),i=e("constants/people"),s=e("utils/common/cache/instance"),o=e("jSkype/client"),u=e("jSkype/settings"),a=e("jSkype/constants/data").storageKeys,f=e("jSkype/constants/people").authorizationStates,l=e("jSkype/modelHelpers/contacts/groupCleaner"),c=e("jSkype/modelHelpers/contacts/dataProcessors/authorization"),h=e("jSkype/modelHelpers/contacts/contactAdder"),p=e("jSkype/modelHelpers/personsRegistry/instance"),d=e("jSkype/modelHelpers/personsAndGroupsHelper"),v=e("jSkype/services/internalPubSub");t.build=function(){var e=p.build();return new m(e)}}),define("jSkype/modelHelpers/contacts/dataHandlers/contactList",["require","exports","module","lodash-compat","constants/common","constants/people","jSkype/constants/data","jSkype/client","jSkype/constants/people","jSkype/modelHelpers/contacts/dataProcessors/contactList","jSkype/settings","utils/common/cache/instance","browser/window","jSkype/services/serviceFactory"],function(e,t){function p(e){function d(e,t){var n=e.reduce(function(e,t){return t.authorized&&(e.authorized+=1),!t.authorized&&!t.suggested&&(e.pendingOutgoing+=1),!t.authorized&&t.suggested&&(e.suggested+=1),e},{authorized:0,pendingOutgoing:0,suggested:0});o.get()._telemetryManager.sendEvent(f.settings.telemetry.jSkypeTenantToken,r.telemetry.contacts.type.CONTACTS,{contactsCount:e.length,name:t,authorizedCount:n.authorized,pendingOutgoingCount:n.pendingOutgoing,suggestedCount:n.suggested}),o.get()._telemetry.eventBus.publish(r.events.contacts.CONTACTS_LOADED,{contactsCount:e.length})}function v(e){var t=r.telemetry.contacts.name;g(e.scope)===i.scopes.FULL?p(e.contacts,t.GET_CONTACT_LIST):d(e.contacts,t.GET_CONTACT_LIST_DELTA)}function m(){var e=o.get().personsAndGroupsManager.mePerson.id();h.getContactsService().getMyContacts(e).then(t.onSuccess,t.onError),a=undefined}function g(e){return n.isString(e)?e.toLowerCase():""}var t=this,a,p=n.once(d);t.onSuccess=function(t){var n=e.process(t.response);return t.response&&t.response.contacts&&v(t.response),n.then(function(e){if(f.isFeatureOn(r.featureFlags.CONTACT_PROFILE_CACHE)&&e){var t=e.getResponseHeader("ETag");t&&l.get().setItem(s.ETAG,t)}}.bind(null,t.request))},t.onError=function(e){return e.status===404&&!a&&(o.get().personsAndGroupsManager._initialized(!0),a=c.setTimeout(m,u)),Promise.reject(e)}}var n=e("lodash-compat"),r=e("constants/common"),i=e("constants/people"),s=e("jSkype/constants/data").storageKeys,o=e("jSkype/client"),u=e("jSkype/constants/people").contactList.retry.TIMEOUT,a=e("jSkype/modelHelpers/contacts/dataProcessors/contactList"),f=e("jSkype/settings"),l=e("utils/common/cache/instance"),c=e("browser/window"),h=e("jSkype/services/serviceFactory");t.build=function(){var e=a.build();return new p(e)}}),define("jSkype/modelHelpers/contacts/dataHandlers/contactBlocked",["require","exports","module","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/modelHelpers/contacts/authorizationChange","jSkype/client","constants/common","jSkype/settings"],function(e,t){function u(){this.onSuccess=function(e){var t=n.getPerson(e);r.setBlocked(t),a()},this.onError=function(e){}}function a(){var e={name:s.telemetry.contacts.name.CONTACT_BLOCKED};i.get()._telemetryManager.sendEvent(o.settings.telemetry.jSkypeTenantToken,s.telemetry.contacts.type.CONTACTS,e)}var n=e("jSkype/modelHelpers/personsAndGroupsHelper"),r=e("jSkype/modelHelpers/contacts/authorizationChange"),i=e("jSkype/client"),s=e("constants/common"),o=e("jSkype/settings");t.build=function(){return new u}}),define("jSkype/modelHelpers/contacts/dataHandlers/contactUnblocked",["require","exports","module","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/modelHelpers/contacts/authorizationChange","jSkype/client","jSkype/settings","constants/common"],function(e,t){function u(){this.onSuccess=function(e){var t=n.getPerson(e);r.setUnblocked(t),a()},this.onError=function(e){}}function a(){var e={name:o.telemetry.contacts.name.CONTACT_UNBLOCKED};i.get()._telemetryManager.sendEvent(s.settings.telemetry.jSkypeTenantToken,o.telemetry.contacts.type.CONTACTS,e)}var n=e("jSkype/modelHelpers/personsAndGroupsHelper"),r=e("jSkype/modelHelpers/contacts/authorizationChange"),i=e("jSkype/client"),s=e("jSkype/settings"),o=e("constants/common");t.build=function(){return new u}}),define("jSkype/modelHelpers/contacts/dataHandlers/contactDeleted",["require","exports","module","jSkype/modelHelpers/contacts/authorizationChange","jSkype/constants/people","jSkype/client","jSkype/settings","constants/common","jSkype/modelHelpers/presence/presenceDataStorage"],function(e,t){function a(){this.onSuccess=function(e){u.getCache().remove(e.id()),n.setAuthorization(e,r.UNAUTHORIZED),f()},this.onError=function(e){}}function f(){var e={name:o.telemetry.contacts.name.CONTACT_DELETED};i.get()._telemetryManager.sendEvent(s.settings.telemetry.jSkypeTenantToken,o.telemetry.contacts.type.CONTACTS,e)}var n=e("jSkype/modelHelpers/contacts/authorizationChange"),r=e("jSkype/constants/people").authorizationStates,i=e("jSkype/client"),s=e("jSkype/settings"),o=e("constants/common"),u=e("jSkype/modelHelpers/presence/presenceDataStorage");t.build=function(){return new a}}),define("jSkype/modelHelpers/contacts/dataHandlers/contactRequestAccepted",["require","exports","module","constants/common","jSkype/modelHelpers/contacts/authorizationChange","jSkype/constants/people","jSkype/settings","jSkype/client"],function(e,t){function u(){this.onSuccess=function(e){r.setAuthorization(e,i.AUTHORIZED),a(e)},this.onError=function(e){}}function a(e){var t={name:n.telemetry.contacts.name.CONTACT_REQUEST_ACCEPTED,user_from:[e.id(),window.skypeTelemetryManager.PIIType.Identity]};o.get()._telemetryManager.sendEvent(s.settings.telemetry.jSkypeTenantToken,n.telemetry.contacts.type.CONTACT_REQUESTS,t)}var n=e("constants/common"),r=e("jSkype/modelHelpers/contacts/authorizationChange"),i=e("jSkype/constants/people").authorizationStates,s=e("jSkype/settings"),o=e("jSkype/client");t.build=function(){return new u}}),define("jSkype/modelHelpers/contacts/dataHandlers/contactRequestSent",["require","exports","module","jSkype/client","jSkype/modelHelpers/contacts/authorizationChange","jSkype/constants/people","jSkype/settings","constants/common","jSkype/modelHelpers/contacts/contactMessageFactory"],function(e,t){function a(){this.onSuccess=function(e){var t,a=n.get().conversationsManager.getConversation(e),f={name:o.telemetry.contacts.name.ADD_CONTACT};if(e.isAgent())r.setAuthorization(e,i.AUTHORIZED),f.isResend=!1,f.suggested=!1,f.isAgent=!0;else if(e._authorization()===i.PENDING_OUTGOING)t=u.getOutgoingResend(e),a.historyService._processRawMessage(t),f.isResend=!0,f.suggested=!1,f.isAgent=!1;else{var l=e._authorization()===i.SUGGESTED;r.setAuthorization(e,i.PENDING_OUTGOING),f.isResend=!1,f.suggested=l,f.isAgent=!1}n.get()._telemetryManager.sendEvent(s.settings.telemetry.jSkypeTenantToken,o.telemetry.contacts.type.CONTACT_REQUESTS,f)},this.onError=function(e,t){t&&t.isAgent()&&n.get()._telemetryManager.sendEvent(s.settings.telemetry.jSkypeTenantToken,"ServiceFault",{serviceName:"agents-addToContacts",faultCode:e.status,faultContext:o.telemetry.NOT_AVAILABLE,errorCode:e.status||o.telemetry.NOT_AVAILABLE,errorMessage:e.responseText||o.telemetry.NOT_AVAILABLE,verb:"PUT",host:s.settings.agentProvisioningService.host})}}var n=e("jSkype/client"),r=e("jSkype/modelHelpers/contacts/authorizationChange"),i=e("jSkype/constants/people").authorizationStates,s=e("jSkype/settings"),o=e("constants/common"),u=e("jSkype/modelHelpers/contacts/contactMessageFactory");t.build=function(){return new a}}),define("jSkype/modelHelpers/contacts/dataProcessors/contactRequests",["require","exports","module","jSkype/client","jSkype/constants/people","swx-enums","jSkype/modelHelpers/contacts/contactActivityItemHelper","jSkype/modelHelpers/contacts/contactMessageFactory","utils/chat/messageSanitizer","constants/common","jSkype/settings","jSkype/modelHelpers/personsRegistry/instance","jSkype/models/person"],function(e,t){function h(){this.process=function(e){var t=n.get().conversationsManager;t._conversationsSynced.promise.then(function(){function a(e){var t=n.get(e);return t?t._authorization._set(r.PENDING_INCOMING):(t=new c(e),t._authorization._set(r.PENDING_INCOMING),n.add(t)),t}var n=l.build();e.forEach(function(e){var n,r,f,l,c,h,d=a(e.sender);n=t.getConversation(d),t.conversations.add(n),c=s.getContactRequestIncomingActivityItem(n),r=(new Date(e.event_time_iso)).getTime();if(!c||c._id!==r)d.status._set(i.onlineStatus.Unknown),s.clearContactRequestActivityItems(n),f=u.escapeIncomingHTML(u.removeAnchorTags(e.greeting)),l=o.getIncoming(d,r,f),h=s.getContactRequestIncomingInviteFreeActivityItem(n),p()&&!h&&n.historyService._processRawMessage(o.getIncomingInviteFree(d,r)),n.historyService._processRawMessage(l)})})}}function p(){return f.isFeatureOn(a.featureFlags.INVITE_FREE_IMPLICIT_INCOMING_CONTACT_REQUEST)}var n=e("jSkype/client"),r=e("jSkype/constants/people").authorizationStates,i=e("swx-enums"),s=e("jSkype/modelHelpers/contacts/contactActivityItemHelper"),o=e("jSkype/modelHelpers/contacts/contactMessageFactory"),u=e("utils/chat/messageSanitizer"),a=e("constants/common"),f=e("jSkype/settings"),l=e("jSkype/modelHelpers/personsRegistry/instance"),c=e("jSkype/models/person");t.build=function(){return new h}}),define("jSkype/modelHelpers/contacts/dataHandlers/contactRequestsIncoming",["require","exports","module","jSkype/modelHelpers/contacts/dataProcessors/contactRequests"],function(e,t){function r(e){this.onSuccess=function(t){t.response&&e.process(t.response)},this.onError=function(e){}}var n=e("jSkype/modelHelpers/contacts/dataProcessors/contactRequests");t.build=function(){var e=n.build();return new r(e)}}),define("jSkype/modelHelpers/contacts/dataHandlers/factory",["require","exports","module","jSkype/modelHelpers/contacts/dataHandlers/meProfile","jSkype/modelHelpers/contacts/dataHandlers/userInfo","jSkype/modelHelpers/contacts/dataHandlers/peopleSettings","jSkype/modelHelpers/contacts/dataHandlers/ABCHProfileService","jSkype/modelHelpers/contacts/dataHandlers/phoneUpdate","jSkype/modelHelpers/contacts/dataHandlers/batchProfiles","jSkype/modelHelpers/contacts/dataHandlers/contactList","jSkype/modelHelpers/contacts/dataHandlers/contactBlocked","jSkype/modelHelpers/contacts/dataHandlers/contactUnblocked","jSkype/modelHelpers/contacts/dataHandlers/contactDeleted","jSkype/modelHelpers/contacts/dataHandlers/contactRequestAccepted","jSkype/modelHelpers/contacts/dataHandlers/contactRequestSent","jSkype/modelHelpers/contacts/dataHandlers/contactRequestsIncoming"],function(e,t){var n={meProfile:e("jSkype/modelHelpers/contacts/dataHandlers/meProfile"),userInfo:e("jSkype/modelHelpers/contacts/dataHandlers/userInfo"),peopleSettings:e("jSkype/modelHelpers/contacts/dataHandlers/peopleSettings"),ABCHProfileService:e("jSkype/modelHelpers/contacts/dataHandlers/ABCHProfileService"),phoneUpdate:e("jSkype/modelHelpers/contacts/dataHandlers/phoneUpdate"),batchProfiles:e("jSkype/modelHelpers/contacts/dataHandlers/batchProfiles"),contactList:e("jSkype/modelHelpers/contacts/dataHandlers/contactList"),contactBlocked:e("jSkype/modelHelpers/contacts/dataHandlers/contactBlocked"),contactUnblocked:e("jSkype/modelHelpers/contacts/dataHandlers/contactUnblocked"),contactDeleted:e("jSkype/modelHelpers/contacts/dataHandlers/contactDeleted"),contactRequestAccepted:e("jSkype/modelHelpers/contacts/dataHandlers/contactRequestAccepted"),contactRequestSent:e("jSkype/modelHelpers/contacts/dataHandlers/contactRequestSent"),contactRequestsIncoming:e("jSkype/modelHelpers/contacts/dataHandlers/contactRequestsIncoming")};t.getMeProfileHandlers=function(){return n.meProfile.build()},t.getUserInfoHandlers=function(){return n.userInfo.build()},t.getPeopleSettingsHandlers=function(){return n.peopleSettings.build()},t.getABCHProfileServiceHandlers=function(){return n.ABCHProfileService.build()},t.getProfilePhoneNumberUpdateHandlers=function(){return n.phoneUpdate.build()},t.getBatchProfileHandlers=function(){return n.batchProfiles.build()},t.getContactListHandlers=function(){return n.contactList.build()},t.getContactBlockedHandlers=function(){return n.contactBlocked.build()},t.getContactUnblockedHandlers=function(){return n.contactUnblocked.build()},t.getContactDeletedHandlers=function(){return n.contactDeleted.build()},t.getContactRequestAcceptedHandlers=function(){return n.contactRequestAccepted.build()},t.getContactRequestSentHandlers=function(){return n.contactRequestSent.build()},t.getContactRequestsIncomingHandlers=function(){return n.contactRequestsIncoming.build()}}),define("jSkype/modelHelpers/personsRegistry/registry",["require","lodash-compat","jSkype/utils/batch","jSkype/constants/people","jSkype/modelHelpers/contacts/dataHandlers/factory","jSkype/services/serviceFactory","jSkype/modelHelpers/contacts/dataMappers/dataMaps","jSkype/modelHelpers/contacts/dataProcessors/agents"],function(e){function f(){function l(e){s.getStratusService().getProfiles(e).then(f.onSuccess,f.onError)}function c(e){return p(e.id())&&e._type()===o.contactTypes[o.contactTypeNames.skype]&&(e._authorization()===a.UNAUTHORIZED||e._authorization()===a.PENDING_INCOMING)}function h(e){return e._type()===o.contactTypes[o.contactTypeNames.agent]&&e._authorization()===a.UNAUTHORIZED}function p(e){var n=/.+\@.+\..+/;if(t.isString(e))return!e.match(n)}var e={},r=n.create(l),f=i.getBatchProfileHandlers();this.defaultPersonAuthorization=a.UNKNOWN,this.get=function(t){return e[t]},this.add=function(t,n){var i=t.id();e[i]=t,n||(h(t)?u.build().process([t]):c(t)&&r.add(i))},this.filter=function(e){return this.toArray().filter(e)},this.toArray=function(){var t=[];return Object.keys(e).forEach(function(n){var r=e[n];t.push(r)}),t},this.dispose=function(){r.clear()}}var t=e("lodash-compat"),n=e("jSkype/utils/batch"),r=e("jSkype/constants/people"),i=e("jSkype/modelHelpers/contacts/dataHandlers/factory"),s=e("jSkype/services/serviceFactory"),o=e("jSkype/modelHelpers/contacts/dataMappers/dataMaps"),u=e("jSkype/modelHelpers/contacts/dataProcessors/agents"),a=r.authorizationStates;return f}),define("jSkype/modelHelpers/personsRegistry/instance",["require","exports","module","jSkype/modelHelpers/personsRegistry/registry"],function(e,t){var n=e("jSkype/modelHelpers/personsRegistry/registry"),r;t.reset=function(){r&&(r.dispose(),r=null)},t.build=function(){return r||(r=new n),r}}),define("jSkype/modelHelpers/personsAndGroupsHelper",["require","exports","module","lodash-compat","browser/window","swx-enums","jSkype/client","jcafe-property-model","jSkype/models/person","jSkype/models/phoneNumber","jSkype/modelHelpers/personsRegistry/instance","jSkype/constants/people","jSkype/modelHelpers/contacts/authorizationChange","jSkype/modelHelpers/personHelper","jSkype/modelHelpers/contacts/dataMappers/dataMaps"],function(e,t){function d(e,n){var r=f.build(),i=r.get(e);return i||(i=new u(e),i._authorization._set(r.defaultPersonAuthorization),y(i,n),i.status._set(t.getDefaultPresence(i,i._authorization())),b(i),r.add(i)),i}function v(e,t){for(var n in e)e.hasOwnProperty(n)&&o.isProperty(e[n])&&e[n]._set(t[n]);return e}function m(e,t){var r=e.phoneNumbers(0);n.forEach(t,function(t){if(r&&r.telUri()===t.telUri)v(r,t);else{var n=new a;v(n,t),e.phoneNumbers.add(n,t.telUri)}})}function g(e){function r(e,t,r){var i=o.isProperty(t),s=!i&&o.isCollection(t),u=i||s?t():t;i&&!n.isUndefined(u)?r[e]=u:s&&(r[e]=u.reduce(function(e,t){return e.concat(g(t))},[]))}var t={};return n.forIn(e,function(e,n){r(n,e,t)}),t}function y(e,t){e._type._set(t),t===p.contactTypes[p.contactTypeNames.agent]&&e.isAgent._set(!0)}function b(e){(h.isPstn(e)||h.isEchoContact(e))&&e.capabilities.video._set(!1),h.isPstn(e)&&e.capabilities.chat._set(!1)}var n=e("lodash-compat"),r=e("browser/window"),i=e("swx-enums"),s=e("jSkype/client"),o=e("jcafe-property-model"),u=e("jSkype/models/person"),a=e("jSkype/models/phoneNumber"),f=e("jSkype/modelHelpers/personsRegistry/instance"),l=e("jSkype/constants/people").authorizationStates,c=e("jSkype/modelHelpers/contacts/authorizationChange"),h=e("jSkype/modelHelpers/personHelper"),p=e("jSkype/modelHelpers/contacts/dataMappers/dataMaps");t.getPersonById=function(e){var t=f.build();return t.get(e)},t.isMePerson=function(e){var t=s.get().personsAndGroupsManager.mePerson,n=h.getId(e);return t.id()===n||t._msaId&&h.getId(t._msaId())===n},t.isKnownPerson=function(e){return!!e&&!!s.get().personsAndGroupsManager.all.persons(e.id())},t.createDefaultPerson=function(e){var t=new u(e);return t._authorization._set(l.UNAUTHORIZED),t},t.createPersonFromRawData=function(e){var n=v(t.getPerson(e.id,e._type),e);return v(n.note,e.note),v(n.location,e.location),v(n.capabilities,e.capabilities),v(n.agentDetails,e.agentDetails),m(n,e.phoneNumbers),c.updateGroups(n),n},t.createRawDataFromPerson=function(e){var t=g(e);return t.note=g(e.note),t.location=g(e.location),t.capabilities=g(e.capabilities),t.agentDetails=g(e.agentDetails),t},t.getUnknownPerson=function(e){var n,r=t.getPersonById(e);return!t.isMePerson(e)&&!t.isKnownPerson(r)&&(n=r||t.createDefaultPerson(e)),n},t.getBlockedGroup=function(){var e=s.get().personsAndGroupsManager.all;return e.groups().filter(function(e){return e.relationshipLevel()===i.groupPrivacyRelationshipLevel.Blocked})[0]},t.getPerson=function(e,n){return t.isMePerson(e)?s.get().personsAndGroupsManager.mePerson:d(e,n)},t.getPersonByConversationId=function(e){var t=h.getId(e),n=h.getTypeFromKey(e);return d(t,n)},t.extractSkypeIdFromToken=function(e){return JSON.parse(r.atob(e.split(".")[1])).skypeid},t.extractCIDFromToken=function(e){return JSON.parse(r.atob(e.split(".")[1])).cid},t.getDefaultPresence=function(e,t){if(t===l.AUTHORIZED&&(e.isAgent()||h.isEchoContact(e)))return i.onlineStatus.Online;if(t===l.PENDING_INCOMING)return i.onlineStatus.Unknown;if(t===l.AUTHORIZED&&!h.isPstn(e))return i.onlineStatus.Offline}}),define("experience/defaultInitParams",[],function(){return{apiKey:"<REQUIRED>",correlationIds:{experienceId:"",hostProperty:"",sessionId:"",tabId:"",userAppId:"",userId:""},fingerprint:"",flags:"",locale:"en-us",variant:"swx",jsonp:!0}}),define("experience/settings",["require","experience/defaultInitParams"],function(e){var t=e("experience/defaultInitParams"),n={enabled:!0,limit:3,delay:1e3,strategy:"fixed"},r={version:"1.40.107",biAppName:"swx-local",biClientName:"Web",platformId:"908",productName:"SWX",API:{version:1,exposeCafe:!1},ecsHosts:["https://a.config.skype.com","https://b.config.skype.com"],ecsSpacesKey:"swg",ecsPesKey:"SkypePersonalization",ecsTrapKey:"MDN_TRAP",ecsCqfKey:"SkypeRealTimeMedia",ecsClientCobrandTag:"0",webApiServiceHost:"https://client-s.gateway.messenger.live.com",amdServiceHost:"https://api.asm.skype.com",assetsServiceHost:"https://apps.skypeassets.com/rates/skypeout",urlPServiceHost:"https://urlp.asm.skype.com",xmmFallbackUrl:"https://login.skype.com/login/sso",keyEncryptionServiceHost:"https://kes.skype.com/v1/swx",keyEncryptionServiceHostV2:"https://kes.skype.com/v2/swx",locationHost:"https://www.bing.com/maps",faqPageUrl:"https://www.skype.com/go/help.faq.skype.for.web",feedbackPageUrl:"https://feedback.skype.com",pollFallbackUrl:"https://login.skype.com/login/sso?go=webclient",meProfileUrl:"https://go.skype.com/myaccount?intsrc=client-_-webapp-_-production-_-go-myaccount",isVideoMessagesDisabled:!1,listParticipantNamesInConversationTopic:!0,isPollingEnabled:!0,maximumParticipantsAudio:25,maximumParticipantsVideo:10,mentionsTreshold:4,startConversationMaxParticipantCount:0,defaultBusinessContactsGroup:"Web Contacts",youtubeWrapDelay:500,youtubeApiUrl:"https://www.youtube.com/iframe_api",mapsApiUrl:"https://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=7.0",flagsApiUrl:"https://flagsapi.skype.com/flags/v1",calendarUrl:"https://outlook.live.com/owa/?path=/calendar/action/compose&",legacyCalendarUrl:"https://calendar.live.com/?rru=addevent&",webLoginUrl:"https://login.skype.com/login",webLoginClientId:"680081",cookiesPrivacyUrl:"https://go.skype.com/privacy/",loginPopup:{loginUrl:"https://login.microsoftonline.com/common/oauth2/authorize",clientId:"e48d4214-364e-4731-b2b6-47dabf529218",redirectUrl:"https://latest-swx.cdn.skype.com/swx4b/aad/externalSignInHandler.html",resourceUrl:"https://webdir.online.lync.com",defaultWidth:800,defaultHeight:600},application:{endpointId:"d97583cc-9781-4a59-9628-06c4e609c65b"},shellApp:{contactPollingInterval:15e3,chromeExtensionId:"blakpkgjpemejpbmfiglncklihnhjkij",chromeExtensionWebstoreUrl:"https://chrome.google.com/webstore/detail/blakpkgjpemejpbmfiglncklihnhjkij",bootstrapperUrl:"https://swx.cdn.skype.com/shared/v/1.2.9/SkypeBootstrap.min.js",indexPageUrl:undefined,connectShellAppHostRetries:2},images:{skypeLogo:"https://swx.cdn.skype.com/assets/skype_logo_white.png",relativeToAppBase:{defaultProfileAvatarSvg:"/assets/images/avatars/default-avatar-contact.svg",defaultGroupAvatarSvg:"/assets/images/avatars/default-avatar-group.svg",defaultPstnAvatarSvg:"/assets/images/avatars/avatar-pstn.svg"}},uicServiceUrl:{byPassword:"https://rtc-uic.cloudapp.net/v0/getuic-jsonp",bySkypeToken:"https://uic.login.skype.com/login/uic"},autoCalling:{waitTimeOut:6e3,callTimeout:12e4,serviceFailureTimeout:3e3},cqf:{skypeCallPercentage:10,groupCallPercentage:10,pstnCallPercentage:10,minimumCallLengthSec:5,inactivityTimeout:6e4},agentProvisioningService:{host:"https://api.aps.skype.com/v1/"},stratusService:{avatarUrl:"users/${contactId}/profile/avatar?cacheHeaders=1",avatarUpdateUrl:"users/${contactId}/profile/avatar",blockContactEndpoint:"users/self/contacts/${contactId}/block",contactRequestEndpoint:"users/self/contacts/auth-request",contactRequestTimeInterval:6e4,contactsEndpoint:"users/self/authorized-contacts",directorySearchEndpointSkypeOnly:"search/users/any?keyWord=${keyword}&contactTypes[]=skype",directorySearchEndpoint:"search/users/any?keyWord=${keyword}",directorySearchByIdEndpoint:"search/users?skypename=${skypeName}",firstContactRequestDelay:1e4,host:"https://api.skype.com/",myContactsEndpoint:"users/self/contacts?hideDetails=true",profileEndpoint:"users/self/profile",profilesEndpoint:"users/self/contacts/profiles",batchProfilesEndpoint:"users/batch/profiles",userInfoEndpoint:"users/self",unblockContactEndpoint:"users/self/contacts/${contactId}/unblock",deleteContactEndpoint:"users/self/contacts/${contactId}",retry:n},contactsProxyService:{blockContactEndpoint:"contacts/${version}/users/${id}/contacts/${contactType}/${contactId}/block",unblockContactEndpoint:"contacts/${version}/users/${id}/contacts/${contactType}/${contactId}/unblock",deleteContactEndpoint:"contacts/${version}/users/${id}/contacts/${contactType}/${contactId}",host:"https://contacts.skype.com/",myContactsEndpoint:"contacts/${version}/users/${id}/contacts?$filter=type eq 'skype' or type eq 'msn' or type eq 'pstn' or type eq 'agent' or type eq 'lync'&reason=${reason}",myDeltaContactsEndpoint:"contacts/${version}/users/${id}/contacts?delta&$filter=type eq 'skype' or type eq 'msn' or type eq 'pstn' or type eq 'agent' or type eq 'lync'&reason=${reason}",retry:n},entitlementService:{host:"https://consumer.entitlement.skype.com/",listingEndpoint:"/users/${username}/services",serviceEndpoint:"/users/${username}/services/${service}",retry:n},peopleService:{appId:"5c7a1e34-3a23-4a36-b2e6-7aa15be85f07",host:"https://people.directory.live-int.com/",settingsEndpoint:"people/account/settings"},profileService:{appId:"5c7a1e34-3a23-4a36-b2e6-7aa15be85f07",host:"https://pf.directory.live-int.com/",profileEndpoint:"profile/mine/System.ShortCircuitProfile.json"},pnvService:{host:"https://a.qalogin.skype.net/",pnvEndpoint:"shortcircuit/phonenumberverification",finishEndpoint:"finish",clientId:"580081"},commerce:{purchaseCreditUrl:"https://go.skype.com/store.buy.skypecredit",purchaseSubscriptionUrl:"https://go.skype.com/rates"},userOptionsService:{host:"https://api.skype.com",optionsEndpoint:"/users/${userId}/options/${optionName}"},messageSearchService:{host:"https://scsquerycontroltower.cloudapp.net/",endpoints:{query:"v1/query"}},controls:{sidebar:"Sidebar",content:"Content",me:"Me"},plugin:{pingHeartBeatTimeout:5e3,loadDelayMilisec:250,maxTotalLoadDelayMilisec:6e5,manifestKey:"SkypePluginManifestProd",ecsService:"prod",download:{msi:"https://swx.cdn.skype.com/plugin/SkypeWebPlugin.msi",pkg:"https://swx.cdn.skype.com/plugin/SkypeWebPlugin.pkg",minVersion:"7.0.0.5",maxVersion:"99.99.99.99"}},pluginless:{conversationServiceUrl:"https://api.conv.skype.com/conv/",mediaAgent:{numVideoChannelsGvc:10,renegotiationAttempts:3,sdes:!0},allowedEdgeVersion:{lowerBound:13,upperBound:13}},featureFlags:{agentsDiscoverable:!1,agentsEnabled:!1,contactsServiceV2:!1,showAgentIdOnProfile:!1,showAgentRatingOnProfile:!1,newChat:!1,pinningToDogfoodCloud:!1,pluginAutoUpdate:!1,resizeCallAndChat:!1,calling:!0,NGCalling:!1,GVCEscalation:!1,GVCLocalEscalation:!1,GVCJoining:!1,GVCOutgoing:!1,PSTN:!1,CQF:!1,creditBalanceAutoUpdateEnabled:!1,persistentPlugin:!1,persistentShellApp:!1,contactListChangeNotification:!1,deactivateCache:!1,preloadPlugin:!1,preloadShellApp:!1,skypeDirectorySearch:!1,muteNotifications:!1,muteNotificationsWithClosedSidebar:!1,notifyHostEvenWhenMeNotAvailable:!1,newConversationV2:!1,spaces:!1,lastSeen:!1,mobileIndicator:!1,mobileActive:!1,hasBetaLabel:!1,hasFeedbackLink:!1,hasFeedbackLinkOnError:!1,hasFeedbackIcon:!1,hasTimelineBadge:!1,showContactsPageHint:!1,showContactsPageInformationalMessage:!1,contactProfile:!1,deleteContactUsingContactsService:!1,includeSelfInParticipantsCount:!1,showAlternateShareDialogExperience:!1,pluginlessCallingFirefox:!1,pluginlessCallingChrome:!1,pluginlessCallingEdge:!1,pluginlessCallingElectron:!1,pluginlessCallingChromeLinux:!1,silentLinking:!1,autoCalling:!1,showDefaultAvatarInNotifications:!1,showSearchQueryMoreResultsAvailable:!1,contactProfileCache:!1,directorySearchSkypeAndLync:!1,presenceDataCache:!1,newSelfPresence:!1,batchProfilesV2:!1,contactPageFilterTabs:!1,doNotSendContactsToChatService:!1,supportStandbyMode:!1,disablePollingOnKahuna:!1,swiftCardCommand:!1,swiftCardRendering:!1,reAuthEnabled:!1,hideSidebarOnStart:!1,messageEnforceTextFormat:!1,useBusinessWording:!1,removeConversationHistory:!1,disableLeaveConversation:!1,showContactsPageSignIn:!1,hideConversationHeader:!1,headerControlsDisabled:!1,singleConversationMode:!1,skipChatCapabilityCheck:!1,disablePersistentContactPresenceSubscription:!1,enableBusinessContactManagement:!1,enableBusinessPresenceMapping:!1,issueReporting:!1,callInfoCommand:!1,serviceFailureReporting:!1,skypeDataTelemetry:!1,shellAppLogs:!1,consoleLogging:!1,errorLogReporting:!1,enableUnreadMessagesLogging:!1,contextMenuQuoteMessagesEnabled:!1,contextMenuSaveVideoMessagesEnabled:!1,alternativeSidebarLayout:!1,skypeCallPolicySupport:!1,skypeVideoCallingPolicySupport:!1,spaceTopicEditor:!1,userSettingsEnabled:!1,showUnlistedSettings:!1,aboutPageEnabled:!1,inviteFree:!1,inviteFreeImplicitIncomingContactRequest:!1,shortCircuit:!1,pesCDNAuthUrlFallbackEnabled:!1,pesFetchSmallAssetsOnDemand:!1,pesFetchMediumAssetsOnDemand:!1,pesFetchLargeAssetsOnDemand:!1,pesFetchMojiAssetsOnDemand:!1,pesCDNAuthEnabled:!1,pesUseExtraLargeEmoticons:!1,hideEmoticonPickerButton:!1,pesBingImageSearchEnabled:!1,pesGiphyImageSearchEnabled:!1,pesLocalSearchEnabled:!1,pesV2Enabled:!1,emoticonSuggestionEnabled:!1,emoticonImplicitSuggestionDisabled:!1,suggestHiddenEmoticons:!1,pesStoreEnabled:!1,urlPreviews:!1,youtubePlayer:!1,urlPreviewLoadYoutubePlayer:!1,incomingScreenSharing:!1,outgoingScreenSharing:!1,incomingWikiMarkup:!1,isCloudVideoMessageEnabled:!1,isFlikMessageEnabled:!1,newUrlPreviewDomainEnabled:!1,contactCardRenderingEnabled:!1,sendContactCardEnabled:!1,aggressiveImplicitMentionsMatching:!1,enableAggressiveMentionsToast:!1,mentionsEnabled:!1,notificationsCenter:!1,supportMessageProperties:!1,enablePingEcsConfig:!0,enableEndpointEcsConfig:!0,heartsEnabled:!1,heartsNotificationEnabled:!1,showChatIntroText:!1,pollsEnabled:!1,translatorSendingEnabled:!1,photoSharingEnabled:!1,fileTransferEnabled:!1,mediaBarEnabled:!1,fileDragDropEnabled:!1,filePasteEnabled:!1,showMessageDeliveryIndicator:!1,showMessageDeliveryStatus:!1,readReceiptEnabled:!1,isTypingIndicator:!1,showWhenIamTyping:!1,creditGifting:!1,failInitializationOnIE:!1,searchEducationBubble:!1,searchEducationBubbleBusiness:!1,callEducationBubble:!1,chatEducationBubble:!1,chatEducationBubbleBusiness:!1,scheduleCallEducationBubble1:!1,scheduleCallEducationBubble2:!1,scheduleCallFromConversation:!1,useLegacySchedulerUriFormat:!1,welcomeDialog:!1,useAzureBasedSilentLogin:!1,enableRawEmoticonsRendering:!1,contentSearch:!1,giphy:!1,telemetrySearchEnabled:!1,uiActionPerfTelemetryEnabled:!1,runtimeErrorsTelemetryEnabled:!1,keyEncryptionServiceV2Enabled:!1,navigationMenuIconsEnabled:!1,favoritesConversationsEnabled:!1,syncThreadBeforeJoinConversationEnabled:!1},retry:n,webApiService:{retry:{limit:5,delay:100,strategy:"exponential"},overrides:{ping:{strategy:"fixed"}},pingDelayTime:{min:30,max:60},endpointRetry:{base:5,limit:120,noiseFactor:0},standbyPollingDelayTime:{min:30,max:30}},giphy:{apiKey:"dc6zaTOxFJmzC",rating:"pg-13"},activeSpeaker:{tickInterval:100,timeToPromote:3e3,timeToDemote:3e3,ticksToCancel:3,recentlySpokenTimeout:2e4},contactsPageInformationalMessage:{key:"",link:""},conversationHistoryPageSize:30,incomingCalls:{notificationTimeout:3e4,trouterServiceUrl:"https://go.trouter.io/v2/a",tpcServiceUrl:"https://prod.tpc.skype.com/v1/policies",registrarServiceUrl:"https://prod.registrar.skype.com/v2/registrations",registrarTtlInSeconds:3600,registrarRefreshTimeoutInMs:354e4,trouterReadyTimeoutInMs:2e4,trouterConnectTimeoutInMs:1e4,maxRegistrationTimeInMs:864e5,pnhAppId:"skype",pnhTemplate:"SkypeWeb_1.3",pnhNGCTemplate:"SkypeWebNGC_1.3",p2pToNgcNotificationTimeout:2e3},telemetry:{uiTenantToken:"bb15b8f2b7f446d4af2e245fc3b07e79-31d92fdb-e7a5-4be8-b14f-c48048f67a59-7685",jSkypeTenantToken:"bb15b8f2b7f446d4af2e245fc3b07e79-31d92fdb-e7a5-4be8-b14f-c48048f67a59-7685",skypeConcoreToken:"53fdaa090eb946b5a1d6cbdeb4f2ef66-bcbf6380-2590-41cc-ae60-9e467cd51835-7413",mdscToken:"695e6c4def6c4847b178d16c83b926c4-51ac8017-8fbb-4069-9bf4-3e9cc75ebad8-7393",logReportingToken:"695e6c4def6c4847b178d16c83b926c4-51ac8017-8fbb-4069-9bf4-3e9cc75ebad8-7393",logThrottleInterval:1e4,issueReportUrl:"",issueReportScript:"",upnCorrelationIdEnabled:!1},serviceQosReporter:{iterationCountBeforeFlushingQoSMetrics:50},URLSanitizer:{securedResources:{allowedDomains:["**.skypeassets.com","**.skype.com"],allowedProtocols:["http","https"]}},initParams:t,pesCDNAuthentication:{skypeServiceHost:"static.asm.skype.com",tokenSourceEndpoint:"/pes/v1/petoken",cdnServiceHost:"static-asm.secure.skypeassets.com",cookieSourceEndpoint:"/token/token_to_cookies",securedPathsPattern:"static[.]asm[.]skype[.]com",cdnTokenTtlMs:3e5,rewriteRules:[{from:"static.asm.skype.com",to:"static-asm.secure.skypeassets.com"},{from:"api.asm.skype.com",to:"static-asm.secure.skypeassets.com"}]},pesSearchServices:{bingApiKey:"aGt3dUhqZkFrbnZyU2doM1FqQ0RPQUdEUTFTbzNqc0FmYlFWMEFSSytMVTpoa3d1SGpmQWtudnJTZ2gzUWpDRE9BR0RRMVNvM2pzQWZiUVYwQVJLK0xV",bingAuthMethod:"Basic",bingServiceURL:"https://api.datamarket.azure.com/Bing/Search/v1/Image",bingTriggerWords:["bing","meme","gif"],bingDefaultSearchTerm:"popular",bingPickFirst:"gif",bingMergeItems:!0,bingBorderStyle:"thin",giphy:{withQuerySources:["translate","random","search"],withoutQuerySources:["trending"],serviceUrl:"https://api.giphy.com",apiKey:"dc6zaTOxFJmzC",rating:"pg-13"},localSearchCategories:["Greetings","Happy","Love","Angry","Confused","Disgust"],localSearchGroupByType:!0},pesPicker:{useSelectedTabIconForPicker:!1,tabPlacementOverrides:{bing:-1,giphyImages:1}},pesStoreServices:{catalogApiHost:"apps.skypeassets.com",catalogServiceEndpoint:"/personal-expression?expansion=full&language=${lang}",catalogItemByIdServiceEndpoint:"/offers/sticker-pack/skus/${offerId}",catalogPurchaseEndpoint:"/purchase",catalogDogfoodContentEnabled:!1,catalogPurchaseApiHost:"api.skype.com",catalogServiceVersion:"3.0",catalogPurchaseApiVersion:"1.0"},splashScreen:{learnMoreUrl:"",signInNotificationEnabled:!1},authentication:{anonymousMode:!1},messageFilters:{outgoingMessageFilter:null,chatLogMessageFilter:null},xcoEnv:"qa",translatorClientAppId:"FF63883DDDED40068EC45030A601460C",translatorServiceURI:{TRANSLATE:"https://dev.microsofttranslator.com/api/skype/translate",LANGUAGES:"https://dev.microsofttranslator.com/api/languages"},userSettings:{hiddenCategories:[],hiddenPreferences:[],privacySettingsFetchTimeout:1e3},displayAppVersion:!1,cloudFileSharing:{unsafeFileTypes:".ade,.adp,.app,.asp,.bas,.bat,.cer,.chm,.cmd,.com,.cpl,.crt,.csh,.der,.exe,.fxp,.gadget,.hlp,.hta,.inf,.ins,.isp,.its,.js,.jse,.ksh,.lnk,.mad,.maf,.mag,.mam,.maq,.mar,.mas,.mat,.mau,.mav,.maw,.mda,.mdb,.mde,.mdt,.mdw,.mdz,.msc,.msh,.msh1,.msh2,.mshxml,.msh1xml,.msh2xml,.msi,.msp,.mst,.ops,.pcd,.pif,.plg,.prf,.prg,.pst,.reg,.scf,.scr,.sct,.shb,.shs,.ps1,.ps1xml,.ps2,.ps2xml,.psc1,.psc2,.tmp,.url,.vb,.vbe,.vbs,.vsmacros,.vsw,.ws,.wsc,.wsf,.wsh,.xnk"}};return r}),define("browser/dom",["require","exports","module","lodash-compat","browser/document","browser/window"],function(e,t){function o(e){return Boolean(e&&e.nodeType===1)}function u(e){return!(!e||!n.isString(e.tagName)&&!n.isString(e.nodeName))}function a(e,t){return n.isElement(e)?e.tagName.toLowerCase()===t:!1}function f(e){return Boolean(e.offsetParent)}function l(e,t){while(e&&!E(e,t))e=e.parentNode;return e}function c(e,t){while(e&&!h(e,t))e=e.parentNode;return e}function h(e,t){var n=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector;return n?n.call(e,t):!1}function p(e){return n.isString(e)?T(r.createElement(e)):null}function d(e){return n.isString(e)?T(r.querySelector(e)):null}function v(e,t){return t=t||r,n.isString(e)?T(t.querySelector(e)):u(e)?T(e):null}function m(e,n){return e?t.getElement("#"+e,n):null}function g(e,t,n){n?S(e,t):x(e,t)}function y(e,t){t=t||r;var n=t.querySelectorAll(e);return Array.prototype.slice.call(n,0)}function b(e,t){return t?e.previousSibling:e.nextSibling}function w(e){return y(['[tabindex]:not([tabindex=""]):not([tabindex="-1"]):not([disabled])'],e)}function E(e,t){if(e.classList)return e.classList.contains(t);var n=e.className?e.className.split(" "):[];for(var r=0;r<n.length;r++)if(n[r]===t)return!0;return!1}function S(e,t){if(!n.isString(t))return;if(e.classList){e.classList.add(t);return}var r=" "+e.className+" ";r.indexOf(t)<0&&(r+=t+" "),e.className=r.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function x(e,t){if(e.classList){e.classList.remove(t);return}e.className=e.className.replace(t,"").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function T(e){return e!==null&&(e.removeClass=function(t){x(e,t)},e.addClass=function(t){S(e,t)},e.hasClass=function(t){return E(e,t)},e.setClass=function(t,n){g(e,t,n)}),e}function N(e,t){var n,r=i.MutationObserver||i.WebKitMutationObserver;return r?(n=new r(function(e){e&&e[0]&&(e[0].addedNodes&&e[0].addedNodes.length||e[0].removedNodes&&e[0].removedNodes.length)&&t()}),n.observe(e,{childList:!0,subtree:!0})):e.addEventListener("DOMSubtreeModified",t,!1),{dispose:function(){r?n.disconnect():e.removeEventListener("DOMSubtreeModified",t)}}}function C(e){var t={offsetLeft:0,offsetTop:0};while(e)t.offsetLeft+=e.offsetLeft+e.clientLeft-e.scrollLeft,t.offsetTop+=e.offsetTop+e.clientTop-e.scrollTop,e=e.offsetParent;return t}function k(e,t){var n=e;while(n&&!n.contains(t))n=n.parentNode;return n}function L(e){var t=e.lastChild;while(t&&t.nodeType!==s)t=t.previousSibling;return t}function A(){return r.hidden}var n=e("lodash-compat"),r=e("browser/document"),i=e("browser/window"),s=1;t.createElement=p,t.findElement=d,t.isElement=o,t.getElement=v,t.getElementById=m,t.getElements=y,t.getSibling=b,t.getNavigableChildren=w,t.isA=a,t.isVisible=f,t.hasClass=E,t.getParentWithClass=l,t.getParentMatching=c,t.addClass=S,t.setClass=g,t.removeClass=x,t.extendObject=T,t.createDomObserverSubscription=N,t.getElementOffset=C,t.findFirstCommonAncestor=k,t.getLastChildElement=L,t.isDocumentHidden=A}),define("ui/appOverlay/appOverlay",["require","exports","module","browser/document","browser/dom","constants/common","services/serviceLocator"],function(e,t){function f(){if(!o){var e,t=s.resolve(i.serviceLocator.CONTROLS_BUILDER);t.registeredElements.length?e=n.querySelector(t.registeredElements[0].element):e=n.querySelector("body"),o=e.parentNode}u=r.createElement("div"),u.id=a,o.appendChild(u)}function l(){o.removeChild(n.querySelector("#"+a)),u=null,o=undefined}var n=e("browser/document"),r=e("browser/dom"),i=e("constants/common"),s=e("services/serviceLocator"),o=null,u=null,a="swx-app-overlay";t.create=function(e){return u||f(),e&&e.content&&u.appendChild(e.content),e&&e.className&&u.classList.add(e.className),u},t.destroy=function(){l()}});var clienttelemetry_build;(function(e){e.version="2.4.0"})(clienttelemetry_build||(clienttelemetry_build={}));var Microsoft;(function(e){(function(e){(function(e){e[e.BT_STOP=0]="BT_STOP",e[e.BT_STOP_BASE=1]="BT_STOP_BASE",e[e.BT_BOOL=2]="BT_BOOL",e[e.BT_UINT8=3]="BT_UINT8",e[e.BT_UINT16=4]="BT_UINT16",e[e.BT_UINT32=5]="BT_UINT32",e[e.BT_UINT64=6]="BT_UINT64",e[e.BT_FLOAT=7]="BT_FLOAT",e[e.BT_DOUBLE=8]="BT_DOUBLE",e[e.BT_STRING=9]="BT_STRING",e[e.BT_STRUCT=10]="BT_STRUCT",e[e.BT_LIST=11]="BT_LIST",e[e.BT_SET=12]="BT_SET",e[e.BT_MAP=13]="BT_MAP",e[e.BT_INT8=14]="BT_INT8",e[e.BT_INT16=15]="BT_INT16",e[e.BT_INT32=16]="BT_INT32",e[e.BT_INT64=17]="BT_INT64",e[e.BT_WSTRING=18]="BT_WSTRING",e[e.BT_UNAVAILABLE=127]="BT_UNAVAILABLE"})(e.BondDataType||(e.BondDataType={}));var t=e.BondDataType;(function(e){e[e.MARSHALED_PROTOCOL=0]="MARSHALED_PROTOCOL",e[e.MAFIA_PROTOCOL=17997]="MAFIA_PROTOCOL",e[e.COMPACT_PROTOCOL=16963]="COMPACT_PROTOCOL",e[e.JSON_PROTOCOL=21322]="JSON_PROTOCOL",e[e.PRETTY_JSON_PROTOCOL=20554]="PRETTY_JSON_PROTOCOL",e[e.SIMPLE_PROTOCOL=20563]="SIMPLE_PROTOCOL"})(e.ProtocolType||(e.ProtocolType={}));var n=e.ProtocolType})(e.Bond||(e.Bond={}));var t=e.Bond})(Microsoft||(Microsoft={}));var Microsoft;(function(e){(function(e){(function(e){var t=function(){function e(){this._buffer=[]}return e.prototype.Add=function(e){var t=0;for(;t<this._buffer.length;++t)if(this._buffer[t]==e)break;t==this._buffer.length&&this._buffer.push(e)},e.prototype.Count=function(){return this._buffer.length},e.prototype.GetBuffer=function(){return this._buffer},e}();e.Set=t;var n=function(){function e(){this._buffer=[]}return e.prototype.Add=function(e,t){this._getIndex(e)==-1&&this._buffer.push({Key:e,Value:t})},e.prototype.AddOrReplace=function(e,t){var n=this._getIndex(e);n>=0?this._buffer[n]={Key:e,Value:t}:this._buffer.push({Key:e,Value:t})},e.prototype.Remove=function(e){var t=this._getIndex(e);t>=0&&this._buffer.splice(t,1)},e.prototype.Count=function(){return this._buffer.length},e.prototype.GetBuffer=function(){return this._buffer},e.prototype.ContainsKey=function(e){return this._getIndex(e)>=0?!0:!1},e.prototype.Get=function(e){var t=this._getIndex(e);return t>=0?this._buffer[t].Value:null},e.prototype._getIndex=function(e){var t=0,n=-1;for(;t<this._buffer.length;++t)if(this._buffer[t].Key==e){n=t;break}return n},e}();e.Map=n})(e.Collections||(e.Collections={}));var t=e.Collections})(e.Bond||(e.Bond={}));var t=e.Bond})(Microsoft||(Microsoft={}));var Microsoft;(function(e){(function(t){(function(e){var n=function(){function e(){}return e.GetBytes=function(e){var t=[];for(var n=0;n<e.length;++n){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?t.push(192|r>>6,128|r&63):r<55296||r>=57344?t.push(224|r>>12,128|r>>6&63,128|r&63):(r=65536+((r&1023)<<10|e.charCodeAt(++n)&1023),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63))}return t},e}();e.Utf8=n;var r=function(){function e(){}return e.GetString=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=[],r=e.length%3,i,s,o,u=function(e){return[t.charAt(e>>18&63),t.charAt(e>>12&63),t.charAt(e>>6&63),t.charAt(e&63)].join("")};for(i=0,o=e.length-r;i<o;i+=3)s=(e[i]<<16)+(e[i+1]<<8)+e[i+2],n.push(u(s));switch(r){case 1:s=e[e.length-1],n.push(t.charAt(s>>2)),n.push(t.charAt(s<<4&63)),n.push("==");break;case 2:s=(e[e.length-2]<<8)+e[e.length-1],n.push(t.charAt(s>>10)),n.push(t.charAt(s>>4&63)),n.push(t.charAt(s<<2&63)),n.push("=")}return n.join("")},e}();e.Base64=r;var s=function(){function e(){}return e.GetBytes=function(e){var t=[];while(e&4294967168)t.push(e&127|128),e>>>=7;return t.push(e&127),t},e}();e.Varint=s;var o=function(){function e(){}return e.GetBytes=function(e){var t=e.low,n=e.high,r=[];while(n||4294967168&t)r.push(t&127|128),t=(n&127)<<25|t>>>7,n>>>=7;return r.push(t&127),r},e}();e.Varint64=o;var u=function(){function e(){}return e.GetBytes=function(e){if(t.BrowserChecker.IsDataViewSupport()){var n=new DataView(new ArrayBuffer(4));n.setFloat32(0,e,!0);var r=[];for(var s=0;s<4;++s)r.push(n.getUint8(s));return r}return i.ConvertNumberToArray(e,!1)},e}();e.Float=u;var a=function(){function e(){}return e.GetBytes=function(e){if(t.BrowserChecker.IsDataViewSupport()){var n=new DataView(new ArrayBuffer(8));n.setFloat64(0,e,!0);var r=[];for(var s=0;s<8;++s)r.push(n.getUint8(s));return r}return i.ConvertNumberToArray(e,!0)},e}();e.Double=a;var f=function(){function e(){}return e.EncodeZigzag16=function(e){return e=t.Number.ToInt16(e),e<<1^e>>15},e.EncodeZigzag32=function(e){return e=t.Number.ToInt32(e),e<<1^e>>31},e.EncodeZigzag64=function(e){var n=e.low,r=e.high,i=r<<1|n>>>31,s=n<<1;r&2147483648&&(i=~i,s=~s);var o=new t.UInt64("0");return o.low=s,o.high=i,o},e}();e.Zigzag=f})(t.Encoding||(t.Encoding={}));var n=t.Encoding;(function(n){var r=function(){function e(){}return e.GetString=function(e){var t=[];for(var n=0;n<e.length;++n){var r=e[n];if(r<=191)t.push(String.fromCharCode(r));else if(r<=223){var i=e[++n];t.push(String.fromCharCode((r&31)<<6|i&63))}else if(r<=239){var i=e[++n],s=e[++n];t.push(String.fromCharCode((r&15)<<12|(i&63)<<6|s&63))}else{var i=e[++n],s=e[++n],o=e[++n];r=(r&7)<<18|(i&63)<<12|(s&63)<<6|o&63,r-=65536,t.push(String.fromCharCode(55296|r>>10&1023)),t.push(String.fromCharCode(56320|r&1023))}}return t.join("")},e}();n.Utf8=r;var s=function(){function e(){}return e.GetBytes=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=[];for(var r=0;r<e.length;++r){var i=t.indexOf(e.charAt(r++)),s=t.indexOf(e.charAt(r++)),o=t.indexOf(e.charAt(r++)),u=t.indexOf(e.charAt(r));n.push(i<<2|s>>4),o>=0&&(n.push(s<<4&240|o>>2),u>=0&&n.push(o<<6&192|u))}return n},e}();n.Base64=s;var o=function(){function t(){}return t.GetInt64=function(t){var n=new e.Bond.Int64("0"),r=this._Read(t);return n.low=r[0],r.length>1&&(n.high=r[1]),n},t.GetNumber=function(e){return this._Read(e)[0]},t._Read=function(e){var t=[],n=0,r=!0,i=0;while(r){var s=e.shift();r=(s&128)!=0,s&=127;if(!(i<28)){n|=s<<i,t.push(n),n=s>>4,i=3;break}n|=s<<i,i+=7}while(r){var s=e.shift();r=(s&128)!=0,s&=127,n|=s<<i,i+=7;if(i>=32)break}return t.push(n),t},t}();n.Varint=o;var u=function(){function e(){}return e.GetNumber=function(e){if(t.BrowserChecker.IsDataViewSupport()){var n=new DataView(new ArrayBuffer(4));for(var r=0;r<4;++r)n.setUint8(r,e[r]);return n.getFloat32(0,!0)}return i.ConvertArrayToNumber(e,!1)},e}();n.Float=u;var a=function(){function e(){}return e.GetNumber=function(e){if(t.BrowserChecker.IsDataViewSupport()){var n=new DataView(new ArrayBuffer(8));for(var r=0;r<8;++r)n.setUint8(r,e[r]);return n.getFloat64(0,!0)}return i.ConvertArrayToNumber(e,!0)},e}();n.Double=a;var f=function(){function t(){}return t.DecodeZigzag16=function(e){return((65535&e)>>>1^-(e&1))<<16>>16},t.DecodeZigzag32=function(e){return e>>>1^-(e&1)},t.DecodeZigzag64=function(t){var n=t.high&1,r=t.high>>>1,i=t.low&1,s=t.low>>>1;s=n<<31|s,i&&(s^=4294967295,r^=4294967295);var o=new e.Bond.UInt64("0");return o.low=s,o.high=r,o},t}();n.Zigzag=f})(t.Decoding||(t.Decoding={}));var r=t.Decoding,i=function(){function e(){}return e.ConvertNumberToArray=function(e,t){if(!e)return t?this._doubleZero:this._floatZero;var n=t?11:8,r=t?52:23,i=(1<<n-1)-1,s=1-i,o=i,u=e<0?1:0;e=Math.abs(e);var a=Math.floor(e),f=e-a,l=2*(i+2)+r,c=new Array(l),h=0;while(h<l)c[h++]=0;h=i+2;while(h&&a)c[--h]=a%2,a=Math.floor(a/2);h=i+1;while(h<l-1&&f>0)f*=2,f>=1?(c[++h]=1,--f):c[++h]=0;var p=0;for(;p<l&&!c[p];++p);var d=i+1-p,v=p+r;if(c[v+1]){for(h=v;h>p;--h)if(c[h]=1-c[h])break;h==p&&++d}if(d>o||a)return u?t?this._doubleNegInifinity:this._floatNegInifinity:t?this._doubleInifinity:this._floatInifinity;if(d<s)return t?this._doubleZero:this._floatZero;if(t){var m=0;for(h=0;h<20;++h)m=m<<1|c[++p];var g=0;for(;h<52;++h)g=g<<1|c[++p];m|=d+i<<20,m=u<<31|m&2147483647;var y=[g&255,g>>8&255,g>>16&255,g>>>24,m&255,m>>8&255,m>>16&255,m>>>24];return y}var b=0;for(h=0;h<23;++h)b=b<<1|c[++p];b|=d+i<<23,b=u<<31|b&2147483647;var y=[b&255,b>>8&255,b>>16&255,b>>>24];return y},e.ConvertArrayToNumber=function(e,n){var r=n?11:8,i=(1<<r-1)-1,s=(e[n?7:3]&128)!=0,o=n?(e[7]&127)<<4|(e[6]&240)>>4:(e[3]&127)<<1|(e[2]&128)>>7;if(o==255)throw new t.Exception("Not a valid float/double buffer.");var u=1,a=1;if(n){var f=(e[6]&15)<<28|(e[5]&255)<<20|(e[4]&255)<<12,l=e[3]<<24|(e[2]&255)<<16|(e[1]&255)<<8|e[0]&255;if(!o&&!f&&!l)return 0;for(var c=0;c<20;++c)a/=2,f<0&&(u+=a),f<<=1;for(var c=0;c<32;++c)a/=2,l<0&&(u+=a),l<<=1}else{var h=(e[2]&127)<<25|(e[1]&255)<<17|(e[0]&255)<<9;if(!o&&!h)return 0;for(var c=0;c<23;++c)a/=2,h<0&&(u+=a),h<<=1}return u*=Math.pow(2,o-i),s?0-u:u},e._floatZero=[0,0,0,0],e._doubleZero=[0,0,0,0,0,0,0,0],e._floatInifinity=[0,0,128,127],e._floatNegInifinity=[0,0,128,255],e._doubleInifinity=[0,0,0,0,0,0,240,127],e._doubleNegInifinity=[0,0,0,0,0,0,240,255],e}()})(e.Bond||(e.Bond={}));var t=e.Bond})(Microsoft||(Microsoft={}));var Microsoft;(function(e){(function(e){(function(t){var n=function(){function t(){this._buffer=[]}return t.prototype.WriteByte=function(t){this._buffer.push(e.Number.ToByte(t))},t.prototype.Write=function(e,t,n){while(n--)this.WriteByte(e[t++])},t.prototype.GetBuffer=function(){return this._buffer},t}();t.MemoryStream=n})(e.IO||(e.IO={}));var t=e.IO})(e.Bond||(e.Bond={}));var t=e.Bond})(Microsoft||(Microsoft={}));var Microsoft;(function(e){(function(e){var t=function(){function e(e,t){this.Type=e,this.Id=t}return e}();e.FieldTag=t;var n=function(){function e(e,t){this.ElementType=e,this.Size=t}return e}();e.ContainerTag=n;var r=function(){function e(e,t,n){this.KeyType=e,this.ValueType=t,this.Size=n}return e}();e.KeyValueContainerTag=r;var i=function(){function e(){}return e}();e.Bonded=i;var s=function(){function e(e){this.low=0,this.high=0,this.low=parseInt(e),this.low<0&&(this.high=-1)}return e.prototype.Equals=function(t){var n=new e(t);return this.low==n.low&&this.high==n.high},e}();e.Int64=s;var o=function(){function e(e){this.low=0,this.high=0,this.low=parseInt(e)}return e.prototype.Equals=function(t){var n=new e(t);return this.low==n.low&&this.high==n.high},e}();e.UInt64=o;var u=function(){function e(){}return e.ToByte=function(e){return this.ToUInt8(e)},e.ToInt8=function(e){var t=(e&128)<<24>>24;return e&127|t},e.ToInt16=function(e){var t=(e&32768)<<16>>16;return e&32767|t},e.ToInt32=function(e){var t=e&2147483648;return e&2147483647|t},e.ToUInt8=function(e){return e&255},e.ToUInt16=function(e){return e&65535},e.ToUInt32=function(e){return e&4294967295},e}();e.Number=u;var a=function(){function e(e){this.Message=e}return e}();e.Exception=a;var f=function(){function e(){}return e}();e.KeyValuePair=f;var l=function(){function e(){}return e.IsDataViewSupport=function(){return typeof ArrayBuffer!="undefined"&&typeof DataView!="undefined"},e}();e.BrowserChecker=l})(e.Bond||(e.Bond={}));var t=e.Bond})(Microsoft||(Microsoft={}));var Microsoft;(function(e){(function(e){var t=function(){function t(e){this._stream=e}return t.prototype.WriteBlob=function(e){this._stream.Write(e,0,e.length)},t.prototype.WriteBool=function(e){this._stream.WriteByte(e?1:0)},t.prototype.WriteContainerBegin=function(e,t){this.WriteUInt8(t),this.WriteUInt32(e)},t.prototype.WriteMapContainerBegin=function(e,t,n){this.WriteUInt8(t),this.WriteUInt8(n),this.WriteUInt32(e)},t.prototype.WriteContainerEnd=function(){},t.prototype.WriteDouble=function(t){var n=e.Encoding.Double.GetBytes(t);this._stream.Write(n,0,n.length)},t.prototype.WriteFloat=function(t){var n=e.Encoding.Float.GetBytes(t);this._stream.Write(n,0,n.length)},t.prototype.WriteFieldBegin=function(e,t,n){t<=5?this._stream.WriteByte(e|t<<5):t<=255?(this._stream.WriteByte(e|192),this._stream.WriteByte(t)):(this._stream.WriteByte(e|224),this._stream.WriteByte(t),this._stream.WriteByte(t>>8))},t.prototype.WriteFieldEnd=function(){},t.prototype.WriteFieldOmitted=function(e,t,n){},t.prototype.WriteInt16=function(t){t=e.Encoding.Zigzag.EncodeZigzag16(t),this.WriteUInt16(t)},t.prototype.WriteInt32=function(t){t=e.Encoding.Zigzag.EncodeZigzag32(t),this.WriteUInt32(t)},t.prototype.WriteInt64=function(t){this.WriteUInt64(e.Encoding.Zigzag.EncodeZigzag64(t))},t.prototype.WriteInt8=function(t){this._stream.WriteByte(e.Number.ToInt8(t))},t.prototype.WriteString=function(t){if(t=="")this.WriteUInt32(0);else{var n=e.Encoding.Utf8.GetBytes(t);this.WriteUInt32(n.length),this._stream.Write(n,0,n.length)}},t.prototype.WriteStructBegin=function(e,t){},t.prototype.WriteStructEnd=function(e){this.WriteUInt8(e?1:0)},t.prototype.WriteUInt16=function(t){var n=e.Encoding.Varint.GetBytes(e.Number.ToUInt16(t));this._stream.Write(n,0,n.length)},t.prototype.WriteUInt32=function(t){var n=e.Encoding.Varint.GetBytes(e.Number.ToUInt32(t));this._stream.Write(n,0,n.length)},t.prototype.WriteUInt64=function(t){var n=e.Encoding.Varint64.GetBytes(t);this._stream.Write(n,0,n.length)},t.prototype.WriteUInt8=function(t){this._stream.WriteByte(e.Number.ToUInt8(t))},t.prototype.WriteWString=function(e){this.WriteUInt32(e.length);for(var t=0;t<e.length;++t){var n=e.charCodeAt(t);this._stream.WriteByte(n),this._stream.WriteByte(n>>>8)}},t}();e.CompactBinaryProtocolWriter=t;var n=function(){function e(){}return e}();e.CompactBinaryProtocolReader=n})(e.Bond||(e.Bond={}));var t=e.Bond})(Microsoft||(Microsoft={}));var sct;(function(e){var t=function(){function e(){}return e.IsSafari=function(){return e._isSafari===null&&e._DetectBrowser(),e._isSafari},e.ajax=function(t){var n=e._createConnection();if(t.headers){var r="qsp=true";for(var i in t.headers)r+="&",r+=encodeURIComponent(i),r+="=",r+=encodeURIComponent(t.headers[i]);t.url.indexOf("?")<0?t.url+="?":t.url+="&",t.url+=r}n.open(t.type,t.url),t.complete&&(n.onload=function(){typeof n.status=="undefined"&&(n.status=200),t.complete(n)},n.ontimeout=function(){typeof n.status=="undefined"&&(n.status=500),t.complete(n)},n.onerror=function(){t.complete(n)}),n.send(t.data)},e.keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},e.IsUsingXDomainRequest=function(){if(e._usingXDomainRequest==null){var t=new XMLHttpRequest;typeof t.withCredentials=="undefined"&&typeof XDomainRequest!="undefined"?e._usingXDomainRequest=!0:e._usingXDomainRequest=!1}return e._usingXDomainRequest},e._createConnection=function(){var t=new XMLHttpRequest;return e.IsUsingXDomainRequest()?new XDomainRequest:t},e._DetectBrowser=function(){var t=navigator.userAgent.toLowerCase();t.indexOf("safari")>=0&&t.indexOf("chrome")<0?e._isSafari=!0:e._isSafari=!1},e._isSafari=null,e._usingXDomainRequest=null,e}();e.Utils=t})(sct||(sct={}));var microsoft;(function(e){(function(e){(function(e){(function(t){var n=function(){function e(){}return e.GetGuid=function(){var e=function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1,5)};return[e(),e(),"-",e(),"-",e(),"-",e(),"-",e(),e(),e()].join("")},e.GetTimeStamp=function(){var e=(new Date).getTime(),t=new Microsoft.Bond.Int64("0");return t.low=e&4294967295,t.high=Math.floor(e/4294967296),t},e.GetTimeStampWithValue=function(e){var t=new Microsoft.Bond.Int64("0");return t.low=e&4294967295,t.high=Math.floor(e/4294967296),t},e}();t.utils=n,function(e){e[e.NotSet=0]="NotSet",e[e.Event=1]="Event",e[e.PerformanceCounter=2]="PerformanceCounter",e[e.Anomaly=3]="Anomaly",e[e.Prediction=4]="Prediction",e[e.TraceLog=5]="TraceLog",e[e.EventSourceLog=6]="EventSourceLog",e[e.HttpLog=7]="HttpLog",e[e.PerformanceCounterAzure=8]="PerformanceCounterAzure",e[e.PerformanceCounterGfs=9]="PerformanceCounterGfs"}(t.RecordType||(t.RecordType={}));var r=t.RecordType;(function(e){e[e.NotSet=0]="NotSet",e[e.O365=1]="O365",e[e.SkypeBI=2]="SkypeBI",e[e.SkypeData=3]="SkypeData"})(t.PIIScrubber||(t.PIIScrubber={}));var i=t.PIIScrubber;(function(e){e[e.NotSet=0]="NotSet",e[e.DistinguishedName=1]="DistinguishedName",e[e.GenericData=2]="GenericData",e[e.IPV4Address=3]="IPV4Address",e[e.IPv6Address=4]="IPv6Address",e[e.MailSubject=5]="MailSubject",e[e.PhoneNumber=6]="PhoneNumber",e[e.QueryString=7]="QueryString",e[e.SipAddress=8]="SipAddress",e[e.SmtpAddress=9]="SmtpAddress",e[e.Identity=10]="Identity",e[e.Uri=11]="Uri",e[e.Fqdn=12]="Fqdn",e[e.IPV4AddressLegacy=13]="IPV4AddressLegacy"})(t.PIIKind||(t.PIIKind={}));var s=t.PIIKind,o=function(){function e(){this.ScrubType=0,this.Kind=0,this.RawContent=""}return e.prototype.Write=function(e){this.WriteImpl(e,!1)},e.prototype.WriteImpl=function(e,t){e.WriteStructBegin(null,t),this.ScrubType!=0?(e.WriteFieldBegin(16,1,null),e.WriteInt32(this.ScrubType),e.WriteFieldEnd()):e.WriteFieldOmitted(16,1,null),this.Kind!=0?(e.WriteFieldBegin(16,2,null),e.WriteInt32(this.Kind),e.WriteFieldEnd()):e.WriteFieldOmitted(16,2,null),this.RawContent!=""?(e.WriteFieldBegin(9,3,null),e.WriteString(this.RawContent),e.WriteFieldEnd()):e.WriteFieldOmitted(9,3,null),e.WriteStructEnd(t)},e.prototype.Read=function(e){this.ReadImpl(e,!1)},e.prototype.ReadImpl=function(e,t){},e}();t.PII=o;var u=function(){function t(){this.Id=n.GetGuid(),this.Timestamp=n.GetTimeStamp(),this.Type="",this.EventType="",this.Extension=new Microsoft.Bond.Collections.Map,this.RecordType=0,this.PIIExtensions=new Microsoft.Bond.Collections.Map}return t.prototype.AddOrReplacePII=function(t,n,r){var i=new e.datamodels.PII;i.RawContent=n,i.Kind=r,i.ScrubType=1,this.PIIExtensions.AddOrReplace(t,i)},t.prototype.Write=function(e){this.WriteImpl(e,!1)},t.prototype.WriteImpl=function(e,t){e.WriteStructBegin(null,t),this.Id!=""?(e.WriteFieldBegin(9,1,null),e.WriteString(this.Id),e.WriteFieldEnd()):e.WriteFieldOmitted(9,1,null),this.Timestamp.Equals("0")?e.WriteFieldOmitted(17,3,null):(e.WriteFieldBegin(17,3,null),e.WriteInt64(this.Timestamp),e.WriteFieldEnd()),this.Type!=""?(e.WriteFieldBegin(9,5,null),e.WriteString(this.Type),e.WriteFieldEnd()):e.WriteFieldOmitted(9,5,null),this.EventType!=""?(e.WriteFieldBegin(9,6,null),e.WriteString(this.EventType),e.WriteFieldEnd()):e.WriteFieldOmitted(9,6,null);if(this.Extension.Count()){e.WriteFieldBegin(13,13,null),e.WriteMapContainerBegin(this.Extension.Count(),9,9);for(var n=0;n<this.Extension.GetBuffer().length;++n)e.WriteString(this.Extension.GetBuffer()[n].Key),e.WriteString(this.Extension.GetBuffer()[n].Value);e.WriteContainerEnd(),e.WriteFieldEnd()}else e.WriteFieldOmitted(13,13,null);this.RecordType!=0?(e.WriteFieldBegin(16,24,null),e.WriteInt32(this.RecordType),e.WriteFieldEnd()):e.WriteFieldOmitted(16,24,null);if(this.PIIExtensions.Count()){e.WriteFieldBegin(13,30,null),e.WriteMapContainerBegin(this.PIIExtensions.Count(),9,10);for(var r=0;r<this.PIIExtensions.GetBuffer().length;++r)e.WriteString(this.PIIExtensions.GetBuffer()[r].Key),this.PIIExtensions.GetBuffer()[r].Value.WriteImpl(e,!1);e.WriteContainerEnd(),e.WriteFieldEnd()}else e.WriteFieldOmitted(13,30,null);e.WriteStructEnd(t)},t.prototype.Read=function(e){this.ReadImpl(e,!1)},t.prototype.ReadImpl=function(e,t){},t}();t.Record=u;var a=function(){function e(){this.Source="",this.DataPackageId="",this.Timestamp=new Microsoft.Bond.Int64("0"),this.Records=[]}return e.prototype.Write=function(e){this.WriteImpl(e,!1)},e.prototype.WriteImpl=function(e,t){e.WriteStructBegin(null,t),this.Source!=""?(e.WriteFieldBegin(9,2,null),e.WriteString(this.Source),e.WriteFieldEnd()):e.WriteFieldOmitted(9,2,null),this.DataPackageId!=""?(e.WriteFieldBegin(9,5,null),e.WriteString(this.DataPackageId),e.WriteFieldEnd()):e.WriteFieldOmitted(9,5,null),this.Timestamp.Equals("0")?e.WriteFieldOmitted(17,6,null):(e.WriteFieldBegin(17,6,null),e.WriteInt64(this.Timestamp),e.WriteFieldEnd());if(this.Records.length){e.WriteFieldBegin(11,8,null),e.WriteContainerBegin(this.Records.length,10);for(var n=0;n<this.Records.length;++n)this.Records[n].WriteImpl(e,!1);e.WriteContainerEnd(),e.WriteFieldEnd()}else e.WriteFieldOmitted(11,8,null);e.WriteStructEnd(t)},e.prototype.Read=function(e){this.ReadImpl(e,!1)},e.prototype.ReadImpl=function(e,t){},e}();t.DataPackage=a;var f=function(){function e(){this.DataPackages=[],this.RequestRetryCount=0}return e.prototype.Write=function(e){this.WriteImpl(e,!1)},e.prototype.WriteImpl=function(e,t){e.WriteStructBegin(null,t);if(this.DataPackages.length){e.WriteFieldBegin(11,1,null),e.WriteContainerBegin(this.DataPackages.length,10);for(var n=0;n<this.DataPackages.length;++n)this.DataPackages[n].WriteImpl(e,!1);e.WriteContainerEnd(),e.WriteFieldEnd()}else e.WriteFieldOmitted(11,1,null);this.RequestRetryCount!=0?(e.WriteFieldBegin(16,2,null),e.WriteInt32(this.RequestRetryCount),e.WriteFieldEnd()):e.WriteFieldOmitted(16,2,null),e.WriteStructEnd(t)},e.prototype.Read=function(e){this.ReadImpl(e,!1)},e.prototype.ReadImpl=function(e,t){},e}();t.ClientToCollectorRequest=f})(e.datamodels||(e.datamodels={}));var t=e.datamodels})(e.telemetry||(e.telemetry={}));var t=e.telemetry})(e.applications||(e.applications={}));var t=e.applications})(microsoft||(microsoft={}));var microsoft;(function(e){(function(e){(function(e){(function(t){(function(e){e[e.SENT=0]="SENT",e[e.SEND_FAILED=1]="SEND_FAILED"})(t.CallbackEventType||(t.CallbackEventType={}));var n=t.CallbackEventType;(function(e){e[e.DATARV_ERROR_OK=0]="DATARV_ERROR_OK",e[e.DATARV_ERROR_INVALID_EVENT=1]="DATARV_ERROR_INVALID_EVENT",e[e.DATARV_ERROR_INVALID_CONFIG=2]="DATARV_ERROR_INVALID_CONFIG",e[e.DATARV_ERROR_INVALID_DEPENDENCIES=3]="DATARV_ERROR_INVALID_DEPENDENCIES",e[e.DATARV_ERROR_INVALID_STATUS=4]="DATARV_ERROR_INVALID_STATUS",e[e.DATARV_ERROR_INVALID_ARG=5]="DATARV_ERROR_INVALID_ARG"})(t.DATARV_ERROR||(t.DATARV_ERROR={}));var r=t.DATARV_ERROR,i=function(){function e(e){this._errorCode=0,this._errorCode=e}return e.prototype.ErrorCode=function(){return this._errorCode},e.prototype.toString=function(){switch(this._errorCode){case 0:return"DATARV_ERROR_OK";case 1:return"Event is invalid. Either event.Id is empty, or event.Timestamp is empty, or event.EventType is empty.";case 2:return"Invalid configuration. CollectorUrl is missing.";case 3:return"DATARV_ERROR_INVALID_DEPENDENCIES";case 4:return"Telemetry Manager is not initialized.";case 5:return"TenantToken is null or empty, or events is null.";default:return"Unknown error"}},e}();t.Exception=i;var s=function(){function e(){}return e}();t.TelemetryConfig=s;var o=function(){function e(){}return e.CreateTelemetryManager=function(){return new f},e}();t.TelemetryManagerFactory=o;var u=function(){function e(){}return e.MaxPackageSizeInBytes=function(){return 3e6},e.TimeIntervalForNextSendInMS=function(){return 1e3},e}(),a;(function(e){e[e.Created=0]="Created",e[e.Initialized=1]="Initialized",e[e.Started=2]="Started"})(a||(a={}));var f=function(){function t(){this._MaxPackageSizeInBytes=u.MaxPackageSizeInBytes(),this._listeners=[],this._status=0,this._ecsClient=null,this._etag=null,this._ecsCallback=null,this._testServerResponseHook=null}return t.prototype.Initialize=function(e){if(this._status!=0)throw new i(4);if(!e||!e.collectorUrl)throw new i(2);this._config=e,this._Reset(),this._status=1,e.ecsClient&&(this._Verbose("ECS object assigned. Do integration"),this._ecsClient=e.ecsClient),this._Verbose("Initialize() done")},t.prototype.AddListener=function(e){if(this._status<1)throw new i(4);this._Verbose(["AddListener(), status: ",this._status," old length: ",this._listeners.length," func: ",e].join(""));for(var t=0;t<this._listeners.length;++t)if(this._listeners[t]==e){this._Verbose("the listener has been added already, index: "+t);return}this._listeners.push(e),this._Verbose("AddListener() done, the new length: "+this._listeners.length)},t.prototype.RemoveListener=function(e){if(this._status<1)throw new i(4);this._Verbose(["RemoveListener(), status: ",this._status," old length: ",this._listeners.length," func: ",e].join(""));for(var t=0;t<this._listeners.length;++t)if(this._listeners[t]==e){this._listeners.length==1?this._listeners=[]:t==this._listeners.length-1?this._listeners.pop():this._listeners[t]=this._listeners.pop(),this._Verbose(["this listener has been found, index: ",t,"new length: ",this._listeners.length].join(""));return}this._Verbose("listener isn't been found, new length"+this._listeners.length)},t.prototype.Start=function(){if(this._status<1)throw new i(4);this._Verbose(["Start(), status:",this._status,"tag:",t._tag].join(" ")),this._status>=2&&this._Verbose("Start() already, ignore"),this._ecsClient&&(this._ecsCallback=this._CreateEcsCallback(),this._ecsClient.AddListener(this._ecsCallback),this._etag=this._ecsClient.GetETag()),++t._tag,this._status=2,this._Verbose(["Start() done, status: ",this._status,"tag: ",t._tag].join(""))},t.prototype.Stop=function(){if(this._status<1)throw new i(4);this._Verbose("Stop(), status: "+this._status);if(this._status==1){this._Verbose("Stop() already, ignore");return}this._Reset(),this._status=1,this._Verbose("Stop() done, status: "+this._status)},t.prototype.Flush=function(e){this._eventsCache.IsEmpty()||this._WorkThread(e)},t.prototype.SendAsync=function(e,n){if(this._status<1)throw new i(4);this._Verbose(["SendAsync(), status:",this._status,"tenantToken:",e,"count:",n.length].join(" "));if(this._status<2)return this._Info("SendAsync(), not started, ignore, return false"),!1;if(!e||!n)throw this._Error("SendAsync(), tenantToken or events is null or empty"),new i(5);for(var r=0;r<n.length;++r)if(!n[r].Id||!t._eventTypeRegex.test(n[r].EventType)||n[r].Timestamp.Equals("0"))throw this._Error(["eventId:",n[r].Id,"eventType:",n[r].EventType,"timestamp high:",n[r].Timestamp.high,"timestamp low:",n[r].Timestamp.low].join("")),new i(1);return this._eventsCache.AddEvents(e,n),this._Verbose(["SendAsync(), currentTimer: ",this._timer,"eventsCacheIsEmpty",this._eventsCache.IsEmpty()].join(" ")),!this._eventsCache.IsEmpty()&&!this._timer&&this._ScheduleTimer(!1),this._Verbose("SendAsync() done"),!0},t.prototype._WorkThread=function(e){var n=this;try{this._Verbose("_WorkThread, status: "+this._status);if(this._status<2){this._Verbose("_WorkThread, status is not started, return");return}var r=this._eventsCache.DequeuEvents();if(r==null){this._Verbose("_WorkThread, No events found, return"),this._CleanTimer();return}var i=this._PackEvents(r.tenantToken,r.events);this._eventsCache.AddEvents(r.tenantToken,i.remainedEvents);if(i.buffer==null||i.buffer.length==0){this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1));return}if(this._testServerResponseHook){var s=this._testServerResponseHook();setTimeout(this._SendCallback(u,r.tenantToken,i.sendEvents,s,null),100);return}var o={type:"POST",url:this._config.collectorUrl,processData:!1,headers:{"content-type":"application/bond-compact-binary","client-id":"NO_AUTH","sdk-version":"ACT-Web-JS-"+clienttelemetry_build.version},complete:function(t){return n._SendCallback(u,r.tenantToken,i.sendEvents,t,e)}};sct.Utils.IsSafari()||typeof Uint8Array=="undefined"?(this._Verbose("Uint8Array is undefined, send with base64 encode."),o.data=Microsoft.Bond.Encoding.Base64.GetString(i.buffer),o.headers["content-encoding"]="base64"):(this._Verbose("Uint8Array is defined, send with binary format directly."),o.data=new Uint8Array(i.buffer)),r.tenantToken&&(o.headers["x-apikey"]=r.tenantToken);var u=t._tag;this._lastActiveTime=(new Date).getTime(),sct.Utils.ajax(o),this._Verbose("_Workthread, send via jquery, tag: "+u)}catch(a){this._Error("_WorkThread, exception: "+a)}},t.prototype._PackEvents=function(t,n){this._Verbose("_PackageEvents, total Count: "+n.length);var r=new e.datamodels.ClientToCollectorRequest,i=new e.datamodels.DataPackage;i.Source="JS_default_source",i.DataPackageId=e.datamodels.utils.GetGuid(),i.Timestamp=e.datamodels.utils.GetTimeStamp();var s,o=n;n=[];for(;;){i.Records=[],i.Records.push.apply(i.Records,o),r.DataPackages=[],r.DataPackages.push(i),s=this._Serialize(r),this._Verbose(["_PackageEvents, sendEvents.length:",o.length,"buffer.length:",s.length,"MaxPackageSize:",this._MaxPackageSizeInBytes].join(""));if(s.length<this._MaxPackageSizeInBytes)break;if(o.length==1){o=[],s=null;break}var u=o.splice(0,Math.floor(o.length/2));this._Verbose("_PackageEvents, too large, package again"),n.push.apply(n,o),o=u}return this._Verbose(["_PakcageEvents done, sendEventsCount:",o.length,"buffer.length:",s==null?0:s.length,"remained events:",n.length].join("")),{buffer:s,sendEvents:o,remainedEvents:n}},t.prototype._Serialize=function(e){var t=new Microsoft.Bond.IO.MemoryStream,n=new Microsoft.Bond.CompactBinaryProtocolWriter(t);return e.Write(n),t.GetBuffer()},t.prototype._SendCallback=function(e,n,r,i,s){this._Verbose(["_SendCallback","tag:",e,"current tag:",t._tag,"tenantToken:",n,"events count:",r.length,"jqXHR:",i].join(""));if(s!=null){s(i?i.status:0,n,r);return}var o=i!=null&&i.status>=200&&i.status<300;if(this._status<2||e<t._tag){this._Verbose("_SendCallback, is not started, or tag is not the same, return");return}if(!o&&(!i||i.status&&i.status!=400)){this._Verbose("retry statusCode: "+(i?i.status:0)),this._eventsCache.AddEvents(n,r),this._ScheduleTimer(!0);return}for(var u=0;u<this._listeners.length;++u)this._listeners[u](o?0:1,i?i.status:0,n,r);this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1))},t.prototype._CleanTimer=function(){this._Verbose("_CleanTimer(), timer: "+this._timer),this._timer&&(clearTimeout(this._timer),this._timer=null)},t.prototype._ScheduleTimer=function(e){var t=this;this._Verbose("_ScheduleTimer: isRetry: "+e),this._CleanTimer();if(!e){var n=0,r=(new Date).getTime(),i=r-this._lastActiveTime;i>u.TimeIntervalForNextSendInMS()?n=0:n=u.TimeIntervalForNextSendInMS()-i,this._timer=setTimeout(function(){return t._WorkThread(null)},n),this._Verbose("_ScheduleTimer, next try: "+n),this._rescheduleFactor=1}else{this._Verbose("_ScheduleTimer, current factor: "+this._rescheduleFactor);var n=Math.floor(5*this._rescheduleFactor*(1+Math.random()));this._timer=setTimeout(function(){return t._WorkThread(null)},n*1e3),this._Verbose("_ScheduleTimer, next try (s): "+n),this._rescheduleFactor<<=1,this._rescheduleFactor>64&&(this._rescheduleFactor=1)}},t.prototype._Verbose=function(e){this._config.log&&this._config.log.Verbose("[TelemetryManagerImpl]: "+e)},t.prototype._Info=function(e){this._config.log&&this._config.log.Info("[TelemetryManagerImpl]: "+e)},t.prototype._Error=function(e){this._config.log&&this._config.log.Error("[TelemetryManagerImpl]: "+e)},t.prototype._Reset=function(){this._Verbose("Reset()"),this._CleanTimer(),this._lastActiveTime=0,this._rescheduleFactor=1,this._sendingEvents=[],this._eventsCache=new l,this._ecsClient&&(this._ecsClient.RemoveListener(this._ecsCallback),this._ecsCallback=null)},t.prototype._CreateEcsCallback=function(){var e=this;return function(t){t==0&&(e._etag=e._ecsClient.GetETag())}},t.prototype.__GetListenerArray=function(){return this._listeners},t.prototype.__GetTotalEventsCount=function(){return this._eventsCache.GetTotalEventsCount()},t.prototype.__IsScheduled=function(){return this._timer!=null},t.prototype.__ChageMaxPackageSizeInKB=function(e){this._MaxPackageSizeInBytes=e*1024},t.prototype.__SetTestServerResponseHook=function(e){this._testServerResponseHook=e},t._eventTypeRegex=/^[a-zA-Z0-9]([a-zA-Z0-9]|_){2,98}[a-zA-Z0-9]$/,t._tag=0,t}(),l=function(){function e(){this._events={},this._tokens=[]}return e.prototype.AddEvents=function(e,t){if(!t.length)return;this._events[e]||(this._events[e]=[],this._tokens.push(e)),this._events[e].push.apply(this._events[e],t)},e.prototype.IsEmpty=function(){return this._tokens.length==0},e.prototype.DequeuEvents=function(){if(this._tokens.length==0)return null;var e=this._tokens.shift(),t=this._events[e];return delete this._events[e],{tenantToken:e,events:t}},e.prototype.GetTotalEventsCount=function(){var e=0;for(var t in this._events)e+=this._events[t].length;return e},e}()})(e._sender||(e._sender={}));var t=e._sender})(e.telemetry||(e.telemetry={}));var t=e.telemetry})(e.applications||(e.applications={}));var t=e.applications})(microsoft||(microsoft={}));var microsoft;(function(e){(function(e){(function(e){var t=e._sender.TelemetryManagerFactory.CreateTelemetryManager(),n=function(){function e(){this.collectorUrl=null}return e}();e.LogConfiguration=n;var r=function(){function e(){this.key=null,this.value=null,this.pii=null}return e}();e.Property=r;var i=function(){function e(){this.name=null,this.timestamp=null,this.properties=[],this.eventType=null}return e.prototype.setProperty=function(t,n,r){if(!t||!e._propertyNameRegex.test(t))throw new o(3);r?this.properties.push({key:t,value:n,pii:r!=0?r:null}):this.properties.push({key:t,value:n,pii:null})},e._propertyNameRegex=/^[a-zA-Z0-9](([a-zA-Z0-9|_]){0,98}[a-zA-Z0-9])?$/,e}();e.EventProperties=i,function(e){e[e.INVALID_TENANT_TOKEN=1]="INVALID_TENANT_TOKEN",e[e.MISSING_EVENT_PROPERTIES_NAME=2]="MISSING_EVENT_PROPERTIES_NAME",e[e.INVALID_PROPERTY_NAME=3]="INVALID_PROPERTY_NAME",e[e.INVALID_COLLECTOR_URL=4]="INVALID_COLLECTOR_URL",e[e.MISSING_FAILURE_SIGNATURE=5]="MISSING_FAILURE_SIGNATURE",e[e.MISSING_FAILURE_DETAIL=6]="MISSING_FAILURE_DETAIL",e[e.MISSING_PAGEVIEW_ID=7]="MISSING_PAGEVIEW_ID",e[e.MISSING_PAGEVIEW_NAME=8]="MISSING_PAGEVIEW_NAME",e[e.INVALID_SESSION_STATE=9]="INVALID_SESSION_STATE"}(e.TelemetryError||(e.TelemetryError={}));var s=e.TelemetryError,o=function(){function e(e){this.errorCode=null,this.errorCode=e}return e.prototype.ErrorCode=function(){return this.errorCode},e.prototype.toString=function(){switch(this.errorCode){case 1:return"Invalid tenant token";case 2:return"Eventproperties.name can not be null or empty";case 3:return"Invalid Key. Key does not conform to regular expression ^[a-zA-Z0-9](([a-zA-Z0-9|_|.]){0,98}[a-zA-Z0-9])?$";case 4:return"Collector url can't be null or empty.";case 5:return"Failure signature can't be null or empty.";case 6:return"Failure detail can't be null or empty.";case 7:return"Pageview id can't be null or empty.";case 8:return"Pageview name can't be null or empty.";case 9:return"Session state has to be a value from the SessionState enum.";default:return"Unknown error"}},e}();e.Exception=o;var u=function(){function e(){this.contextMap=new Microsoft.Bond.Collections.Map,this.piiKind=10}return e.prototype.setAppId=function(e){e&&this.contextMap.Add("AppInfo.Id",e)},e.prototype.setAppVersion=function(e){e&&this.contextMap.Add("AppInfo.Version",e)},e.prototype.setAppLanguage=function(e){e&&this.contextMap.Add("AppInfo.Language",e)},e.prototype.setDeviceId=function(e){e&&this.contextMap.Add("DeviceInfo.Id",e)},e.prototype.setDeviceOsName=function(e){e&&this.contextMap.Add("DeviceInfo.OsName",e)},e.prototype.setDeviceOsVersion=function(e){e&&this.contextMap.Add("DeviceInfo.OsVersion",e)},e.prototype.setDeviceBrowserName=function(e){e&&this.contextMap.Add("DeviceInfo.BrowserName",e)},e.prototype.setDeviceBrowserVersion=function(e){e&&this.contextMap.Add("DeviceInfo.BrowserVersion",e)},e.prototype.setUserId=function(e,t){e&&this.contextMap.Add("UserInfo.Id",e),t&&(this.piiKind=t)},e.prototype.setUserMsaId=function(e){e&&this.contextMap.Add("UserInfo.MsaId",e)},e.prototype.setUserANID=function(e){e&&this.contextMap.Add("UserInfo.ANID",e)},e.prototype.setUserAdvertisingId=function(e){e&&this.contextMap.Add("UserInfo.AdvertisingId",e)},e.prototype.setUserTimeZone=function(e){e&&this.contextMap.Add("UserInfo.TimeZone",e)},e.prototype.setUserLanguage=function(e){e&&this.contextMap.Add("UserInfo.Language",e)},e}(),a=function(){function t(){}return t.initialize=function(){var e=document.documentElement.lang;e&&t.semanticContext.setAppLanguage(e);var n=window.navigator.userLanguage||window.navigator.language;n&&t.semanticContext.setUserLanguage(n);var r=(new Date).getTimezoneOffset(),i=r%60,s=(r-i)/60,o="+";s>0&&(o="-"),t.semanticContext.setUserTimeZone(o+(s<10?"0"+s:s.toString())+":"+(i<10?"0"+i:i.toString())),t.semanticContext.setDeviceBrowserName(t._getBrowserName()),t.semanticContext.setDeviceBrowserVersion(t._getBrowserVersion()),t.semanticContext.setDeviceOsName(t._getOsName()),t.semanticContext.setDeviceOsVersion(t._getOsVersion()),t._setupCookies()},t._setupCookies=function(){var n=t._getCookie(t.DEVICE_ID_COOKIE);n==""?(n=e.datamodels.utils.GetGuid(),t._setCookie(t.DEVICE_ID_COOKIE,n),t.semanticContext.setDeviceId(n)):t.semanticContext.setDeviceId(n);var r=t._getCookie(t.FIRST_LAUNCH_TIME_COOKIE);r==""&&(r=(new Date).getTime().toString(),t._setCookie(t.FIRST_LAUNCH_TIME_COOKIE,r)),t.firstLaunchTime=parseInt(r)},t._setCookie=function(e,t){var n="expires=Mon, 31 Dec 2029 23:59:59 GMT";document.cookie=e+"="+t+"; "+n},t._getCookie=function(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r],s=0;while(i.charAt(s)==" ")s++;i=i.substring(s);if(i.indexOf(t)==0)return i.substring(t.length,i.length)}return""},t._getUserAgent=function(){return window.navigator.userAgent},t._userAgentContainsString=function(e){return t._getUserAgent().indexOf(e)>-1},t._isIe=function(){return t._userAgentContainsString("Trident")},t._isEdge=function(){return t._userAgentContainsString(t.BROWSERS.EDGE)},t._isOpera=function(){return t._userAgentContainsString("OPR/")},t._getBrowserName=function(){return t._isOpera()?t.BROWSERS.UNKNOWN:t._userAgentContainsString(t.BROWSERS.PHANTOMJS)?t.BROWSERS.PHANTOMJS:t._isEdge()?t.BROWSERS.EDGE:t._userAgentContainsString(t.BROWSERS.ELECTRON)?t.BROWSERS.ELECTRON:t._userAgentContainsString(t.BROWSERS.CHROME)?t.BROWSERS.CHROME:t._userAgentContainsString(t.BROWSERS.FIREFOX)?t.BROWSERS.FIREFOX:t._userAgentContainsString(t.BROWSERS.SAFARI)?t.BROWSERS.SAFARI:t._userAgentContainsString(t.BROWSERS.SKYPE_SHELL)?t.BROWSERS.SKYPE_SHELL:t._isIe()?t.BROWSERS.MSIE:t.BROWSERS.UNKNOWN},t._getBrowserVersion=function(){function e(){var e,n=t._getUserAgent(),r=n.match(new RegExp(t.BROWSERS.MSIE+" "+t.REGEX_VERSION));if(r)return r[1];e=n.match(new RegExp("rv:"+t.REGEX_VERSION));if(e)return e[1]}function n(e){var n;return e===t.BROWSERS.SAFARI&&(e="Version"),n=t._getUserAgent().match(new RegExp(e+"/"+t.REGEX_VERSION)),n?n[1]:t.UNKNOWN_VERSION}return t._isIe()?e():n(t._getBrowserName())},t._getOsName=function(){var e=/(windows|win32)/i,n=/ arm;/i,r=/windows\sphone\s\d+\.\d+/i,i=/(macintosh|mac os x)/i,s=/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i,o=/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,u=/android/i;return t._getUserAgent().match(r)?t.OPERATING_SYSTEMS.WINDOWS_PHONE:t._getUserAgent().match(n)?t.OPERATING_SYSTEMS.WINDOWS_RT:t._getUserAgent().match(s)?t.OPERATING_SYSTEMS.IOS:t._getUserAgent().match(u)?t.OPERATING_SYSTEMS.ANDROID:t._getUserAgent().match(o)?t.OPERATING_SYSTEMS.LINUX:t._getUserAgent().match(i)?t.OPERATING_SYSTEMS.MACOSX:t._getUserAgent().match(e)?t.OPERATING_SYSTEMS.WINDOWS:t.OPERATING_SYSTEMS.UNKNOWN},t._getOsVersion=function(){function e(){var e=t._getUserAgent().match(new RegExp("Windows NT "+t.REGEX_VERSION));return e&&t.VERSION_MAPPINGS[e[1]]?t.VERSION_MAPPINGS[e[1]]:t.UNKNOWN_VERSION}function n(){var e=t._getUserAgent().match(new RegExp(t.OPERATING_SYSTEMS.MACOSX+" "+t.REGEX_VERSION_MAC));if(e){var n=e[1].replace(/_/g,"."),i=[];if(n){var s=r(n);return s?(i=n.split(s),i[0]):n}}return t.UNKNOWN_VERSION}function r(e){return e.indexOf(".")>-1?".":e.indexOf("_")>-1?"_":null}return t._getOsName()===t.OPERATING_SYSTEMS.WINDOWS?e():t._getOsName()===t.OPERATING_SYSTEMS.MACOSX?n():t.UNKNOWN_VERSION},t.semanticContext=new u,t.firstLaunchTime=-1,t.BROWSERS={MSIE:"MSIE",CHROME:"Chrome",FIREFOX:"Firefox",SAFARI:"Safari",EDGE:"Edge",ELECTRON:"Electron",SKYPE_SHELL:"SkypeShell",PHANTOMJS:"PhantomJS",UNKNOWN:"Unknown"},t.OPERATING_SYSTEMS={WINDOWS:"Windows",MACOSX:"Mac OS X",WINDOWS_PHONE:"Windows Phone",WINDOWS_RT:"Windows RT",IOS:"iOS",ANDROID:"Android",LINUX:"Linux",UNKNOWN:"Unknown"},t.VERSION_MAPPINGS={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},t.REGEX_VERSION="([\\d,.]+)",t.REGEX_VERSION_MAC="([\\d,_,.]+)",t.UNKNOWN_VERSION="Unknown",t.DEVICE_ID_COOKIE="MicrosoftApplicationsTelemetryDeviceId",t.FIRST_LAUNCH_TIME_COOKIE="MicrosoftApplicationsTelemetryFirstLaunchTime",t}();(function(e){e[e.STARTED=0]="STARTED",e[e.ENDED=1]="ENDED"})(e.SessionState||(e.SessionState={}));var f=e.SessionState,l=function(){function n(){}return n.initialize=function(e){if(!n._initialized){if(!e)throw new o(1);n._defaultToken=e,n._config.collectorUrl||(n._config.collectorUrl="https://browser.pipe.aria.microsoft.com/Collector/3.0/"),t.Initialize(n._config),t.Start(),a.initialize(),n._initialized=!0}},n.initializeWithConfiguration=function(e,t){if(!t.collectorUrl)throw new o(4);n._config.collectorUrl=t.collectorUrl,n.initialize(e)},n.flush=function(e){t.Flush(e)},n.addCallbackListener=function(e){n._initialized&&t.AddListener(e)},n.setContext=function(e,t,r){n._contextProperties.setProperty(e,t,r)},n.isInitialized=function(){return n._initialized},n.getDefaultToken=function(){return n._defaultToken},n.getSemanticContext=function(){return n._semanticContext},n.__backToUninitialized=function(){n._config=new e._sender.TelemetryConfig,n._semanticContext=new u,n._contextProperties=new i,t=e._sender.TelemetryManagerFactory.CreateTelemetryManager(),n._initialized=!1},n._initialized=!1,n._defaultToken=null,n._config=new e._sender.TelemetryConfig,n._contextProperties=new i,n._semanticContext=new u,n}();e.LogManager=l;var c=function(){function n(t){this._initId=e.datamodels.utils.GetGuid(),this._sequence=0,this._tenantToken=null,this._contextProperties=new i,this._semanticContext=new u,this._sessionStartTime=0,this._sessionId=null,t?this._tenantToken=t:this._tenantToken=l.getDefaultToken()}return n.prototype.logEvent=function(e){if(!e.name)throw new o(2);var t=this._createEventRecord(e.name,e.eventType);this._addCustomPropertiesToEvent(t,e),this._sendRecord(t)},n.prototype.logFailure=function(e,t,n,r,i){if(!e)throw new o(5);if(!t)throw new o(6);var s=this._createEventRecord("failure","failure");s.Extension.Add("Failure.Signature",e),s.Extension.Add("Failure.Detail",t),n&&s.Extension.Add("Failure.Category",n),r&&s.Extension.Add("Failure.Id",r),this._addCustomPropertiesToEvent(s,i),this._sendRecord(s)},n.prototype.logPageView=function(e,t,n,r,i,s){if(!e)throw new o(7);if(!t)throw new o(8);var u=this._createEventRecord("pageview","pageview");u.Extension.Add("PageView.Id",e),u.Extension.Add("PageView.Name",t),n&&u.Extension.Add("PageView.Category",n),r&&u.Extension.Add("PageView.Uri",r),i&&u.Extension.Add("PageView.ReferrerUri",i),this._addCustomPropertiesToEvent(u,s),this._sendRecord(u)},n.prototype.logSession=function(t,n){if(t!==0&&t!==1)throw new o(9);var r=this._createEventRecord("session","session");if(t===0){if(this._sessionStartTime>0)return;this._sessionStartTime=(new Date).getTime(),this._sessionId=e.datamodels.utils.GetGuid(),r.Extension.Add("Session.Id",this._sessionId),r.Extension.Add("Session.State","Started")}else if(t===1){if(this._sessionStartTime==0)return;var i=Math.floor(((new Date).getTime()-this._sessionStartTime)/1e3);r.Extension.Add("Session.Duration",i.toString()),r.Extension.Add("Session.DurationBucket",this._getSessionDurationFromTime(i)),r.Extension.Add("Session.Id",this._sessionId),r.Extension.Add("Session.State","Ended"),this._sessionId=null,this._sessionStartTime=0}r.Extension.Add("Session.FirstLaunchTime",this._getISOString(new Date(a.firstLaunchTime))),this._addCustomPropertiesToEvent(r,n),this._sendRecord(r)},n.prototype.getSessionId=function(){return this._sessionId},n.prototype.setContext=function(e,t,n){this._contextProperties.setProperty(e,t,n)},n.prototype.getSemanticContext=function(){return this._semanticContext},n.prototype._getSessionDurationFromTime=function(e){return e<0?"Undefined":e<=3?"UpTo3Sec":e<=10?"UpTo10Sec":e<=30?"UpTo30Sec":e<=60?"UpTo60Sec":e<=180?"UpTo3Min":e<=600?"UpTo10Min":e<=1800?"UpTo30Min":"Above30Min"},n.prototype._createEventRecord=function(t,n){var r=new e.datamodels.Record;n||(n="custom"),r.EventType=t.toLowerCase(),r.Type=n.toLowerCase(),r.Extension.Add("EventInfo.Source","JS_default_source"),r.Extension.Add("EventInfo.InitId",this._initId),this._sequence++,r.Extension.Add("EventInfo.Sequence",this._sequence.toString()),r.Extension.Add("EventInfo.Name",t.toLowerCase());var i=new Date;return r.Timestamp=e.datamodels.utils.GetTimeStampWithValue(i.getTime()),r.Extension.Add("EventInfo.Time",this._getISOString(i)),r.Extension.Add("EventInfo.SdkVersion","ACT-Web-JS-"+clienttelemetry_build.version),r},n.prototype._getISOString=function(e){function t(e){return e<10?"0"+e:e.toString()}function n(e){return e<10?"00"+e:e<100?"0"+e:e.toString()}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+":"+n(e.getUTCMilliseconds())+"Z"},n.prototype._addCustomPropertiesToEvent=function(e,t){this._addSemanticContext(e,a.semanticContext),this._addSemanticContext(e,l._semanticContext),this._addSemanticContext(e,this._semanticContext),this._sessionId&&e.Extension.Add("Session.Id",this._sessionId),this._addEventPropertiesToEvent(e,l._contextProperties),this._addEventPropertiesToEvent(e,this._contextProperties),this._addEventPropertiesToEvent(e,t)},n.prototype._addSemanticContext=function(e,t){if(t&&t.contextMap.Count()>0){var n=t.contextMap.GetBuffer();for(var r=0;r<n.length;r++)n[r].Key=="UserInfo.Id"&&t.piiKind!=0?e.AddOrReplacePII(n[r].Key,n[r].Value,t.piiKind):e.Extension.AddOrReplace(n[r].Key,n[r].Value)}},n.prototype._addEventPropertiesToEvent=function(t,n){if(n){n.timestamp&&n.timestamp>=(new Date("1/1/2000")).getTime()&&(t.Timestamp=e.datamodels.utils.GetTimeStampWithValue(n.timestamp),t.Extension.AddOrReplace("EventInfo.Time",(new Date(n.timestamp)).toISOString())),n.name&&(t.EventType=n.name.toLowerCase(),t.Extension.AddOrReplace("EventInfo.Name",n.name.toLowerCase()));var r=n.properties;if(r&&r.length>0)for(var i=0;i<r.length;i++)r[i].key&&typeof r[i].key=="string"&&(r[i].value||r[i].value==0||r[i].value==0||r[i].value=="")&&(this._isPii(r[i].pii)?(t.AddOrReplacePII(r[i].key,r[i].value.toString(),r[i].pii),t.Extension.Remove(r[i].key)):(t.Extension.AddOrReplace(r[i].key,r[i].value.toString()),t.PIIExtensions.Remove(r[i].key)))}},n.prototype._isPii=function(t){if(t==(null||undefined||0))return!1;var n=!1;for(var r in e.datamodels.PIIKind)isNaN(r)||r==t&&(n=!0);return n},n.prototype._sendRecord=function(e){l.isInitialized()&&t.SendAsync(this._tenantToken,[e])},n}();e.Logger=c})(e.telemetry||(e.telemetry={}));var t=e.telemetry})(e.applications||(e.applications={}));var t=e.applications})(microsoft||(microsoft={})),define("microsoft-aria",["microsoft-aria/lib/aria"],function(e){return e}),define("microsoft-aria/lib/aria",function(){}),require(["microsoft-aria"]),function(e){function t(){function s(t,n){Object.keys(n).forEach(function(r){var i=n[r];if(Array.isArray(i)){if(!u(i[0]))throw new Error("Value should be string, number or boolean.");if(typeof i[1]!="number")throw new Error("PIIType should be number");t.setProperty(r,a(i[0]),i[1])}else u(i)&&t.setProperty(r,a(i),e.skypeTelemetryManager.PIIType.NotSet)})}function o(e){Object.keys(t).forEach(function(n){var r=t[n],i=typeof r[0]=="function"?r[0]():r[0];e.setProperty(n,a(i),r[1])})}function u(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"}function a(e){return e+""}var t={},n={},r={},i;this.setCommonProperty=function(n,r,i){if(typeof n!="string")throw new Error("Property name should be string");if(typeof i!="undefined"&&typeof i!="number")throw new Error("PIIType should be number");if(!u(r)&&typeof r!="function")throw new Error("Value should be string, number, boolean or function.");var s=typeof i=="undefined"?e.skypeTelemetryManager.PIIType.NotSet:i;t[n]=[r,s]},this.setSkypeUserId=function(t){this.setCommonProperty("user_id",t,e.skypeTelemetryManager.PIIType.Identity),this.setCommonProperty("Skype_InitiatingUser_Username",t)},this.sendEvent=function(e,t,u){if(typeof e!="string")throw new Error("Tenant ID should be string");if(typeof t!="string")throw new Error("Event name should be string");n[e]||(microsoft.applications.telemetry.LogManager.initialize(e),n[e]=new microsoft.applications.telemetry.Logger(e),r[e]=n[e].getSemanticContext(),r[e].setAppVersion(i));var a=new microsoft.applications.telemetry.EventProperties;a.name=t,s(a,u),o(a),n[e].logEvent(a)},this.setAppProperties=function(e){i=e}}e.skypeTelemetryManager||(e.skypeTelemetryManager={}),e.skypeTelemetryManager.PIIType={NotSet:0,DistinguishedName:1,GenericData:2,IPV4Address:3,IPv6Address:4,MailSubject:5,PhoneNumber:6,QueryString:7,SipAddress:8,SmtpAddress:9,Identity:10,Uri:11,Fqdn:12},e.skypeTelemetryManager.create=function(){return new t}}(window),define("telemetry/manager/telemetryManager",function(){}),define("ui/session/localSession",["require","exports","module","swx-utils-common","swx-utils-common"],function(e,t){var n=e("swx-utils-common").guid,r=e("swx-utils-common").sessionStorage,i={},s,o=n.create(),u="swx-sessionid";t.getSessionId=function(){return s?s:(s=r.get(u),s||(s=n.create(),r.set(u,s)),s)},t.getTabSessionId=function(){return o},t.setTelemetrySessionValue=function(e,t){if(!t)throw new Error("You are trying to set session parameter with a null value. Key:"+e);i[e]=t},t.getTelemetrySessionKeyValuePairs=function(){var e={};for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t]);return e}}),define("ui/telemetry/telemetryClient",["require","exports","module","telemetry/manager/telemetryManager","experience/settings","browser/window","ui/session/localSession","browser/detect"],function(e,t){function u(e){m(e,"session_id",i.getSessionId()),m(e,"tab_session_id",i.getTabSessionId())}function a(e){var t=s.getBrowserInfo();e.setCommonProperty("user_agent_name",t.browserName),e.setCommonProperty("user_agent_version",t.browserMajorVersion)}function f(e){var t=s.getSystemInfo();e.setCommonProperty("user_agent_OS",t.osName),e.setCommonProperty("user_agent_OS_version",t.osVersion),e.setCommonProperty("device_type",t.deviceType)}function l(e){var t=s.getScreenInfo();e.setCommonProperty("screen_width",t.width),e.setCommonProperty("screen_height",t.height)}function c(e){n.eTag&&e.setCommonProperty("etag",n.eTag),n.configIds&&n.configIds.length>0&&e.setCommonProperty("cfg_ids",n.configIds+"")}function h(e){return n.telemetry.upnCorrelationIdEnabled?-1:e.indexOf("upn")}function p(e){var t=0,r=128,i=10,s=-1,o=[];if(!n.initParams||!n.initParams.correlationIds)return;o=Object.keys(n.initParams.correlationIds),s=h(o),s>-1&&o.splice(s,1),o.forEach(function(s){t++;var o=n.initParams.correlationIds[s];o&&o!==""&&o.length<=r&&t<=i&&e.setCommonProperty("cid_"+s,o)})}function d(e){n.initParams&&(m(e,"environment_id",n.initParams.environment),m(e,"api_key",n.initParams.apiKey),m(e,"locale",n.initParams.locale)),e.setCommonProperty("ui_version",n.uiVersion),e.setCommonProperty("version",n.version),e.setCommonProperty("property",n.biAppName),e.setCommonProperty("Client_Name",n.biClientName)}function v(e){if(!n.telemetry.selectedTargets)return;for(var t=0;t<n.telemetry.selectedTargets.length;t++){var i=new RegExp(n.telemetry.selectedTargets[t]);if(i.test(r.location.hostname)){e.setCommonProperty("selected_target",!0);break}}}function m(e,t,n){if(!n)return;e.setCommonProperty(t,n)}function g(e){e.setAppProperties(n.version),u(e),a(e),f(e),l(e),p(e),d(e),c(e),v(e)}e("telemetry/manager/telemetryManager");var n=e("experience/settings"),r=e("browser/window"),i=e("ui/session/localSession"),s=e("browser/detect"),o;t.reset=function(){o=null},t.get=function(){return o||(o=r.skypeTelemetryManager.create(),g(o)),o}}),define("telemetry/authentication/linking",["require","exports","module","ui/telemetry/telemetryClient","experience/settings"],function(e,t){function i(){function e(e){var t="linking";n.get().sendEvent(r.telemetry.uiTenantToken,t,{flow:e})}return{send:e}}var n=e("ui/telemetry/telemetryClient"),r=e("experience/settings");t.build=function(){return new i}}),define("telemetry/authentication/signIn",["require","exports","module","ui/telemetry/telemetryClient","experience/settings","swx-utils-common"],function(e,t){function s(){function t(t){var i="signIn",s={};s.duration=e.duration(),s.authType=t.authType,s.success=t.hasSucceed,s.hostname=location.hostname,s.retry=t.retry||!1,t.isExternalSignIn&&(s.isExternalSignIn=t.isExternalSignIn),t.hasSucceed||(s.error=t.error,s.jCafeStatus=t.jCafeStatus||"",t.details&&(s.reason=t.details.reason||"",s.request=t.details.request||"",s.response=t.details.response||"")),t.flow&&(s.flow=t.flow),n.get().sendEvent(r.telemetry.uiTenantToken,i,s),n.get().setAuthType&&n.get().setAuthType(t.authType)}var e=i.build();return{send:t}}var n=e("ui/telemetry/telemetryClient"),r=e("experience/settings"),i=e("swx-utils-common").stopwatch;t.build=function(){return new s}}),define("experience/api/auth/authEventHandler",["require","exports","module","constants/common","services/pubSub/pubSub"],function(e,t){function s(e){return e&&e.name===n.api.auth.errorTypes.NOT_LINKED}function o(e){r.publish(n.events.auth.SIGNIN_FAILED,e)}function u(){i=!0,r.unsubscribe(n.apiUIEvents.SWX_SPLASHSCREEN_LOADED,u)}var n=e("constants/common"),r=e("services/pubSub/pubSub"),i;t.init=function(){r.subscribe(n.apiUIEvents.SWX_SPLASHSCREEN_LOADED,u)},t.destroy=function(){r.unsubscribe(n.apiUIEvents.SWX_SPLASHSCREEN_LOADED,u)},t.deferActionOnSplashscreen=function(e,t){function s(){typeof e=="function"&&e(t)}i?(s(),r.unsubscribe(n.apiUIEvents.SWX_SPLASHSCREEN_LOADED,s)):r.subscribe(n.apiUIEvents.SWX_SPLASHSCREEN_LOADED,s)},t.setErrorType=function(e){e.message===n.silentLogin.errorMessages.NOT_LINKED&&(e.name=n.api.auth.errorTypes.NOT_LINKED,e.reason=n.api.auth.errorMessages.NOT_LINKED)},t.startAuthFailedFlow=function(e,n,r){if(!s(e)){t.deferActionOnSplashscreen(o,e);return}r?n():t.deferActionOnSplashscreen(n)}}),define("experience/api/auth/linking",["require","exports","module","cafe/applicationInstance","experience/settings","ui/appOverlay/appOverlay","swx-xco","constants/common","swx-enums","telemetry/authentication/linking","telemetry/authentication/signIn","experience/api/auth/authEventHandler"],function(e,t){function c(e){return e.relink?o.api.auth.accountLinking.RELINK_FLOW:e.createTechnical?o.api.auth.accountLinking.INLINE_NEW_USER_FLOW:o.api.auth.accountLinking.WELCOME_FLOW}function h(e){var t=a.build();t.send(e)}function p(e){var t=f.build();t.send(e)}function d(e){var t={authType:u.authType.ImplicitOAuth,hasSucceed:!0,flow:e};p(t)}function v(e,t,n){var r={authType:u.authType.ImplicitOAuth,hasSucceed:!1,error:t.error,flow:e};p(r),l.startAuthFailedFlow(t,n)}function m(e){function u(e){var t=n.get().signInManager;if(b(e)){var i=t.createTokenImplicitOAuthSignInParameter({skypetoken:e.skypetoken,rps_token:e.rps_token,expires_in:e.expires_in,client_id:r.implicitOAuthParams.client_id,site_name:e.site_name});return t.signIn(i)}return Promise.reject()}var t,o=c(e);if(!e.rps_token)throw"[XCO Linking] You have to provide an rps token!";if(e.welcome&&e.createTechnical)throw'[XCO Linking] You cannot start both "createTechnical" and "welcome" flows';t={client_id:"580081",rps_token:e.rps_token,microsoft:!0,env:r.xcoEnv,setlang:r.initParams.locale,createTechnical:e.createTechnical||!1,hidden:e.hidden||!1,welcome:e.welcome||!1,relink:e.relink||!1,site_name:e.site_name||null,callback:function(t){function r(){g(e.onSuccess),i.destroy(),d(o)}function s(){g(e.onError,t),i.destroy()}var n=e.callback||u;return y(t)&&v(o,t,n),n(t).then(r,s)}},h(o),s.init(t),s.load(i.create())}function g(e,t){typeof e=="function"&&e(t)}function y(e){return e&&e.error}function b(e){return e&&e.skypetoken}var n=e("cafe/applicationInstance"),r=e("experience/settings"),i=e("ui/appOverlay/appOverlay"),s=e("swx-xco").linking,o=e("constants/common"),u=e("swx-enums"),a=e("telemetry/authentication/linking"),f=e("telemetry/authentication/signIn"),l=e("experience/api/auth/authEventHandler");t.start=m}),define("experience/authContext",["require","lodash-compat"],function(e){function i(){return r}function s(){t.assign(r,n)}var t=e("lodash-compat"),n={implicitSignIn:!1,implicitSignOut:!1},r=t.clone(n);return{get:i,reset:s}}),define("jSkype/modelHelpers/signIn/resignInHelper",["require","exports","module","jSkype/client","jSkype/settings","jSkype/modelHelpers/personsAndGroupsHelper","experience/api/auth/linking","experience/authContext"],function(e,t){function u(e){var t=n.get().signInManager;return t._skypeToken().then(function(n){var r=i.extractSkypeIdFromToken(n),s=i.extractSkypeIdFromToken(e.skypetoken);r!==s&&a(t,e)})}function a(e,t){var n=e.createTokenImplicitOAuthSignInParameter({skypetoken:t.skypetoken,rps_token:t.rps_token,expires_in:t.expires_in,client_id:r.settings.implicitOAuthParams.client_id,site_name:t.site_name});o.get().implicitSignOut=!0,e.signOut().then(function(){e.signIn(n)})}var n=e("jSkype/client"),r=e("jSkype/settings"),i=e("jSkype/modelHelpers/personsAndGroupsHelper"),s=e("experience/api/auth/linking"),o=e("experience/authContext");t.startRelinkingFlow=function(){var t=n.get().signInManager;s.start({rps_token:t._rpsToken(),site_name:t._siteName(),relink:!0,callback:u})}}),define("jSkype/models/signInManager",["require","exports","module","lodash-compat","jcafe-property-model","jSkype/client","swx-enums","jSkype/modelHelpers/signIn/parameterBuilder","jSkype/modelHelpers/signIn/skypeTokenManager","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/modelHelpers/signIn/resignInHelper"],function(e,t){function l(){function c(r){var i;return r&&r.relink?(f.startRelinkingFlow(),Promise.resolve()):(e.state._set(s.loginState.SigningIn),t=u.build(r),i=n.get(),i.then(p),i)}function h(){return new Promise(function(t){e.state._set(s.loginState.SigningOut),e.state.once(s.loginState.SignedOut,function(){o(!0),l(!1),y(!1),t(!0)})})}function p(t){var n=a.extractSkypeIdFromToken(t);e.state._set(s.loginState.SignedIn),o(!1),l(!0),g(n),y(!0),b(n)}function d(){var e=n.get.bind(n);return e.changed=n.changed,e}function v(){return e.state()!==s.loginState.SignedOut?new Promise(function(e,n){t.get().then(function(t){m(t),e(t.token)},function(e){m(e),h(),n(e)})}):Promise.reject("Not signed in")}function m(t){t&&(e._rpsToken(t.rpsToken),e._siteName(t.siteName))}function g(e){i.get()._telemetryManager.setSkypeUserId(e)}function y(e){e?e=1:e=0,i.get()._telemetryManager.setCommonProperty("signed_in",e)}function b(e){e&&e.indexOf("live:")===0&&o(!0)}var e=this,t,n=r.property({get:v}),o=r.boolProperty(!0),l=r.boolProperty(!1);e.state=r.property({readOnly:!0,value:s.loginState.SignedOut}),e.signIn=r.command(c,o),e.signOut=r.command(h,l),e._skypeToken=d(),e._rpsToken=r.property(),e._siteName=r.property()}var n=e("lodash-compat"),r=e("jcafe-property-model"),i=e("jSkype/client"),s=e("swx-enums"),o=e("jSkype/modelHelpers/signIn/parameterBuilder"),u=e("jSkype/modelHelpers/signIn/skypeTokenManager"),a=e("jSkype/modelHelpers/personsAndGroupsHelper"),f=e("jSkype/modelHelpers/signIn/resignInHelper");t.build=function(){return n.extend(new l,o)}}),define("utils/common/url",["require","exports","module","lodash-compat"],function(e,t){function r(e,t){return e+n.reduce(n.pairs(t||{}),function(e,t){return e?e+="&":e="?",n.isUndefined(t[1])||t[1]===null?e+=encodeURIComponent(t[0]):e=e+encodeURIComponent(t[0])+"="+encodeURIComponent(t[1]),e},"")}var n=e("lodash-compat");t.buildUrl=r}),define("jSkype/models/translatorService",["require","exports","module","jcafe-property-model","jSkype/settings","lodash-compat","utils/common/url","swx-enums","jSkype/client","reqwest"],function(e,t){function f(){function t(e){function i(e){t.resolve(e)}function s(e){t.reject(e)}var t=n.task();return u.get().signInManager._skypeToken().then(function(t){var n={url:e,method:"GET",crossOrigin:!0,dataType:"json",headers:{"X-Skypetoken":t,"Accept-Language":r.settings.initParams.locale,"X-ScenarioId":r.settings.translatorClientAppId}};a.compat(n).then(i,s)},s),t.promise}function f(e,i,o){var u=n.task(),a;return!i||!o?(u.reject(),u.promise):(a=s.buildUrl(r.settings.translatorServiceURI.TRANSLATE,{from:e||"",to:i,text:o}),t(a).then(function(e){u.resolve(e)},function(e){u.reject(e)}),u.promise)}function l(t){var r=t.text;i.forIn(r,function(t,r){if(!t.name||!r)return;e.supportedLanguages.add({name:n.property({value:t.name}),code:n.property({value:r})})})}function c(){var i=n.task(),u=s.buildUrl(r.settings.translatorServiceURI.LANGUAGES,{scope:"text"});return t(u).then(function(t){l(t),e.state._set(o.translatorServiceState.Authenticated),i.resolve(e.supportedLanguages())},function(t){e.state._set(o.translatorServiceState.Error),i.reject(t)}),i.promise}var e=this;e.supportedLanguages=n.collection({get:c}),e.translateMessage=n.command(f,n.boolProperty(!0)),e.state=n.property({readOnly:!0,value:o.translatorServiceState.NotReady})}var n=e("jcafe-property-model"),r=e("jSkype/settings"),i=e("lodash-compat"),s=e("utils/common/url"),o=e("swx-enums"),u=e("jSkype/client"),a=e("reqwest");t.build=function(){return new f}}),define("jSkype/services/messageSearch/main",["require","exports","module","reqwest","swx-utils-common","jSkype/client","jSkype/settings"],function(e,t){function o(){function u(){return i.get().signInManager._skypeToken()}var e=this,t=s.settings.messageSearchService,o="{OPTION: {RESULTBASE: 0, RESULTCOUNT: %COUNT%}, QUERYSTRING: {Content: %CRITERIA%}}";e.query=function(e,i){var s={url:t.host+t.endpoints.query,headers:{"x-ms-correlation-id":r.create(),"X-Skypetoken":""},method:"POST",dataType:"json",contentType:"application/json",data:o.replace("%CRITERIA%",JSON.stringify(e)).replace("%COUNT%",i)};return u().then(function(e){return s.headers["X-Skypetoken"]=e,Promise.resolve(n.compat(s))})}}var n=e("reqwest"),r=e("swx-utils-common").guid,i=e("jSkype/client"),s=e("jSkype/settings");t.build=function(){return new o}}),define("jSkype/models/searchQuery",["require","jcafe-property-model","jSkype/modelHelpers/propertyModelHelper"],function(e){function r(){var e=t.collection(),r=t.boolProperty(!0),i=t.collection();this.keywords={},this.limit=t.property({value:20}),this.moreResultsAvailable=r.asReadOnly(),this.results=n.exposeReadOnlyCollection(e),this.sources=t.property(),this.supportedKeywords=n.exposeReadOnlyCollection(i),this.text=t.property()}var t=e("jcafe-property-model"),n=e("jSkype/modelHelpers/propertyModelHelper");return r}),define("jSkype/models/marketplaceSearchQuery",["require","jcafe-property-model","jSkype/modelHelpers/propertyModelHelper","lodash-compat","jSkype/models/searchQuery"],function(e){function s(){function s(){var e=t.task();return e.promise}var e=this,r=t.collection();i.call(e),r.add("type","type"),e.supportedKeywords=n.exposeReadOnlyCollection(r),e.getMore=t.command(s,e.moreResultsAvailable)}var t=e("jcafe-property-model"),n=e("jSkype/modelHelpers/propertyModelHelper"),r=e("lodash-compat"),i=e("jSkype/models/searchQuery");return s.prototype=r.create(i.prototype,{constructor:s}),s}),define("jSkype/models/marketplaceManager",["require","jcafe-property-model","jSkype/models/marketplaceSearchQuery"],function(e){function r(){this.createSearchQuery=function(){return new n},this.purchase=t.disabledCommand()}var t=e("jcafe-property-model"),n=e("jSkype/models/marketplaceSearchQuery");return r}),define("jSkype/modelHelpers/propertyValidator",["require","exports","module","lodash-compat"],function(e,t){var n=e("lodash-compat");t.isGroupConversation=function(e){return n.isString(e)&&/^19:/.test(e)},t.isPhoneNumber=function(e){return n.isString(e)&&(/^\+?\d+$/.test(e)||/^4:/.test(e))}}),define("jSkype/modelHelpers/calling/callData",["require","swx-enums","jcafe-property-model","constants/common"],function(e){function i(){function s(){return i[0]?i[0].payload:null}var e=this,i=[];e.isProcessingCall=n.boolProperty(!1),e.isCurrentCallIncoming=n.boolProperty(!1),e.pluginAwaitCall=n.boolProperty(!1),e.pluginRingingForMe=n.boolProperty(!1),e.callTechnology=n.property({value:t.callTechnology.None}),e.pluginOthersAreLive=n.boolProperty(!1),e.pluginCallInfo=n.property(),e.nodeId=n.property(),e.ngcEndpointId=n.property(),e.ngcParticipantId=n.property(),e.oncePluginCallInfoReady=function(t){function n(e){return!!e}return e.pluginCallInfo(null),e.pluginCallInfo.once(n,t)},e.getFirstPayload=s,e.resetCallData=function(){i=[],e.isProcessingCall(!1),e.isCurrentCallIncoming(!1),e.pluginAwaitCall(!1),e.callTechnology(t.callTechnology.None),e.pluginCallInfo(null),e.nodeId(null),e.ngcEndpointId(null),e.ngcParticipantId(null)},e.resetPluginCallState=function(){e.pluginRingingForMe(!1),e.pluginOthersAreLive(!1)},e.hasIncomingP2PNotification=function(){return i.some(function(e){return e.payload.evt===r.INCOMING_CALL})},e.hasIncomingNGCNotification=function(){return i.some(function(e){return e.payload.evt===r.INCOMING_SKYPE_NGC_CALL||e.payload.evt===r.INCOMING_SKYPE_NGC_GVC_CALL})},e.isGroupIncomingCall=function(){return s()?s().conversationId!=="8:"+s().callerId:!1},e.addIncomingCallPayload=function(t){e.isCurrentCallIncoming(!0),i.push({processed:!1,payload:t})},e.getCallIdFromCurrentCall=function(){return s()&&s().convoCallId},e.getIncomingNGCPayload=function(){var e=null;return i.forEach(function(t){if(t.payload.evt===r.INCOMING_SKYPE_NGC_CALL||t.payload.evt===r.INCOMING_SKYPE_NGC_GVC_CALL){if(e)return;t.processed||(e=t.payload,t.processed=!0)}}),e},e.wasNGCPayloadProcessed=function(){return i.some(function(e){var t=e.payload.evt===r.INCOMING_SKYPE_NGC_CALL||e.payload.evt===r.INCOMING_SKYPE_NGC_GVC_CALL;return t&&e.processed})},e.getUnprocessedIncomingCallPayloads=function(){var e=[];return i.forEach(function(t){t.processed||(t.processed=!0,e.push(t.payload))}),e},e.markIncomingPayloadsAsProcessed=function(e){i.forEach(function(t){t.payload===e&&(t.processed=!0)})},e.markAllIncomingPayloadsAsProcessed=function(){i.forEach(function(e){e.processed=!0})}}var t=e("swx-enums"),n=e("jcafe-property-model"),r=e("constants/common").events.trouter;return{build:function(){return new i}}}),define("jSkype/models/participantAudio",["require","exports","module","jcafe-property-model","jSkype/modelHelpers/propertyModelHelper","jSkype/modelHelpers/personsAndGroupsHelper","swx-enums"],function(e,t){function o(e,t){function l(t){var n;return a(!1),f&&(t?n=e._callHandler.mute():n=e._callHandler.unmute()),n.then(function(e){u._set(e),a(!0)}),n}function c(e,t,n){if(n===undefined||t===s.callDisconnectionReason.CallEscalated)return;e===s.callConnectionState.Connecting&&(a(!0),u._set(!1)),e===s.callConnectionState.Disconnected&&(a(!1),u._set(!1))}var o=n.property({readOnly:!0,value:s.callConnectionState.Disconnected}),u=r.createPropertyWithSetter(!1,l,!0),a=u.set._enabled,f=i.isMePerson(t);return f&&o.changed(c),this.state=o,this.isSpeaking=n.property({readOnly:!0,value:!1}),this.isOnHold=n.property({value:!1}),this.isMuted=u,this.endpoint=n.property({value:t}),this._isFailedCall=n.property({value:!1}),this._sourceId=n.property(),this._dispose=function(){f&&o.changed.off(c)},this}var n=e("jcafe-property-model"),r=e("jSkype/modelHelpers/propertyModelHelper"),i=e("jSkype/modelHelpers/personsAndGroupsHelper"),s=e("swx-enums");t.build=function(e,t){return new o(e,t.id())}}),define("jSkype/models/mediaStreamSink",["require","jcafe-property-model"],function(e){function n(){return{container:t.property()}}var t=e("jcafe-property-model");return n}),define("jSkype/models/mediaStreamSource",["require","jSkype/models/mediaStreamSink"],function(e){function n(){return{sink:new t}}var t=e("jSkype/models/mediaStreamSink");return n}),define("jSkype/models/mediaStream",["require","jcafe-property-model","jSkype/models/mediaStreamSource","swx-enums"],function(e){function i(){return{state:t.property({readOnly:!0,value:r.mediaStreamState.Stopped}),source:new n,width:t.property({readOnly:!0,value:0}),height:t.property({readOnly:!0,value:0})}}var t=e("jcafe-property-model"),n=e("jSkype/models/mediaStreamSource"),r=e("swx-enums");return i}),define("constants/calling",[],function(){return{DOM_ELEMENT:{ID:{CHAT_COMPONENT:"chatComponent",CONTENT_WRAPPER:"contentWrapper",CALL_SCREEN:"callScreen",CALL_SCREEN_RESIZE:"callScreenResize",LOCAL_VIDEO_CONTAINER:"local-video-ui"}},SELECTORS:{CONTAINER:".av .middle",MAIN:".av .main",VIDEO:".video",TOP:".top",BOTTOM:".bottom",STAGE:".stage"},CLASSES:{VIDEO_ON:"videoOn",LOCAL_PIP:"localPip",ASPECT_RATIO_1BY1:"ratio1by1",ASPECT_RATIO_4BY3:"ratio4by3",ASPECT_RATIO_16BY9:"ratio16by9"},CONTROLS:{CALL_SCREEN:"av",END_CALL_CONTROL:"endCallControl",MUTE_CONTROL:"muteControl"},EVENTS:{START_CALL:"calling.startCall",RINGING_IN:"calling.ringingIn",ANSWER:"calling.answer",REJECT:"calling.reject",INCOMING_CALL_TOAST_TIMEOUT:"calling.incomingCallToastTimeout",INCOMING_INIT_ERROR:"IncomingInitialisationError",INCOMING_INIT_SUCCESS:"IncomingInitialisationSuccess",STOP_RINGING:"calling.stopRinging",FULLSCREEN_CHANGED:"calling.fullscreenChanged",CALL_SCREEN_CLOSE:"calling.callScreenClose",CALL_SCREEN_HEIGHT_CHANGED:"calling.callScreenChanged",START_RINGING:"calling.startRinging",CALLSESSION_STARTING:"calling.callsession.starting",CALLSESSION_ENDED:"calling.callsession.ended",PARICIPANT_VOICE_STATUS:"calling.participantVoiceStatus",PARICIPANT_JOINED:"calling.participantJoined",CALL_STATUS_CHANGED:"calling.callStatusChanged",ERROR_INCOMING_CALL:"calling.error.incomingCall",ERROR_OUTGOING_CALL:"calling.error.outgoingCall",CQF_SCREEN_CLOSE:"calling.cqfScreenClose",CQF_CANCEL:"calling.cqfCancel"},TELEMETRY_EVENTS:{PLUGIN_INSTALL_STARTED:"PluginInstallStarted",PLUGIN_INSTALL_ENDED:"PluginInstallEnded"},PLUGIN_INSTALL_EXIT_METHOD:{CLOSE:"close",PLUGIN_DETECTED:"pluginDetected",CALL_STARTED:"callStarted"},NA:"n/a",CALLING_SETUP_STEPS:{OVERLAY_PLUGIN_CALLBACK:"overlayPluginCallback",CLOSE_CALLING_SETUP:"closeCallingSetup",OVERLAY_PLUGIN_STEPS:"overlayPluginSteps",OVERLAY_EXTENSION_INSTALLED:"overlayExtensionInstalled",OVERLAY_EXTENSION_INSTALL:"overlayExtensionInstall",OVERLAY_EXTENSION_INSTALL_FAILED:"overlayExtensionInstallFailed",OVERLAY_EXTENSION_START:"overlayExtensionStart",OVERLAY_PLUGIN_START:"overlayPluginStart",OVERLAY_PLUGIN_UNBLOCK:"overlayPluginUnblock"},LAYOUT_TYPES:{GALLERY:"gallery",ACTIVE_SPEAKER:"activeSpeaker"},SOUND_LEVEL_EVENT_MODE:{None:"None",Boolean:"Boolean",Full:"Full"},SOUND_LEVEL_DEFAULT_THRESHOLD:4,PLUGIN_MAX_SOUND_LEVEL:10,PARTICIPANT_REMOVE_FROM_CALLSCREEN_TIMEOUT:2e4,PLUGIN_INIT_TIMEOUT:25e3,LAYOUT_PLACES:{STAGE:"stage",ROSTER:"roster"},CALL_STATES:{CONNECTING:"connecting",CALLING:"calling",EARLY_MEDIA:"earlyMedia",CONNECTED:"connected",ENDING:"ending",ENDED:"ended"},NOTIFICATION_ACTIONS:{AUDIO:"audio",VIDEO:"video",REJECT:"reject",INSTALL_PLUGIN:"installPlugin"},PLUGIN_EVENT_RESULTS:{LOAD_SUCCESSFUL:"LoadSuccessful",LOGIN_SUCCESS:"LoggedIn",VIDEO_STATUS:{AVAILABLE:"Available",NOT_AVAILABLE:"NotAvailable"}},PLUGIN_COMPONENT:{MANAGER_ID:"__pluginFx",CORE_ID:"SkypeCore",VIDEO_ID:"VideoUI"},PLUGIN_VIDEO_MODES:{STRETCH:1,CROP:2,FIT:3},PLUGIN_ERROR:{NOT_INSTALLED:"pluginNotInstalled",INIT_TIMEOUT:"pluginInitializationTimeout"},PLUGIN_MEDIA_TYPES:{VIDEO:"Video",SCREEN_SHARING:"ScreenSharing"},SHELL_APP_PRELOAD_ENABLED_VERSION:"7.4",SHELL_APP_METHODS:{GET_VERSION:"getVersion",SHOW_WINDOW:"showWindow",HIDE_WINDOW:"hideWindow",CLOSE_WINDOW:"closeWindow"},SHELL_APP_EVENTS:{WINDOW_CLOSING:"windowClosing"},ERRORS:{P2P_FALLBACK:"p2pFallback"},ERROR_CODES:{TPC_INIT:1,REGISTRAR_INIT:2,UNSUPPORTED_BROWSER:3,UNSUPPORTED_OS:4},FEATURE_FLAGS:{RESIZE_CALL_AND_CHAT:"resizeCallAndChat",CALLING:"calling",GVC:"GVC"}}}),define("jSkype/models/videoChannel",["require","jcafe-property-model","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/modelHelpers/propertyModelHelper","jSkype/models/mediaStream","swx-enums","constants/calling"],function(e){function u(e,u,a){function g(){var t=!1;!d&&!e.isGroupConversation()&&(t=!0),h=r.createPropertyWithSetter(t,x,!0),c=t,p=h.set._enabled}function y(){return e._callHandler&&f.state()!==s.mediaStreamState.Stopped&&f.source.sink.container()&&c}function b(){return e._callHandler&&u()!==s.callConnectionState.Disconnected&&(f.state()===s.mediaStreamState.Stopped||!f.source.sink.container())}function w(){y()&&e._callHandler.attachParticipantVideo(a,f.source.sink.container(),o.PLUGIN_MEDIA_TYPES.VIDEO)}function E(){b()&&e._callHandler.detachParticipantVideo(a,o.PLUGIN_MEDIA_TYPES.VIDEO)}function S(){v.push(f.source.sink.container.changed(function(){y()?w():b()&&E()})),v.push(f.state.when(s.mediaStreamState.Started,w)),v.push(f.state.when(s.mediaStreamState.Stopped,E)),m=u.when(s.callConnectionState.Disconnected,T)}function x(t){return d&&e.selfParticipant.audio.state()===s.callConnectionState.Connected&&p(!1),e._callHandler?(c=t,t?(d&&f.state._set(s.mediaStreamState.Started),e._callHandler.startParticipantVideo(a,o.PLUGIN_MEDIA_TYPES.VIDEO)):e._callHandler.stopParticipantVideo(a,o.PLUGIN_MEDIA_TYPES.VIDEO),t):t}function T(e,t){if(t===undefined)return;f.state._set(s.mediaStreamState.Stopped),p(!0),h._set(!1)}var f=new i,l=t.property({value:!1}),c,h,p,d=n.isMePerson(a),v=[],m;return g(),this._dispose=function(){f.state._set(s.mediaStreamState.Stopped),v.forEach(function(e){e.dispose()}),v.length=0,m.dispose()},this.camera=null,this.stream=f,this.isOnHold=l,this.isStarted=h,this._toggleIsStarted=x,this._init=S,this}var t=e("jcafe-property-model"),n=e("jSkype/modelHelpers/personsAndGroupsHelper"),r=e("jSkype/modelHelpers/propertyModelHelper"),i=e("jSkype/models/mediaStream"),s=e("swx-enums"),o=e("constants/calling");return u}),define("jSkype/models/participantVideo",["require","exports","module","jcafe-property-model","jSkype/modelHelpers/propertyModelHelper","jSkype/client","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/models/videoChannel","swx-enums"],function(e,t){function a(e,t){function h(){l=i.get().devicesManager.selectedCamera.changed(p),c=i.get().devicesManager.cameras.removed(v)}function p(e,t){if(e){var n=d();n.camera=e}else(e===null||t==="ActiveDeviceUnplugged")&&a.channels(0)&&a.channels(0)._toggleIsStarted(!1)}function d(){var n=new o(e,a.state,t);return n._init(),a.channels._add(n),n}function v(e){a.channels._removeByCondition(function(t){return t.camera.deviceId()===e.deviceId()?(t._dispose(),!0):!1})}var a=this,f=n.collection(),l,c;return this.state=n.property({readOnly:!0,value:u.callConnectionState.Disconnected}),this.channels=r.exposeReadOnlyCollection(f),this._sourceId=n.property(),this._dispose=function(){a.channels().forEach(function(e){e._dispose()}),a.channels._removeAll(),s.isMePerson(t)&&(l.dispose(),c.dispose())},s.isMePerson(t)?h():d(),this}var n=e("jcafe-property-model"),r=e("jSkype/modelHelpers/propertyModelHelper"),i=e("jSkype/client"),s=e("jSkype/modelHelpers/personsAndGroupsHelper"),o=e("jSkype/models/videoChannel"),u=e("swx-enums");t.build=function(e,t){return new a(e,t.id())}}),define("jSkype/models/participantChat",["require","exports","module","jcafe-property-model","swx-enums","constants/common"],function(e,t){function s(e){function o(e){t.state._set(e?r.Connected:r.Disconnected)}function u(){t.isTyping._set(!1)}var t=this,s;this.state=n.property({readOnly:!0,value:r.Disconnected}),this.isTyping=n.property({readOnly:!0,value:!1}),e.activeModalities.chat.changed(o),this._setIsTyping=function(e){clearTimeout(s),t.isTyping._set(e),e&&(s=setTimeout(u,i.EXPIRY))},this._dispose=function(){clearTimeout(s),e.activeModalities.chat.changed.off(o)}}var n=e("jcafe-property-model"),r=e("swx-enums").callConnectionState,i=e("constants/common").isTyping;t.build=function(e){return new s(e)}}),define("jSkype/models/participantScreenSharing",["require","exports","module","swx-enums","constants/calling","jcafe-property-model","jSkype/models/mediaStream","jSkype/modelHelpers/personsAndGroupsHelper"],function(e,t){function u(e,t){function c(){return e._callHandler&&f.state()!==n.mediaStreamState.Stopped&&f.source.sink.container()}function h(){return e._callHandler&&u.state()!==n.callConnectionState.Disconnected&&(f.state()===n.mediaStreamState.Stopped||!f.source.sink.container())}function p(){return e._callHandler&&f.state()===n.mediaStreamState.Stopped}function d(){return e._callHandler&&f.state()!==n.mediaStreamState.Stopped}function v(){c()&&e._callHandler.attachParticipantVideo(t,f.source.sink.container(),r.PLUGIN_MEDIA_TYPES.SCREEN_SHARING)}function m(){h()&&e._callHandler.detachParticipantVideo(t,r.PLUGIN_MEDIA_TYPES.SCREEN_SHARING)}function g(){p()&&e._callHandler.startParticipantVideo(t,r.PLUGIN_MEDIA_TYPES.SCREEN_SHARING)}function y(){d()&&e._callHandler.stopParticipantVideo(t,r.PLUGIN_MEDIA_TYPES.SCREEN_SHARING)}function b(){u.state._set(n.callConnectionState.Notified)}function w(){u.state._set(n.callConnectionState.Connected)}function E(){u.state()!==n.callConnectionState.Disconnecting&&u.state()!==n.callConnectionState.Disconnected&&u.state._set(n.callConnectionState.Disconnecting),u.state._set(n.callConnectionState.Disconnected)}function S(){a?g():v()}function x(){a?y():m()}var u=this,a=o.isMePerson(t),f=new s,l=[];return u.state=i.property({readOnly:!0,value:n.callConnectionState.Disconnected}),u.stream=f,u.isControlling=i.property({value:!1}),l.push(f.source.sink.container.changed(function(){c()?v():h()&&m()})),l.push(f.state.when(n.mediaStreamState.Started,b)),l.push(f.state.when(n.mediaStreamState.Active,w)),l.push(f.state.when(n.mediaStreamState.Stopped,E)),l.push(u.state.when(n.callConnectionState.Connecting,S)),l.push(u.state.when(n.callConnectionState.Disconnecting,x)),u._dispose=function(){E(),l.forEach(function(e){e.dispose()}),l.length=0},u}var n=e("swx-enums"),r=e("constants/calling"),i=e("jcafe-property-model"),s=e("jSkype/models/mediaStream"),o=e("jSkype/modelHelpers/personsAndGroupsHelper");t.build=function(e,t){return new u(e,t.id())}}),define("jSkype/models/participant",["require","jcafe-property-model","swx-enums","jSkype/models/participantAudio","jSkype/models/participantVideo","jSkype/models/participantChat","jSkype/models/participantScreenSharing"],function(e){function u(e){return/^guest:/.test(e)}function a(e){return e.chat.state()===n.callConnectionState.Disconnected&&e.audio.state()===n.callConnectionState.Disconnected&&e.video.state()===n.callConnectionState.Disconnected&&e.screenSharing.state()===n.callConnectionState.Disconnected?n.participantState.Disconnected:n.participantState.Connected}function f(e,f,l){function d(){c.state._set(a(c))}function v(e){c.isAnonymous._set(u(e))}function m(e){h(e===n.participantRole.Leader)}function g(e){return c.role()===e||!n.participantRole[e]?c.role():(l.addParticipant(f.conversationId,c.person.id(),e),e)}var c=this,h=t.boolProperty(f.selfParticipant&&f.selfParticipant.role()===n.participantRole.Leader),p=t.command(g,h);c.isAnonymous=t.property({readOnly:!0,value:u(e.id())}),c.role=t.property({value:n.participantRole.Attendee,set:p}),f.selfParticipant&&f.selfParticipant.role.changed(m),c.person=e,c.chat=s.build(f),c.audio=r.build(f,e),c.video=i.build(f,e),c.screenSharing=o.build(f,e),c.lastReadTimestamp=t.property({readOnly:!0,value:null}),c.state=t.property({readOnly:!0,value:a(c)}),c.chat.state.changed(d),c.audio.state.changed(d),c.video.state.changed(d),c.screenSharing.state.changed(d),e.id.changed(v),c._dispose=function(){c.chat.state.changed.off(d),c.audio.state.changed.off(d),c.video.state.changed.off(d),c.screenSharing.state.changed.off(d),f.selfParticipant.role.changed.off(m),c.chat._dispose(),c.audio._dispose(),c.video._dispose(),c.screenSharing._dispose(),e.id.changed.off(v)}}var t=e("jcafe-property-model"),n=e("swx-enums"),r=e("jSkype/models/participantAudio"),i=e("jSkype/models/participantVideo"),s=e("jSkype/models/participantChat"),o=e("jSkype/models/participantScreenSharing");return f}),define("utils/chat/urlValidator",["require","lodash-compat","constants/common"],function(e){function s(e){return e.toString().replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function o(e){var t=s(e);return t=t.replace("\\*\\*","[^\\/]*"),t=t.replace("\\*","[^.\\/]*"),t=t.replace("\\?","."),"^"+t+"$"}function u(e){if(t.isUndefined(e))throw new Error("`undefined` is not a valid argument");return e===n?t.isUndefined:t.isFunction(e)?e:(t.isRegExp(e)||(e=new RegExp(o(e),"i")),e.test.bind(e))}function a(e){var t,n;return e=e.toString().trim(),n=e.split("#",2)[1],e=e.split("#",2)[0],t=i.exec(e),t&&{scheme:t[1],user:t[2],host:t[3],port:t[4],path:t[5],query:t[6],hash:n}}function f(e,n){var i,s;return e?(i=t.extend(t.clone(r),n||{}),s=a(e),s?!t.isEmpty(i.allowedProtocols)&&!t.any(i.allowedProtocols,function(e){return u(e)(s.scheme)})?!1:!t.isEmpty(i.allowedDomains)&&!t.any(i.allowedDomains,function(e){return u(e)(s.host)})?!1:!t.isEmpty(i.allowedPorts)&&!t.any(i.allowedPorts,function(e){return u(e)(s.port)})?!1:!0:!1):!1}var t=e("lodash-compat"),n=e("constants/common").urlValidator.ALLOW_EMPTY,r={allowedDomains:["**"],allowedProtocols:[n,"http","https"],allowedPorts:[n]},i=/^(?:([^:\/?#]+):)?(?:\/\/(?:([\S]*)(?:[\@]))?([^\/\\?:#]*)(?:\:(\d*)?)?)?([^?#]*)(?:(?:\?)([^#]*))?(?:#(.*))?/;return{validate:f,ALLOW_EMPTY:n,$unit:{escapeRegExp:s,wildcardToRegExp:o,asMatcher:u,explodeURL:a}}}),define("jSkype/services/asyncMedia/main",["require","exports","module","jSkype/client","reqwest","jSkype/settings"],function(e,t){function d(e,i,s,u,a,f){function p(t){var n=t.scan&&t.scan.status!=="in progress"&&t.scan.status!=="ready",r=t.view_state==="ready"&&!t.scan,c=t.view_state==="ready"&&t.scan&&t.scan.status==="passed";t.status_location&&!t.view_state?(e=t.status_location.replace("/views/"+i+"/status",""),d(e,i,s,u,a,f)):r||c?a(l):t.view_state==="failed"||n?f():t.content_state!=="expired"?d(e,i,o,u,a,f):f()}function v(r){r.status===401||r.status===403?(u--,n.get().signInManager._skypeToken().then(function(n){t.authenticate(n).then(d.bind(null,e,i,s,u,a,f))})):f()}var l=e+"/views/"+i,c=l+"/status",h={url:c,dataType:"json",crossOrigin:!0,withCredentials:!0};if(u===0){f();return}setTimeout(function(){r.compat(h).then(p,v)},s)}function v(e,t,n){var s,o=n.isImage(),u={},a=y(n);return u[e]=["read"],s={type:a.type,permissions:u},o||(s.filename=n.name),r.compat({method:"post",dataType:"json",url:i.settings.amdServiceHost+"/v1/objects",data:JSON.stringify(s),headers:{Authorization:"skype_token "+t},contentType:"application/json",crossOrigin:!0,withCredentials:!0})}function m(){return{type:"pish/image",thumbnail:a,content:l,original:f}}function g(){return{type:"sharing/file",thumbnail:h,content:c,original:c}}function y(e){return e.isImage()?m():g()}function b(e,t,n,r,s,o,u){function c(e){o(e,f)}var a=i.settings.amdServiceHost+"/v1/objects/"+e,f=new XMLHttpRequest,l=y(t);f.upload.addEventListener("progress",c),f.open("PUT",a+"/content/"+l.content,!0),f.setRequestHeader("Authorization","skype_token "+n),f.setRequestHeader("Content-Type","multipart/form-data"),f.send(t),f.onreadystatechange=function(){f.readyState===4&&(f.status===201?E(t,a,function(){u(a+"/views/"+l.thumbnail),r(e)},function(){s("Unsupported Media Type")}):s("Can't upload file"))}}function w(e,t,n,s){var o=i.settings.amdServiceHost+"/v1/objects/"+e,u={url:o,method:"DELETE",crossOrigin:!0,dataType:"json",headers:{Authorization:"skype_token "+t}};r.compat(u).then(n,s)}function E(e,t,n,r){d(t,y(e).thumbnail,s,u,n,r)}var n=e("jSkype/client"),r=e("reqwest"),i=e("jSkype/settings"),s=0,o=500,u=3,a="imgt1",f="imgpsh_fullsize",l="imgpsh",c="original",h="thumbnail",p="video";t.getThumbnailStatus=function(e,t,n){d(e,a,s,u,t,n)},t.getPictureStatus=function(e,t,n){d(e,f,s,u,t,n)},t.getVideoStatus=function(e,t,n){d(e,p,s,u,t,n)},t.authenticate=function(e){var t;return t={method:"post",dataType:"json",url:i.settings.amdServiceHost+"/v1/skypetokenauth",data:"skypetoken="+e,contentType:"application/x-www-form-urlencoded",crossOrigin:!0,withCredentials:!0},r.compat(t)},t.sendFile=function(e,t,r,i,s,o){n.get().signInManager._skypeToken().then(function(n){v(e,n,t).then(function(e){b(e.id,t,n,r,i,s,o)},function(){i("Can't retrieve documentId")})},function(){i("Can't retrieve Skype token")})},t.deleteFile=function(e,t,r){n.get().signInManager._skypeToken().then(function(n){w(e,n,t,r)},function(){r("Can't retrieve Skype token")})}}),define("services/ecs/jsonp",["require","browser/window","swx-utils-common","experience/settings"],function(e){function s(e,s,o,u,a){var f,l,c;a=a||"callback";if(!e||!s)throw"mandatory options missing";c=function(){t.clearTimeout(l),u&&(u(),u=null,o=null)},f=e+(/\?/.test(e)?"&":"?")+a+"=Skype."+s,t.Skype[s]=function(){t.clearTimeout(l),o&&(o.apply(null,arguments),o=null),t.Skype[s]=null,u=null},n.loadScript(f,i,c),l=t.setTimeout(c,r.jsonpTimeout||2e4)}var t=e("browser/window"),n=e("swx-utils-common").loader,r=e("experience/settings"),i=function(){};return{request:s}}),define("services/ecs/configLoader",["require","lodash-compat","experience/settings","services/ecs/jsonp","reqwest"],function(e){function s(){function a(){var e=n.version.split(".",4);while(e.length<4)e.push("0");return e[3]=e[2],e[2]=n.ecsClientCobrandTag,u+"_"+e.join(".")}function f(e){function r(t,n){return e[n]?t.concat([n,e[n]].join("=")):t}var n=t.keys(e).reduce(r,[]);if(n.length>0)return n.join("&")}function l(e,t,n,r,i){var s=a(),o=f(r),u=t+"/config/v1/"+e+"/"+s+"/"+n,l="?";return n.indexOf(l)>-1&&(l="&"),o&&(u+=l+o,l="&"),i&&(u+=l+"id="+i),u}function c(e,t,r,i){var s,o=[],u={};n.initParams&&n.initParams.apiKey&&(u.apikey=n.initParams.apiKey);for(s=0;s<t.length;s++)o.push(l(e,t[s],r,u,i));return o}function h(){return t.isString(n.ecsHosts)?JSON.parse(n.ecsHosts):n.ecsHosts||[]}var e=this,s=2,o=1,u=908;e.loadConfig=function(e,t,u){var a=h(),f=c(e,a,t,u);return new Promise(function(e,t){function c(o){function h(t){e(t)}function p(){var e=u/f.length>=s,n;e?t(new Error("configuration service unreachable")):(a+=1,n=a%f.length,c(f[n]))}u++;if(n.initParams.jsonp===!1){var d={url:o,method:"GET",crossOrigin:!0,dataType:"json"};i.compat(d).then(h,p)}else r.request(o,"onConfigurationLoaded_"+l,h,p)}var u=0,a=0,l=o;o+=1,!f||!f.length?t(new Error("no configuration service endpoint")):(c(f[a]),a+=1)})}}var t=e("lodash-compat"),n=e("experience/settings"),r=e("services/ecs/jsonp"),i=e("reqwest");return new s}),define("services/pes/tabs/stylesFactory",[],function(){function e(){function t(e){var t="\n.swx span.tabs.tab.id_"+e.id+"\n";return t+="{\n",t+=" -ms-high-contrast-adjust: none;\n",t+=" background-image: url('"+e.thumbnailUrl+"'); \n",t+="} \n",t}var e=this;e.create=function(e){return t(e)}}return new e}),define("services/pes/constants",["require","browser/detect"],function(e){function n(){var e=t.getScreenInfo().pixelRatio>1;this.CACHE_KEY="swx|pes",this.SAVED_DATA_VERSION="v1.0",this.FEATURED_IN_PREFIX="FeaturedIn-",this.itemTypes={typeKeyName:"type",tab:{id:"tab",ariaLabelLocKey:"expressionPicker_mruTab_ariaLabel",titleLocKey:"expressionPicker_mruTab_title"},emoticon:{id:"emoticon",ariaLabelLocKey:"expressionPicker_mruEmoticonPack_ariaLabel",titleLocKey:"expressionPicker_mruEmoticonPack_title",mruLimit:27},moji:{id:"flik",ariaLabelLocKey:"expressionPicker_mruMojiPack_ariaLabel",titleLocKey:"expressionPicker_mruMojiPack_title",mruLimit:10},image:{id:"image"},message:{id:"message"},sticker:{id:"sticker"}},this.itemTypes.flik=this.itemTypes.moji,this.mru={TAB_ID:"mru",PACK_PREFIX:"mru:"},this.bingSearch={TAB_ID:"bing",PACK_PREFIX:"bing:"},this.giphyImageSearch={TAB_ID:"giphyImages",PACK_PREFIX:"giphy-imh:"},this.localSearch={TAB_ID:"localSearch",PACK_PREFIX:"local:",titleLocKey:"expressionPicker_localSearchPack_title",ariaLabelLocKey:"expressionPicker_localSearchPack_ariaLabel"},this.frameHeights={emoticons:{SMALL:20,LARGE:40,EXTRA_LARGE:80},moji:{THUMBNAIL:40,KEYFRAME:80},packs:{TAB:19}},this.profiles={emoticons:{getSmall:function(){return e?"default_40":"default_20"},getLarge:function(){return e?"default_80":"default_40"},getExtraLarge:function(){return e?"default_160":"default_80"},getSmallAnimated:function(){return e?"default_40_anim":"default_20_anim"},getLargeAnimated:function(){return e?"default_80_anim":"default_40_anim"},getExtraLargeAnimated:function(){return e?"default_160_anim":"default_80_anim"}},moji:{thumbnail:"thumbnail",content:"default"}}}var t=e("browser/detect");return new n}),function(){(function(n){var x=this||(0,eval)("this"),u=x.document,M=x.navigator,v=x.jQuery,F=x.JSON;(function(e){"function"==typeof define&&define.amd?define("vendor/knockout",["exports","require"],e):"object"==typeof exports&&"object"==typeof module?e(module.exports||exports):e(x.ko={})})(function(e,t){function r(e,t){return null===e||typeof e in h?e===t:!1}function i(e,t){var r;return function(){r||(r=c.a.setTimeout(function(){r=n,e()},t))}}function s(e,t){var n;return function(){clearTimeout(n),n=c.a.setTimeout(e,t)}}function o(e,t){t&&t!==p?"beforeChange"===t?this.Kb(e):this.Ha(e,t):this.Lb(e)}function a(e,t){null!==t&&t.k&&t.k()}function f(e,t){var n=this.Hc,r=n[b];r.R||(this.lb&&this.Ma[t]?(n.Pb(t,e,this.Ma[t]),this.Ma[t]=null,--this.lb):r.r[t]||n.Pb(t,e,r.s?{ia:e}:n.uc(e)))}function l(e,t,n,r){c.d[e]={init:function(e,i,s,o,u){var a,f;return c.m(function(){var s=c.a.c(i()),o=!n!=!s,l=!f;if(l||t||o!==a)l&&c.va.Aa()&&(f=c.a.ua(c.f.childNodes(e),!0)),o?(l||c.f.da(e,c.a.ua(f)),c.eb(r?r(u,s):u,e)):c.f.xa(e),a=o},null,{i:e}),{controlsDescendantBindings:!0}}},c.h.ta[e]=!1,c.f.Z[e]=!0}var c="undefined"!=typeof e?e:{};c.b=function(e,t){for(var n=e.split("."),r=c,i=0;i<n.length-1;i++)r=r[n[i]];r[n[n.length-1]]=t},c.G=function(e,t,n){e[t]=n},c.version="3.4.0",c.b("version",c.version),c.options={deferUpdates:!1,useOnlyNativeEvents:!1},c.a=function(){function e(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}function t(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function r(e,t){return e.__proto__=t,e}function i(e,t,n,r){var i=e[t].match(p)||[];c.a.q(n.match(p),function(e){c.a.pa(i,e,r)}),e[t]=i.join(" ")}var s={__proto__:[]}instanceof Array,o="function"==typeof Symbol,a={},f={};a[M&&/Firefox\/2/i.test(M.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],a.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" "),e(a,function(e,t){if(t.length)for(var n=0,r=t.length;n<r;n++)f[t[n]]=e});var l={propertychange:!0},h=u&&function(){for(var e=3,t=u.createElement("div"),r=t.getElementsByTagName("i");t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->",r[0];);return 4<e?e:n}(),p=/\S+/g;return{cc:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],q:function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)},o:function(e,t){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},Sb:function(e,t,n){for(var r=0,i=e.length;r<i;r++)if(t.call(n,e[r],r))return e[r];return null},La:function(e,t){var n=c.a.o(e,t);0<n?e.splice(n,1):0===n&&e.shift()},Tb:function(e){e=e||[];for(var t=[],n=0,r=e.length;n<r;n++)0>c.a.o(t,e[n])&&t.push(e[n]);return t},fb:function(e,t){e=e||[];for(var n=[],r=0,i=e.length;r<i;r++)n.push(t(e[r],r));return n},Ka:function(e,t){e=e||[];for(var n=[],r=0,i=e.length;r<i;r++)t(e[r],r)&&n.push(e[r]);return n},ra:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var n=0,r=t.length;n<r;n++)e.push(t[n]);return e},pa:function(e,t,n){var r=c.a.o(c.a.zb(e),t);0>r?n&&e.push(t):n||e.splice(r,1)},ka:s,extend:t,Xa:r,Ya:s?r:t,D:e,Ca:function(e,t){if(!e)return e;var n={},r;for(r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r],r,e));return n},ob:function(e){for(;e.firstChild;)c.removeNode(e.firstChild)},jc:function(e){e=c.a.V(e);for(var t=(e[0]&&e[0].ownerDocument||u).createElement("div"),n=0,r=e.length;n<r;n++)t.appendChild(c.$(e[n]));return t},ua:function(e,t){for(var n=0,r=e.length,i=[];n<r;n++){var s=e[n].cloneNode(!0);i.push(t?c.$(s):s)}return i},da:function(e,t){c.a.ob(e);if(t)for(var n=0,r=t.length;n<r;n++)e.appendChild(t[n])},qc:function(e,t){var n=e.nodeType?[e]:e;if(0<n.length){for(var r=n[0],i=r.parentNode,s=0,o=t.length;s<o;s++)i.insertBefore(t[s],r);s=0;for(o=n.length;s<o;s++)c.removeNode(n[s])}},za:function(e,t){if(e.length){for(t=8===t.nodeType&&t.parentNode||t;e.length&&e[0].parentNode!==t;)e.splice(0,1);for(;1<e.length&&e[e.length-1].parentNode!==t;)e.length--;if(1<e.length){var n=e[0],r=e[e.length-1];for(e.length=0;n!==r;)e.push(n),n=n.nextSibling;e.push(r)}}return e},sc:function(e,t){7>h?e.setAttribute("selected",t):e.selected=t},$a:function(e){return null===e||e===n?"":e.trim?e.trim():e.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},nd:function(e,t){return e=e||"",t.length>e.length?!1:e.substring(0,t.length)===t},Mc:function(e,t){if(e===t)return!0;if(11===e.nodeType)return!1;if(t.contains)return t.contains(3===e.nodeType?e.parentNode:e);if(t.compareDocumentPosition)return 16==(t.compareDocumentPosition(e)&16);for(;e&&e!=t;)e=e.parentNode;return!!e},nb:function(e){return c.a.Mc(e,e.ownerDocument.documentElement)},Qb:function(e){return!!c.a.Sb(e,c.a.nb)},A:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},Wb:function(e){return c.onError?function(){try{return e.apply(this,arguments)}catch(t){throw c.onError&&c.onError(t),t}}:e},setTimeout:function(e,t){return setTimeout(c.a.Wb(e),t)},$b:function(e){setTimeout(function(){throw c.onError&&c.onError(e),e},0)},p:function(e,t,n){var r=c.a.Wb(n);n=h&&l[t];if(c.options.useOnlyNativeEvents||n||!v)if(n||"function"!=typeof e.addEventListener){if("undefined"==typeof e.attachEvent)throw Error("Browser doesn't support addEventListener or attachEvent");var i=function(t){r.call(e,t)},s="on"+t;e.attachEvent(s,i),c.a.F.oa(e,function(){e.detachEvent(s,i)})}else e.addEventListener(t,r,!1);else v(e).bind(t,r)},Da:function(e,t){if(!e||!e.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var n;"input"===c.a.A(e)&&e.type&&"click"==t.toLowerCase()?(n=e.type,n="checkbox"==n||"radio"==n):n=!1;if(c.options.useOnlyNativeEvents||!v||n)if("function"==typeof u.createEvent){if("function"!=typeof e.dispatchEvent)throw Error("The supplied element doesn't support dispatchEvent");n=u.createEvent(f[t]||"HTMLEvents"),n.initEvent(t,!0,!0,x,0,0,0,0,0,!1,!1,!1,!1,0,e),e.dispatchEvent(n)}else if(n&&e.click)e.click();else{if("undefined"==typeof e.fireEvent)throw Error("Browser doesn't support triggering events");e.fireEvent("on"+t)}else v(e).trigger(t)},c:function(e){return c.H(e)?e():e},zb:function(e){return c.H(e)?e.t():e},bb:function(e,t,n){var r;t&&("object"==typeof e.classList?(r=e.classList[n?"add":"remove"],c.a.q(t.match(p),function(t){r.call(e.classList,t)})):"string"==typeof e.className.baseVal?i(e.className,"baseVal",t,n):i(e,"className",t,n))},Za:function(e,t){var r=c.a.c(t);if(null===r||r===n)r="";var i=c.f.firstChild(e);!i||3!=i.nodeType||c.f.nextSibling(i)?c.f.da(e,[e.ownerDocument.createTextNode(r)]):i.data=r,c.a.Rc(e)},rc:function(e,t){e.name=t;if(7>=h)try{e.mergeAttributes(u.createElement("<input name='"+e.name+"'/>"),!1)}catch(n){}},Rc:function(e){9<=h&&(e=1==e.nodeType?e:e.parentNode,e.style&&(e.style.zoom=e.style.zoom))},Nc:function(e){if(h){var t=e.style.width;e.style.width=0,e.style.width=t}},hd:function(e,t){e=c.a.c(e),t=c.a.c(t);for(var n=[],r=e;r<=t;r++)n.push(r);return n},V:function(e){for(var t=[],n=0,r=e.length;n<r;n++)t.push(e[n]);return t},Yb:function(e){return o?Symbol(e):e},rd:6===h,sd:7===h,C:h,ec:function(e,t){for(var n=c.a.V(e.getElementsByTagName("input")).concat(c.a.V(e.getElementsByTagName("textarea"))),r="string"==typeof t?function(e){return e.name===t}:function(e){return t.test(e.name)},i=[],s=n.length-1;0<=s;s--)r(n[s])&&i.push(n[s]);return i},ed:function(e){return"string"==typeof e&&(e=c.a.$a(e))?F&&F.parse?F.parse(e):(new Function("return "+e))():null},Eb:function(e,t,n){if(!F||!F.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return F.stringify(c.a.c(e),t,n)},fd:function(t,n,r){r=r||{};var i=r.params||{},s=r.includeFields||this.cc,o=t;if("object"==typeof t&&"form"===c.a.A(t))for(var o=t.action,a=s.length-1;0<=a;a--)for(var f=c.a.ec(t,s[a]),l=f.length-1;0<=l;l--)i[f[l].name]=f[l].value;n=c.a.c(n);var h=u.createElement("form");h.style.display="none",h.action=o,h.method="post";for(var p in n)t=u.createElement("input"),t.type="hidden",t.name=p,t.value=c.a.Eb(c.a.c(n[p])),h.appendChild(t);e(i,function(e,t){var n=u.createElement("input");n.type="hidden",n.name=e,n.value=t,h.appendChild(n)}),u.body.appendChild(h),r.submitter?r.submitter(h):h.submit(),setTimeout(function(){h.parentNode.removeChild(h)},0)}}}(),c.b("utils",c.a),c.b("utils.arrayForEach",c.a.q),c.b("utils.arrayFirst",c.a.Sb),c.b("utils.arrayFilter",c.a.Ka),c.b("utils.arrayGetDistinctValues",c.a.Tb),c.b("utils.arrayIndexOf",c.a.o),c.b("utils.arrayMap",c.a.fb),c.b("utils.arrayPushAll",c.a.ra),c.b("utils.arrayRemoveItem",c.a.La),c.b("utils.extend",c.a.extend),c.b("utils.fieldsIncludedWithJsonPost",c.a.cc),c.b("utils.getFormFields",c.a.ec),c.b("utils.peekObservable",c.a.zb),c.b("utils.postJson",c.a.fd),c.b("utils.parseJson",c.a.ed),c.b("utils.registerEventHandler",c.a.p),c.b("utils.stringifyJson",c.a.Eb),c.b("utils.range",c.a.hd),c.b("utils.toggleDomNodeCssClass",c.a.bb),c.b("utils.triggerEvent",c.a.Da),c.b("utils.unwrapObservable",c.a.c),c.b("utils.objectForEach",c.a.D),c.b("utils.addOrRemoveItem",c.a.pa),c.b("utils.setTextContent",c.a.Za),c.b("unwrap",c.a.c),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if(1===arguments.length)return function(){return t.apply(e,arguments)};var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice(0);return r.push.apply(r,arguments),t.apply(e,r)}}),c.a.e=new function(){function e(e,s){var o=e[r];if(!o||"null"===o||!i[o]){if(!s)return n;o=e[r]="ko"+t++,i[o]={}}return i[o]}var t=0,r="__ko__"+(new Date).getTime(),i={};return{get:function(t,r){var i=e(t,!1);return i===n?n:i[r]},set:function(t,r,i){if(i!==n||e(t,!1)!==n)e(t,!0)[r]=i},clear:function(e){var t=e[r];return t?(delete i[t],e[r]=null,!0):!1},I:function(){return t++ +r}}},c.b("utils.domData",c.a.e),c.b("utils.domData.clear",c.a.e.clear),c.a.F=new function(){function e(e,t){var i=c.a.e.get(e,r);return i===n&&t&&(i=[],c.a.e.set(e,r,i)),i}function t(n){var r=e(n,!1);if(r)for(var r=r.slice(0),i=0;i<r.length;i++)r[i](n);c.a.e.clear(n),c.a.F.cleanExternalData(n);if(s[n.nodeType])for(r=n.firstChild;n=r;)r=n.nextSibling,8===n.nodeType&&t(n)}var r=c.a.e.I(),i={1:!0,8:!0,9:!0},s={1:!0,9:!0};return{oa:function(t,n){if("function"!=typeof n)throw Error("Callback must be a function");e(t,!0).push(n)},pc:function(t,i){var s=e(t,!1);s&&(c.a.La(s,i),0==s.length&&c.a.e.set(t,r,n))},$:function(e){if(i[e.nodeType]&&(t(e),s[e.nodeType])){var n=[];c.a.ra(n,e.getElementsByTagName("*"));for(var r=0,o=n.length;r<o;r++)t(n[r])}return e},removeNode:function(e){c.$(e),e.parentNode&&e.parentNode.removeChild(e)},cleanExternalData:function(e){v&&"function"==typeof v.cleanData&&v.cleanData([e])}}},c.$=c.a.F.$,c.removeNode=c.a.F.removeNode,c.b("cleanNode",c.$),c.b("removeNode",c.removeNode),c.b("utils.domNodeDisposal",c.a.F),c.b("utils.domNodeDisposal.addDisposeCallback",c.a.F.oa),c.b("utils.domNodeDisposal.removeDisposeCallback",c.a.F.pc),function(){var e=[0,"",""],t=[1,"<table>","</table>"],r=[3,"<table><tbody><tr>","</tr></tbody></table>"],i=[1,"<select multiple='multiple'>","</select>"],s={thead:t,tbody:t,tfoot:t,tr:[2,"<table><tbody>","</tbody></table>"],td:r,th:r,option:i,optgroup:i},o=8>=c.a.C;c.a.ma=function(t,n){var r;if(v){if(v.parseHTML)r=v.parseHTML(t,n)||[];else if((r=v.clean([t],n))&&r[0]){for(var i=r[0];i.parentNode&&11!==i.parentNode.nodeType;)i=i.parentNode;i.parentNode&&i.parentNode.removeChild(i)}}else{(r=n)||(r=u);var i=r.parentWindow||r.defaultView||x,a=c.a.$a(t).toLowerCase(),f=r.createElement("div"),l;l=(a=a.match(/^<([a-z]+)[ >]/))&&s[a[1]]||e,a=l[0],l="ignored<div>"+l[1]+t+l[2]+"</div>","function"==typeof i.innerShiv?f.appendChild(i.innerShiv(l)):(o&&r.appendChild(f),f.innerHTML=l,o&&f.parentNode.removeChild(f));for(;a--;)f=f.lastChild;r=c.a.V(f.lastChild.childNodes)}return r},c.a.Cb=function(e,t){c.a.ob(e),t=c.a.c(t);if(null!==t&&t!==n)if("string"!=typeof t&&(t=t.toString()),v)v(e).html(t);else for(var r=c.a.ma(t,e.ownerDocument),i=0;i<r.length;i++)e.appendChild(r[i])}}(),c.b("utils.parseHtmlFragment",c.a.ma),c.b("utils.setHtml",c.a.Cb),c.M=function(){function e(t,n){if(t)if(8==t.nodeType){var r=c.M.lc(t.nodeValue);null!=r&&n.push({Lc:t,cd:r})}else if(1==t.nodeType)for(var r=0,i=t.childNodes,s=i.length;r<s;r++)e(i[r],n)}var t={};return{wb:function(e){if("function"!=typeof e)throw Error("You can only pass a function to ko.memoization.memoize()");var n=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return t[n]=e,"<!--[ko_memo:"+n+"]-->"},xc:function(e,r){var i=t[e];if(i===n)throw Error("Couldn't find any memo with ID "+e+". Perhaps it's already been unmemoized.");try{return i.apply(null,r||[]),!0}finally{delete t[e]}},yc:function(t,n){var r=[];e(t,r);for(var i=0,s=r.length;i<s;i++){var o=r[i].Lc,u=[o];n&&c.a.ra(u,n),c.M.xc(r[i].cd,u),o.nodeValue="",o.parentNode&&o.parentNode.removeChild(o)}},lc:function(e){return(e=e.match(/^\[ko_memo\:(.*?)\]$/))?e[1]:null}}}(),c.b("memoization",c.M),c.b("memoization.memoize",c.M.wb),c.b("memoization.unmemoize",c.M.xc),c.b("memoization.parseMemoText",c.M.lc),c.b("memoization.unmemoizeDomNodeAndDescendants",c.M.yc),c.Y=function(){function e(){if(r)for(var e=r,t=0,i;s<r;)if(i=n[s++]){if(s>e){if(5e3<=++t){s=r,c.a.$b(Error("'Too much recursion' after processing "+t+" task groups."));break}e=r}try{i()}catch(o){c.a.$b(o)}}}function t(){e(),s=r=n.length=0}var n=[],r=0,i=1,s=0;return{scheduler:x.MutationObserver?function(e){var t=u.createElement("div");return(new MutationObserver(e)).observe(t,{attributes:!0}),function(){t.classList.toggle("foo")}}(t):u&&"onreadystatechange"in u.createElement("script")?function(e){var t=u.createElement("script");t.onreadystatechange=function(){t.onreadystatechange=null,u.documentElement.removeChild(t),t=null,e()},u.documentElement.appendChild(t)}:function(e){setTimeout(e,0)},Wa:function(e){return r||c.Y.scheduler(t),n[r++]=e,i++},cancel:function(e){e-=i-r,e>=s&&e<r&&(n[e]=null)},resetForTesting:function(){var e=r-s;return s=r=n.length=0,e},md:e}}(),c.b("tasks",c.Y),c.b("tasks.schedule",c.Y.Wa),c.b("tasks.runEarly",c.Y.md),c.ya={throttle:function(e,t){e.throttleEvaluation=t;var n=null;return c.B({read:e,write:function(r){clearTimeout(n),n=c.a.setTimeout(function(){e(r)},t)}})},rateLimit:function(e,t){var n,r,o;"number"==typeof t?n=t:(n=t.timeout,r=t.method),e.cb=!1,o="notifyWhenChangesStop"==r?s:i,e.Ta(function(e){return o(e,n)})},deferred:function(e,t){if(!0!==t)throw Error("The 'deferred' extender only accepts the value 'true', because it is not supported to turn deferral off once enabled.");e.cb||(e.cb=!0,e.Ta(function(t){var r;return function(){c.Y.cancel(r),r=c.Y.Wa(t),e.notifySubscribers(n,"dirty")}}))},notify:function(e,t){e.equalityComparer="always"==t?null:r}};var h={"undefined":1,"boolean":1,number:1,string:1};c.b("extenders",c.ya),c.vc=function(e,t,n){this.ia=e,this.gb=t,this.Kc=n,this.R=!1,c.G(this,"dispose",this.k)},c.vc.prototype.k=function(){this.R=!0,this.Kc()},c.J=function(){c.a.Ya(this,d),d.rb(this)};var p="change",d={rb:function(e){e.K={},e.Nb=1},X:function(e,t,n){var r=this;n=n||p;var i=new c.vc(r,t?e.bind(t):e,function(){c.a.La(r.K[n],i),r.Ia&&r.Ia(n)});return r.sa&&r.sa(n),r.K[n]||(r.K[n]=[]),r.K[n].push(i),i},notifySubscribers:function(e,t){t=t||p,t===p&&this.zc();if(this.Pa(t))try{c.l.Ub();for(var n=this.K[t].slice(0),r=0,i;i=n[r];++r)i.R||i.gb(e)}finally{c.l.end()}},Na:function(){return this.Nb},Uc:function(e){return this.Na()!==e},zc:function(){++this.Nb},Ta:function(e){var t=this,n=c.H(t),r,i,s;t.Ha||(t.Ha=t.notifySubscribers,t.notifySubscribers=o);var u=e(function(){t.Mb=!1,n&&s===t&&(s=t()),r=!1,t.tb(i,s)&&t.Ha(i=s)});t.Lb=function(e){t.Mb=r=!0,s=e,u()},t.Kb=function(e){r||(i=e,t.Ha(e,"beforeChange"))}},Pa:function(e){return this.K[e]&&this.K[e].length},Sc:function(e){if(e)return this.K[e]&&this.K[e].length||0;var t=0;return c.a.D(this.K,function(e,n){"dirty"!==e&&(t+=n.length)}),t},tb:function(e,t){return!this.equalityComparer||!this.equalityComparer(e,t)},extend:function(e){var t=this;return e&&c.a.D(e,function(e,n){var r=c.ya[e];"function"==typeof r&&(t=r(t,n)||t)}),t}};c.G(d,"subscribe",d.X),c.G(d,"extend",d.extend),c.G(d,"getSubscriptionsCount",d.Sc),c.a.ka&&c.a.Xa(d,Function.prototype),c.J.fn=d,c.hc=function(e){return null!=e&&"function"==typeof e.X&&"function"==typeof e.notifySubscribers},c.b("subscribable",c.J),c.b("isSubscribable",c.hc),c.va=c.l=function(){function e(e){n.push(r),r=e}function t(){r=n.pop()}var n=[],r,i=0;return{Ub:e,end:t,oc:function(e){if(r){if(!c.hc(e))throw Error("Only subscribable things can act as dependencies");r.gb.call(r.Gc,e,e.Cc||(e.Cc=++i))}},w:function(n,r,i){try{return e(),n.apply(r,i||[])}finally{t()}},Aa:function(){if(r)return r.m.Aa()},Sa:function(){if(r)return r.Sa}}}(),c.b("computedContext",c.va),c.b("computedContext.getDependenciesCount",c.va.Aa),c.b("computedContext.isInitial",c.va.Sa),c.b("ignoreDependencies",c.qd=c.l.w);var m=c.a.Yb("_latestValue");c.N=function(e){function t(){return 0<arguments.length?(t.tb(t[m],arguments[0])&&(t.ga(),t[m]=arguments[0],t.fa()),this):(c.l.oc(t),t[m])}return t[m]=e,c.a.ka||c.a.extend(t,c.J.fn),c.J.fn.rb(t),c.a.Ya(t,g),c.options.deferUpdates&&c.ya.deferred(t,!0),t};var g={equalityComparer:r,t:function(){return this[m]},fa:function(){this.notifySubscribers(this[m])},ga:function(){this.notifySubscribers(this[m],"beforeChange")}};c.a.ka&&c.a.Xa(g,c.J.fn);var y=c.N.gd="__ko_proto__";g[y]=c.N,c.Oa=function(e,t){return null===e||e===n||e[y]===n?!1:e[y]===t?!0:c.Oa(e[y],t)},c.H=function(e){return c.Oa(e,c.N)},c.Ba=function(e){return"function"==typeof e&&e[y]===c.N||"function"==typeof e&&e[y]===c.B&&e.Vc?!0:!1},c.b("observable",c.N),c.b("isObservable",c.H),c.b("isWriteableObservable",c.Ba),c.b("isWritableObservable",c.Ba),c.b("observable.fn",g),c.G(g,"peek",g.t),c.G(g,"valueHasMutated",g.fa),c.G(g,"valueWillMutate",g.ga),c.la=function(e){e=e||[];if("object"==typeof e&&"length"in e)return e=c.N(e),c.a.Ya(e,c.la.fn),e.extend({trackArrayChanges:!0});throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.")},c.la.fn={remove:function(e){for(var t=this.t(),n=[],r="function"!=typeof e||c.H(e)?function(t){return t===e}:e,i=0;i<t.length;i++){var s=t[i];r(s)&&(0===n.length&&this.ga(),n.push(s),t.splice(i,1),i--)}return n.length&&this.fa(),n},removeAll:function(e){if(e===n){var t=this.t(),r=t.slice(0);return this.ga(),t.splice(0,t.length),this.fa(),r}return e?this.remove(function(t){return 0<=c.a.o(e,t)}):[]},destroy:function(e){var t=this.t(),n="function"!=typeof e||c.H(e)?function(t){return t===e}:e;this.ga();for(var r=t.length-1;0<=r;r--)n(t[r])&&(t[r]._destroy=!0);this.fa()},destroyAll:function(e){return e===n?this.destroy(function(){return!0}):e?this.destroy(function(t){return 0<=c.a.o(e,t)}):[]},indexOf:function(e){var t=this();return c.a.o(t,e)},replace:function(e,t){var n=this.indexOf(e);0<=n&&(this.ga(),this.t()[n]=t,this.fa())}},c.a.ka&&c.a.Xa(c.la.fn,c.N.fn),c.a.q("pop push reverse shift sort splice unshift".split(" "),function(e){c.la.fn[e]=function(){var t=this.t();this.ga(),this.Vb(t,e,arguments);var n=t[e].apply(t,arguments);return this.fa(),n===t?this:n}}),c.a.q(["slice"],function(e){c.la.fn[e]=function(){var t=this();return t[e].apply(t,arguments)}}),c.b("observableArray",c.la),c.ya.trackArrayChanges=function(e,t){function n(){if(!r){r=!0;var t=e.notifySubscribers;e.notifySubscribers=function(e,n){return n&&n!==p||++o,t.apply(this,arguments)};var n=[].concat(e.t()||[]);i=null,s=e.X(function(t){t=[].concat(t||[]);if(e.Pa("arrayChange")){var r;if(!i||1<o)i=c.a.ib(n,t,e.hb);r=i}n=t,i=null,o=0,r&&r.length&&e.notifySubscribers(r,"arrayChange")})}}e.hb={},t&&"object"==typeof t&&c.a.extend(e.hb,t),e.hb.sparse=!0;if(!e.Vb){var r=!1,i=null,s,o=0,u=e.sa,a=e.Ia;e.sa=function(t){u&&u.call(e,t),"arrayChange"===t&&n()},e.Ia=function(t){a&&a.call(e,t),"arrayChange"!==t||e.Pa("arrayChange")||(s.k(),r=!1)},e.Vb=function(e,t,n){function s(e,t,n){return u[u.length]={status:e,value:t,index:n}}if(r&&!o){var u=[],a=e.length,f=n.length,l=0;switch(t){case"push":l=a;case"unshift":for(t=0;t<f;t++)s("added",n[t],l+t);break;case"pop":l=a-1;case"shift":a&&s("deleted",e[l],l);break;case"splice":t=Math.min(Math.max(0,0>n[0]?a+n[0]:n[0]),a);for(var a=1===f?a:Math.min(t+(n[1]||0),a),f=t+f-2,l=Math.max(a,f),h=[],p=[],d=2;t<l;++t,++d)t<a&&p.push(s("deleted",e[t],t)),t<f&&h.push(s("added",n[d],t));c.a.dc(p,h);break;default:return}i=u}}}};var b=c.a.Yb("_state");c.m=c.B=function(e,t,r){function i(){if(0<arguments.length){if("function"!=typeof s)throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return s.apply(o.pb,arguments),this}return c.l.oc(i),(o.S||o.s&&i.Qa())&&i.aa(),o.T}"object"==typeof e?r=e:(r=r||{},e&&(r.read=e));if("function"!=typeof r.read)throw Error("Pass a function that returns the value of the ko.computed");var s=r.write,o={T:n,S:!0,Ra:!1,Fb:!1,R:!1,Va:!1,s:!1,jd:r.read,pb:t||r.owner,i:r.disposeWhenNodeIsRemoved||r.i||null,wa:r.disposeWhen||r.wa,mb:null,r:{},L:0,bc:null};return i[b]=o,i.Vc="function"==typeof s,c.a.ka||c.a.extend(i,c.J.fn),c.J.fn.rb(i),c.a.Ya(i,w),r.pure?(o.Va=!0,o.s=!0,c.a.extend(i,E)):r.deferEvaluation&&c.a.extend(i,S),c.options.deferUpdates&&c.ya.deferred(i,!0),o.i&&(o.Fb=!0,o.i.nodeType||(o.i=null)),o.s||r.deferEvaluation||i.aa(),o.i&&i.ba()&&c.a.F.oa(o.i,o.mb=function(){i.k()}),i};var w={equalityComparer:r,Aa:function(){return this[b].L},Pb:function(e,t,n){if(this[b].Va&&t===this)throw Error("A 'pure' computed must not be called recursively");this[b].r[e]=n,n.Ga=this[b].L++,n.na=t.Na()},Qa:function(){var e,t,n=this[b].r;for(e in n)if(n.hasOwnProperty(e)&&(t=n[e],t.ia.Uc(t.na)))return!0},bd:function(){this.Fa&&!this[b].Ra&&this.Fa()},ba:function(){return this[b].S||0<this[b].L},ld:function(){this.Mb||this.ac()},uc:function(e){if(e.cb&&!this[b].i){var t=e.X(this.bd,this,"dirty"),n=e.X(this.ld,this);return{ia:e,k:function(){t.k(),n.k()}}}return e.X(this.ac,this)},ac:function(){var e=this,t=e.throttleEvaluation;t&&0<=t?(clearTimeout(this[b].bc),this[b].bc=c.a.setTimeout(function(){e.aa(!0)},t)):e.Fa?e.Fa():e.aa(!0)},aa:function(e){var t=this[b],n=t.wa;if(!t.Ra&&!t.R){if(t.i&&!c.a.nb(t.i)||n&&n()){if(!t.Fb){this.k();return}}else t.Fb=!1;t.Ra=!0;try{this.Qc(e)}finally{t.Ra=!1}t.L||this.k()}},Qc:function(e){var t=this[b],r=t.Va?n:!t.L,i={Hc:this,Ma:t.r,lb:t.L};c.l.Ub({Gc:i,gb:f,m:this,Sa:r}),t.r={},t.L=0,i=this.Pc(t,i),this.tb(t.T,i)&&(t.s||this.notifySubscribers(t.T,"beforeChange"),t.T=i,t.s?this.zc():e&&this.notifySubscribers(t.T)),r&&this.notifySubscribers(t.T,"awake")},Pc:function(e,t){try{var n=e.jd;return e.pb?n.call(e.pb):n()}finally{c.l.end(),t.lb&&!e.s&&c.a.D(t.Ma,a),e.S=!1}},t:function(){var e=this[b];return(e.S&&!e.L||e.s&&this.Qa())&&this.aa(),e.T},Ta:function(e){c.J.fn.Ta.call(this,e),this.Fa=function(){this.Kb(this[b].T),this[b].S=!0,this.Lb(this)}},k:function(){var e=this[b];!e.s&&e.r&&c.a.D(e.r,function(e,t){t.k&&t.k()}),e.i&&e.mb&&c.a.F.pc(e.i,e.mb),e.r=null,e.L=0,e.R=!0,e.S=!1,e.s=!1,e.i=null}},E={sa:function(e){var t=this,n=t[b];if(!n.R&&n.s&&"change"==e){n.s=!1;if(n.S||t.Qa())n.r=null,n.L=0,n.S=!0,t.aa();else{var r=[];c.a.D(n.r,function(e,t){r[t.Ga]=e}),c.a.q(r,function(e,r){var i=n.r[e],s=t.uc(i.ia);s.Ga=r,s.na=i.na,n.r[e]=s})}n.R||t.notifySubscribers(n.T,"awake")}},Ia:function(e){var t=this[b];t.R||"change"!=e||this.Pa("change")||(c.a.D(t.r,function(e,n){n.k&&(t.r[e]={ia:n.ia,Ga:n.Ga,na:n.na},n.k())}),t.s=!0,this.notifySubscribers(n,"asleep"))},Na:function(){var e=this[b];return e.s&&(e.S||this.Qa())&&this.aa(),c.J.fn.Na.call(this)}},S={sa:function(e){"change"!=e&&"beforeChange"!=e||this.t()}};c.a.ka&&c.a.Xa(w,c.J.fn);var T=c.N.gd;c.m[T]=c.N,w[T]=c.m,c.Xc=function(e){return c.Oa(e,c.m)},c.Yc=function(e){return c.Oa(e,c.m)&&e[b]&&e[b].Va},c.b("computed",c.m),c.b("dependentObservable",c.m),c.b("isComputed",c.Xc),c.b("isPureComputed",c.Yc),c.b("computed.fn",w),c.G(w,"peek",w.t),c.G(w,"dispose",w.k),c.G(w,"isActive",w.ba),c.G(w,"getDependenciesCount",w.Aa),c.nc=function(e,t){return"function"==typeof e?c.m(e,t,{pure:!0}):(e=c.a.extend({},e),e.pure=!0,c.m(e,t))},c.b("pureComputed",c.nc),function(){function e(i,s,o){o=o||new r,i=s(i);if("object"!=typeof i||null===i||i===n||i instanceof RegExp||i instanceof Date||i instanceof String||i instanceof Number||i instanceof Boolean)return i;var u=i instanceof Array?[]:{};return o.save(i,u),t(i,function(t){var r=s(i[t]);switch(typeof r){case"boolean":case"number":case"string":case"function":u[t]=r;break;case"object":case"undefined":var a=o.get(r);u[t]=a!==n?a:e(r,s,o)}}),u}function t(e,t){if(e instanceof Array){for(var n=0;n<e.length;n++)t(n);"function"==typeof e.toJSON&&t("toJSON")}else for(n in e)t(n)}function r(){this.keys=[],this.Ib=[]}c.wc=function(t){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return e(t,function(e){for(var t=0;c.H(e)&&10>t;t++)e=e();return e})},c.toJSON=function(e,t,n){return e=c.wc(e),c.a.Eb(e,t,n)},r.prototype={save:function(e,t){var n=c.a.o(this.keys,e);0<=n?this.Ib[n]=t:(this.keys.push(e),this.Ib.push(t))},get:function(e){return e=c.a.o(this.keys,e),0<=e?this.Ib[e]:n}}}(),c.b("toJS",c.wc),c.b("toJSON",c.toJSON),function(){c.j={u:function(e){switch(c.a.A(e)){case"option":return!0===e.__ko__hasDomDataOptionValue__?c.a.e.get(e,c.d.options.xb):7>=c.a.C?e.getAttributeNode("value")&&e.getAttributeNode("value").specified?e.value:e.text:e.value;case"select":return 0<=e.selectedIndex?c.j.u(e.options[e.selectedIndex]):n;default:return e.value}},ha:function(e,t,r){switch(c.a.A(e)){case"option":switch(typeof t){case"string":c.a.e.set(e,c.d.options.xb,n),"__ko__hasDomDataOptionValue__"in e&&delete e.__ko__hasDomDataOptionValue__,e.value=t;break;default:c.a.e.set(e,c.d.options.xb,t),e.__ko__hasDomDataOptionValue__=!0,e.value="number"==typeof t?t:""}break;case"select":if(""===t||null===t)t=n;for(var i=-1,s=0,o=e.options.length,u;s<o;++s)if(u=c.j.u(e.options[s]),u==t||""==u&&t===n){i=s;break}if(r||0<=i||t===n&&1<e.size)e.selectedIndex=i;break;default:if(null===t||t===n)t="";e.value=t}}}}(),c.b("selectExtensions",c.j),c.b("selectExtensions.readValue",c.j.u),c.b("selectExtensions.writeValue",c.j.ha),c.h=function(){function e(e){e=c.a.$a(e),123===e.charCodeAt(0)&&(e=e.slice(1,-1));var t=[],n=e.match(r),o,u=[],a=0;if(n){n.push(",");for(var f=0,l;l=n[f];++f){var h=l.charCodeAt(0);if(44===h){if(0>=a){t.push(o&&u.length?{key:o,value:u.join("")}:{unknown:o||u.join("")}),o=a=0,u=[];continue}}else if(58===h){if(!a&&!o&&1===u.length){o=u.pop();continue}}else 47===h&&f&&1<l.length?(h=n[f-1].match(i))&&!s[h[0]]&&(e=e.substr(e.indexOf(l)+1),n=e.match(r),n.push(","),f=-1,l="/"):40===h||123===h||91===h?++a:41===h||125===h||93===h?--a:o||u.length||34!==h&&39!==h||(l=l.slice(1,-1));u.push(l)}}return t}var t=["true","false","null","undefined"],n=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,r=RegExp("\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*'|/(?:[^/\\\\]|\\\\.)*/w*|[^\\s:,/][^,\"'{}()/:[\\]]*[^\\s,\"'{}()/:[\\]]|[^\\s]","g"),i=/[\])"'A-Za-z0-9_$]+$/,s={"in":1,"return":1,"typeof":1},o={};return{ta:[],ea:o,yb:e,Ua:function(r,i){function s(e,r){var i;if(!l){var h=c.getBindingHandler(e);if(h&&h.preprocess&&!(r=h.preprocess(r,e,s)))return;if(h=o[e])i=r,0<=c.a.o(t,i)?i=!1:(h=i.match(n),i=null===h?!1:h[1]?"Object("+h[1]+")"+h[2]:i),h=i;h&&a.push("'"+e+"':function(_z){"+i+"=_z}")}f&&(r="function(){return "+r+" }"),u.push("'"+e+"':"+r)}i=i||{};var u=[],a=[],f=i.valueAccessors,l=i.bindingParams,h="string"==typeof r?e(r):r;return c.a.q(h,function(e){s(e.key||e.unknown,e.value)}),a.length&&s("_ko_property_writers","{"+a.join(",")+" }"),u.join(",")},ad:function(e,t){for(var n=0;n<e.length;n++)if(e[n].key==t)return!0;return!1},Ea:function(e,t,n,r,i){e&&c.H(e)?!c.Ba(e)||i&&e.t()===r||e(r):(e=t.get("_ko_property_writers"))&&e[n]&&e[n](r)}}}(),c.b("expressionRewriting",c.h),c.b("expressionRewriting.bindingRewriteValidators",c.h.ta),c.b("expressionRewriting.parseObjectLiteral",c.h.yb),c.b("expressionRewriting.preProcessBindings",c.h.Ua),c.b("expressionRewriting._twoWayBindings",c.h.ea),c.b("jsonExpressionRewriting",c.h),c.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",c.h.Ua),function(){function e(e){return 8==e.nodeType&&s.test(i?e.text:e.nodeValue)}function t(e){return 8==e.nodeType&&o.test(i?e.text:e.nodeValue)}function n(n,r){for(var i=n,s=1,o=[];i=i.nextSibling;){if(t(i)&&(s--,0===s))return o;o.push(i),e(i)&&s++}if(!r)throw Error("Cannot find closing comment tag to match: "+n.nodeValue);return null}function r(e,t){var r=n(e,t);return r?0<r.length?r[r.length-1].nextSibling:e.nextSibling:null}var i=u&&"<!--test-->"===u.createComment("test").text,s=i?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,o=i?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,a={ul:!0,ol:!0};c.f={Z:{},childNodes:function(t){return e(t)?n(t):t.childNodes},xa:function(t){if(e(t)){t=c.f.childNodes(t);for(var n=0,r=t.length;n<r;n++)c.removeNode(t[n])}else c.a.ob(t)},da:function(t,n){if(e(t)){c.f.xa(t);for(var r=t.nextSibling,i=0,s=n.length;i<s;i++)r.parentNode.insertBefore(n[i],r)}else c.a.da(t,n)},mc:function(t,n){e(t)?t.parentNode.insertBefore(n,t.nextSibling):t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n)},gc:function(t,n,r){r?e(t)?t.parentNode.insertBefore(n,r.nextSibling):r.nextSibling?t.insertBefore(n,r.nextSibling):t.appendChild(n):c.f.mc(t,n)},firstChild:function(n){return e(n)?!n.nextSibling||t(n.nextSibling)?null:n.nextSibling:n.firstChild},nextSibling:function(n){return e(n)&&(n=r(n)),n.nextSibling&&t(n.nextSibling)?null:n.nextSibling},Tc:e,pd:function(e){return(e=(i?e.text:e.nodeValue).match(s))?e[1]:null},kc:function(n){if(a[c.a.A(n)]){var i=n.firstChild;if(i)do if(1===i.nodeType){var s;s=i.firstChild;var o=null;if(s)do if(o)o.push(s);else if(e(s)){var u=r(s,!0);u?s=u:o=[s]}else t(s)&&(o=[s]);while(s=s.nextSibling);if(s=o)for(o=i.nextSibling,u=0;u<s.length;u++)o?n.insertBefore(s[u],o):n.appendChild(s[u])}while(i=i.nextSibling)}}}}(),c.b("virtualElements",c.f),c.b("virtualElements.allowedBindings",c.f.Z),c.b("virtualElements.emptyNode",c.f.xa),c.b("virtualElements.insertAfter",c.f.gc),c.b("virtualElements.prepend",c.f.mc),c.b("virtualElements.setDomNodeChildren",c.f.da),function(){c.Q=function(){this.Fc={}},c.a.extend(c.Q.prototype,{nodeHasBindings:function(e){switch(e.nodeType){case 1:return null!=e.getAttribute("data-bind")||c.g.getComponentNameForNode(e);case 8:return c.f.Tc(e);default:return!1}},getBindings:function(e,t){var n=this.getBindingsString(e,t),n=n?this.parseBindingsString(n,t,e):null;return c.g.Ob(n,e,t,!1)},getBindingAccessors:function(e,t){var n=this.getBindingsString(e,t),n=n?this.parseBindingsString(n,t,e,{valueAccessors:!0}):null;return c.g.Ob(n,e,t,!0)},getBindingsString:function(e){switch(e.nodeType){case 1:return e.getAttribute("data-bind");case 8:return c.f.pd(e);default:return null}},parseBindingsString:function(e,t,n,r){try{var i=this.Fc,s=e+(r&&r.valueAccessors||""),o;if(!(o=i[s])){var u,a="with($context){with($data||{}){return{"+c.h.Ua(e,r)+"}}}";u=new Function("$context","$element",a),o=i[s]=u}return o(t,n)}catch(f){throw f.message="Unable to parse bindings.\nBindings value: "+e+"\nMessage: "+f.message,f}}}),c.Q.instance=new c.Q}(),c.b("bindingProvider",c.Q),function(){function e(e){return function(){return e}}function t(e){return e()}function r(e){return c.a.Ca(c.l.w(e),function(t,n){return function(){return e()[n]}})}function i(t,n,i){return"function"==typeof t?r(t.bind(null,n,i)):c.a.Ca(t,e)}function s(e,t){return r(this.getBindings.bind(this,e,t))}function o(e,t,n){var r,i=c.f.firstChild(t),s=c.Q.instance,o=s.preprocessNode;if(o){for(;r=i;)i=c.f.nextSibling(r),o.call(s,r);i=c.f.firstChild(t)}for(;r=i;)i=c.f.nextSibling(r),u(e,r,n)}function u(e,t,n){var r=!0,i=1===t.nodeType;i&&c.f.kc(t);if(i&&n||c.Q.instance.nodeHasBindings(t))r=f(t,null,e,n).shouldBindDescendants;r&&!h[c.a.A(t)]&&o(e,t,!i)}function a(e){var t=[],n={},r=[];return c.a.D(e,function i(s){if(!n[s]){var o=c.getBindingHandler(s);o&&(o.after&&(r.push(s),c.a.q(o.after,function(t){if(e[t]){if(-1!==c.a.o(r,t))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+r.join(", "));i(t)}}),r.length--),t.push({key:s,fc:o})),n[s]=!0}}),t}function f(e,r,i,o){var u=c.a.e.get(e,p);if(!r){if(u)throw Error("You cannot apply bindings multiple times to the same element.");c.a.e.set(e,p,!0)}!u&&o&&c.tc(e,i);var f;if(r&&"function"!=typeof r)f=r;else{var l=c.Q.instance,h=l.getBindingAccessors||s,d=c.B(function(){return(f=r?r(i,e):h.call(l,e,i))&&i.P&&i.P(),f},null,{i:e});f&&d.ba()||(d=null)}var v;if(f){var m=d?function(e){return function(){return t(d()[e])}}:function(e){return f[e]},g=function(){return c.a.Ca(d?d():f,t)};g.get=function(e){return f[e]&&t(m(e))},g.has=function(e){return e in f},o=a(f),c.a.q(o,function(t){var r=t.fc.init,s=t.fc.update,o=t.key;if(8===e.nodeType&&!c.f.Z[o])throw Error("The binding '"+o+"' cannot be used with virtual elements");try{"function"==typeof r&&c.l.w(function(){var t=r(e,m(o),g,i.$data,i);if(t&&t.controlsDescendantBindings){if(v!==n)throw Error("Multiple bindings ("+v+" and "+o+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");v=o}}),"function"==typeof s&&c.B(function(){s(e,m(o),g,i.$data,i)},null,{i:e})}catch(u){throw u.message='Unable to process binding "'+o+": "+f[o]+'"\nMessage: '+u.message,u}})}return{shouldBindDescendants:v===n}}function l(e){return e&&e instanceof c.U?e:new c.U(e)}c.d={};var h={script:!0,textarea:!0,template:!0};c.getBindingHandler=function(e){return c.d[e]},c.U=function(e,t,r,i){var s=this,o="function"==typeof e&&!c.H(e),u,a=c.B(function(){var n=o?e():e,u=c.a.c(n);return t?(t.P&&t.P(),c.a.extend(s,t),a&&(s.P=a)):(s.$parents=[],s.$root=u,s.ko=c),s.$rawData=n,s.$data=u,r&&(s[r]=u),i&&i(s,t,u),s.$data},null,{wa:function(){return u&&!c.a.Qb(u)},i:!0});a.ba()&&(s.P=a,a.equalityComparer=null,u=[],a.Ac=function(e){u.push(e),c.a.F.oa(e,function(e){c.a.La(u,e),u.length||(a.k(),s.P=a=n)})})},c.U.prototype.createChildContext=function(e,t,n){return new c.U(e,this,t,function(e,t){e.$parentContext=t,e.$parent=t.$data,e.$parents=(t.$parents||[]).slice(0),e.$parents.unshift(e.$parent),n&&n(e)})},c.U.prototype.extend=function(e){return new c.U(this.P||this.$data,this,null,function(t,n){t.$rawData=n.$rawData,c.a.extend(t,"function"==typeof e?e():e)})};var p=c.a.e.I(),d=c.a.e.I();c.tc=function(e,t){if(2!=arguments.length)return c.a.e.get(e,d);c.a.e.set(e,d,t),t.P&&t.P.Ac(e)},c.Ja=function(e,t,n){return 1===e.nodeType&&c.f.kc(e),f(e,t,l(n),!0)},c.Dc=function(e,t,n){return n=l(n),c.Ja(e,i(t,n,e),n)},c.eb=function(e,t){1!==t.nodeType&&8!==t.nodeType||o(l(e),t,!0)},c.Rb=function(e,t){!v&&x.jQuery&&(v=x.jQuery);if(t&&1!==t.nodeType&&8!==t.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");t=t||x.document.body,u(l(e),t,!0)},c.kb=function(e){switch(e.nodeType){case 1:case 8:var t=c.tc(e);if(t)return t;if(e.parentNode)return c.kb(e.parentNode)}return n},c.Jc=function(e){return(e=c.kb(e))?e.$data:n},c.b("bindingHandlers",c.d),c.b("applyBindings",c.Rb),c.b("applyBindingsToDescendants",c.eb),c.b("applyBindingAccessorsToNode",c.Ja),c.b("applyBindingsToNode",c.Dc),c.b("contextFor",c.kb),c.b("dataFor",c.Jc)}(),function(e){function t(t,r){var o=i.hasOwnProperty(t)?i[t]:e,u;o?o.X(r):(o=i[t]=new c.J,o.X(r),n(t,function(e,n){var r=!!n&&!!n.synchronous;s[t]={definition:e,Zc:r},delete i[t],u||r?o.notifySubscribers(e):c.Y.Wa(function(){o.notifySubscribers(e)})}),u=!0)}function n(e,t){r("getConfig",[e],function(n){n?r("loadComponent",[e,n],function(e){t(e,n)}):t(null,null)})}function r(t,n,i,s){s||(s=c.g.loaders.slice(0));var o=s.shift();if(o){var u=o[t];if(u){var a=!1;if(u.apply(o,n.concat(function(e){a?i(null):null!==e?i(e):r(t,n,i,s)}))!==e&&(a=!0,!o.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.")}else r(t,n,i,s)}else i(null)}var i={},s={};c.g={get:function(n,r){var i=s.hasOwnProperty(n)?s[n]:e;i?i.Zc?c.l.w(function(){r(i.definition)}):c.Y.Wa(function(){r(i.definition)}):t(n,r)},Xb:function(e){delete s[e]},Jb:r},c.g.loaders=[],c.b("components",c.g),c.b("components.get",c.g.get),c.b("components.clearCachedDefinition",c.g.Xb)}(),function(){function e(e,t,n,r){function i(){0===--u&&r(o)}var o={},u=2,a=n.template;n=n.viewModel,a?s(t,a,function(t){c.g.Jb("loadTemplate",[e,t],function(e){o.template=e,i()})}):i(),n?s(t,n,function(t){c.g.Jb("loadViewModel",[e,t],function(e){o[f]=e,i()})}):i()}function n(e,t,r){if("function"==typeof t)r(function(e){return new t(e)});else if("function"==typeof t[f])r(t[f]);else if("instance"in t){var i=t.instance;r(function(){return i})}else"viewModel"in t?n(e,t.viewModel,r):e("Unknown viewModel value: "+t)}function r(e){switch(c.a.A(e)){case"script":return c.a.ma(e.text);case"textarea":return c.a.ma(e.value);case"template":if(i(e.content))return c.a.ua(e.content.childNodes)}return c.a.ua(e.childNodes)}function i(e){return x.DocumentFragment?e instanceof DocumentFragment:e&&11===e.nodeType}function s(e,n,r){"string"==typeof n.require?t||x.require?(t||x.require)([n.require],r):e("Uses require, but no AMD loader is present"):r(n)}function o(e){return function(t){throw Error("Component '"+e+"': "+t)}}var a={};c.g.register=function(e,t){if(!t)throw Error("Invalid configuration for "+e);if(c.g.ub(e))throw Error("Component "+e+" is already registered");a[e]=t},c.g.ub=function(e){return a.hasOwnProperty(e)},c.g.od=function(e){delete a[e],c.g.Xb(e)},c.g.Zb={getConfig:function(e,t){t(a.hasOwnProperty(e)?a[e]:null)},loadComponent:function(t,n,r){var i=o(t);s(i,n,function(n){e(t,i,n,r)})},loadTemplate:function(e,t,n){e=o(e);if("string"==typeof t)n(c.a.ma(t));else if(t instanceof Array)n(t);else if(i(t))n(c.a.V(t.childNodes));else if(t.element)if(t=t.element,x.HTMLElement?t instanceof HTMLElement:t&&t.tagName&&1===t.nodeType)n(r(t));else if("string"==typeof t){var s=u.getElementById(t);s?n(r(s)):e("Cannot find element with ID "+t)}else e("Unknown element type: "+t);else e("Unknown template value: "+t)},loadViewModel:function(e,t,r){n(o(e),t,r)}};var f="createViewModel";c.b("components.register",c.g.register),c.b("components.isRegistered",c.g.ub),c.b("components.unregister",c.g.od),c.b("components.defaultLoader",c.g.Zb),c.g.loaders.push(c.g.Zb),c.g.Bc=a}(),function(){function e(e,n){var r=e.getAttribute("params");if(r){var r=t.parseBindingsString(r,n,e,{valueAccessors:!0,bindingParams:!0}),r=c.a.Ca(r,function(t){return c.m(t,null,{i:e})}),i=c.a.Ca(r,function(t){var n=t.t();return t.ba()?c.m({read:function(){return c.a.c(t())},write:c.Ba(n)&&function(e){t()(e)},i:e}):n});return i.hasOwnProperty("$raw")||(i.$raw=r),i}return{$raw:{}}}c.g.getComponentNameForNode=function(e){var t=c.a.A(e);if(c.g.ub(t)&&(-1!=t.indexOf("-")||"[object HTMLUnknownElement]"==""+e||8>=c.a.C&&e.tagName===t))return t},c.g.Ob=function(t,n,r,i){if(1===n.nodeType){var s=c.g.getComponentNameForNode(n);if(s){t=t||{};if(t.component)throw Error('Cannot use the "component" binding on a custom element matching a component');var o={name:s,params:e(n,r)};t.component=i?function(){return o}:o}}return t};var t=new c.Q;9>c.a.C&&(c.g.register=function(e){return function(t){return u.createElement(t),e.apply(this,arguments)}}(c.g.register),u.createDocumentFragment=function(e){return function(){var t=e(),n=c.g.Bc,r;for(r in n)n.hasOwnProperty(r)&&t.createElement(r);return t}}(u.createDocumentFragment))}(),function(e){function t(e,t,n){t=t.template;if(!t)throw Error("Component '"+e+"' has no template");e=c.a.ua(t),c.f.da(n,e)}function n(e,t,n,r){var i=e.createViewModel;return i?i.call(e,r,{element:t,templateNodes:n}):r}var r=0;c.d.component={init:function(i,s,o,u,a){function f(){var e=l&&l.dispose;"function"==typeof e&&e.call(l),h=l=null}var l,h,p=c.a.V(c.f.childNodes(i));return c.a.F.oa(i,f),c.m(function(){var o=c.a.c(s()),u,d;"string"==typeof o?u=o:(u=c.a.c(o.name),d=c.a.c(o.params));if(!u)throw Error("No component name specified");var v=h=++r;c.g.get(u,function(r){if(h===v){f();if(!r)throw Error("Unknown component '"+u+"'");t(u,r,i);var s=n(r,i,p,d);r=a.createChildContext(s,e,function(e){e.$component=s,e.$componentTemplateNodes=p}),l=s,c.eb(r,i)}})},null,{i:i}),{controlsDescendantBindings:!0}}},c.f.Z.component=!0}();var N={"class":"className","for":"htmlFor"};c.d.attr={update:function(e,t){var r=c.a.c(t())||{};c.a.D(r,function(t,r){r=c.a.c(r);var i=!1===r||null===r||r===n;i&&e.removeAttribute(t),8>=c.a.C&&t in N?(t=N[t],i?e.removeAttribute(t):e[t]=r):i||e.setAttribute(t,r.toString()),"name"===t&&c.a.rc(e,i?"":r.toString())})}},function(){c.d.checked={after:["value","attr"],init:function(e,t,r){function i(){var n=e.checked,i=d?o():n;if(!c.va.Sa()&&(!a||n)){var s=c.l.w(t);if(l){var u=h?s.t():s;p!==i?(n&&(c.a.pa(u,i,!0),c.a.pa(u,p,!1)),p=i):c.a.pa(u,i,n),h&&c.Ba(s)&&s(u)}else c.h.Ea(s,r,"checked",i,!0)}}function s(){var n=c.a.c(t());e.checked=l?0<=c.a.o(n,o()):u?n:o()===n}var o=c.nc(function(){return r.has("checkedValue")?c.a.c(r.get("checkedValue")):r.has("value")?c.a.c(r.get("value")):e.value}),u="checkbox"==e.type,a="radio"==e.type;if(u||a){var f=t(),l=u&&c.a.c(f)instanceof Array,h=!(l&&f.push&&f.splice),p=l?o():n,d=a||l;a&&!e.name&&c.d.uniqueName.init(e,function(){return!0}),c.m(i,null,{i:e}),c.a.p(e,"click",i),c.m(s,null,{i:e}),f=n}}},c.h.ea.checked=!0,c.d.checkedValue={update:function(e,t){e.value=c.a.c(t())}}}(),c.d.css={update:function(e,t){var n=c.a.c(t());null!==n&&"object"==typeof n?c.a.D(n,function(t,n){n=c.a.c(n),c.a.bb(e,t,n)}):(n=c.a.$a(String(n||"")),c.a.bb(e,e.__ko__cssValue,!1),e.__ko__cssValue=n,c.a.bb(e,n,!0))}},c.d.enable={update:function(e,t){var n=c.a.c(t());n&&e.disabled?e.removeAttribute("disabled"):n||e.disabled||(e.disabled=!0)}},c.d.disable={update:function(e,t){c.d.enable.update(e,function(){return!c.a.c(t())})}},c.d.event={init:function(e,t,n,r,i){var s=t()||{};c.a.D(s,function(s){"string"==typeof s&&c.a.p(e,s,function(e){var o,u=t()[s];if(u){try{var a=c.a.V(arguments);r=i.$data,a.unshift(r),o=u.apply(r,a)}finally{!0!==o&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}!1===n.get(s+"Bubble")&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())}})})}},c.d.foreach={ic:function(e){return function(){var t=e(),n=c.a.zb(t);return!n||"number"==typeof n.length?{foreach:t,templateEngine:c.W.sb}:(c.a.c(t),{foreach:n.data,as:n.as,includeDestroyed:n.includeDestroyed,afterAdd:n.afterAdd,beforeRemove:n.beforeRemove,afterRender:n.afterRender,beforeMove:n.beforeMove,afterMove:n.afterMove,templateEngine:c.W.sb})}},init:function(e,t){return c.d.template.init(e,c.d.foreach.ic(t))},update:function(e,t,n,r,i){return c.d.template.update(e,c.d.foreach.ic(t),n,r,i)}},c.h.ta.foreach=!1,c.f.Z.foreach=!0,c.d.hasfocus={init:function(e,t,n){function r(r){e.__ko_hasfocusUpdating=!0;var i=e.ownerDocument;if("activeElement"in i){var s;try{s=i.activeElement}catch(o){s=i.body}r=s===e}i=t(),c.h.Ea(i,n,"hasfocus",r,!0),e.__ko_hasfocusLastValue=r,e.__ko_hasfocusUpdating=!1}var i=r.bind(null,!0),s=r.bind(null,!1);c.a.p(e,"focus",i),c.a.p(e,"focusin",i),c.a.p(e,"blur",s),c.a.p(e,"focusout",s)},update:function(e,t){var n=!!c.a.c(t());e.__ko_hasfocusUpdating||e.__ko_hasfocusLastValue===n||(n?e.focus():e.blur(),!n&&e.__ko_hasfocusLastValue&&e.ownerDocument.body.focus(),c.l.w(c.a.Da,null,[e,n?"focusin":"focusout"]))}},c.h.ea.hasfocus=!0,c.d.hasFocus=c.d.hasfocus,c.h.ea.hasFocus=!0,c.d.html={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){c.a.Cb(e,t())}},l("if"),l("ifnot",!1,!0),l("with",!0,!1,function(e,t){return e.createChildContext(t)});var C={};c.d.options={init:function(e){if("select"!==c.a.A(e))throw Error("options binding applies only to SELECT elements");for(;0<e.length;)e.remove(0);return{controlsDescendantBindings:!0}},update:function(e,t,r){function i(){return c.a.Ka(e.options,function(e){return e.selected})}function s(e,t,n){var r=typeof t;return"function"==r?t(e):"string"==r?e[t]:n}function o(t,n){if(v&&l)c.j.ha(e,c.a.c(r.get("value")),!0);else if(d.length){var i=0<=c.a.o(d,c.j.u(n[0]));c.a.sc(n[0],i),v&&!i&&c.l.w(c.a.Da,null,[e,"change"])}}var u=e.multiple,a=0!=e.length&&u?e.scrollTop:null,f=c.a.c(t()),l=r.get("valueAllowUnset")&&r.has("value"),h=r.get("optionsIncludeDestroyed");t={};var p,d=[];l||(u?d=c.a.fb(i(),c.j.u):0<=e.selectedIndex&&d.push(c.j.u(e.options[e.selectedIndex]))),f&&("undefined"==typeof f.length&&(f=[f]),p=c.a.Ka(f,function(e){return h||e===n||null===e||!c.a.c(e._destroy)}),r.has("optionsCaption")&&(f=c.a.c(r.get("optionsCaption")),null!==f&&f!==n&&p.unshift(C)));var v=!1;t.beforeRemove=function(t){e.removeChild(t)},f=o,r.has("optionsAfterRender")&&"function"==typeof r.get("optionsAfterRender")&&(f=function(e,t){o(0,t),c.l.w(r.get("optionsAfterRender"),null,[t[0],e!==C?e:n])}),c.a.Bb(e,p,function(t,i,o){return o.length&&(d=!l&&o[0].selected?[c.j.u(o[0])]:[],v=!0),i=e.ownerDocument.createElement("option"),t===C?(c.a.Za(i,r.get("optionsCaption")),c.j.ha(i,n)):(o=s(t,r.get("optionsValue"),t),c.j.ha(i,c.a.c(o)),t=s(t,r.get("optionsText"),o),c.a.Za(i,t)),[i]},t,f),c.l.w(function(){l?c.j.ha(e,c.a.c(r.get("value")),!0):(u?d.length&&i().length<d.length:d.length&&0<=e.selectedIndex?c.j.u(e.options[e.selectedIndex])!==d[0]:d.length||0<=e.selectedIndex)&&c.a.Da(e,"change")}),c.a.Nc(e),a&&20<Math.abs(a-e.scrollTop)&&(e.scrollTop=a)}},c.d.options.xb=c.a.e.I(),c.d.selectedOptions={after:["options","foreach"],init:function(e,t,n){c.a.p(e,"change",function(){var r=t(),i=[];c.a.q(e.getElementsByTagName("option"),function(e){e.selected&&i.push(c.j.u(e))}),c.h.Ea(r,n,"selectedOptions",i)})},update:function(e,t){if("select"!=c.a.A(e))throw Error("values binding applies only to SELECT elements");var n=c.a.c(t()),r=e.scrollTop;n&&"number"==typeof n.length&&c.a.q(e.getElementsByTagName("option"),function(e){var t=0<=c.a.o(n,c.j.u(e));e.selected!=t&&c.a.sc(e,t)}),e.scrollTop=r}},c.h.ea.selectedOptions=!0,c.d.style={update:function(e,t){var r=c.a.c(t()||{});c.a.D(r,function(t,r){r=c.a.c(r);if(null===r||r===n||!1===r)r="";e.style[t]=r})}},c.d.submit={init:function(e,t,n,r,i){if("function"!=typeof t())throw Error("The value for a submit binding must be a function");c.a.p(e,"submit",function(n){var r,s=t();try{r=s.call(i.$data,e)}finally{!0!==r&&(n.preventDefault?n.preventDefault():n.returnValue=!1)}})}},c.d.text={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){c.a.Za(e,t())}},c.f.Z.text=!0,function(){if(x&&x.navigator)var e=function(e){if(e)return parseFloat(e[1])},t=x.opera&&x.opera.version&&parseInt(x.opera.version()),r=x.navigator.userAgent,i=e(r.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),s=e(r.match(/Firefox\/([^ ]*)/));if(10>c.a.C)var o=c.a.e.I(),u=c.a.e.I(),a=function(e){var t=this.activeElement;(t=t&&c.a.e.get(t,u))&&t(e)},f=function(e,t){var n=e.ownerDocument;c.a.e.get(n,o)||(c.a.e.set(n,o,!0),c.a.p(n,"selectionchange",a)),c.a.e.set(e,u,t)};c.d.textInput={init:function(e,r,o){function u(t,n){c.a.p(e,t,n)}function a(){var t=c.a.c(r());if(null===t||t===n)t="";v!==n&&t===v?c.a.setTimeout(a,4):e.value!==t&&(p=t,e.value=t)}function l(){d||(v=e.value,d=c.a.setTimeout(h,4))}function h(){clearTimeout(d),v=d=n;var t=e.value;p!==t&&(p=t,c.h.Ea(r(),o,"textInput",t))}var p=e.value,d,v,m=9==c.a.C?l:h;10>c.a.C?(u("propertychange",function(e){"value"===e.propertyName&&m(e)}),8==c.a.C&&(u("keyup",h),u("keydown",h)),8<=c.a.C&&(f(e,m),u("dragend",l))):(u("input",h),5>i&&"textarea"===c.a.A(e)?(u("keydown",l),u("paste",l),u("cut",l)):11>t?u("keydown",l):4>s&&(u("DOMAutoComplete",h),u("dragdrop",h),u("drop",h))),u("change",h),c.m(a,null,{i:e})}},c.h.ea.textInput=!0,c.d.textinput={preprocess:function(e,t,n){n("textInput",e)}}}(),c.d.uniqueName={init:function(e,t){if(t()){var n="ko_unique_"+ ++c.d.uniqueName.Ic;c.a.rc(e,n)}}},c.d.uniqueName.Ic=0,c.d.value={after:["options","foreach"],init:function(e,t,n){if("input"!=e.tagName.toLowerCase()||"checkbox"!=e.type&&"radio"!=e.type){var r=["change"],i=n.get("valueUpdate"),s=!1,o=null;i&&("string"==typeof i&&(i=[i]),c.a.ra(r,i),r=c.a.Tb(r));var u=function(){o=null,s=!1;var r=t(),i=c.j.u(e);c.h.Ea(r,n,"value",i)};!c.a.C||"input"!=e.tagName.toLowerCase()||"text"!=e.type||"off"==e.autocomplete||e.form&&"off"==e.form.autocomplete||-1!=c.a.o(r,"propertychange")||(c.a.p(e,"propertychange",function(){s=!0}),c.a.p(e,"focus",function(){s=!1}),c.a.p(e,"blur",function(){s&&u()})),c.a.q(r,function(t){var n=u;c.a.nd(t,"after")&&(n=function(){o=c.j.u(e),c.a.setTimeout(u,0)},t=t.substring(5)),c.a.p(e,t,n)});var a=function(){var r=c.a.c(t()),i=c.j.u(e);if(null!==o&&r===o)c.a.setTimeout(a,0);else if(r!==i)if("select"===c.a.A(e)){var s=n.get("valueAllowUnset"),i=function(){c.j.ha(e,r,s)};i(),s||r===c.j.u(e)?c.a.setTimeout(i,0):c.l.w(c.a.Da,null,[e,"change"])}else c.j.ha(e,r)};c.m(a,null,{i:e})}else c.Ja(e,{checkedValue:t})},update:function(){}},c.h.ea.value=!0,c.d.visible={update:function(e,t){var n=c.a.c(t()),r="none"!=e.style.display;n&&!r?e.style.display="":!n&&r&&(e.style.display="none")}},function(e){c.d[e]={init:function(t,n,r,i,s){return c.d.event.init.call(this,t,function(){var t={};return t[e]=n(),t},r,i,s)}}}("click"),c.O=function(){},c.O.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource")},c.O.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock")},c.O.prototype.makeTemplateSource=function(e,t){if("string"==typeof e){t=t||u;var n=t.getElementById(e);if(!n)throw Error("Cannot find template with ID "+e);return new c.v.n(n)}if(1==e.nodeType||8==e.nodeType)return new c.v.qa(e);throw Error("Unknown template type: "+e)},c.O.prototype.renderTemplate=function(e,t,n,r){return e=this.makeTemplateSource(e,r),this.renderTemplateSource(e,t,n,r)},c.O.prototype.isTemplateRewritten=function(e,t){return!1===this.allowTemplateRewriting?!0:this.makeTemplateSource(e,t).data("isRewritten")},c.O.prototype.rewriteTemplate=function(e,t,n){e=this.makeTemplateSource(e,n),t=t(e.text()),e.text(t),e.data("isRewritten",!0)},c.b("templateEngine",c.O),c.Gb=function(){function e(e,t,n,r){e=c.h.yb(e);for(var i=c.h.ta,s=0;s<e.length;s++){var o=e[s].key;if(i.hasOwnProperty(o)){var u=i[o];if("function"==typeof u){if(o=u(e[s].value))throw Error(o)}else if(!u)throw Error("This template engine does not support the '"+o+"' binding within its templates")}}return n="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+c.h.Ua(e,{valueAccessors:!0})+" } })()},'"+n.toLowerCase()+"')",r.createJavaScriptEvaluatorBlock(n)+t}var t=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,n=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{Oc:function(e,t,n){t.isTemplateRewritten(e,n)||t.rewriteTemplate(e,function(e){return c.Gb.dd(e,t)},n)},dd:function(r,i){return r.replace(t,function(t,n,r,s,o){return e(o,n,r,i)}).replace(n,function(t,n){return e(n,"<!-- ko -->","#comment",i)})},Ec:function(e,t){return c.M.wb(function(n,r){var i=n.nextSibling;i&&i.nodeName.toLowerCase()===t&&c.Ja(i,e,r)})}}}(),c.b("__tr_ambtns",c.Gb.Ec),function(){c.v={},c.v.n=function(e){if(this.n=e){var t=c.a.A(e);this.ab="script"===t?1:"textarea"===t?2:"template"==t&&e.content&&11===e.content.nodeType?3:4}},c.v.n.prototype.text=function(){var e=1===this.ab?"text":2===this.ab?"value":"innerHTML";if(0==arguments.length)return this.n[e];var t=arguments[0];"innerHTML"===e?c.a.Cb(this.n,t):this.n[e]=t};var e=c.a.e.I()+"_";c.v.n.prototype.data=function(t){if(1===arguments.length)return c.a.e.get(this.n,e+t);c.a.e.set(this.n,e+t,arguments[1])};var t=c.a.e.I();c.v.n.prototype.nodes=function(){var e=this.n;if(0==arguments.length)return(c.a.e.get(e,t)||{}).jb||(3===this.ab?e.content:4===this.ab?e:n);c.a.e.set(e,t,{jb:arguments[0]})},c.v.qa=function(e){this.n=e},c.v.qa.prototype=new c.v.n,c.v.qa.prototype.text=function(){if(0==arguments.length){var e=c.a.e.get(this.n,t)||{};return e.Hb===n&&e.jb&&(e.Hb=e.jb.innerHTML),e.Hb}c.a.e.set(this.n,t,{Hb:arguments[0]})},c.b("templateSources",c.v),c.b("templateSources.domElement",c.v.n),c.b("templateSources.anonymousTemplate",c.v.qa)}(),function(){function e(e,t,n){var r;for(t=c.f.nextSibling(t);e&&(r=e)!==t;)e=c.f.nextSibling(r),n(r,e)}function t(t,n){if(t.length){var r=t[0],i=t[t.length-1],s=r.parentNode,o=c.Q.instance,u=o.preprocessNode;if(u){e(r,i,function(e,t){var n=e.previousSibling,s=u.call(o,e);s&&(e===r&&(r=s[0]||t),e===i&&(i=s[s.length-1]||n))}),t.length=0;if(!r)return;r===i?t.push(r):(t.push(r,i),c.a.za(t,s))}e(r,i,function(e){1!==e.nodeType&&8!==e.nodeType||c.Rb(n,e)}),e(r,i,function(e){1!==e.nodeType&&8!==e.nodeType||c.M.yc(e,[n])}),c.a.za(t,s)}}function r(e){return e.nodeType?e:0<e.length?e[0]:null}function i(e,n,i,s,u){u=u||{};var a=(e&&r(e)||i||{}).ownerDocument,f=u.templateEngine||o;c.Gb.Oc(i,f,a),i=f.renderTemplate(i,s,u,a);if("number"!=typeof i.length||0<i.length&&"number"!=typeof i[0].nodeType)throw Error("Template engine must return an array of DOM nodes");a=!1;switch(n){case"replaceChildren":c.f.da(e,i),a=!0;break;case"replaceNode":c.a.qc(e,i),a=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+n)}return a&&(t(i,s),u.afterRender&&c.l.w(u.afterRender,null,[i,s.$data])),i}function s(e,t,n){return c.H(e)?e():"function"==typeof e?e(t,n):e}var o;c.Db=function(e){if(!(e==n||e instanceof c.O))throw Error("templateEngine must inherit from ko.templateEngine");o=e},c.Ab=function(e,t,u,a,f){u=u||{};if((u.templateEngine||o)==n)throw Error("Set a template engine before calling renderTemplate");f=f||"replaceChildren";if(a){var l=r(a);return c.B(function(){var n=t&&t instanceof c.U?t:new c.U(c.a.c(t)),o=s(e,n.$data,n),n=i(a,f,o,n,u);"replaceNode"==f&&(a=n,l=r(a))},null,{wa:function(){return!l||!c.a.nb(l)},i:l&&"replaceNode"==f?l.parentNode:l})}return c.M.wb(function(n){c.Ab(e,t,u,n,"replaceNode")})},c.kd=function(e,r,o,u,a){function f(e,n){t(n,h),o.afterRender&&o.afterRender(n,e),h=null}function l(t,n){h=a.createChildContext(t,o.as,function(e){e.$index=n});var r=s(e,t,h);return i(null,"ignoreTargetNode",r,h,o)}var h;return c.B(function(){var e=c.a.c(r)||[];"undefined"==typeof e.length&&(e=[e]),e=c.a.Ka(e,function(e){return o.includeDestroyed||e===n||null===e||!c.a.c(e._destroy)}),c.l.w(c.a.Bb,null,[u,e,l,o,f])},null,{i:u})};var u=c.a.e.I();c.d.template={init:function(e,t){var n=c.a.c(t());if("string"==typeof n||n.name)c.f.xa(e);else{if("nodes"in n){if(n=n.nodes||[],c.H(n))throw Error('The "nodes" option must be a plain, non-observable array.')}else n=c.f.childNodes(e);n=c.a.jc(n),(new c.v.qa(e)).nodes(n)}return{controlsDescendantBindings:!0}},update:function(e,t,r,i,s){var o=t(),a;t=c.a.c(o),r=!0,i=null,"string"==typeof t?t={}:(o=t.name,"if"in t&&(r=c.a.c(t["if"])),r&&"ifnot"in t&&(r=!c.a.c(t.ifnot)),a=c.a.c(t.data)),"foreach"in t?i=c.kd(o||e,r&&t.foreach||[],t,e,s):r?(s="data"in t?s.createChildContext(a,t.as):s,i=c.Ab(o||e,s,t,e)):c.f.xa(e),s=i,(a=c.a.e.get(e,u))&&"function"==typeof a.k&&a.k(),c.a.e.set(e,u,s&&s.ba()?s:n)}},c.h.ta.template=function(e){return e=c.h.yb(e),1==e.length&&e[0].unknown||c.h.ad(e,"name")?null:"This template engine does not support anonymous templates nested within its templates"},c.f.Z.template=!0}(),c.b("setTemplateEngine",c.Db),c.b("renderTemplate",c.Ab),c.a.dc=function(e,t,n){if(e.length&&t.length){var r,i,s,o,u;for(r=i=0;(!n||r<n)&&(o=e[i]);++i){for(s=0;u=t[s];++s)if(o.value===u.value){o.moved=u.index,u.moved=o.index,t.splice(s,1),r=s=0;break}r+=s}}},c.a.ib=function(){function e(e,t,n,r,i){var s=Math.min,o=Math.max,u=[],a,f=e.length,l,h=t.length,p=h-f||1,d=f+h+1,v,m,g;for(a=0;a<=f;a++)for(m=v,u.push(v=[]),g=s(h,a+p),l=o(0,a-1);l<=g;l++)v[l]=l?a?e[a-1]===t[l-1]?m[l-1]:s(m[l]||d,v[l-1]||d)+1:l+1:a+1;s=[],o=[],p=[],a=f;for(l=h;a||l;)h=u[a][l]-1,l&&h===u[a][l-1]?o.push(s[s.length]={status:n,value:t[--l],index:l}):a&&h===u[a-1][l]?p.push(s[s.length]={status:r,value:e[--a],index:a}):(--l,--a,i.sparse||s.push({status:"retained",value:t[l]}));return c.a.dc(p,o,!i.dontLimitMoves&&10*f),s.reverse()}return function(t,n,r){return r="boolean"==typeof r?{dontLimitMoves:r}:r||{},t=t||[],n=n||[],t.length<n.length?e(t,n,"added","deleted",r):e(n,t,"deleted","added",r)}}(),c.b("utils.compareArrays",c.a.ib),function(){function e(e,t,r,i,s){var o=[],u=c.B(function(){var n=t(r,s,c.a.za(o,e))||[];0<o.length&&(c.a.qc(o,n),i&&c.l.w(i,null,[r,n,s])),o.length=0,c.a.ra(o,n)},null,{i:e,wa:function(){return!c.a.Qb(o)}});return{ca:o,B:u.ba()?u:n}}var t=c.a.e.I(),r=c.a.e.I();c.a.Bb=function(i,s,o,u,a){function f(e,t){S=p[t],y!==t&&(E[e]=S),S.qb(y++),c.a.za(S.ca,i),m.push(S),w.push(S)}function l(e,t){if(e)for(var n=0,r=t.length;n<r;n++)t[n]&&c.a.q(t[n].ca,function(r){e(r,n,t[n].ja)})}s=s||[],u=u||{};var h=c.a.e.get(i,t)===n,p=c.a.e.get(i,t)||[],d=c.a.fb(p,function(e){return e.ja}),v=c.a.ib(d,s,u.dontLimitMoves),m=[],g=0,y=0,b=[],w=[];s=[];for(var E=[],d=[],S,x=0,T,N;T=v[x];x++)switch(N=T.moved,T.status){case"deleted":N===n&&(S=p[g],S.B&&(S.B.k(),S.B=n),c.a.za(S.ca,i).length&&(u.beforeRemove&&(m.push(S),w.push(S),S.ja===r?S=null:s[x]=S),S&&b.push.apply(b,S.ca))),g++;break;case"retained":f(x,g++);break;case"added":N!==n?f(x,N):(S={ja:T.value,qb:c.N(y++)},m.push(S),w.push(S),h||(d[x]=S))}c.a.e.set(i,t,m),l(u.beforeMove,E),c.a.q(b,u.beforeRemove?c.$:c.removeNode);for(var x=0,h=c.f.firstChild(i),C;S=w[x];x++){S.ca||c.a.extend(S,e(i,o,S.ja,a,S.qb));for(g=0;v=S.ca[g];h=v.nextSibling,C=v,g++)v!==h&&c.f.gc(i,v,C);!S.Wc&&a&&(a(S.ja,S.ca,S.qb),S.Wc=!0)}l(u.beforeRemove,s);for(x=0;x<s.length;++x)s[x]&&(s[x].ja=r);l(u.afterMove,E),l(u.afterAdd,d)}}(),c.b("utils.setDomNodeChildrenFromArrayMapping",c.a.Bb),c.W=function(){this.allowTemplateRewriting=!1},c.W.prototype=new c.O,c.W.prototype.renderTemplateSource=function(e,t,n,r){return(t=(9>c.a.C?0:e.nodes)?e.nodes():null)?c.a.V(t.cloneNode(!0).childNodes):(e=e.text(),c.a.ma(e,r))},c.W.sb=new c.W,c.Db(c.W.sb),c.b("nativeTemplateEngine",c.W),function(){c.vb=function(){var e=this.$c=function(){if(!v||!v.tmpl)return 0;try{if(0<=v.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(e){}return 1}();this.renderTemplateSource=function(t,n,r,i){i=i||u,r=r||{};if(2>e)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var s=t.data("precompiled");return s||(s=t.text()||"",s=v.template(null,"{{ko_with $item.koBindingContext}}"+s+"{{/ko_with}}"),t.data("precompiled",s)),t=[n.$data],n=v.extend({koBindingContext:n},r.templateOptions),n=v.tmpl(s,t,n),n.appendTo(i.createElement("div")),v.fragments={},n},this.createJavaScriptEvaluatorBlock=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"},this.addTemplate=function(e,t){u.write("<script type='text/html' id='"+e+"'>"+t+"</script>")},0<e&&(v.tmpl.tag.ko_code={open:"__.push($1 || '');"},v.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},c.vb.prototype=new c.O;var e=new c.vb;0<e.$c&&c.Db(e),c.b("jqueryTmplTemplateEngine",c.vb)}()})})()}(),define("services/pes/tabs/fetcher",["require","services/pes/tabs/stylesFactory","services/pes/constants","vendor/knockout"],function(e){function i(){function i(e,t){var i="tabs tab id_"+e.id,s="tabs tab active id_"+e.id,o="tabs tab hover id_"+e.id;e.index=t,e.ariaLabel=e.title,e.active=r.observable(!1),e.hover=r.observable(!1),e.htmlClass=r.observable(i),e.showHiddenItems=e.id===n.mru.TAB_ID,e.onMouseOver=function(){e.hover(!0)},e.onMouseOut=function(){e.hover(!1)},e.htmlClass=r.computed(function(){return e.active()?s:e.hover()?o:i})}var e=this;e.process=function(e,t){return e.type!==n.itemTypes.tab.id?null:(i(e,t),e)},e.getResources=function(e){return e.type!==n.itemTypes.tab.id?null:{styleDef:t.create(e),prefetchUrls:[e.thumbnailUrl],encoderMaps:[]}}}var t=e("services/pes/tabs/stylesFactory"),n=e("services/pes/constants"),r=e("vendor/knockout");return new i}),define("services/pes/emoticons/styleKeyFrameFactory",[],function(){function e(e,t,n,i,s){var o="@"+(i||"")+"keyframes "+e+" { ";return o+=r(t,n,i,s),o+="} \n",o}function t(e){return" top: "+e+"; "}function n(e){return" transform: translateY("+e+"); "}function r(e,n,r,i){i=i||t;var s="";return s+="from { ",s+=i(e),s+="} ",s+="to { ",s+=i(n),s+="} ",s}function i(t,n,r){var i="0",s=-n+"px";return e(t,i,s,"",r)+e(t,i,s,"-moz-",r)+e(t,i,s,"-webkit-",r)}function s(){}return s.prototype.create=function(e){var r=i(e.id,e.styleDef.smallHeight,n);return r+=i(e.id+"_large",e.styleDef.largeHeight,n),r+=i(e.id+"_extraLarge",e.styleDef.extraLargeHeight,t),r},new s}),define("services/pes/emoticons/styleDefinitionFactory",["require","services/pes/constants"],function(e){function n(){function n(e){var n=e.largeUrl,r=t.frameHeights.emoticons.LARGE,i=e.styleDef.largeHeight,s=e.styleDef.largeOffset;return o(e,n,r,i,s,"large")}function r(e){return" top: "+e+";\n"+" -webkit-transform: initial;\n"+"transform: initial;\n"+" transform: translateZ(0);"}function i(e){return" -webkit-transform: translateY("+e+");\n"+" transform: translateY("+e+");"}function s(e){var n=e.extraLargeUrl,i=t.frameHeights.emoticons.EXTRA_LARGE,s=e.styleDef.extraLargeHeight,u=e.styleDef.extraLargeOffset;return o(e,n,i,s,u,"extraLarge",r)}function o(e,t,n,r,s,o,u){var a=e.id,f=e.id,l=e.styleDef.duration,c=e.styleDef.frameCount;u=u||i,o&&(f+="_"+o);var h="\n .swx .largeAllowed span.emoticon."+a+".animated";return o&&(h+="."+o),h+=" span.emoSprite \n",h+="{ \n",h+=" -ms-high-contrast-adjust: none;\n",h+=" background-image: url('"+t+"');\n",h+=" background-size: "+n+"px "+r+"px; \n",h+=" height: "+r+"px; \n",h+=u(s)+"\n",h+=" -moz-animation: "+f+" "+l+" steps("+c+") infinite; \n",h+=" -webkit-animation: "+f+" "+l+" steps("+c+") infinite; \n",h+=" animation: "+f+" "+l+" steps("+c+") infinite; \n",h+="} ",h}function u(e){var n=e.id,r=e.styleDef.duration,s=e.styleDef.frameCount,o=e.smallUrl,u=t.frameHeights.emoticons.SMALL,a=e.styleDef.smallOffset,f=e.styleDef.smallHeight,l="\n.swx span.emoticon."+e.id+".animated span.emoSprite, \n";return l+=".swx span.emoticon."+e.id+".large.animated span.emoSprite, \n",l+=".swx span.emoticon."+e.id+".extraLarge.animated span.emoSprite, \n",l+=".swx .largeAllowed span.emoticon."+e.id+".animated span.emoSprite",l+="{ \n",l+=" -ms-high-contrast-adjust: none;\n",l+=" background-image: url('"+o+"'); \n",l+=" background-size: "+u+"px "+f+"px; \n",l+=" height: "+f+"px; \n",l+=i(a),l+=" -webkit-animation: "+n+" "+r+" steps("+s+") infinite; \n",l+=" -moz-animation: "+n+" "+r+" steps("+s+") infinite; \n",l+=" animation: "+n+" "+r+" steps("+s+") infinite; \n",l+="} ",l}function a(e,t,n,r,s,o){var u="\n.swx span.emoticon."+e.id+t+" span.emoSprite \n";return u+="{\n",u+=" -ms-high-contrast-adjust: none;\n",u+=" background-image: url('"+n+"'); \n",u+=" background-size: "+r+"px "+s+"px; \n",u+=" height: "+s+"px; \n",u+=i(o),u+=" -moz-animation: none; \n",u+=" -webkit-animation: none; \n",u+=" animation: none \n",u+="}",u}function f(e){return a(e,"",e.smallUrl,t.frameHeights.emoticons.SMALL,e.styleDef.smallHeight,e.styleDef.smallOffset)+a(e,".large",e.largeUrl,t.frameHeights.emoticons.LARGE,e.styleDef.largeHeight,e.styleDef.largeOffset)+a(e,".extraLarge",e.extraLargeUrl,t.frameHeights.emoticons.EXTRA_LARGE,e.styleDef.extraLargeHeight,e.styleDef.extraLargeOffset)}var e=this;e.create=function(e){var t=f(e);return t+=u(e),t+=n(e),t+=s(e),t}}var t=e("services/pes/constants");return new n}),define("services/pes/emoticons/stylesFactory",["require","services/pes/constants","services/pes/emoticons/styleKeyFrameFactory","services/pes/emoticons/styleDefinitionFactory"],function(e){function s(){function s(e){var n=e.media.default,r=(n.firstFrame<n.framesCount?n.firstFrame:n.framesCount-1)||0;e.styleDef={frameCount:n.framesCount,firstFrame:r,duration:n.framesCount/i+"s",smallHeight:t.frameHeights.emoticons.SMALL*n.framesCount,smallOffset:-r*t.frameHeights.emoticons.SMALL,largeHeight:t.frameHeights.emoticons.LARGE*n.framesCount,largeOffset:-r*t.frameHeights.emoticons.LARGE,extraLargeHeight:t.frameHeights.emoticons.EXTRA_LARGE*n.framesCount,extraLargeOffset:-r*t.frameHeights.emoticons.EXTRA_LARGE},e.styleDef.smallOffset!==0&&(e.styleDef.smallOffset+="px"),e.styleDef.largeOffset!==0&&(e.styleDef.largeOffset+="px"),e.styleDef.extraLargeOffset!==0&&(e.styleDef.extraLargeOffset+="px")}var e=this;e.create=function(e){s(e);var t=n.create(e),i=r.create(e);return t+i}}var t=e("services/pes/constants"),n=e("services/pes/emoticons/styleKeyFrameFactory"),r=e("services/pes/emoticons/styleDefinitionFactory"),i=24;return new s}),define("utils/chat/pesUtils",["require","lodash-compat","constants/common","services/pes/constants","services/serviceLocator","experience/settings","utils/common/url"],function(e){function u(){function f(t){var r=i.resolve(n.serviceLocator.FEATURE_FLAGS);return r.isFeatureOn(n.featureFlags.PES_CDN_AUTH_ENABLED)?a=function(t){return e.rewriteUrls(t,s.pesCDNAuthentication.rewriteRules)}:a=function(e){return e},a(t)}var e=this,u={small:"getSmall",large:"getLarge",extraLarge:"getExtraLarge"},a=f;this.buildEmoticonUrl=function(t,n,i,s){var f=t+"/"+n.id+"/views/";f=a(f);var l=u[i]+(s?"Animated":"");return o.buildUrl(f+r.profiles.emoticons[l](),{etag:n.etag})},this.rewriteUrls=function(n,r){if(typeof n!="string")return n;var i=n;return t.any(r,function(e){return i.search(e.from)!==-1?(i=i.replace(e.from,e.to),!0):!1}),i},this._resetUrlRewriterSetup=function(){a=f}}var t=e("lodash-compat"),n=e("constants/common"),r=e("services/pes/constants"),i=e("services/serviceLocator"),s=e("experience/settings"),o=e("utils/common/url");return new u}),define("services/pes/emoticons/fetcher",["require","vendor/knockout","lodash-compat","services/pes/emoticons/stylesFactory","services/pes/constants","utils/chat/pesUtils","services/serviceLocator","constants/common","experience/settings"],function(e){function f(){function f(e){var t=o.resolve(u.serviceLocator.FEATURE_FLAGS);return t.isFeatureOn(u.featureFlags.PES_CDN_AUTH_ENABLED)&&(e=s.rewriteUrls(e,a.pesCDNAuthentication.rewriteRules)),{smallStaticUrl:e+i.profiles.emoticons.getSmall(),smallUrl:e+i.profiles.emoticons.getSmallAnimated(),largeUrl:e+i.profiles.emoticons.getLargeAnimated(),extraLargeUrl:e+i.profiles.emoticons.getExtraLargeAnimated()}}function l(e,r){function s(e){return e.id+" extraLarge animated"}function o(e){return e.id+" large animated"}function u(e){return e.id+" animated"}function a(e){return e.id}function l(e){return e.id+" large"}function c(e){return e.id+" extraLarge"}e.ariaLabel=e.description,e.shortcut=e.shortcuts[0],e.text=e.shortcut,e.staticHtmlClass=a(e),e.staticLargeHtmlClass=l(e),e.staticExtraLargeHtmlClass=c(e),e.animatedHtmlClass=u(e),e.animatedLargeHtmlClass=o(e),e.animatedExtraLargeHtmlClass=s(e),e.htmlClass=t.observable(a(e)),e.htmlLargeClass=t.observable(o(e)),e.htmlExtraLargeClass=t.observable(s(e));var i=f(r.emoticonsRoot+"/"+e.id+"/views/");n.extend(e,i),e.isLocked=t.observable(!1)}var e=this;e.process=function(e,t){return e.type!==i.itemTypes.emoticon.id?null:(l(e,t),e)},e.getResources=function(e,t){var s,a,l=[],c=o.resolve(u.serviceLocator.FEATURE_FLAGS);return e.type!==i.itemTypes.emoticon.id?null:(a=[],e.shortcuts.forEach(function(t){a.push({shortcut:t,id:e.id,type:i.itemTypes.emoticon.id})}),s=f(t.emoticonsRoot+"/"+e.id+"/views/"),n.extend(e,s),c.isFeatureOn(u.featureFlags.PES_FETCH_SMALL_ASSETS_ON_DEMAND)||l.push(e.smallUrl),c.isFeatureOn(u.featureFlags.PES_FETCH_MEDIUM_ASSETS_ON_DEMAND)||l.push(e.largeUrl),c.isFeatureOn(u.featureFlags.PES_FETCH_LARGE_ASSETS_ON_DEMAND)||l.push(e.extraLargeUrl),{styleDef:r.create(e),prefetchUrls:l,encoderMaps:a})}}var t=e("vendor/knockout"),n=e("lodash-compat"),r=e("services/pes/emoticons/stylesFactory"),i=e("services/pes/constants"),s=e("utils/chat/pesUtils"),o=e("services/serviceLocator"),u=e("constants/common"),a=e("experience/settings");return new f}),define("services/pes/mojis/stylesFactory",["require","services/pes/constants"],function(e){function n(){function n(e){var n=e.thumbnailUrl,r=t.frameHeights.moji.THUMBNAIL,i="\n.swx span.moji.id_"+e.id+" span.mojiThumbnail \n";return i+="{\n",i+=" -ms-high-contrast-adjust: none;\n",i+=" background-image: url('"+n+"'); \n",i+=" height: "+r+"px; \n",i+=" background-size: 100%; \n",i+="}",i}function r(e){var t=e.thumbnailUrl,n="\n.swx span.moji.id_"+e.id+" span.keyframe \n";return n+="{\n",n+=" -ms-high-contrast-adjust: none;\n",n+=" background-image: url('"+t+"'); \n",n+=" height: 100%; \n",n+=" background-size: 100%; \n",n+=" border-radius: 8px; \n",n+=" display: block; \n",n+="}",n}var e=this;e.create=function(e){var t=n(e);return t+=r(e),t}}var t=e("services/pes/constants");return new n}),define("services/pes/mojis/fetcher",["require","vendor/knockout","services/pes/constants","services/pes/mojis/stylesFactory","utils/chat/pesUtils","services/serviceLocator","constants/common","experience/settings"],function(e){function a(){function a(e,r){var a=r.itemsRoot+"/"+e.id+"/views/",f=s.resolve(o.serviceLocator.FEATURE_FLAGS);f.isFeatureOn(o.featureFlags.PES_CDN_AUTH_ENABLED)&&(a=i.rewriteUrls(a,u.pesCDNAuthentication.rewriteRules)),e.thumbnailUrl=a+n.profiles.moji.thumbnail,e.contentUrl=a+n.profiles.moji.content,r._requiresCDNUrlAuthentication&&(e.thumbnailUrl=e.thumbnailUrl+"?"+r._cdnToken,e.contentUrl=e.contentUrl+"?"+r._cdnToken),e.text="/moji "+e.id,e.thumbnailClass="id_"+e.id+" thumbnail",e.keyframeClass="id_"+e.id+" keyframe",e.isPlaying=t.observable(!1),e.isPlayed=t.observable(!1),e.isLocked=t.observable(!1),e.onPlayed=function(){},e.visible=!0}var e=this;e.process=function(e,t){return e.type!==n.itemTypes.moji.id?null:(a(e,t),e)},e.getResources=function(e,t){var a=[];if(e.type!==n.itemTypes.moji.id)return null;var f=t.itemsRoot+"/"+e.id+"/views/",l=s.resolve(o.serviceLocator.FEATURE_FLAGS);return l.isFeatureOn(o.featureFlags.PES_CDN_AUTH_ENABLED)&&(f=i.rewriteUrls(f,u.pesCDNAuthentication.rewriteRules)),e.thumbnailUrl=f+n.profiles.moji.thumbnail,t._requiresCDNUrlAuthentication&&(e.thumbnailUrl=e.thumbnailUrl+"?"+t._cdnToken),l.isFeatureOn(o.featureFlags.PES_FETCH_MOJI_ASSETS_ON_DEMAND)||a.push(e.thumbnailUrl),{styleDef:r.create(e),prefetchUrls:a,encoderMaps:[]}}}var t=e("vendor/knockout"),n=e("services/pes/constants"),r=e("services/pes/mojis/stylesFactory"),i=e("utils/chat/pesUtils"),s=e("services/serviceLocator"),o=e("constants/common"),u=e("experience/settings");return new a}),define("ui/controls/calling/sounds",["require","exports","module","experience/settings"],function(e,t){function o(e){var n;if(!u(e))throw new Error("Invalid sound: "+e);return n=r[e],n||(n=document.createElement("audio"),s.forEach(function(i){var s=document.createElement("source"),o=t.buildSoundAssetUrl(e,i.extension);s.setAttribute("type",i.mimeType),s.setAttribute("src",o),n.appendChild(s),r[e]=n}),n.id=i+e),n}function u(e){for(var n in t.KEYS)if(t.KEYS[n]===e)return!0;return!1}var n=e("experience/settings"),r={},i="skype_sounds_",s=[{mimeType:"audio/mp4",extension:"m4a"},{mimeType:"audio/ogg",extension:"ogg"}];t.KEYS={CALL_ANSWER:"call-answer",CALL_CONNECTING:"call-connecting-loop",CALL_DIALING:"call-dialing",CALL_END_CALL:"call-endcall",CALL_ERROR_1:"call-error-1",CALL_ERROR_2:"call-error-2",CALL_HOLD:"call-hold-loop",CALL_INCOMING:"call-incoming-loop",CALL_NO_ANSWER:"call-no-answer",CALL_OUTGOING:"call-outgoing-original-loop",CALL_OUTGOING_P1:"call-outgoing-p1",CALL_OUTGOING_P2:"call-outgoing-p2-loop",CALL_RECONNECT:"call-reconnect-loop",CALL_RESUME:"call-resume",CAM_SHUTTER_CLOSE:"cam-shutter-close",CAM_SHUTTER_OPEN:"cam-shutter-open",CONTACTS_ADDED:"contacts-added",CONTACTS_AVAILABLE:"contacts-available",CONTACTS_RECEIVED:"contacts-received",FILE_TRANSFER_COMPLETE:"file-transfer-complete",FILE_TRANSFER_FAILED:"file-transfer-failed",FILE_TRANSFER_INCOMING:"file-transfer-incoming",LOGIN:"login",LOGOUT:"logout",MESSAGE_RECEIVED_1:"message-received-1",MESSAGE_RECEIVED_2:"message-received-2",MESSAGE_RECEIVED_3:"message-received-3",MESSAGE_RECEIVED_4:"message-received-4",MESSAGE_SENT:"message-sent",VIDEO_MESSAGE_RECORD_START:"video-message-record-start",VIDEO_MESSAGE_RECORD_STOP:"video-message-record-stop",VOICEMAIL_RECEIVED:"voicemail-received"},t.playLoop=function(e){var t=o(e);t.setAttribute("loop",!0),t.play()},t.playOnce=function(e,t){var n=o(e),r="ended";n.addEventListener(r,function i(){t&&t(),n.removeEventListener(r,i)}),n.play()},t.stop=function(e){var t=o(e);t.pause(),t.load()},t.clearCache=function(){r={}},t.buildSoundAssetUrl=function(e,t){return[n.assetsBaseUrl,"/audio","/",t,"/",e,".",t].join("")}}),define("utils/common/prefetcher",["require","ui/controls/calling/sounds"],function(e){function i(){var e=document.createDocumentFragment();s(e),document.head.appendChild(e)}function s(e){r.forEach(function(r){n.forEach(function(n){var i=t.buildSoundAssetUrl(r,n);o(e,i)})})}function o(e,t){var n=u(t);e.appendChild(n)}function u(e){var t=document.createElement("link");return t.rel="prefetch",t.href=e,t}function a(e){var t=[],n=e.length;for(var r=0;r<n;r++){var i=new Image;i.src=e[r],t[r]=i}}var t=e("ui/controls/calling/sounds"),n=["m4a","ogg"],r=[t.KEYS.CALL_ANSWER,t.KEYS.CALL_DIALING,t.KEYS.CALL_OUTGOING_P1,t.KEYS.CALL_OUTGOING_P2,t.KEYS.CALL_INCOMING,t.KEYS.MESSAGE_RECEIVED_1];return{prefetchAssets:i,prefetchImages:a}}),define("services/pes/configProcessor",["require","services/pes/emoticons/encoder","lodash-compat","services/pes/tabs/fetcher","services/pes/emoticons/fetcher","services/pes/mojis/fetcher","services/pes/constants","utils/common/prefetcher"],function(e){function a(){function a(e){var t,n,r;return r=document.getElementById("pesStyles"),r||(n=document.head,r=document.createElement("style"),r.id="pesStyles",r.type="text/css"),r.styleSheet?r.styleSheet.cssText=e:(t=document.createTextNode(e),r.firstChild&&r.removeChild(r.firstChild),r.appendChild(t)),n&&n.appendChild(r),e}var e=this;e.process=function(n){n.tabs.forEach(function(t,i){r.process(t,i),t.packs.forEach(function(t){t.items.forEach(function(t){e._processItem(t,n,"process")})})})},e._processItem=function(e,t,n){n=n||"process";if(!e)throw new Error("Ad hoc fetching is not implemented, yet!");switch(e.type){case o.itemTypes.emoticon.id:return i[n](e,t);case o.itemTypes.moji.id:return s[n](e,t);case o.itemTypes.sticker.id:throw new Error("Stickers are not implemented, yet!");default:throw new Error(e.type+" is not supported, yet!")}},e.prefetch=function(i){var s=[],o=[],u=[],a=n.cloneDeep(i,function(e){return e&&n.isFunction(e.then)?{}:undefined});return a.tabs.forEach(function(t){var n=r.getResources(t);s.push(n.styleDef),o.splice(0,0,n.prefetchUrls[0]),t.packs.forEach(function(t){t.items.forEach(function(t){var n=e._processItem(t,i,"getResources");s.push(n.styleDef),n.encoderMaps.forEach(function(e){u.push(e)}),n.prefetchUrls.forEach(function(e){o.push(e)})})})}),{pesStyles:s,prefetchUrls:o,encodingMaps:u}},e.register=function(n){var r="";t.map={},n.encodingMaps.forEach(function(e){switch(e.type){case o.itemTypes.emoticon.id:t.map[e.shortcut]=e.id;break;case o.itemTypes.tab.id:case o.itemTypes.moji.id:case o.itemTypes.sticker.id:throw new Error("mapping.type not implemented yet:"+e.type);default:throw new Error("mapping.type not supported yet:"+e.type)}}),n.pesStyles.forEach(function(e){r+=e}),a(r)},e.prefetchImages=function(t){u.prefetchImages(t.prefetchUrls||[])}}var t=e("services/pes/emoticons/encoder"),n=e("lodash-compat"),r=e("services/pes/tabs/fetcher"),i=e("services/pes/emoticons/fetcher"),s=e("services/pes/mojis/fetcher"),o=e("services/pes/constants"),u=e("utils/common/prefetcher");return new a}),define("services/i18n/cultureInfo",[],function(){function e(){function i(e){for(t=0;t<n.length;t++)if(n[t].language.toLowerCase()===e.toLowerCase())return n[t]}function s(e){for(t=0;t<r.length;t++)if(r[t].locale.toLowerCase()===e.toLowerCase()&&r[t])return r[t]}var e=this,t,n=[{language:"am",defaultLocale:"am-et"},{language:"ar",defaultLocale:"ar-sa"},{language:"bg",defaultLocale:"bg-bg"},{language:"bn",defaultLocale:"bn-in"},{language:"ca",defaultLocale:"ca-es"},{language:"cs",defaultLocale:"cs-cz"},{language:"cy",defaultLocale:"cy-gb"},{language:"da",defaultLocale:"da-dk"},{language:"de",defaultLocale:"de-de"},{language:"el",defaultLocale:"el-gr"},{language:"en",defaultLocale:"en-us"},{language:"es",defaultLocale:"es-es"},{language:"et",defaultLocale:"et-ee"},{language:"eu",defaultLocale:"eu-es"},{language:"fa",defaultLocale:"fa-ir"},{language:"fi",defaultLocale:"fi-fl"},{language:"fil",defaultLocale:"fil-ph"},{language:"fr",defaultLocale:"fr-fr"},{language:"gl",defaultLocale:"gl-es"},{language:"gu",defaultLocale:"gu-in"},{language:"he",defaultLocale:"he-il"},{language:"hi",defaultLocale:"hi-in"},{language:"hr",defaultLocale:"hr-hr"},{language:"hu",defaultLocale:"hu-hu"},{language:"id",defaultLocale:"id-id"},{language:"is",defaultLocale:"is-is"},{language:"it",defaultLocale:"it-it"},{language:"ja",defaultLocale:"ja-jp"},{language:"kk",defaultLocale:"kk-kz"},{language:"kn",defaultLocale:"kn-in"},{language:"ko",defaultLocale:"ko-kr"},{language:"ku",defaultLocale:"ku-arab-iq"},{language:"lt",defaultLocale:"lt-lt"},{language:"lv",defaultLocale:"lv-lv"},{language:"ml",defaultLocale:"ml-in"},{language:"mr",defaultLocale:"mr-in"},{language:"ms",defaultLocale:"ms-my"},{language:"nb",defaultLocale:"nb-no"},{language:"nl",defaultLocale:"nl-nl"},{language:"nn",defaultLocale:"nn-no"},{language:"or",defaultLocale:"or-in"},{language:"pl",defaultLocale:"pl-pl"},{language:"pt",defaultLocale:"pt-PT"},{language:"pt-pt",defaultLocale:"pt-PT"},{language:"pt-br",defaultLocale:"pt-BR"},{language:"ro",defaultLocale:"ro-ro"},{language:"ru",defaultLocale:"ru-ru"},{language:"sk",defaultLocale:"sk-sk"},{language:"sl",defaultLocale:"sl-si"},{language:"sr",defaultLocale:"sr-cyrl-rs"},{language:"sr-cyrl",defaultLocale:"sr-cyrl-rs"},{language:"sr-latn",defaultLocale:"sr-latn-rs"},{language:"sv",defaultLocale:"sv-se"},{language:"sw",defaultLocale:"sw-ke"},{language:"ta",defaultLocale:"ta-in"},{language:"te",defaultLocale:"te-in"},{language:"th",defaultLocale:"th-th"},{language:"tr",defaultLocale:"tr-tr"},{language:"uk",defaultLocale:"uk-ua"},{language:"ur",defaultLocale:"ur-pk"},{language:"vi",defaultLocale:"vi-vn"},{language:"zh",defaultLocale:"zh-cn"},{language:"zh-hant",defaultLocale:"zh-tw"},{language:"zh-cht",defaultLocale:"zh-tw"},{language:"zh-hk",defaultLocale:"zh-tw"},{language:"zh-mo",defaultLocale:"zh-tw"}],r=[{locale:"am-et",pesLocale:"am"},{locale:"ar-sa",pesLocale:"ar"},{locale:"az-latn-az",pesLocale:"az"},{locale:"be-by",pesLocale:"be-BY"},{locale:"bg-bg",pesLocale:"bg"},{locale:"bn-bd",pesLocale:"bn"},{locale:"bn-in",pesLocale:"bn"},{locale:"bs-latn-ba",pesLocale:"bs-Latn-BA"},{locale:"ca-es",pesLocale:"ca"},{locale:"ca-es-valencia",pesLocale:"ca"},{locale:"cs-cz",pesLocale:"cs"},{locale:"cy-gb",pesLocale:"cy-GB"},{locale:"da-dk",pesLocale:"da"},{locale:"de-de",pesLocale:"de"},{locale:"el-gr",pesLocale:"el"},{locale:"en-gb",pesLocale:"en"},{locale:"en-us",pesLocale:"en"},{locale:"es-es",pesLocale:"es"},{locale:"et-ee",pesLocale:"et"},{locale:"eu-es",pesLocale:"eu"},{locale:"fa-ir",pesLocale:"fa"},{locale:"fi-fl",pesLocale:"fi"},{locale:"fil-ph",pesLocale:"fil_PH"},{locale:"fr-fr",pesLocale:"fr"},{locale:"gd-gb",pesLocale:"gd-GB"},{locale:"gl-es",pesLocale:"gl"},{locale:"gu-in",pesLocale:"gu-IN"},{locale:"he-il",pesLocale:"he"},{locale:"hi-in",pesLocale:"hi"},{locale:"hr-hr",pesLocale:"hr"},{locale:"hu-hu",pesLocale:"hu"},{locale:"id-id",pesLocale:"id"},{locale:"is-is",pesLocale:"is"},{locale:"it-it",pesLocale:"it"},{locale:"ja-jp",pesLocale:"ja"},{locale:"ka-ge",pesLocale:"ka-GE"},{locale:"kk-kz",pesLocale:"kk"},{locale:"kn-in",pesLocale:"kn"},{locale:"ko-kr",pesLocale:"ko"},{locale:"ku-arab-iq",pesLocale:"ku-Arab-IQ"},{locale:"lb-lu",pesLocale:"lb-LU"},{locale:"lt-lt",pesLocale:"lt"},{locale:"lv-lv",pesLocale:"lv"},{locale:"mk-mk",pesLocale:"mk"},{locale:"ml-in",pesLocale:"ml"},{locale:"mr-in",pesLocale:"mr-IN"},{locale:"ms-my",pesLocale:"ms"},{locale:"nb-no",pesLocale:"no"},{locale:"nl-nl",pesLocale:"nl"},{locale:"nn-no",pesLocale:"no"},{locale:"or-in",pesLocale:"or-IN"},{locale:"pl-pl",pesLocale:"pl"},{locale:"pt-pt",pesLocale:"pt-PT"},{locale:"pt-br",pesLocale:"pt-BR"},{locale:"ro-ro",pesLocale:"ro"},{locale:"ru-ru",pesLocale:"ru"},{locale:"sk-sk",pesLocale:"sk"},{locale:"sl-sl",pesLocale:"sl"},{locale:"sq-al",pesLocale:"sq"},{locale:"sr-cyrl-ba",pesLocale:"sr"},{locale:"sr-cyrl-rs",pesLocale:"sr"},{locale:"sr-latn-rs",pesLocale:"sr"},{locale:"sv-se",pesLocale:"sv"},{locale:"sw-ke",pesLocale:"sw"},{locale:"ta-in",pesLocale:"ta"},{locale:"te-in",pesLocale:"te"},{locale:"th-th",pesLocale:"th"},{locale:"tr-tr",pesLocale:"tr"},{locale:"uk-ua",pesLocale:"uk"},{locale:"ur-pk",pesLocale:"ur-PK"},{locale:"uz-latn-uz",pesLocale:"uz"},{locale:"vi-vn",pesLocale:"vi"},{locale:"zh-cn",pesLocale:"zh_Hans"},{locale:"zh-tw",pesLocale:"zh_Hant"}];e.getPesLocale=function(t){var n,r;if(!t)return"default";n=s(t);if(n&&n.pesLocale)return n.pesLocale;r=e.getLocale(t);if(r!==t){n=s(r);if(n)return n.pesLocale}return"default"},e.getLocale=function(t){var n,r=i(t);return r?r.defaultLocale:(n=t.lastIndexOf("-"),n>-1?e.getLocale(t.substring(0,n)):t)}}return new e}),define("services/pes/configSync",["require","lodash-compat","reqwest","browser/window","cafe/applicationInstance","swx-enums","constants/common","experience/settings","services/ecs/configLoader","services/pes/configProcessor","services/pes/constants","services/i18n/cultureInfo","services/pubSub/pubSub","services/serviceLocator","utils/chat/pesUtils"],function(e){function v(){function y(){function t(){return(new Promise(function(e){v=r.setTimeout(e,u.pesCDNAuthentication.cdnTokenTtlMs)})).then(function(){return Promise.resolve(i.get().signInManager._skypeToken())}).then(b).then(E).then(t)}m.isFeatureOn(o.featureFlags.PES_CDN_AUTH_ENABLED)&&u.pesCDNAuthentication.cdnTokenTtlMs>0&&(t().catch(function(e){}).then(t),i.get().signInManager.state.when(s.loginState.SignedOut,function(){e.dispose()}))}function b(t){var r="https://"+u.pesCDNAuthentication.skypeServiceHost+u.pesCDNAuthentication.tokenSourceEndpoint,i={headers:{Authorization:"skype_token "+t},url:r,dataType:"json",crossOrigin:!0};return Promise.resolve(n.compat(i)).catch(function(){return{token:"dummy_token"}}).then(function(t){return e.latestToken=t.token,h.publish(o.events.personalExpression.CDN_TOKEN_UPDATED,t.token),t.token})}function w(e){var t;return t="https://"+u.pesCDNAuthentication.cdnServiceHost+u.pesCDNAuthentication.cookieSourceEndpoint+"?vdms_skype_token="+e,{url:t,dataType:"json",crossOrigin:!0,withCredentials:!0}}function E(e){var t=w(e);return Promise.resolve(n.compat(t)).catch(function(){}).then(function(){return!0})}var e=this,v=0,m,g;e.latestToken="",e.init=function(){function r(){var e;if(u.pesConfigUrl)e=Promise.resolve({pes_config:u.pesConfigUrl});else{var t=i.get().personsAndGroupsManager.mePerson;e=Promise.resolve(a.loadConfig(s.ecsClientNames.Skype,u.ecsPesKey,t.id()))}return e}function h(r){if(m.isFeatureOn(o.featureFlags.PES_CDN_AUTH_ENABLED)&&m.isFeatureOn(o.featureFlags.PES_CDN_AUTH_URL_FALLBACK_ENABLED)){var i,s,a=t.find(r.items,function(e){return e.type===l.itemTypes.moji.id});if(a)return s=r.itemsRoot+"/"+a.id+"/views/meta.default",i={dataType:"json",withCredentials:!0,url:d.rewriteUrls(s,u.pesCDNAuthentication.rewriteRules),crossOrigin:!0},Promise.resolve(n.compat(i)).then(function(){g.init(r);var e=f.prefetch(g.getConfiguration());f.register(e)}).catch(function(){r._requiresCDNUrlAuthentication=!0,r._cdnToken=e.latestToken,g.init(r);var t=f.prefetch(g.getConfiguration());f.register(t)})}else{g.init(r);var c=f.prefetch(g.getConfiguration());f.register(c)}}function v(e){throw new Error("Error while retrieving the pes configuration data")}function b(t){var n=(new Promise(function(t){i.get().signInManager.state.once(s.loginState.SignedIn,t)})).then(e.fetchConfiguration.bind(null,t.pes_config)).then(h).then(y).catch(v);return{configurationLoaded:n}}return m=p.resolve(o.serviceLocator.FEATURE_FLAGS),u.locale=u.locale||{},u.initParams=u.initParams||{},u.locale.pes=c.getPesLocale(u.initParams.locale),g=p.resolve(o.serviceLocator.PES_CONFIG_SERVICE),r().then(b).catch(v)},e.fetchConfiguration=function(r){function s(){var e,t=Promise.resolve();return m.isFeatureOn(o.featureFlags.PES_CDN_AUTH_ENABLED)&&(e=i.get().signInManager._skypeToken(),t=Promise.resolve(e).then(b).then(E)),t}function a(r,i){var s,a=t.extend(i||{},{dataType:"json",crossOrigin:!0});return m.isFeatureOn(o.featureFlags.PES_CDN_AUTH_ENABLED)&&(r=d.rewriteUrls(r,u.pesCDNAuthentication.rewriteRules),a.withCredentials=!0),a.url=r,s=Promise.resolve(n.compat(a)),m.isFeatureOn(o.featureFlags.PES_CDN_AUTH_ENABLED)&&(s=s.catch(function(){var s=t.extend(i||{},{dataType:"json",crossOrigin:!0});return s.url=r+"?"+e.latestToken,Promise.resolve(n.compat(s))})),s}function f(){throw new Error("no pes configuration service endpoint")}function l(){return r.replace("/default","/"+u.locale.pes)}return s().then(function(){return a(l())}).catch(function(){return a(r)}).catch(f)},e.dispose=function(){v&&r.clearTimeout(v)}}var t=e("lodash-compat"),n=e("reqwest"),r=e("browser/window"),i=e("cafe/applicationInstance"),s=e("swx-enums"),o=e("constants/common"),u=e("experience/settings"),a=e("services/ecs/configLoader"),f=e("services/pes/configProcessor"),l=e("services/pes/constants"),c=e("services/i18n/cultureInfo"),h=e("services/pubSub/pubSub"),p=e("services/serviceLocator"),d=e("utils/chat/pesUtils");return new v}),define("jSkype/services/mojiMedia/main",["require","exports","module","reqwest","jSkype/settings","constants/common","services/pubSub/pubSub","services/pes/configSync"],function(e,t){function u(){}var n=e("reqwest"),r=e("jSkype/settings"),i=e("constants/common"),s=e("services/pubSub/pubSub"),o=e("services/pes/configSync");t.getMojiMetaData=function(e,t,a){function h(e){var n;if(!e){a();return}n=e,n.fallbackUsed=c,t(n)}function p(){if(l){var t;o.latestToken!==""?t=Promise.resolve(o.latestToken):t=new Promise(function(e){s.subscribe(i.events.personalExpression.CDN_TOKEN_UPDATED,function t(){s.unsubscribe(i.events.personalExpression.CDN_TOKEN_UPDATED,t),e(o.latestToken)})}),t.then(function(t){return c=!0,f={url:e+"?"+t,dataType:"json",crossOrigin:!0},n.compat(f)}).then(h,a)}else a()}var f={url:e,dataType:"json",crossOrigin:!0},l,c=!1;l=r.isFeatureOn(i.featureFlags.PES_CDN_AUTH_ENABLED),l&&(f.withCredentials=!0),a=a||u,n.compat(f).then(h,p)}}),define("telemetry/chat/messageSent",["require","exports","module","experience/settings","constants/common","ui/telemetry/telemetryClient","telemetry/chat/telemetryEnumerator","browser/window","swx-enums"],function(e,t){function h(e,t,r,a){function m(e){return e?c.PRESENT:c.NOT_PRESENT}function g(){return y()-p}function y(){return(new u.Date).getTime()}function b(){var n=e._translatorSettings;return n&&n.isEnabled?n.meLanguage.code+"-"+n.participantLanguage.code:t.translations()[0].key}function w(e){switch(e){case l.TextMessage:return"Text";case l.PictureMessage:return"Photo";case l.VideoMessage:return"Video_message";case l.FileTransfer:return"File";case l.ContactInfoMessage:return"Contact";case l.MojiMessage:return"Moji";case l.PollMessage:return"Poll";default:return f}}function E(){return a||a===0?a:t.type()!==l.TextMessage?f:t.html().length}var h=this,p=y(),d=!1,v={};h.heartEvent=function(){d=!0},h.publish=function(u){var a=g(),f=i.TYPE,l=e.participantsCount(),c=E(),h=t.translations&&t.translations.size()>0;v.group_conversation=m(e.isGroupConversation()),e.isGroupConversation()&&(v.conversation_id=e.conversationId.replace("19:","")),v.conversation_members_number=l+1,v.send_timestamp=t.timestamp().getTime(),v.message_type=w(t.type()),v.send_context="chat_view",d&&(v.message_type="Heart_"+v.message_type.toLowerCase()),v.translation_action=m(h),h&&(v.translation_value=b()),v.swx_messageLength=c,v.swx_isRemove=c===0,v.swx_isEdit=!!r&&!v.swx_isRemove,v.swx_participantsCountGroup=o.getParticipantCountGroup(l),v.swx_responseCode=u,v.swx_isError=o.isError(u),v.swx_tts=a,v.swx_ttsGroup=o.getSecondsDurationGroupFromMs(a),v.swx_isFavorite=!!e._isFavorited&&e._isFavorited(),s.get().sendEvent(n.telemetry.uiTenantToken,f,v)}}var n=e("experience/settings"),r=e("constants/common"),i=r.telemetry.messageSent,s=e("ui/telemetry/telemetryClient"),o=e("telemetry/chat/telemetryEnumerator"),u=e("browser/window"),a=e("swx-enums"),f=r.telemetry.NOT_AVAILABLE,l=a.activityType,c={PRESENT:"Yes",NOT_PRESENT:"No"};t.build=function(e,t,n,r){return new h(e,t,n,r)},t.presenceType=c}),define("jSkype/services/annotations/main",["require","lodash-compat","jSkype/client","jSkype/services/serviceAccessLayer/serviceLocator","jSkype/settings","jSkype/services/webapi/constants","utils/chat/messageSanitizer","jSkype/modelHelpers/personHelper","jSkype/modelHelpers/personsAndGroupsHelper","jcafe-property-model","jSkype/services/webapi/main","telemetry/chat/messageSent","constants/common"],function(e){function v(){function e(e,r){var i=e(r.key),s=n.get().personsAndGroupsManager.mePerson,o;i||(i={key:r.key,users:r.users||[]}),o=t.some(i.users,function(e){return a.isMePerson(e.mri)}),o||(e.empty(),i.users.push({mri:s.id(),person:s,time:(new Date).getTime(),value:r.value}),e.add(i,i.key))}function s(e,n){var r=e(n.key);if(!r)return;e.empty(),t.remove(r.users,function(e){return a.isMePerson(e.mri)}),e.add(r,r.key)}function h(e,t,n){if(n!==p.EMOTIONS)return;var r=c.build(t,e);return r.heartEvent(),r}function v(t,n,r,i,o){function l(e){s(r,o),u.reject(e);if(a){var t=e?e.status:d;a.publish(t)}}function c(e){u.resolve();if(a){var t=e?e.response.status:d;a.publish(t)}}var u=f.task(),a=h(t,n,i);return e(r,o),g().setMessageProperty(n.conversationId,t,i,o,c,l),u.promise}function m(t,n,r,i,o){function l(t){e(r,o),u.reject(t);if(a){var n=t?t.status:d;a.publish(n)}}function c(e){u.resolve();if(a){var t=e?e.response.status:d;a.publish(t)}}var u=f.task(),a=h(t,n,i);return s(r,o),g().removeMessageProperty(n.conversationId,t,i,o.key,c,l),u.promise}function g(){var e=r.build(i.settings.webApiServiceHost);return l.getInstance(e)}function y(e,t,n){var r="_"+t+"Array";return e[r]?e[r](n):null}this.parseMessageProperties=function(e,r){if(!r.properties)return;var i=n.get().personsAndGroupsManager.mePerson;t.forEach(e._supportedAnnotations,function(n){var s=r.properties[n],f=e["_"+n+"Array"];t.forEach(s,function(e){var n=f(e.key);n||(n={key:e.key,users:[]},f.add(n,e.key)),e.users.forEach(function(e){var r=u.getId(e.mri);a.isMePerson(r)?e.person=i:(e.person=a.getPersonById(r),e.person||(e.person=a.createDefaultPerson(r))),e.value&&(e.value=o.getMessageSanitizedContent(o.unescapeHTML(e.value)));var s=t.some(n.users,function(e,t){return t.mri===e.mri});s||n.users.push(e)})})})},this.updateMessageProperties=function(e,n){var r;t.forEach(e._supportedAnnotations,function(i){r="_"+i+"Array";if(!e[r])return;e[r].empty(),n[r]&&t.forEach(n[r](),function(t){e[r].add(t,t.key)})})},this.decorateEmotions=function(e,t){if(e.emotions)return;e._supportedAnnotations.push(p.EMOTIONS),e._emotionsArray=f.collection(),e.emotions=e._emotionsArray.asWritable({add:f.command(v.bind(null,e,t,e._emotionsArray,p.EMOTIONS),f.boolProperty(!0)),remove:f.command(m.bind(null,e,t,e._emotionsArray,p.EMOTIONS),f.boolProperty(!0))})},this.decorateTranslations=function(e,t){if(t.isGroupConversation())return;if(e.translations)return;e._supportedAnnotations.push(p.TRANSLATIONS),e._translationsArray=f.collection(),e.translations=e._translationsArray.asWritable({add:f.command(v.bind(null,e,t,e._translationsArray,p.TRANSLATIONS),f.boolProperty(!0)),remove:f.command(m.bind(null,e,t,e._translationsArray,p.TRANSLATIONS),f.boolProperty(!0))})},this.decoratePoll=function(e,t){if(!t.isGroupConversation())return;if(e.poll)return;e._supportedAnnotations.push(p.POLL),e._pollArray=f.collection(),e.poll=e._pollArray.asWritable({add:f.command(v.bind(null,e,t,e._pollArray,p.POLL),f.boolProperty(!0)),remove:f.command(m.bind(null,e,t,e._pollArray,p.POLL),f.boolProperty(!0))})},this.isMessagePropertyUnseen=function(e,n,r,i){var s,o=!1;return e.sender&&!a.isMePerson(e.sender.id())?o:(s=y(e,n,r),s?(t.forEach(s.users,function(e){e.time>i&&!a.isMePerson(e.mri)&&(o=!0)}),o):o)},this.getMessagePropertyLastTimestamp=function(e,t,n){var r=y(e,t,n);return r?(r.users.sort(function(e,t){return e.time-t.time}),r.users[r.users.length-1].time):null},this.getLastPersonFromProperty=function(e,t,n){var r=y(e,t,n);return r?(r.users.sort(function(e,t){return e.time-t.time}),r.users[r.users.length-1].person):null}}var t=e("lodash-compat"),n=e("jSkype/client"),r=e("jSkype/services/serviceAccessLayer/serviceLocator"),i=e("jSkype/settings"),s=e("jSkype/services/webapi/constants"),o=e("utils/chat/messageSanitizer"),u=e("jSkype/modelHelpers/personHelper"),a=e("jSkype/modelHelpers/personsAndGroupsHelper"),f=e("jcafe-property-model"),l=e("jSkype/services/webapi/main"),c=e("telemetry/chat/messageSent"),h=e("constants/common"),p=s.MESSAGE_PROPERTIES.PER_USER,d=h.telemetry.NOT_AVAILABLE;return new v}),define("jSkype/models/conversationActivityItem",["require","jcafe-property-model","utils/chat/messageSanitizer","utils/chat/urlValidator","utils/common/encoder","lodash-compat","swx-enums","jSkype/services/asyncMedia/main","swx-i18n","jSkype/services/mojiMedia/main","utils/chat/dateTime","jSkype/services/annotations/main","jSkype/client","constants/common","jSkype/settings"],function(e){function v(e){var t=a.fetch({key:"message_text_removed",params:{date:l.formatDate(e),time:l.formatTimestampShort(e)}});return'<span class="deleted">'+t+"</span>"}function m(e,t,n){var r;return t.chatService._editMessage(n,e).then(function(){r=t.historyService.activityItems(e.key()),r.status._set(o.activityStatus.Succeeded)},function(){r=t.historyService.activityItems(e.key()),r.status._set(o.activityStatus.Failed)}),e.status._set(o.activityStatus.Pending),n.length===0?(e.isDeleted._set(!0),v(t.lastModificationTimestamp())):n}function g(){var e=this;e.key=t.property({readOnly:!0}),e.type=t.property({readOnly:!0}),e.timestamp=t.property({readOnly:!0}),e.status=t.property({readOnly:!0}),e.reason=t.property({readOnly:!0}),e.isRead=t.property({readOnly:!0,value:!0}),e._supportedAnnotations=[]}function y(){s.merge(this,new g),this.author=null,this.persons=t.collection(),this.context=t.property({readOnly:!0})}function b(){s.merge(this,new g),this.direction=t.property({readOnly:!0}),this.duration=t.property({readOnly:!0})}function w(){s.merge(this,new g),this.direction=t.property({readonly:!0}),this.isGroup=t.property({readonly:!0}),this.participantName=t.property({readonly:!0}),this.participantEndpoint=t.property({readonly:!0})}function E(){s.merge(this,new g),this.participantNames=t.collection()}function S(){s.merge(this,new g)}function x(e){function a(t){return m(r,e,t)}if(!e)throw new Error("Text message activity item requires conversation");s.merge(this,new g);var r=this,o=t.boolProperty(!1),u=t.command(a,o);this.direction=t.property({readOnly:!0}),this.sender=null,this.isEdited=t.property({readOnly:!0}),this.isDeleted=t.property({readOnly:!0}),this.html=t.property({set:u}),this._htmlSetEnabled=o,this.text=function(){var t=n.unwebify(r.html());return i.build(h).getNodeTextContent(t)},this.isDeleted.once(!0,function(){o(!1)}),this._isOriginal=function(){return!r.isEdited()&&!r.isDeleted()},this._updateAllProperties=function(e){r._id=e._id,r._actualId=e._actualId,r.key._set(e.key()),r.type._set(e.type()),r.timestamp._set(e.timestamp()),r.status._set(e.status()),r.reason._set(e.reason()),r.isRead._set(e.isRead()),r.direction._set(e.direction()),r.sender=e.sender,r.isEdited._set(e.isEdited()),r.isDeleted._set(e.isDeleted()),r.html._set(e.html()),r._htmlSetEnabled(e._htmlSetEnabled()),c.updateMessageProperties(r,e)},c.decorateEmotions(this,e),c.decorateTranslations(this,e)}function T(e){function f(t){return t.length===0&&u.deleteFile(n.documentId()),m(n,e,t)}if(!e)throw new Error("Video message activity item requires conversation");var n=this,r,i=t.boolProperty(!1),a=t.command(f,i);s.merge(this,new g(e)),n._uri=null,n.type._set(o.activityType.VideoMessage),n.direction=t.property({readOnly:!0}),n.duration=t.property({readOnly:!0}),n.sender=null,n.thumbnailPath=t.property({readOnly:!0}),n.thumbnailProgress=t.property({readOnly:!0}),n.mediaUrl=t.property({readOnly:!0}),n.mediaUrlProgress=t.property({readOnly:!0}),n.html=t.property({set:a}),n._htmlSetEnabled=i,n.isDeleted=t.property({readOnly:!0,value:!1}),n.documentId=t.property({readOnly:!0}),n.isExpired=t.property({readOnly:!0,get:function(){return r||(r=t.task(),u.getVideoStatus(n._uri,function(){r.resolve(!1)},function(){r.resolve(!0)})),r.promise}}),this._isOriginal=function(){return!n.isDeleted()},this._updateAllProperties=function(e){c.updateMessageProperties(n,e),n.isDeleted._set(e.isDeleted()),n.html._set(e.html()),n._htmlSetEnabled(e._htmlSetEnabled())},c.decorateEmotions(this,e)}function N(e){function u(t){return m(n,e,t)}var n=this,r=t.boolProperty(!1),i=t.command(u,r);if(!e)throw new Error("ContactInfo message activity item requires conversation");s.merge(this,new g),this.direction=t.property({readOnly:!0}),this.sender=null,this.type._set(o.activityType.ContactInfoMessage),this.contacts=t.collection(),this.html=t.property({set:i}),this._htmlSetEnabled=r,this.isDeleted=t.property({readOnly:!0,value:!1}),this._isOriginal=function(){return!n.isDeleted()},n._updateAllProperties=function(e){n._id=e._id,n._actualId=e._actualId,n.status._set(e.status()),n.isDeleted._set(e.isDeleted()),n.html._set(e.html()),n._htmlSetEnabled(e._htmlSetEnabled()),c.updateMessageProperties(n,e)}}function C(e){function l(t){return t.length===0&&e.fileTransferService.remove(n.documentId()),m(n,e,t)}if(!e)throw new Error("Picture message activity item requires conversation");s.merge(this,new g);var n=this,r=t.boolProperty(!1),i=t.command(l,r),a,f;n._uri=null,n.direction=t.property({readOnly:!0}),n.sender=null,n.type._set(o.activityType.PictureMessage),n.progress=t.property({value:0}),n.shouldAbort=t.boolProperty(!1),n.html=t.property({set:i}),n._htmlSetEnabled=r,n.isDeleted=t.property({readOnly:!0,value:!1}),n.documentId=t.property({readOnly:!0}),n.thumbnailUrl=t.property({readOnly:!0,get:function(){if(!n._uri)return;return a||(a=t.task(),u.getThumbnailStatus(n._uri,a.resolve.bind(a),a.reject.bind(a))),a.promise}}),n.pictureUrl=t.property({readOnly:!0,get:function(){if(!n._uri)return;return f||(f=t.task(),u.getPictureStatus(n._uri,f.resolve.bind(f),f.reject.bind(f))),f.promise}}),this._isOriginal=function(){return!n.isDeleted()},n._updateAllProperties=function(e){n._id=e._id,n._actualId=e._actualId,n.status._set(e.status()),n._uri=e._uri,n.pictureUrl.get(),c.updateMessageProperties(n,e)},c.decorateEmotions(this,e)}function k(e){function u(t){return t.length===0&&e.fileTransferService.remove(n.documentId()),m(n,e,t)}if(!e)throw new Error("File transfer message activity item requires conversation");var n=this,r=t.boolProperty(!1),i=t.command(u,r);s.merge(this,new g),n.direction=t.property({readOnly:!0}),n.sender=null,n.type._set(o.activityType.FileTransfer),n.fileName=null,n.fileType=null,n.fileUri=t.property({readOnly:!0}),n.fileThumbnailUri=t.property({readOnly:!0}),n.fileSize=null,n.progress=t.property({value:0}),n.shouldAbort=t.boolProperty(!1),n.html=t.property({set:i}),n._htmlSetEnabled=r,n.isDeleted=t.property({readOnly:!0,value:!1}),n.documentId=t.property({readOnly:!0}),this._isOriginal=function(){return!n.isDeleted()},n._updateAllProperties=function(e){c.updateMessageProperties(n,e),n._id=e._id,n._actualId=e._actualId,n.isDeleted._set(e.isDeleted()),n.html._set(e.html()),n._htmlSetEnabled(e._htmlSetEnabled())},c.decorateEmotions(this,e)}function L(){function n(){var t={name:p.telemetry.contacts.name.CONTACT_REQUEST_READ,user_from:[e.sender.id(),window.skypeTelemetryManager.PIIType.Identity]};h.get()._telemetryManager.sendEvent(d.settings.telemetry.jSkypeTenantToken,p.telemetry.contacts.type.CONTACT_REQUESTS,t)}var e=this;s.merge(this,new g),this.greeting=t.property({readOnly:!0}),this.sender=null,this.isRead._set(!1),this.direction=t.property({readOnly:!0,value:o.direction.Incoming}),this.isRead.once(!0,function(){e.sender!==null&&e.direction()===o.direction.Incoming&&n()})}function A(e){function a(){return u||(u=(new Promise(function(e,t){f.getMojiMetaData(n._metaDataUri,e,t)})).then(function(e){return r.validate(e.auxiliaryUrl)||(e.auxiliaryUrl=""),e.description=e.description||"",e.auxiliaryText=e.auxiliaryText||e.auxiliaryUrl,e.copyright=e.copyright||"",e})),u}function l(t){return m(n,e,t)}var n=this,i=t.boolProperty(!1),o=t.command(l,i),u;if(!e)throw new Error("Moji message activity item requires conversation");s.merge(this,new g(e)),this.direction=t.property({readOnly:!0}),this.thumbnailUrl=t.property({readOnly:!1}),this.mojiUrl=t.property({readOnly:!1}),this.sender=null,this._metaDataUri=null,this.isDeleted=t.property({readOnly:!0,value:!1}),this.html=t.property({set:o}),this._htmlSetEnabled=i,this.mojiMetaData=t.property({readOnly:!0,get:a}),this._isOriginal=function(){return!n.isDeleted()},n._updateAllProperties=function(e){n._id=e._id,n._actualId=e._actualId,c.updateMessageProperties(n,e)},c.decorateEmotions(this,e)}function O(e){function o(t){return m(n,e,t)}if(!e)throw new Error("Poll message activity item requires conversation");s.merge(this,new g);var n=this,r=t.boolProperty(!1),i=t.command(o,r);n.conversationId=t.property({readOnly:!0}),n.xmmType=t.property({readOnly:!0}),n.direction=t.property({readOnly:!0}),n.sender=null,n.isEdited=t.property({readOnly:!0}),n.isDeleted=t.property({readOnly:!0,value:!1}),n.html=t.property({set:i}),n._htmlSetEnabled=r,n.pollQuestion=t.property({readOnly:!0}),n.pollAnswers=t.collection({readOnly:!0}),n.highestNumberOfVotes=t.property({readOnly:!0}),n.peopleVotedNum=t.property({readOnly:!0}),n.meCheckedAnswerPositions=t.collection({readOnly:!0}),n.meVoted=t.property({readOnly:!0}),n.multipleVotes=t.boolProperty(!1),n._isOriginal=function(){return!this.isEdited()&&!this.isDeleted()},n._updateAllProperties=function(e){var t=this;t._id=e._id,t._actualId=e._actualId,t.key._set(e.key()),t.type._set(e.type()),t.timestamp._set(e.timestamp()),t.status._set(e.status()),t.reason._set(e.reason()),t.isRead._set(e.isRead()),t.direction._set(e.direction()),t.sender=e.sender,t.isEdited._set(e.isEdited()),t.isDeleted._set(e.isDeleted()),t.html._set(e.html()),t._htmlSetEnabled(e._htmlSetEnabled()),t.conversationId._set(e.conversationId()),t.xmmType._set(e.xmmType()),t.pollQuestion._set(e.pollQuestion()),t.pollAnswers(e.pollAnswers()),t.highestNumberOfVotes._set(e.highestNumberOfVotes()),t.peopleVotedNum._set(e.peopleVotedNum()),t.meCheckedAnswerPositions(e.meCheckedAnswerPositions()),t.meVoted._set(e.meVoted()),t.multipleVotes._set(e.multipleVotes()),c.updateMessageProperties(t,e)},n.addAnswer=function(e){var t=this,n=t.pollAnswers().indexOf(e);if(n===-1)return;t.meCheckedAnswerPositions.add(n),t.poll.add({key:"pollAnswer",value:JSON.stringify(t.meCheckedAnswerPositions())}),t.meVoted._set(!0)},c.decorateEmotions(this,e),c.decoratePoll(n,e)}function M(e){var n=this;s.merge(n,new g(e)),n.sender=null,n.direction=t.property({readOnly:!0}),n.isRead._set(!1),n.orderId=null,n.transactionStatus=t.property({readOnly:!0,value:o.transactionStatus.Pending}),n.amount=null,n.currency=null,n.personalization=null,n._isOriginal=function(){return!0},n._updateAllProperties=function(e){var t=this;t._id=e._id,t._actualId=e._actualId,c.updateMessageProperties(t,e)},c.decorateEmotions(this,e)}var t=e("jcafe-property-model"),n=e("utils/chat/messageSanitizer"),r=e("utils/chat/urlValidator"),i=e("utils/common/encoder"),s=e("lodash-compat"),o=e("swx-enums"),u=e("jSkype/services/asyncMedia/main"),a=e("swx-i18n").localization,f=e("jSkype/services/mojiMedia/main"),l=e("utils/chat/dateTime"),c=e("jSkype/services/annotations/main"),h=e("jSkype/client"),p=e("constants/common"),d=e("jSkype/settings");return{ConversationActivityItem:g,ParticipantActivityItem:y,NgcUpgradeActivityItem:E,CallingActivityItem:b,PluginFreeActivityItem:S,PstnActivityItem:w,TextMessageActivityItem:x,VideoMessageActivityItem:T,PictureMessageActivityItem:C,FileTransferActivityItem:k,ContactRequestActivityItem:L,MojiMessageActivityItem:A,TransactionMessageActivityItem:M,ContactInfoMessageActivityItem:N,PollMessageActivityItem:O}}),define("jSkype/utils/chat/mentionsParser",["require","jSkype/client","jSkype/modelHelpers/personsAndGroupsHelper"],function(e){function r(){var e=this,r=/@([^\s@]*)/g;e.getMentions=function(t){var n=[],i=t.match(r)||[];return i.forEach(function(t){var r=e.getMentionUserData(t);r.displayName?n.push(t):n.push(t.replace(/[,.;\-!\?']*$/,""))}),n},e.getMentionUserData=function(e){var r,i="",s=t.get().personsAndGroupsManager.mePerson,o={defaultUserName:"",displayName:"",isMePerson:!1};return e?(o.isMePerson=n.isMePerson(e),o.isMePerson?r=s:r=n.getPersonById(e),r&&(o.displayName=r.displayName(),r.firstName()&&(o.defaultUserName=r.firstName(),i=" "),r.lastName()&&(o.defaultUserName+=i+r.lastName()),o.defaultUserName||(o.defaultUserName=o.displayName)),o):o}}var t=e("jSkype/client"),n=e("jSkype/modelHelpers/personsAndGroupsHelper");return new r}),define("jSkype/telemetry/poll",["require","jSkype/client","constants/common","jSkype/settings"],function(e){function i(){this.sendPoll=function(s){var o=e(s,n.telemetry.poll.activityType.SEND);t.get()._telemetryManager.sendEvent(r.settings.telemetry.jSkypeTenantToken,n.telemetry.poll.eventName.ACTIVITY,o),s.pollAnswers().forEach(function(e){var i={};i[n.telemetry.poll.property.CONVERSATION_ID]=s.conversationId(),i[n.telemetry.poll.property.ANSWER_LENGTH]=e.answerText.length,t.get()._telemetryManager.sendEvent(r.settings.telemetry.jSkypeTenantToken,n.telemetry.poll.eventName.ANSWER_LENGTH,i)})},this.error=function(i,s,o,u){var a={};a[n.telemetry.poll.property.CONVERSATION_ID]=i,s&&(a[n.telemetry.poll.property.MESSAGE_ID]=s),a[n.telemetry.poll.property.XMM_TYPE]=o,a[n.telemetry.poll.property.ERROR_TYPE]=u,t.get()._telemetryManager.sendEvent(r.settings.telemetry.jSkypeTenantToken,n.telemetry.poll.eventName.ERROR,a)};var e=function(t,r){var i={};return i[n.telemetry.poll.property.CONVERSATION_ID]=t.conversationId(),i[n.telemetry.poll.property.MESSAGE_ID]=t.key(),i[n.telemetry.poll.property.ACTIVITY_TYPE]=r,i[n.telemetry.poll.property.XMM_TYPE]=t.xmmType(),i[n.telemetry.poll.property.QUESTION_LENGTH]=t.pollQuestion().length,i[n.telemetry.poll.property.ANSWERS_COUNT]=t.pollAnswers().length,i[n.telemetry.poll.property.MULTI_VOTE]=t.multipleVotes(),i[n.telemetry.poll.property.TIME_SINCE_CREATION]=(new Date).getTime()-t.timestamp(),i}}var t=e("jSkype/client"),n=e("constants/common"),r=e("jSkype/settings");return new i}),define("jSkype/utils/chat/messageTypes",["require","exports","module","lodash-compat","swx-i18n","utils/common/encoder","swx-enums","constants/common","jSkype/client","jSkype/models/conversationActivityItem","jSkype/modelHelpers/contacts/dataMappers/dataMaps","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/modelHelpers/personHelper","jSkype/settings","jSkype/services/annotations/main","jSkype/telemetry/poll","jSkype/utils/chat/parser","utils/chat/dateTime","utils/chat/messageSanitizer","jSkype/utils/chat/message","utils/chat/pesUtils","utils/chat/urlValidator"],function(e,t){function x(e){var t=r.fetch({key:"message_text_removed",params:{date:m.formatDate(e),time:m.formatTimestampShort(e)}});return'<span class="deleted">'+t+"</span>"}function T(){var e,t=r.fetch({key:"message_text_removed",params:{date:"[^<>&]*",time:"[^<>&]*"}});return e='(?:<|&lt;)span class="deleted"(?:>|&gt;)'+t+"(?:<|&lt;)/span(?:>|&gt;)",e}function N(){var e;return e=new RegExp("^"+T()+"$"),e}function C(e){var t=/<target>(\d+:[^<]+)<\/target>/,n=e.match(t);if(n)return n[1]}function k(e){var t=/<value>(.+)<\/value>/,n=e.match(t);if(n)return n[1]}function L(e){return e.content=r.fetch({key:"message_text_parsing_error"}),j(e)}function A(e){return e.content=r.fetch({key:"message_text_pollsFeatureDisabled"}),j(e)}function O(e){return e.messagetype=g.escapeIncomingHTML(e.messagetype),e.content=r.fetch({key:"message_text_unknownMessageType",params:{mesageType:e.messagetype}}),j(e)}function M(e){var t=i.build(u).decode(e),n=g.removeMetaData(t);return n.length===0?!0:N().test(n)}function _(e){return!e._processed&&!M(e.content)&&(e.content=g.getMessageSanitizedContent(e.content)),j(e)}function D(e){if(e._processed||M(e.content))return j(e);var t=function(e){var t=/<Currency(.+?)\/>(.+?)<\/URIObject>/,n=e.match(t);return n&&n.length>2&&n[2]},n=t(e.content);return n&&(e.content=g.getMessageSanitizedContent(n)),_(e)}function P(e){var t=c.getId(g.escapeIncomingHTML(e));return l.getPerson(t,c.getTypeFromKey(e))}function H(e){if(e._proccessed)return;e.content=g.removeMetaData(e.content),e.content.length===0&&(e.isDeleted=!0,e.content=x(new Date(parseInt(e.timestamp)))),e._proccessed=!0}function B(e,t){H(t),e.html._set(t.content),!t.isMyself||e._htmlSetEnabled(!0),e.isDeleted._set(!!t.isDeleted),e.isEdited._set(!!t.skypeeditedid&&!t.isDeleted)}function j(e){var t=P(e.author),n;return n=new a.TextMessageActivityItem(e.conversationModel),n._id=e.id,n.sender=t,B(n,e),n.type._set(s.activityType.TextMessage),n.direction._set(e.isMyself?s.direction.Outgoing:s.direction.Incoming),p.parseMessageProperties(n,e),n}function F(e){var t=P(e.author),n,r;return n=new a.ContactInfoMessageActivityItem(e.conversationModel),n._id=e.id,n.sender=t,n.direction._set(e.isMyself?s.direction.Outgoing:s.direction.Incoming),r=J(e),r.forEach(function(e,t){n.contacts.add(e,t)}),e.isMyself&&n._htmlSetEnabled.set(!0),n}function I(e){var t=new a.ParticipantActivityItem;return t._id=e.id,t.type._set(e.activityType),t.author=e.author,t.persons(e.persons),t.context._set(e.context),t}function q(e){var t=new a.NgcUpgradeActivityItem,n=e.content.match(/<systemMessage[^>]*?\susers=\"([^"]+?)\"/i),r=n&&n[1]?n[1].split("##~~"):[];return t._id=e.id,t.type._set(s.activityType.NgcUpgradeMessage),r.forEach(function(e){t.participantNames.add(g.escapeIncomingHTML(e.trim()))}),t}function R(e,t){var n;return w.validate(t,h.settings.URLSanitizer.securedResources)?(n=new a.PictureMessageActivityItem(e.conversationModel),n._id=e.id,n.isRead._set(!1),n.direction._set(e.isMyself?s.direction.Outgoing:s.direction.Incoming),n.sender=P(e.author),n._uri=t,e.isMyself&&n._htmlSetEnabled.set(!0),p.parseMessageProperties(n,e),n):O(e)}function U(e){var t=P(e.author),r=u.get().personsAndGroupsManager.mePerson,i=new a.PollMessageActivityItem(e.conversationModel),o=(new DOMParser).parseFromString(e.content,"text/xml"),f=o.documentElement.getAttribute("type"),l=o.documentElement.getElementsByTagName("Question")[0].getAttribute("value"),c=o.documentElement.getElementsByTagName("MultipleChoice"),h=c.length?c[0].getAttribute("value")==="true":!1,d=0,v=0,m=[],y=n.map(o.documentElement.getElementsByTagName("Answer"),function(e){return{answerText:g.escapeIncomingHTML(g.unwebify(e.getAttribute("value"))),barWidth:0,votes:0,users:[]}});p.parseMessageProperties(i,e),i._id=e.id,i.sender=t,i.conversationId._set(e.conversationModel.conversationId),H(e),!e.isMyself||i._htmlSetEnabled.set(!0),i.isDeleted._set(!!e.isDeleted),i.isEdited._set(!!e.skypeeditedid&&!e.isDeleted),i.type._set(s.activityType.PollMessage),i.direction._set(e.isMyself?s.direction.Outgoing:s.direction.Incoming);if(i.poll){var b=n.find(i.poll(),function(e){return e.key==="pollAnswer"});b&&b.users&&(b.users.forEach(function(e){var t=e.value?JSON.parse(e.value):[],n={};v++,n.person=e.person,e.person?n.displayName=e.person.displayName():n.displayName=e.mri,t.forEach(function(e){var t=y[e];t.votes=t.votes+1,t.users.push(n),d<t.votes&&(d=t.votes)}),e.person===r&&(m=t)}),b.users.forEach(function(e){var t=JSON.parse(e.value);t.forEach(function(e){var t=y[e];t.barWidth=Math.round(t.votes/d*100)})}))}return i.xmmType._set(f),i.pollQuestion._set(g.escapeIncomingHTML(g.unwebify(l))),i.highestNumberOfVotes._set(d),i.pollAnswers(y),i.peopleVotedNum._set(v),i.meCheckedAnswerPositions(m),i.meVoted._set(!n.isEmpty(m)),i.multipleVotes._set(h),i}function z(e,t){var n,r=t.match(/.+\/(.+?)\/?$/),i=h.isFeatureOn(o.featureFlags.IS_CLOUD_VIDEO_MESSAGE_ENABLED);return!i||!w.validate(t,h.settings.URLSanitizer.securedResources)?O(e):(n=new a.VideoMessageActivityItem(e.conversationModel),n._id=e.id,n._uri=t,n.isRead._set(!1),n.direction._set(e.isMyself?s.direction.Outgoing:s.direction.Incoming),n.sender=P(e.author),n.documentId._set(r[1]),n.thumbnailPath._set(t+"/views/thumbnail"),n.mediaUrl._set(t+"/views/video"),e.isMyself&&n._htmlSetEnabled.set(!0),p.parseMessageProperties(n,e),n)}function W(e,t){function c(e){if(!e)return"unknown";var t=e.split(".");return t.length<2?"unknown":t.pop().toLowerCase()}var n=P(e.author),r=new a.FileTransferActivityItem(e.conversationModel),i=t.match(/.+\/(.+?)\/?$/),o=e.content.match(/<OriginalName[\s]+[^<]*v=\"([\s\S]*?)\"[^<]/),u=e.content.match(/<URIObject[\s\S]*url_thumbnail=\"([\S]*?)\"/i),f=e.content.match(/<FileSize[\s]+[^<]*v=\"([\d]*?)\"[^<]/i),l=e.content.match(/uri=\"https:[s\S]*v1\/objects\/([\s\S]*?)(\"|\/)/);return r.isRead._set(!1),r.direction._set(e.isMyself?s.direction.Outgoing:s.direction.Incoming),r.sender=n,r.fileName=o[1],r.fileType=c(o[1]),r.fileThumbnailUri._set(u[1]),r.fileUri._set(h.settings.amdServiceHost+"/v1/objects/"+i[1]+"/views/original"),r.fileSize=f?f[1]:0,r.documentId._set(l[1]),e.isMyself&&r._htmlSetEnabled.set(!0),p.parseMessageProperties(r,e),r}function X(e){var t,n=new a.TransactionMessageActivityItem(e.conversationModel);return n.sender=P(e.author),n.type._set(s.activityType.CreditTransaction),n.direction._set(e.isMyself?s.direction.Outgoing:s.direction.Incoming),t=e.content.match(/<Order[^>]*?\svalue=\"([^"]+?)\"/i),n.orderId=t&&g.escapeIncomingHTML(t[1]),t=e.content.match(/<Personalization[^>]*?\svalue=\"([^"]+?)\"/i),n.personalization=t&&g.escapeIncomingHTML(t[1]),t=e.content.match(/<Amount[^>]*?\svalue=\"([^"]+?)\"/i),n.amount=t&&parseFloat(g.escapeIncomingHTML(t[1])),t=e.content.match(/<Currency[^>]*?\svalue=\"([^"]+?)\"/i),n.currency=t&&g.escapeIncomingHTML(t[1]),p.parseMessageProperties(n,e),n}function V(e){var t=e.content.match(/<sms alt=\"([^"]+?)\">/);return g.escapeIncomingHTML(t[1])}function $(){var e=r.fetch({key:"message_text_fileTransferNotSupported"});return'<div class="icon-error"></div>'+e}function J(e){function i(e){var t=/(<c t=\"([^"]+?)\"( p=\"([^"]+?)\")?( s=\"([^"]+?)\")?( f=\"([^"]+?)\")?\/>)/,n,i,s,o;return n=e.match(t),n[2]==="s"?(i=g.escapeIncomingHTML(n[6]),s=n[8]?g.escapeIncomingHTML(n[8]):i,o=f.contactTypes[f.contactTypeNames.skype]):(n[4]=g.escapeIncomingHTML(n[4]),i=s=n[4],o=f.contactTypes[f.contactTypeNames.pstn]),r=l.getPerson(i,o),r.displayName._set(s),r}function s(){var e=[];for(var t=0;t<n.length;t++)e.push(i(n[t]));return e}var t=/(<c t=\"([^"]+?)\"( p=\"([^"]+?)\")?( s=\"([^"]+?)\")?( f=\"([^"]+?)\")?\/>)/g,n=e.content.match(t),r;return n?s():null}function K(e){var t=e.content.match(/<URIObject[^>]*?\suri=\"([^"]+?)\"/i);return t?{url:t[1]}:null}function Q(e){var t,n,r,i,u="en",f,l,c,d;return t=h.isFeatureOn(o.featureFlags.IS_FLIK_MESSAGE_ENABLED),n=h.isFeatureOn(o.featureFlags.PES_CDN_AUTH_ENABLED),M(e.content)?_(e):t?(h.settings.locale&&h.settings.locale.pes&&(u=h.settings.locale.pes),r=new a.MojiMessageActivityItem(e.conversationModel),i=P(e.author),f=K(e),f?(l=f.url,w.validate(l,h.settings.URLSanitizer.securedResources)?(n&&(l=b.rewriteUrls(l,h.settings.pesCDNAuthentication.rewriteRules)),c=l+"/views/default",d=l+"/views/thumbnail",r._id=e.id,r.isRead._set(!1),r.direction._set(e.isMyself?s.direction.Outgoing:s.direction.Incoming),r.type._set(s.activityType.MojiMessage),r.sender=i,r.thumbnailUrl._set(d),r.mojiUrl._set(c),r._metaDataUri=l+"/views/meta."+u,e.isMyself&&r._htmlSetEnabled.set(!0),p.parseMessageProperties(r,e),r):O(e)):O(e)):O(e)}function G(e){var t=e.content.match(/<URIObject[^>]*?\suri=\"([^"]+?)\"/i),n=e.content.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i),r=e.content.match(/<meta[^>]*?\stype=\"([^"]+?)\"/i),i;return t?(t=t[1],n?(n=n[1].split(".")[0],i=E[n]||O,i(e,t)):r&&r[1]==="photo"?R(e,t):O(e)):_(e)}function Y(e){var t=J(e),n="";return t&&t.forEach(function(e){n+=r.fetch({key:"message_text_contactItem",params:{fullName:e.displayName(),name:e.id()}})}),n}function Z(e){var t,n,r=e.content.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i),i=r&&r[1]&&r[1].split(".")[0].toLowerCase();return(t=S[i])?(n=h.isFeatureOn(t.flagName),n?t.onHandler:t.offHandler):!1}function et(e){var t=e.content.match(/<systemMessage[^>]*?\stype=\"([^"]+?)\"/i);return t&&t[1]==="ngcUpgradeMessage"?q:!1}var n=e("lodash-compat"),r=e("swx-i18n").localization,i=e("utils/common/encoder"),s=e("swx-enums"),o=e("constants/common"),u=e("jSkype/client"),a=e("jSkype/models/conversationActivityItem"),f=e("jSkype/modelHelpers/contacts/dataMappers/dataMaps"),l=e("jSkype/modelHelpers/personsAndGroupsHelper"),c=e("jSkype/modelHelpers/personHelper"),h=e("jSkype/settings"),p=e("jSkype/services/annotations/main"),d=e("jSkype/telemetry/poll"),v=e("jSkype/utils/chat/parser"),m=e("utils/chat/dateTime"),g=e("utils/chat/messageSanitizer"),y=e("jSkype/utils/chat/message"),b=e("utils/chat/pesUtils"),w=e("utils/chat/urlValidator"),E={Picture:R,Video:z,File:W},S={credit:{onHandler:X,offHandler:D,flagName:o.featureFlags.CREDIT_GIFTING},poll:{onHandler:U,offHandler:A,flagName:o.featureFlags.POLLS_ENABLED}};t.fetch=function(e){return tt.hasOwnProperty(e)?tt[e]:tt.Unknown},t.parse=function(e,t){try{return e(t)}catch(n){var r=t.content.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i);return r&&r[1]&&r[1].split(".")[0].toLowerCase()==="poll"&&d.error(t.conversationModel.conversationId,t.key,r[1],o.telemetry.poll.errorType.PARSING),L(t)}},t._isDeletedMessage=M;var tt={Unknown:O,Text:_,RichText:function(e){var t=Z(e)||et(e);return t?t(e):_(e)},"RichText/Contacts":function(e){if(!e._proccessed&&!M(e.content)){var t=h.isFeatureOn(o.featureFlags.CONTACT_CARD_RENDERING_ENABLED);if(t)return F(e);e.content=r.fetch({key:"message_text_sentContacts",params:{contacts:Y(e)}})}return j(e)},"RichText/Files":function(e){return e._proccessed||(e.content=$()),j(e)},"RichText/Sms":function(e){return e._proccessed||(e.content=V(e)),j(e)},"RichText/Location":function(e){var t=e.content.match(/<a[^>]+href="https:\/\/www.bing.com\/maps([^"]+)"[^>]*>([^<]*)/);return t?(e._proccessed||(e.content='<a href="'+h.settings.locationHost+t[1]+'" target="_blank">'+g.escapeIncomingHTML(t[2])+"</a>"),j(e)):O(e)},"RichText/UriObject":G,"RichText/Media_GenericFile":function(e){return!e._proccessed&&!M(e.content)?G(e):j(e)},"RichText/Media_Video":G,"RichText/Media_FlikMsg":Q,"Event/SkypeVideoMessage":function(e){return e.content=r.fetch({key:"message_text_unsupportedVideoMessageYet"}),j(e)},"ThreadActivity/AddMember":function(e){var t={},n=y.getInitiator(e.content),r=y.getTargets(e.content),i=function(e){var t;return t=e.map(function(e){return P(e)}),t};return t.activityType=s.activityType.ParticipantJoined,t.author=P(n),t.persons=i(r),I(t)},"ThreadActivity/DeleteMember":function(e){var t={},n=y.getInitiator(e.content),r=C(e.content),i=v.getConversationIdFromUrl(e.conversationLink);return t.activityType=s.activityType.ParticipantLeft,t.author=P(n),t.persons=r===n?[]:[P(r)],t.context=i.replace(/^\d+:/,""),I(t)},"ThreadActivity/RoleUpdate":function(e){var t=y.getInitiator(e.content),n=/<target><id>(\d+:.+)<\/id><role>(.+)<\/role><\/target>/,r=e.content.match(n),i={};return i.activityType=s.activityType.ParticipantRoleUpdate,i.author=P(t),i.persons=[P(r[1])],i.context=g.escapeIncomingHTML(r[2]),I(i)},"ThreadActivity/TopicUpdate":function(e){var t=y.getInitiator(e.content),n=/(?:<value>(.+)<\/value>|<value \/>)/,r=e.content.match(n),o=i.build(u),a={};return a.activityType=s.activityType.ParticipantTopicUpdate,a.author=P(t),a.persons=[],a.context=g.escapeIncomingHTML(o.decode(g.unescapeHTML(r[1]||""))),I(a)},"ThreadActivity/PictureUpdate":function(e){var t=y.getInitiator(e.content),n={};return n.activityType=s.activityType.ParticipantPictureUpdate,n.author=P(t),n.persons=[],I(n)},"ThreadActivity/HistoryDisclosedUpdate":function(e){var t=y.getInitiator(e.content),n=k(e.content).toLowerCase(),r={};return r.activityType=s.activityType.ParticipantHistoryDisclosed,r.author=P(t),r.persons=[],r.context=n!=="false",I(r)},"ThreadActivity/JoiningEnabledUpdate":function(e){var t=y.getInitiator(e.content),n=k(e.content).toLowerCase(),r={};return r.activityType=s.activityType.ParticipantJoiningEnabled,r.author=P(t),r.persons=[],r.context=n!=="false",I(r)},"ThreadActivity/LegacyMemberAdded":function(e){var t=C(e.content),n={};return n.activityType=s.activityType.ParticipantLegacyMemberAdded,n.author=P(t),n.persons=[],I(n)},"ThreadActivity/LegacyMemberUpgraded":function(e){var t=C(e.content),n={};return n.activityType=s.activityType.ParticipantLegacyMemberUpgraded,n.author=P(t),n.persons=[],I(n)},"Event/Call":function(e){var t=e.content.replace(/\r?\n/g,""),n=c.getId(e.myself),r=new RegExp('<part identity="'+n+'">.*?<duration>(\\d+)</duration>\\s*?</part>',"g"),i=t.match(r.source),o=/<partlist type="started" alt="">(.*)<\/partlist>/.test(t),u=/<partlist alt="">\s*<\/partlist>/.test(t),f=/<partlist type="ended" alt="">(.*)<\/partlist>/.test(t),l=0,h=s.activityType.CallMissed,p;return o||u?h=s.activityType.CallStarted:i?(l=parseInt(i[1],10),h=s.activityType.CallEnded):f&&e.isMyself&&(h=s.activityType.CallEnded),p=new a.CallingActivityItem,p.duration._set(l),p.isRead._set(!1),p.type._set(h),p.direction._set(e.isMyself?s.direction.Outgoing:s.direction.Incoming),p}}}),define("jSkype/utils/chat/generator",["require","exports","module","lodash-compat","jSkype/client","jSkype/settings","constants/common","jSkype/models/conversationActivityItem","utils/chat/dateTime","swx-enums","swx-i18n","jSkype/utils/chat/mentionsParser","jSkype/utils/chat/messageTypes","jSkype/utils/chat/parser","jSkype/utils/chat/message","jSkype/modelHelpers/personHelper","jSkype/modelHelpers/personsAndGroupsHelper","utils/chat/pesUtils"],function(e,t){function N(e,n){var r=""+(e.originalContent||e.content);e.content=t.processMentions(e.content),t.extendRawMessage(e,n);var i=c.fetch(e.messagetype),s=c.parse(i,e);return s._id=e.id,s._actualId=e.id,s.key._set(e.key||e.clientmessageid),s.timestamp._set(new Date(e.originalarrivaltime)),s.isRead._set(p.canMessageBeMarkedAsUnreadInUI(e)?!e.isUnread:!0),s.status._set(a.activityStatus.Succeeded),s._originalContent=r,s}function C(e,t){return k(e)?A(e,t):L(e)}function k(e){var t=i.isFeatureOn(s.featureFlags.INVITE_FREE_IMPLICIT_INCOMING_CONTACT_REQUEST);return t&&(e.contactRequestType===a.activityType.ContactRequestIncoming||e.contactRequestType===a.activityType.ContactRequestIncomingInviteFree)}function L(e){var t=new g;return t.sender=v.getPerson(e.personId),t._id=e.id,t._actualId=e.id,t.key._set(e.id),t.type._set(e.contactRequestType),t.timestamp._set(new Date(e.timestamp)),t.greeting._set(e.greeting),t.isRead._set(e.isOutgoing),t}function A(e,t){if(e.contactRequestType===a.activityType.ContactRequestIncoming)return O(e,t);if(e.contactRequestType===a.activityType.ContactRequestIncomingInviteFree)return L(e)}function O(e,t){var n,i=v.getPerson(e.personId),s=r.get().personsAndGroupsManager.mePerson,o=new T(t);return n=f.fetch({key:"message_text_contactRequestGreeting",params:{displayName:s.displayName()}}),o._id=e.id,o._actualId=e.id,o.key._set(e.id),o.sender=i,o.timestamp._set(new Date(e.timestamp)),o.html._set(e.greeting||n),o.type._set(a.activityType.TextMessage),o.isRead._set(!1),o}function M(e){var t=new S;return t.type._set(e.pluginFreeMessageType),t.timestamp._set(e.timestamp),t.key._set(e.id),t}function _(e){var t=new x;return t.type._set(e.pstnEventType),t.timestamp._set(e.timestamp),t.key._set(e.id),t.isGroup._set(e.isGroup),t.participantName._set(e.participantName),t.participantEndpoint._set(e.participantEndpoint),t}function D(e){var t=/href="((?:https?:\/\/|mailto:)[^"]+)"/gi,n=e.match(t)||[];return n.forEach(function(t){e=e.replace(t,t.replace("&amp;","&"))}),e}var n=e("lodash-compat"),r=e("jSkype/client"),i=e("jSkype/settings"),s=e("constants/common"),o=e("jSkype/models/conversationActivityItem"),u=e("utils/chat/dateTime"),a=e("swx-enums"),f=e("swx-i18n").localization,l=e("jSkype/utils/chat/mentionsParser"),c=e("jSkype/utils/chat/messageTypes"),h=e("jSkype/utils/chat/parser"),p=e("jSkype/utils/chat/message"),d=e("jSkype/modelHelpers/personHelper"),v=e("jSkype/modelHelpers/personsAndGroupsHelper"),m=e("utils/chat/pesUtils"),g=o.ContactRequestActivityItem,y=o.MojiMessageActivityItem,b=o.PictureMessageActivityItem,w=o.FileTransferActivityItem,E=o.ContactInfoMessageActivityItem,S=o.PluginFreeActivityItem,x=o.PstnActivityItem,T=o.TextMessageActivityItem;t.activityFromRawMessage=function(e,t){return e.contactRequestType?C(e,t):e.pstnEventType?_(e):e.pluginFreeMessageType?M(e):N(e,t)},t.messageForService=function(e){var t={content:e.content,messagetype:e.messagetype,properties:e.properties,contenttype:"text"};return e.skypeeditedid?t.skypeeditedid=String(e.skypeeditedid):t.clientmessageid=String(e.key),t},t.outgoingTextMessageActivityItem=function(e,t){e.messagetype="RichText",e.content=D(e.content);var n=c.fetch(e.messagetype),i=r.get().personsAndGroupsManager.mePerson,s=new Date,o;return e.isMyself=!0,e.conversationModel=t,e.author=d.getKey(i.id(),i._type()),o=c.parse(n,e),o._id=s.getTime(),o._actualId=o._id,o.key._set(String(s.getTime())),o.timestamp._set(s),o._htmlSetEnabled(!0),o.isRead._set(!0),o.status._set(a.activityStatus.Pending),o._originalContent=""+(e.originalContent||e.content),o},t.outgoingPollMessageActivityItem=function(e){var t=c.fetch(e.messagetype),n=c.parse(t,e);return n._id=e.timestamp,n._actualId=e.timestamp,n.isRead._set(!0),n._htmlSetEnabled(!0),n.sender=r.get().personsAndGroupsManager.mePerson,n.direction._set(a.direction.Outgoing),n.status._set(a.activityStatus.Pending),n.key._set(e.key),n.timestamp._set(new Date(e.timestamp)),n},t.outgoingMojiActivityItem=function(e,t,n){var o=new y(n.conversationModel),u="en",f,l;return i.isFeatureOn(s.featureFlags.PES_CDN_AUTH_ENABLED)&&(e=m.rewriteUrls(e,i.settings.pesCDNAuthentication.rewriteRules)),f=e+"/"+t+"/views/default",l=e+"/"+t+"/views/thumbnail",i.settings.locale&&i.settings.locale.pes&&(u=i.settings.locale.pes),o._id=n.timestamp,o._actualId=o._id,o._htmlSetEnabled(!0),o._metaDataUri=e+"/views/meta."+u,o.direction._set(a.direction.Outgoing),o.type._set(a.activityType.MojiMessage),o.sender=r.get().personsAndGroupsManager.mePerson,o.thumbnailUrl._set(l),o.mojiUrl._set(f),o.key._set(n.key),o.timestamp._set(new Date(n.timestamp)),o.isRead._set(!0),o.status._set(a.activityStatus.Pending),o.html._set(n.content),o},t.processMentions=function(e){var t,r,i=l.getMentions(e);return i.forEach(function(i){t=i.substring(1).toLowerCase(),r=l.getMentionUserData(t),r.defaultUserName&&(e=e.replace(i,'<at id="'+t+'">'+n.escape(r.defaultUserName)+"</at>"))}),e},t.outgoingContactInfoActivityItem=function(e,t){var n=new E(t),i=u.getDate();return n._htmlSetEnabled(!0),n.sender=r.get().personsAndGroupsManager.mePerson,n.direction._set(a.direction.Outgoing),n.status._set(a.activityStatus.Pending),n.key._set(String(i.getTime())),n.contacts(e),n.timestamp._set(i),n},t.outgoingPictureActivityItem=function(e){var t=new b(e);return t._htmlSetEnabled(!0),t.sender=r.get().personsAndGroupsManager.mePerson,t.direction._set(a.direction.Outgoing),t.status._set(a.activityStatus.Pending),t.key._set(String((new Date).getTime())),t.timestamp._set(u.getDate()),t},t.outgoingFileActivityItem=function(e,t){function i(e){if(!e)return"unknown";var t=e.split(".");return t.length<2?"unknown":t.pop().toLowerCase()}var n=new w(t);return n._htmlSetEnabled(!0),n.fileName=e.name,n.fileType=i(e.name),n.sender=r.get().personsAndGroupsManager.mePerson,n.direction._set(a.direction.Outgoing),n.status._set(a.activityStatus.Pending),n.key._set(String((new Date).getTime())),n.fileSize=e.size?e.size:0,n.timestamp._set(u.getDate()),n},t.extendRawMessage=function(e,t){var n=r.get().personsAndGroupsManager.mePerson;e.myself=d.getKey(n.id(),n._type()),e.author=h.parseName(e.from),e.isMyself=e.author===e.myself,e.originalContent||(e.originalContent=""+e.content),e.conversationModel=t}}),define("jSkype/services/systemCommands/commandsHelper",["require","exports","module","swx-enums","jSkype/utils/chat/generator","utils/chat/messageSanitizer"],function(e,t){var n=e("swx-enums"),r=e("jSkype/utils/chat/generator"),i=e("utils/chat/messageSanitizer");t.sendSystemMessage=function(e,t){var s=i.processOutgoingTextMessage(t),o=r.outgoingTextMessageActivityItem({content:s},e);o.status._set(n.activityStatus.Succeeded),o.type._set(n.activityType.SystemMessage),e.historyService._addOutgoingMessage(o)},t.availableAlways=function(){return!0},t.availableNever=function(){return!1},t.availableForOneToOne=function(e){return!e.isGroupConversation()},t.availableForAllGroupMembers=function(e){return e.isGroupConversation()},t.availableForNonAnonymousGroupMembers=function(e){return e.isGroupConversation()&&!e.selfParticipant.isAnonymous()},t.availableForGroupLeaders=function(e){return e.isGroupConversation()&&e.selfParticipant.role()===n.participantRole.Leader}}),define("jSkype/services/systemCommands/commands/topic",["require","exports","module","jSkype/services/systemCommands/commandsHelper","lodash-compat"],function(e,t){function i(){this.isAvailableFor=n.availableForAllGroupMembers,this.help="[text]",this.showInHelp=!0,this.action=function(e,t){if(r.isEmpty(r.trim(t)))return;e.topic.set.enabled()&&e.topic.set(t).catch(function(e){})}}var n=e("jSkype/services/systemCommands/commandsHelper"),r=e("lodash-compat");t.build=function(){return new i}}),define("utils/calling/callingStack",["require","exports","module","browser/detect","constants/common"],function(e,t){function o(){function t(){var e=n.getBrowserInfo(),t=n.getSystemInfo();return e.browserName===n.BROWSERS.FIREFOX&&s.featureFlags[r.featureFlags.PLUGINLESS_CALLING_FIREFOX]?!0:e.browserName===n.BROWSERS.CHROME&&s.featureFlags[r.featureFlags.PLUGINLESS_CALLING_CHROME]?!0:e.browserName===n.BROWSERS.EDGE&&s.featureFlags[r.featureFlags.PLUGINLESS_CALLING_EDGE]&&s.pluginless.allowedEdgeVersion.lowerBound<=e.browserMajorVersion&&s.pluginless.allowedEdgeVersion.upperBound>=e.browserMajorVersion?!0:e.browserName===n.BROWSERS.ELECTRON&&s.featureFlags[r.featureFlags.PLUGINLESS_CALLING_ELECTRON]?!0:t.osName===n.OPERATING_SYSTEMS.LINUX&&e.browserName===n.BROWSERS.CHROME&&s.featureFlags[r.featureFlags.PLUGINLESS_CALLING_CHROME_LINUX]?!0:!1}function i(){var e=n.getBrowserInfo();return s.featureFlags[r.featureFlags.NG_CALLING]?e.isPluginlessCallingSupported&&t():!1}var e=this;e.isPluginlessEnabledInCurrentBrowser=t,e.isPluginlessCallingSupported=i,e.isInBrowserPluginSupported=function(){return n.getBrowserInfo().isInBrowserPluginSupported},e.isInBrowserCallingSupported=function(){return n.getBrowserInfo().isInBrowserPluginSupported||i()},e.isOutofBrowserCallingSupported=function(){return!n.getBrowserInfo().isInBrowserPluginSupported&&!i()}}var n=e("browser/detect"),r=e("constants/common"),i,s;t.init=function(e){s=e},t.get=function(){if(!s)throw new Error("No settings found for calling stack!");return i=i||new o,i}}),define("ui/modelHelpers/personHelper",["require","exports","module","lodash-compat","cafe/applicationInstance","constants/people"],function(e,t){function o(e){return typeof e.isAgent=="function"}function u(e){return!!e._authorization&&typeof e._authorization=="function"}function a(e){if(n.isString(e))return e.replace(s,"")}var n=e("lodash-compat"),r=e("cafe/applicationInstance"),i=e("constants/people"),s=/^(?:(\d+):)+/;t.isMePersonId=function(e){var t=r.get().personsAndGroupsManager.mePerson,n=a(e);return t.id()===n||t._msaId&&a(t._msaId())===n},t.isMePerson=function(e){return t.isMePersonId(e.id())},t.isGuestId=function(e){return/^guest:/.test(e)},t.isGuest=function(e){return t.isGuestId(e.id())},t.isTechnicalAccount=function(e){return/^live:/.test(e.id())},t.isEchoContact=function(e){return t.isEchoContactId(e.id())},t.isEchoContactId=function(e){return e===i.ECHO_CONTACT_ID},t.isAgent=function(e){return o(e)&&e.isAgent()},t.isAuthorizedContact=function(e){return u(e)?e._authorization()===i.authorizationStates.AUTHORIZED:!0},t.isSuggestedContact=function(e){return u(e)&&e._authorization()===i.authorizationStates.SUGGESTED},t.isPstn=function(e){return!!e.phoneNumbers.size()&&e.id()===e.phoneNumbers(0).telUri()},t.hasPhoneNumbers=function(e){return!!e.phoneNumbers.size()},t.isKnownPerson=function(e){return!!e&&r.get().personsAndGroupsManager.all.persons().filter(function(t){return t.id()===e.id()}).length===1},t.getId=a}),define("ui/viewModels/calling/helpers/conversationTracker",["require","exports","module","lodash-compat"],function(e,t){var n=e("lodash-compat"),r;t.init=function(){r=[]},t.addP2PConversation=function(t){r.push(t)},t.isP2PConversation=function(t){return n.some(r,function(e){return e===t})}}),define("ui/modelHelpers/conversationHelper",["require","exports","module","swx-enums","cafe/applicationInstance","browser/detect","utils/calling/callingStack","swx-i18n","ui/modelHelpers/personHelper","lodash-compat","ui/viewModels/calling/helpers/conversationTracker"],function(e,t){function l(e){return e.selfParticipant.audio.state()!==n.callConnectionState.Disconnected&&e.selfParticipant.audio.state()!==n.callConnectionState.Notified}function c(e){return r.get().conversationsManager.getConversation(e)}function h(e){var n=r.get().conversationsManager.createConversation();return t.addPersonsToConversation(e,n),n}function p(e){if(e&&!e.isGroupConversation()&&e.participants.size()>0)return e.participants()[0].person}var n=e("swx-enums"),r=e("cafe/applicationInstance"),i=e("browser/detect"),s=e("utils/calling/callingStack"),o=e("swx-i18n").localization,u=e("ui/modelHelpers/personHelper"),a=e("lodash-compat"),f=e("ui/viewModels/calling/helpers/conversationTracker");t.createConversation=function(e,t){return e.length>1||t?h(e):c(e[0])},t.createSpaceTopic=function(){return o.fetch({key:"spaces_default_name"})},t.isCallingActive=function(e){return l(e)?s.get().isOutofBrowserCallingSupported()?!1:i.getBrowserInfo().isShellApp?!0:f.isP2PConversation(e)?!1:e.selfParticipant.audio.state.reason===n.callDisconnectionReason.OutOfBrowserCall?!1:s.get().isPluginlessCallingSupported()&&e.selfParticipant.audio.state.reason===n.callDisconnectionReason.CallEscalated?!1:e.autoCall&&e.autoCall()?!0:!0:!1},t.addPersonsToConversation=function(e,t){return Promise.all(a.map(e,function(e){var n=t.createParticipant(e);return t.participants.add(n)}))},t.isOneToOneConversationWithEcho=function(e){var t=p(e);return!!t&&u.isEchoContact(t)},t.isOneToOneConversationWithAgent=function(e){var t=p(e);return!!t&&u.isAgent(t)},t.isOneToOneConversationWithBlockedPerson=function(e){var t=p(e);return!!t&&t.isBlocked()},t.agentSupportsIm=function(e){var n;return t.isOneToOneConversationWithAgent(e)?(n=e.participants()[0],!!n.person.capabilities.chat()):!1},t.getExistingConversationWithPerson=function(e){var t=r.get().conversationsManager.conversations();return a.find(t,function(t){return!t.isGroupConversation()&&t.participants.size()===1&&t.participants()[0].person.id()===e.id()})},t.isPstnEndpoint=function(e){return/^(\+)?\d+$/.test(e)},t.isPstnOnlyConversation=function(e){var n=e.participants.subscribe();if(!e.participants.size())return n.dispose(),!1;for(var r=0;r<e.participants.size();r++){var i=e.participants(r);if(!i.audio.endpoint||!t.isPstnEndpoint(i.audio.endpoint()))return n.dispose(),!1}return n.dispose(),!0},t.isConversationWithPstn=function(e){return e.participants().some(function(e){return e.audio.endpoint&&t.isPstnEndpoint(e.audio.endpoint())})},t.isAtLeastOnceParticipantOnline=function(e){return e.participants().some(function(e){var t=e.person.status();return t!==n.onlineStatus.Offline||t!==n.onlineStatus.Unknown})}}),define("jSkype/services/systemCommands/commands/add",["require","exports","module","jSkype/services/systemCommands/commandsHelper","jSkype/modelHelpers/personsAndGroupsHelper","ui/modelHelpers/conversationHelper","services/pubSub/pubSub","constants/common"],function(e,t){function u(e){var t=i.createConversation(e,!0);s.publish(o.events.navigation.OPEN_CONVERSATION,{model:t,origin:o.telemetry.historyLoadOrigin.CONVERSATION_TO_THREAD})}function a(){this.isAvailableFor=function(e){return n.availableForOneToOne(e)||n.availableForNonAnonymousGroupMembers(e)},this.help="[skypename]",this.showInHelp=!0,this.action=function(e,t){var n=r.getPersonById(t),i,s;if(!n)return;e.isGroupConversation()?e.participants.add.enabled()&&(i=e.createParticipant(n),e.participants.add(i).catch(function(e){})):(s=[n,e.participants(0).person],u(s))}}var n=e("jSkype/services/systemCommands/commandsHelper"),r=e("jSkype/modelHelpers/personsAndGroupsHelper"),i=e("ui/modelHelpers/conversationHelper"),s=e("services/pubSub/pubSub"),o=e("constants/common");t.build=function(){return new a}}),define("utils/common/logTracer/helpers",["require","exports","module"],function(e,t){function n(e){var t;try{e instanceof Error?t=e.toString():t=JSON.stringify(e)}catch(n){t="!!!LOG TRACER ERROR!!!Unable to parse argument!!!"}return t}t.getFormattedMessage=function(e){var t="",r=!1,i=function(e){return i=function(e){return r||e?(r=e,"\n"):" "},r=e,""};for(var s=1;s<e.length;s++){var o=e[s];if(typeof o=="string"||typeof o=="undefined")t+=i(!1)+o;else{var u=n(o);t+=i(u.length>200)+u}}return t},t.getTimeOfDayString=function(){var e=new Date,t=e.getHours();t=(t<10?"0":"")+t;var n=e.getMinutes();n=(n<10?"0":"")+n;var r=e.getSeconds();return r=(r<10?"0":"")+r,t+":"+n+":"+r+":"+e.getMilliseconds()}}),define("utils/common/logTracer/bufferingWriter",["require","exports","module","utils/common/logTracer/helpers"],function(e,t){function r(e,t,r){function i(i,s,o){var u=(new Date).toUTCString(),a=o[0],f=n.getFormattedMessage(o),l="["+u+"]["+s+"]["+a+"]"+" "+f;if(e)try{e[i]("["+u+"]",a+" -> "+f)}catch(c){}t.addMessage(l),"error"===s&&r.addMessage(l)}this.log=function(){return i("log","log",arguments)},this.info=function(){return i("info","info",arguments)},this.warn=function(){return i("warn","warn",arguments)},this.error=function(){return i("error","error",arguments)},this.debug=function(){return i("log","debug",arguments)}}var n=e("utils/common/logTracer/helpers");t.build=function(e,t,n){return new r(e,t,n)}}),define("utils/common/logTracer/consoleWriter",["require","exports","module","utils/common/logTracer/helpers"],function(e,t){function r(){var e=this;["error","warn","info","log"].forEach(function(t){Object.defineProperty(e,t,{get:function(){return console[t].bind(console,n.getTimeOfDayString())}})}),this.debug=function(){function e(e,t,n){var r=e.length,i=0,s=e.indexOf("\n",i);do{var o=Math.min(r,i+t);for(var u=o;s>=i&&s<u;o=s+1,s=e.indexOf("\n",s+1));n(e.substring(i,o)),i=o}while(i<r)}function u(e,n){var i=typeof e=="string",s=i?e.length:0,o=r-n,u=i&&e.indexOf("\n")!==-1;return t.accumulatedLength+=s,t.accumulatedLength>o||u?(t.accumulatedLength=0,!0):!1}var t={accumulatedLength:0},r=1024,i=[n.getTimeOfDayString(),arguments[0]],s=i.reduce(function(e,t){return e+t.length+2},0),o=arguments.length;for(var a=1;a<arguments.length;a++)if(u(arguments[a]),s){o=a;break}console.log.apply(console,i.concat(Array.prototype.slice.call(arguments,1,o)));var f=o;for(a=f;a<arguments.length;a++){var l=u(arguments[a],0);a>f&&(l||a===arguments.length-1)&&console.log.apply(console,Array.prototype.slice.call(arguments,f,a)),l&&(e(arguments[a],r,console.log.bind(console)),f=a+1)}}}var n=e("utils/common/logTracer/helpers");t.build=function(){return new r}}),define("utils/common/logTracer/telemetryWriter",["require","exports","module","lodash-compat","utils/common/logTracer/helpers"],function(e,t){function i(e,t){var i=this;["log","info","warn","debug"].forEach(function(t){i[t]=e?e[t]:n.noop}),this.error=function(){e&&e.error.apply(this,arguments);var n=r.getFormattedMessage(arguments),i=arguments[0],s=typeof arguments[1]!="undefined"?arguments[1]:"",o={namespace:i,message:n,shortMessage:s,level:"error"};t.send(o)}}var n=e("lodash-compat"),r=e("utils/common/logTracer/helpers");t.build=function(e,t){return new i(e,t)}}),define("utils/common/logTracer/messageBuffer",["require","exports","module"],function(e,t){function n(){var e=[],t=0;this.addMessage=function(n){t+=n.length,e.push(n)},this.toString=function(){return e.join("\n")},this.clear=function(){e=[]}}t.build=function(){return new n}}),define("utils/common/logTracer/nullLogger",["require","exports","module","lodash-compat"],function(e,t){function r(){this.log=n.noop,this.info=n.noop,this.warn=n.noop,this.error=n.noop,this.debug=n.noop,this.createChild=function(){return this}}var n=e("lodash-compat");t.build=function(){return new r}}),define("utils/common/logTracer/decoratingLogger",["require","exports","module","lodash-compat"],function(e,t){function r(e,t,i){var s=this;["error","warn","info","log"].forEach(function(n){Object.defineProperty(s,n,{get:function(){return e[n].bind(e,t())}})}),i?["debug"].forEach(function(n){Object.defineProperty(s,n,{get:function(){return e[n].bind(e,t())}})}):s.debug=n.noop,s.createChild=function(n,s){var o=typeof n=="function"?function(){return t()+"::"+n()}:function(){return t()+"::"+n};return typeof s=="undefined"&&(s=i),new r(e,o,s)}}var n=e("lodash-compat");t.build=function(e,t,n){return new r(e,t,n)}}),define("utils/common/logTracer/telemetryReporter",["require","exports","module","lodash-compat"],function(e,t){function r(){var e=this;e.send=n.noop,e.update=function(t){var r=t.reporting.telemetryManager,i=t.reporting.telemetryToken,s=t.reporting.throttleInterval;r&&i?e.send=n.throttle(function(e){r.sendEvent(i,"logging",e)},s,{trailing:!1}):e.send=n.noop}}var n=e("lodash-compat");t.build=function(){return new r}}),define("utils/common/logTracer/api",["require","exports","module","lodash-compat","utils/common/logTracer/bufferingWriter","utils/common/logTracer/consoleWriter","utils/common/logTracer/telemetryWriter","utils/common/logTracer/messageBuffer","utils/common/logTracer/messageBuffer","utils/common/logTracer/nullLogger","utils/common/logTracer/decoratingLogger","utils/common/logTracer/telemetryReporter"],function(e,t){function p(){h&&(window.removeEventListener("error",d),h=null),c.logUnhandled&&(h=t.getLogger("Unhandled Exceptions"),window.addEventListener("error",d))}function d(e){try{h.error(JSON.stringify(e.error,["message","arguments","type","name","stack"]))}catch(t){h.error("Error: "+e)}}var n=e("lodash-compat"),r=e("utils/common/logTracer/bufferingWriter"),i=e("utils/common/logTracer/consoleWriter"),s=e("utils/common/logTracer/telemetryWriter"),o=e("utils/common/logTracer/messageBuffer").build(),u=e("utils/common/logTracer/messageBuffer").build(),a=e("utils/common/logTracer/nullLogger").build(),f=e("utils/common/logTracer/decoratingLogger"),l=e("utils/common/logTracer/telemetryReporter").build(),c,h;t.getLogs=function(){return{all:o.toString(),error:u.toString()}},t.clearLogs=function(){o.clear(),u.clear()},t.getLogger=function(e,t){var n,h=function(){var n,h=function(){return e};if(c.logToBuffer){var p=c.logToConsole?console:null;n=r.build(p,o,u)}else c.logToConsole&&(n=i.build());return c.reporting.enabled&&(n=s.build(n,l)),n?f.build(n,h,t):a},p=function(e){return function(){return n||(n=h()),n[e]}};return Object.create(Object.prototype,{log:{get:p("log")},info:{get:p("info")},warn:{get:p("warn")},error:{get:p("error")},debug:{get:p("debug")},createChild:{get:p("createChild")}})},t.configure=function(e){c={logToConsole:!1,logToBuffer:!1,logUnhandled:!1,reporting:{enabled:!1,throttleInterval:1e4,telemetryManager:null,telemetryToken:null}},n.merge(c,e),l.update(c),p()},t.configure()}),define("jSkype/telemetry/logging/callingLogTracer",["require","exports","module","utils/common/logTracer/api"],function(e,t){var n=e("utils/common/logTracer/api");t.get=function(){return n.getLogger("Calling")}}),define("jSkype/modelHelpers/participantHelper",["require","exports","module","swx-enums","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/telemetry/logging/callingLogTracer","jSkype/client"],function(e,t){var n=e("swx-enums"),r=e("jSkype/modelHelpers/personsAndGroupsHelper"),i=e("jSkype/telemetry/logging/callingLogTracer").get(),s=e("jSkype/client");t.updateParticipantAudioVideoState=function(e,t,n){if(!t){i.warn("Trying to update to undefined state!, ignoring");return}i.log("Updating participant",e.person.id()," state to:",t,", from:",e.audio.state(),"reason: ",n),e.audio.state._set(t,n),e.video.state._set(t,n)},t.updateParticipantsAudioVideoState=function(e,n,r){e.participants().forEach(function(e){t.updateParticipantAudioVideoState(e,n,r)})},t.handleParticipantRingingStateTransition=function(e,r){e.audio.state()===n.callConnectionState.Disconnected&&t.updateParticipantAudioVideoState(e,n.callConnectionState.Connecting),e.audio.state()===n.callConnectionState.Connecting&&!r._callData.isCurrentCallIncoming()&&t.updateParticipantAudioVideoState(e,n.callConnectionState.Ringing)},t.handleParticipantJoiningStateTransition=function(e,r){t.handleParticipantRingingStateTransition(e,r),t.updateParticipantAudioVideoState(e,n.callConnectionState.Connected)},t.handleRemoteParticipantsLeavingStateTransition=function(e,n){e.forEach(function(e){t.handleParticipantLeavingStateTransition(e,n)})},t.handleParticipantLeavingStateTransition=function(e,r){r=r||n.callDisconnectionReason.Terminated,e.audio.state()===n.callConnectionState.Disconnected?t.updateParticipantAudioVideoState(e,n.callConnectionState.Disconnected,r):(e.audio.state()!==n.callConnectionState.Disconnecting&&t.updateParticipantAudioVideoState(e,n.callConnectionState.Disconnecting,r),t.updateParticipantAudioVideoState(e,n.callConnectionState.Disconnected,r))},t.getOrCreateParticipantInConversation=function(e,n){var i;e.selfParticipant.person.id()===n?i=e.selfParticipant:i=t.getParticipantFromConversation(e,n);if(!i){var s=r.getPerson(n);e._addParticipant(s),i=t.getParticipantFromConversation(e,n)}return i},t.getParticipantFromConversation=function(e,t){return e.participants.filter(function(e){return e.person.id()===t})(0)},t.isMeParticipant=function(e){return s.get().personsAndGroupsManager.mePerson.id()===e.person.id()}}),define("jSkype/services/systemCommands/commands/kick",["require","exports","module","jSkype/services/systemCommands/commandsHelper","jSkype/modelHelpers/participantHelper"],function(e,t){function i(){this.isAvailableFor=n.availableForGroupLeaders,this.help="[skypename]",this.showInHelp=!0,this.action=function(e,t){t[0]==="@"&&(t=t.substring(1));var n=r.getParticipantFromConversation(e,t);if(!n)return;e.participants.remove.enabled()&&e.participants.remove(n).catch(function(e){})}}var n=e("jSkype/services/systemCommands/commandsHelper"),r=e("jSkype/modelHelpers/participantHelper");t.build=function(){return new i}}),define("jSkype/services/systemCommands/commands/leave",["require","exports","module","jSkype/services/systemCommands/commandsHelper"],function(e,t){function r(){this.isAvailableFor=n.availableForAllGroupMembers,this.showInHelp=!0,this.action=function(e){e.leave.enabled()&&e.leave().catch(function(e){})}}var n=e("jSkype/services/systemCommands/commandsHelper");t.build=function(){return new r}}),define("jSkype/services/callRegister",["require","jcafe-property-model","jSkype/telemetry/logging/callingLogTracer","jSkype/modelHelpers/propertyModelHelper"],function(e){function s(){function u(e){return e.convoCallId||null}function a(e){return Boolean(u(e))}var e=this,i={},s={},o=1;e.canPlaceCall=t.property({readOnly:!0,value:!0}),e.canProcessIncomingCall=function(t){return e.activeCalls(t)?!0:e.activeCalls.size()===0?!0:!1},e.wasCallEnded=function(e){return Boolean(s[u(e)])},e.registerCall=function(r){n.log("[CallRegister] Register call",r.conversationId),e.activeCalls._add(r,r.conversationId)},e.unregisterCall=function(r,i){s.hasOwnProperty(i)&&(s[i]=!0),n.log("[CallRegister] Unregister call",r.conversationId),e.activeCalls._remove(r.conversationId)},e.activeCalls=r.exposeReadOnlyCollection(t.collection()),e.activeCalls.size.changed(function(){e.canPlaceCall._set(e.activeCalls.size()<o)}),e.getConversationByCallId=function(t){if(i.hasOwnProperty(t))return i[t]},e.registerCallIdMapping=function(e,t){if(a(t)){var r=u(t);return i[r]=e,s.hasOwnProperty(r)||(s[r]=!1),n.log("[CallRegister] New Call Id Registered:",r),!0}return n.log("[CallRegister] Call Id is missing"),!1}}var t=e("jcafe-property-model"),n=e("jSkype/telemetry/logging/callingLogTracer").get(),r=e("jSkype/modelHelpers/propertyModelHelper"),i;return{get:function(){return i=i||new s,i}}}),define("jSkype/services/systemCommands/commands/callInfo",["require","exports","module","jSkype/services/systemCommands/commandsHelper","jSkype/telemetry/logging/callingLogTracer","jSkype/services/callRegister","jSkype/settings","constants/common"],function(e,t){function u(){this.isAvailableFor=function(e){return s.isFeatureOn(o.featureFlags.CALL_INFO_COMMAND)&&e===i.get().activeCalls()[0]},this.showInHelp=!0,this.action=function(e){function t(t){n.sendSystemMessage(e,t)}function i(e){r.log("/callInfo command failed: "+e)}e._callHandler?e._callHandler.requestCallInfo().then(t).catch(i):i("no call handler exists")}}var n=e("jSkype/services/systemCommands/commandsHelper"),r=e("jSkype/telemetry/logging/callingLogTracer").get(),i=e("jSkype/services/callRegister"),s=e("jSkype/settings"),o=e("constants/common");t.build=function(){return new u}}),define("jSkype/services/systemCommands/commands/moji",["require","exports","module","jSkype/services/systemCommands/commandsHelper","lodash-compat"],function(e,t){function i(){this.isAvailableFor=n.availableAlways,this.help="[mojiId]",this.showInHelp=!1,this.action=function(e,t){if(r.isEmpty(r.trim(t)))return;e.chatService._sendMoji.enabled()&&e.chatService._sendMoji(t).catch(function(e){})}}var n=e("jSkype/services/systemCommands/commandsHelper"),r=e("lodash-compat");t.build=function(){return new i}}),define("jSkype/telemetry/logging/issueReporter",["require","utils/common/logTracer/api","jSkype/services/serviceAccessLayer/requestDispatcher","lodash-compat","jSkype/settings"],function(e){function o(e){var t={dataType:"html"};return typeof e!="undefined"?r.merge(t,e):t}function u(e){var r=i.settings.telemetry.issueReportUrl,u,a;return n.put(r+"/session/unprocessed",o({headers:{"X-comment":e.message}})).then(function(e){var s=e.response.split("\n"),f=t.getLogs();return u=s[0],a=s[2],Promise.all([{name:"logs.log",content:f.all},{name:"errors.log",content:f.error},{name:"config.log",content:JSON.stringify(i)}].map(function(e){return n.put(r+"/upload/"+u+"/"+e.name,o({payload:e.content}))}))}).then(function(){return n.put(r+"/session/"+u+"/done",o())}).then(function(){return t.clearLogs(),{id:u,url:a}}).catch(function(e){throw s.error("failed to report issue: ",e),e})}var t=e("utils/common/logTracer/api"),n=e("jSkype/services/serviceAccessLayer/requestDispatcher"),r=e("lodash-compat"),i=e("jSkype/settings"),s=t.getLogger("issueReporter");return{report:u}}),define("jSkype/services/systemCommands/commands/reportIssue",["require","exports","module","jSkype/services/systemCommands/commandsHelper","jSkype/settings","constants/common","jSkype/telemetry/logging/issueReporter","lodash-compat"],function(e,t){function u(e,t){n.sendSystemMessage(e,"Thank you for reporting the issue. Your issue id is: "+t.id+". Logs have been uploaded to: "+t.url+". If you happened to encounter a calling issue when "+"using Edge browser, make sure to also run the following script to collect media stack logs: "+r.settings.telemetry.issueReportScript)}function a(e){n.sendSystemMessage(e,"Failed to report the issue.")}function f(){this.isAvailableFor=r.isFeatureOn(i.featureFlags.ISSUE_REPORTING)?n.availableAlways:n.availableNever,this.help="[text]",this.showInHelp=!0,this.action=function(e,t){o.isEmpty(o.trim(t))&&(t="No Message"),s.report({message:t}).then(u.bind(this,e),a.bind(this,e))}}var n=e("jSkype/services/systemCommands/commandsHelper"),r=e("jSkype/settings"),i=e("constants/common"),s=e("jSkype/telemetry/logging/issueReporter"),o=e("lodash-compat");t.build=function(){return new f}}),define("jSkype/services/systemCommands/commands/showMembers",["require","exports","module","jSkype/services/systemCommands/commandsHelper","swx-enums"],function(e,t){function i(){this.isAvailableFor=n.availableForAllGroupMembers,this.showInHelp=!0,this.action=function(e){var t="CONVERSATION MEMBERS:",i=e.participants().concat(e.selfParticipant);i.forEach(function(e){t+="\n  "+e.person.id()+" "+(e.role()===r.participantRole.Attendee?"SPEAKER":"ADMIN")}),n.sendSystemMessage(e,t)}}var n=e("jSkype/services/systemCommands/commandsHelper"),r=e("swx-enums");t.build=function(){return new i}}),define("jSkype/services/systemCommands/commands/swiftCard",["require","exports","module","jSkype/services/systemCommands/commandsHelper","jSkype/settings","constants/common","lodash-compat"],function(e,t){function o(){this.isAvailableFor=r.isFeatureOn(i.featureFlags.SWIFT_CARD_COMMAND)?n.availableAlways:n.availableNever,this.help="[swift card json]",this.showInHelp=!1,this.action=function(e,t){if(s.isEmpty(s.trim(t)))return;t=t.replace(/<a href[^>]+?>/gi,"").replace(/<\/a>/g,"");if(e.chatService._sendSwiftCard.enabled())try{e.chatService._sendSwiftCard('<SwiftCard Swift="'+encodeURIComponent(JSON.stringify(JSON.parse(t)))+'">Testing SwiftCard</SwiftCard>').catch(function(e){})}catch(r){n.sendSystemMessage(e,"There was error processing swift card json.")}}}var n=e("jSkype/services/systemCommands/commandsHelper"),r=e("jSkype/settings"),i=e("constants/common"),s=e("lodash-compat");t.build=function(){return new o}}),define("jSkype/services/systemCommands/commands/properties/admins",["require","exports","module","lodash-compat","jSkype/services/systemCommands/commandsHelper","swx-enums"],function(e,t){function s(){this.get={isAvailableFor:r.availableForAllGroupMembers,action:function(e){var t="admins=",s=n.filter(e.participants().concat(e.selfParticipant),function(e){return e.role()===i.participantRole.Leader});s.forEach(function(e){t+=e.person.id()+" "}),r.sendSystemMessage(e,t)}}}var n=e("lodash-compat"),r=e("jSkype/services/systemCommands/commandsHelper"),i=e("swx-enums");t.build=function(){return new s}}),define("jSkype/services/systemCommands/commands/properties/role",["require","exports","module","jSkype/services/systemCommands/commandsHelper","swx-enums"],function(e,t){function i(){this.get={isAvailableFor:n.availableForAllGroupMembers,action:function(e){n.sendSystemMessage(e,"role="+(e.selfParticipant.role()===r.participantRole.Attendee?"SPEAKER":"ADMIN"))}}}var n=e("jSkype/services/systemCommands/commandsHelper"),r=e("swx-enums");t.build=function(){return new i}}),define("jSkype/services/systemCommands/commands/properties/uri",["require","exports","module","jSkype/services/systemCommands/commandsHelper"],function(e,t){function r(){this.get={isAvailableFor:n.availableForAllGroupMembers,action:function(e){e.isJoiningEnabled()?n.sendSystemMessage(e,e.uri()):n.sendSystemMessage(e,"Link-based joining not enabled, to enable: /set options +JOINING_ENABLED")}}}var n=e("jSkype/services/systemCommands/commandsHelper");t.build=function(){return new r}}),define("jSkype/services/systemCommands/commands/properties/options/joiningEnabled",["require","exports","module"],function(e,t){function n(){this.isEnabled=function(t){return t.isJoiningEnabled()},this.enable=function(t){t.isJoiningEnabled.set(!0).catch(function(){})},this.disable=function(t){t.isJoiningEnabled.set(!1).catch(function(){})}}t.build=function(){return new n}}),define("jSkype/services/systemCommands/commands/properties/options/historyDisclosed",["require","exports","module"],function(e,t){function n(){this.isEnabled=function(t){return t.historyService.isHistoryDisclosed()},this.enable=function(t){t.historyService.isHistoryDisclosed.set(!0).catch(function(){})},this.disable=function(t){t.historyService.isHistoryDisclosed.set(!1).catch(function(){})}}t.build=function(){return new n}}),define("jSkype/services/systemCommands/commands/properties/options",["require","exports","module","jSkype/services/systemCommands/commands/properties/options/joiningEnabled","jSkype/services/systemCommands/commands/properties/options/historyDisclosed","lodash-compat","jSkype/services/systemCommands/commandsHelper"],function(e,t){function s(){var e={};r.forOwn(n,function(t,n){e[n.toUpperCase()]=t.build()}),this.get={isAvailableFor:i.availableForAllGroupMembers,action:function(t){var n="options=";r.forOwn(e,function(e,r){e.isEnabled(t)&&(n+=r+" ")}),i.sendSystemMessage(t,n)}},this.set={isAvailableFor:i.availableForAllGroupMembers,help:function(){return"[[+|-]flag]"},action:function(t,n){var r=n.slice(1).toUpperCase(),s=e[r],o=n[0]==="+";if(!s||!o&&n[0]!=="-"){i.sendSystemMessage(t,"Unknown flag.");return}o?s.enable(t):s.disable(t)}}}var n={JOINING_ENABLED:e("jSkype/services/systemCommands/commands/properties/options/joiningEnabled"),HISTORY_DISCLOSED:e("jSkype/services/systemCommands/commands/properties/options/historyDisclosed")},r=e("lodash-compat"),i=e("jSkype/services/systemCommands/commandsHelper");t.build=function(){return new s},t._setCommandBuilders=function(t){n=t}}),define("jSkype/services/systemCommands/commands/property",["require","exports","module","jSkype/services/systemCommands/commands/properties/admins","jSkype/services/systemCommands/commands/properties/role","jSkype/services/systemCommands/commands/properties/uri","jSkype/services/systemCommands/commands/properties/options","lodash-compat","jSkype/services/systemCommands/commandsHelper"],function(e,t){function s(e){var t={};r.forOwn(n,function(n,r){var i=n.build();i[e]&&(t[r.toLowerCase()]=i[e])}),this.commands=t}var n={admins:e("jSkype/services/systemCommands/commands/properties/admins"),role:e("jSkype/services/systemCommands/commands/properties/role"),uri:e("jSkype/services/systemCommands/commands/properties/uri"),options:e("jSkype/services/systemCommands/commands/properties/options")},r=e("lodash-compat"),i=e("jSkype/services/systemCommands/commandsHelper");s.prototype.isAvailableFor=function(t){return r(this.commands).values().any(function(e){return e&&e.isAvailableFor(t)})},s.prototype.help=function(t){var n=[];return r.forOwn(this.commands,function(e,r){e&&e.isAvailableFor(t)&&n.push({key:r,command:e})}),n.map(function(e){return e.key+(e.command.help?" "+e.command.help():"")})},s.prototype.showInHelp=!0,s.prototype.action=function(t,n){var r=n.match(/^(\w+)\s*(.+)?/),s=r&&r[1]&&r[1].toLowerCase(),o=r&&this.commands[s];if(!o||!o.isAvailableFor(t)){i.sendSystemMessage(t,"Unknown argument: '"+s+"'");return}o.action(t,r&&r[2])},t.get={build:function(){return new s("get")}},t.set={build:function(){return new s("set")}},t._setCommandBuilders=function(t){n=t}}),define("jSkype/services/systemCommands/commands/giphy",["require","exports","module","jSkype/services/systemCommands/commandsHelper","jSkype/settings","constants/common","reqwest"],function(e,t){function o(){this.isAvailableFor=r.isFeatureOn(i.featureFlags.GIPHY)?n.availableAlways:n.availableNever,this.help="[expression] - sends random GIF for given expression (optional)",this.showInHelp=!0,this.action=function(e,t){s.compat({method:"get",dataType:"json",url:"https://api.giphy.com/v1/gifs/random?api_key="+r.settings.giphy.apiKey+"&rating="+r.settings.giphy.rating+(t?"&tag="+t.replace(/\s+/g,"+"):""),crossOrigin:!0}).then(function(r){if(r&&r.data&&r.data.image_url){e.chatService.sendMessage(r.data.image_url,null,{activityData:JSON.stringify({giphyExpression:t})});return}n.sendSystemMessage(e,"No giphies found for *"+t+"*. Try different one.")},function(t){n.sendSystemMessage(e,"Failed to connect to giphy")})}}var n=e("jSkype/services/systemCommands/commandsHelper"),r=e("jSkype/settings"),i=e("constants/common"),s=e("reqwest");t.build=function(){return new o}}),define("jSkype/services/systemCommands/commands/alerts",["require","exports","module","jSkype/services/systemCommands/commandsHelper"],function(e,t){function r(){this.isAvailableFor=n.availableAlways,this.help="",this.showInHelp=!0,this.action=function(e){e.chatService._updateNotificationSettings(!1)}}function i(){this.isAvailableFor=n.availableAlways,this.help="[keywords]",this.showInHelp=!0,this.action=function(e,t){e.chatService._updateNotificationSettings(!0,t)}}function s(){this.on=new i,this.off=new r,this.isAvailableFor=n.availableAlways,this.help="off | on [keywords]",this.showInHelp=!0,this.action=function(e,t){function r(t){n.sendSystemMessage(e,"Unknown argument, use: /alerts "+t)}if(!t){r(this.help);return}var i=t.match(/^(\w+)\s*([\s\S]+)?/),s=i&&i[1].toLowerCase();s==="on"||s==="off"?this[s].action(e,i&&i[2]):r(this.help)}}var n=e("jSkype/services/systemCommands/commandsHelper");t.off={build:function(){return new r}},t.on={build:function(){return new i}},t.build=function(){return new s}}),define("jSkype/services/systemCommands/commands/setRole",["require","exports","module","lodash-compat","jSkype/services/systemCommands/commandsHelper","swx-enums"],function(e,t){function o(){this.isAvailableFor=r.availableForGroupLeaders,this.help="[Skype Name] ADMIN | USER",this.showInHelp=!0,this.action=function(e,t){var r=(t||"").split(/\s+/),o=r[0]&&r[0].toLowerCase(),u=r[1]&&r[1].toLowerCase();o[0]==="@"&&(o=o.substring(1));var a=n.find(e.participants(),function(e){return e.person.id().toLowerCase()===o});if(!a||!a.role.set.enabled()||!s.hasOwnProperty(u))return;a.role(s[u]?i.participantRole.Leader:i.participantRole.Attendee)}}var n=e("lodash-compat"),r=e("jSkype/services/systemCommands/commandsHelper"),i=e("swx-enums"),s={admin:!0,master:!0,user:!1,speaker:!1};t.build=function(){return new o}}),define("jSkype/services/systemCommands/commands/help",["require","exports","module","jSkype/services/systemCommands/commandsHelper","lodash-compat"],function(e,t){function i(){this.isAvailableFor=n.availableAlways,this.showInHelp=!0,this.action=function(e,t){var i="Available commands:\n";r.forIn(t,function(t,n){if(t.isAvailableFor(e)&&t.showInHelp)if(r.isFunction(t.help)){var s=t.help(e);s.forEach(function(e){i+="  /"+n+" "+e+"\n"})}else i+="  /"+n,i+=t.help?" "+t.help:"",i+="\n"}),n.sendSystemMessage(e,i)}}var n=e("jSkype/services/systemCommands/commandsHelper"),r=e("lodash-compat");t.build=function(){return new i}}),define("jSkype/services/systemCommands/main",["require","exports","module","jSkype/services/systemCommands/commands/topic","jSkype/services/systemCommands/commands/add","jSkype/services/systemCommands/commands/kick","jSkype/services/systemCommands/commands/leave","jSkype/services/systemCommands/commands/callInfo","jSkype/services/systemCommands/commands/moji","jSkype/services/systemCommands/commands/reportIssue","jSkype/services/systemCommands/commands/showMembers","jSkype/services/systemCommands/commands/swiftCard","jSkype/services/systemCommands/commands/callInfo","jSkype/services/systemCommands/commands/property","jSkype/services/systemCommands/commands/property","jSkype/services/systemCommands/commands/giphy","jSkype/services/systemCommands/commands/alerts","jSkype/services/systemCommands/commands/alerts","jSkype/services/systemCommands/commands/alerts","jSkype/services/systemCommands/commands/setRole","jSkype/services/systemCommands/commands/help","lodash-compat"],function(e,t){var n={},r;n.topic=e("jSkype/services/systemCommands/commands/topic"),n.add=e("jSkype/services/systemCommands/commands/add"),n.kick=e("jSkype/services/systemCommands/commands/kick"),n.leave=e("jSkype/services/systemCommands/commands/leave"),n.callInfo=e("jSkype/services/systemCommands/commands/callInfo"),n.moji=e("jSkype/services/systemCommands/commands/moji"),n.reportIssue=e("jSkype/services/systemCommands/commands/reportIssue"),n.showmembers=e("jSkype/services/systemCommands/commands/showMembers"),n.swiftCard=e("jSkype/services/systemCommands/commands/swiftCard"),n.callInfo=e("jSkype/services/systemCommands/commands/callInfo"),n.get=e("jSkype/services/systemCommands/commands/property").get,n.set=e("jSkype/services/systemCommands/commands/property").set,n.giphy=e("jSkype/services/systemCommands/commands/giphy"),n.alerts=e("jSkype/services/systemCommands/commands/alerts"),n.alertsoff=e("jSkype/services/systemCommands/commands/alerts").off,n.alertson=e("jSkype/services/systemCommands/commands/alerts").on,n.setrole=e("jSkype/services/systemCommands/commands/setRole"),n.help=e("jSkype/services/systemCommands/commands/help");var i=e("lodash-compat");t.SystemCommandsService=function(){function t(t,n){var r=t.match(/^[\\\/](\w+)\s*([\s\S]+)?/),i=r&&r[1]&&r[1].toLowerCase(),s=r&&e[i];return r&&s&&!s.isAvailableFor(n)&&(s=e.help),{command:s,data:r&&r[2]}}var e={};i.forOwn(n,function(t,n){e[n.toLowerCase()]=t.build()}),this.isSkypeCommand=function(n,r){return!!t(n,r).command},this.executeCommand=function(r,i){var s=t(r,i),o=s.command,u=s.data;return o?(o===e.help&&(u=e),o.action(i,u),!0):!1}},t.get=function(){return r=r||new t.SystemCommandsService,r}}),define("jSkype/models/chatService",["require","jSkype/client","swx-enums","jcafe-property-model","jSkype/utils/chat/generator","jSkype/settings","constants/common","jSkype/constants/people","utils/chat/messageSanitizer","jSkype/services/systemCommands/main","jSkype/modelHelpers/personHelper","lodash-compat"],function(e){function h(e,h){function g(t,s,o){function b(){var e=h.historyService._lastMessageFromServer,t;e&&e.timestamp()>p.timestamp()&&(t=e.timestamp().getTime()+100,p.timestamp._set(new Date(t)))}function w(){p.status._set(n.activityStatus.Succeeded),u.resolve()}function S(){p.status._set(n.activityStatus.Failed),u.reject()}var u=r.task(),f=o&&o.translation&&o.translation.users&&o.translation.users.length&&o.translation.users[0].value,l=f?t:a.processOutgoingTextMessage(t),c=i.processMentions(l),p=i.outgoingTextMessageActivityItem({content:c,originalContent:t},h),v=h.participants()[0],m,g;return f&&!a.isMessageWithMentionOnly(c)&&(o.translation.users[0].value=i.processMentions(o.translation.users[0].value),p._translationsArray.add(o.translation),m=y(o.translation)),g={key:p.key(),content:c,messagetype:s||"RichText",properties:m},b(),E(v,g)?(h.historyService._addOutgoingMessage(p),d.personsAndGroupsManager.all.persons.add(v.person,v.person.id(),undefined,n.activityType.ContactRequestIncoming).then(function(){e.sendMessage(h,g,p,w,S)},S)):e.sendMessage(h,g,p,w,S)&&h.historyService._addOutgoingMessage(p),u.promise}function y(e){var t={translations:JSON.stringify({key:e.key,mri:e.users[0].mri,value:a.escapeHTML(e.users[0].value)})};return t}function b(t){var n=r.task();return e.sendMojiMessage(h,t,n.resolve.bind(n),n.reject.bind(n)),n.promise}function w(t){var n=r.task(),s=i.outgoingTextMessageActivityItem({content:t},h);return e.sendMessage(h,{content:t,key:""+Date.now(),messagetype:"RichText"},s,n.resolve.bind(n),n.reject.bind(n)),n.promise}function E(e,t){function r(){return e&&e.person}function i(){return m.isSkypeCommand(t.content,h)}function a(){return e.person._authorization()===u.PENDING_INCOMING}var n=s.isFeatureOn(o.featureFlags.INVITE_FREE_IMPLICIT_INCOMING_CONTACT_REQUEST);return n&&!h.isGroupConversation()&&r()&&a()&&!i()}function S(){var t=r.task();return e.setIsTyping(h.conversationId,!0,t.resolve.bind(t),t.reject.bind(t)),t.promise}function x(){return r.task().resolve().promise}function T(e){if(!e||!e().length)return null;var t=d.personsAndGroupsManager.mePerson.id(),n=c.filter(e(),function(e){return e.users&&e.users[0]&&l.getId(e.users[0].mri)===t});return n.length?n[0]:null}var p=this,d=t.get(),v=r.collection(),m=f.get();v([n.messageFormat.Text,n.messageFormat.Html]),this._editMessage=function(t,n){var s=r.task(),o=t==="",u=o?null:T(n.translations),f=u?t:a.processOutgoingTextMessage(t),l={skypeeditedid:n.key(),key:n.key(),content:i.processMentions(f),messagetype:"RichText"};return u&&(u.users[0].value=i.processMentions(u.users[0].value),n._translationsArray.add(u),l.properties=y(u)),e.sendMessage(h,l,n,s.resolve.bind(s),s.reject.bind(s)),s.promise},this._notificationOn=!0,this._notificationKeywords=[],this._setNotificationSettings=function(e,t){p._notificationOn=!e||e.toLowerCase()!=="false",this._notificationKeywords=t?t.split(" ").filter(function(e){return e===0||e}):[],h._notificationsEnabled._set(p._notificationOn)},this._updateNotificationSettings=function(t,n){function r(e,t){p._setNotificationSettings(e.toString(),t)}e.setAlerts(h.conversationId,t,n,r)},this.shouldNotify=function(t){function n(e){var n=new RegExp("(?:\\s+|^)"+c.escapeRegExp(e),"i");return n.test(t)}return p._notificationOn||p._notificationKeywords.some(n)},this.supportedMessageFormats=v.asReadOnly(),this.sendMessage=r.command(g,h.activeModalities.chat),this._sendMoji=r.command(b,h.activeModalities.chat),this._sendSwiftCard=r.command(w,h.activeModalities.chat),this.sendIsTyping=r.command(S,h.activeModalities.chat),this.start=r.enabledCommand(x),this.accept=r.disabledCommand(),this.reject=r.disabledCommand(),this.stop=r.disabledCommand()}var t=e("jSkype/client"),n=e("swx-enums"),r=e("jcafe-property-model"),i=e("jSkype/utils/chat/generator"),s=e("jSkype/settings"),o=e("constants/common"),u=e("jSkype/constants/people").authorizationStates,a=e("utils/chat/messageSanitizer"),f=e("jSkype/services/systemCommands/main"),l=e("jSkype/modelHelpers/personHelper"),c=e("lodash-compat");return h}),define("jSkype/modelHelpers/calling/fallbackMessageHelper",["require","exports","module","swx-enums","utils/chat/dateTime"],function(e,t){function i(e,t){var n=s(t);e.historyService._processRawMessage(n)}function s(e){var t=r.getDate();return{id:+t,timestamp:t,isOutgoing:!0,pluginFreeMessageType:e}}var n=e("swx-enums").activityType,r=e("utils/chat/dateTime");t.sendWindowsUpdateFallbackMessage=function(e){i(e,n.PluginFreeFallbackWindowsUpdate)},t.sendScreenSharingFallbackMessage=function(e){i(e,n.PluginFreeFallbackScreenSharing)},t.sendMicrophoneAccessFallbackMessage=function(e){i(e,n.PluginFreeFallbackMicrophoneAccess)},t.sendOutgoingP2PCallFallbackMessage=function(e){i(e,n.PluginFreeFallbackOutgoingP2PCall)},t.sendIncomingP2PCallFallbackMessage=function(e){i(e,n.PluginFreeFallbackIncomingP2PCall)},t.sendNoVideoCapabilityMessage=function(e){i(e,n.PluginFreeNoVideoCapability)}}),define("utils/common/async",["require","browser/window","vendor/knockout"],function(e){function r(e){var t,n,i;return i=function(){return e},i.nextValue=new Promise(function(e,i){var s=!1;t=function(t){if(s)throw new Error("The nextValue for this observable is already settled");return s=!0,t=r(t),e(t.actual),t},n=function(e){if(s)throw new Error("The nextValue for this observable is already settled");s=!0,i(e)}}),{actual:i,future:{resolve:t,reject:n}}}function i(e,r,i){var s=r?e.bind(r):e;return i?n.tasks.schedule(s):t.setTimeout(s,0)}var t=e("browser/window"),n=e("vendor/knockout");return{execute:i,makeObservableValue:r}}),define("constants/plugin.const",[],function(){return{PERSISTENT_REQUIRED_VERSION:"7.2",NATIVE_ARGUMENTS_REQUIRED_VERSION:"7.6",LOGIN_STATUS:{LOGGED_OUT:"LoggedOut",LOGGED_IN:"LoggedIn",LOGGING_IN:"LoggingIn",LOGGING_OUT:"LoggingOut",INVALID_CREDENTIALS:"InvalidCredentials",IMPRINT_FAILURE:"ImprintFailure",LOGIN_FAILURE:"LoginFailure",LOGIN_SUCCESS:"LoginSuccess",UNKNOWN:"Unknown"},LOGIN_FAILURE_STOP_GAP:5,LOAD_RESULT:{LOAD_SUCCESSFUL:"LoadSuccessful",NO_INSTANCE_MANAGER:"NoInstanceManager",COMPONENT_NOT_FOUND:"ComponentNotFound",COMPONENT_LOAD_FAILED:"ComponentLoadFailed",COMPONENT_INIT_FAILED:"ComponentInitFailed",COMPONENT_LOAD_CANCELLED:"ComponentLoadCancelled"},VOICE_STATUS:{NOT_AVAILABLE:"NotAvailable",AVAILABLE:"Available",RINGING:"Ringing",JOINING:"Joining",LISTENING:"Listening",SPEAKING:"Speaking",ONHOLD:"OnHold",LEAVING:"Leaving",UNKNOWN:"Unknown"},VIDEO_STATUS:{NOT_AVAILABLE:"NotAvailable",AVAILABLE:"Available",STARTING:"Starting",RENDERING:"Rendering",STOPPING:"Stopping",SWITCHING_DEVICE:"SwitchingDevice",UNKNOWN:"Unknown"},VIDEO_MODE:{STRETCH:"Stretch",CROP:"Crop",FIT:"Fit"},PROGID_VERSION:"SkypePlugin.VersionQuery",PROGID_VERSION64:"SkypePlugin64.VersionQuery",MIME_TYPE:"application/x-skype-nativeplugin7.0",OBJECT_CLASS_ID:"CLSID:20BEBD18-11D0-4470-AAE1-F34B9E8D9761",PLUGIN_ERRORS:{REASON_CANNOT_CAPTURE:"CannotCapture",REASON_ALREADY_EXISTS:"AlreadyExists"}}}),define("jSkype/services/plugin/pluginEmbed",["require","browser/document","browser/detect","constants/plugin.const"],function(e){function i(e){var n=t.createElement("embed");return n.setAttribute("type",r.MIME_TYPE),n.setAttribute("tabindex","-1"),Object.keys(e).forEach(function(t){n.setAttribute(t,e[t])}),n}function s(e){var n=t.createElement("object");return Object.keys(e).forEach(function(r){var i=t.createElement("param");i.setAttribute("name",r),i.setAttribute("value",e[r]),n.appendChild(i)}),n.setAttribute("tabindex","-1"),n.setAttribute("type",r.MIME_TYPE),n}function o(){return a()?"object":"embed"}function u(e){return a()?s(e):i(e)}function a(){return n.getBrowserInfo().isIeEngine}function f(e){var t=e.getElementsByTagName(o())[0];t&&e.removeChild(t)}function l(e,n,r){var i=n?t.getElementById(n):t.getElementsByTagName("body")[0];i&&(r&&f(i),i.appendChild(e))}function c(e,t){t&&typeof t=="string"&&(e.className=t)}var t=e("browser/document"),n=e("browser/detect"),r=e("constants/plugin.const");return{createComponent:function(t,n,r){var i=u(n||{});return r=r||{},i.id=t,c(i,r.cssClass),l(i,r.parentElementId,r.removePrevious),i},removeComponent:function(n){var r=t.getElementById(n);r&&r.parentNode&&r.parentNode.removeChild(r)}}}),define("jSkype/services/plugin/baseComponent",["require","utils/common/async","jSkype/services/plugin/pluginEmbed","swx-utils-common","browser/detect","jSkype/telemetry/logging/callingLogTracer","browser/window","jSkype/settings","utils/common/version","constants/plugin.const"],function(e){function l(e){this._componentName=e,this._loadDelayMilisec=0,this._loadDelayTimer=null,this._heartBeatTimer=null,this._pluginExistenceCheckTimer=null,this._useNativeArguments=!1}function c(e){return!!e.plugin&&(m()||!!e.plugin.Load)}function h(e){e._loadDelayMilisec<u.settings.plugin.maxTotalLoadDelayMilisec?e._loadDelayTimer=o.setTimeout(function(){e._loadDelayMilisec+=u.settings.plugin.loadDelayMilisec,e.load()},u.settings.plugin.loadDelayMilisec):e.onError&&e.onError("Plugin Failed to Initialize")}function p(e){return e+"-"+r.create()}function d(e){function n(){o.clearTimeout(e._heartBeatTimer),e._heartBeatTimer=o.setTimeout(function(){e.onComponentCrashed&&e.onComponentCrashed()},u.settings.plugin.pingHeartBeatTimeout)}function r(e,n,r){e["on"+n]&&t.execute(e["on"+n].bind(null,r))}function i(t,n){var i=e._decodeArgs(n);s.log(e._componentName+" Event - "+t+": "+JSON.stringify(i)+" @"+e.componentId),t==="__FxLoadComplete"?t="LoadComplete":t==="__FxUnLoadComplete"&&(t="UnLoadComplete"),r(e,t,i)}function a(){e._pluginExistenceCheckTimer&&(o.clearTimeout(e._pluginExistenceCheckTimer),e._pluginExistenceCheckTimer=null),n();try{return e.plugin.PingResponse(),!0}catch(t){}return!1}e.plugin.OnEvent=i,e.plugin.OnPing=a}function v(e,t,r){var i={managerID:e,componentID:t,jsonMode:!0,windowless:!0,structuredArguments:!0};return n.createComponent(t,i,r)}function m(){return i.getBrowserInfo().isIeEngine}function g(e){var t=a.parse(e),n=a.parse(f.NATIVE_ARGUMENTS_REQUIRED_VERSION);return t.compareTo(n)>=0}function y(e){var t;try{t=e.plugin.CheckExistence()}catch(n){t=!1}t?e._pluginExistenceCheckTimer=o.setTimeout(y,u.settings.plugin.pingHeartBeatTimeout,e):e.onComponentCrashed&&e.onComponentCrashed()}var t=e("utils/common/async"),n=e("jSkype/services/plugin/pluginEmbed"),r=e("swx-utils-common").guid,i=e("browser/detect"),s=e("jSkype/telemetry/logging/callingLogTracer").get(),o=e("browser/window"),u=e("jSkype/settings"),a=e("utils/common/version"),f=e("constants/plugin.const");return l.prototype._init=function(t,r){var i=this;i.componentId=p(i._componentName),i.plugin=v(t,i.componentId,r),i.whenUnloaded=new Promise(function(e){i.onUnLoadComplete=function(){n.removeComponent(i.componentId),i.isDisposed=!0,delete i.plugin,e()}}),d(this),y(this)},l.prototype.load=function(t){c(this)?(this._useNativeArguments=g(this.plugin.GetVersion()),this.plugin.Load(this._componentName,this._encodeArgs(t))):h(this)},l.prototype._invokeMethod=function(t,n,r,i){var o=this._componentName+"::"+t+", "+JSON.stringify(n)+" @"+this.componentId;if(!c(this)){s.log("Attempted to execute this operation while plugin is not loaded:",o);return}var u=this._encodeArgs(n),a,f=function(){};r=r||f,i=i||f;try{a=this.plugin.ProcessMethod(t,u)}catch(l){s.warn("e",l.stack),i(l);return}var h=this._decodeArgs(a),p=o+" Result: "+JSON.stringify(a);s.log(p),h.error?i(h.error):r(h)},l.prototype.getVersion=function(t){var n=this.plugin.GetVersion();t&&t(n)},l.prototype.setLogLevel=function(t,n){var r=this.plugin.SetLogLevel(t);n&&n(r)},l.prototype.checkExistence=function(t){var n=this.plugin.CheckExistence();t&&t(n)},l.prototype.unload=function(t){try{this.whenUnloaded.then(t),this.plugin.UnLoad()}catch(n){s.warn("[BaseComponent] unable to unload component",n),t&&t()}},l.prototype.dispose=function(t){var r=this;this.isDisposed||(o.clearTimeout(this._loadDelayTimer),o.clearTimeout(this._heartBeatTimer),o.clearTimeout(this._pluginExistenceCheckTimer),this.unload(function(){n.removeComponent(r.componentId),delete r.plugin,t&&t()}),this.isDisposed=!0)},l.prototype._encodeArgs=function(e){return this._useNativeArguments?e||{}:JSON.stringify(e||{})},l.prototype._decodeArgs=function(e){return this._useNativeArguments?e||{}:JSON.parse(e||"{}")},l}),define("jSkype/services/plugin/managerComponent",["require","jSkype/services/plugin/baseComponent"],function(e){function r(){i(),this._init.call(this,"_",{cssClass:"pluginNoSize"})}function i(){window.navigator.plugins&&window.navigator.plugins.refresh&&window.navigator.plugins.refresh(!1)}var t="__pluginFx",n=e("jSkype/services/plugin/baseComponent");return r.prototype=new n(t),r.constructor=n.constructor,r.prototype.runSoftwareUpdate=function(t,n,r,i){var s={minVersion:t,highVersion:n,pluginManifestKey:r,ecs:i};this._invokeMethod("RunSoftwareUpdate",s)},r}),define("jSkype/services/plugin/skypeCoreComponent",["require","jSkype/services/plugin/baseComponent","jSkype/settings","constants/calling"],function(e){function s(e){this._init.call(this,e,{cssClass:"pluginNoSize"})}function o(e){return!isNaN(e)&&e>=0&&e<11}var t="SkypeCore",n=e("jSkype/services/plugin/baseComponent"),r=e("jSkype/settings"),i=e("constants/calling");return s.prototype=new n(t),s.constructor=n.constructor,s.prototype.loginWithPassword=function(t,n,i){var s={participantId:t,password:n,cacheCredentials:i,uicServiceUrl:r.settings.uicServiceUrl.byPassword};this._invokeMethod("LoginWithPassword",s)},s.prototype.loginWithSkypeToken=function(t,n,i){var s={participantId:t,accessToken:n,cacheCredentials:i,uicServiceUrl:r.settings.uicServiceUrl.bySkypeToken};this._invokeMethod("LoginWithSkypeToken",s)},s.prototype.selectCameraDevice=function(t){this._invokeMethod("SelectCameraDevice",{deviceId:t})},s.prototype.selectMicrophoneDevice=function(t){this._invokeMethod("SelectMicrophoneDevice",{deviceId:t})},s.prototype.selectSpeakerDevice=function(t){this._invokeMethod("SelectSpeakerDevice",{deviceId:t})},s.prototype.placeCall=function(t,n,r){var i={calleeIds:t,identitiesToUse:n,withVideo:!!r&&!0};this._invokeMethod("PlaceCall",i)},s.prototype.awaitCall=function(t,n,r,i,s){var o={eventTypeId:t,convoIdentity:n,callId:r,nodeSpecificNotificationPayload:i,genericNotificationPayload:s};this._invokeMethod("AwaitCall",o)},s.prototype.joinCall=function(t,n,r,i){var s={convoIdentity:t,withVideo:!!n,hostId:"",accessToken:i};this._invokeMethod("JoinCall",s)},s.prototype.acceptCall=function(t,n){var r={convoIdentity:t,accept:!0,withVideo:!!n&&!0};this._invokeMethod("AnswerCall",r)},s.prototype.rejectCall=function(t){var n={convoIdentity:t,accept:!1,withVideo:!1};this._invokeMethod("AnswerCall",n)},s.prototype.extendCall=function(t){var n={newCalleeIds:t};this._invokeMethod("ExtendCall",n)},s.prototype.forgetCall=function(t,n,r){var i={callId:t};this._invokeMethod("ForgetCall",i,n,r)},s.prototype.concludeCall=function(t){this._invokeMethod("ConcludeCall",null,t)},s.prototype.muteMicrophone=function(t){t?this._invokeMethod("MuteMicrophone"):this._invokeMethod("UnmuteMicrophone")},s.prototype.sendLocalVideo=function(t,n,r){this._invokeMethod("SendLocalVideo",{send:!!t,mediaType:n},r)},s.prototype.getMonitorList=function(t,n){this._invokeMethod("GetMonitorList",null,t,n)},s.prototype.setScreenCaptureMonitor=function(t,n,r){this._invokeMethod("SetScreenCaptureMonitor",{monitorId:t},n,r)},s.prototype.sendDtmf=function(t,n){this._invokeMethod("SendDtmf",{dtmfCode:t},n)},s.prototype.requestCallInfo=function(t,n){this._invokeMethod("RequestCallInfo",null,t,n)},s.prototype.setSoundLevelEventMode=function(t,n,r){var s,u;i.SOUND_LEVEL_EVENT_MODE[t.mode]||r("Sound level model not supported",t.mode),t.mode===i.SOUND_LEVEL_EVENT_MODE.Boolean&&!o(t.threshold)&&r("Threshold value not supported",t.threshold),s=typeof t.getLocalParticipantLevel=="boolean"?t.getLocalParticipantLevel:!0,u={mode:t.mode,threshold:t.threshold,myself:s},this._invokeMethod("SetSoundLevelEventMode",u,n,r)},s.prototype.setParticipantFrameSink=function(t,n,r,i){var s={participantId:t,frameSinkId:n,mediaType:r};this._invokeMethod("SetParticipantFrameSink",s,i)},s.prototype.setLocalFrameSink=function(t,n){var r={frameSinkId:t};this._invokeMethod("SetLocalFrameSink",r,n)},s.prototype.showLocalVideo=function(t,n){this._invokeMethod("ShowLocalVideo",{show:!!t&&!0},n)},s.prototype.showParticipantVideo=function(t,n,r,i){var s={participantId:t,show:!!n,mediaType:r};this._invokeMethod("ShowParticipantVideo",s,i)},s}),define("jSkype/services/plugin/videoComponent",["require","jSkype/services/plugin/baseComponent"],function(e){function r(e,t){this._init.call(this,e,{parentElementId:t,removePrevious:!0})}var t="VideoUI",n=e("jSkype/services/plugin/baseComponent");return r.prototype=new n(t),r.constructor=n.constructor,r.prototype.setRenderingMode=function(t,n){var r={mode:t};this._invokeMethod("SetRenderingMode",r,n)},r.prototype.getFrameSink=function(t){this._invokeMethod("GetFrameSink",null,t)},r.prototype.setupVideo=function(e,t){var n=this;n.getFrameSink(function(r){var i=r.frameSinkId;n.setRenderingMode(e,function(){t(i)})})},r}),define("jSkype/services/electron",["require","exports","module","browser/window"],function(e,t){var n=e("browser/window");t.getSkypeModule=function(){return n.Skype.getSkypeModule()},t.registerPresence=function(e,t){return n.Skype.registerPresence(e,t)}}),define("jSkype/services/plugin/electron/electronBase",["require","jSkype/services/electron","jSkype/telemetry/logging/callingLogTracer","constants/plugin.const"],function(e){function i(){var e=this;return e.isDisposed=!1,e._skypeModule=t.getSkypeModule(),e.whenUnloaded=Promise.resolve(),e}var t=e("jSkype/services/electron"),n=e("jSkype/telemetry/logging/callingLogTracer").get(),r=e("constants/plugin.const");return i.prototype.getVersion=function(e){var t=this._skypeModule.getVersion();e&&e(t)},i.prototype.checkExistence=function(e){e&&e(!0)},i.prototype.dispose=function(e){this.isDisposed=!0,e&&e()},i.prototype._raiseEvent=function(e,t){n.log(this.constructor.name+" Event - "+e+": "+JSON.stringify(t)),this["on"+e]&&this["on"+e](t)},i.prototype._raiseLoadComplete=function(e){this._raiseEvent("LoadComplete",{result:e?r.LOAD_RESULT.LOAD_SUCCESSFUL:r.LOAD_RESULT.COMPONENT_INIT_FAILED})},i}),define("jSkype/services/plugin/electron/electronManager",["require","exports","module","jSkype/services/plugin/electron/electronBase"],function(e,t){function r(){n.call(this)}var n=e("jSkype/services/plugin/electron/electronBase");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,r.prototype.load=function(){this._raiseLoadComplete(!0)},r.prototype.runSoftwareUpdate=function(){this._raiseEvent("UpdateCheckComplete",{updateVersion:null})},t.build=function(){return new r}}),define("jSkype/services/plugin/electron/electronSkypeCore",["require","exports","module","jSkype/services/plugin/electron/electronBase","jSkype/services/plugin/skypeCoreComponent","jSkype/telemetry/logging/callingLogTracer"],function(e,t){function s(){n.call(this)}var n=e("jSkype/services/plugin/electron/electronBase"),r=e("jSkype/services/plugin/skypeCoreComponent"),i=e("jSkype/telemetry/logging/callingLogTracer").get();s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.load=function(e){try{this._skypeModule.skypeCoreInit(e),this._skypeModule.skypeCoreSetEventHandler(n.prototype._raiseEvent.bind(this)),this._raiseLoadComplete(!0)}catch(t){i.warn(t),this._raiseLoadComplete(!1)}},s.prototype.dispose=function(e){try{this._skypeModule.skypeCoreDestroy()}catch(t){i.warn(t)}n.prototype.dispose.call(this,e)},s.prototype._invokeMethod=function(e,t,n,r){function s(){}i.log(this.constructor.name+"::"+e+", "+JSON.stringify(t)),n=n||s,r=r||s;try{var o=this._skypeModule.skypeCoreMethod(e,t||{});n(o||{})}catch(u){i.warn(u),r(u)}};for(var o in r.prototype)r.prototype.hasOwnProperty(o)&&(s.prototype[o]=r.prototype[o]);t.build=function(){return new s}}),define("jSkype/services/plugin/electron/electronVideoRenderer",["require","exports","module","jSkype/services/plugin/electron/electronBase","jSkype/services/plugin/videoComponent","jSkype/telemetry/logging/callingLogTracer","browser/document"],function(e,t){function o(e){n.call(this),this._parentElementId=e,this._renderer=new this._skypeModule.VideoRenderer,this._renderer.onVideoResolutionChanged=o.prototype._raiseVideoResolutionChanged.bind(this)}var n=e("jSkype/services/plugin/electron/electronBase"),r=e("jSkype/services/plugin/videoComponent"),i=e("jSkype/telemetry/logging/callingLogTracer").get(),s=e("browser/document");o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.load=function(){var e=s.getElementById(this._parentElementId);try{this._renderer.initialize(e),this._raiseLoadComplete(!0)}catch(t){i.warn(t),this._raiseLoadComplete(!1)}},o.prototype.dispose=function(e){try{this._renderer.dispose()}catch(t){i.warn(t)}delete this._parentElementId,delete this._renderer,n.prototype.dispose.call(this,e)},o.prototype.getFrameSink=function(e){var t=this._renderer.getFrameSinkId();e&&e({frameSinkId:t})},o.prototype.setRenderingMode=function(e,t){var n=this._skypeModule.VideoRenderer.SCALING_MODE,r={Stretch:n.STRETCH,Crop:n.CROP,Fit:n.FIT};this._renderer.setScalingMode(r[e]),t&&t()},o.prototype._raiseVideoResolutionChanged=function(e,t){this._raiseEvent("VideoResolutionChanged",{width:e,height:t})},o.prototype.setupVideo=r.prototype.setupVideo,t.build=function(e){return new o(e)}}),define("jSkype/services/plugin/componentFactory",["require","exports","module","jSkype/services/plugin/managerComponent","jSkype/services/plugin/skypeCoreComponent","jSkype/services/plugin/videoComponent","jSkype/services/plugin/electron/electronManager","jSkype/services/plugin/electron/electronSkypeCore","jSkype/services/plugin/electron/electronVideoRenderer","browser/detect"],function(e,t){function f(){return a.getBrowserInfo().isElectron}var n=e("jSkype/services/plugin/managerComponent"),r=e("jSkype/services/plugin/skypeCoreComponent"),i=e("jSkype/services/plugin/videoComponent"),s=e("jSkype/services/plugin/electron/electronManager"),o=e("jSkype/services/plugin/electron/electronSkypeCore"),u=e("jSkype/services/plugin/electron/electronVideoRenderer"),a=e("browser/detect");t.createManagerComponent=function(){return f()?s.build():new n},t.createSkypeCoreComponent=function(e){return f()?o.build():new r(e)},t.createVideoComponent=function(e,t){return f()?u.build(t):new i(e,t)}}),define("jSkype/constants/featureFlags",{PLUGIN_AUTO_UPDATE:"pluginAutoUpdate",CREDIT_BALANCE_AUTO_UPDATE_ENABLED:"creditBalanceAutoUpdateEnabled"}),define("jSkype/services/plugin/pluginUpdate",["require","exports","module","jSkype/settings","jSkype/constants/featureFlags"],function(e,t){function o(){return n.isFeatureOn(r.PLUGIN_AUTO_UPDATE)}var n=e("jSkype/settings"),r=e("jSkype/constants/featureFlags"),i,s={TIME_TO_CHECK_FOR_UPDATE:1e4,TIME_TO_START_DOWNLOAD:1e4,TIME_TO_FINISH_DOWNLOAD:3e4,TIME_TO_START_INSTALL:1e4,TIME_TO_FINISH_INSTALL:1e4};t.TIMEOUTS=s,t.wasTryingToUpdate=!1,t.updateLatest=function(e,r){function u(t){window.clearTimeout(i),e.onUpdateCheckComplete=null,e.onUpdateDownloadStarted=null,e.onUpdateDownloadComplete=null,e.onUpdateInstallStarted=null,e.onUpdateInstallComplete=null,r&&(r(Boolean(t)),r=null)}function a(){var t=n.settings.plugin.download.minVersion,r=n.settings.plugin.download.maxVersion,i=n.settings.plugin.manifestKey,s=n.settings.plugin.ecsService;e.runSoftwareUpdate(t,r,i,s)}function f(){e.onUpdateCheckComplete=l,e.onUpdateDownloadStarted=c,e.onUpdateDownloadComplete=h,e.onUpdateInstallStarted=p,e.onUpdateInstallComplete=d}function l(e){window.clearTimeout(i),e&&!e.updateVersion?u():i=window.setTimeout(u,s.TIME_TO_START_DOWNLOAD)}function c(){window.clearTimeout(i),i=window.setTimeout(u,s.TIME_TO_FINISH_DOWNLOAD)}function h(e){window.clearTimeout(i),e&&!e.success?u():i=window.setTimeout(u,s.TIME_TO_START_INSTALL)}function p(){window.clearTimeout(i),window.setTimeout(u,s.TIME_TO_FINISH_INSTALL)}function d(e){window.clearTimeout(i),u(e&&e.success)}if(!o()||t.wasTryingToUpdate){u();return}t.wasTryingToUpdate=!0,f(e),a(e),i=window.setTimeout(u,s.TIME_TO_CHECK_FOR_UPDATE)}}),define("jSkype/constants/calling",{eventProperties:{PluginVersion:"plugin_version"}}),define("jSkype/models/device",["require","jcafe-property-model"],function(e){function n(e,n,r){this.deviceFriendlyName=t.property({value:e}),this.deviceId=t.property({value:n}),this.type=t.property({value:r})}var t=e("jcafe-property-model");return n}),define("jSkype/services/plugin/deviceHandlers",["require","exports","module","jSkype/client","jSkype/models/device","swx-enums"],function(e,t){function s(e){switch(e){case i.deviceType.Camera:return n.get().devicesManager.cameras;case i.deviceType.Microphone:return n.get().devicesManager.microphones;case i.deviceType.Speaker:return n.get().devicesManager.speakers}}function o(e){switch(e){case i.deviceType.Camera:return n.get().devicesManager.selectedCamera;case i.deviceType.Microphone:return n.get().devicesManager.selectedMicrophone;case i.deviceType.Speaker:return n.get().devicesManager.selectedSpeaker}}var n=e("jSkype/client"),r=e("jSkype/models/device"),i=e("swx-enums");t.createOnDeviceAddedHandler=function(e){var t=s(e);return function(n){if(n.deviceId){var i=new r(n.deviceName,n.deviceId,e);t._add(i,n.deviceId)}}},t.createOnDeviceRemovedHandler=function(e){var t=s(e),n=o(e);return function(e){var r=t(e.deviceId);t._remove(e.deviceId),n()===r&&n(null)}},t.createOnDeviceSelectedHandler=function(e){var t=s(e),n=o(e);return function(e){if(e.deviceId){var r=t(e.deviceId);n(r)}}}}),define("jSkype/telemetry/pluginTelemetry",["require","exports","module","jSkype/client","jSkype/settings"],function(e,t){function i(e){function t(e){var t=s(e);i(t)}function i(e){n.get()._telemetryManager.sendEvent(r.settings.telemetry.jSkypeTenantToken,"Calling",e)}function s(t){return{name:t,plugin_version:e}}e?t("PluginStarted"):e="Unknown",this.logPluginCrashed=function(){t("PluginCrashed")},this.logPluginAlreadyRunning=function(){t("PluginAlreadyRunning")},this.logPluginInitializationTimeout=function(){t("PluginInitializationTimeout")}}var n=e("jSkype/client"),r=e("jSkype/settings");t.getLogger=function(e){return new i(e)}}),define("jSkype/services/plugin/participantVoiceState",{speaking:"Speaking",listening:"Listening",hold:"OnHold",ringing:"Ringing",earlyMedia:"EarlyMedia",leaving:"Leaving",finished:"Finished"}),define("jSkype/services/plugin/participantVideoState",{available:"Available",starting:"Starting",rendering:"Rendering",stopping:"Stopping",notAvailable:"NotAvailable"}),define("jSkype/services/plugin/mappers/callStateMapper",["require","exports","module","swx-enums"],function(e,t){var n=e("swx-enums"),r={RingingOut:n.callConnectionState.Connecting,InProgress:n.callConnectionState.Connected};t.CALL_STATES={ringingIn:"RingingIn",ringingOut:"RingingOut",initializing:"Initializing",inProgress:"InProgress",othersAreLive:"OthersAreLive",ringingForMe:"RingingForMe",transferring:"Transferring",downgraded:"Downgraded",onHold:"OnHold",inVoiceMail:"InVoiceMail",finished:"Finished",unknown:"Unknown"},t.toCafeState=function(e){return r[e]}}),define("jSkype/services/plugin/mappers/callLeaveReasonMapper",["require","exports","module","swx-enums"],function(e,t){var n=e("swx-enums"),r={Terminated:n.callDisconnectionReason.Terminated,FullSession:n.callDisconnectionReason.FullSession,Busy:n.callDisconnectionReason.Busy,Refused:n.callDisconnectionReason.Refused,Missed:n.callDisconnectionReason.Missed,Dropped:n.callDisconnectionReason.Dropped,InvalidNumber:n.callDisconnectionReason.InvalidNumber,ForbiddenNumber:n.callDisconnectionReason.ForbiddenNumber,EmergencyCallDenied:n.callDisconnectionReason.EmergencyCallDenied,VoiceMailFailed:n.callDisconnectionReason.VoiceMailFailed,TransferFailed:n.callDisconnectionReason.TransferFailed,InsufficientFunds:n.callDisconnectionReason.InsufficientFunds,Failed:n.callDisconnectionReason.Failed,AlreadyEnded:n.callDisconnectionReason.Missed,CallerUnreachable:n.callDisconnectionReason.Refused};t.CALL_LEAVE_REASONS={terminated:"Terminated",fullSession:"FullSession",busy:"Busy",refused:"Refused",missed:"Missed",dropped:"Dropped",invalidNumber:"InvalidNumber",forbiddenNumber:"ForbiddenNumber",emergencyCallDenied:"EmergencyCallDenied",voiceMailFailed:"VoiceMailFailed",transferFailed:"TransferFailed",insufficientFunds:"InsufficientFunds",failed:"Failed",alreadyEnded:"AlreadyEnded",callerUnreachable:"CallerUnreachable",unknown:"Unknown"},t.toCafeReason=function(e){return r[e]}}),define("jSkype/modelHelpers/calling/escalationHelper",["require","exports","module","swx-enums","jSkype/modelHelpers/participantHelper"],function(e,t){function i(e){e.selfParticipant.video.channels(0)&&e.selfParticipant.video.channels(0).isStarted.set._enabled(!0),e.selfParticipant.audio.isMuted.set.enabled._set(!0)}function s(e,t){var r=e.screenSharing.stream.state(),i=e.video.channels,s=null;i(0)&&(s=i(0).stream.state()),t.audio.isMuted._set(e.audio.isMuted()),t.audio.isSpeaking._set(e.audio.isSpeaking()),t.audio.isOnHold._set(e.audio.isOnHold()),t.audio.endpoint._set(e.audio.endpoint()),s&&s!==n.mediaStreamState.Stopped&&(t.video.channels(0).isStarted.set(!0),t.video.channels(0).isStarted.set._enabled(!0),t.video.channels(0).stream.state._set(s)),r!==n.mediaStreamState.Stopped&&(t.screenSharing.isControlling._set(e.screenSharing.isControlling()),t.screenSharing.stream.state._set(r))}function o(e){r.updateParticipantAudioVideoState(e,n.callConnectionState.Connecting,n.callDisconnectionReason.CallEscalated),r.updateParticipantAudioVideoState(e,n.callConnectionState.Connected,n.callDisconnectionReason.CallEscalated)}var n=e("swx-enums"),r=e("jSkype/modelHelpers/participantHelper");t.escalateCall=function(e,t){if(!t._callHandler)return;t.audioService.callConnected._set(e.audioService.callConnected()),e.spawnedConversation._set(t);var u=e.participants(0),a=r.getOrCreateParticipantInConversation(t,u.person.id()),f=e.selfParticipant,l=t.selfParticipant;o(a),s(u,a),o(l),s(f,l),t._callHandler.canToggleMute&&t._callHandler.canToggleMute._set(e._callHandler.canToggleMute()),r.handleParticipantLeavingStateTransition(u,n.callDisconnectionReason.CallEscalated),r.handleParticipantLeavingStateTransition(f,n.callDisconnectionReason.CallEscalated),i(e)}}),define("jSkype/services/preferences/settingsUtils/privacySettingsUtil",["require","exports","module","jSkype/client","constants/common","swx-enums","jSkype/settings","utils/common/logTracer/api","jSkype/modelHelpers/participantHelper","constants/people","browser/detect"],function(e,t){function c(e){if(e.value.state()===i.preferenceValueState.Defined)return Promise.resolve(e.value());if(f.getBrowserInfo().isShellApp)return Promise.resolve(i.privacyPolicyValues.Anyone);var t=new Promise(function(e,t){setTimeout(t,s.settings.userSettings.privacySettingsFetchTimeout)});return Promise.race([e.value.get(),t])}function h(e,t){var n=e.person._authorization._value===a.authorizationStates.AUTHORIZED;return t===i.privacyPolicyValues.Anyone||t===i.privacyPolicyValues.ContactsOnly&&n}function p(e,t){if(u.isMeParticipant(e))return Promise.resolve(!0);var r=n.get().personsAndGroupsManager.mePerson.preferences(t);return r?c(r).then(function(n){var r=h(e,n);return l.log("[Settings Manager] Privacy settings for "+t+" is "+r),r}).catch(function(){return l.log("[Settings Manager] Could not reach privacy settings within "+s.settings.userSettings.privacySettingsFetchTimeout+" ms"),!0}):Promise.resolve(!0)}var n=e("jSkype/client"),r=e("constants/common"),i=e("swx-enums"),s=e("jSkype/settings"),o=e("utils/common/logTracer/api"),u=e("jSkype/modelHelpers/participantHelper"),a=e("constants/people"),f=e("browser/detect"),l=o.getLogger("Settings");t.checkCallPolicySettings=function(e){return s.isFeatureOn(r.featureFlags.SKYPE_CALL_POLICY_SUPPORT)?e.isGroupConversation()?Promise.resolve(!0):p(e.participants(0),r.userSettings.preferences.SKYPE_CALL_POLICY_SUPPORT):Promise.resolve(!0)},t.checkVideoPolicySettings=function(e){return s.isFeatureOn(r.featureFlags.SKYPE_VIDEO_CALLING_POLICY_SUPPORT)?p(e,r.userSettings.preferences.SKYPE_VIDEO_CALLING_POLICY_SUPPORT):Promise.resolve(!0)}}),define("jSkype/services/plugin/pluginEventDispatcher",["require","exports","module","jSkype/client","jSkype/settings","jSkype/services/plugin/participantVoiceState","jSkype/services/plugin/participantVideoState","jSkype/services/plugin/mappers/callStateMapper","jSkype/services/plugin/mappers/callLeaveReasonMapper","constants/common","swx-enums","constants/calling","constants/plugin.const","jSkype/services/callRegister","jSkype/services/callController","jSkype/modelHelpers/participantHelper","jSkype/modelHelpers/calling/escalationHelper","jSkype/modelHelpers/contacts/dataMappers/dataMaps","jSkype/modelHelpers/propertyValidator","jSkype/telemetry/logging/callingLogTracer","jSkype/services/preferences/settingsUtils/privacySettingsUtil"],function(e,t){function x(e,t,n){E[e]||(E[e]=[]),E[e].push({handlerFn:t,data:n})}function T(e){e?delete E[e]:E={}}function N(e,t){E[e]&&(E[e].forEach(function(e){e.data.convoIdentity=t,e.handlerFn(e.data)}),T(e))}function C(e){return/^#/.test(e)}function k(e){return function(t){if(C(t.convoIdentity)){x(t.convoIdentity,e,t);return}e(t)}}function L(e){var t=$(e),n=Q(e.convoIdentity)||Z(e.callId);if(!n)return;n.audioService.callId._set(e.callId),n._callData.nodeId(w),J(e.callStatus,n);switch(e.callStatus){case o.CALL_STATES.ringingForMe:n.isGroupConversation()&&n._callData.pluginOthersAreLive(!0),n._callData.pluginAwaitCall()?(n._callData.pluginAwaitCall(!1),d.updateParticipantAudioVideoState(n.selfParticipant,f.callConnectionState.Notified,t)):n._callData.pluginRingingForMe(!0);break;case o.CALL_STATES.othersAreLive:n._callData.pluginOthersAreLive(!0),n.selfParticipant.audio.state()===f.callConnectionState.Disconnecting&&n.selfParticipant.audio.state.reason===f.callDisconnectionReason.Terminated&&d.handleParticipantLeavingStateTransition(n.selfParticipant,t);break;case o.CALL_STATES.finished:e.callLeaveReason===f.callDisconnectionReason.Terminated?n._callData.pluginOthersAreLive(!1):e.callLeaveReason===f.callDisconnectionReason.Failed&&n.selfParticipant.audio._isFailedCall(!0),d.handleParticipantLeavingStateTransition(n.selfParticipant,t),d.handleRemoteParticipantsLeavingStateTransition(n.participants(),t);break;default:o.toCafeState(e.callStatus)&&d.updateParticipantAudioVideoState(n.selfParticipant,o.toCafeState(e.callStatus),t)}}function A(e){if(!e.convoIdentity)return;var t=Q(e.convoIdentity),n=d.getOrCreateParticipantInConversation(t,e.participantId),i=r.SoundLevelEventMode||l.SOUND_LEVEL_EVENT_MODE.Boolean,s=parseInt(e.soundLevel,10);if(!n){y.warn("Unable to get participant",e.participantId);return}if(i===l.SOUND_LEVEL_EVENT_MODE.None)return;i===l.SOUND_LEVEL_EVENT_MODE.Boolean?n.audio.isSpeaking._set(s===l.PLUGIN_MAX_SOUND_LEVEL):i===l.SOUND_LEVEL_EVENT_MODE.Full&&n.audio.isSpeaking._set(Boolean(s))}function O(e){if(!e.convoIdentity)return;var t=Q(e.convoIdentity),n=d.getOrCreateParticipantInConversation(t,e.participantId),r=[i.speaking,i.listening,i.hold];if(!n){y.warn("Unable to get participant",e.participantId);return}if(d.isMeParticipant(n))return!1;e.voiceStatus===i.ringing&&d.handleParticipantRingingStateTransition(n,t),e.voiceStatus===i.leaving&&d.handleParticipantLeavingStateTransition(n,e.callLeaveReason),e.voiceStatus===i.earlyMedia&&d.updateParticipantAudioVideoState(n,f.callConnectionState.EarlyMedia),r.indexOf(e.voiceStatus)>-1&&d.handleParticipantJoiningStateTransition(n,t)}function M(e){if(!e.convoIdentity)return;var t=Q(e.convoIdentity),n=d.getOrCreateParticipantInConversation(t,e.participantId);if(!n){y.warn("Unable to get participant",e.participantId);return}if(d.isMeParticipant(n))return!1;(n.audio.state()===f.callConnectionState.Disconnecting||n.audio.state()===f.callConnectionState.Disconnected)&&e.callLeaveReason!==f.callDisconnectionReason.Unknown&&d.updateParticipantAudioVideoState(n,n.audio.state(),e.callLeaveReason)}function _(e){if(!e.convoIdentity)return;if(e.mediaType===l.PLUGIN_MEDIA_TYPES.SCREEN_SHARING&&!r.isFeatureOn(a.featureFlags.INCOMING_SCREEN_SHARING))return;var t=Q(e.convoIdentity),n=d.getOrCreateParticipantInConversation(t,e.participantId),i=e.mediaType===l.PLUGIN_MEDIA_TYPES.SCREEN_SHARING,o=n.video.channels(0),u=o.stream,c=n.screenSharing.stream,h;if(!n){y.warn("Unable to get participant",e.participantId);return}o&&c&&(h=i?c:u,b.checkVideoPolicySettings(n).then(function(t){switch(e.videoStatus){case s.available:t&&(d.isMeParticipant(n)||h.state._set(f.mediaStreamState.Started));break;case s.starting:t&&(d.isMeParticipant(n)?h.state._set(f.mediaStreamState.Active):h.state._set(f.mediaStreamState.Inactive));break;case s.rendering:t&&(h.state._set(f.mediaStreamState.Active),i||o.isStarted.set._enabled(!0));break;case s.stopping:case s.notAvailable:h.state._set(f.mediaStreamState.Stopped),i||o.isStarted.set._enabled(!0)}}))}function D(e){var t=h.get().activeCalls()[0],n;if(!t)return;n=t.selfParticipant.video.channels(0),n.stream.width._set(e.width),n.stream.height._set(e.height)}function P(e,t,n){var r=h.get().activeCalls()[0],i=d.getOrCreateParticipantInConversation(r,t),s;if(!i){y.warn("Unable to get participant",t);return}s=n===l.PLUGIN_MEDIA_TYPES.SCREEN_SHARING?i.screenSharing.stream:i.video.channels(0).stream,s.state()!==f.mediaStreamState.Stopped&&s.state._set(f.mediaStreamState.Active),s.width._set(e.width),s.height._set(e.height)}function H(){et(function(e){d.handleParticipantLeavingStateTransition(e.selfParticipant),e._callData.pluginOthersAreLive(!1);var t=e.participants.subscribe();d.handleRemoteParticipantsLeavingStateTransition(e.participants()),T(),t.dispose()})}function B(e){var t=n.get().devicesManager.selectedCamera();e.reason===c.PLUGIN_ERRORS.REASON_CANNOT_CAPTURE&&t!==null&&et(function(e){e.selfParticipant.video.channels(0).stream.state._set(f.mediaStreamState.Stopped)})}function j(e){e.nodeId&&(w=e.nodeId)}function F(e){if(e.senderIdentity==="sys"&&e.messageBody&&/CallInformation/.test(e.messageBody)){var t=Q(e.convoIdentity);t._callData.pluginCallInfo(e.messageBody)}}function I(e){if(!r.isFeatureOn(a.featureFlags.GVC_ESCALATION))return;var t=Q(e.oldConvoIdentity);t.selfParticipant.video.channels(0).isStarted.set._enabled(!1),t.selfParticipant.audio.isMuted.set.enabled._set(!1);if(!C(e.newConvoIdentity)){var i=Q(e.newConvoIdentity);p.setupCall(i),n.get().conversationsManager.conversations.add(i),v.escalateCall(t,i)}else S[e.newConvoIdentity]=e.oldConvoIdentity}function q(e){var t=e.tempConvoIdentity,r=e.realConvoIdentity;if(!S[t])return;var i=Q(S[t]),s=Q(r);p.setupCall(s),n.get().conversationsManager.conversations.add(s),v.escalateCall(i,s),N(t,r)}function R(e){var t=Q(e.convoIdentity);d.getOrCreateParticipantInConversation(t,e.participantId)}function U(e){var t=Q(e.convoIdentity),n=d.getParticipantFromConversation(t,e.participantId);if(!n){y.warn("Unable to get participant",e.participantId);return}d.handleParticipantLeavingStateTransition(n)}function z(e){var t=Q(e.convoIdentity);if(!t){y.error("Trying to mute microphone but conversation does not exist",e.convoIdentity);return}K(t,!0)}function W(e){var t=Q(e.convoIdentity);if(!t){y.error("Trying to unmute microphone but conversation does not exist",e.convoIdentity);return}K(t,!1)}function X(e){var t=Q(e.convoIdentity)||Z(e.callId);if(!t){y.error("Call technology changed for conversation that does not exist",e.convoIdentity);return}t._callData.callTechnology(e.callTechnology),t.mediaConnectionType(V(e.callTechnology))}function V(e){switch(e){case f.callTechnology.P2P:return f.mediaConnectionType.PluginBasedP2P;case f.callTechnology.NGC:return f.mediaConnectionType.PluginBasedNGC;default:return f.mediaConnectionType.Unknown}}function $(e){var t;return e.callLeaveReason&&(t=u.toCafeReason(e.callLeaveReason),t===f.callDisconnectionReason.Terminated&&n.get().devicesManager.speakers().length===0&&(t=f.callDisconnectionReason.MissingSpeaker)),t}function J(e,t){if(!t._callHandler){y.warn("Trying to update canMute in conversation without active call",t);return}(e===o.CALL_STATES.ringingForMe||e===o.CALL_STATES.othersAreLive||e===o.CALL_STATES.inProgress||e===o.CALL_STATES.ringingIn||e===o.CALL_STATES.ringingOut)&&t._callHandler.canToggleMute(!0)}function K(e,t){var n=e._callHandler.toggleMuteTask;n&&n.promise.state()==="pending"&&n.resolve(t)}function Q(e){if(!e)return;e=Y(e);if(!G(e)){var t=g.isPhoneNumber(e)?m.contactTypes[m.contactTypeNames.pstn]+":":m.contactTypes[m.contactTypeNames.skype]+":";e=t+e}return n.get().conversationsManager._getOrCreateConversation(e)}function G(e){return/^(?:1|19|8|4):/.test(e)}function Y(e){return e.replace(/#\w\//,"")}function Z(e){if(!e)return;return h.get().getConversationByCallId(e)}function et(e){var t=h.get().activeCalls();t.forEach(e)}var n=e("jSkype/client"),r=e("jSkype/settings"),i=e("jSkype/services/plugin/participantVoiceState"),s=e("jSkype/services/plugin/participantVideoState"),o=e("jSkype/services/plugin/mappers/callStateMapper"),u=e("jSkype/services/plugin/mappers/callLeaveReasonMapper"),a=e("constants/common"),f=e("swx-enums"),l=e("constants/calling"),c=e("constants/plugin.const"),h=e("jSkype/services/callRegister"),p=e("jSkype/services/callController"),d=e("jSkype/modelHelpers/participantHelper"),v=e("jSkype/modelHelpers/calling/escalationHelper"),m=e("jSkype/modelHelpers/contacts/dataMappers/dataMaps"),g=e("jSkype/modelHelpers/propertyValidator"),y=e("jSkype/telemetry/logging/callingLogTracer").get(),b=e("jSkype/services/preferences/settingsUtils/privacySettingsUtil"),w=null,E={},S={};t.startListeningOnSkypeCore=function(e){e.onCallStatusChanged=k(L),e.onParticipantVoiceStatusChanged=k(O),e.onParticipantVideoStatusChanged=k(_),e.onParticipantSoundLevelChanged=k(A),e.onParticipantLeaveReasonChanged=k(M),e.onParticipantJoined=k(R),e.onParticipantLeft=k(U),e.onMicrophoneMuted=k(z),e.onMicrophoneUnmuted=k(W),e.onErrorOccured=k(B),e.onCallTechnologyChanged=k(X),e.onTextMessage=k(F),e.onCallMoved=I,e.onConvoIdentityReceived=q,e.onConnectionStatusChanged=j},t.startListeningOnVideoManager=function(e){e.onLocalResolutionChanged=D,e.onResolutionChanged=P},t.onManagerComponentCrashed=H,t.clearTempConversationEvents=T}),define("jSkype/services/plugin/pluginCore",["require","exports","module","jcafe-property-model","jSkype/settings","swx-enums","jSkype/services/plugin/componentFactory","jSkype/services/plugin/pluginUpdate","constants/plugin.const","jSkype/constants/calling","constants/common","jSkype/services/plugin/deviceHandlers","jSkype/telemetry/pluginTelemetry","jSkype/services/plugin/pluginEventDispatcher","jSkype/client","utils/common/version"],function(e,t){function v(){function C(){return N=0,n.task().resolve().promise.then(O).then(I).then(R).then(V).then(function(){return e.shouldReinitialize=!0,{managerComponent:w,skypeCoreComponent:E}})}function k(r){return t?x&&!r?n.task().reject().promise:v?v.promise:(v=n.task(),t.then(L).catch(L).then(A),e.shouldReinitialize&&v.promise.then(function(){e.get()}),v.promise):n.task().resolve().promise}function L(){var e=[];return Q(),w.onComponentCrashed=null,e.push(K(E)),e.push(K(w)),n.task.waitAll(e)}function A(){t=null,w=null,E=null,v.resolve(),v=null}function O(){return g=n.task(),w=s.createManagerComponent(),w.onLoadComplete=M,w.onComponentCrashed=D,w.load(),g.promise}function M(e){e.result===u.LOAD_RESULT.LOAD_SUCCESSFUL&&(F(),j(),B(),g.resolve())}function _(){H(),e.dispose(!0)}function D(){P(),e.dispose(!0)}function P(){S&&S.logPluginCrashed(),T&&T()}function H(){S&&S.logPluginAlreadyRunning(),T&&T()}function B(){w.getVersion(function(e){S=c.getLogger(e)})}function j(){w.getVersion(function(t){var n=d.parse(t),i=d.parse(u.PERSISTENT_REQUIRED_VERSION);n.compareTo(i)>=0&&r.isFeatureOn(f.featureFlags.PERSISTENT_PLUGIN)?x=!0:x=!1})}function F(){w.getVersion(function(t){p.get()._telemetryManager.setCommonProperty(a.eventProperties.PluginVersion,t)})}function I(){var e=n.task();return o.updateLatest(w,function(t){t?q(e.resolve.bind(e)):e.resolve()}),e.promise}function q(e){g=null,K(w).then(O).then(e)}function R(){return y=n.task(),E=s.createSkypeCoreComponent(w.componentId),E.onErrorOccured=W,E.onLoadComplete=z,E.onLoginStatusChanged=X,U(),E.onMonitorListChanged=function(){},E.load({biAppName:r.settings.biAppName}),y.promise}function U(){E.onCameraDeviceAdded=l.createOnDeviceAddedHandler(i.deviceType.Camera),E.onCameraDeviceRemoved=l.createOnDeviceRemovedHandler(i.deviceType.Camera),E.onCameraDeviceSelected=l.createOnDeviceSelectedHandler(i.deviceType.Camera),E.onMicrophoneDeviceAdded=l.createOnDeviceAddedHandler(i.deviceType.Microphone),E.onMicrophoneDeviceRemoved=l.createOnDeviceRemovedHandler(i.deviceType.Microphone),E.onMicrophoneDeviceSelected=l.createOnDeviceSelectedHandler(i.deviceType.Microphone),E.onSpeakerDeviceAdded=l.createOnDeviceAddedHandler(i.deviceType.Speaker),E.onSpeakerDeviceRemoved=l.createOnDeviceRemovedHandler(i.deviceType.Speaker),E.onSpeakerDeviceSelected=l.createOnDeviceSelectedHandler(i.deviceType.Speaker),p.get().devicesManager._initializedDevices=!0}function z(e){e.result===u.LOAD_RESULT.LOAD_SUCCESSFUL&&(h.startListeningOnSkypeCore(E),y.resolve())}function W(t){t.reason===u.PLUGIN_ERRORS.REASON_ALREADY_EXISTS&&(y.reject(t.reason),e.shouldReinitialize=!1,e.dispose(!0),_())}function X(e){if(e.loginStatus===u.LOGIN_STATUS.LOGGED_IN){N=0,b.promise.state()==="pending"&&b.resolve();return}e.loginStatus===u.LOGIN_STATUS.LOGGED_OUT&&(N++,N<u.LOGIN_FAILURE_STOP_GAP?J():$())}function V(){return b=n.task(),J(),b.promise}function $(){e.shouldReinitialize=!1,b.promise.state()==="pending"&&b.reject(),D()}function J(){var e=p.get().personsAndGroupsManager.mePerson.id();p.get().signInManager._skypeToken().then(function(t){E.loginWithSkypeToken(e,t)})}function K(e){var t=n.task();return e?e.dispose(function(){t.resolve()}):t.resolve(),t.promise}function Q(){var e=p.get().devicesManager;G(e.cameras),G(e.microphones),G(e.speakers),e.selectedCamera(undefined),e.selectedMicrophone(undefined),e.selectedSpeaker(undefined),delete p.get().devicesManager._initializedDevices}function G(e){var t,n;for(t=e.size()-1;t>=0;--t)n=e(t),e._remove(n.deviceId())}var e=this,t,v,g,y,b,w,E,S,x,T,N;e.shouldReinitialize=!1,e.get=function(){function r(){return t||C()}return m()?(v?t=v.promise.then(r):t=r(),t):n.task().reject().promise},e.isManagerLoaded=function(){return g?g.promise.state()==="resolved":!1},e.onCrash=function(e){T=e},e.dispose=k}function m(){var e=p.get().personsAndGroupsManager.mePerson.capabilities.audio;return e.reason!==i.callingNotSupportedReasons.PluginNotInstalled}var n=e("jcafe-property-model"),r=e("jSkype/settings"),i=e("swx-enums"),s=e("jSkype/services/plugin/componentFactory"),o=e("jSkype/services/plugin/pluginUpdate"),u=e("constants/plugin.const"),a=e("jSkype/constants/calling"),f=e("constants/common"),l=e("jSkype/services/plugin/deviceHandlers"),c=e("jSkype/telemetry/pluginTelemetry"),h=e("jSkype/services/plugin/pluginEventDispatcher"),p=e("jSkype/client"),d=e("utils/common/version");t.isInstalled=m,t.build=function(){return new v}}),define("jSkype/services/plugin/videoManager",["require","jSkype/services/plugin/componentFactory","constants/plugin.const","constants/calling"],function(e){function s(e){e.id||(e.id="video-"+ +(new Date))}function o(e,t,n){var r=e._participantVideos;return r[t]||(r[t]={}),r[t][n]}var t=e("jSkype/services/plugin/componentFactory"),n=e("constants/plugin.const"),r=e("constants/calling"),i=function(e,t){this._managerComponentId=e,this._skypeCore=t,this._localVideoMap={},this._participantVideos={}};return i.prototype.showLocalPreview=function(r,i,o){function l(){return a._localVideoMap[i]&&(a._localVideoMap[i].embed||a._localVideoMap[i].creatingLocalVideo)}function c(){f.setupVideo(n.VIDEO_MODE.CROP,h)}function h(e){u.setLocalFrameSink(e,function(){a._localVideoMap[i].creatingLocalVideo=!1,u.showLocalVideo(!0,o)})}function p(e){a.onLocalResolutionChanged&&a.onLocalResolutionChanged(e)}var u=this._skypeCore,a=this,f;if(l())return;a._localVideoMap[i]={embed:null,creatingLocalVideo:!0,disposingLocalVideo:!1},s(r),f=t.createVideoComponent(a._managerComponentId,r.id),a._localVideoMap[i].embed=f,f.onLoadComplete=c,f.onVideoResolutionChanged=p,f.load(),f.whenUnloaded.then(function(){delete a._localVideoMap[i]})},i.prototype.startSendingLocalVideo=function(t,n){var r=this._skypeCore;r.sendLocalVideo(!0,t,n)},i.prototype.hideLocalPreview=function(t,n){function i(){n&&n()}function s(){delete r._localVideoMap[t],i()}function o(){return r._localVideoMap[t]&&!r._localVideoMap[t].disposingLocalVideo}var r=this;o()?(r._localVideoMap[t].disposingLocalVideo=!0,r._skypeCore.showLocalVideo(!1),r._skypeCore.setLocalFrameSink(0),r._localVideoMap[t].embed.dispose(s)):i()},i.prototype.stopSendingLocalVideo=function(t,n){this._skypeCore.sendLocalVideo(!1,t,n)},i.prototype.showParticipant=function(i,u,a){function h(e){f.onResolutionChanged&&f.onResolutionChanged(e,i,a)}function p(){var e=a===r.PLUGIN_MEDIA_TYPES.SCREEN_SHARING?n.VIDEO_MODE.FIT:n.VIDEO_MODE.CROP;c.setupVideo(e,d)}function d(e){l.setParticipantFrameSink(i,e,a,function(){l.showParticipantVideo(i,!0,a)})}var f=this,l=f._skypeCore,c;if(!i||!u||o(f,i,a))return;s(u),c=t.createVideoComponent(f._managerComponentId,u.id),f._participantVideos[i][a]=c,c.onLoadComplete=p,c.onVideoResolutionChanged=h,c.load()},i.prototype.hideParticipant=function(t,n,r){var i=o(this,t,n);i&&(r||(this._skypeCore.showParticipantVideo(t,!1,n),this._skypeCore.setParticipantFrameSink(t,0,n)),i.dispose(),delete this._participantVideos[t][n])},i.prototype.dispose=function(){var t=this,n=t._participantVideos;Object.keys(n).forEach(function(e){var r=n[e];Object.keys(r).forEach(function(n){t.hideParticipant(e,n)})}),Object.keys(t._localVideoMap).forEach(function(e){t.hideLocalPreview(e)})},{build:function(e,t){return new i(e,t)}}}),define("jSkype/services/plugin/pluginLifecycleFacade",["require","exports","module","jcafe-property-model","constants/calling","jSkype/modelHelpers/propertyModelHelper","jSkype/services/plugin/pluginCore","jSkype/services/plugin/videoManager","jSkype/services/plugin/pluginEventDispatcher","jSkype/telemetry/pluginTelemetry","browser/window"],function(e,t){function g(){return new Promise(function(e,t){var n=f.setTimeout(function(){t(r.PLUGIN_ERROR.INIT_TIMEOUT)},r.PLUGIN_INIT_TIMEOUT);return c.then(b).then(function(t){f.clearTimeout(n),e(t)},t)})}function y(){return l||(l=s.build()),l}function b(){return y().get()}function w(e){return h=e.managerComponent,p=e.skypeCoreComponent,d=o.build(h.componentId,p),u.startListeningOnVideoManager(d),y().onCrash(E),{skypeCore:p,videoManager:d}}function E(e){e===r.PLUGIN_ERROR.INIT_TIMEOUT&&S(),u.onManagerComponentCrashed(),t.dispose(!0)}function S(){m||(m=a.getLogger()),m.logPluginInitializationTimeout()}var n=e("jcafe-property-model"),r=e("constants/calling"),i=e("jSkype/modelHelpers/propertyModelHelper"),s=e("jSkype/services/plugin/pluginCore"),o=e("jSkype/services/plugin/videoManager"),u=e("jSkype/services/plugin/pluginEventDispatcher"),a=e("jSkype/telemetry/pluginTelemetry"),f=e("browser/window"),l,c=i.createResolvedPromise(),h,p,d,v,m;return t.initialize=function(){return y().get()},t.createPlugin=function(){return s.isInstalled()?v?v:(v=g().then(w),v.catch(E),v):i.createRejectedPromise(r.PLUGIN_ERROR.NOT_INSTALLED)},t.isLoaded=function(){return y().isManagerLoaded()},t.dispose=function(e){var t=n.task();return h=null,p=null,v=null,m=null,c=t.promise,d&&(d.dispose(),d=null),y().dispose(e).then(t.resolve.bind(t)).catch(t.resolve.bind(t)),t.promise},t}),define("jSkype/services/plugin/pluginCallHandler",["require","exports","module","jSkype/settings","constants/common","constants/calling","jSkype/utils/chat/conversation","swx-enums","jSkype/telemetry/logging/callingLogTracer","jcafe-property-model","jSkype/services/plugin/pluginLifecycleFacade","jSkype/modelHelpers/participantHelper","browser/window"],function(e,t){function h(e){function m(t){l.handleParticipantLeavingStateTransition(e.selfParticipant,t),l.handleRemoteParticipantsLeavingStateTransition(e.participants())}function g(e){e&&e.dispose()}function y(t){u.log("[PluginCallHandler] handleConversationJoining",e.activeModalities.audio()),e.activeModalities.audio()?t.skypeCore.joinCall(e.conversationId,T(),e._callHostId,e._callPayload.AccessToken):(N(o.callConnectionState.Disconnecting,o.callDisconnectionReason.Terminated),N(o.callConnectionState.Disconnected,o.callDisconnectionReason.Terminated))}function b(t){e.selfParticipant.video.channels.added.off(b),!t.isStarted()&&t.isStarted.set.enabled()&&t.isStarted.set(!0)}function w(n){u.log("[PluginCallHandler] join conversation, pluginOthersAreLive:",e._callData.pluginOthersAreLive()),p=e._callData.pluginOthersAreLive.once(!0,y.bind(t,n))}function E(t){u.log("[PluginCallHandler] handleAutoCall, mode",e._autoCallingService.autoCallingMode()),e._autoCallingService.autoCallingMode()===r.autoCallingMode.join&&(u.log("[PluginCallHandler] handleAutoCall, audio state",e.activeModalities.audio()),h=e.activeModalities.audio.once(!0,function(){w(t)}),e.autoCall.once(!1,h.dispose)),(e._autoCallingService.autoCallingMode()===r.autoCallingMode.call||e._autoCallingService.autoCallingMode()===r.autoCallingMode.golive)&&t.skypeCore.joinCall(e.conversationId,T())}function S(){e.selfParticipant.video.channels.added(b)}function x(){e.selfParticipant.video.channels.added.off(b)}function T(){return v&&s.isPstnOnlyConversation(e)?!1:e.selfParticipant.video.channels(0)?e.selfParticipant.video.channels(0).isStarted():!1}function N(t,n){e.selfParticipant.audio.state._set(t,n),e.selfParticipant.video.state._set(t,n)}function C(e){f.createPlugin().then(function(t){t.skypeCore.muteMicrophone(e)},I)}function k(e){return t.toggleMuteTask&&t.toggleMuteTask.promise.state()==="pending"?t.toggleMuteTask.promise:(t.toggleMuteTask=a.task(),t.canToggleMute()?C(e):d=t.canToggleMute.once(!0,C.bind(null,e)),t.toggleMuteTask.promise)}function L(t){return e.selfParticipant.person.id()===t}function A(t){e.selfParticipant.video.channels(0).stream.state._set(t)}function O(e){return new Promise(function(t,n){e===i.PLUGIN_MEDIA_TYPES.VIDEO&&x(),f.createPlugin().then(function(n){n.videoManager.startSendingLocalVideo(e,t)},function(e){I(e),n(e)})})}function M(e){return new Promise(function(t,n){function s(){A(o.mediaStreamState.Stopped),t(!0)}function u(){t(!0)}if(F()){t(!0);return}var r;e===i.PLUGIN_MEDIA_TYPES.SCREEN_SHARING?r=u:(x(),r=s),f.createPlugin().then(function(t){t.videoManager.stopSendingLocalVideo(e,r)},function(e){I(e),n(e)})})}function _(t){f.createPlugin().then(function(n){n.videoManager.showLocalPreview(t,e.conversationId,function(){e.selfParticipant.audio.state()===o.callConnectionState.Connecting&&A(o.mediaStreamState.Active)})},I)}function D(){f.createPlugin().then(function(t){t.videoManager.hideLocalPreview(e.conversationId)},I)}function P(e,t,n){f.createPlugin().then(function(r){r.videoManager.showParticipant(e,t,n)},I)}function H(e,t){return new Promise(function(n,r){f.createPlugin().then(function(r){r.videoManager.hideParticipant(e,t,F()),n(!0)},function(e){I(e),r(e)})})}function B(){var t=e.conversationId;return e.isGroupConversation()||(t=t.replace(/^\d+:/,"")),t}function j(e){if(!v)return;var t={};return e.participants().forEach(function(e){var n=e.person.id(),r=e.audio.endpoint();n!==r&&(t[n]=r)}),t}function F(){var t=e.selfParticipant.audio.state;return t.reason===o.callDisconnectionReason.CallEscalated&&(t()===o.callConnectionState.Disconnecting||t()===o.callConnectionState.Disconnected)}function I(e){u.log("[PluginCallHandler] Failed to create plugin:",e)}var t=this,h,p,d,v=n.isFeatureOn(r.featureFlags.PSTN_ENABLED);t.canToggleMute=a.property({value:e._callData.pluginRingingForMe()}),this.placeCall=function(t){return u.log("[PluginCallHandler] place call",t),t&&S(),f.createPlugin().then(function(t){var n=j(e),r=[e.conversationId];u.log("[PluginCallHandler] placing call, plugin ready"),u.log("[PluginCallHandler] isGroupConversation",e.isGroupConversation()),u.log("[PluginCallHandler] autoCall",e.autoCall()),u.log("[PluginCallHandler] activeModalities.audio",e.activeModalities.audio()),e.isGroupConversation()?e.autoCall()?E(t):e.activeModalities.audio()?w(t):t.skypeCore.placeCall(r,n,T()):t.skypeCore.placeCall(r,n,T())})},this.acknowledge=function(){return f.createPlugin().then(function(t){u.log("[PluginCallHandler:acknowledge]");if(e.selfParticipant.audio.state()===o.callConnectionState.Notified)u.log("[PluginCallHandler:acknowledge] state is Notified, do not pass payload to plugin"),e._callData.markAllIncomingPayloadsAsProcessed();else if(e._callData.pluginRingingForMe())u.log("[PluginCallHandler:acknowledge] plugin already ringing, updating state to Notified"),e._callData.pluginRingingForMe(!1),l.updateParticipantAudioVideoState(e.selfParticipant,o.callConnectionState.Notified),e._callData.markAllIncomingPayloadsAsProcessed();else if(e.selfParticipant.audio.state()===o.callConnectionState.Disconnected){var n=B();u.log("[PluginCallHandler:acknowledge] processing incoming call"),e._callData.getUnprocessedIncomingCallPayloads().forEach(function(e){u.log("[awaitCall] payload: ",e),t.skypeCore.awaitCall(e.evt,n,e.convoCallId,e.nsp,e.body.gp)}),e._callData.pluginAwaitCall(!0)}})},this.setSoundLevelEventMode=function(e){function n(n){return n.skypeCore.setSoundLevelEventMode(e,t.resolve.bind(t),t.reject.bind(t)),t.promise}function r(e){return I(e),t.reject(),t.promise}var t=a.task();return f.createPlugin().then(n,r)},this.acceptCall=function(e){return e&&S(),f.createPlugin().then(function(e){var t=B();e.skypeCore.acceptCall(t,T())})},this.rejectCall=function(){g(p);var e=B();return f.createPlugin().then(function(t){t.skypeCore.rejectCall(e),m(o.callDisconnectionReason.Busy)}).catch(m.bind(null,o.callDisconnectionReason.Busy))},this.extendCall=function(e){return f.createPlugin().then(function(t){t.skypeCore.extendCall(e)})},this.endCall=function(){function t(e){e.skypeCore.concludeCall(),m()}g(p);var e=f.createPlugin().then(t).catch(m);return e},this.cancelCall=function(){g(p);var t=a.task();return f.createPlugin().then(function(n){return n.skypeCore.forgetCall(e._callData.getFirstPayload().convoCallId,t.resolve.bind(t),t.reject.bind(t)),t.promise})},this.mute=function(){return k(!0)},this.unmute=function(){return k(!1)},this.sendDtmf=function(e){var t=a.task();return f.createPlugin().then(function(n){return n.skypeCore.sendDtmf(e,t.resolve.bind(t)),t.promise})},this.startParticipantVideo=function(e,t){return L(e)?O(t):Promise.resolve(!0)},this.stopParticipantVideo=function(e,t){return L(e)?M(t):H(e,t)},this.attachParticipantVideo=function(e,t,n){L(e)?_(t):P(e,t,n)},this.detachParticipantVideo=function(e,t){L(e)?D():H(e,t)},this.getMonitorList=function(){return new Promise(function(e,t){function n(n){n.skypeCore.getMonitorList(e,t)}function r(e){I(e),t(e)}f.createPlugin().then(n,r)})},this.setScreenCaptureMonitor=function(e){return new Promise(function(t,n){function r(r){r.skypeCore.setScreenCaptureMonitor(e,t,n)}function i(e){I(e),n(e)}f.createPlugin().then(r,i)})},this.requestCallInfo=function(){var t=a.task(),n=e._callData.oncePluginCallInfoReady(function(){c.clearTimeout(r),t.resolve(e._callData.pluginCallInfo())}),r=c.setTimeout(function(){n.dispose(),t.reject("Call info request timeout")},5e3);return f.createPlugin().then(function(e){e.skypeCore.requestCallInfo(null,function(){n.dispose(),c.clearTimeout(r),t.reject("Failed to send command to plugin")})}),t.promise},this.dispose=function(){var n=F();t.canToggleMute(!1),t.toggleMuteTask=null,g(p),g(d),g(h),x(),n||f.dispose(!1),e.mediaConnectionType(o.mediaConnectionType.Unknown)}}var n=e("jSkype/settings"),r=e("constants/common"),i=e("constants/calling"),s=e("jSkype/utils/chat/conversation"),o=e("swx-enums"),u=e("jSkype/telemetry/logging/callingLogTracer").get(),a=e("jcafe-property-model"),f=e("jSkype/services/plugin/pluginLifecycleFacade"),l=e("jSkype/modelHelpers/participantHelper"),c=e("browser/window");t.initialize=function(){if(!n.isFeatureOn(r.featureFlags.PRELOAD_PLUGIN))return;return f.initialize()},t.build=function(e){return new h(e)}}),function(e,t){var n=e;n.version="0.9.6",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(e,r){var s=n.util.parseUri(e),o,u,a;return t&&t.location&&(s.protocol=s.protocol||t.location.protocol.slice(0,-1),s.host=s.host||(t.document?t.document.domain:t.location.hostname),s.port=s.port||t.location.port),o=n.util.uniqueUri(s),a={host:s.host,secure:"https"==s.protocol,port:s.port||("https"==s.protocol?443:80),query:s.query||""},n.util.merge(a,r),(a["force new connection"]||!n.sockets[o])&&(u=new n.Socket(a)),!a["force new connection"]&&u&&(n.sockets[o]=u),u=u||n.sockets[o],u.of(s.path.length>1?s.path:"")}}("object"==typeof module?module.exports:this.io={},this),function(e,t){var n=e.util={},r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],s;n.parseUri=function(e){for(var t=r.exec(e||""),n={},s=14;s--;)n[i[s]]=t[s]||"";return n},n.uniqueUri=function(e){var n=e.protocol,r=e.host,i=e.port;return"document"in t?(r=r||document.domain,i=i||(n=="https"&&document.location.protocol!=="https:"?443:document.location.port)):(r=r||"localhost",i||n!="https"||(i=443)),(n||"http")+"://"+r+":"+(i||80)},n.query=function(e,t){var r=n.chunkQuery(e||""),i=[],s;n.merge(r,n.chunkQuery(t||""));for(s in r)r.hasOwnProperty(s)&&i.push(s+"="+r[s]);return i.length?"?"+i.join("&"):""},n.chunkQuery=function(e){for(var t={},n=e.split("&"),r=0,i=n.length,s;r<i;++r)s=n[r].split("="),s[0]&&(t[s[0]]=s[1]);return t},s=!1,n.load=function(e){if("document"in t&&document.readyState==="complete"||s)return e();n.on(t,"load",e,!1)},n.on=function(e,t,n,r){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,r)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}return null},"undefined"!=typeof window&&n.load(function(){s=!0}),n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts)return e();n.load(function(){setTimeout(e,100)})},n.merge=function(e,t,r,i){var s=i||[],o=typeof r=="undefined"?2:r;for(var u in t)t.hasOwnProperty(u)&&n.indexOf(s,u)<0&&(typeof e[u]=="object"&&o?n.merge(e[u],t[u],o-1,s):(e[u]=t[u],s.push(t[u])));return e},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},n.intersect=function(e,t){for(var r=[],i=e.length>t.length?e:t,s=e.length>t.length?t:e,o=0,u=s.length;o<u;o++)~n.indexOf(i,s[o])&&r.push(s[o]);return r},n.indexOf=function(e,t,n){for(var r=e.length,n=n<0?n+r<0?0:n+r:n||0;n<r&&e[n]!==t;n++);return r<=n?-1:n},n.toArray=function(e){for(var t=[],n=0,r=e.length;n<r;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(t){return!1}return e.withCredentials!=undefined}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function n(){r.removeListener(e,n),t.apply(this,arguments)}var r=this;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,n){var r,i,s,o;if(this.$events&&this.$events[e])if(r=this.$events[e],t.util.isArray(r)){for(i=-1,s=0,o=r.length;s<o;s++)if(r[s]===n||r[s].listener&&r[s].listener===n){i=s;break}if(i<0)return this;r.splice(i,1),r.length||delete this.$events[e]}else(r===n||r.listener&&r.listener===n)&&delete this.$events[e];return this},n.prototype.removeAllListeners=function(e){return this.$events&&this.$events[e]&&(this.$events[e]=null),this},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){var n,r,i,s,o;if(!this.$events||(n=this.$events[e],!n))return!1;if(r=Array.prototype.slice.call(arguments,1),"function"==typeof n)n.apply(this,r);else{if(!t.util.isArray(n))return!1;for(i=n.slice(),s=0,o=i.length;s<o;s++)i[s].apply(this,r)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(n,t){function u(e){return e<10?"0"+e:e}function l(e){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+u(e.getUTCMonth()+1)+"-"+u(e.getUTCDate())+"T"+u(e.getUTCHours())+":"+u(e.getUTCMinutes())+":"+u(e.getUTCSeconds())+"Z":null}function c(e){return h.lastIndex=0,h.test(e)?'"'+e.replace(h,function(e){var t=a[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function e(t,n){var s,o,u,a,h=i,p,d=n[t];d instanceof Date&&(d=l(t)),typeof r=="function"&&(d=r.call(n,t,d));switch(typeof d){case"string":return c(d);case"number":return isFinite(d)?String(d):"null";case"boolean":case"null":return String(d);case"object":if(!d)return"null";if(i+=f,p=[],Object.prototype.toString.apply(d)==="[object Array]"){for(a=d.length,s=0;s<a;s+=1)p[s]=e(s,d)||"null";return u=p.length===0?"[]":i?"[\n"+i+p.join(",\n"+i)+"\n"+h+"]":"["+p.join(",")+"]",i=h,u}if(r&&typeof r=="object")for(a=r.length,s=0;s<a;s+=1)typeof r[s]=="string"&&(o=r[s],u=e(o,d),u&&p.push(c(o)+(i?": ":":")+u));else for(o in d)Object.prototype.hasOwnProperty.call(d,o)&&(u=e(o,d),u&&p.push(c(o)+(i?": ":":")+u));return u=p.length===0?"{}":i?"{\n"+i+p.join(",\n"+i)+"\n"+h+"}":"{"+p.join(",")+"}",i=h,u}}var o;if(t&&t.parse)return n.JSON={parse:t.parse,stringify:t.stringify};o=n.JSON={};var s=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i,f,a={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},r;o.stringify=function(t,n,s){var o;if(i="",f="",typeof s=="number")for(o=0;o<s;o+=1)f+=" ";else typeof s=="string"&&(f=s);if(r=n,!n||typeof n=="function"||typeof n=="object"&&typeof n.length=="number")return e("",{"":t});throw new Error("JSON.stringify")},o.parse=function(n,t){function r(e,n){var i,s,o=e[n];if(o&&typeof o=="object")for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(s=r(o,i),s!==undefined?o[i]=s:delete o[i]);return t.call(e,n,o)}var i;if(n=String(n),s.lastIndex=0,s.test(n)&&(n=n.replace(s,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(n.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return i=eval("("+n+")"),typeof t=="function"?r({"":i},""):i;throw new SyntaxError("JSON.parse")}}("undefined"!=typeof io?io:module.exports,typeof JSON!="undefined"?JSON:undefined),function(e,t){var n=e.parser={},r=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=n.reasons=["transport not supported","client not handshaken","unauthorized"],s=n.advice=["reconnect"],o=t.JSON,u=t.util.indexOf,a;n.encodePacket=function(e){var t=u(r,e.type),n=e.id||"",a=e.endpoint||"",l=e.ack,c=null,h,p,d,v;switch(e.type){case"error":h=e.reason?u(i,e.reason):"",p=e.advice?u(s,e.advice):"",(h!==""||p!=="")&&(c=h+(p!==""?"+"+p:""));break;case"message":e.data!==""&&(c=e.data);break;case"event":d={name:e.name},e.args&&e.args.length&&(d.args=e.args),c=o.stringify(d);break;case"json":c=o.stringify(e.data);break;case"connect":e.qs&&(c=e.qs);break;case"ack":c=e.ackId+(e.args&&e.args.length?"+"+o.stringify(e.args):"")}return v=[t,n+(l=="data"?"+":""),a],c!==null&&c!==undefined&&v.push(c),v.join(":")},n.encodePayload=function(e){var t="",n,r,i;if(e.length==1)return e[0];for(n=0,r=e.length;n<r;n++)i=e[n],t+="�"+i.length+"�"+e[n];return t},a=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/,n.decodePacket=function(e){var t=e.match(a),n;if(!t)return{};var u=t[2]||"",e=t[5]||"",l={type:r[t[1]],endpoint:t[4]||""};u&&(l.id=u,l.ack=t[3]?"data":!0);switch(l.type){case"error":t=e.split("+"),l.reason=i[t[0]]||"",l.advice=s[t[1]]||"";break;case"message":l.data=e||"";break;case"event":try{n=o.parse(e),l.name=n.name,l.args=n.args}catch(c){}l.args=l.args||[];break;case"json":try{l.data=o.parse(e)}catch(c){}break;case"connect":l.qs=e||"";break;case"ack":if(t=e.match(/^([0-9]+)(\+)?(.*)/),t&&(l.ackId=t[1],l.args=[],t[3]))try{l.args=t[3]?o.parse(t[3]):[]}catch(c){}}return l},n.decodePayload=function(e){var t,r,i;if(e.charAt(0)=="�"){for(t=[],r=1,i="";r<e.length;r++)e.charAt(r)=="�"?(t.push(n.decodePacket(e.substr(r+1).substr(0,i))),r+=Number(i)+1,i=""):i+=e.charAt(r);return t}return[n.decodePacket(e)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.onData=function(e){var n,r,i;if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),e!==""&&(n=t.parser.decodePayload(e),n&&n.length))for(r=0,i=n.length;r<i;r++)this.onPacket(n[r]);return this},n.prototype.onPacket=function(e){return(this.socket.setHeartbeatTimeout(),e.type=="heartbeat")?this.onHeartbeat():(e.type=="connect"&&e.endpoint==""&&this.onConnect(),e.type=="error"&&e.advice=="reconnect"&&(this.open=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.close&&this.open&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.open=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){var e=this;this.open=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)},n.prototype.clearEventHandlers=function(){return this}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function r(e){if(this.options={port:80,secure:!1,document:"document"in n?document:!1,resource:"socket.io",transports:t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var r=this;t.util.on(n,"unload",function(){r.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function i(){}e.Socket=r,t.util.mixin(r,t.EventEmitter),r.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),e!==""&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},r.prototype.publish=function(){var e,t;this.emit.apply(this,arguments);for(t in this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t),e.$emit.apply(e,arguments))},r.prototype.handshake=function(e){function n(t){t instanceof Error?r.onError(t.message):e.apply(null,t.split(":"))}var r=this,s=this.options,o=["http"+(s.secure?"s":"")+":/",s.host+":"+s.port,s.resource,t.protocol,t.util.query(this.options.query,"t="+ +(new Date))].join("/"),a,f,l;this.isXDomain()&&!t.util.ua.hasCORS?(a=document.getElementsByTagName("script")[0],f=document.createElement("script"),f.src=o+"&jsonp="+t.j.length,a.parentNode.insertBefore(f,a),t.j.push(function(e){n(e),f.parentNode.removeChild(f)})):(l=t.util.request(),l.open("GET",o,!0),l.withCredentials=!0,l.onreadystatechange=function(){l.readyState==4&&(l.onreadystatechange=i,l.status==200?n(l.responseText):r.reconnecting||r.onError(l.responseText))},l.send(null))},r.prototype.getTransport=function(e){for(var n=e||this.transports,r=0,i;i=n[r];r++)if(t.Transport[i]&&t.Transport[i].check(this)&&(!this.isXDomain()||t.Transport[i].xdomainCheck()))return new t.Transport[i](this,this.sessionid);return null},r.prototype.connect=function(e){if(this.connecting)return this;var n=this;return this.handshake(function(r,i,s,o){function u(e){if(n.transport&&(n.transport.clearTimeouts(),n.transport.clearEventHandlers()),n.transport=n.getTransport(e),!n.transport)return n.publish("connect_failed");n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){if(!n.connected&&(n.connecting=!1,n.options["try multiple transports"])){n.remainingTransports||(n.remainingTransports=n.transports.slice(0));for(var e=n.remainingTransports;e.length>0&&e.splice(0,1)[0]!=n.transport.name;);e.length?u(e):n.publish("connect_failed")}},n.options["connect timeout"]))})}n.sessionid=r,n.closeTimeout=s*1e3,n.heartbeatTimeout=i*1e3,n.transports=o?t.util.intersect(o.split(","),n.options.transports):n.options.transports,n.setHeartbeatTimeout(),u(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&typeof e=="function"&&e()})}),this},r.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)},r.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},r.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},r.prototype.disconnect=function(){if(this.connected||this.connecting)this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted");return this},r.prototype.disconnectSync=function(){var e=t.util.request(),n=this.resource+"/"+t.protocol+"/"+this.sessionid;e.open("GET",n,!0),this.onDisconnect("booted")},r.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},r.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},r.prototype.onOpen=function(){this.open=!0},r.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},r.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},r.prototype.onError=function(e){e&&e.advice&&e.advice==="reconnect"&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},r.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||n)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},r.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces)n.namespaces.hasOwnProperty(e)&&""!==e&&n.namespaces[e].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",t),n.removeListener("connect",t),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=i}function t(){if(n.reconnecting){if(n.connected)return e();if(n.connecting&&n.reconnecting)return n.reconnectionTimer=setTimeout(t,1e3);n.reconnectionAttempts++>=r?n.redoTransports?(n.publish("reconnect_failed"),e()):(n.on("connect_failed",t),n.options["try multiple transports"]=!0,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(n.reconnectionDelay<s&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(t,n.reconnectionDelay))}}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,r=this.options["max reconnection attempts"],i=this.options["try multiple transports"],s=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new r(this,"json"),this.ackPackets=0,this.acks={}}function r(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],r={type:"event",name:e};return"function"==typeof n&&(r.id=++this.ackPackets,r.ack="data",this.acks[r.id]=n,t=t.slice(0,t.length-1)),r.args=t,this.packet(r)},n.prototype.disconnect=function(){return this.name===""?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function n(){r.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var r=this,i;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":this.name===""?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":i=["message",e.data],e.ack=="data"?i.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,i);break;case"event":i=[e.name].concat(e.args),e.ack=="data"&&i.push(n),this.$emit.apply(this,i);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):e.reason=="unauthorized"?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},r.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},r.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function r(){t.Transport.apply(this,arguments)}function i(){}e.websocket=r,t.util.inherit(r,t.Transport),r.prototype.name="websocket",r.prototype.open=function(){var e=t.util.query(this.socket.options.query),r=this,i;return i||(i=n.MozWebSocket||n.WebSocket),this.websocket=new i(this.prepareUrl()+e),this.websocket.onopen=function(){r.onOpen(),r.socket.setBuffer(!1)},this.websocket.onmessage=function(e){r.onData(e.data)},this.websocket.onclose=function(){r.onClose(),r.socket.setBuffer(!0)},this.websocket.onerror=function(e){r.onError(e)},this},r.prototype.send=function(e){return this.websocket.send(e),this},r.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},r.prototype.close=function(){return this.websocket.close(),this},r.prototype.onError=function(e){this.socket.onError(e)},r.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},r.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},r.xdomainCheck=function(){return!0},r.prototype.clearEventHandlers=function(){return this.websocket&&(this.websocket.onopen=this.websocket.onmessage=this.websocket.onclose=this.websocket.onerror=i),this},t.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t,n){function r(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function i(){}e.XHR=r,t.util.inherit(r,t.Transport),r.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},r.prototype.payload=function(e){for(var n=[],r=0,i=e.length;r<i;r++)n.push(t.parser.encodePacket(e[r]));this.send(t.parser.encodePayload(n))},r.prototype.send=function(e){return this.post(e),this},r.prototype.post=function(e){function t(){this.readyState==4&&(this.onreadystatechange=i,s.posting=!1,this.status==200?s.socket.setBuffer(!1):s.onClose())}function r(){this.onload=i,s.socket.setBuffer(!1)}var s=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=r:this.sendXHR.onreadystatechange=t,this.sendXHR.send(e)},r.prototype.close=function(){return this.onClose(),this},r.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),r=t.util.query(this.socket.options.query,"t="+ +(new Date));if(n.open(e||"GET",this.prepareUrl()+r,!0),e=="POST")try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(i){}return n},r.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},r.check=function(e,r){try{var i=t.util.request(r),s=n.XDomainRequest&&i instanceof XDomainRequest,o=e&&e.options&&e.options.secure?"https:":"http:",u=o!=n.location.protocol;if(i&&(!s||!u))return!0}catch(a){}return!1},r.xdomainCheck=function(){return r.check(null,!0)},r.prototype.clearEventHandlers=function(){return this.sendXHR&&(this.sendXHR.onreadystatechange=this.sendXHR.onload=i),this}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t,n){function r(){t.Transport.XHR.apply(this,arguments)}function i(){}e["xhr-polling"]=r,t.util.inherit(r,t.Transport.XHR),t.util.merge(r,t.Transport.XHR),r.prototype.name="xhr-polling",r.prototype.open=function(){var e=this;return t.Transport.XHR.prototype.open.call(e),!1},r.prototype.get=function(){function e(){this.readyState==4&&((this.onreadystatechange=i,this.status==200)?(s.onData(this.responseText),s.get()):s.onClose())}function t(){this.onload=i,this.onerror=i,s.onData(this.responseText),s.get()}function r(){s.onClose()}if(this.open){var s=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=t,this.xhr.onerror=r):this.xhr.onreadystatechange=e,this.xhr.send(null)}},r.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(e){}this.xhr=null}},r.prototype.ready=function(e,n){var r=this;t.util.defer(function(){n.call(r)})},r.prototype.clearEventHandlers=function(){return t.Transport.XHR.prototype.clearEventHandlers.call(this),this.xhr&&(this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i),this},t.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t,n){function r(){t.Transport["xhr-polling"].apply(this,arguments),this.index=t.j.length;var e=this;t.j.push(function(t){e._(t)})}var i=n.document&&"MozAppearance"in n.document.documentElement.style;e["jsonp-polling"]=r,t.util.inherit(r,t.Transport["xhr-polling"]),r.prototype.name="jsonp-polling",r.prototype.post=function(e){function n(){r(),i.socket.setBuffer(!1)}function r(){i.iframe&&i.form.removeChild(i.iframe);try{f=document.createElement('<iframe name="'+i.iframeId+'">')}catch(e){f=document.createElement("iframe"),f.name=i.iframeId}f.id=i.iframeId,i.form.appendChild(f),i.iframe=f}var i=this,s=t.util.query(this.socket.options.query,"t="+ +(new Date)+"&i="+this.index);if(!this.form){var o=document.createElement("form"),u=document.createElement("textarea"),a=this.iframeId="socketio_iframe_"+this.index,f;o.className="socketio",o.style.position="absolute",o.style.top="0px",o.style.left="0px",o.style.display="none",o.target=a,o.method="POST",o.setAttribute("accept-charset","utf-8"),u.name="d",o.appendChild(u),document.body.appendChild(o),this.form=o,this.area=u}this.form.action=this.prepareUrl()+s,r(),this.area.value=t.JSON.stringify(e);try{this.form.submit()}catch(l){}this.iframe.attachEvent?f.onreadystatechange=function(){i.iframe.readyState=="complete"&&n()}:this.iframe.onload=n,this.socket.setBuffer(!0)},r.prototype.get=function(){var e=this,n=document.createElement("script"),r=t.util.query(this.socket.options.query,"t="+ +(new Date)+"&i="+this.index),s;this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),n.async=!0,n.src=this.prepareUrl()+r,n.onerror=function(){e.onClose()},s=document.getElementsByTagName("script")[0],s.parentNode.insertBefore(n,s),this.script=n,i&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},r.prototype._=function(e){return this.onData(e),this.open&&this.get(),this},r.prototype.ready=function(e,n){var r=this;if(!i)return n.call(this);t.util.load(function(){n.call(r)})},r.check=function(){return"document"in n},r.xdomainCheck=function(){return!0},r.prototype.clearEventHandlers=function(){return t.Transport["xhr-polling"].prototype.clearEventHandlers.call(this),this.script&&(this.script.onerror=function(){}),this},t.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(){function e(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t+"="+e[t]);return n.join("&")}function t(e){for(var t={},n=["name","message","description","number","fileName","lineNumber","stack"],r,i=0;i<n.length;i++)r=n[i],r in e&&(t[r]=e[r]);return JSON.stringify(t)}function n(e){return typeof e=="string"?e:""}function r(){}var i="v2",s={},o="2015.11.05",u=55;s.createServer=function(s,a){function l(e,t){var n={level:e,message:t,connectionId:U,connectedClientId:M?M.ccid:""};$.log(JSON.stringify(n))}function c(e,t){return t||(t=e.indexOf("?")!==-1?"&":"?"),e.indexOf("ccid=")<0?e+t+"ccid="+q+(R?"&dom="+R:""):e+(R?t+"dom="+R:"")}function h(e){var t=e.lastIndexOf("/a");return e.substring(0,t)+"/h"}function p(){return O.xhr?O.xhr:K?XMLHttpRequest:window.XDomainRequest||XMLHttpRequest}function d(e,n,r,i){try{var s=p(),o=new s;O.xhr||XMLHttpRequest&&o instanceof XMLHttpRequest?o.onreadystatechange=function(){o.readyState===4&&(o.status>=200&&o.status<300?r(o.responseText):(Y.error("HTTP status "+o.status+" "+o.statusText+" in post to "+e+": "+o.responseText),i()))}:(o.onload=function(){var t=/^([0-9]{3}).*/g.exec(o.responseText),n=t?t[1]:200;n>=200&&n<300?r(o.responseText):(Y.error("HTTP status "+n+" in post to "+e+": "+o.responseText),i())},o.onerror=i),o.open("POST",e,!0),o.setRequestHeader&&(o.setRequestHeader("Content-Type","text/plain"),O.userAgent&&o.setRequestHeader("User-Agent",O.userAgent)),typeof window!="undefined"&&window&&window.XDomainRequest&&o instanceof window.XDomainRequest?(o.onprogress=function(){},o.ontimeout=function(){},setTimeout(function(){try{o.send(n)}catch(r){Y.error("Exception in post to "+e+": "+t(r)),i()}},0)):o.send(n)}catch(u){Y.error("Exception in post to "+e+": "+t(u)),i()}}function v(e){var t=1+(Math.random()-.5)*.4,n=1e3*Math.pow(2,e)*t;return n=Math.round(n),Math.min(12e4,n)}function m(e,n,r){function i(n){try{clearTimeout(f),f=null,a||(Y.debug("done: "+e),r(n))}catch(i){Y.error("exception in done: "+t(i))}}function s(){try{a||(Y.debug("go: "+e),d(e,n,i,o))}catch(r){Y.error("exception in go: "+t(r))}}function o(){try{Y.error("error for: "+e),a||(f=setTimeout(s,v(u)),u++)}catch(n){Y.error("exception in errorHandler: "+t(n))}}var u=0,a=!1,f;return s(),function(){a=!0,f&&(Y.debug("stop: "+e),clearTimeout(f))}}function g(e){A.url=e,A.urlPath=e.replace(/https?:\/\/([A-z0-9\:\$\-\_\.\+\!\*\'\(\)\,]*)\//,"/")}function y(e){try{var n=null;if(e)if(e.issuer)if(e.se)if(e.sp)if(e.sr)if(e.sig)if(P)n="server closed";else if(_)n="already have authorization data";else try{Y.debug("got authorization: "+JSON.stringify(e))}catch(r){n="unable to parse authorization data, error: "+t(r)}else n="Invalid authz data: missing sig";else n="Invalid authz data: missing sr";else n="Invalid authz data: missing sp";else n="Invalid authz data: missing se";else n="Invalid authz data: missing issuer";else n="received null authorization data";n?Y.error(n):(_=e,k())}catch(i){Y.error("exception in authorized: "+t(i))}}function b(e){try{M=JSON.parse(e),U=M.id||"",M.healthUrl?j=M.healthUrl:(j=h(B),Y.warn("No healthUrl property found when parsing allocation.")),!q&&M.ccid&&(q=M.ccid,B=c(B),j=c(j),Y.debug("connected client id set{connectedClientId:"+q+"}")),$.auth(M.connId,y)}catch(n){Y.error("authorization error: "+t(n))}}function w(){Y.debug("allocating new connection"),_=undefined,F(),F=m(B,"",b)}function E(){Y.debug("reconnectToOldServer"),H=!1,I(),I=m(j,"",function(){P||(Y.debug("reconnecting with old allocation"),k())})}function S(e,n){try{if(n&&n.socketNumber!==z){Y.debug("not reconnecting on an old socket");return}if(P){$.disconnected();return}e&&Y.debug("Last connection failed, reason: "+e),J.reconnectAttempts++,$.reconnecting(),P||(H?E():w())}catch(r){Y.error("exception in maybeReconnect: "+t(r))}}function x(){if(D)try{D.emit("ping",function(){})}catch(e){Y.error("unable to send ping, error: "+t(e))}}function T(){N(),D&&W==="websocket"&&(X=setInterval(x,u*1e3))}function N(){X&&(clearInterval(X),X=null)}function C(){V&&(clearTimeout(V),V=null)}function k(){var n=O.ioOptions||{},r,s=!1;n["force new connection"]=!0,n.reconnect=!1,_.r=M.instance,_.v=i,_.p=M.instancePort,n.query=c(e(_),"&"),n.requireMtls===!0&&(r=n.query.indexOf("&")!==-1?"&":"?",n.query+=r+"auth=true"),r=n.query.indexOf("&")!==-1?"&":"?",n.query+=r+"tc="+encodeURI(JSON.stringify(G)),n.query+="&timeout="+u,Y.debug("connecting to "+M.socketio+"?"+n.query),L(),C(),V=setTimeout(function(){s?Y.debug("reconnecting preempted while connecting"):S()},12e4),D=(O.io||io).connect(M.socketio,n),D.socketNumber=++z,D.on("connect",function(){s=!1;try{C();var e,n;if(P){D&&D.disconnect();return}e=M.url,n=A.url!==e,H=!0,Y.debug("connected: "+e),g(e),T(),$.ready(e,n)}catch(r){Y.error("exception in socket.on connect: "+t(r))}}),D.on("connecting",function(e){s=!0,Y.debug("connecting using transportType: "+e),W=e}),D.on("connect_failed",function(e){s=!1,N(),C(),Y.debug("connect_failed"),S(e,this)}),D.on("disconnect",function(){s=!1,N(),C(),Y.debug("disconnected"),S(null,this)}),D.on("reconnect",function(){s=!1,T(),Y.debug("reconnect")}),D.on("reconnect_failed",function(e){s=!1,N(),C(),Y.debug("reconnect_failed"),S(e,this)}),D.on("reconnecting",function(){s=!0,N(),Y.debug("reconnecting")}),D.on("error",function(e){var t,n;N(),Y.error("error from socket.io: "+e),t=this,s?Y.debug("reconnecting preempted while connecting"):(n=v(J.reconnectAttempts),Y.debug("Reconnect in "+n+" msecs..."),C(),V=setTimeout(function(){S(e,t)},n))}),D.on("message",function(e){try{var n=null,r,i,s=new Date;try{e=JSON.parse(e)}catch(o){Y.error("unable to parse request, error: "+t(o)+", request:"+e)}e.url&&e.url.indexOf(A.urlPath)===0&&(e.shortUrl="/"+e.url.substring(A.urlPath.length)),Y.debug("request: "+JSON.stringify(e)),e.on=function(t,r){t==="data"?n=r:t==="end"&&(n(e.body),r())},r={id:e.id,status:200,headers:{},body:""},i={writeHead:function(e,t){r.status=e,r.headers=t},write:function(e){r.body+=e},end:function(n){if(n&&(r.body+=n),r.headers=r.headers||{},e.headers&&e.headers["trouter-request"]&&!r.headers["trouter-request"]&&(r.headers["trouter-request"]=e.headers["trouter-request"]),r.headers["trouter-client"]=JSON.stringify({cd:new Date-s}),Y.debug("response: "+JSON.stringify(r)),D)try{D.send(JSON.stringify(r))}catch(i){Y.error("unable to send data on response.end, err: "+t(i))}}},$.request(e,i)}catch(u){Y.error("exception in socket.on message: "+t(u))}})}function L(){if(D){for(var e=0;e<Q.length;e++)D.removeAllListeners(Q[e]);try{D.disconnect(),Y.debug("cleared previous socket"),D=null,W=undefined}catch(n){Y.error("exception in disconnecting previous socket: "+t(n))}}}var A={},O=a||{},M,_,D,P=!0,H=!1,B,j,F=r,I=r,q="",R="",U="",z=0,W,X=null,V=null,$={auth:r,ready:r,request:r,disconnected:r,reconnecting:r,log:r},J={reconnectAttempts:0},K=function(){if(O.xhr)return!1;var e=new XMLHttpRequest;return"withCredentials"in e?!0:!1}(),Q=["connecting","connect_failed","disconnect","reconnect","reconnect_failed","reconnecting","error","message"],G={cv:o},Y;return O&&O.clientInfo&&(G.hr=n(O.clientInfo.hr),G.ua=n(O.clientInfo.ua),G.v=n(O.clientInfo.v)),typeof window!="undefined"&&window.location&&(R=window.location.hostname),Y={debug:function(e){l("debug",e)},warn:function(e){l("warn",e)},error:function(e){l("error",e)}},typeof s=="function"&&($.request=s),A.on=function(e,t){return $[e]||Y.warn("assigning a callback that is not used: "+e),$[e]=t,A},A.close=function(){try{P=!0,D&&(D.disconnect(),D=undefined),C(),F(),I(),M=undefined,B=undefined,_=undefined,W=undefined}catch(e){Y.error("exception in close: "+t(e))}},A.open=function(e){try{return B?(Y.error("server.open failed, already open"),null):e?(P=!1,B=e,J.reconnectAttempts=0,w(),A):(Y.error("server.open failed, invalid trouterUrl: "+e),null)}catch(n){return Y.error("exception in open: "+t(n)),null}},A.getServerState=function(){return{connectionId:U,connectedClientId:q,domId:R,url:M?M.url:"",surl:M?M.surl:""}},A},(typeof exports!="undefined"?exports:window).trouter=s}(),define("trouter-client/lib/trouterclient",function(){}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("trouter-client/lib/index",["require","exports","./trouterclient"],e)}(function(e){return e("./trouterclient"),function(){return this.trouter}.call()}),define("trouter-client",["trouter-client/lib/index"],function(e){return e}),define("jSkype/services/trouter/requestBuilder",["require","jSkype/client","jSkype/settings","jSkype/services/serviceAccessLayer/requestDispatcher","jSkype/services/clientInfo","jSkype/services/electron","browser/detect","jSkype/services/serviceAccessLayer/transientFaultPolicy","jSkype/services/serviceAccessLayer/decorations/retry","constants/common","jcafe-property-model"],function(e){function c(){return n.isFeatureOn(f.featureFlags.NG_CALLING)?n.settings.incomingCalls.pnhNGCTemplate:n.settings.incomingCalls.pnhTemplate}function h(e,t,r){return{clientDescription:{appId:n.settings.incomingCalls.pnhAppId,aesKey:"",languageId:"en-US",platform:o.getBrowserInfo().browserName,templateKey:c(),platformUIVersion:i.getBIVersion()},registrationId:r,nodeId:"",transports:{TROUTER:[{context:"",path:e,ttl:t}]}}}function p(e,t,n){var r=l.task(),i=h(e,t,n);return v().then(function(e){e.payload=JSON.stringify(i),e.reporting={serviceName:"registrar"},r.resolve(e)}),r.promise}function d(e){var t=l.task(),n={sr:e};return v().then(function(e){e.payload=JSON.stringify(n),e.reporting={serviceName:"authenticateUrl"},t.resolve(e)}),t.promise}function v(){var e=l.task();return t.get().signInManager._skypeToken().then(function(t){var n={headers:{"X-Skypetoken":t},retry:{strategy:a.STRATEGIES.EXPONENTIAL,delay:2e3,isTransientCheck:u.isTransientFailure}};e.resolve(n)}),e.promise}function m(){return o.getBrowserInfo().isElectron}var t=e("jSkype/client"),n=e("jSkype/settings"),r=e("jSkype/services/serviceAccessLayer/requestDispatcher"),i=e("jSkype/services/clientInfo"),s=e("jSkype/services/electron"),o=e("browser/detect"),u=e("jSkype/services/serviceAccessLayer/transientFaultPolicy"),a=e("jSkype/services/serviceAccessLayer/decorations/retry"),f=e("constants/common"),l=e("jcafe-property-model");return{authenticateUrl:function(t){var i=n.settings.incomingCalls.tpcServiceUrl;return d(t).then(function(e){return r.post(i,e)})},registerPresence:function(t,i,o){var u=n.settings.incomingCalls.registrarServiceUrl;if(m()){var a=h(t,i,o);return s.registerPresence(u,a)}return p(t,i,o).then(function(e){return r.post(u,e)})}}}),define("jSkype/services/trouter/registrar",["require","exports","module","browser/window","lodash-compat","swx-utils-common","jSkype/services/trouter/requestBuilder","jSkype/settings"],function(e,t){function u(e,t,u){function m(){return s.registerPresence(f,p,e).then(y,b)}function g(){return c=!0,m()}function y(e){var n=e.response;if(!a(n.status)){b(n);return}w(),t&&t(c)}function b(e){u&&u(e)}function w(){clearTimeout(l),h.duration()+d<v&&(l=r.delay(g,d))}function E(){n.clearTimeout(l)}var f,l,c=!1,h,p=o.settings.incomingCalls.registrarTtlInSeconds,d=o.settings.incomingCalls.registrarRefreshTimeoutInMs,v=o.settings.incomingCalls.maxRegistrationTimeInMs;return{registerPresence:function(e){return c=!1,f=e,h=i.build(),E(),m()}}}function a(e){return e===202||e===200}var n=e("browser/window"),r=e("lodash-compat"),i=e("swx-utils-common").stopwatch,s=e("jSkype/services/trouter/requestBuilder"),o=e("jSkype/settings");t.build=function(e,t,n){return new u(e,t,n)}}),define("jSkype/services/trouter/trouter",["require","jcafe-property-model","jSkype/client","swx-utils-common","trouter-client","jSkype/settings","jSkype/services/trouter/registrar","constants/common","jSkype/services/trouter/requestBuilder","lodash-compat"],function(e){function T(e){var t={},n=e?u.telemetry.trouter.RENEWAL:u.telemetry.trouter.NEW_CONNECTION;v&&(t.initToRegisteredTime=z(w),v=!1),q(n,t)}function N(){d=!1,q(u.telemetry.trouter.AUTHENTICATION_FAILED)}function C(){d=!1,q(u.telemetry.trouter.ENDPOINT_REGISTRATION_FAILED)}function k(e,t){var n={};I();if(t){var r=g.getServerState().surl;p=o.build(y,T,C),p.registerPresence(r),x(r)}n.isNewUrl=t,t?n.authenticatedToReadyTime=z(S):n.reconnectingToReadyTime=z(E),m&&(n.initToReadyTime=z(w),m=!1),q(u.telemetry.trouter.TROUTER_READY_EVENT,n)}function L(e,t){q(u.telemetry.trouter.TROUTER_AUTH_EVENT),a.authenticateUrl(e).then(function(e){q(u.telemetry.trouter.AUTHENTICATION_SUCCEEDED),S=U(),F(),t(e.response)},N)}function A(e,t){var n=D(e),r=M(n);_(t,r.resultCode)}function O(){E=U(),q(u.telemetry.trouter.TROUTER_RECONNECTING)}function M(e){var t;for(var n=0;n<h.length;n++){t=P(h[n],e);if(t.isHandled===!0)return t}return{isHandled:!1,resultCode:l}}function _(e,t){e.writeHead(t),e.end()}function D(e){var t=JSON.parse(e.body);return{eventId:t.evt?t.evt:null,url:e.url,body:t}}function P(e,t){try{return e.handleMessage(t)}catch(n){return{isHandled:!0,resultCode:c}}}function H(){if(d===!0)throw new Error("Trouter session already started. You are calling start twice");d=!0,v=!0,m=!0,w=U(),y=r.create(),g=i.createServer(null,{clientInfo:{ua:s.settings.productName,v:s.settings.version},ioOptions:{requireMtls:!0,"connect timeout":s.settings.incomingCalls.trouterConnectTimeoutInMs}}),g.on("ready",k),g.on("auth",L),g.on("request",A),g.on("reconnecting",O),g.open(s.settings.incomingCalls.trouterServiceUrl)}function B(){d=!1,g&&g.close()}function j(e){if(e===null)throw new Error("Cannot register a null handler.");if(!e.handleMessage)throw new Error("Cannot register a handler which does not conform to the API. Must have a handleMessage function");h.forEach(function(t){if(t===e)throw new Error("Registering the same handler twice is not allowed")}),h.push(e)}function F(){b=f.delay(q.bind(null,u.telemetry.trouter.TROUTER_READY_TIMEOUT),s.settings.incomingCalls.trouterReadyTimeoutInMs)}function I(){clearTimeout(b)}function q(e,t){var r={type:e,registrationId:y};g&&g.getServerState()&&(r.connectionId=g.getServerState().connectionId,r.connectedClientId=g.getServerState().connectedClientId),f.extend(r,t),n.get()._telemetryManager.sendEvent(s.settings.telemetry.jSkypeTenantToken,u.telemetry.trouter.TROUTER_INIT,r)}function R(){h=[]}function U(){return+(new Date)}function z(e){return parseInt((U()-e)/1e3,10)}var t=e("jcafe-property-model"),n=e("jSkype/client"),r=e("swx-utils-common").guid,i=e("trouter-client"),s=e("jSkype/settings"),o=e("jSkype/services/trouter/registrar"),u=e("constants/common"),a=e("jSkype/services/trouter/requestBuilder"),f=e("lodash-compat"),l=400,c=500,h=[],p,d=!1,v,m,g,y,b,w,E,S,x=t.property({value:null});return{start:H,stop:B,registerMessageHandler:j,clearMessageHandlers:R,trouterUrl:x}}),define("jSkype/services/NGCCallAgent/NGCCallAgent/constants",[],function(){return{CALL_STATUS:{IDLE:"Idle",RINGING:"Ringing",CONNECTING:"Connecting",CONNECTED:"Connected",CONNECTED_FOR_ROSTER_ONLY:"ConnectedForRosterOnly",LOCAL_TERMINATED:"LocalTerminated",REMOTE_TERMINATED:"RemoteTerminated"},MEDIA_TYPES:{AUDIO:"Audio",VIDEO:"Video",SCREEN_SHARER:"ScreenSharer",SCREEN_VIEWER:"ScreenViewer"},URL_BASE:{CALLAGENT:"callAgent"},URL_PATH:{MEDIA_ACKNOWLEDGEMENT:"/call/mediaAcknowledgement/",MEDIA_REJECTION:"/call/rejection/",ACKNOWLEDGEMENT:"/call/acknowledgement/",MEDIA_RENEGOTIATION:"/call/mediaRenegotiation/",TRANSFER:"/call/transfer/",REPLACE:"/call/replacement/",PROGRESS:"/call/progress/",MEDIA_ANSWER:"/call/mediaAnswer/",REDIRECTION:"/call/redirection/",ACCEPT:"/call/acceptance/",END:"/call/end/",P2P_FORK_NOTIFICATION:"/call/p2pForkNotification/",RETARGET_COMPLETION:"/call/retargetCompletion/",CONV_END:"/conversation/end/",CONV_UPDATE:"/conversation/update/",CONV_ROSTER_UPDATE:"/conversation/rosterUpdate/",CONV_ADD_PARTICIPANT_SUCCESS:"/conversation/addParticipantSuccess/",CONV_ADD_PARTICIPANT_FAILURE:"/conversation/addParticipantFailure/",CONV_REMOVE_PARTICIPANT_SUCCESS:"/conversation/removeParticipantSuccess/",CONV_REMOVE_PARTICIPANT_FAILURE:"/conversation/removeParticipantFailure/"},LINKS:{HANGUP:"hangup",MEDIA_REJECTION:"mediaRejection",MEDIA_ANSWER:"mediaAnswer",MEDIA_RENEGOTIATION:"mediaRenegotiation",ACCEPT:"accept",ATTACH:"attach",REJECT:"reject",REDIRECT:"redirect",REPLACE:"replace",TRANSFER:"transfer",CONVERSATION_CONTROLLER:"conversationController",ADD_PARTICIPANT_AND_MODALITY:"addParticipantAndModality",LEAVE:"leave",NOTIFICATION_LINKS:"notificationLinks",REMOVE_PARTICIPANT:"removeParticipant",KEEPALIVE:"keepAlive"},CONTENT_TYPE:{JSON:"application/json",SDP:"application/sdp"},TROUTER_EVENT_TYPE:{SKYPE_SKYPE_CALL:107,LYNC_SKYPE_CALL:105},MISC:{CONVERSATION:"conversation"},SIGNALING_FSM_STATE:{IDLE:"Idle",INCOMING:"Incoming",WAITING_CALL_ACCEPTANCE_ACK:"WaitingCallAcceptanceAck",OUTGOING:"Outgoing",CONNECTED:"Connected",OUTGOING_FOR_ROSTER_ONLY:"OutgoingForRosterOnly",CONNECTED_FOR_ROSTER_ONLY:"ConnectedForRosterOnly"},MEDIA_RENEGOTIATION_FSM_STATE:{IDLE:"Idle",CALL_CONNECTED:"Connected",INCOMING_RENEGOTIATION:"IncomingRenegotiation",OUTGOING_RENEGOTIATION:"OutgoingRenegotiation",RENEGOTIATION_GLARE:"RenegotiationGlare"},TIMEOUT_OPERATIONS:{ADD_PARTICIPANT:"AddParticipant",REMOVE_PARTICIPANT:"RemoveParticipant",INCOMING_CALL_ESTABLISHMENT:"IncomingCallEstablishment",OUTGOING_CALL_ESTABLISHMENT:"OutgoingCallEstablishment",MEDIA_ANSWER:"MediaAnswer",MEDIA_ANSWER_ACKNOWLEDGEMENT:"MediaAnswerAcknowledgement"},TIMEOUT_VALUES_IN_SECONDS:{ADD_PARTICIPANT_TIMEOUT:60,REMOVE_PARTICIPANT_TIMEOUT:60,INCOMING_CALL_ESTABLISHMENT_TIMEOUT:45,OUTGOING_CALL_ESTABLISHMENT_TIMEOUT:60,MEDIA_ANSWER_TIMEOUT:35,MEDIA_ANSWER_ACKNOWLEDGEMENT_TIMEOUT:15},CALL_END_CODE:{REJECT:603,SUCCESS:0,CANCEL:487,TIMEOUT:408,SERVICE_UNAVAILABLE:500,BAD_REQUEST:406,NO_NGC_ENDPOINT:480,P2P_FALLBACK_FOR_SCREENSHARING:460,CONFLICT:409,MEDIA_ERROR:410,CALL_DOES_NOT_EXIST:481,CALL_ACCEPTED:450,CALL_FORWARDED:451,CALL_FORWARDED_TO_VOICEMAIL:452,P2P_REJECT_CALL:453,P2P_FALLBACK_DUE_TO_GROUPCALL:461,CALL_LEG_ENDED_ON_SERVICE:470,NOT_ACCEPTABLE_HERE:488,NETWORK_ERROR:490,UNKNOWN_ERROR:497,LOCAL_ERROR:498,CALL_MODALITY_FAILURE:580,GLARE_ERROR:491},CALL_END_SUB_CODE:{SUCCESS:0,CALL_NOT_ATTEMPTED:4500,CONV_URL_NOT_SET:4501,FAILED_TO_REACH_SERVICE:4502,PLACE_CALL_FAILED:4503,ATTACH_CALL_FAILED:4504,BAD_NOTIFICATION_PAYLOAD:4505,CALL_ESTABLISHMENT_TIMEOUT:4506,CONVERSATION_RESOLUTION_CONFLICT:5704,CALL_PARTICIPANT_REMOVAL_TIMEOUT:4507,CONFLICT_IN_NG:4090,CONFLICT_WITH_P2P:4091,CONVERSATION_END_RECEIVED_FROM_SERVICE:4100,TRANSFER_COMPLETE_TIMEOUT:4101,ATTACH_TO_NON_EXISTENT_CALL:4102,ATTACH_ACTION_FAILED:4103,ATTACH_FAILED:4105,CONVERSATION_ESTABLISHMENT_FAILED:4106,BEFORE_CONNECT:4107,AFTER_CONNECT:4108,AFTER_ACCEPT:4109,TROUTER_CONNECTION_DROPPED:4111,DUE_TO_CALL_ASSIMILATION:4112,GLARE_ERROR:10029,MEDIA_DROP_DURING_CONNECT:3100,MEDIA_DROP_AFTER_CONNECT:3101,MEDIA_ANSWER_PROCESSING_ERROR:3102,MEDIA_FINAL_ANSWER_PROCESSING_ERROR:3103,MEDIA_OFFER_TIMEOUT:3104,MEDIA_FINAL_ANSWER_TIMEOUT:3105,MEDIA_OFFER_NULL:3106,MEDIA_AUDIO_DEVICE_ERROR:3107,MEDIA_RENEGOTIATION_ERROR:3108,MEDIA_PERMISSION_ERROR:3109,MEDIA_UNKNOWN_ERROR:3110},CALL_END_PHRASE:{UNKNOWN:"CallEndReasonUnknown",MEDIA_ERROR:"CallEndReasonMediaError",MEDIA_OFFER_TIMEOUT:"CallEndReasonMediaOfferTimeout",MEDIA_FINAL_ANSWER_TIMEOUT:"CallEndReasonMediaFinalAnswerTimeout",MEDIA_ANSWER_ERROR:"CallEndReasonMediaAnswerError",MEDIA_FINAL_ANSWER_ERROR:"CallEndReasonFinalAnswerError",MEDIA_PERMISSION_ERROR:"CallEndReasonMediaPermissionError",MEDIA_RENEGOTIATION_ERROR:"CallEndReasonRenegotiationError",MEDIA_DROP_DURING_CONNECT:"CallEndReasonMediaDropDuringConnectError",MEDIA_DROP_AFTER_CONNECT:"CallEndReasonMediaDropAfterConnectError",AUDIO_ERROR:"CallEndReasonAudioDeviceError",BAD_NOTIFICATION_PAYLOAD:"BadCallNotificationPayload",NETWORK_ERROR:"CallEndReasonNetworkError",LOCAL_USER_INITIATED:"CallEndReasonLocalUserInitiated",REMOTE_USER_INITIATED:"CallEndReasonRemoteUserInitiated",ESTABLISHMENT_TIMEOUT:"CallEndReasonEstablishmentTimeout",PARTICIPANT_REMOVAL_TIMEOUT:"CallParticipantRemovalTimeout",LOCAL_ERROR:"CallEndReasonLocalError",CALL_UPDATE_ERROR:"CallEndReasonCallUpdateError",P2P_FORK_CONNECTED:"CallEndReasonP2pForkConnected",P2P_FORK_FORWARDED:"CallEndReasonP2pForkForwarded",P2P_FORK_FORWARDED_TO_VOICEMAIL:"CallEndReasonP2pForkForwardedToVoiceMail",P2P_FALLBACK_FOR_SCREENSHARING:"CallEndReasonP2pFallbackForScreensharing",P2P_FALLBACK_FOR_GROUPCALL:"CallEndReasonP2pFallbackForGroupCall",P2P_FALLBACK_FOR_CALL_ASSIMILATION:"CallEndReasonP2pFallbackForCallAssimilation",P2P_FALLBACK_FOR_TRANSLATION:"CallEndReasonP2pFallbackForCallTranslation",P2P_FORK_REJECTED:"CallEndReasonP2pForkRejected",TROUTER_CONNECTION_DROPPED:"CallEndReasonTrouterConnectionDropped",REMOVED_FROM_CALL:"CallEndReasonRemovedFromCall",TRANSFER_COMPLETION_TIMEOUT:"CallEndReasonTransferCompletionTimeout",CALL_DOES_NOT_EXIST:"CallEndReasonCallDoesNotExist",ATTACH_ACTION_FAILED:"CallEndReasonAttachActionFailed",ATTACH_FAILED:"CallEndReasonAttachFailed",CONVERSATION_ESTABLISHMENT_FAILED:"CallEndReasonConversationEstablishmentFailed",CONV_END_FROM_SERVICE:"CallEndReasonConversationEndReceivedFromService",CONV_END_FROM_SERVICE_WITH_ERROR:"CallEndReasonConversationEndReceivedFromServiceWithError",SERVICE_ERROR:"CallEndReasonServiceError",CONFLICT:"CallEndReasonConflict",CALL_ALREADY_IN_P2P:"CallEndReasonCallAlreadyExistsInP2p",CONV_END_NO_MODALITY:"ConversationEndNoModalityConnected",RENEGOTIATION_IN_PROGRESS:"NegotiationIsInProgress",ADD_PARTICIPANT_URL_MISSING:"AddParticipantUrlMissing"}}}),define("jSkype/services/NGCCallAgent/NGCCallAgent/incomingNotificationMessageHandler",["require","jSkype/services/NGCCallAgent/NGCCallAgent/constants"],function(e){function n(e){this.handleMessage=function(n){if(!r(n))return{isHandled:!1};if(n.url.search(new RegExp("/"+t.URL_BASE.CALLAGENT+"/","i"))>-1){var i=e.handleIncomingNotification(n);return{isHandled:!0,resultCode:i}}return{isHandled:!1}}}function r(e){return!e.eventId}var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants");return n}),define("jSkype/services/NGCCallAgent/NGCCallAgent/utils",["require","jSkype/services/NGCCallAgent/NGCCallAgent/constants"],function(e){function r(e){var t=e.toString(16),n=4-t.length,r;for(r=0;r<n;r+=1)t="0"+t;return t}var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),n={};return n.newGuid=function(){var e=new Array(8),t,n;for(n=0;n<e.length;n+=2)t=Math.floor(Math.random()*4294967296),e[n]=r(t&65535),e[n+1]=r(t>>>16),n+1===3&&(e[n+1]="4"+e[n+1].substring(1));return e[0]+e[1]+"-"+e[2]+"-"+e[3]+"-"+e[4]+"-"+e[5]+e[6]+e[7]},n.assert=function(e,t){if(!e)throw new Error("Assert failed"+(typeof t!="undefined"?":"+t:""))},n.assertNotNullOrEmpty=function(e,t){if(!e||e===" ")throw new Error("AssertNotNullOrEmpty failed. "+(typeof t!="undefined"?": "+t:""))},n.assertNotNull=function(e,t){if(!e)throw new Error("AssertNotNull failed. "+(typeof t!="undefined"?": "+t:""))},n.assertCallEndReason=function(e){n.assertNotNullOrEmpty(e,"callEndReason cannot be null or empty");if(typeof e.code=="undefined"||typeof e.subCode=="undefined"||typeof e.phrase=="undefined"||e.code<0||e.subCode<0||e.phrase===" ")throw new Error("callEndReason must specify code, subcode and phrase. Invalid reason : "+n.getPrintableObject(e))},n.getMediaTypes=function(e){n.assertNotNull(e,"MediaTypes passed cannot be null"),n.assert(e.length>0,"Atleast one mediaType must be specified");var r=[];for(var i in t.MEDIA_TYPES)n.arrayContains(e,t.MEDIA_TYPES[i])&&r.push(t.MEDIA_TYPES[i]);return r},n.stringContains=function(e,t){return e.indexOf(t)>-1},n.stringEndsWith=function(e,t){return e.length>=t.length&&e.indexOf(t,e.length-t.length)>-1},n.arrayContains=function(e,t){var n=t.toLowerCase();return-1<e.map(function(e){return e.toLowerCase()}).indexOf(n)},n.getPrintableObject=function(e){return JSON.stringify(e,null,4)},n.tryAddNewKeyToHashTable=function(e,t,n){return e.hasOwnProperty(t)?!1:(e[t]=n,!0)},n.tryRemoveKeyFromHashTable=function(e,t){return e.hasOwnProperty(t)?(delete e[t],!0):!1},n.getHashTableCount=function(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&t++;return t},n.escapeRegExp=function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},n.safelyResolvePromise=function(e,t){e&&e.promise.state()==="pending"&&e.resolve(t)},n.safelyRejectPromise=function(e,t){e&&e.promise.state()==="pending"&&e.reject(t)},n}),define("jSkype/services/NGCCallAgent/NGCCallAgent/signalingAgentConfig",["require","jSkype/client","jSkype/services/clientInfo","browser/detect","jSkype/settings","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/trouter/trouter"],function(e){function u(e){switch(e){case r.DEVICE_TYPES.DESKTOP:return"Desktop";case r.DEVICE_TYPES.MOBILE:return"Mobile";case r.DEVICE_TYPES.TABLET:return"Tablet"}}function a(e){var a=this,f=r.getSystemInfo(),l=s.stringContains(n.getBIAppName(),"swx-local")?"Test/":"",c="/os="+f.osName+"; osVer="+f.osVersion+"; proc="+f.platform;c+="; deviceType="+u(f.deviceType)+"; browser="+r.getBrowserInfo().browserName,c+="; browserVer="+r.getBrowserInfo().browserVersion,a.conversationServiceUrl=i.settings.pluginless.conversationServiceUrl,a.trouterUrl=o.trouterUrl,a.skypeToken=function(){return t.get().signInManager._skypeToken()},a.logger=e,a.languageCode=i.settings.initParams.locale,a.clientInformation="Web CallSignalingAgent(PluginLess/"+l+n.getBIVersion()+c+")",a.testCall=l===""?!1:!0,a.doHostlessCalling=!1,a.shouldServiceSendCallEventMessages=!1,a.cloudScreenSharingFlag="disabled"}var t=e("jSkype/client"),n=e("jSkype/services/clientInfo"),r=e("browser/detect"),i=e("jSkype/settings"),s=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),o=e("jSkype/services/trouter/trouter");return a}),define("jSkype/services/NGCCallAgent/NGCCallAgent/telemetryConstants",[],function(){return{SOURCE:{NGC_SOURCE:"SkypeConcore"},EVENT_TYPE:{CONVERSATION_CALL_MODALITY:"skypecosi_concore_web_csa_conversation_callmodality"},EXTENSIONS:{DATA_VERSION:"DataVersion",DIRECTION:"Direction",CONNECTED_DURATION_IN_MS:"ConnectedDurationInMsecs",TIME_TO_RING_IN_MS:"TimeToRingInMsecs",CALL_TERMINATING_END:"CallTerminatingEnd",NETWORK_REQUESTS_PENDING:"NetworkRequestsPending",NETWORK_REQUESTS_COMPLETED:"NetworkRequestsCompleted",LOCAL_OPERATIONS_PERFORMED:"LocalOperationsPerformed",CALL_START_TIME:"CallStartTime",CALL_END_TIME:"CallEndTime",IS_GROUP_CALL:"IsGroupCall",CALL_END_CODE:"Code",CALL_END_SUB_CODE:"SubCode",CONVERSATION_SERVICE_URL:"ConversationServiceUrl",RESULT_VALUE:"ResultValue",RESULT_DETAIL:"ResultDetail",RESULT_CODE:"ResultCode",LOCAL_OFFER_ANSWER_TIME_IN_MS:"LocalOfferAnswerTimeInMsecs",SELF_PARTICIPANT_ROLE:"SelfParticipantRole",CALLER_TYPE:"Caller_Type",CALLEE_TYPE:"Callee_Type",TEST_CONTEXT_ID:"Test_Context_Id",OUTGOING_MODALITIES:"Outgoing_Modalities",INCOMING_MODALITIES:"Incoming_Modalities",VBSS_OPERATIONS:"VBSS_Operations"},CONTEXT_ID:{CORRELATIONID:"CorrelationId",THREADID:"ThreadId",SPACES_MESSAGEID:"SkypeSpacesMessageId",ENDPOINTID:"EndpointId",PARTICIPANTID:"ParticipantId",DATA_VERSION:"DataVersion"},CALL_TERMINATING_END:{LOCAL:"Local",REMOTE:"Remote"},RESULT_VALUE:{SUCCESS:"Success",FAILURE:"Failure"},NETWORK_REQUESTS:{SEND_MEDIA_ANSWER:"SendMediaAnswer",START_RENEGOTIATION:"StartRenegotiation",SEND_MEDIA_ACKNOWLEDGEMENT:"SendMediaAcknowledgement",SEND_MEDIA_REJECTION:"SendMediaRejection",ADD_PARTICIPANT:"AddParticipant",REMOVE_PARTICIPANT:"RemoveParticipant",SEND_ACCEPTANCE:"SendAcceptance",SEND_ACCEPTANCE_ACKNOWLEDGEMENT:"SendAcceptanceAcknowledgement",END_CALL:"EndCall",CANCEL_CALL:"CancelCall",REJECT_CALL:"RejectCall",JOIN_CONVERSATION:"JoinConversation",JOIN_CONVERSATION_WITHOUT_CALL_MODALITY:"JoinConversationWithoutCallModality",LEAVE_CONVERSATION:"LeaveConversation",PLACE_CALL:"PlaceCall",UPDATE_CONVERSATION_LINKS:"UpdateConversationLinks",SEND_CALL_ATTACH:"SendCallAttach",SEND_CALL_PROGRESS:"SendCallProgress",SEND_KEEP_ALIVE:"SendKeepAlive"},LOCAL_OPERATIONS:{HANDLE_MEDIA_ACKNOWLEDGEMENT:"HandleMediaAcknowledgement",HANDLE_MEDIA_NEGOTIATION_FAILURE:"HandleMediaNegotiationFailure",HANDLE_MEDIA_ANSWER:"HandleMediaAnswer",HANDLE_MEDIA_OFFER:"HandleMediaOffer",REJECT_RENEGOTIATION:"RejectRenegotiation",HANDLE_RETARGET_COMPLETED:"HandleRetargetCompleted",HANDLE_MEDIA_ANSWER_TIMEOUT:"HandleMediaAnswerTimeout",HANDLE_MEDIA_ACKNOWLEDGEMENT_TIMEOUT:"HandleMediaAcknowledgementTimeout",ACCEPT_RENEGOTIATION:"AcceptRenegotiation",START_RENEGOTIATION:"StartRenegotiation",ADD_PARTICIPANT:"AddParticipant",ADD_PARTICIPANT_TIMEOUT:"AddParticipantTimeout",REMOVE_PARTICIPANT:"RemoveParticipant",REMOVE_PARTICIPANT_TIMEOUT:"RemoveParticipantTimeout",HANDLE_ADD_PARTICIPANT_SUCCESS:"HandleAddParticipantSuccess",HANDLE_ADD_PARTICIPANT_FAILURE:"HandleAddParticipantFailure",HANDLE_ADD_PARTICIPANT_MODALITY_FAILURE:"HandleAddParticipantModalityFailure",HANDLE_REMOVE_PARTICIPANT_SUCCESS:"HandleRemoveParticipantSuccess",HANDLE_REMOVE_PARTICIPANT_FAILURE:"HandleRemoveParticipantFailure",HANDLE_ROSTER_UPDATE:"HandleRosterUpdate",HANDLE_CONVERSATION_UPDATE:"HandleConversationUpdate",SET_SUBJECT:"SetSubject",SET_THREADID:"SetThreadId",START_CALL:"StartCall",JOIN_CALL:"JoinCall",JOIN_CONVERSATION_WITHOUT_CALL_MODALITY:"JoinConversationWithoutCallModality",HANDLE_INCOMING_CALL:"HandleIncomingCall",END_CALL:"EndCall",SET_PROVISIONAL_ANSWER:"SetProvisionalAnswer",ACCEPT_CALL:"AcceptCall",HANDLE_CALL_ACCEPTANCE_ACK:"HandleCallAcceptanceAck",HANDLE_CALL_ACCEPTANCE:"HandleCallAcceptance",HANDLE_CALL_ESTABLISHMENT_TIMEOUT:"HandleCallEstablishmentTimeout",HANDLE_CALL_END:"HandleCallEnd",HANDLE_CALL_PROGRESS:"HandleCallProgress",TROUTER_URL_CHANGED:"TrouterUrlChanged"},DIRECTION:{INCOMING:"Incoming",OUTGOING:"Outgoing"},ROLE:{CALLER:"Caller",CALLEE:"Callee",JOIN:"Join",JOIN_FOR_ROSTER_ONLY:"JoinForRosterOnly"},VBSS_OPERATION:{START:"Start",STOP:"Stop",REJECTED:"Rejected",REMOTE_START:"RemoteStart",TIMEOUT:"Timeout",CALL_END:"CallEnd"},LOCAL_OFFER_ANSWER_TIMES:{INITIAL_OFFER_TIME:"InitialOfferTime",RENEGOTIATION_OFFER_TIME:"RenegotiationOfferTime",INITIAL_ANSWER_TIME:"InitialAnswerTime",PROVISIONAL_ANSWER_TIME:"ProvisionalAnswerTime",RENEGOTIATION_ANSWER_TIME:"RenegotiationAnswerTime"}}}),define("jSkype/services/NGCCallAgent/NGCCallAgent/participant",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils"],function(e){function n(e){this.id=e.id,this.displayName=e.displayName||" ",this.endpointId=e.endpointId||null,this.languageId=e.languageId||null,this.mediaStreams=e.mediaStreams||[],this.capabilities=e.capabilities||{}}var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils");return n.fromWireParticipant=function(e){t.assertNotNull(e,"invalid wireParticipant"),t.assertNotNullOrEmpty(e.id,"participant must have valid Id");var r=new n({id:e.id,displayName:e.displayName,endpointId:e.endpointId,languageId:e.languageId});return r},n.fromRoster=function(e){t.assertNotNull(e,"invalid rosterParticipant"),t.assertNotNullOrEmpty(e.details.id,"participant must have valid Id");var r=new n({id:e.details.id,displayName:e.details.displayName,endpointId:e.details.endpointId,languageId:e.details.languageId,mediaStreams:e.call.mediaStreams||[],capabilities:e.capabilities||[]});return r},n}),define("jSkype/services/NGCCallAgent/NGCCallAgent/requestBuilder",["require","exports","module","lodash-compat","jSkype/settings","jSkype/services/serviceAccessLayer/transientFaultPolicy"],function(e,t){var n=e("lodash-compat"),r=e("jSkype/settings"),i=e("jSkype/services/serviceAccessLayer/transientFaultPolicy");t.get=function(e,t,s){return e.signalingAgentConfig.skypeToken().then(function(o){var u={headers:{"X-Microsoft-Skype-Chain-ID":e.correlationId,"X-Microsoft-Skype-Client":e.signalingAgentConfig.clientInformation,"X-Skypetoken":o},retry:n.merge({},r.settings.retry,{isTransientCheck:i.isTransientFailure,isSuccessCheck:i.isWebApiSuccess}),reporting:{serviceName:"ngcCallController-"+t}};return s&&s.payload&&(u.payload=JSON.stringify(s.payload)),e.telemetryHelper.addNetworkOperationStarted(t),u})}}),define("jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/NGCCallAgent/NGCCallAgent/constants"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),r={};return r.get=function(e,r){t.assertNotNullOrEmpty(r,"trailingPath cannot be null"),t.assertNotNull(e,"signalingSession cannot be null");var i=e.signalingAgentConfig.trouterUrl();return t.assertNotNullOrEmpty(i,"trouterUrl cannot be null"),i+n.URL_BASE.CALLAGENT+"/"+e.urlIdentifier+r},r}),define("jSkype/services/NGCCallAgent/NGCCallAgent/createConversationRequest",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder","jSkype/services/NGCCallAgent/NGCCallAgent/constants"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder"),r=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),i={};return i.getPayload=function(e,i,s,o){t.assertNotNull(e,"signalingSession cannot be null");var u=e.participantManager.getParticipantsToInitiateCallWith();e.signalingAgentConfig.doHostlessCalling||t.assert(u.length>0,"remoteParticipants need to be set before a call can be made");var a={type:"full",rosterUpdate:n.get(e,r.URL_PATH.CONV_ROSTER_UPDATE)},f=e.threadId?{threadId:e.threadId,messageId:e.spacesMessageId||null}:null;e.signalingAgentConfig.doHostlessCalling||u.length>1?t.assertNotNullOrEmpty(e.threadId,"threadId should be set prior to making a multiparty call"):u.length===1&&e.telemetryHelper.setCalleeType(u[0].id);var l=[];u.forEach(function(e){l.push({id:e.id,displayName:e.displayName})});var c=t.getMediaTypes(s);e.telemetryHelper.addOutgoingModalities(c);var h={payload:{callInvitation:{callModalities:c,replaces:null,transferor:null,links:{progress:n.get(e,r.URL_PATH.PROGRESS),mediaAnswer:n.get(e,r.URL_PATH.MEDIA_ANSWER),acceptance:n.get(e,r.URL_PATH.ACCEPT),redirection:n.get(e,r.URL_PATH.REDIRECTION),end:n.get(e,r.URL_PATH.END),p2pForkNotification:n.get(e,r.URL_PATH.P2P_FORK_NOTIFICATION)},mediaContent:i},conversationRequest:{subject:e.convSubject,suppressDialout:o||!1,roster:a,properties:{allowConversationWithoutHost:e.signalingAgentConfig.doHostlessCalling,enableGroupCallEventMessages:e.signalingAgentConfig.shouldServiceSendCallEventMessages},links:{conversationEnd:n.get(e,r.URL_PATH.CONV_END),conversationUpdate:n.get(e,r.URL_PATH.CONV_UPDATE),addParticipantSuccess:n.get(e,r.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:n.get(e,r.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}},participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId},to:l},capabilities:{cloudAudioVideoConference:e.isGVCOutgoingEnabled?"enabled":"disabled",cloudScreenSharing:e.signalingAgentConfig.cloudScreenSharingFlag},groupChat:f,debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId}}};return h},i}),define("jSkype/services/NGCCallAgent/NGCCallAgent/joinGivenConversationRequest",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder","jSkype/services/NGCCallAgent/NGCCallAgent/constants"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder"),r=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),i={};return i.getPayload=function(e,i,s){t.assertNotNull(e,"signalingSession cannot be null");var o=t.getMediaTypes(s);e.telemetryHelper.addOutgoingModalities(o);var u={payload:{callInvitation:{callModalities:o,replaces:null,transferor:null,links:{progress:n.get(e,r.URL_PATH.PROGRESS),mediaAnswer:n.get(e,r.URL_PATH.MEDIA_ANSWER),acceptance:n.get(e,r.URL_PATH.ACCEPT),redirection:n.get(e,r.URL_PATH.REDIRECTION),end:n.get(e,r.URL_PATH.END),p2pForkNotification:n.get(e,r.URL_PATH.P2P_FORK_NOTIFICATION)},mediaContent:i},conversationRequest:{roster:{type:"full",rosterUpdate:n.get(e,r.URL_PATH.CONV_ROSTER_UPDATE)},links:{conversationEnd:n.get(e,r.URL_PATH.CONV_END),conversationUpdate:n.get(e,r.URL_PATH.CONV_UPDATE),addParticipantSuccess:n.get(e,r.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:n.get(e,r.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}},participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId}},capabilities:{cloudAudioVideoConference:e.isGVCJoiningEnabled?"enabled":"disabled",cloudScreenSharing:e.signalingAgentConfig.cloudScreenSharingFlag},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId}}};return u},i}),define("jSkype/services/NGCCallAgent/NGCCallAgent/joinGivenConversationWithoutCallModalityRequest",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder","jSkype/services/NGCCallAgent/NGCCallAgent/constants"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder"),r=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),i={};return i.getPayload=function(e){t.assertNotNull(e,"signalingSession cannot be null");var i={payload:{conversationRequest:{roster:{type:"full",rosterUpdate:n.get(e,r.URL_PATH.CONV_ROSTER_UPDATE)},links:{conversationEnd:n.get(e,r.URL_PATH.CONV_END),conversationUpdate:n.get(e,r.URL_PATH.CONV_UPDATE)}},participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId}},capabilities:{cloudAudioVideoConference:e.isGVCJoiningEnabled?"enabled":"disabled",cloudScreenSharing:e.signalingAgentConfig.cloudScreenSharingFlag},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId}}};return i},i}),define("jSkype/services/NGCCallAgent/NGCCallAgent/leaveConversationRequest",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/NGCCallAgent/NGCCallAgent/constants"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),r={};return r.getPayload=function(e,r){t.assertNotNull(e,"signalingSession cannot be null"),t.assertCallEndReason(r);var i={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId}},conversationTransactionEnd:{reason:"noError",code:n.CALL_END_CODE.SUCCESS,phrase:n.CALL_END_PHRASE.CONV_END_NO_MODALITY},callTransactionEnd:r}};return i},r}),define("jSkype/services/NGCCallAgent/NGCCallAgent/cancelCallRequest",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/NGCCallAgent/NGCCallAgent/constants"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),r={};return r.getPayload=function(e,r){t.assertNotNull(e,"signalingSession cannot be null"),t.assertCallEndReason(r);var i={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId}},conversationTransactionEnd:{reason:"noError",code:n.CALL_END_CODE.SUCCESS,phrase:n.CALL_END_PHRASE.CONV_END_NO_MODALITY},callTransactionEnd:r}};return i},r}),define("jSkype/services/NGCCallAgent/NGCCallAgent/endCallRequest",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n={};return n.getPayload=function(e,n){t.assertNotNull(e,"signalingSession cannot be null"),t.assertCallEndReason(n);var r={payload:{callEnd:n,debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId}}};return r},n}),define("jSkype/services/NGCCallAgent/NGCCallAgent/provisionalMediaResponse",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n={};return n.getPayload=function(e,n){t.assertNotNull(e,"signalingSession cannot be null");var r={payload:{mediaAnswer:{sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId},mediaContent:n},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId}}};return r},n}),define("jSkype/services/NGCCallAgent/NGCCallAgent/callAcceptanceRequest",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder","jSkype/services/NGCCallAgent/NGCCallAgent/constants"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder"),r=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),i={};return i.getPayload=function(e,i,s){t.assertNotNull(e,"signalingSession cannot be null");var o=t.getMediaTypes(s);e.telemetryHelper.addOutgoingModalities(o);var u={payload:{callAcceptance:{acceptedBy:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId},acceptedCallModalities:o,capabilities:{cloudAudioVideoConference:e.isGVCJoiningEnabled?"enabled":"disabled",cloudScreenSharing:e.signalingAgentConfig.cloudScreenSharingFlag},links:{mediaRenegotiation:n.get(e,r.URL_PATH.MEDIA_RENEGOTIATION),transfer:n.get(e,r.URL_PATH.TRANSFER),replacement:n.get(e,r.URL_PATH.REPLACE),retargetCompletion:n.get(e,r.URL_PATH.RETARGET_COMPLETION)},mediaContent:i,callKeepAliveInterval:null},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId}}};return u},i}),define("jSkype/services/NGCCallAgent/NGCCallAgent/rejectCallRequest",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n={};return n.getPayload=function(e,n){t.assertNotNull(e,"signalingSession cannot be null"),t.assertCallEndReason(n);var r={payload:{callEnd:n,debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId}}};return r},n}),define("jSkype/services/NGCCallAgent/NGCCallAgent/joinConversationForConnectedCallRequest",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder","jSkype/services/NGCCallAgent/NGCCallAgent/constants"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder"),r=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),i={};return i.getPayload=function(e){t.assertNotNull(e,"signalingSession cannot be null");var i={type:"full",rosterUpdate:n.get(e,r.URL_PATH.CONV_ROSTER_UPDATE)},s={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId}},conversationRequest:{roster:i,links:{conversationEnd:n.get(e,r.URL_PATH.CONV_END),conversationUpdate:n.get(e,r.URL_PATH.CONV_UPDATE),addParticipantSuccess:n.get(e,r.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:n.get(e,r.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}},capabilities:{cloudAudioVideoConference:e.isGVCJoiningEnabled?"enabled":"disabled",cloudScreenSharing:e.signalingAgentConfig.cloudScreenSharingFlag}}};return s},i}),define("jSkype/services/NGCCallAgent/NGCCallAgent/attachCallRequest",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder","jSkype/services/NGCCallAgent/NGCCallAgent/constants"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder"),r=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),i={};return i.getPayload=function(e){t.assertNotNull(e,"signalingSession cannot be null");var i={payload:{attach:{requireMediaContent:!0,links:{end:n.get(e,r.URL_PATH.END)}},capabilities:{cloudAudioVideoConference:e.isGVCJoiningEnabled?"enabled":"disabled",cloudScreenSharing:e.signalingAgentConfig.cloudScreenSharingFlag},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId}}};return i},i}),define("jSkype/services/NGCCallAgent/NGCCallAgent/callProgressRequest",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n={};return n.getPayload=function(e){t.assertNotNull(e,"signalingSession cannot be null");var n={payload:{callProgress:{sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId},status:"ringing",phrase:"ringing"},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId}}};return n},n}),define("jSkype/services/NGCCallAgent/NGCCallAgent/callAcceptanceAcknowledgementRequest",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder","jSkype/services/NGCCallAgent/NGCCallAgent/constants"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder"),r=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),i={};return i.getPayload=function(e){t.assertNotNull(e,"signalingSession cannot be null");var i={payload:{callAcceptanceAcknowledgement:{links:{mediaRenegotiation:n.get(e,r.URL_PATH.MEDIA_RENEGOTIATION),transfer:n.get(e,r.URL_PATH.TRANSFER),replacement:n.get(e,r.URL_PATH.REPLACE),retargetCompletion:n.get(e,r.URL_PATH.RETARGET_COMPLETION)}},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId}}};return i},i}),define("jSkype/services/NGCCallAgent/NGCCallAgent/participantUpdateRequest",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder","jSkype/services/NGCCallAgent/NGCCallAgent/constants"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder"),r=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),i={};return i.getPayload=function(e){t.assertNotNull(e,"signalingSession cannot be null");var i={payload:{callParticipantUpdate:{links:{mediaRenegotiation:n.get(e,r.URL_PATH.MEDIA_RENEGOTIATION),transfer:n.get(e,r.URL_PATH.TRANSFER),replacement:n.get(e,r.URL_PATH.REPLACE),end:n.get(e,r.URL_PATH.END)}},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId}}};return i},i}),define("jSkype/services/NGCCallAgent/NGCCallAgent/updateParticipantConversationLinksRequest",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder","jSkype/services/NGCCallAgent/NGCCallAgent/constants"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder"),r=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),i={};return i.getPayload=function(e){t.assertNotNull(e,"signalingSession cannot be null");var i={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId}},roster:{type:"full",rosterUpdate:n.get(e,r.URL_PATH.CONV_ROSTER_UPDATE)},links:{conversationEnd:n.get(e,r.URL_PATH.CONV_END),conversationUpdate:n.get(e,r.URL_PATH.CONV_UPDATE)},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId}}};return i},i}),define("jSkype/services/NGCCallAgent/NGCCallAgent/ngcTelemetry",["require","exports","module","jSkype/client","jSkype/settings","jSkype/services/NGCCallAgent/NGCCallAgent/telemetryConstants"],function(e,t){function s(e){function t(e){n.get()._telemetryManager.sendEvent(r.settings.telemetry.skypeConcoreToken,i.EVENT_TYPE.CONVERSATION_CALL_MODALITY,e)}function s(t){var n={};return n.Type=i.SOURCE.NGC_SOURCE,n.ResultDetail=t[i.EXTENSIONS.RESULT_DETAIL],n.ResultValue=t[i.EXTENSIONS.RESULT_VALUE],n.ResultCode=t[i.EXTENSIONS.CALL_END_CODE],n[i.CONTEXT_ID.CORRELATIONID]=e.correlationId,n[i.CONTEXT_ID.ENDPOINTID]=t[i.CONTEXT_ID.ENDPOINTID],n[i.CONTEXT_ID.PARTICIPANTID]=t[i.CONTEXT_ID.PARTICIPANTID],n[i.EXTENSIONS.CONVERSATION_SERVICE_URL]=t[i.EXTENSIONS.CONVERSATION_SERVICE_URL],n[i.EXTENSIONS.CALL_START_TIME]=JSON.stringify(t[i.EXTENSIONS.CALL_START_TIME]),n[i.EXTENSIONS.CALL_END_TIME]=JSON.stringify(t[i.EXTENSIONS.CALL_END_TIME]),n[i.EXTENSIONS.IS_GROUP_CALL]=e.threadId?"true":"false",n[i.EXTENSIONS.CALL_TERMINATING_END]=t[i.EXTENSIONS.CALL_TERMINATING_END],n[i.EXTENSIONS.CALL_END_CODE]=JSON.stringify(t[i.EXTENSIONS.CALL_END_CODE]),n[i.EXTENSIONS.CALL_END_SUB_CODE]=JSON.stringify(t[i.EXTENSIONS.CALL_END_SUB_CODE]),t.hasOwnProperty(i.EXTENSIONS.DIRECTION)&&(n[i.EXTENSIONS.DIRECTION]=t[i.EXTENSIONS.DIRECTION],n[i.EXTENSIONS.SELF_PARTICIPANT_ROLE]=t[i.EXTENSIONS.SELF_PARTICIPANT_ROLE]),t.hasOwnProperty(i.EXTENSIONS.CONNECTED_DURATION_IN_MS)&&(n[i.EXTENSIONS.CONNECTED_DURATION_IN_MS]=JSON.stringify(t[i.EXTENSIONS.CONNECTED_DURATION_IN_MS])),t.hasOwnProperty(i.EXTENSIONS.TIME_TO_RING_IN_MS)&&(n[i.EXTENSIONS.TIME_TO_RING_IN_MS]=JSON.stringify(t[i.EXTENSIONS.TIME_TO_RING_IN_MS])),t.hasOwnProperty(i.EXTENSIONS.NETWORK_REQUESTS_COMPLETED)&&(n[i.EXTENSIONS.NETWORK_REQUESTS_COMPLETED]=t[i.EXTENSIONS.NETWORK_REQUESTS_COMPLETED]),t.hasOwnProperty(i.EXTENSIONS.NETWORK_REQUESTS_PENDING)&&(n[i.EXTENSIONS.NETWORK_REQUESTS_PENDING]=t[i.EXTENSIONS.NETWORK_REQUESTS_PENDING]),t.hasOwnProperty(i.EXTENSIONS.LOCAL_OPERATIONS_PERFORMED)&&(n[i.EXTENSIONS.LOCAL_OPERATIONS_PERFORMED]=t[i.EXTENSIONS.LOCAL_OPERATIONS_PERFORMED]),t.hasOwnProperty(i.EXTENSIONS.LOCAL_OFFER_ANSWER_TIME_IN_MS)&&(n[i.EXTENSIONS.LOCAL_OFFER_ANSWER_TIME_IN_MS]=t[i.EXTENSIONS.LOCAL_OFFER_ANSWER_TIME_IN_MS]),t.hasOwnProperty(i.EXTENSIONS.OUTGOING_MODALITIES)&&(n[i.EXTENSIONS.OUTGOING_MODALITIES]=t[i.EXTENSIONS.OUTGOING_MODALITIES]),t.hasOwnProperty(i.EXTENSIONS.INCOMING_MODALITIES)&&(n[i.EXTENSIONS.INCOMING_MODALITIES]=t[i.EXTENSIONS.INCOMING_MODALITIES]),t.hasOwnProperty(i.EXTENSIONS.VBSS_OPERATIONS)&&(n[i.EXTENSIONS.VBSS_OPERATIONS]=t[i.EXTENSIONS.VBSS_OPERATIONS]),t.hasOwnProperty(i.EXTENSIONS.CALLER_TYPE)&&(n[i.EXTENSIONS.CALLER_TYPE]=t[i.EXTENSIONS.CALLER_TYPE]),t.hasOwnProperty(i.EXTENSIONS.CALLEE_TYPE)&&(n[i.EXTENSIONS.CALLEE_TYPE]=t[i.EXTENSIONS.CALLEE_TYPE]),e.signalingAgentConfig.testCall&&(n[i.EXTENSIONS.TEST_CONTEXT_ID]="Test"),e.threadId&&(n[i.CONTEXT_ID.THREADID]=e.threadId),e.spacesMessageId&&(n[i.CONTEXT_ID.SPACES_MESSAGEID]=e.spacesMessageId),n}this.logConversationCallModalityEvent=function(e){var n=s(e);t(n)}}var n=e("jSkype/client"),r=e("jSkype/settings"),i=e("jSkype/services/NGCCallAgent/NGCCallAgent/telemetryConstants");t.getLogger=function(e){return new s(e)}}),define("jSkype/services/NGCCallAgent/NGCCallAgent/telemetryHelper",["require","jSkype/services/NGCCallAgent/NGCCallAgent/constants","jSkype/services/NGCCallAgent/NGCCallAgent/telemetryConstants","jSkype/services/NGCCallAgent/NGCCallAgent/utils","swx-utils-common","jSkype/services/NGCCallAgent/NGCCallAgent/ngcTelemetry"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/telemetryConstants"),r=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),i=e("swx-utils-common").stopwatch,s=e("jSkype/services/NGCCallAgent/NGCCallAgent/ngcTelemetry"),o=function(e){function E(){m[n.EXTENSIONS.CALL_START_TIME]=u,m[n.EXTENSIONS.CONVERSATION_SERVICE_URL]=e.signalingAgentConfig.conversationServiceUrl}function S(e){return e+":"+((new Date).getTime()-u)}function x(){d&&o.addVbssOperations(n.VBSS_OPERATION.CALL_END),m[n.EXTENSIONS.CALL_END_TIME]=(new Date).getTime(),g&&(m[n.EXTENSIONS.CONNECTED_DURATION_IN_MS]=g.duration()),a.length>0&&(m[n.EXTENSIONS.NETWORK_REQUESTS_COMPLETED]=JSON.stringify(a)),l.length>0&&(m[n.EXTENSIONS.LOCAL_OPERATIONS_PERFORMED]=JSON.stringify(l)),v.length>0&&(m[n.EXTENSIONS.LOCAL_OFFER_ANSWER_TIME_IN_MS]=JSON.stringify(v)),h.length>0&&(m[n.EXTENSIONS.INCOMING_MODALITIES]=JSON.stringify(h)),c.length>0&&(m[n.EXTENSIONS.OUTGOING_MODALITIES]=JSON.stringify(c)),p.length>0&&(m[n.EXTENSIONS.VBSS_OPERATIONS]=JSON.stringify(p));var e=[];for(var t in f)f.hasOwnProperty(t)&&e.push(f[t]);e.length>0&&(m[n.EXTENSIONS.NETWORK_REQUESTS_PENDING]=JSON.stringify(e)),w.log("sending telemetry data = "+r.getPrintableObject(m)),b.logConversationCallModalityEvent(m)}var o=this,u=(new Date).getTime(),a=[],f={},l=[],c=[],h=[],p=[],d=!1,v=[],m={},g=null,y=null,b=s.getLogger(e),w=e.logger;E(),o.addLocalOperation=function(e){l.push(S(e))},o.addOutgoingModalities=function(e){e&&c.push(e)},o.addIncomingModalities=function(e){e&&h.push(e)},o.addVbssOperations=function(e){e&&(e===n.VBSS_OPERATION.START?d=!0:d=!1,p.push(S(e)))},o.addNetworkOperationStarted=function(e){r.tryAddNewKeyToHashTable(f,e,S(e))},o.addNetworkOperationCompleted=function(e,t,i){var s=t?n.RESULT_VALUE.SUCCESS:n.RESULT_VALUE.FAILURE;a.push(S(e+":"+s+":"+i)),r.tryRemoveKeyFromHashTable(f,e)},o.setDirection=function(e){m[n.EXTENSIONS.DIRECTION]=e},o.setEndPointId=function(e){m[n.CONTEXT_ID.ENDPOINTID]=e},o.setParticipantId=function(e){m[n.CONTEXT_ID.PARTICIPANTID]=e},o.setConversationServiceUrl=function(e){m[n.EXTENSIONS.CONVERSATION_SERVICE_URL]=e},o.setRole=function(e){m[n.EXTENSIONS.SELF_PARTICIPANT_ROLE]=e},o.setCallerType=function(e){if(!e)return;m[n.EXTENSIONS.CALLER_TYPE]=e.split(":",1)[0]},o.setCalleeType=function(e){if(!e)return;m[n.EXTENSIONS.CALLEE_TYPE]=e.split(":",1)[0]},o.setTerminatingData=function(e){m[n.EXTENSIONS.CALL_TERMINATING_END]=e.terminatingEnd,m[n.EXTENSIONS.CALL_END_CODE]=e.endCode||t.CALL_END_CODE.SUCCESS,m[n.EXTENSIONS.CALL_END_SUB_CODE]=e.endSubCode||t.CALL_END_SUB_CODE.SUCCESS,m[n.EXTENSIONS.RESULT_VALUE]=e.resultValue||n.RESULT_VALUE.SUCCESS,m[n.EXTENSIONS.RESULT_DETAIL]=e.resultDetail||"Call gracefully hungup"},o.startCallInitializationWatch=function(e){y=i.build(),e&&(y.msElapsed+=e)},o.startCallConnectedWatch=function(){g=i.build()},o.setLocalOfferAnswerDuration=function(e){v.push(e)},o.setTimeToRingDuration=function(){y&&(m[n.EXTENSIONS.TIME_TO_RING_IN_MS]=y.duration(),y=null)},o.dispose=function(){x()}};return o}),define("jSkype/services/NGCCallAgent/NGCCallAgent/addParticipantAndModalityRequest",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder","jSkype/services/NGCCallAgent/NGCCallAgent/constants"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder"),r=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),i={};return i.getPayload=function(e,i){t.assertNotNull(e,"signalingSession cannot be null"),t.assertNotNull(i,"remoteParticipant cannot be null"),t.assertNotNullOrEmpty(e.threadId,"threadId should be set prior to adding participant");var s={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId},to:[{id:i.id,displayName:i.displayName}]},groupChat:{threadId:e.threadId,messageId:e.spacesMessageId},links:{addParticipantSuccess:n.get(e,r.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:n.get(e,r.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId}}};return s},i}),define("jSkype/services/NGCCallAgent/NGCCallAgent/removeParticipantRequest",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder","jSkype/services/NGCCallAgent/NGCCallAgent/constants"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder"),r=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),i={};return i.getPayload=function(e,i){t.assertNotNull(e,"signalingSession cannot be null"),t.assertNotNull(i,"remoteParticipant cannot be null");var s={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId},to:[{id:i.id,displayName:i.displayName}]},links:{removeParticipantSuccess:n.get(e,r.URL_PATH.CONV_REMOVE_PARTICIPANT_SUCCESS),removeParticipantFailure:n.get(e,r.URL_PATH.CONV_REMOVE_PARTICIPANT_FAILURE)},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId}}};return s},i}),define("jSkype/services/NGCCallAgent/NGCCallAgent/participantManager",["require","jSkype/services/NGCCallAgent/NGCCallAgent/constants","jSkype/services/NGCCallAgent/NGCCallAgent/telemetryConstants","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/NGCCallAgent/NGCCallAgent/participant","jSkype/services/NGCCallAgent/NGCCallAgent/addParticipantAndModalityRequest","jSkype/services/NGCCallAgent/NGCCallAgent/removeParticipantRequest","jSkype/services/serviceAccessLayer/requestDispatcher","jSkype/services/NGCCallAgent/NGCCallAgent/requestBuilder","swx-enums","jSkype/modelHelpers/personHelper","swx-utils-common","jcafe-property-model"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/telemetryConstants"),r=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),i=e("jSkype/services/NGCCallAgent/NGCCallAgent/participant"),s=e("jSkype/services/NGCCallAgent/NGCCallAgent/addParticipantAndModalityRequest"),o=e("jSkype/services/NGCCallAgent/NGCCallAgent/removeParticipantRequest"),u=e("jSkype/services/serviceAccessLayer/requestDispatcher"),a=e("jSkype/services/NGCCallAgent/NGCCallAgent/requestBuilder"),f=e("swx-enums"),l=e("jSkype/modelHelpers/personHelper"),c=e("swx-utils-common").stopwatch,h=e("jcafe-property-model"),p=function(e,p,d){function E(i,o){if(o){e.timeoutManager.startTimer(t.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,function(){e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.ADD_PARTICIPANT_TIMEOUT),e.timeoutManager.stopTimer(t.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,i.id),k(y,i.id,"timed out waiting for participant to show up in roster",{code:t.CALL_END_CODE.TIMEOUT,subcode:t.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:t.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT})},i.id);var f=c.build(),l=s.getPayload(e,i);a.get(e,n.NETWORK_REQUESTS.ADD_PARTICIPANT,l).then(function(e){return u.post(o,e)}).then(function(){m||e.telemetryHelper.addNetworkOperationCompleted(n.NETWORK_REQUESTS.ADD_PARTICIPANT,!0,f.duration())}).catch(function(s){var o=r.getPrintableObject(s);w.error("sendNetworkRequestForAddingParticipant failed because : "+o),m||(e.telemetryHelper.addNetworkOperationCompleted(n.NETWORK_REQUESTS.ADD_PARTICIPANT,!1,f.duration()),e.timeoutManager.stopTimer(t.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,i.id),k(y,i.id,o,{code:t.CALL_END_CODE.NETWORK_ERROR,subcode:t.CALL_END_SUB_CODE.FAILED_TO_REACH_SERVICE,phrase:t.CALL_END_PHRASE.NETWORK_ERROR}))})}else w.error("sendNetworkRequestForAddingParticipant failed because correct addParticipantUrl is not provided"),k(y,i.id,"correct addParticipantUrl is not provided",{code:t.CALL_END_CODE.LOCAL_ERROR,subcode:t.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:t.CALL_END_PHRASE.ADD_PARTICIPANT_URL_MISSING})}function S(n,s){w.log("handleRosterParticipant for : "+n.details.id);if(n.details.id===v.localParticipant.id)return;if(n.call){r.tryAddNewKeyToHashTable(v.connectedRemoteParticipantIds,n.details.id,!0);var o=i.fromRoster(n),u=s.hasOwnProperty(o.id);u&&(s[o.id]=!1),y.hasOwnProperty(o.id)?(w.log("participant : "+o.id+" appears in roster. Resolving AddParticipant request"),e.timeoutManager.stopTimer(t.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,o.id),C(y,o)):T(o,u)}}function x(n,i){w.log("checkForRemovedParticipants");for(var s in n)n.hasOwnProperty(s)&&n[s]!==!1&&!y.hasOwnProperty(s)&&(r.tryRemoveKeyFromHashTable(v.connectedRemoteParticipantIds,s),w.log("firing onParticipantRemoved for : "+s),p.onParticipantRemoved({id:s,mediaStreams:[]}));for(var o in b)b.hasOwnProperty(o)&&!i.hasOwnProperty(o)&&(w.log("participant : "+o+" no longer appears in roster. Resolving RemoveParticipant request"),r.tryRemoveKeyFromHashTable(v.connectedRemoteParticipantIds,o),e.timeoutManager.stopTimer(t.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,o),C(b,{id:o}))}function T(e,t){t?(w.log("firing onParticipantUpated for : "+e.id),p.onParticipantUpdated(e)):b.hasOwnProperty(e.id)?w.log("ignoring participant : "+e.id+" who has been requested to be removed"):(w.log("firing onParticipantJoined for : "+e.id),p.onParticipantJoined(e))}function N(){var e={};return p.getRemoteParticipantCollection().forEach(function(t){if(t.audio.state()===f.callConnectionState.Connected||t.audio.state()===f.callConnectionState.Connecting)e[l.getKey(t.person.id(),t.person._type())]=!0}),e}function C(e,t){w.log("resolvePromiseAndDeleteFromHashTable for : "+t.id);var n=e[t.id].promise;delete e[t.id],n.resolve(t)}function k(e,t,n,r){w.log("rejectPromiseAndDeleteFromHashTable for : "+t+" reason : "+n);var i=new Error(n);r&&(i.endCode=r);var s=e[t].promise;delete e[t],s.reject(i)}function L(){v.localParticipant.endpointId||(v.localParticipant.endpointId=r.newGuid()),v.localParticipant.participantId||(v.localParticipant.participantId=r.newGuid()),e.signalingAgentConfig.languageCode&&(v.localParticipant.languageId=e.signalingAgentConfig.languageCode),e.telemetryHelper.setEndPointId(v.localParticipant.endpointId)}function A(n,i){if(b.hasOwnProperty(n)){e.timeoutManager.stopTimer(t.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,n),w.log("participantRemove failed for : "+n+" reason : "+r.getPrintableObject(i));var s=M(i);k(b,n,s.phrase,s)}}function O(n){for(var i in n.participants)if(n.participants.hasOwnProperty(i)&&y.hasOwnProperty(i)){e.timeoutManager.stopTimer(t.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,i);var s=n.participants[i];w.log("participantAdd failed for : "+i+" reason : "+r.getPrintableObject(s));var o=M(s);k(y,i,o.phrase,o)}}function M(e){var n={code:e.code,subCode:e.subCode,phrase:e.phrase};return e.code===t.CALL_END_CODE.CALL_MODALITY_FAILURE&&e.callControllerTransactionEnd&&(n={code:e.callControllerTransactionEnd.code,subCode:e.callControllerTransactionEnd.subCode,phrase:e.callControllerTransactionEnd.phrase}),n}function _(e){w.log("rejectLocalQueuedOperations");var n={code:t.CALL_END_CODE.SUCCESS,subcode:t.CALL_END_SUB_CODE.SUCCESS,phrase:t.CALL_END_PHRASE.LOCAL_USER_INITIATED};for(var r in y)y.hasOwnProperty(r)&&k(y,r,e,n);for(var i in b)b.hasOwnProperty(i)&&k(b,i,e,n);y={},b={},v.connectedRemoteParticipantIds={}}var v=this,m=!1,g=-1,y={},b={},w=e.logger;v.connectedRemoteParticipantIds={},v.localParticipant=d,L(),v.setParticipantId=function(e){e&&(v.localParticipant.participantId=e)},v.addParticipantAsync=function(e,t,n){w.log("addParticipantAsync called for : "+e.id);var i=h.task();return v.connectedRemoteParticipantIds.hasOwnProperty(e.id)?(w.error("the given participant is already connected to the call : "+e.id),i.reject(new Error("the given participant is already connected to the call"))):y.hasOwnProperty(e.id)?(w.error("there is an existing pending request to add the participant : "+e.id),i.reject(new Error("there is an existing pending request to add the participant"))):(r.tryAddNewKeyToHashTable(y,e.id,{participant:e,promise:i}),n&&E(e,t)),i.promise},v.removeParticipantAsync=function(i,s){w.log("removeParticipantAsync called for : "+i.id),r.assertNotNullOrEmpty(s,"correct removeParticipantUrl is not provided");var f=h.task(),l=r.getHashTableCount(v.connectedRemoteParticipantIds);if(l===0)w.error("There are no participants to remove : "+i.id),f.reject(new Error("There are no participants to remove"));else if(l===1)w.error("cannot remove a participant from a 2 party call : "+i.id),f.reject(new Error("cannot remove a participant from a 2 party call. End the call instead"));else if(v.connectedRemoteParticipantIds.hasOwnProperty(i.id)){r.tryAddNewKeyToHashTable(b,i.id,{participant:i,promise:f}),e.timeoutManager.startTimer(t.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,function(){e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.REMOVE_PARTICIPANT_TIMEOUT),e.timeoutManager.stopTimer(t.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,i.id),k(b,i.id,"timed out waiting for participant to not show up in roster",{code:t.CALL_END_CODE.TIMEOUT,subcode:t.CALL_END_SUB_CODE.CALL_PARTICIPANT_REMOVAL_TIMEOUT,phrase:t.CALL_END_PHRASE.PARTICIPANT_REMOVAL_TIMEOUT})},i.id);var p=c.build(),d=o.getPayload(e,i);a.get(e,n.NETWORK_REQUESTS.REMOVE_PARTICIPANT,d).then(function(e){return u.post(s,e)}).then(function(){m||e.telemetryHelper.addNetworkOperationCompleted(n.NETWORK_REQUESTS.REMOVE_PARTICIPANT,!0,p.duration())}).catch(function(s){var o=r.getPrintableObject(s);w.error("removeParticipantAsync failed because : "+o),m||(e.telemetryHelper.addNetworkOperationCompleted(n.NETWORK_REQUESTS.REMOVE_PARTICIPANT,!1,p.duration()),e.timeoutManager.stopTimer(t.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,i.id),k(b,i.id,o,{code:t.CALL_END_CODE.NETWORK_ERROR,subcode:t.CALL_END_SUB_CODE.FAILED_TO_REACH_SERVICE,phrase:t.CALL_END_PHRASE.NETWORK_ERROR}))})}else w.error("cannot remove a participant not connected to the call : "+i.id),f.reject(new Error("cannot remove a participant not connected to the call"));return f.promise},v.getParticipantsToInitiateCallWith=function(){w.log("getParticipantsToInitiateCallWith");var e=[];for(var t in y)y.hasOwnProperty(t)&&e.push(y[t].participant);return e},v.initializeForIncomingCall=function(){w.log("initializeForIncomingCall"),_("incoming calls cannot add/remove participants until call is connected")},v.handleAddParticipantSuccess=function(){w.log("handleAddParticipantSuccess"),e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.HANDLE_ADD_PARTICIPANT_SUCCESS)},v.handleAddParticipantFailure=function(t){w.log("handleAddParticipantFailure"),t.modalityFailure?(w.error("handleAddParticipantFailure - got modalityFailure : "+r.getPrintableObject(t)),e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.HANDLE_ADD_PARTICIPANT_MODALITY_FAILURE)):t.participants&&(e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.HANDLE_ADD_PARTICIPANT_FAILURE),O(t))},v.handleRemoveParticipantFailure=function(t){w.log("handleRemoveParticipantFailure"),e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.HANDLE_REMOVE_PARTICIPANT_FAILURE);for(var r in t.participants)t.participants.hasOwnProperty(r)&&A(r,t.participants[r])},v.handleRemoveParticipantSuccess=function(){w.log("handleRemoveParticipantSuccess"),e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.HANDLE_REMOVE_PARTICIPANT_SUCCESS)},v.handleConversationUpdate=function(t){w.log("handleConversationUpdate"),e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.HANDLE_CONVERSATION_UPDATE);if(t.activeModalities&&t.activeModalities.hasOwnProperty("groupChat")){var r=t.activeModalities.groupChat.threadId;e.threadId!==r&&(e.threadId=r,e.spacesMessageId=t.activeModalities.groupChat.messageId||null,p.onConversationUpdated({threadId:r,spacesMessageId:e.spacesMessageId}))}},v.handleRosterUpdate=function(t){w.log("handleRosterUpdate"),e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.HANDLE_ROSTER_UPDATE);if(t.sequenceNumber<=g){w.log("ignoring rosterUpdate. Last seen seq = "+g+" current seq = "+t.sequenceNumber);return}g=t.sequenceNumber;var r=N();for(var i in t.participants)t.participants.hasOwnProperty(i)&&S(t.participants[i],r);x(r,t.participants)},v.dispose=function(){w.log("participantManager :: dispose"),m=!0,_("call ended"),e.telemetryHelper.setParticipantId(v.localParticipant.participantId)}};return p}),define("jSkype/services/NGCCallAgent/NGCCallAgent/mediaRenegotiationResponse",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder","jSkype/services/NGCCallAgent/NGCCallAgent/constants"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder"),r=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),i={};return i.getPayload=function(e,i,s){t.assertNotNull(e,"signalingSession cannot be null");var o=[];s&&(o=t.getMediaTypes(s),e.telemetryHelper.addOutgoingModalities(o));var u={payload:{mediaAnswer:{callModalities:o,sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId},links:{mediaAcknowledgement:n.get(e,r.URL_PATH.MEDIA_ACKNOWLEDGEMENT)},mediaContent:i},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId}}};return u},i}),define("jSkype/services/NGCCallAgent/NGCCallAgent/mediaRenegotiationRequest",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder","jSkype/services/NGCCallAgent/NGCCallAgent/constants"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/urlBuilder"),r=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),i={};return i.getPayload=function(e,i,s){t.assertNotNull(e,"signalingSession cannot be null");var o=[];s&&(o=t.getMediaTypes(s),e.telemetryHelper.addOutgoingModalities(o));var u={payload:{mediaNegotiation:{callModalities:o,sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId},links:{mediaAnswer:n.get(e,r.URL_PATH.MEDIA_ANSWER),rejection:n.get(e,r.URL_PATH.MEDIA_REJECTION)},mediaContent:i},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId}}};return u},i}),define("jSkype/services/NGCCallAgent/NGCCallAgent/mediaAcknowledgementRequest",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n={};return n.getPayload=function(e){t.assertNotNull(e,"signalingSession cannot be null");var n={payload:{debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId}}};return n},n}),define("jSkype/services/NGCCallAgent/NGCCallAgent/mediaRenegotiationRejectionResponse",["require","jSkype/services/NGCCallAgent/NGCCallAgent/utils"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),n={};return n.getPayload=function(e,n){t.assertNotNull(e,"signalingSession cannot be null"),t.assertCallEndReason(n);var r={payload:{mediaNegotiationFailure:{sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId},code:n.code,subcode:n.subcode,phrase:n.phrase},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId}}};return r},n}),define("jSkype/services/NGCCallAgent/NGCCallAgent/mediaRenegotiationManager",["require","jSkype/services/NGCCallAgent/NGCCallAgent/constants","jSkype/services/NGCCallAgent/NGCCallAgent/telemetryConstants","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/NGCCallAgent/NGCCallAgent/mediaRenegotiationResponse","jSkype/services/NGCCallAgent/NGCCallAgent/mediaRenegotiationRequest","jSkype/services/NGCCallAgent/NGCCallAgent/mediaAcknowledgementRequest","jSkype/services/NGCCallAgent/NGCCallAgent/mediaRenegotiationRejectionResponse","jSkype/services/serviceAccessLayer/requestDispatcher","jSkype/services/NGCCallAgent/NGCCallAgent/requestBuilder","swx-utils-common","jcafe-property-model"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/telemetryConstants"),r=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),i=e("jSkype/services/NGCCallAgent/NGCCallAgent/mediaRenegotiationResponse"),s=e("jSkype/services/NGCCallAgent/NGCCallAgent/mediaRenegotiationRequest"),o=e("jSkype/services/NGCCallAgent/NGCCallAgent/mediaAcknowledgementRequest"),u=e("jSkype/services/NGCCallAgent/NGCCallAgent/mediaRenegotiationRejectionResponse"),a=e("jSkype/services/serviceAccessLayer/requestDispatcher"),f=e("jSkype/services/NGCCallAgent/NGCCallAgent/requestBuilder"),l=e("swx-utils-common").stopwatch,c=e("jcafe-property-model"),h=function(e,h){function w(i){b.log("raiseMediaRenegotiationOffer"),y[t.LINKS.MEDIA_ANSWER]=i.mediaNegotiation.links.mediaAnswer,y[t.LINKS.MEDIA_REJECTION]=i.mediaNegotiation.links.rejection;var s=[];i.mediaNegotiation.callModalities&&i.mediaNegotiation.callModalities.length>0&&(s=r.getMediaTypes(i.mediaNegotiation.callModalities),e.telemetryHelper.addIncomingModalities(s),r.arrayContains(s,t.MEDIA_TYPES.SCREEN_SHARER)&&e.telemetryHelper.addVbssOperations(n.VBSS_OPERATION.REMOTE_START)),h.onOffer({mediaTypes:s,remoteParticipantId:e.getParticipantIdForOfferAnswer(i.mediaNegotiation.mediaContent),mediaContent:i.mediaNegotiation.mediaContent,renegotiation:!0})}function E(t,i){b.log("rejectMediaRenegotiation");var s=c.task(),o=l.build(),h=u.getPayload(e,i);return f.get(e,n.NETWORK_REQUESTS.SEND_MEDIA_REJECTION,h).then(function(e){return a.post(t,e)}).then(function(t){v||e.telemetryHelper.addNetworkOperationCompleted(n.NETWORK_REQUESTS.SEND_MEDIA_REJECTION,!0,o.duration()),r.safelyResolvePromise(s,t.response)}).catch(function(t){v||e.telemetryHelper.addNetworkOperationCompleted(n.NETWORK_REQUESTS.SEND_MEDIA_REJECTION,!1,o.duration());var i=r.getPrintableObject(t);b.error("rejectMediaRenegotiation failed because : "+i),r.safelyRejectPromise(s,new Error("rejectMediaRenegotiation failed because : "+i))}),s.promise}function S(){b.log("handleMediaAnswerTimeout"),d&&(d=!1,e.telemetryHelper.addVbssOperations(n.VBSS_OPERATION.TIMEOUT)),e.telemetryHelper.addIncomingModalities("Timeout"),e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.HANDLE_MEDIA_ANSWER_TIMEOUT),e.timeoutManager.stopTimer(t.TIMEOUT_OPERATIONS.MEDIA_ANSWER),p.handleMediaNegotiationFailure({code:t.CALL_END_CODE.TIMEOUT,subCode:t.CALL_END_SUB_CODE.MEDIA_FINAL_ANSWER_TIMEOUT,phrase:t.CALL_END_PHRASE.MEDIA_FINAL_ANSWER_TIMEOUT})}function x(){b.log("handleMediaAnswerAcknowledgmentTimeout"),e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.HANDLE_MEDIA_ACKNOWLEDGEMENT_TIMEOUT),e.timeoutManager.stopTimer(t.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT),h.onMediaAcknowledgementFailure(!0,new Error("timed out waiting for Media Answer Acknowledgement"))}var p=this,d=!1,v=!1,m=t.MEDIA_RENEGOTIATION_FSM_STATE.IDLE,g={code:t.CALL_END_CODE.GLARE_ERROR,subCode:t.CALL_END_SUB_CODE.GLARE_ERROR,phrase:t.CALL_END_PHRASE.RENEGOTIATION_IN_PROGRESS},y={},b=e.logger.createChild(function(){return"["+m+"]"});p.isOutgoingRenegotiationInProgress=function(){return m===t.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION||m===t.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE},p.isIncomingRenegotiationInProgress=function(){return m===t.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION||m===t.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE},p.acceptRenegotiationAsync=function(s,o,u){b.log("acceptRenegotiationAsync called"),o&&b.log("acceptRenegotiationAsync called with mediaTypes : "+r.getPrintableObject(o)),e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.ACCEPT_RENEGOTIATION),r.assertNotNullOrEmpty(y[t.LINKS.MEDIA_ANSWER],"MediaAnswer link not set");var h=c.task();switch(m){case t.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:m=t.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED;break;case t.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:m=t.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION;break;default:return b.log("there is no incoming media renegotiation offer to accept "),h.reject(new Error("there is no incoming media renegotiation offer to accept")),h.promise}e.telemetryHelper.setLocalOfferAnswerDuration(n.LOCAL_OFFER_ANSWER_TIMES.RENEGOTIATION_ANSWER_TIME+":"+u),e.timeoutManager.startTimer(t.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT,x);var p=l.build(),d=i.getPayload(e,s,o);return f.get(e,n.NETWORK_REQUESTS.SEND_MEDIA_ANSWER,d).then(function(e){return a.post(y[t.LINKS.MEDIA_ANSWER],e)}).then(function(t){v||e.telemetryHelper.addNetworkOperationCompleted(n.NETWORK_REQUESTS.SEND_MEDIA_ANSWER,!0,p.duration()),r.safelyResolvePromise(h,t.response)}).catch(function(i){var s=r.getPrintableObject(i);b.error("acceptRenegotiationAsync failed because : "+s),v||(e.telemetryHelper.addNetworkOperationCompleted(n.NETWORK_REQUESTS.SEND_MEDIA_ANSWER,!1,p.duration()),e.timeoutManager.stopTimer(t.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT)),r.safelyRejectPromise(h,new Error("acceptRenegotiationAsync failed because : "+s))}),h.promise},p.startRenegotiationAsync=function(i,o,u,p){b.log("startRenegotiationAsync called "),e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.START_RENEGOTIATION),r.assertNotNullOrEmpty(o,"MediaRenegotiation link not set");var y=c.task();switch(m){case t.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED:m=t.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION;break;case t.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:case t.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:case t.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:return b.log("media renegotiation can only be performed with no current outstanding renegotiations."),h.onMediaRenegotiationRejection(g),y.resolve(null).promise;default:return b.log("media renegotiation can only be performed on an established call"),y.reject(new Error("media renegotiation can only be performed on an established call")),y.promise}e.telemetryHelper.setLocalOfferAnswerDuration(n.LOCAL_OFFER_ANSWER_TIMES.RENEGOTIATION_OFFER_TIME+":"+p),e.timeoutManager.startTimer(t.TIMEOUT_OPERATIONS.MEDIA_ANSWER,S);var w=l.build(),E=s.getPayload(e,i,u),x=u&&r.arrayContains(u,t.MEDIA_TYPES.SCREEN_SHARER);return x?(d=!0,e.telemetryHelper.addVbssOperations(n.VBSS_OPERATION.START)):!x&&d&&(d=!1,e.telemetryHelper.addVbssOperations(n.VBSS_OPERATION.STOP)),f.get(e,n.NETWORK_REQUESTS.START_RENEGOTIATION,E).then(function(e){return a.post(o,e)}).then(function(t){v||e.telemetryHelper.addNetworkOperationCompleted(n.NETWORK_REQUESTS.START_RENEGOTIATION,!0,w.duration()),r.safelyResolvePromise(y,t.response)}).catch(function(i){var s=r.getPrintableObject(i);b.error("startRenegotiationAsync failed because : "+s);if(!v){switch(m){case t.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:m=t.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED;break;case t.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:m=t.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION;break;default:}e.telemetryHelper.addNetworkOperationCompleted(n.NETWORK_REQUESTS.START_RENEGOTIATION,!1,w.duration()),e.timeoutManager.stopTimer(t.TIMEOUT_OPERATIONS.MEDIA_ANSWER)}r.safelyRejectPromise(y,new Error("startRenegotiationAsync failed because : "+s))}),y.promise},p.handleMediaAcknowledgment=function(){b.log("handleMediaAcknowledgment"),e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.HANDLE_MEDIA_ACKNOWLEDGEMENT),e.timeoutManager.stopTimer(t.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT),h.onMediaAcknowledgementSuccess(!0)},p.onCallConnected=function(){b.log("onCallConnected"),m=t.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED},p.handleMediaNegotiationFailure=function(i){b.log("handleMediaNegotiationFailure called . Details : "+r.getPrintableObject(i)),e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.HANDLE_MEDIA_NEGOTIATION_FAILURE),e.timeoutManager.stopTimer(t.TIMEOUT_OPERATIONS.MEDIA_ANSWER);switch(m){case t.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:m=t.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED;break;case t.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:m=t.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION;break;default:return}d&&(d=!1,e.telemetryHelper.addVbssOperations(n.VBSS_OPERATION.REJECTED)),e.telemetryHelper.addIncomingModalities("Rejected"),h.onMediaRenegotiationRejection({code:i.code,subCode:i.subCode,phrase:i.phrase})},p.handleMediaAnswer=function(i){b.log("handleMediaAnswer called"),e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.HANDLE_MEDIA_ANSWER);switch(m){case t.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:m=t.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED;break;case t.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:m=t.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION;break;default:return}e.timeoutManager.stopTimer(t.TIMEOUT_OPERATIONS.MEDIA_ANSWER);var s=[];i.mediaAnswer.callModalities&&i.mediaAnswer.callModalities.length>0&&(s=r.getMediaTypes(i.mediaAnswer.callModalities),e.telemetryHelper.addIncomingModalities(s)),h.onAnswer({provisional:!1,renegotiation:!0,mediaTypes:s,remoteParticipantId:e.getParticipantIdForOfferAnswer(i.mediaAnswer.mediaContent),mediaContent:i.mediaAnswer.mediaContent});var u=l.build(),c=o.getPayload(e);f.get(e,n.NETWORK_REQUESTS.SEND_MEDIA_ACKNOWLEDGEMENT,c).then(function(e){return a.post(i.mediaAnswer.links.mediaAcknowledgement,e)}).then(function(){v||e.telemetryHelper.addNetworkOperationCompleted(n.NETWORK_REQUESTS.SEND_MEDIA_ACKNOWLEDGEMENT,!0,u.duration())}).catch(function(t){var i=r.getPrintableObject(t);b.error("sending mediaAcknowledgement failed because : "+i),v||e.telemetryHelper.addNetworkOperationCompleted(n.NETWORK_REQUESTS.SEND_MEDIA_ACKNOWLEDGEMENT,!1,u.duration())})},p.handleMediaNegotiationOffer=function(r){b.log("handleMediaNegotiationOffer called"),e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.HANDLE_MEDIA_OFFER);switch(m){case t.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:m=t.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE,w(r);break;case t.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED:m=t.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,w(r);break;default:b.error("Cannot handle the incoming mediaRenegotiation offer in present callstate. Either call not connected or renegotiation in progress"),E(r.mediaNegotiation.links.rejection,g)}},p.rejectRenegotiationAsync=function(i){b.log("rejectRenegotiationAsync called"),e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.REJECT_RENEGOTIATION),r.assertNotNullOrEmpty(y[t.LINKS.MEDIA_REJECTION],"MediaRejection link not set");var s=i||{code:t.CALL_END_CODE.NOT_ACCEPTABLE_HERE,subCode:t.CALL_END_SUB_CODE.MEDIA_ANSWER_PROCESSING_ERROR,phrase:t.CALL_END_PHRASE.MEDIA_ANSWER_ERROR};switch(m){case t.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:return m=t.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,E(y[t.LINKS.MEDIA_REJECTION],s);case t.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:return m=t.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION,E(y[t.LINKS.MEDIA_REJECTION],s);default:return b.error("There is no incoming media renegotiation offer to reject"),c.task().resolve(null).promise}},p.handleRetargetCompleted=function(t){e.telemetryHelper.addLocalOperation(n.LOCAL_OPERATIONS.HANDLE_RETARGET_COMPLETED);var i=r.getPrintableObject(t);b.log("handleRetargetCompleted called with : "+i),t.code===0?h.onReTargetCompletedSuccess():h.onReTargetCompletedFailure(i)},p.dispose=function(){b.log("mediaRenegotiationManager :: dispose"),v=!0}};return h}),define("jSkype/services/NGCCallAgent/NGCCallAgent/timeoutManager",["require","jSkype/services/NGCCallAgent/NGCCallAgent/constants","jSkype/services/NGCCallAgent/NGCCallAgent/utils"],function(e){var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),r=function(e){var r=this,i={},s=e.logger;r.startTimer=function(e,r,o){s.log("startTimer called for : "+e);var u=0;switch(e){case t.TIMEOUT_OPERATIONS.ADD_PARTICIPANT:n.assertNotNullOrEmpty(o,"remoteParticipantId must be specified for : "+e),u=t.TIMEOUT_VALUES_IN_SECONDS.ADD_PARTICIPANT_TIMEOUT*1e3,e=e+"_"+o;break;case t.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT:n.assertNotNullOrEmpty(o,"remoteParticipantId must be specified for : "+e),u=t.TIMEOUT_VALUES_IN_SECONDS.REMOVE_PARTICIPANT_TIMEOUT*1e3,e=e+"_"+o;break;case t.TIMEOUT_OPERATIONS.INCOMING_CALL_ESTABLISHMENT:u=t.TIMEOUT_VALUES_IN_SECONDS.INCOMING_CALL_ESTABLISHMENT_TIMEOUT*1e3;break;case t.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT:u=t.TIMEOUT_VALUES_IN_SECONDS.OUTGOING_CALL_ESTABLISHMENT_TIMEOUT*1e3;break;case t.TIMEOUT_OPERATIONS.MEDIA_ANSWER:u=t.TIMEOUT_VALUES_IN_SECONDS.MEDIA_ANSWER_TIMEOUT*1e3;break;case t.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT:u=t.TIMEOUT_VALUES_IN_SECONDS.MEDIA_ANSWER_ACKNOWLEDGEMENT_TIMEOUT*1e3;break;default:return}var a=setTimeout(r,u);i[e]=a},r.stopTimer=function(e,r){switch(e){case t.TIMEOUT_OPERATIONS.ADD_PARTICIPANT:case t.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT:n.assertNotNullOrEmpty(r,"remoteParticipantId must be specified for : "+e),e=e+"_"+r;break;default:}s.log("stopTimer called for : "+e),i.hasOwnProperty(e)&&(clearTimeout(i[e]),delete i[e])},r.dispose=function(){s.log("timeoutManager :: dispose");for(var e in i)i.hasOwnProperty(e)&&r.stopTimer(e)}};return r}),define("jSkype/services/NGCCallAgent/NGCCallAgent/signalingSession",["require","exports","module","jSkype/services/NGCCallAgent/NGCCallAgent/constants","jSkype/services/NGCCallAgent/NGCCallAgent/telemetryConstants","jSkype/services/NGCCallAgent/NGCCallAgent/participant","jSkype/services/NGCCallAgent/NGCCallAgent/utils","jSkype/services/serviceAccessLayer/requestDispatcher","jSkype/services/NGCCallAgent/NGCCallAgent/requestBuilder","jSkype/services/NGCCallAgent/NGCCallAgent/createConversationRequest","jSkype/services/NGCCallAgent/NGCCallAgent/joinGivenConversationRequest","jSkype/services/NGCCallAgent/NGCCallAgent/joinGivenConversationWithoutCallModalityRequest","jSkype/services/NGCCallAgent/NGCCallAgent/leaveConversationRequest","jSkype/services/NGCCallAgent/NGCCallAgent/cancelCallRequest","jSkype/services/NGCCallAgent/NGCCallAgent/endCallRequest","jSkype/services/NGCCallAgent/NGCCallAgent/provisionalMediaResponse","jSkype/services/NGCCallAgent/NGCCallAgent/callAcceptanceRequest","jSkype/services/NGCCallAgent/NGCCallAgent/rejectCallRequest","jSkype/services/NGCCallAgent/NGCCallAgent/joinConversationForConnectedCallRequest","jSkype/services/NGCCallAgent/NGCCallAgent/attachCallRequest","jSkype/services/NGCCallAgent/NGCCallAgent/callProgressRequest","jSkype/services/NGCCallAgent/NGCCallAgent/callAcceptanceAcknowledgementRequest","jSkype/services/NGCCallAgent/NGCCallAgent/participantUpdateRequest","jSkype/services/NGCCallAgent/NGCCallAgent/updateParticipantConversationLinksRequest","jcafe-property-model","jSkype/settings","constants/common","swx-utils-common","jSkype/services/NGCCallAgent/NGCCallAgent/telemetryHelper","jSkype/services/NGCCallAgent/NGCCallAgent/participantManager","jSkype/services/NGCCallAgent/NGCCallAgent/mediaRenegotiationManager","jSkype/services/NGCCallAgent/NGCCallAgent/timeoutManager"],function(e,t){var n=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),r=e("jSkype/services/NGCCallAgent/NGCCallAgent/telemetryConstants"),i=e("jSkype/services/NGCCallAgent/NGCCallAgent/participant"),s=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils"),o=e("jSkype/services/serviceAccessLayer/requestDispatcher"),u=e("jSkype/services/NGCCallAgent/NGCCallAgent/requestBuilder"),a=e("jSkype/services/NGCCallAgent/NGCCallAgent/createConversationRequest"),f=e("jSkype/services/NGCCallAgent/NGCCallAgent/joinGivenConversationRequest"),l=e("jSkype/services/NGCCallAgent/NGCCallAgent/joinGivenConversationWithoutCallModalityRequest"),c=e("jSkype/services/NGCCallAgent/NGCCallAgent/leaveConversationRequest"),h=e("jSkype/services/NGCCallAgent/NGCCallAgent/cancelCallRequest"),p=e("jSkype/services/NGCCallAgent/NGCCallAgent/endCallRequest"),d=e("jSkype/services/NGCCallAgent/NGCCallAgent/provisionalMediaResponse"),v=e("jSkype/services/NGCCallAgent/NGCCallAgent/callAcceptanceRequest"),m=e("jSkype/services/NGCCallAgent/NGCCallAgent/rejectCallRequest"),g=e("jSkype/services/NGCCallAgent/NGCCallAgent/joinConversationForConnectedCallRequest"),y=e("jSkype/services/NGCCallAgent/NGCCallAgent/attachCallRequest"),b=e("jSkype/services/NGCCallAgent/NGCCallAgent/callProgressRequest"),w=e("jSkype/services/NGCCallAgent/NGCCallAgent/callAcceptanceAcknowledgementRequest"),E=e("jSkype/services/NGCCallAgent/NGCCallAgent/participantUpdateRequest"),S=e("jSkype/services/NGCCallAgent/NGCCallAgent/updateParticipantConversationLinksRequest"),x=e("jcafe-property-model"),T=e("jSkype/settings"),N=e("constants/common"),C=e("swx-utils-common").stopwatch,k=e("jSkype/services/NGCCallAgent/NGCCallAgent/telemetryHelper"),L=e("jSkype/services/NGCCallAgent/NGCCallAgent/participantManager"),A=e("jSkype/services/NGCCallAgent/NGCCallAgent/mediaRenegotiationManager"),O=e("jSkype/services/NGCCallAgent/NGCCallAgent/timeoutManager"),M=function(e,t,M,_,D){function $(e){F=!0,H[n.LINKS.CONVERSATION_CONTROLLER]=e.conversationController,H[n.LINKS.ADD_PARTICIPANT_AND_MODALITY]=e.links.addParticipantAndModality,H[n.LINKS.LEAVE]=e.links.leave,H[n.LINKS.NOTIFICATION_LINKS]=e.links.notificationLinks,H[n.LINKS.REMOVE_PARTICIPANT]=e.links.removeParticipant,P.convSubject=e.subject,e.activeModalities&&e.activeModalities.groupChat&&(P.threadId=e.activeModalities.groupChat.threadId,e.activeModalities.groupChat.messageId&&(P.spacesMessageId=e.activeModalities.groupChat.messageId)),e.state&&(P.multiParty=e.state.isMultiParty)}function J(e){var t=x.task(),i=e||{code:n.CALL_END_CODE.CANCEL,subCode:n.CALL_END_SUB_CODE.SUCCESS,phrase:n.CALL_END_PHRASE.LOCAL_USER_INITIATED};if(!H.hasOwnProperty(n.LINKS.LEAVE))X.log("Conversation Service Leave Url is not yet set. Cannot leave conversation. Disposing anyways."),P.telemetryHelper.setTerminatingData({terminatingEnd:r.CALL_TERMINATING_END.LOCAL,resultDetail:"Conversation Service Leave Url is not yet set",endCode:n.CALL_END_CODE.CANCEL,endSubCode:n.CALL_END_SUB_CODE.CONV_URL_NOT_SET}),bt(),i.subCode=n.CALL_END_SUB_CODE.CONV_URL_NOT_SET,Y(n.CALL_STATUS.LOCAL_TERMINATED,i),t.resolve(null);else{X.log("cancelling outgoing call"),j=n.SIGNALING_FSM_STATE.IDLE;var a=C.build(),f=h.getPayload(P,i);u.get(P,r.NETWORK_REQUESTS.CANCEL_CALL,f).then(function(e){return o.post(H[n.LINKS.LEAVE],e)}).then(function(e){I||(P.telemetryHelper.setTerminatingData({terminatingEnd:r.CALL_TERMINATING_END.LOCAL,resultDetail:"User cancelled call",endCode:n.CALL_END_CODE.CANCEL}),P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.CANCEL_CALL,!0,a.duration()),bt(),Y(n.CALL_STATUS.LOCAL_TERMINATED,i)),s.safelyResolvePromise(t,e.response)}).catch(function(e){var o=s.getPrintableObject(e);X.error("Cancelling call failed because : "+o),I||(P.telemetryHelper.setTerminatingData({terminatingEnd:r.CALL_TERMINATING_END.LOCAL,endCode:n.CALL_END_CODE.CANCEL,endSubCode:n.CALL_END_SUB_CODE.FAILED_TO_REACH_SERVICE,resultDetail:"Failed to Cancel Call. Error = "+o}),P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.CANCEL_CALL,!1,a.duration()),bt(),i.subCode=n.CALL_END_SUB_CODE.FAILED_TO_REACH_SERVICE,Y(n.CALL_STATUS.LOCAL_TERMINATED,i)),s.safelyResolvePromise(t,null)})}return t.promise}function K(e){var t=x.task();X.log("ending established call"),j=n.SIGNALING_FSM_STATE.IDLE;var i=F?r.NETWORK_REQUESTS.LEAVE_CONVERSATION:r.NETWORK_REQUESTS.END_CALL,o=C.build(),u=e||{code:n.CALL_END_CODE.SUCCESS,subCode:n.CALL_END_SUB_CODE.SUCCESS,phrase:n.CALL_END_PHRASE.LOCAL_USER_INITIATED};return Q(u).then(function(e){I||(P.telemetryHelper.setTerminatingData({terminatingEnd:r.CALL_TERMINATING_END.LOCAL}),P.telemetryHelper.addNetworkOperationCompleted(i,!0,o.duration()),bt(),Y(n.CALL_STATUS.LOCAL_TERMINATED,u)),s.safelyResolvePromise(t,e.response)}).catch(function(e){var a=s.getPrintableObject(e);X.error("Ending call failed because : "+a),I||(P.telemetryHelper.setTerminatingData({terminatingEnd:r.CALL_TERMINATING_END.LOCAL,endCode:n.CALL_END_CODE.SUCCESS,endSubCode:n.CALL_END_SUB_CODE.FAILED_TO_REACH_SERVICE,resultDetail:"Failed to end Call. Error = "+a}),P.telemetryHelper.addNetworkOperationCompleted(i,!1,o.duration()),bt(),u.subCode=n.CALL_END_SUB_CODE.FAILED_TO_REACH_SERVICE,Y(n.CALL_STATUS.LOCAL_TERMINATED,u)),s.safelyResolvePromise(t,null)}),t.promise}function Q(e){var t;return F?(X.log("leaving Conversation on ConversationService"),t=c.getPayload(P,e),u.get(P,r.NETWORK_REQUESTS.LEAVE_CONVERSATION,t).then(function(e){return o.post(H[n.LINKS.LEAVE],e)})):(X.log("ending call on CallController"),t=p.getPayload(P,e),u.get(P,r.NETWORK_REQUESTS.END_CALL,t).then(function(e){return o.remove(H[n.LINKS.HANGUP],e)}))}function G(e){X.log("rejecting incoming call");var t=x.task();j=n.SIGNALING_FSM_STATE.IDLE;var i=e||{code:n.CALL_END_CODE.REJECT,subCode:n.CALL_END_SUB_CODE.SUCCESS,phrase:n.CALL_END_PHRASE.LOCAL_USER_INITIATED},a=C.build(),f=m.getPayload(P,i);return u.get(P,r.NETWORK_REQUESTS.REJECT_CALL,f).then(function(e){return o.remove(H[n.LINKS.REJECT],e)}).then(function(e){I||(P.telemetryHelper.setTerminatingData({terminatingEnd:r.CALL_TERMINATING_END.LOCAL,endCode:n.CALL_END_CODE.REJECT,resultDetail:"User rejected call"}),P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.REJECT_CALL,!0,a.duration()),bt(),Y(n.CALL_STATUS.LOCAL_TERMINATED,i)),s.safelyResolvePromise(t,e.response)}).catch(function(e){var o=s.getPrintableObject(e);X.error("reject failed because : "+o),I||(P.telemetryHelper.setTerminatingData({terminatingEnd:r.CALL_TERMINATING_END.LOCAL,endCode:n.CALL_END_CODE.REJECT,endSubCode:n.CALL_END_SUB_CODE.FAILED_TO_REACH_SERVICE,resultDetail:"Failed to reject call. Error = "+o}),P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.REJECT_CALL,!1,a.duration()),bt(),Y(n.CALL_STATUS.LOCAL_TERMINATED,i)),s.safelyResolvePromise(t,null)}),t.promise}function Y(e,n){X.log("CallStatus changed : "+B+" => "+e),n&&X.log("onCallStatusChanged: statusCode = "+s.getPrintableObject(n)),Z(e)>Z(B)&&(B=e,t.onCallStatusChanged(e,n))}function Z(e){switch(e){case n.CALL_STATUS.IDLE:return 0;case n.CALL_STATUS.CONNECTED_FOR_ROSTER_ONLY:return 0;case n.CALL_STATUS.CONNECTING:return 1;case n.CALL_STATUS.RINGING:return 2;case n.CALL_STATUS.CONNECTED:return 3;case n.CALL_STATUS.LOCAL_TERMINATED:case n.CALL_STATUS.REMOTE_TERMINATED:return 4;default:return-1}}function et(e){X.log("handleCallAcceptanceAck called"),P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.HANDLE_CALL_ACCEPTANCE_ACK);if(j===n.SIGNALING_FSM_STATE.CONNECTED)return;H[n.LINKS.MEDIA_RENEGOTIATION]=e.callAcceptanceAcknowledgement.links.mediaRenegotiation,H[n.LINKS.TRANSFER]=e.callAcceptanceAcknowledgement.links.transfer,H[n.LINKS.REPLACE]=e.callAcceptanceAcknowledgement.links.replacement,H[n.LINKS.HANGUP]=e.callAcceptanceAcknowledgement.links.callLeg,H[n.LINKS.KEEPALIVE]=e.callAcceptanceAcknowledgement.links.callLeg,vt(e.callAcceptanceAcknowledgement.callKeepAliveInterval),j=n.SIGNALING_FSM_STATE.CONNECTED,P.timeoutManager.stopTimer(n.TIMEOUT_OPERATIONS.INCOMING_CALL_ESTABLISHMENT),P.telemetryHelper.startCallConnectedWatch(),P.mediaRenegotiationManager.onCallConnected(),Y(n.CALL_STATUS.CONNECTED);var t=C.build(),i=g.getPayload(P);u.get(P,r.NETWORK_REQUESTS.JOIN_CONVERSATION,i).then(function(e){return o.post(H[n.LINKS.CONVERSATION_CONTROLLER],e)}).then(function(e){if(!I){if(!e.response.roster)throw new Error("response does not contain a roster");P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.JOIN_CONVERSATION,!0,t.duration()),$(e.response),P.participantManager.handleRosterUpdate(e.response.roster)}}).catch(function(e){var n=s.getPrintableObject(e);X.error("ConversationJoin failed because : "+n),X.log("current call status : "+B),I||P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.JOIN_CONVERSATION,!1,t.duration())})}function tt(e,t,i,l,c){X.log("placeCall called"),P.telemetryHelper.setConversationServiceUrl(e.requestUrl),P.telemetryHelper.setLocalOfferAnswerDuration(r.LOCAL_OFFER_ANSWER_TIMES.INITIAL_OFFER_TIME+":"+c),z=i,W=t,P.timeoutManager.startTimer(n.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,yt),P.telemetryHelper.setCallerType(P.participantManager.localParticipant.id);var h=C.build(),p=e.newCall?a.getPayload(P,t,i,l):f.getPayload(P,t,i);u.get(P,r.NETWORK_REQUESTS.PLACE_CALL,p).then(function(t){return o.post(e.requestUrl,t)}).then(function(e){I||(P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.PLACE_CALL,!0,h.duration()),$(e.response),Y(n.CALL_STATUS.CONNECTING))}).catch(function(e){var t=s.getPrintableObject(e);X.error("placeCall failed because : "+t),I||(j=n.SIGNALING_FSM_STATE.IDLE,P.telemetryHelper.setTerminatingData({terminatingEnd:r.CALL_TERMINATING_END.LOCAL,resultValue:r.RESULT_VALUE.FAILURE,endCode:n.CALL_END_CODE.SERVICE_UNAVAILABLE,endSubCode:n.CALL_END_SUB_CODE.PLACE_CALL_FAILED,resultDetail:"Failed to place call. Error = "+t}),P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.PLACE_CALL,!1,h.duration()),bt(),Y(n.CALL_STATUS.LOCAL_TERMINATED,{code:n.CALL_END_CODE.NETWORK_ERROR,subCode:n.CALL_END_SUB_CODE.FAILED_TO_REACH_SERVICE,phrase:n.CALL_END_PHRASE.NETWORK_ERROR}))})}function nt(){X.log("updateConversationLinks");if(H.hasOwnProperty(n.LINKS.NOTIFICATION_LINKS)){X.log("sending conversation service UpdateNotificationLinks request");var e=C.build(),t=S.getPayload(P);u.get(P,r.NETWORK_REQUESTS.UPDATE_CONVERSATION_LINKS,t).then(function(e){return o.post(H[n.LINKS.NOTIFICATION_LINKS],e)}).then(function(t){I||(P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.UPDATE_CONVERSATION_LINKS,!0,e.duration()),$(t.response))}).catch(function(t){var n=s.getPrintableObject(t);X.error("sending conversation service UpdateNotificationLinks request failed because : "+n),I||P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.UPDATE_CONVERSATION_LINKS,!1,e.duration())})}}function rt(e){X.log("awaitCall called"),P.telemetryHelper.setCalleeType(P.participantManager.localParticipant.id);var t=atob(e.body.gp),i=JSON.parse(t);i.callNotification?it(i):(X.error("incomingCallData body does not have a callNotification section"),j=n.SIGNALING_FSM_STATE.IDLE,P.telemetryHelper.setTerminatingData({terminatingEnd:r.CALL_TERMINATING_END.LOCAL,resultValue:r.RESULT_VALUE.FAILURE,endCode:n.CALL_END_CODE.BAD_REQUEST,endSubCode:n.CALL_END_SUB_CODE.BAD_NOTIFICATION_PAYLOAD,resultDetail:"Invalid callNotification request"}),bt(),Y(n.CALL_STATUS.LOCAL_TERMINATED,{code:n.CALL_END_CODE.BAD_REQUEST,subCode:n.CALL_END_SUB_CODE.BAD_NOTIFICATION_PAYLOAD,phrase:n.CALL_END_PHRASE.BAD_NOTIFICATION_PAYLOAD}))}function it(e){U=i.fromWireParticipant(e.callNotification.from),H[n.LINKS.CONVERSATION_CONTROLLER]=e.conversationInvitation.conversationController,H[n.LINKS.ATTACH]=e.callNotification.links.attach,P.correlationId=e.debugContent.callId,P.participantManager.setParticipantId(e.debugContent.participantId),P.multiParty=!!e.conversationInvitation.isMultiParty,e.groupChat&&e.groupChat.threadId&&(P.threadId=e.groupChat.threadId,e.groupChat.messageId&&(P.spacesMessageId=e.groupChat.messageId)),Y(n.CALL_STATUS.IDLE),st(e)}function st(e){X.log("sendAttachToCall called");var t=e.callNotification.links.attach;P.timeoutManager.startTimer(n.TIMEOUT_OPERATIONS.INCOMING_CALL_ESTABLISHMENT,yt);var i=C.build(),a=y.getPayload(P);u.get(P,r.NETWORK_REQUESTS.SEND_CALL_ATTACH,a).then(function(e){return o.post(t,e)}).then(function(t){I||(P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.SEND_CALL_ATTACH,!0,i.duration()),ot(e,t))}).catch(function(e){var t=s.getPrintableObject(e);X.error("sendAttachToCall failed because : "+t),I||(j=n.SIGNALING_FSM_STATE.IDLE,P.telemetryHelper.setTerminatingData({terminatingEnd:r.CALL_TERMINATING_END.LOCAL,resultValue:r.RESULT_VALUE.FAILURE,endCode:n.CALL_END_CODE.SERVICE_UNAVAILABLE,endSubCode:n.CALL_END_SUB_CODE.ATTACH_CALL_FAILED,resultDetail:"Failed to attach to call. Error = "+t}),P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.SEND_CALL_ATTACH,!1,i.duration()),bt(),Y(n.CALL_STATUS.LOCAL_TERMINATED,{code:n.CALL_END_CODE.NETWORK_ERROR,subCode:n.CALL_END_SUB_CODE.ATTACH_FAILED,phrase:n.CALL_END_PHRASE.ATTACH_FAILED}))})}function ot(e,r){H[n.LINKS.MEDIA_ANSWER]=r.response.callInvitation.links.mediaAnswer,H[n.LINKS.ACCEPT]=r.response.callInvitation.links.acceptance,H[n.LINKS.REJECT]=r.response.callInvitation.links.callLeg,H[n.LINKS.REDIRECT]=r.response.callInvitation.links.redirection,ut(r),P.telemetryHelper.setCallerType(P.getParticipantIdForOfferAnswer(r.response.callInvitation.mediaContent));var i=s.getMediaTypes(r.response.callInvitation.callModalities);P.telemetryHelper.addIncomingModalities(i),t.onOffer({subject:e.conversationInvitation.subject,remoteParticipantId:P.getParticipantIdForOfferAnswer(r.response.callInvitation.mediaContent),mediaContent:r.response.callInvitation.mediaContent,remoteEndpointId:U.endpointId,mediaTypes:i,renegotiation:!1}),P.telemetryHelper.setTimeToRingDuration()}function ut(e){X.log("sendProgress called");var t=C.build(),n=b.getPayload(P);u.get(P,r.NETWORK_REQUESTS.SEND_CALL_PROGRESS,n).then(function(t){return o.post(e.response.callInvitation.links.progress,t)}).then(function(){I||P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.SEND_CALL_PROGRESS,!0,t.duration())}).catch(function(e){var n=s.getPrintableObject(e);X.error("sendProgress failed because : "+n),I||P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.SEND_CALL_PROGRESS,!1,t.duration())})}function at(e){X.log("handleMediaAnswer called"),H[n.LINKS.MEDIA_ACKNOWLEDGEMENT]=e.mediaAnswer.links.mediaAcknowledgement;if(P.mediaRenegotiationManager.isOutgoingRenegotiationInProgress()){P.mediaRenegotiationManager.handleMediaAnswer(e);return}P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.HANDLE_MEDIA_ANSWER),j!==n.SIGNALING_FSM_STATE.CONNECTED&&j===n.SIGNALING_FSM_STATE.OUTGOING&&(P.telemetryHelper.setTimeToRingDuration(),U=e.mediaAnswer.sender,Y(n.CALL_STATUS.RINGING),t.onAnswer({provisional:!0,renegotiation:!1,remoteEndpointId:e.mediaAnswer.sender?e.mediaAnswer.sender.endpointId:s.newGuid(),remoteParticipantId:P.getParticipantIdForOfferAnswer(e.mediaAnswer.mediaContent),mediaContent:e.mediaAnswer.mediaContent}))}function ft(e){X.log("handleCallAcceptance called"),P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.HANDLE_CALL_ACCEPTANCE),j===n.SIGNALING_FSM_STATE.OUTGOING&&(P.telemetryHelper.setTimeToRingDuration(),lt(e));var t=C.build(),i=w.getPayload(P);u.get(P,r.NETWORK_REQUESTS.SEND_ACCEPTANCE_ACKNOWLEDGEMENT,i).then(function(t){return o.post(e.callAcceptance.links.acknowledgement,t)}).then(function(){I||P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.SEND_ACCEPTANCE_ACKNOWLEDGEMENT,!0,t.duration())}).catch(function(e){var n=s.getPrintableObject(e);X.error("handleCallAcceptance failed because : "+n),I||P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.SEND_ACCEPTANCE_ACKNOWLEDGEMENT,!1,t.duration())})}function lt(e){j=n.SIGNALING_FSM_STATE.CONNECTED,P.timeoutManager.stopTimer(n.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),P.telemetryHelper.startCallConnectedWatch(),P.mediaRenegotiationManager.onCallConnected();var r=z,o=s.newGuid();e.callAcceptance.acceptedBy&&(U=i.fromWireParticipant(e.callAcceptance.acceptedBy),o=e.callAcceptance.acceptedBy.endpointId),e.callAcceptance.acceptedCallModalities&&e.callAcceptance.acceptedCallModalities.length>0&&(r=e.callAcceptance.acceptedCallModalities);var u=s.getMediaTypes(r);P.telemetryHelper.addIncomingModalities(u),H[n.LINKS.MEDIA_RENEGOTIATION]=e.callAcceptance.links.mediaRenegotiation,H[n.LINKS.TRANSFER]=e.callAcceptance.links.transfer,H[n.LINKS.REPLACE]=e.callAcceptance.links.replacement,H[n.LINKS.HANGUP]=e.callAcceptance.links.callLeg,H[n.LINKS.KEEPALIVE]=e.callAcceptance.links.callLeg,vt(e.callAcceptance.callKeepAliveInterval),t.onAnswer({provisional:!1,renegotiation:!1,remoteEndpointId:o,remoteParticipantId:P.getParticipantIdForOfferAnswer(e.callAcceptance.mediaContent),mediaTypes:u,mediaContent:e.callAcceptance.mediaContent}),Y(n.CALL_STATUS.CONNECTED)}function ct(e){X.log("Call End received . Details : "+s.getPrintableObject(e)),P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.HANDLE_CALL_END);if(j===n.SIGNALING_FSM_STATE.IDLE){X.log("Not handling incoming callEnd since fsmstate = SIGNALING_FSM_STATE.IDLE");return}if(e.code===n.CALL_END_CODE.SUCCESS&&e.subCode===n.CALL_END_SUB_CODE.CONVERSATION_RESOLUTION_CONFLICT)ht(e);else{var t=e.code===n.CALL_END_CODE.SUCCESS||e.code===n.CALL_END_CODE.CANCEL||e.code===n.CALL_END_CODE.REJECT;P.telemetryHelper.setTerminatingData({terminatingEnd:r.CALL_TERMINATING_END.REMOTE,resultDetail:e.phrase,resultValue:t?r.RESULT_VALUE.SUCCESS:r.RESULT_VALUE.FAILURE,endCode:e.code,endSubCode:e.subCode}),bt(),j=n.SIGNALING_FSM_STATE.IDLE,Y(n.CALL_STATUS.REMOTE_TERMINATED,{code:e.code,subCode:e.subCode,phrase:e.phrase})}}function ht(e){X.log("handleConversationResolutionConflict"),j=n.SIGNALING_FSM_STATE.IDLE,P.timeoutManager.stopTimer(n.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),P.joinGivenConversation(e.conversationUrl.location,e.correlationId,W,z)}function pt(){P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.HANDLE_CALL_PROGRESS),j===n.SIGNALING_FSM_STATE.OUTGOING&&(P.telemetryHelper.setTimeToRingDuration(),Y(n.CALL_STATUS.RINGING))}function dt(){B!==n.CALL_STATUS.CONNECTED?P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.HANDLE_MEDIA_ACKNOWLEDGEMENT):P.mediaRenegotiationManager.handleMediaAcknowledgment()}function vt(e){var t=.9*e*1e3;X.log("sending KeepAlives every "+t+" milliseconds"),q=window.setInterval(mt,t)}function mt(){X.log("sendKeepAlive called. Call disposed : "+I);if(I)return;X.log("sending keepAlive count = "+R++),gt(u.get(P,r.NETWORK_REQUESTS.SEND_KEEP_ALIVE,null))}function gt(e){var t=C.build();e.then(function(e){return o.post(H[n.LINKS.KEEPALIVE],e)}).then(function(){I||P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.SEND_KEEP_ALIVE,!0,t.duration())}).catch(function(e){var n=s.getPrintableObject(e);X.error("sendToKeepAliveUrl failed because : "+n),I||P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.SEND_KEEP_ALIVE,!1,t.duration())})}function yt(){X.log("handleCallEstablishmentTimeout"),P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.HANDLE_CALL_ESTABLISHMENT_TIMEOUT),P.telemetryHelper.setTerminatingData({terminatingEnd:r.CALL_TERMINATING_END.LOCAL,resultValue:r.RESULT_VALUE.FAILURE,resultDetail:n.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,endCode:n.CALL_END_CODE.TIMEOUT,endSubCode:n.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT}),bt(),j=n.SIGNALING_FSM_STATE.IDLE,Y(n.CALL_STATUS.LOCAL_TERMINATED,{code:n.CALL_END_CODE.TIMEOUT,subCode:n.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:n.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT})}function bt(){I||(X.log("dispose"),I=!0,q&&window.clearInterval(q),D.onCallCompleted(_),M.trouterUrl.changed.off(V),P.timeoutManager.dispose(),P.timeoutManager=null,P.participantManager.dispose(),P.participantManager=null,P.mediaRenegotiationManager.dispose(),P.mediaRenegotiationManager=null,P.telemetryHelper.dispose(),P.telemetryHelper=null)}var P=this,H={},B=null,j=n.SIGNALING_FSM_STATE.IDLE,F=!1,I=!1,q=null,R=1,U=null,z=null,W=null,X=M.logger.createChild(function(){return"SignalingAgent::["+P.correlationId+"]["+j+"]"},!0);P.convSubject=null,P.threadId=null,P.multiParty=!1,P.spacesMessageId=null,P.signalingAgentConfig=M,P.urlIdentifier=_,P.correlationId=_,P.logger=X,P.telemetryHelper=new k(P),P.mediaRenegotiationManager=new A(P,t),P.participantManager=new L(P,t,e),P.timeoutManager=new O(P),P.isGVCOutgoingEnabled=T.isFeatureOn(N.featureFlags.GVC_OUTGOING),P.isGVCJoiningEnabled=T.isFeatureOn(N.featureFlags.GVC_JOINING);var V=function(){X.log("onTrouterUrlChanged: disposed = "+I);if(I)return;P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.TROUTER_URL_CHANGED+":"+M.trouterUrl()),H.hasOwnProperty(n.LINKS.KEEPALIVE)&&(X.log("sending participantUpdateRequest"),gt(u.get(P,"participantUpdateRequest",E.getPayload(P)))),nt()};M.trouterUrl.changed(V),P.getParticipantIdForOfferAnswer=function(e){s.assertNotNull(e,"mediaContent should be a non null value");var t=null;return U&&!P.threadId&&!e.newOffer&&!e.escalationOccurring&&(t=U.id),t},P.setSubject=function(e){P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.SET_SUBJECT),s.assertNotNull(e,"subject should be a non null value"),P.convSubject=e},P.setMultiParty=function(){P.multiParty=!0},P.setThreadId=function(e,t){P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.SET_THREADID),s.assertNotNull(e,"threadId should be a non null value"),s.assert(!P.threadId,"conversation threadId has already been set. It cannot be overwritten"),P.threadId=e,t&&(P.spacesMessageId=t)},P.addParticipantAsync=function(e){return P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.ADD_PARTICIPANT),s.assertNotNull(e,"remoteParticipant should be a non null value"),s.assert(j===n.SIGNALING_FSM_STATE.CONNECTED||j===n.SIGNALING_FSM_STATE.IDLE,"remoteParticipants can only be added before starting an outgoing call or to an ongoing call"),j===n.SIGNALING_FSM_STATE.CONNECTED&&s.assertNotNullOrEmpty(P.threadId,"threadId must be set before adding more participants to connected call"),P.participantManager.addParticipantAsync(e,H[n.LINKS.ADD_PARTICIPANT_AND_MODALITY],j===n.SIGNALING_FSM_STATE.CONNECTED)},P.removeParticipantAsync=function(e){return P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.REMOVE_PARTICIPANT),s.assertNotNull(e,"remoteParticipant should be a non null value"),s.assert(j===n.SIGNALING_FSM_STATE.CONNECTED,"participants can only be removed from an ongoing call"),P.participantManager.removeParticipantAsync(e,H[n.LINKS.REMOVE_PARTICIPANT])},P.startOutgoingCall=function(e,t,i,o){P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.START_CALL),P.telemetryHelper.setDirection(r.DIRECTION.OUTGOING),P.telemetryHelper.setRole(r.ROLE.CALLER),P.telemetryHelper.startCallInitializationWatch(o),s.assertNotNull(e,"mediaContent should be a non null value"),s.assertNotNull(e.blob,"outgoingSdp should be a non null value"),s.assert(j===n.SIGNALING_FSM_STATE.IDLE,"a call is already in progress"),X.log("startOutgoingCall called"),j=n.SIGNALING_FSM_STATE.OUTGOING;var u={newCall:!0,requestUrl:M.conversationServiceUrl};tt(u,e,t,i,o)},P.joinGivenConversation=function(e,t,i,o,u){P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.JOIN_CALL),P.telemetryHelper.setDirection(r.DIRECTION.INCOMING),P.telemetryHelper.setRole(r.ROLE.JOIN),P.telemetryHelper.startCallInitializationWatch(u),s.assertNotNull(i,"mediaContent should be a non null value"),s.assertNotNull(i.blob,"outgoingSdp should be a non null value"),s.assertNotNull(t,"correlationId should be a non null value"),s.assertNotNullOrEmpty(e,"conversationUrl should be a non null value"),s.assert(j===n.SIGNALING_FSM_STATE.IDLE||j===n.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY,"a call is already in progress"),X.log("joinGivenConversation called with url = "+e+" , correlationId = "+t),j=n.SIGNALING_FSM_STATE.OUTGOING,P.correlationId=t,tt({newCall:!1,requestUrl:e},i,o,!1,u)},P.joinGivenConversationWithoutCallModality=function(e,t){P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY),P.telemetryHelper.setDirection(r.DIRECTION.INCOMING),P.telemetryHelper.setRole(r.ROLE.JOIN_FOR_ROSTER_ONLY),s.assertNotNull(t,"correlationId should be a non null value"),s.assertNotNullOrEmpty(e,"conversationUrl should be a non null value"),s.assert(j===n.SIGNALING_FSM_STATE.IDLE,"a call is already in progress"),X.log("joinGivenConversationWithoutCallModality called with url = "+e+" , correlationId = "+t),j=n.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY,P.correlationId=t,P.telemetryHelper.setConversationServiceUrl(e),P.telemetryHelper.setCallerType(P.participantManager.localParticipant.id);var i=C.build(),a=l.getPayload(P);u.get(P,r.NETWORK_REQUESTS.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY,a).then(function(t){return o.post(e,t)}).then(function(e){if(!I){if(!e.response.roster)throw new Error("response does not contain a roster");P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY,!0,i.duration()),j=n.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY,$(e.response),Y(n.CALL_STATUS.CONNECTED_FOR_ROSTER_ONLY),P.participantManager.handleRosterUpdate(e.response.roster)}}).catch(function(e){var t=s.getPrintableObject(e);X.error("joinGivenConversationWithoutCallModality failed because : "+t),I||(j=n.SIGNALING_FSM_STATE.IDLE,P.telemetryHelper.setTerminatingData({terminatingEnd:r.CALL_TERMINATING_END.LOCAL,resultValue:r.RESULT_VALUE.FAILURE,endCode:n.CALL_END_CODE.SERVICE_UNAVAILABLE,endSubCode:n.CALL_END_SUB_CODE.PLACE_CALL_FAILED,resultDetail:"Failed to join conversation without call modality. Error = "+t}),P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY,!1,i.duration()),bt(),Y(n.CALL_STATUS.LOCAL_TERMINATED,{code:n.CALL_END_CODE.NETWORK_ERROR,subCode:n.CALL_END_SUB_CODE.FAILED_TO_REACH_SERVICE,phrase:n.CALL_END_PHRASE.NETWORK_ERROR}))})},P.handleIncomingCall=function(e){P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.HANDLE_INCOMING_CALL),P.telemetryHelper.setDirection(r.DIRECTION.INCOMING),P.telemetryHelper.setRole(r.ROLE.CALLEE),P.telemetryHelper.startCallInitializationWatch(),s.assertNotNull(e,"request should be a non null value"),s.assertNotNullOrEmpty(e.body,"request should have a valid body"),s.assertNotNullOrEmpty(e.body.gp,"request does not look valid"),s.assert(j===n.SIGNALING_FSM_STATE.IDLE,"a call is already in progress"),X.log("handleIncomingCall called"),j=n.SIGNALING_FSM_STATE.INCOMING,P.participantManager.initializeForIncomingCall(),rt(e)},P.endAsync=function(e){return X.log("endAsync called"),I?x.task().resolve(null).promise:(P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.END_CALL),j===n.SIGNALING_FSM_STATE.INCOMING?G(e):j===n.SIGNALING_FSM_STATE.OUTGOING||j===n.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY?J(e):j===n.SIGNALING_FSM_STATE.WAITING_CALL_ACCEPTANCE_ACK?G(e):j===n.SIGNALING_FSM_STATE.CONNECTED||j===n.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY||P.mediaRenegotiationManager.isIncomingRenegotiationInProgress()||P.mediaRenegotiationManager.isOutgoingRenegotiationInProgress()?K(e):(X.log("There is no call to cancel or end or reject in current state"),P.telemetryHelper.setTerminatingData({terminatingEnd:r.CALL_TERMINATING_END.LOCAL,resultDetail:"There is no call to cancel or end or reject",endSubCode:n.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED}),bt(),Y(n.CALL_STATUS.LOCAL_TERMINATED,{code:n.CALL_END_CODE.SUCCESS,subCode:n.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:n.CALL_END_PHRASE.CALL_DOES_NOT_EXIST}),x.task().resolve(null).promise))},P.handleIncomingMsgAsync=function(e){s.assertNotNull(e,"request should be a non null value"),X.log("handleIncomingMsg called for url = "+e.url);var t=x.task(),r=e.body;if(!r)return X.error("handleIncomingMsg : received message with no body to : "+e.url),t.reject(new Error("received message with no body")),t.promise;if(I)return X.log("handleIncomingMsg : received message after call is disposed"),t.reject(new Error("received message after call is disposed")),t.promise;try{var i=r;if(i.callNotification)return t.reject(new Error("IncomingCallNotification should not be received in handleIncomingMsg")),t.promise;i.mediaAnswer?at(i):i.mediaAcknowledgement?dt():i.callAcceptance?ft(i):i.callEnd?ct(i.callEnd):i.callProgress?pt():i.callAcceptanceAcknowledgement?et(i):i.mediaNegotiation?P.mediaRenegotiationManager.handleMediaNegotiationOffer(i):i.mediaNegotiationFailure?P.mediaRenegotiationManager.handleMediaNegotiationFailure(i.mediaNegotiationFailure):i.retargetCompleted?P.mediaRenegotiationManager.handleRetargetCompleted(i.retargetCompleted):i.p2pForkNotification||(s.stringEndsWith(e.url,n.URL_PATH.CONV_ROSTER_UPDATE)?(X.debug("handleIncomingMsg : received rosterUpdate : "+s.getPrintableObject(i)),P.participantManager.handleRosterUpdate(i)):s.stringEndsWith(e.url,n.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS)?(X.log("handleIncomingMsg : received addParticipantSuccess : "+s.getPrintableObject(i)),P.participantManager.handleAddParticipantSuccess(i)):s.stringEndsWith(e.url,n.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)?(X.log("handleIncomingMsg : received addParticipantFailure : "+s.getPrintableObject(i)),P.participantManager.handleAddParticipantFailure(i)):s.stringEndsWith(e.url,n.URL_PATH.CONV_REMOVE_PARTICIPANT_SUCCESS)?(X.log("handleIncomingMsg : received removeParticipantSuccess : "+s.getPrintableObject(i)),P.participantManager.handleRemoveParticipantSuccess(i)):s.stringEndsWith(e.url,n.URL_PATH.CONV_REMOVE_PARTICIPANT_FAILURE)?(X.log("handleIncomingMsg : received removeParticipantFailure : "+s.getPrintableObject(i)),P.participantManager.handleRemoveParticipantFailure(i)):s.stringEndsWith(e.url,n.URL_PATH.CONV_UPDATE)?(X.log("handleIncomingMsg : received conversationUpdate : "+s.getPrintableObject(i)),$(i),P.participantManager.handleConversationUpdate(i)):s.stringEndsWith(e.url,n.URL_PATH.CONV_END)?(X.log("handleIncomingMsg : received conversationEnd : "+s.getPrintableObject(i)),ct(i)):X.error("handleIncomingMsg : received unknown message to : "+e.url+"  with body : "+s.getPrintableObject(i))),t.resolve(!0)}catch(o){X.error("handleIncomingMsg failed with error : "+o.message+"stack trace : "+o.stack),t.reject(new Error(o.message))}return t.promise},P.acceptRenegotiationAsync=function(e,t,r){return s.assertNotNull(e.blob,"finalSdp should be a non null value"),s.assert(j===n.SIGNALING_FSM_STATE.CONNECTED,"Renegotation operations are only allowed when the call is connected and no disconnect operation is in flight"),P.mediaRenegotiationManager.acceptRenegotiationAsync(e,t,r)},P.setProvisionalAnswerAsync=function(e,i){P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.SET_PROVISIONAL_ANSWER),s.assertNotNull(e.blob,"sdp should be a non null value"),X.log("setProvisionalAnswer called ");var a=x.task();if(j!==n.SIGNALING_FSM_STATE.INCOMING)return X.log("there is no incoming call to set provisional answer on."),a.reject(new Error("there is no incoming call to set provisional answer on.")),a.promise;P.telemetryHelper.setLocalOfferAnswerDuration(r.LOCAL_OFFER_ANSWER_TIMES.PROVISIONAL_ANSWER_TIME+":"+i);var f=C.build(),l=d.getPayload(P,e);return u.get(P,r.NETWORK_REQUESTS.SEND_MEDIA_ANSWER,l).then(function(e){return o.post(H[n.LINKS.MEDIA_ANSWER],e)}).then(function(e){I||(P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.SEND_MEDIA_ANSWER,!0,f.duration()),Y(n.CALL_STATUS.CONNECTING)),s.safelyResolvePromise(a,e.response),I||(X.log("handling inlined mediaAnswerAcknowledgement"),P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.HANDLE_MEDIA_ACKNOWLEDGEMENT),P.telemetryHelper.setTimeToRingDuration(),Y(n.CALL_STATUS.RINGING),t.onMediaAcknowledgementSuccess(!1))}).catch(function(e){I||P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.SEND_MEDIA_ANSWER,!1,f.duration());var t=s.getPrintableObject(e);X.error("setProvisionalAnswer failed because : "+t),s.safelyRejectPromise(a,new Error("setProvisionalAnswer failed because : "+t))}),a.promise},P.startRenegotiationAsync=function(e,t,r){return s.assertNotNull(e,"mediaContent should be a non null value"),s.assert(j===n.SIGNALING_FSM_STATE.CONNECTED,"Renegotation operations are only allowed when the call is connected and no disconnect operation is in flight"),P.mediaRenegotiationManager.startRenegotiationAsync(e,H[n.LINKS.MEDIA_RENEGOTIATION],t,r)},P.acceptAsync=function(e,t,i){P.telemetryHelper.addLocalOperation(r.LOCAL_OPERATIONS.ACCEPT_CALL),s.assertNotNull(e,"mediaContent should be a non null value"),s.assertNotNull(e.blob,"outgoingSdp should be a non null value"),X.log("accept called");var a=x.task();if(j!==n.SIGNALING_FSM_STATE.INCOMING)return X.log("there is no incoming call to accept"),a.reject(new Error("there is no incoming call to accept")),a.promise;P.telemetryHelper.setLocalOfferAnswerDuration(r.LOCAL_OFFER_ANSWER_TIMES.INITIAL_ANSWER_TIME+":"+i),j=n.SIGNALING_FSM_STATE.WAITING_CALL_ACCEPTANCE_ACK;var f=C.build(),l=v.getPayload(P,e,t);return u.get(P,r.NETWORK_REQUESTS.SEND_ACCEPTANCE,l).then(function(e){return o.post(H[n.LINKS.ACCEPT],e)}).then(function(e){I||(P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.SEND_ACCEPTANCE,!0,f.duration()),B===n.CALL_STATUS.IDLE&&(P.telemetryHelper.setTimeToRingDuration(),Y(n.CALL_STATUS.CONNECTING)),e.response.callAcceptanceAcknowledgement&&(X.log("handling inlined callAcceptanceAcknowledgement"),et(e.response))),s.safelyResolvePromise(a,e.response)}).catch(function(e){I||(P.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.SEND_ACCEPTANCE,!1,f.duration()),j=n.SIGNALING_FSM_STATE.INCOMING);var t=s.getPrintableObject(e);X.error("accept failed because : "+t),s.safelyRejectPromise(a,new Error("accept failed because : "+t))}),a.promise},P.rejectRenegotiationAsync=function(e){return s.assert(j===n.SIGNALING_FSM_STATE.CONNECTED,"Renegotation operations are only allowed when the call is connected and no disconnect operation is in flight"),P.mediaRenegotiationManager.rejectRenegotiationAsync(e)}};t.build=function(e,t,n,r,i){return new M(e,t,n,r,i)}}),define("jSkype/services/NGCCallAgent/NGCCallAgent/signalingAgent",["require","jSkype/services/NGCCallAgent/NGCCallAgent/signalingSession","jSkype/services/NGCCallAgent/NGCCallAgent/constants","constants/common","jSkype/services/NGCCallAgent/NGCCallAgent/utils"],function(e){function s(e){var s=this,o={},u=e.logger.createChild("SignalingAgent");i.assertNotNull(e,"signalingAgentConfig should be a non null value"),this.getNewSignalingSession=function(n,r){i.assertNotNull(n,"selfParticipant should be a non null value"),i.assertNotNull(r,"signalingSessionCallback should be a non null value");var a=i.newGuid();i.assertNotNullOrEmpty(a,"signalingSession id generated cannot be null or empty");var f=t.build(n,r,e,a,s);return o[a]=f,u.log("created new signalingSession with id "+a),f},this.handleIncomingNotification=function(e){i.assertNotNull(e,"request should be a non null value"),u.log("handleIncomingNotification to : "+e.url);if(!e.body)return u.error("request has no body"),r.badRequest;var t=r.OK,s=e.url.match(new RegExp("/"+i.escapeRegExp(n.URL_BASE.CALLAGENT)+"/+([^/]+)","i"));if(s){var a=s[1];o.hasOwnProperty(a)?o[a].handleIncomingMsgAsync(e).catch(function(e){u.error("handling IncomingMsg failed with error: "+e)}):(u.log("Incoming message for call id "+a+". But call not found !"),t=r.notFound)}else u.error("could not retrieve callId from Url path . Path = "+e.url),t=r.badRequest;return t},this.onCallCompleted=function(e){o.hasOwnProperty(e)?(delete o[e],u.log("Call id "+e+" found. Deleted from signalingSession table")):u.error("Call id "+e+" not found. Could not delete from signalingSession table")}}var t=e("jSkype/services/NGCCallAgent/NGCCallAgent/signalingSession"),n=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),r=e("constants/common").httpStatusCodes,i=e("jSkype/services/NGCCallAgent/NGCCallAgent/utils");return s}),define("jSkype/services/mediaAgent/constants",[],function(){return{MEDIA_STATE:{send:"sendonly",receive:"recvonly",sendReceive:"sendrecv",inactive:"inactive"},MEDIA_DEVICE:{camera:"camera",microphone:"microphone",speaker:"speaker"},MEDIA_ERROR:{iceConnectionError:"iceConnectionError",srtpError:"srtpError",permissionDeniedError:"permissionDeniedError",internalError:"internalError"},RENEGOTIATION_ERROR:{local:"local",glare:"glare",signaling:"signaling",media:"media"},MSI:{unsubscribe:-1,subscribeAny:-2},MEDIA_LABEL:{audio:"main-audio",video:"main-video",screensharing:"applicationsharing-video"},MEDIA_TYPE:{audio:"audio",video:"video"}}}),define("jSkype/services/mediaAgent/helper",["./constants"],function(e){function t(t){switch(t){case e.MEDIA_STATE.send:return e.MEDIA_STATE.receive;case e.MEDIA_STATE.receive:return e.MEDIA_STATE.send;default:return t}}function n(e){var n={},r=t(e.audio);r&&(n.audio=r);var i=t(e.video);return i&&(n.video=i),n}function r(t){return t===e.MEDIA_STATE.sendReceive?e.MEDIA_STATE.receive:void 0}function i(t){return t===e.MEDIA_STATE.send||t===e.MEDIA_STATE.sendReceive}function s(t){return t===e.MEDIA_STATE.receive||t===e.MEDIA_STATE.sendReceive}function o(t){return t.audio===e.MEDIA_STATE.inactive||t.video===e.MEDIA_STATE.inactive}function u(t){var n={};for(var r in e.MEDIA_TYPE)e.MEDIA_TYPE.hasOwnProperty(r)&&(n[e.MEDIA_TYPE[r]]=t);return n}function a(t,n){var r=i(t)&&i(n),o=s(t)&&s(n);return r&&o?e.MEDIA_STATE.sendReceive:r?e.MEDIA_STATE.send:o?e.MEDIA_STATE.receive:t===e.MEDIA_STATE.inactive&&n?e.MEDIA_STATE.inactive:void 0}function f(e,t){var n={},r=a(e.audio,t.audio);r&&(n.audio=r);var i=a(e.video,t.video);return i&&(n.video=i),n}function l(e,t){return!!e&&!!t&&e.audio===t.audio&&e.video===t.video}function c(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=n.exec(location.search),i=t;if(r){var s=decodeURIComponent(r[1].replace(/\+/g," "));try{i=JSON.parse(s)}catch(o){i=s}}return i}function h(e,t,n){function r(e,t,n){var r=i(e)&&i(t)||!i(e)&&!i(n),o=s(e)&&s(t)||!s(e)&&!s(n);return r&&o}return r(e.audio,t.audio,n.audio)&&r(e.video,t.video,n.video)}function p(e,t){function n(e,t){var n=i(e)===i(t),r=s(e)===s(t);return n&&r}return n(e.audio,t.audio)&&n(e.video,t.video)}function d(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function v(){return typeof RTCIceGatherer!="undefined"}function m(){var e,t,n=!0,r=new Promise(function(n,r){e=n,t=r});return{isPending:function(){return n},promise:r,resolve:function(){n&&(e.apply(null,arguments),n=!1)},reject:function(){n&&(t.apply(null,arguments),n=!1)}}}function g(e){return new Promise(function(t){setTimeout(t,e)})}function y(e,t,n){var r=new Promise(function(e,r){setTimeout(r.bind(null,new Error("Promise timed out"+(n?": "+n:"")+"after "+t+"ms")),t)});return Promise.race([e,r])}return{invertDirectionality:t,invertModalities:n,removeSendDirectionality:r,hasSendDirectionality:i,hasReceiveDirectionality:s,negotiateDirectionality:a,negotiateModalities:f,areModalitiesEqual:l,isOnHold:o,createUniformModalities:u,getParameterByName:c,areNegotiatedDirectionsFulfilled:p,areNegotiatedDirectionsAcceptable:h,shallowClone:d,isMsBrowser:v,defer:m,delay:g,timeout:y}}),define("jSkype/services/pluginless/pluginlessTelemetry",["lodash-compat"],function(e){function t(t){function s(e){var t={DataVersion:"3"};[].slice.call(arguments,1).forEach(function(e){o(e,t)});try{n.sendEvent(r,e,t)}catch(s){i.error("failed to send event",e,s)}}function o(t,n,r){r=r||"";var i=function(e){return e.replace(/[^a-zA-Z0-9._]/g,"_")},s=function(e){return typeof e=="boolean"?e?"1":"0":String(e)};e.forOwn(t,function(t,u){if(typeof t=="object"){var a=o(t,n,r+u+"_");e.forOwn(a,function(e,t){n[i(r+u+"_"+t)]=s(e)})}else n[i(r+u)]=s(t)})}var n=t.telemetryManager,r=t.token,i=t.logger.createChild("Telemetry");this.sendMediaSessionStats=function(e){s("mdsc_conference",e.media.metrics,e.signaling),e.media.ortc&&s("mdsc_ortc_reports",e.media.ortc),e.media.webrtc&&s("mdsc_webrtc_session",e.media.webrtc)}}return{build:function(e){return new t(e)}}}),define("jSkype/services/NGCCallAgent/NGCCallAgent/callHandler",["require","jSkype/client","constants/calling","jSkype/settings","swx-enums","jSkype/services/mediaAgent/constants","jcafe-property-model","jSkype/services/NGCCallAgent/NGCCallAgent/participant","jSkype/services/mediaAgent/helper","jSkype/modelHelpers/personHelper","jSkype/modelHelpers/contacts/dataMappers/dataMaps","jSkype/services/NGCCallAgent/NGCCallAgent/telemetryConstants","jSkype/services/NGCCallAgent/NGCCallAgent/constants","jSkype/modelHelpers/calling/fallbackMessageHelper","jSkype/services/pluginless/pluginlessTelemetry","lodash-compat","jSkype/services/preferences/settingsUtils/privacySettingsUtil"],function(e){function y(e,y,b,w){function G(e){return e&&e.hasOwnProperty("errorWrappedWithTag")}function Y(e,t){return t.catch(function(t){throw{errorWrappedWithTag:!0,tag:e,value:t}})}function Z(){var e=o.task().resolve();return e.promise}function et(e){return e?i.mediaStreamState.Started:i.mediaStreamState.Stopped}function tt(e){e.callHandlerTerminationInProgress=!0;var t=[M,D,P,H,B,j,F];t.forEach(function(t){t&&t.promise.state()==="pending"&&t.reject(e)})}function nt(e){w.participants().forEach(function(t){var n=e.indexOf(t.audio._sourceId())!==-1,r=t.audio.isSpeaking();r!==n&&(S.log("updating speaking status for",Rt(t),"to",n?"active":"inactive"),t.audio.isSpeaking._set(n))})}function rt(e){return I||(I=C.endAsync(e)),I}function it(e,t){function n(e,t){return e.code=p.CALL_END_CODE.MEDIA_ERROR,t.type===s.MEDIA_ERROR.permissionDeniedError?(e.subCode=p.CALL_END_SUB_CODE.MEDIA_PERMISSION_ERROR,e.phrase=p.CALL_END_PHRASE.MEDIA_PERMISSION_ERROR,e):(e.subCode=e.subCode||p.CALL_END_SUB_CODE.MEDIA_UNKNOWN_ERROR,e.phrase=e.phrase||p.CALL_END_PHRASE.MEDIA_ERROR,e)}return rt(n(e,t)).finally(function(){throw S.log("_endCallOnceWithMediaErrorAsync : Error.phrase  = "+t.message),t})}function st(e){T.sendMediaSessionStats({media:e,signaling:{TerminationRemote:U.remote,TerminationReasonCode:U.reasonCode,TerminationReasonSubCode:U.reasonSubCode,TerminationReasonPhrase:U.reasonPhrase}})}function ot(e,t){U.remote=t,U.reasonCode=e.code,U.reasonSubCode=e.subCode,U.reasonPhrase=e.phrase,t&&(A=e.code===p.CALL_END_CODE.NO_NGC_ENDPOINT,z="remoteTerminated");if(A)tt(new Error(n.ERRORS.P2P_FALLBACK)),Jt(w.selfParticipant,i.callConnectionState.Disconnected,i.callDisconnectionReason.OutOfBrowserCall);else{e.code===p.CALL_END_CODE.P2P_FALLBACK_FOR_SCREENSHARING&&d.sendScreenSharingFallbackMessage(w),tt(new Error("terminated"));var r=i.callDisconnectionReason.Terminated,s=i.callDisconnectionReason.Terminated;k?!L&&!t&&z==="cancelCall"?r=i.callDisconnectionReason.Canceled:!L&&!t&&z==="rejectCall"?r=i.callDisconnectionReason.Busy:At(e)&&(r=i.callDisconnectionReason.Missed):!Tt()&&w.participants(0)&&(At(e)?s=i.callDisconnectionReason.Missed:!L&&t&&(s=i.callDisconnectionReason.Busy))}qt(s),Jt(w.selfParticipant,i.callConnectionState.Disconnected,r)}function ut(){return tt(new Error("call ended by user")),rt()}function at(){var e={},t=(new Date).getTime();e[h.CONTEXT_ID.DATA_VERSION]="3",e[h.CONTEXT_ID.CORRELATIONID]=String(C.correlationId),e.CallNumber="0",e.NegotiationNumber=String(X),e.NegotiationRequiredTime=String(t),e.MediaLegId=String(W.mediaLegId),e.Status=String(W.status),e.Retarget="false",e.ReInvite=W.isRenegotiation?"true":"false",e.CreationTime=String(W.timeStamps.created*c),e.StartTime=String(W.timeStamps.started*c),e.CompleteTime=String(t*c);if(!W.isOfferer)e.Type="answering",e.ProcessOfferTime=String(W.timeStamps.initialOfferArrived*c),e.CreateAnswerFinalTime=String(W.timeStamps.finalAnswerCreated*c),e.AnswerReadyProvisionalTime=String(W.timeStamps.offerProcessed*c),e.AnswerReadyFinalTime=String(W.timeStamps.modalitiesConfigured*c);else{var n="0";e.Type="offering",e.OfferReadyTime=String(W.timeStamps.offerCreated*c),e["ProcessAnswer_"+n+"_Final_Time"]=String(W.timeStamps.finalAnswerProcessed*c),e["ProcessAnswer_"+n+"_Final_Accepted"]="true"}e.isGroupConversation=Tt()?"1":"0",W.result&&(e.isComplete=W.result.isComplete?"1":"0",e.activeVideoModalities=String(W.result.activeModalities.video),e.activeAudioModalities=String(W.result.activeModalities.audio),e.configuredVideoModalities=String(W.result.configuredModalities.video),e.configuredAudioModalities=String(W.result.configuredModalities.audio)),e.timeCompleted=String((t-W.timeStamps.created)*c);for(var i in W.timeStamps)W.timeStamps.hasOwnProperty(i)&&(e["time_"+i]=String((W.timeStamps[i]-W.timeStamps.created)*c));try{x.sendEvent(r.settings.telemetry.mdscToken,"mdsc_negotiation",e)}catch(s){S.error("_sendNegotiationStats sendEvent failed","error:",s.toString())}}function ft(e){if(e.isComplete){if(!Tt()){var t=w.participants(0),n=a.hasReceiveDirectionality(e.activeModalities.video);g.checkVideoPolicySettings(t).then(function(e){n=e?n:!1,Vt(t,et(n))})}var r=a.hasSendDirectionality(e.activeModalities.video);Vt(w.selfParticipant,et(r))}}function lt(e){return N.rejectNegotiationAsync(e).then(function(e){return ft(e),e})}function ct(){return N.completeNegotiationAsync().then(function(e){return ft(e),e})}function ht(e){var t=yt();return t.microphone?(!t.camera&&a.hasSendDirectionality(e.video)&&(e.video=a.removeSendDirectionality(e.video),S.warn("removed send direction from video modality due to missing camera selection")),R=R.then(function(){return N.configureModalitiesAsync(e)})):R=R.then(function(){throw d.sendMicrophoneAccessFallbackMessage(w),new Error("cannot configure modalities without microphone selection")}),R}function pt(e){return O.hasOwnProperty(e)}function dt(e){O[e].dispose(),delete O[e]}function vt(){try{m.forOwn(O,function(e,t){dt(t)})}catch(e){S.error("removing renderers should never fail:",e)}}function mt(){try{N.terminate()}catch(e){S.error("terminating media session should never fail:",e)}}function gt(){N&&(vt(),mt(),Z().then(function(){return N.getStatsAsync()}).then(function(e){st(e)}).catch(function(e){S.error("failed to obtain media session stats:",e)}).finally(function(){N=null}))}function yt(){var e=t.get().devicesManager,n=y.getDeviceManager(),r={};return e.selectedCamera()&&(r.camera=e.selectedCamera().deviceId()),e.selectedMicrophone()&&(r.microphone=e.selectedMicrophone().deviceId()),n.selectDevices(r),r}function bt(){N||(N=y.createSession(V,C.correlationId,{isRemoteClientLync:!Tt()&&w.participants(0).person._type()===l.contactTypes.lync,isConference:Tt()}))}function wt(e,t,n){function r(e){return e==="sendrecv"||e==="sendonly"}S.log("onParticipantUpdated",e);if(!e)return;var i=f.getId(e.id),s,o;for(var u=0;u<e.mediaStreams.length;u++){var a=e.mediaStreams[u],l=et(r(a.direction));a.type==="audio"?o={streamState:l,sourceId:a.sourceId}:a.type==="video"&&Yt()&&(s={streamState:l,sourceId:a.sourceId})}St(i,s,o,t,n)}function Et(e){var t=e.person.id();if(pt(t)){var n=O[t],r=e.video._sourceId();n.subscribeVideoAsync(r).then(function(){S.log("renderer subscribed","to:",t,"sourceId:",r)}).catch(function(r){n===O[t]&&(S.error("subscribeVideoAsync failed:",r),Vt(e,i.mediaStreamState.Stopped))})}}function St(e,t,n,r,s){if(r||s||t||n){var o=r?zt(e):Wt(e);if(o){if(r||s)o.video._sourceId(void 0),o.audio._sourceId(void 0);if(s){Vt(o,i.mediaStreamState.Stopped),Jt(o,i.callConnectionState.Disconnected);return}r&&Jt(o,i.callConnectionState.Connected),n&&(o.audio._sourceId(n.sourceId),S.log("updated participant",Rt(o),"audio msi:",n.sourceId)),t&&(o.video._sourceId(t.sourceId),S.log("updated participant",Rt(o),"video msi:",t.sourceId),Vt(o,t.streamState),Et(o))}}}function xt(){!k&&w.isGroupConversation()&&(w.participantsCount()>1||Ct())&&(S.log("configuring outgoing call as multiparty"),C.setMultiParty())}function Tt(){return C.multiParty}function Nt(e,t,n){if(w.isGroupConversation()&&w.activeModalities.audio()){S.log("_initiateSignalingSession : joining existing conversation"),C.joinGivenConversation(w._ngcJoinUrl,w._ngcCorrelationId,e,Ht(t),n);return}w.isGroupConversation()&&C.setThreadId(w.conversationId),It(),S.log("_initiateSignalingSession : starting new call. suppressDialout = "+Ct()),C.startOutgoingCall(e,Ht(t),Ct(),n)}function Ct(){return!!w._autoCall}function kt(e){var t=y.getDeviceManager();return(e?t.muteInputAsync():t.unmuteInputAsync()).then(function(){return e}).catch(function(t){return S.error("failed to toggle microphone mute:",t),!e})}function Lt(e){var t=Bt(!0,e);return ht(t).then(function(){var e=a.hasSendDirectionality(t.video);Vt(w.selfParticipant,et(e));var n=w.selfParticipant.video.channels(0);n&&n.isStarted.set._enabled(!0)}).catch(function(e){Vt(w.selfParticipant,et(!1)),S.error("startStopLocalVideoAsync failed","error:",e)})}function At(e){return e.code===p.CALL_END_CODE.CANCEL||e.code===p.CALL_END_CODE.TIMEOUT}function Ot(e){H.resolve(e.mediaContent)}function Mt(e){B.resolve(e.mediaContent)}function _t(e){D.resolve(e)}function Dt(){var e=0,t=1,n=2;q=q.then(function(){return++X,W={isOfferer:!0,isRenegotiation:!0,mediaLegId:"",timeStamps:{created:(new Date).getTime()}},S.log("begin renegotiation offer"),Y(e,N.createOfferAsync())}).then(function(e){return W.timeStamps.offerCreated=(new Date).getTime(),W.mediaLegId=e.mediaContent.mediaLegId,B=o.task(),Y(t,C.startRenegotiationAsync(e.mediaContent,Ht(e.modalities),W.timeStamps.offerCreated-W.timeStamps.created))}).then(function(){return W.timeStamps.renegotiationStarted=(new Date).getTime(),Y(n,B.promise)}).then(function(t){return W.timeStamps.answerArrived=(new Date).getTime(),Y(e,N.processAnswerAsync(t,!1))}).then(function(){return W.timeStamps.answerProcessed=(new Date).getTime(),ct()}).then(function(e){W.status="Succeeded",W.result=e}).catch(function(e){if(G(e)&&!e.value.callHandlerTerminationInProgress){var r=s.RENEGOTIATION_ERROR.local;return S.warn("renegotiate","error:",e),e.tag===t?r=s.RENEGOTIATION_ERROR.glare:e.tag===n&&(e.value.code===491&&e.value.subCode===10029?r=s.RENEGOTIATION_ERROR.glare:e.value.code===415?r=s.RENEGOTIATION_ERROR.media:r=s.RENEGOTIATION_ERROR.signaling),W.status="ErrorLocalInternal-"+r,lt(r)}throw W.status="ErrorLocalInternal-untagged",e}).catch(function(e){return W.status="ErrorLocalInternal-fatal",S.error("renegotiation failed","error:",e),it({subCode:p.CALL_END_SUB_CODE.MEDIA_RENEGOTIATION_ERROR,phrase:p.CALL_END_PHRASE.MEDIA_RENEGOTIATION_ERROR},e)}).finally(function(){at(),S.log("end renegotiation offer")})}function Pt(e){var t=0,n=1;q=q.then(function(){++X,W={isOfferer:!1,isRenegotiation:!0,mediaLegId:"",timeStamps:{created:(new Date).getTime()}},K=e.mediaTypes||[];var n=e.mediaContent;S.log("begin renegotiation answer");if(n.escalationOccurring)throw S.error("renegotiation answer: giving up on escalation scenario"),new Error("escalation scenario is not supported");return Zt(),Y(t,N.processOfferAsync(n))}).then(function(){return W.timeStamps.offerProcessed=(new Date).getTime(),Y(t,N.createAnswerAsync(!1))}).then(function(e){return W.timeStamps.answerCreated=(new Date).getTime(),W.mediaLegId=e.mediaContent.mediaLegId,P=o.task(),Y(n,C.acceptRenegotiationAsync(e.mediaContent,Ht(e.modalities),W.timeStamps.answerCreated-W.timeStamps.created))}).then(function(){return W.timeStamps.renegotiationAccepted=(new Date).getTime(),Y(n,P.promise)}).then(function(){return W.timeStamps.mediaAcknowledged=(new Date).getTime(),ct()}).then(function(e){W.status="Succeeded",W.result=e}).catch(function(e){if(G(e)&&!e.value.callHandlerTerminationInProgress)return S.warn("handleMediaRenegotiationOffer","error:",e),Z().then(function(){var n=e.tag===t?s.RENEGOTIATION_ERROR.local:s.RENEGOTIATION_ERROR.signaling;return W.status="ErrorLocalInternal-"+n,lt(n)}).then(function(){if(e.tag<n)return C.rejectRenegotiationAsync()});throw W.status="ErrorLocalInternal-untagged",e}).catch(function(e){return W.status="ErrorLocalInternal-fatal",S.error("handleMediaRenegotiationOffer failed","error:",e),it({subCode:p.CALL_END_SUB_CODE.MEDIA_RENEGOTIATION_ERROR,phrase:p.CALL_END_PHRASE.MEDIA_RENEGOTIATION_ERROR},e)}).finally(function(){at(),S.log("end renegotiation answer")})}function Ht(e){var t=[];return e.audio&&t.push(p.MEDIA_TYPES.AUDIO),e.video&&t.push(p.MEDIA_TYPES.VIDEO),t}function Bt(e,t){function n(e){return e?s.MEDIA_STATE.sendReceive:s.MEDIA_STATE.receive}return{audio:n(e),video:Yt()?n(t):void 0}}function jt(e){return new u({displayName:e.displayName(),id:f.getKey(e.id(),e._type())})}function Ft(e){S.log("_addParticipantToCall",e.person.id()),Jt(e,i.callConnectionState.Connecting),F.promise.then(function(){Jt(e,i.callConnectionState.Ringing)}),C.addParticipantAsync(jt(e.person)).then(function(e){wt(e,!0)}).catch(function(){Jt(e,i.callConnectionState.Disconnected,i.callDisconnectionReason.Refused)})}function It(){var e=w.participants,t=e.subscribe();e().forEach(Ft),t.dispose()}function qt(e){var t=w.participants,n=t.subscribe();t().forEach(function(t){Jt(t,i.callConnectionState.Disconnected,e)}),n.dispose()}function Rt(e){return(w.selfParticipant===e?"* ":"")+e.person.id()}function Ut(e){return w.selfParticipant.person.id()===e}function zt(e){return Wt(e)}function Wt(e){return Ut(e)?w.selfParticipant:Xt(function(t){return t.person.id()===e})}function Xt(e){var t=w.participants,n=t.subscribe(),r=null;return t().some(function(t){if(e(t))return r=t,!0}),n.dispose(),r}function Vt(e,t){var n=e.video.channels(0);if(n){var r=n.stream.state(),s=r===i.mediaStreamState.Active||r===i.mediaStreamState.Inactive;if(r===t||s&&t===i.mediaStreamState.Started)return;S.log("updateVideoChannelStreamState",Rt(e),"state:",r,"->",t),n.stream.state._set(t)}}function $t(e,t,n,r){var i=e.video.channels(0);if(i){var s=i.stream.state();S.log("updateVideoChannelStreamStateAndSize",Rt(e),"state:",s,"->",t,"size:",n,r),i.stream.state._set(t),i.stream.width._set(n),i.stream.height._set(r)}}function Jt(e,t,n){function s(t,n,r){return S.log("updateParticipantAVState",Rt(e),"state:",t,"->",n,"reason",r),e.audio.state._set(n,r),e.video.state._set(n,r),e.screenSharing.state._set(n,r),n}var r=e.audio.state();r===t||r===i.callConnectionState.Disconnected&&t===i.callConnectionState.Disconnecting||r===i.callConnectionState.Connected&&t===i.callConnectionState.Notified||r===i.callConnectionState.Connected&&t===i.callConnectionState.Connecting||r===i.callConnectionState.Connected&&t===i.callConnectionState.Ringing||r===i.callConnectionState.Ringing&&t===i.callConnectionState.Connecting?S.log("updateParticipantAVState ignored, invalid states",Rt(e),"currentState:",r,"newState",t):(t===i.callConnectionState.Disconnected&&r!==i.callConnectionState.Disconnecting?r=s(r,i.callConnectionState.Disconnecting,n):t===i.callConnectionState.Connected&&r!==i.callConnectionState.Connecting&&r!==i.callConnectionState.Ringing?r=s(r,i.callConnectionState.Connecting):t===i.callConnectionState.Ringing&&r!==i.callConnectionState.Connecting&&(r=s(r,i.callConnectionState.Connecting)),s(r,t,n))}function Kt(){function n(r){e||(S.log("enableVideoWhenVideoChannelAdded",Rt(t),"state:",r.stream.state(),"isStarted:",r.isStarted()),e=r.isStarted(!0),t.video.channels.added.off(n))}var e,t=w.selfParticipant;S.log("enableVideoWhenVideoChannelAdded",Rt(t)),t.video.channels.added(n)}function Qt(e,t){N&&t==="UserSelection"&&yt()}function Gt(e,t){N&&t==="UserSelection"&&yt()}function Yt(){return y.getCapabilities().video}function Zt(){var e=function(){return K.some(function(e){return p.MEDIA_TYPES.VIDEO===e})};!Yt()&&e()&&!Q&&(S.log("remote participant added video modality, reminding user of missing video capability"),d.sendNoVideoCapabilityMessage(w),Q=!0)}var E=this,S=e.getLogger().createChild("CallHandler"),x=t.get()._telemetryManager,T=v.build({telemetryManager:x,token:r.settings.telemetry.mdscToken,logger:S}),N=null,C=null,k=!1,L=!1,A=!1,O={},M=null,D=o.task(),P=o.task(),H=o.task(),B=o.task(),j=o.task(),F=o.task(),I=null,q=Z(),R=Z(),U={remote:!1,reasonCode:p.CALL_END_CODE.SUCCESS,reasonSubCode:p.CALL_END_SUB_CODE.SUCCESS,reasonPhrase:"none"},z="unknown",W=null,X=0,V={onNegotiationRequired:function(){M?M.resolve():Dt()},onSessionErrorOccurred:function(e){it({subCode:p.CALL_END_SUB_CODE.MEDIA_DROP_AFTER_CONNECT,phrase:p.CALL_END_PHRASE.MEDIA_DROP_AFTER_CONNECT},e)},onContributingSourcesChanged:nt},$,J,K=[],Q;this.placeCall=function(e){S.log("placeCall",w);var t=Bt(!0,e);return q=q.then(function(){return++X,W={isOfferer:!0,isRenegotiation:!1,mediaLegId:"",timeStamps:{created:(new Date).getTime()}},M=o.task(),xt(),bt(),ht(t)}).then(function(){return W.timeStamps.modalitiesConfigured=(new Date).getTime(),a.hasSendDirectionality(t.video)&&Kt(),M.promise}).then(function(){return W.timeStamps.initialNegotiationRequested=(new Date).getTime(),N.createOfferAsync()}).then(function(e){W.mediaLegId=e.mediaContent.mediaLegId,W.timeStamps.offerCreated=(new Date).getTime(),Nt(e.mediaContent,e.modalities,W.timeStamps.offerCreated-W.timeStamps.created)}).then(function(){return H.promise}).then(function(e){return N.processAnswerAsync(e,!1)}).then(function(){return W.timeStamps.finalAnswerProcessed=(new Date).getTime(),j.promise}).then(function(){return M=null,ct()}).then(function(e){W.status="Succeeded",W.result=e}).catch(function(e){return W.status="ErrorLocalInternal-fatal",S.error("placeCall failed","error:",e),it({subCode:p.CALL_END_SUB_CODE.MEDIA_DROP_DURING_CONNECT,phrase:p.CALL_END_PHRASE.MEDIA_DROP_DURING_CONNECT},e)}).finally(function(){at(),S.log("end placeCall")}),q},this.acknowledge=function(){if(w._callData.wasNGCPayloadProcessed())return S.log("acknowledge, NGC payload was processed"),Promise.resolve();S.log("acknowledge",w);var e=w._callData.getIncomingNGCPayload();return q=q.then(function(){++X,W={isOfferer:!1,isRenegotiation:!1,mediaLegId:"",timeStamps:{created:(new Date).getTime()}},W.timeStamps.started=(new Date).getTime(),k=!0,xt(),C.handleIncomingCall(e)}).then(function(){return W.timeStamps.incomingCallHandled=(new Date).getTime(),D.promise}).then(function(e){K=e.mediaTypes||[];var t=e.mediaContent;return W.timeStamps.initialOfferArrived=(new Date).getTime(),bt(),N.processOfferAsync(t)}).then(function(){W.timeStamps.offerProcessed=(new Date).getTime(),E.onCallStatusChanged(p.CALL_STATUS.RINGING)}).catch(function(e){return S.error("acknowledge failed","error:",e.toString()),it({subCode:p.CALL_END_SUB_CODE.MEDIA_DROP_DURING_CONNECT,phrase:p.CALL_END_PHRASE.MEDIA_DROP_DURING_CONNECT},e)}),q},this.acceptCall=function(e){S.log("acceptCall");var t=Bt(!0,e);return q=q.then(function(){return Zt(),ht(t)}).then(function(){return W.timeStamps.modalitiesConfigured=(new Date).getTime(),a.hasSendDirectionality(t.video)&&Kt(),N.createAnswerAsync(!1)}).then(function(e){return W.timeStamps.finalAnswerCreated=(new Date).getTime(),W.mediaLegId=e.mediaContent.mediaLegId,C.acceptAsync(e.mediaContent,Ht(e.modalities),W.timeStamps.finalAnswerCreated-W.timeStamps.modalitiesConfigured)}).then(function(){return W.timeStamps.signalingSessionAccepted=(new Date).getTime(),j.promise}).then(function(){return W.timeStamps.callConnected=(new Date).getTime(),ct()}).then(function(e){W.status="Succeeded",W.result=e}).catch(function(e){return W.status="ErrorLocalInternal-fatal",S.error("acceptCall failed","error:",e),it({subCode:p.CALL_END_SUB_CODE.MEDIA_DROP_DURING_CONNECT,phrase:p.CALL_END_PHRASE.MEDIA_DROP_DURING_CONNECT},e)}).finally(function(){at(),S.log("end acceptCall")}),q},this.rejectCall=function(){return S.log("rejectCall"),z="rejectCall",ut().catch(function(e){Jt(w.selfParticipant,i.callConnectionState.Disconnected,i.callDisconnectionReason.Failed),S.error("rejectCall failed","error:",e)})},this.cancelCall=function(){return S.log("cancelCall"),z="cancelCall",ut().catch(function(e){Jt(w.selfParticipant,i.callConnectionState.Disconnected,i.callDisconnectionReason.Failed),S.error("cancelCall failed","error:",e)})},this.endCall=function(){return S.log("endCall"),z="endCall",ut().catch(function(e){Jt(w.selfParticipant,i.callConnectionState.Disconnected,i.callDisconnectionReason.Failed),S.error("endCall failed","error:",e)})},this.dispose=function(){S.log("dispose"),tt(new Error("terminated")),gt(),$.dispose(),J.dispose(),w.mediaConnectionType(i.mediaConnectionType.Unknown)},this.setSoundLevelEventMode=function(e){return S.log("setSoundLevelEventMode","options:",e),o.task().resolve(null).promise},this.mute=function(){return kt(!0)},this.unmute=function(){return kt(!1)},this.startParticipantVideo=function(e,t){S.log("startParticipantVideo",e,t);if(Ut(e)&&t===n.PLUGIN_MEDIA_TYPES.VIDEO)return Lt(!0)},this.stopParticipantVideo=function(e,t){S.log("stopParticipantVideo",e,t);if(Ut(e)&&t===n.PLUGIN_MEDIA_TYPES.VIDEO)return Lt(!1)},this.attachParticipantVideo=function(e,t){S.log("attachParticipantVideo",e,t);if(Yt()&&!pt(e)){var n=Wt(e),r=!1,s={onVideoSizeChanged:function(e,t){var s=e>0&&t>0;s?$t(n,i.mediaStreamState.Active,e,t):r&&!s&&Vt(n,i.mediaStreamState.Inactive),r=s}};n===w.selfParticipant?(yt(),O[e]=y.getDeviceManager().createPreviewRenderer(t,s),O[e].startVideoAsync().catch(function(e){S.error("failed to start preview video renderer",e),Vt(w.selfParticipant,et(!1))})):(S.log("creating renderer for",e),O[e]=O[e]||N.createRemoteRenderer(t,s),Et(n))}},this.detachParticipantVideo=function(e,t){S.log("detachParticipantVideo",e,t),n.PLUGIN_MEDIA_TYPES.VIDEO===t&&pt(e)&&dt(e)},this.requestCallInfo=function(){S.log("requestCallInfo");var e=o.task();if(C&&C.correlationId){var t="\r\nCallInformation\r\n * CallId="+C.correlationId+"\r\n"+" * Establishment Technology=NGC (plugin-free)";e.resolve(t)}else e.reject("CallInformation not available");return e.promise},this.getRemoteParticipantCollection=function(){return w.participants()},this.onParticipantJoined=function(e){S.log("onParticipantJoined",e),wt(e,!0)},this.onParticipantUpdated=function(e){S.log("onParticipantUpdated",e),wt(e)},this.onParticipantRemoved=function(e){S.log("onParticipantRemoved",e),wt(e,!1,!0)},this.onConversationUpdated=function(e){S.log("onConversationUpdated","threadId:",e.threadId)},this.onReTargetCompletedSuccess=function(){S.log("onReTargetCompletedSuccess")},this.onReTargetCompletedFailure=function(e){S.log("onReTargetCompletedFailure","details:",e)},this.onOffer=function(e){e.renegotiation?Pt(e):_t(e)},this.onAnswer=function(e){S.log("onAnswer","provisional:",e.provisional,"renegotiation:",e.renegotiation,"mediaTypes:",e.mediaTypes),e.renegotiation?Mt(e):e.provisional||Ot(e)},this.onMediaAcknowledgementSuccess=function(e){S.log("onMediaAcknowledgementSuccess","isRenegotiation:",e),P.resolve()},this.onMediaAcknowledgementFailure=function(e,t){S.log("onMediaAcknowledgementFailure","isRenegotiation:",e),P.reject(t)},this.onMediaRenegotiationRejection=function(e){S.log("onMediaRenegotiationRejection","error:",e),B.reject(e)},this.onCallStatusChanged=function(e,t){S.log("onCallStatusChanged",e,t),C.correlationId&&w.audioService.callId._set(C.correlationId),C.participantManager&&(w._callData.ngcParticipantId(C.participantManager.localParticipant.participantId),w._callData.ngcEndpointId(C.participantManager.localParticipant.endpointId)),e===p.CALL_STATUS.RINGING?(k&&Jt(w.selfParticipant,i.callConnectionState.Notified),F.resolve()):e===p.CALL_STATUS.CONNECTED?(L=!0,j.resolve(),Jt(w.selfParticipant,i.callConnectionState.Connected)):(e===p.CALL_STATUS.LOCAL_TERMINATED||e===p.CALL_STATUS.REMOTE_TERMINATED)&&ot(t,p.CALL_STATUS.REMOTE_TERMINATED===e)},function(){S.log("construct");var e=jt(w.selfParticipant.person);C=b.getNewSignalingSession(e,E),$=t.get().devicesManager.selectedCamera.changed(Gt),J=t.get().devicesManager.selectedCamera.changed(Qt),S.log("unmuting microphone for a new call"),y.getDeviceManager().unmuteInputAsync().catch(function(e){S.error("failed to unmute microphone during call setup:",e)}),w.mediaConnectionType(i.mediaConnectionType.Pluginless)}()}var t=e("jSkype/client"),n=e("constants/calling"),r=e("jSkype/settings"),i=e("swx-enums"),s=e("jSkype/services/mediaAgent/constants"),o=e("jcafe-property-model"),u=e("jSkype/services/NGCCallAgent/NGCCallAgent/participant"),a=e("jSkype/services/mediaAgent/helper"),f=e("jSkype/modelHelpers/personHelper"),l=e("jSkype/modelHelpers/contacts/dataMappers/dataMaps"),c=1e4,h=e("jSkype/services/NGCCallAgent/NGCCallAgent/telemetryConstants"),p=e("jSkype/services/NGCCallAgent/NGCCallAgent/constants"),d=e("jSkype/modelHelpers/calling/fallbackMessageHelper"),v=e("jSkype/services/pluginless/pluginlessTelemetry"),m=e("lodash-compat"),g=e("jSkype/services/preferences/settingsUtils/privacySettingsUtil");return y}),function(e){if(typeof exports=="object"&&typeof module!="undefined")module.exports=e();else if(typeof define=="function"&&define.amd)define("microsoft-sdp-transform/lib/sdp-transform",[],e);else{var t;typeof window!="undefined"?t=window:typeof global!="undefined"?t=global:typeof self!="undefined"?t=self:t=this,t.sdpTransform=e()}}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=t[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,r,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){var r=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbXMessage",reg:/^rtcp-fb:(\*|\d*) x-message ([\S| ]*)/,names:["payload","param"],format:"rtcp-fb:%d x-message %s"},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(e){return e.config!=null?"extmap:%s %s %s":"extmap:%s %s"}},{push:"cryptoscale",reg:/^cryptoscale:(\d*) (client|server) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","flavor","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"cryptoscale:%d %s %s %s %s":"cryptoscale:%d %s %s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t}},{push:"xCandidatesIpv6",reg:/^x-candidate-ipv6:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation"],format:function(e){var t="x-candidate-ipv6:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*):(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{push:"ssrcGroups",reg:/^ssrc-group:(\w*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/,format:"rtcp-mux"},{name:"rtcpRsize",reg:/^(rtcp-rsize)/,format:"rtcp-rsize"},{name:"xMediaBw",reg:/^x-mediabw:(\S*) send=(\d*);recv=(\d*)/,names:["label","sendBw","receiveBw"],format:"x-mediabw:%s send=%d;recv=%d"},{name:"xSsrcRange",reg:/^x-ssrc-range:(\d*)-(\d*)/,names:["ssrcMin","ssrcMax"],format:"x-ssrc-range:%d-%d"},{name:"label",reg:/^label:(\S*)/,format:"label:%s"},{name:"xSource",reg:/^x-source:(\S*)/,format:"x-source:%s"},{name:"xSourceStreamId",reg:/^x-source-streamid:(\S*)/,format:"x-source-streamid:%s"},{name:"xCaps",reg:/^x-caps:(\d*) (\S*)/,names:["payloadType","value"],format:"x-caps:%d %s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach(function(e){var t=r[e];t.forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],2:[function(e,t,n){var r=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var s=0;s<n.length;s+=1)e[s+1]!=null&&(t[n[s]]=r(e[s+1]))},s=function(e,t,n){var r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});var s=e.push?{}:r?t[e.name]:t;i(n.match(e.reg),s,e.names,e.name),e.push&&t[e.push].push(s)},o=e("./grammar"),u=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(u).forEach(function(e){var t=e[0],i=e.slice(2);t==="m"&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var u=0;u<(o[t]||[]).length;u+=1){var a=o[t][u];if(a.reg.test(i))return s(a,r,i)}}),t.media=n,t};var a=function(e,t){var n=t.split("=");return n.length===2&&(e[n[0]]=r(n[1])),e};n.parseFmtpConfig=function(e){return e.split(/\;\s?/).reduce(a,{})},n.parsePayloads=function(e){return e.split(" ").map(Number)},n.parseRemoteCandidates=function(e){var t=[],n=e.split(" ").map(r);for(var i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t}},{"./grammar":1}],3:[function(e,t,n){var r=e("./grammar"),i=/%[sdv%]/g,s=function(e){var t=1,n=arguments,r=n.length;return e.replace(i,function(e){if(t>=r)return e;var i=n[t];t+=1;switch(e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})},o=function(e,t,n){var r=t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format,i=[e+"="+r];if(t.names)for(var o=0;o<t.names.length;o+=1){var u=t.names[o];t.name?i.push(n[t.name][u]):i.push(n[t.names[o]])}else i.push(n[t.name]);return s.apply(null,i)},u=["v","o","s","i","u","e","p","c","b","t","r","z","a"],a=["i","c","b","a"];t.exports=function(e,t){t=t||{},e.version==null&&(e.version=0),e.name==null&&(e.name=" "),e.media.forEach(function(e){e.payloads==null&&(e.payloads="")});var n=t.outerOrder||u,i=t.innerOrder||a,s=[];return n.forEach(function(t){r[t].forEach(function(n){n.name in e&&e[n.name]!=null?s.push(o(t,n,e)):n.push in e&&e[n.push]!=null&&e[n.push].forEach(function(e){s.push(o(t,n,e))})})}),e.media.forEach(function(e){s.push(o("m",r.m[0],e)),i.forEach(function(t){r[t].forEach(function(n){n.name in e&&e[n.name]!=null?s.push(o(t,n,e)):n.push in e&&e[n.push]!=null&&e[n.push].forEach(function(e){s.push(o(t,n,e))})})})}),s.join("\r\n")+"\r\n"}},{"./grammar":1}],"sdp-transform":[function(e,t,n){var r=e("./parser"),i=e("./writer");n.write=i,n.parse=r.parse,n.parseFmtpConfig=r.parseFmtpConfig,n.parsePayloads=r.parsePayloads,n.parseRemoteCandidates=r.parseRemoteCandidates},{"./parser":2,"./writer":3}]},{},[])("sdp-transform")}),define("microsoft-sdp-transform",["microsoft-sdp-transform/lib/sdp-transform"],function(e){return e}),define("jSkype/services/mediaAgent/userAgentAdapter",[],function(){window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,window.MediaStream=window.MediaStream||window.webkitMediaStream||window.mozMediaStream||window.msMediaStream,window.attachMediaStream=function(e,t){typeof e.srcObject!="undefined"?e.srcObject=t:typeof e.src!="undefined"&&(e.src=window.URL.createObjectURL(t))},window.detachMediaStream=function(e){if(typeof e.srcObject!="undefined")e.srcObject=null;else if(typeof e.src!="undefined"&&e.src){var t=e.src;e.src="",window.URL.revokeObjectURL(t)}},window.stopMediaStream=function(e){var t=e.getTracks();for(var n=0;n<t.length;++n){var r=t[n];r.stop()}};if(typeof navigator.mozGetUserMedia!="undefined"&&typeof mozRTCPeerConnection!="undefined"){window.RTCPeerConnection=mozRTCPeerConnection,window.RTCSessionDescription=mozRTCSessionDescription;var e=function(){var e=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(t){var n=function(e){var t=r.getLocalStreams()||[];return t.find(function(t){var n=("audio"===e.kind?t.getAudioTracks():t.getVideoTracks())||[];return n.some(function(t){return t.id===e.id})})};if("offer"===t.type){var r=this,i=r.getSenders()||[];i.forEach(function(e){var t=e.track,i=n(t);i&&(r.removeTrack(e),r.addTrack(t,i))})}e.apply(this,arguments)}};e(),navigator.getUserMedia=function(e,t,n){return navigator.mozGetUserMedia(e,t,n)}}else typeof navigator.webkitGetUserMedia!="undefined"&&typeof webkitRTCPeerConnection!="undefined"&&(window.RTCPeerConnection=webkitRTCPeerConnection,navigator.getUserMedia=function(e,t,n){var r=function(e){e&&e.deviceId&&e.deviceId.exact&&(e.optional||(e.optional=[]),e.optional.push({sourceId:e.deviceId.exact}),delete e.deviceId)};return e&&(r(e.audio),r(e.video)),navigator.webkitGetUserMedia(e,t,n)});window.RTCPeerConnection&&[{name:"createOffer",reverseArgs:!0},"createAnswer","setRemoteDescription","setLocalDescription"].forEach(function(e){var t=e.name||e,n=window.RTCPeerConnection.prototype[t];window.RTCPeerConnection.prototype[t]=function(){var t=this,r=arguments;return new Promise(function(i,s){var o=[i,s];r.length>0&&o.splice(e.reverseArgs?o.length:0,0,r[0]),n.apply(t,o)})}});if(typeof RTCIceGatherer!="undefined"){var t=function(){return Promise.resolve()};RTCRtpSender.prototype.getStats||(RTCRtpSender.prototype.getStats=t),RTCRtpSender.prototype.msGetStats||(RTCRtpSender.prototype.msGetStats=t),RTCRtpReceiver.prototype.getStats||(RTCRtpReceiver.prototype.getStats=t),RTCRtpReceiver.prototype.msGetStats||(RTCRtpReceiver.prototype.msGetStats=t),RTCIceTransport.prototype.getStats||(RTCIceTransport.prototype.getStats=t),RTCIceTransport.prototype.msGetStats||(RTCIceTransport.prototype.msGetStats=t),RTCRtpReceiver.prototype.getContributingSources||(RTCRtpReceiver.prototype.getContributingSources=function(){return[]}),RTCRtpReceiver.prototype.requestSendCSRC||(RTCRtpReceiver.prototype.requestSendCSRC=function(){})}return{window:window}}),define("jSkype/services/mediaAgent/msSdpTransform",["./userAgentAdapter"],function(e){function n(n){function o(e,t){return l(e),e.media.forEach(function(n){var i;n.protocol="RTP/SAVP",n.label=p(n.type);if(n.port===0){for(var o in n)n.hasOwnProperty(o)&&["type","port","protocol","payloads"].indexOf(o)<0&&delete n[o];n.payloads=34}n.ssrcs&&n.ssrcs[0]&&(n.xSsrcRange={ssrcMin:n.ssrcs[0].id,ssrcMax:n.ssrcs[0].id}),d(n.direction)||delete n.ssrcs;if(n.ext)for(i=n.ext.length-1;i>=0;--i)n.ext[i].uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"&&n.ext.splice(i,1);n.crypto&&n.crypto.forEach(function(e){e.config+="|2^31"}),n.port!==0&&e.fingerprint&&(n.fingerprint=e.fingerprint),n.fingerprint&&h(t)&&delete n.setup;if(n.candidates){for(i=n.candidates.length-1;i>=0;--i){var u=n.candidates[i],f=!1;for(var l=i-1;l>=0;--l)if(n.candidates[i].foundation===n.candidates[l].foundation&&n.candidates[i].component===n.candidates[l].component){n.candidates.splice(i,1),f=!0;break}if(f)continue;if(u.ip.indexOf(":")!==-1)continue}n.candidates.sort(function(e,t){return e.foundation===t.foundation?e.component-t.component:e.foundation-t.foundation})}n.rtcp&&n.rtcpMux&&(h(t)||delete n.rtcp),n.rtcpFb&&(n.rtcpRsize=!0),n.invalid&&(r.error("Unknown SDP attributes!",n.invalid),delete n.invalid),s.navigator.webkitGetUserMedia&&a(n,!1)}),delete e.fingerprint,delete e.groups,e}function u(e,t){f(e);var n=v(e)?"UDP/TLS/RTP/SAVPF":"RTP/SAVPF";for(var r=e.media.length-1;r>=0;--r){var i=e.media[r];i.protocol=n;if(i.port===0){i.direction||(i.direction="inactive");continue}!i.ssrcs&&i.xSsrcRange&&d(i.direction)&&(i.ssrcs=[],i.ssrcs.push({attribute:"cname",id:i.xSsrcRange.ssrcMin,value:"ZXVf3drwG3fT+Wh5"}),i.ssrcs.push({attribute:"msid",id:i.xSsrcRange.ssrcMin,value:i.type==="audio"?"esGl63EerPyTHNZK4HwO9DwHSgurO6Hjy1kF e031115a-4177-4830-bc2a-1fe17a418c07":"esGl63EerPyTHNZK4HwO9DwHSgurO6Hjy1kF e031115a-4177-4830-bc2a-1fe17a418c08"})),delete i.cryptoscale,i.fingerprint&&h(t)&&(i.setup="actpass");if(i.crypto)for(var o=i.crypto.length-1;o>=0;--o){var u=i.crypto[o];if(u.config.match(/.*\|\d+:\d+/)){i.crypto.splice(o,1);continue}u.config=u.config.replace(/(.*)\|2\^\d+/,"$1")}i.remoteCandidates&&(delete i.candidates,delete i.xCandidatesIpv6,delete i.remoteCandidates);if(i.candidates)for(var l=i.candidates.length-1;l>=0;--l){var c=i.candidates[l];c.transport.match(/tcp-/i)&&(c.transport="tcp")}if(i.xCandidatesIpv6){i.candidates=i.candidates||[];for(var p=0;p<i.xCandidatesIpv6.length;++p)i.candidates.push(i.xCandidatesIpv6[p]);delete i.xCandidatesIpv6}i.rtcpFbXMessage&&(i.rtcpFb=i.rtcpFb||[],i.rtcpFbXMessage.forEach(function(e){e.param.match(/recv:[\S]*x-pli/)&&i.rtcpFb.push({payload:e.payload,type:"nack",subtype:"pli"})}),delete i.rtcpFbXMessage),s.navigator.webkitGetUserMedia&&a(i,!0)}return e}function a(e,t){if("audio"===e.type)t&&c(e,{codec:"g722",rate:8e3,encoding:2}),c(e,{codec:"cn",rate:16e3}),c(e,{codec:"telephone-event",rate:8e3});else if("video"===e.type&&t&&!i.chromeAllowIncomingMSVideo&&e.port!==0){var n=!1;e.rtp.forEach(function(e){e.codec.toLowerCase().indexOf("x-h264uc")!==-1&&(n=!0)}),n&&(e.port=0)}}function f(e){var t,r;n.remoteMedia=[],e.media=e.media.filter(function(e){return n.remoteMedia.push({type:e.type}),"audio"===e.type&&!t&&(t=!0)||"video"===e.type&&!r&&(r=!0)})}function l(e){if(n.remoteMedia&&n.remoteMedia.length>e.media.length){var t=[],r=0;n.remoteMedia.forEach(function(n){e.media[r]&&e.media[r].type===n.type?t.push(e.media[r++]):t.push({type:n.type,port:0})}),e.media=t}}function c(e,t){var n=-1;e.rtp.forEach(function(e,r){t.codec===e.codec.toLowerCase()&&t.rate===e.rate&&t.encoding===e.encoding&&(n=r)});if(n>=0&&e.rtp.length>1){var r=e.rtp[n].payload;e.rtp.splice(n,1),e.payloads=e.payloads.split(" ").filter(function(e){return r!==+e}).join(" "),e.fmtp=e.fmtp.filter(function(e){return r!==e.payload})}}function h(e){return"offer"===e.type}function p(e){return t.hasOwnProperty(e)&&t[e]||"undefined"}function d(e){return!e||e.toLowerCase()==="sendonly"||e.toLowerCase()==="sendrecv"}function v(e){return e.media.some(function(e){return!!e.fingerprint})||!!e.fingerprint}this.toMsSdp=o,this.fromMsSdp=u;var r=n.logger,i=n.settings,s=e.window}var t={audio:"main-audio",video:"main-video"};return n}),define("jSkype/services/mediaAgent/webRtcSessionDescription",["./constants","./helper","microsoft-sdp-transform","./msSdpTransform"],function(e,t,n,r){function i(t,i,s,l){var c=t.settings,h=t.logger,p=t.adapter,d=n.parse(s),v=new r(t),m;this.getModalities=function(){return a(d)},this.hasDtls=function(){return d.media.some(function(e){return"RTP/SAVPF"!==e.protocol})},this.toOffer=function(e){return d=n.parse(e),f(d,function(e,t){t.port!==0&&!m[e]&&(h.warn("toOffer _applyMediaFixups disable","type:",e),o(t)),u(c,t)}),c.disableMsSdp||v.toMsSdp(d,{type:i}),n.write(d)},this.toAnswer=function(e){return d=n.parse(e),f(d,function(e,t){u(c,t)}),c.disableMsSdp||v.toMsSdp(d,{type:i}),n.write(d)},this.toLocal=function(e){return m=e,n.write(d)},this.toRemote=function(t){return m=t,f(d,function(t,n){n.port!==0&&!m[t]&&(h.warn("toRemote _applyMediaFixups disable","type:",t),o(n)),m[t]===e.MEDIA_STATE.send&&n.direction.toLowerCase()!=="recvonly"&&(h.warn("toRemote _applyMediaFixups direction => recvonly","type:",t,"olddirection:",n.direction),n.direction="recvonly")}),p.toRemote(d),n.write(d)},this.needToWaitIceCandidates=function(){return d.media&&d.media.some(function(e){return e.port===9})},function(){l&&!c.disableMsSdp&&v.fromMsSdp(d,{type:i})}()}function s(e,t,i,s){var a=e.settings,l=new r(e),c=n.parse(i);return f(c,function(e,t){t.port!==0&&!s[e]&&o(t),t.direction="inactive",u(a,t)}),a.disableMsSdp||l.toMsSdp(c,{type:t}),n.write(c)}function o(e){e.port=0;for(var t in e)e.hasOwnProperty(t)&&["type","port","protocol","payloads","connection","direction"].indexOf(t)<0&&(delete e[t],e.direction="inactive")}function u(e,t){if(e.iceCandidateType||e.iceCandidateTransport)t.candidates=t.candidates.filter(function(t){var n=!0,r=!0;return e.iceCandidateType&&(n=t.type.match(new RegExp(e.iceCandidateType),"i")),e.iceCandidateTransport&&(r=t.transport.match(new RegExp(e.iceCandidateTransport,"i"))),n&&r})}function a(n,r){var i,s=t.createUniformModalities(void 0);for(var o=0;o<n.media.length;++o){i=n.media[o];if(i.port!==0||r)i.type==="audio"?s[e.MEDIA_TYPE.audio]=i.direction||e.MEDIA_STATE.sendReceive:i.type==="video"&&(s[e.MEDIA_TYPE.video]=i.direction||e.MEDIA_STATE.sendReceive)}return s}function f(t,n){for(var r=0;r<t.media.length;r++)t.media[r].type==="audio"?n(e.MEDIA_TYPE.audio,t.media[r]):t.media[r].type==="video"&&n(e.MEDIA_TYPE.video,t.media[r])}return{build:function(e){return e=e||{},{createLocalOffer:function(t){return new i(e,"offer",t)},createRemoteOffer:function(t){return new i(e,"offer",t,!0)},createLocalAnswer:function(t){return new i(e,"answer",t)},createRemoteAnswer:function(t){return new i(e,"answer",t,!0)},createInactiveOfferSdp:s.bind(null,e,"offer"),createInactiveAnswerSdp:s.bind(null,e,"answer")}}}}),define("jSkype/services/mediaAgent/adapter/webkitAdapter",[],function(){function e(){function e(e){return"RTP/SAVPF"!==e.protocol}this.toRemote=function(t){t.media.forEach(function(t){!e(t)&&t.port===0&&!t.crypto&&(t.crypto=[{id:1,suite:"AES_CM_128_HMAC_SHA1_80",config:"inline",sessionConfig:"PS1uQCVeeCFCanVmcjkpPywjNWhcYD0mXXtxaVBR|2^20|1:32"}])})}}return{build:function(){return new e}}}),define("jSkype/services/mediaAgent/adapter/webrtcAdapter",["./webkitAdapter","../userAgentAdapter"],function(e,t){function n(){function e(){}this.toRemote=e}function r(){return typeof t.window.webkitRTCPeerConnection!="undefined"}function i(){return typeof t.window.mozRTCPeerConnection!="undefined"}return{build:function(){return r()?e.build():i()?new n:new n}}}),define("jSkype/services/mediaAgent/statistics/webrtcStatistics",["../helper"],function(e){function t(t){function s(e,t){var n=[];return e.forEach(function(e){var r={tracks:[]};n.push(r),e.getTracks().forEach(function(n){("audio"===n.kind&&t.audio||"video"===n.kind&&t.video)&&r.tracks.push({stream:e,track:n})})}),n}var n,r,i={localStreams:[],remoteStreams:[],webrtc:{CorrelationId:t,Extensions:{SdesSrtp:!1}}};this.setNegotiatedModalities=function(e){r=e},this.setPeerConnection=function(e){n=e},this.setSdesSrtp=function(e){i.webrtc.Extensions.SdesSrtp=e},this.getReport=function(){return new Promise(function(t){n&&(i.localStreams=s(n.getLocalStreams(),{audio:e.hasSendDirectionality(r.audio),video:e.hasSendDirectionality(r.video)}),i.remoteStreams=s(n.getRemoteStreams(),{audio:e.hasReceiveDirectionality(r.audio),video:e.hasReceiveDirectionality(r.video)})),t(i)})}}return{build:function(e){return new t(e)}}}),define("jSkype/services/mediaAgent/webRtcSession",["./constants","./helper","./webRtcSessionDescription","./adapter/webrtcAdapter","./statistics/webrtcStatistics","./userAgentAdapter"],function(e,t,n,r,i){var s=function(s,o){function P(e){f.error("Media error occurred","type:",e.type,"detail:",e.detail),u.onSessionErrorOccurred&&u.onSessionErrorOccurred(e)}function H(e){d=e,y.forEach(function(e){e._updateStream()})}function B(e){!!d&&e===d&&(d=null,y.forEach(function(e){e._updateStream()}))}function j(){y.forEach(function(e){e._unsubscribeIfSubscribed()})}function F(e){m?window.detachMediaStream(m):(m=document.createElement("audio"),document.body.appendChild(m),m.autoplay=!0,m.addEventListener("error",function(){f.error("_audio.onerror","error:",m?m.error:"<no audio element>")})),window.attachMediaStream(m,e),v=e}function I(e){!!v&&e===v&&(m&&(document.body.removeChild(m),window.detachMediaStream(m),m=null),v=null)}function q(e){x=e,M.setNegotiatedModalities(e)}function R(){f.log("reset candidate gathering"),b.promise.then(function(){},function(){}),b.reject(new Error("reset candidate gathering")),b=t.defer()}function U(){b.resolve()}function z(){f.log("reset peer connection"),B(d),I(v),h&&h.close(),g&&(g.dispose(),g=null),h=null,p=null,R(),w=!0,x={}}function W(){O=setTimeout(function(){f.error("ice disconnected for ",A,"ms. Raise CONSTANTS.MEDIA_ERROR.iceConnectionError"),P({type:e.MEDIA_ERROR.iceConnectionError,detail:"ice transport disconnected"})},A)}function X(){O&&(clearTimeout(O),O=null)}function V(e){return e.reduce(function(e,t){return t.addresses.map(function(n){function r(e,r){return{urls:t.type+":"+n+":"+e+(r?"?transport="+r:""),credential:t.password,username:t.username}}t.udpPort===t.tcpPort?e.push(r(t.udpPort)):(e.push(r(t.udpPort,"udp")),e.push(r(t.tcpPort,"tcp")))}),e},[])}function $(){return p||(p=s.maContext.getRelayManager().queryRelaysAsync("turn",s.config.isRemoteClientLync).then(function(t){var n={};f.log("create peer connection"),a.sdes&&S&&!S.hasDtls()&&(f.log("configuring peer connection to use SDES"),n.optional=[{DtlsSrtpKeyAgreement:!1}],M.setSdesSrtp(!0)),h=new RTCPeerConnection({iceServers:V(t)},n),M.setPeerConnection(h),h.onnegotiationneeded=function(e){var t=e.target;f.log("onnegotiationneeded","signalingState:",t.signalingState)},h.onsignalingstatechange=function(e){var t=e.target;f.log("onsignalingstatechange","signalingState:",t.signalingState)},h.onaddstream=function(e){f.log("onaddstream","stream:",e.stream),e.stream.getAudioTracks().length>0&&F(e.stream),e.stream.getVideoTracks().length>0&&H(e.stream)},h.ontrack=function(e){f.log("ontrack","track:",e.track)},h.onremovestream=function(e){f.log("onremovestream","stream:",e.stream),B(e.stream),I(e.stream)},h.onicecandidate=function(e){f.log("onicecandidate","candidate:",e.candidate),e.candidate||U()},h.onicegatheringstatechange=function(e){var t=e.target;f.log("onicegatheringstatechange","iceGatheringState:",t.iceGatheringState)},h.oniceconnectionstatechange=function(t){var n=t.target;f.log("oniceconnectionstatechange","iceConnectionState:",n.iceConnectionState,"pc.signalingState:",n.signalingState),n.iceConnectionState==="failed"&&P({type:e.MEDIA_ERROR.iceConnectionError,detail:"ice transport failed"}),n.iceConnectionState==="disconnected"?W():X()}})),p}function J(e){if(!N)throw new Error(e)}function K(e){function n(e){return!!e&&(t.hasReceiveDirectionality(e)||e==="inactive")}return{offerToReceiveAudio:n(e.audio)?1:0,offerToReceiveVideo:n(e.video)?1:0}}function Q(){w&&!k&&(w=!1,f.log("trigger (re)negotiation"),u.onNegotiationRequired&&u.onNegotiationRequired())}function G(e){return new Promise(function(n){if(!e||!e.audio&&!e.video)throw new Error("Invalid parameters!"+JSON.stringify(e));var r=!N||!t.areNegotiatedDirectionsFulfilled(e,x);N=e,f.log("configure modalities","audio:",e.audio,"video:",e.video,"peerconnection:",!!h,"pc.signalingState:",h?h.signalingState:"-","needNewRenegotiation:",r),r&&Q(),n()})}function Y(e,n,r){var i=t.hasSendDirectionality(x.audio),s=t.hasSendDirectionality(x.video),o=t.isOnHold(x),u=t.hasSendDirectionality(e.audio),a=t.hasSendDirectionality(e.video),c=t.isOnHold(e);return $().then(function(){f.log("updatePeerConnectionStreamsAsync","pc state",h.signalingState,"hold","[",o,"->",c,"]","audio","[",i,"->",u,"]","video","[",s,"->",a,"]");if(o!==c){g&&g.setHold(c);if(c)return}if(i!==u||s!==a||E){r&&(E=!1);if(!h.addTrack){var e=function(){if(g)try{var e=g.getObject();f.log("remove media stream","audio tracks:",e.getAudioTracks(),"video tracks:",e.getVideoTracks()),h.removeStream(e)}finally{g.dispose(),g=null}};n&&(f.log("not using any media(stream api) track, remove stream"),e());if(r&&(u||a))return l.getMediaStreamRefAsync({audio:u,video:a}).then(function(t){try{var n=t.getObject();f.log("received media(stream api) tracks","wantSendAudio:",u,"wantSendVideo:",a),f.log("add media stream","audio tracks:",n.getAudioTracks(),"video tracks:",n.getVideoTracks()),h.addStream(n),g=t}catch(r){try{e()}finally{t.dispose()}throw r}})}else{var t=function(){if(g)try{h.getSenders().forEach(function(e){f.log("remove sender","track kind:",e.track.kind,"track id:",e.track.id),h.removeTrack(e)})}catch(e){f.warn("removeTrack returned error(maybe the mozilla bug, check code for comment)",e)}finally{g.dispose(),g=null}};n&&(f.log("not using any media(track api) track, remove all senders"),t());if(r&&(u||a))return l.getMediaStreamRefAsync({audio:u,video:a}).then(function(e){try{f.log("received media(track api) tracks","wantSendAudio:",u,"wantSendVideo:",a),e.getObject().getTracks().forEach(function(t){f.log("add stream","track kind:",t.kind,"track id:",t.id),h.addTrack(t,e.getObject())}),g=e}catch(n){try{t()}finally{e.dispose()}throw n}})}}})}function Z(){if(k)throw k=!1,L=!0,new Error("fail offer as previous GLARE invalidated pc state!")}function et(){return new Promise(function(e){f.log("create [offer] configured:",N),J("no configured modalities to create offer for"),w=!1,C=N,T=N;var n,r=t.negotiateModalities(T,N);t.isOnHold(r)?e(Y(T,!0,!0).then(function(){var e=c.createInactiveOfferSdp(h.localDescription.sdp,T);return f.debug("CREATE OFFER hold","sdp:",e),{sdp:e,modalities:r}})):e(Y(T,!0,!0).then(function(){var e=K(T);return f.log("create [offer]","offered:",T,"constraints:",e),h.createOffer(e)}).then(function(e){f.debug("create [offer] offer from peer connection","sdp:",e.sdp),n=c.createLocalOffer(e.sdp);var t=n.toLocal(T);return f.log("create [offer], collect ice candidates and set local description","sdp:",t),n.needToWaitIceCandidates()&&R(),Promise.all([h.setLocalDescription(new RTCSessionDescription({sdp:t,type:"offer"})),b.promise])}).then(function(){var e=n.toOffer(h.localDescription.sdp);return f.debug("CREATE OFFER","sdp:",e),{sdp:e,modalities:r}}))})}function tt(e){return new Promise(function(n){f.debug("process [offer]","sdp:",e),S=c.createRemoteOffer(e),w=!1,T=t.invertModalities(S.getModalities()),f.log("process [offer]","offered:",T),Z(),n(T)})}function nt(e){return new Promise(function(n){if(e){n("");return}f.log("create [answer]","offered:",T,"configured:",N),J("no configured modalities to create answer for"),C=N;var r,i=t.negotiateModalities(T,N);t.isOnHold(i)?n(Y(i,!0,!0).then(function(){q(i);var e=c.createInactiveAnswerSdp(h.localDescription.sdp,x);return f.debug("CREATE ANSWER hold","sdp:",e),{sdp:e,modalities:x}})):n(Y(i,!0,!1).then(function(){var e=S.toRemote(i);return f.log("create [answer] set remote description","negotiated:",i,"sdp:",e),h.setRemoteDescription(new RTCSessionDescription({sdp:e,type:"offer"}))}).then(function(){return Y(i,!1,!0)}).then(function(){return q(i),h.createAnswer()}).then(function(e){f.debug("create [answer] answer from peer connection","sdp:",e.sdp),r=c.createLocalAnswer(e.sdp);var t=r.toLocal(x);return f.log("create [answer], collect ice candidates and set local description","sdp:",t),r.needToWaitIceCandidates()&&R(),Promise.all([h.setLocalDescription(new RTCSessionDescription({sdp:t,type:"answer"})),b.promise])}).then(function(){var e=r.toAnswer(h.localDescription.sdp);return f.debug("CREATE ANSWER","sdp:",e),{sdp:e,modalities:x}}))})}function rt(e,n){return new Promise(function(r){f.debug(n?"PROCESS PRANSWER":"PROCESS ANSWER","sdp:",e);if(n){f.log("process [pranswer]"),r("");return}var i=c.createRemoteAnswer(e),s=t.invertModalities(i.getModalities());q(s);if(!t.isOnHold(x)){var o=i.toRemote(x);f.log("process [answer] set remote description","negotiated:",x,"sdp:",o),r(h.setRemoteDescription(new RTCSessionDescription({sdp:o,type:"answer"})).then(function(){return x}))}else r(x)})}function it(){return new Promise(function(e){var n=E&&!t.isOnHold(x)||!t.areNegotiatedDirectionsAcceptable(N,C,x),r=!n;w=!0,f.log("negotiation completed","isComplete:",r,"configured:",N,"negotiating:",C,"offered:",T,"negotiated:",x),n&&Q(),e({isComplete:r,activeModalities:x,configuredModalities:N})})}function st(t,n){return new Promise(function(r){var i=t===e.RENEGOTIATION_ERROR.local&&!L;L=!1,f.warn("negotiation rejected","isComplete:",i,"error:",t,"configured:",N,"negotiating:",C,"offered:",T,"negotiated:",x),z(),t===e.RENEGOTIATION_ERROR.glare&&(k=!0,w=!1),n&&(f.log("retrying failed negotiation"),Q()),r({isComplete:i,activeModalities:x,configuredModalities:N})})}function ot(e,n){var r=function(e,n){l.Renderer.call(this,e,n);var r=this,i=this.dispose,s=null;this._updateStream=function(){r._attachMediaStream(d),s&&(s.resolve(),s=null)},this._unsubscribeIfSubscribed=function(){s&&(s.reject(),s=null);var e=y.indexOf(r);e!==-1&&y.splice(e,1)},this.subscribeVideoAsync=function(e){return f.info("subscribeVideoAsync","msi:",e),new Promise(function(e){r._unsubscribeIfSubscribed();var n=y.indexOf(r);n===-1&&y.push(r),d?(r._attachMediaStream(d),e()):(s=t.defer(),e(s.promise))})},this.dispose=function(){r._unsubscribeIfSubscribed(),i()}};return new r(e,n)}function ut(){h&&(t.isOnHold(x)||(E=!0,Q()))}function at(){f.log("terminate"),ft().then(function(){D=!0,j(),z(),X(),u._onTerminated&&u._onTerminated(u)})}function ft(){return D?_:(_=M.getReport().catch(function(e){return f.error("getting statistics should never fail:",e),{}}),_)}this.configureModalitiesAsync=G,this.createOfferAsync=et,this.processOfferAsync=tt,this.createAnswerAsync=nt,this.processAnswerAsync=rt,this.completeNegotiationAsync=it,this.rejectNegotiationAsync=st,this.createRemoteRenderer=ot,this.getStatsAsync=ft,this.terminate=at,this._deviceSelectionChanged=ut,this._onTerminated=null,this.onNegotiationRequired=null,this.onSessionErrorOccurred=null;var u=this,a=s.maContext.settings,f=s.getLogger(),l=s.getDeviceManager(),c=n.build({adapter:r.build(),settings:a,logger:f}),h=null,p,d=null,v=null,m=null,g=null,y=[],b=t.defer(),w=!0,E=!1,S,x={},T,N,C,k=!1,L=!1,A=1e4,O=null,M=i.build(o),_=Promise.resolve({}),D=!1};return{build:function(e,t,n){return new s(e,t,n)}}}),define("jSkype/services/mediaAgent/ortcTransport",["./constants","./helper"],function(e,t){function n(n,r,i,s,o,u,a){var f=this,l=t.defer(),c,h;this.nominatedCandidatePair=null,r.log("create RTCIceGatherer","options:",JSON.stringify(o.iceGathererOptions)),u?this.iceGatherer=u.createAssociatedGatherer():this.iceGatherer=new RTCIceGatherer(o.iceGathererOptions),r.log("create RTCIceTransport"),a?this.iceTransport=a.createAssociatedTransport():this.iceTransport=new RTCIceTransport,this.getLocalCandidatesAsync=function(){return l.promise},this.start=function(e,t){if(h)throw new Error("already started!");h=!0,c=i.createCb(o.iceRole),r.log("RTCIceTransport setRemoteCandidates","candidates:",JSON.stringify(e)),f.iceTransport.setRemoteCandidates(e),r.log("RTCIceTransport start","remoteIceParams:",JSON.stringify(t),"role:",o.iceRole),f.iceTransport.start(f.iceGatherer,t,o.iceRole),r.log("RTCIceTransport start","role:",f.iceTransport.role)},this.dispose=function(){r.log("dispose"),f.iceTransport.stop(),f.iceTransport=null,f.iceGatherer=null,l.isPending()&&l.reject(new Error("operation canceled due to stop")),c&&c.dispose()},this.iceGatherer.onlocalcandidate=function(e){r.log("RTCIceGatherer.onlocalcandidate","candidate:",JSON.stringify(e.candidate)),Object.keys(e.candidate).length===0&&l.resolve()},this.iceGatherer.onerror=function(e){r.error("RTCIceGatherer.onerror","event:",e),l.reject(new Error("IceGatherer failed!"))},this.iceTransport.onicestatechange=function(){f.iceTransport&&(r.log("RTCIceTransport.onicestatechange","state:",f.iceTransport.state),f.iceTransport.state==="completed"&&(r.log("pair:",JSON.stringify(f.iceTransport.getNominatedCandidatePair())),f.nominatedCandidatePair=f.iceTransport.getNominatedCandidatePair(),c.iceCompleted()),n==="audio"&&f.iceTransport.state==="disconnected"&&(r.error("audio ICE transport disconnected, ending call!"),s({type:e.MEDIA_ERROR.iceConnectionError,detail:"ice transport disconnected"})))},this.iceTransport.oncandidatepairchange=function(e){r.log("RTCIceTransport.oncandidatepairchange","event:",e)}}function r(t,n,r){var i=this,s=!1;this.dtlsTransport=new RTCDtlsTransport(n),this.dtlsTransport.ondtlsstatechange=function(){t.log("RTCDtlsTransport.ondtlsstatechange","state:",event.state,"role:",i.dtlsTransport?i.dtlsTransport.getLocalParameters().role:"")},this.dtlsTransport.onerror=function(n){t.error("RTCDtlsTransport.onerror","event:",n),r({type:e.MEDIA_ERROR.srtpError,detail:n})},this.startAsync=function(e){if(s)throw new Error("already started!");return s=!0,t.log("RTCDtlsTransport.start","params:",JSON.stringify(e)),i.dtlsTransport.start(e),Promise.resolve()},this.dispose=function(){s&&i.dtlsTransport.stop(),i.dtlsTransport=null}}function i(e,t,i,s,o,u){function h(e){var t=e;if(o.iceCandidateType||o.iceCandidateTransport)t=t.filter(function(e){var t=!0,n=!0;return o.iceCandidateType&&(t=e.type.match(new RegExp(o.iceCandidateType),"i")),o.iceCandidateTransport&&(n=e.protocol.match(new RegExp(o.iceCandidateTransport,"i"))),t&&n});return t}function p(){return{iceParams:a.iceGatherer.getLocalParameters(),iceCandidates:h(a.iceGatherer.getLocalCandidates()),iceCandidatePair:a.nominatedCandidatePair,dtlsParams:l?l.dtlsTransport.getLocalParameters():null,rtcpIceParams:f?f.iceGatherer.getLocalParameters():null,rtcpIceCandidates:f?h(f.iceGatherer.getLocalCandidates()):null,rtcpIceCandidatePair:f?f.nominatedCandidatePair:null}}var a,f,l,c=!1;a=new n(e,t.createChild("IceT"),i,s,o),l=new r(t.createChild("DtlsT"),a.iceTransport,s),u&&(f=new n(e,t.createChild("RtcpIceT"),i,s,o,a.iceGatherer,a.iceTransport)),Object.defineProperty(this,"iceTransport",{get:function(){return a.iceTransport}}),Object.defineProperty(this,"dtlsTransport",{get:function(){return l?l.dtlsTransport:null}}),this.getLocalParamsAsync=function(){var e;return f?e=Promise.all([a.getLocalCandidatesAsync(),f.getLocalCandidatesAsync()]):e=a.getLocalCandidatesAsync(),e.then(function(){return p()})},this.startAsync=function(e){if(c)throw new Error("already started!");var t=Promise.resolve();return c=!0,a.start(e.iceCandidates,e.iceParams),f&&(e.doRtcpMux?(f.dispose(),f=null):f.start(e.rtcpIceCandidates,e.rtcpIceParams)),e.enableDtls&&(t=l.startAsync(e.dtlsParams)),t},this.dispose=function(){t.log("dispose"),a.dispose(),a=null,f&&(f.dispose(),f=null),l&&(l.dispose(),l=null)}}function s(e,n){function u(t){this.dispose=function(){var e=r.indexOf(this);e!==-1&&r.splice(e,1)},this.gotCallback=!1,this.iceCompleted=function(){this.gotCallback=!0,this.gotCallbackFromControlling=t==="controlling";var u=0,a=0;for(var f=0;f<r.length;f++)r[f].gotCallback&&u++,r[f].gotCallbackFromControlling&&a++;a&&a===o&&!i&&(e.log("IceCompletionMonitor REINVITE"),i=!0,n.triggerIceReinvite()),u&&u===r.length&&(e.log("IceCompletionMonitor ALL COMPLETE"),s.resolve())}}var r=[],i=!1,s=t.defer(),o=0;this.createCb=function(e){var n=new u(e);return r.push(n),e==="controlling"&&(i=!1,o++),s.reject(),s=t.defer(),n},this.waitAllCallbacksAsync=function(){return s.promise}}function o(e,t,n,r,o,u){function p(){return h||(h=r.queryRelaysAsync("msturn",o)),h}var a,f,l=[!1,!1],c=new s(e,n),h;Object.defineProperty(this,"audioTransport",{get:function(){return a?a:null}}),Object.defineProperty(this,"videoTransport",{get:function(){return f?f:null}}),this.assureInitAsync=function(r,s){return new Promise(function(o){e.log("assureInitAsync");var l=p().then(function(o){var l={iceRole:r,iceCandidateType:t.iceCandidateType,iceCandidateTransport:t.iceCandidateTransport,iceGathererOptions:{gatherPolicy:"all",iceServers:o.reduce(function(e,t){return t.addresses.map(function(n){e.push({urls:t.type+":"+n+":"+t.udpPort+"?transport=udp",credential:t.password,username:t.username}),e.push({urls:t.type+":"+n+":"+t.tcpPort+"?transport=tcp",credential:t.password,username:t.username})}),e},[])}};!a&&s[0]&&(e.log("assureInitAsync AUDIO"+l.iceRole),a=new i("audio",e.createChild("AT"),c,n.raiseError,l,u)),!f&&s[1]&&(e.log("assureInitAsync VIDEO"+l.iceRole),f=new i("video",e.createChild("VT"),c,n.raiseError,l,u))});o(l)})},this.getLocalParamsAsync=function(){return e.log("getLocalParamsAsync"),new Promise(function(e){var t=Promise.resolve(),n=Promise.resolve();a&&(t=a.getLocalParamsAsync()),f&&(n=f.getLocalParamsAsync()),e(Promise.all([t,n]))})},this.waitIceCompletionIfNeededAsync=function(t){return new Promise(function(n){var r="";if(t[0]&&t[0].iceCandidatePair||t[1]&&t[1].iceCandidatePair)e.log("waiting ICE completed state!"),r=c.waitAllCallbacksAsync();n(r)})},this.configureTransportAsync=function(e,t){return new Promise(function(n){var r=Promise.resolve(),i=Promise.resolve();t[0]&&!l[0]?r=a.startAsync(e[0]):!t[0]&&l[0]&&(a.dispose(),a=null),t[1]&&!l[1]?i=f.startAsync(e[1]):!t[1]&&l[1]&&(f.dispose(),f=null),l=t,n(Promise.all([r,i]))})},this.stop=function(){a&&(a.dispose(),a=null),f&&(f.dispose(),f=null)}}return o}),define("jSkype/services/mediaAgent/ortcHelper",["./constants","./helper"],function(e,t){function n(e,t){return e.toLowerCase()===t.toLowerCase()}function r(t){return t.enabled?t.send&&t.recv?e.MEDIA_STATE.sendReceive:t.send?e.MEDIA_STATE.send:t.recv?e.MEDIA_STATE.receive:e.MEDIA_STATE.inactive:null}function i(t){if(t===e.MEDIA_LABEL.audio)return e.MEDIA_TYPE.audio;if(t===e.MEDIA_LABEL.video)return e.MEDIA_TYPE.video;if(t===e.MEDIA_LABEL.screensharing)return e.MEDIA_TYPE.video;throw new Error("unsupported label")}function s(e,n){return{enabled:!!e,type:i(n),label:n,send:t.hasSendDirectionality(e),recv:t.hasReceiveDirectionality(e)}}function o(e,t){for(var n=0;n<e.length;n++)if(e[n].descr.label===t)return e[n].descr;return{enabled:!1,type:i(t),label:t,send:!1,recv:!1}}function u(t){var n={},i=o(t.media,e.MEDIA_LABEL.audio),s=o(t.media,e.MEDIA_LABEL.video);return i.enabled&&(n.audio=r(i)),s.enabled&&(n.video=r(s)),n}function a(e,r,i){var s=[];return e&&r&&e.forEach(function(e){for(var o=0;o<r.length;o++){var u=r[o];if(n(e.name,u.name)&&n(e.kind,u.kind)&&e.numChannels===u.numChannels&&e.clockRate===u.clockRate){var a=t.shallowClone(e);a.preferredPayloadType=i?e.preferredPayloadType:u.preferredPayloadType,s.push(a);break}}}),s}function f(e,n){function r(e,t){var n=e.keyParams[0],r=t.keyParams[0];return e.cryptoSuite===t.cryptoSuite&&n.mkiLength===r.mkiLength&&n.mkiValue===r.mkiValue}for(var i=0;i<n.length;++i){var s=n[i];for(var o=0;o<e.length;++o){var u=e[o];if(r(s,u))return{localSdesParams:t.shallowClone(u),remoteSdesParams:t.shallowClone(s)}}}return null}function l(e,t){var n=[];return e&&t&&e.forEach(function(e){for(var r=0;r<t.length;r++){var i=t[r];e.kind===i.kind&&e.uri===i.uri&&n.push(e)}}),n}function c(e,t,n){var r=null;return e&&t&&(r={codecs:a(e.codecs,t.codecs,n),headerExtensions:l(e.headerExtensions,t.headerExtensions),fecMechanisms:e.fecMechanisms.filter(function(e){return t.fecMechanisms.indexOf(e)!==-1})}),r}function h(e,t,n,r,i){return g("",d(e.codecs),v(e.headerExtensions),m(e.codecs,t),w(n,"",r,i))}function p(e,t,n,r,i){return h(e,t,n,r,i)}function d(e){var t=[];return e.forEach(function(e){t.push(y(e.name,e.preferredPayloadType,e.clockRate,e.numChannels,e.rtcpFeedback,e.parameters))}),t}function v(e){var t=[];return e.forEach(function(e){t.push(b(e.uri,e.preferredId,e.preferredEncrypt))}),t}function m(e,t){var n=[];return n.push(E(t,0,0,0,1)),n}function g(e,t,n,r,i){return{muxId:e||"",codecs:t,headerExtensions:n,encodings:r,rtcp:i}}function y(e,t,n,r,i,s){return{name:e,payloadType:t,clockRate:n,numChannels:r,rtcpFeedback:i,parameters:s}}function b(e,t,n){return{uri:e,id:t,encrypt:n}}function w(e,t,n,r){return{ssrc:e,cname:t,reducedSize:n,mux:r}}function E(e,t,n,r,i,s,o,u,a,f,l,c,h,p){return{ssrc:e.min,ssrcRange:e,codecPayloadType:t,fec:n,rtx:r,priority:i||1,maxBitrate:s,minQuality:o||0,framerateBias:u||.5,resolutionScale:a||1,framerateScale:f||1,active:c||!0,encodingId:h,dependencyEncodingId:p}}return{getStateFromDescr:r,getDescrFromState:s,findDescrFromMedia:o,getModalitiesFromParams:u,findMatchingSdesParams:f,matchRtpCaps:c,getSendParams:h,getRecvParams:p,RTCRtpParameters:g,RTCRtpCodecParameters:y,RTCRtpHeaderExtensionParameters:b,RTCRtcpParameters:w,RTCRtpEncodingParameters:E}}),define("jSkype/services/mediaAgent/common/utils",[],function(){function e(e,t){for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)}return{forOwn:e}}),define("jSkype/services/mediaAgent/ortcChannelStats",["./helper","./common/utils"],function(e,t){function n(n,r,i,s){function u(){if(!r)return"CheckNotCompleted";var e=r.state;return e==="new"||e==="checking"||e==="connected"?"CheckNotCompleted":e==="completed"?"CheckSucceed":e==="failed"?"CheckFailed":e==="disconnected"||e==="closed"?"MediaTimeout":"Unknown DiagnosticReason"}var o=n.logger.createChild("ChannelStats");this.getReport=function(){function a(r,i,s){if(!r)return;var u=i+"."+(s?"msGetStats":"getStats"),a=(new Promise(function(e){o.log(u,"start"),e(s?r.msGetStats():r.getStats())})).then(function(e){o.log(u,"complete"),n[i]=n[i]||{},t.forOwn(e,function(e){n[i][e.type||e.msType]=e})}).catch(function(e){o.warn(u,"failed:",e)});return e.timeout(a,5e3,u).catch(function(e){o.warn(u,"failed:",e)})}var n={};return n.extended={mediaDiagnostic:{reason:u()}},new Promise(function(e){Promise.all([a(r,"iceTransport",!1),a(r,"iceTransport",!0),a(i,"sender",!1),a(i,"sender",!0),a(s,"receiver",!1),a(s,"receiver",!0)]).then(function(){e(n)}).catch(function(t){o.error("getting statistics should never fail",t),e(n)})})}}return{build:function(e,t,r,i){return new n(e,t,r,i)}}}),define("jSkype/services/mediaAgent/ortcMediaChannel",["./ortcHelper","./constants","./ortcChannelStats"],function(e,t,n){function r(r,i,s,o,u,a){function w(){var e=RTCRtpReceiver.getCapabilities(s),n;if(e.codecs)if(s===t.MEDIA_TYPE.audio&&i.audioCodec){var r=["cn","red"];for(n=e.codecs.length-1;n>=0;n--){var o=e.codecs[n].name.toLowerCase();o!==i.audioCodec.toLowerCase()&&r.indexOf(o)===-1&&e.codecs.splice(n,1)}}else if(s===t.MEDIA_TYPE.video&&i.videoCodec)for(n=e.codecs.length-1;n>=0;n--)e.codecs[n].name.toLowerCase()!==i.videoCodec.toLowerCase()&&e.codecs.splice(n,1);if(s===t.MEDIA_TYPE.audio)for(n=e.codecs.length-1;n>=0;n--)e.codecs[n].preferredPayloadType===106&&(e.codecs[n].preferredPayloadType=111);return e}function E(e){return e.cryptoSuite!=="SCALE_AES_CM_128_HMAC_SHA1_80"}function S(e){var t,n,i;T()?(n=h.getObject().getAudioTracks()[0],t=e.getObject().getAudioTracks()):(n=h.getObject().getVideoTracks()[0],t=e.getObject().getVideoTracks()),i=t.length?t[0]:null;if(i===null){r.error("media track is not available");return}var s=n.getSettings().deviceId,o=i.getSettings().deviceId;s!==o?(r.log("replacing media track","currDevID:",s,"newDevID:",o,"currTrackID:",n.id,"newTrackID:",i.id),l.setTrack(i),h.dispose(),h=e.clone()):r.log("NOT replacing media track","currDevID:",s,"newDevID:",o,"currTrackID:",n.id,"newTrackID:",i.id)}function x(e,n){p||(r.debug("RTCSrtpSdesTransport","local:",JSON.stringify(n.sdesParamsList[0]),"remote:",JSON.stringify(n.remoteSdesParams)),p=new RTCSrtpSdesTransport(e,n.sdesParamsList[0],n.remoteSdesParams),p.onerror=function(e){r.log("RTCSrtpSdesTransport.onerror","event:",e),u({type:t.MEDIA_ERROR.srtpError,detail:e})})}function T(){return s===t.MEDIA_TYPE.audio}function N(){return s===t.MEDIA_TYPE.video}function C(){p&&(p=null)}function k(){if(c){var e;try{e=c.getContributingSources()}catch(t){r.error("failed to retrieve contributing sources from receiver","error:",t);return}if(!e){r.warn("could not retrieve contributing sources from receiver");return}e=e.map(function(e){return e.csrc});var n=y.length===e.length&&e.every(function(e,t){return e===y[t]});n||(r.debug("contributing sources changed","sources:",e),f.onContributingSourcesChanged&&f.onContributingSourcesChanged(e)),y=e,setTimeout(k,m)}else r.debug("receiver is missing, stop polling for contributing sources")}function L(e){if(c){r.log("_requestSendCsrc","csrc:",e);try{c.requestSendCSRC(e)}catch(t){r.error("failed to request send csrc","error:",t)}return!0}return!1}function A(e,n){r.log("_rtpReceiver create");if(n.enableDtls){if(!n.rtcpMux)throw new Error("rtcpMux=false not supported with dtls!");c=new RTCRtpReceiver(e.dtlsTransport,s)}else x(e.iceTransport,n),c=new RTCRtpReceiver(p,s);g=c.track,c.onerror=function(e){r.error("_rtpReceiver.onerror","event:",e),u({type:t.MEDIA_ERROR.internalError,detail:e})}}function O(e,n,i){var s;T()?s=n.getObject().getAudioTracks()[0]:s=n.getObject().getVideoTracks()[0],r.log("_rtpSender create trackID:",s.id);if(i.enableDtls){if(!i.rtcpMux)throw new Error("rtcpMux=false not supported with dtls!");l=new RTCRtpSender(s,e.dtlsTransport)}else x(e.iceTransport,i),l=new RTCRtpSender(s,p);l.onerror=function(e){r.error("_rtpSender.onerror","event:",e),u({type:t.MEDIA_ERROR.internalError,detail:e})},l.onssrcconflict=function(e){r.error("_rtpSender.onssrcconflict","event:",e)}}function M(t){return e.getRecvParams(t.rtpCaps,t.remoteSsrcRange,a.min,t.rtcpReducedSize,t.rtcpMux)}function _(t){return e.getSendParams(t.rtpCaps,a,t.remoteSsrcRange.min,t.rtcpReducedSize,t.rtcpMux)}function D(e,n){function i(){var n=M(e);r.debug("_rtpReceiver.receive:",JSON.stringify(n)),c.receive(n),T()?k():f.subscribedMsi!==t.MSI.unsubscribe&&L(f.subscribedMsi)}c&&j(e)&&(r.log("SSRC changed, resetting receiver"),c.stop(),c=null),c?v&&i():(A(n,e),i())}function P(){c&&(r.log("_rtpReceiver stop & destroy"),c.stop(),c=null,g=null,l||C())}function H(e,t,n){function i(){var t=_(e);r.debug("_rtpSender.send:",JSON.stringify(t)),l.send(t),h?S(n):h=n.clone()}l&&j(e)&&(r.log("SSRC changed, resetting sender"),l.stop(),l=null),l?v&&i():(O(t,n,e),i())}function B(){l&&(r.log("_rtpSender stop & destroy"),l.stop(),l=null,c||C(),h.dispose(),h=null)}function j(e){return b&&e.remoteSsrcRange&&(b.min!==e.remoteSsrcRange.min||b.max!==e.remoteSsrcRange.max)}function F(e){if(!v){if(c){var t=M(e);r.debug("_rtpReceiver.receive:",JSON.stringify(t)),r.log("_rtpReceiver.receive ACTIVE -> INACTIVE"),t.encodings[0].active=!1,c.receive(t)}if(l){var n=_(e);r.debug("_rtpSender.send","params:",JSON.stringify(n)),r.log("_rtpSender.send ACTIVE -> INACTIVE"),n.encodings[0].active=!1,l.send(n)}v=!0}}var f=this,l=null,c=null,h=null,p=null,d=null,v=!1,m=1e3,g=null,y=[],b=null;this.type=s,this.label=o,this.subscribedMsi=t.MSI.unsubscribe,this.onContributingSourcesChanged=null,i.disableSdes||(d=RTCSrtpSdesTransport.getLocalParameters().filter(E)),this.getLocalParameters=function(){return{sdesParamsList:d,rtpCaps:w(),ssrcRange:a}},this.configureChannel=function(e,t,n){r.log("configureChannel","type:",s,"descr:",JSON.stringify(n.descr));if(n.descr.enabled){var i=!n.descr.send&&!n.descr.recv;i?F(n):(n.descr.recv?D(n,e):P(),n.descr.send?H(n,e,t):B(),v=!1),b=n.remoteSsrcRange}else P(),B()},this.updateLocalMediaStream=function(e){l&&S(e)},this.canSubscribe=function(){return c&&f.subscribedMsi===t.MSI.unsubscribe&&N()},this.subscribe=function(e){if(f.subscribedMsi===t.MSI.unsubscribe&&N())return f.subscribedMsi=e,L(f.subscribedMsi);throw new Error("invalid call for subscribe:"+f.subscribedMsi+"type:"+s)},this.unsubscribe=function(){if(f.subscribedMsi===t.MSI.unsubscribe||!N())throw new Error("invalid call for unsubscribe:"+f.subscribedMsi+"type:"+s);f.subscribedMsi=t.MSI.unsubscribe,L(f.subscribedMsi)},this.getReportsAsync=function(){var e=c?c.transport.transport:l?l.transport.transport:null,t=n.build({logger:r},e,l,c);return t.getReport()},this.getSendTrack=function(){return l&&!v?l.track:null},this.getRecvTrack=function(){return v?null:g},this.terminate=function(){l=null,c=null,g=null,C(),h&&(h.dispose(),h=null),r.log("termiated")}}return r}),define("jSkype/services/mediaAgent/ortcNegotiation",["./ortcHelper","./constants","./helper","./userAgentAdapter"],function(e,t,n){function r(r,i,s){function f(e){o=e,r.debug("PROCESS OFFER","params:",JSON.stringify(o))}function l(e,t){t||(t={enabled:!0,send:!0,recv:!0});var n=e.send&&e.enabled&&t.recv&&t.enabled,r=e.recv&&e.enabled&&t.send&&t.enabled,i=e.enabled&&t.enabled&&(n||r||!e.send&&!e.recv||!t.send&&!t.recv);return{enabled:i,type:e.type,label:e.label,send:n,recv:r}}function c(n){if(a&&a.media.length>o.media.length)throw new Error("Invalid remote offer - removed media lines");var r=[],i,u=!1,f=0;for(var c=0;c<o.media.length;c++){if(a&&a.media[c]){if(a.media[c].type!==o.media[c].type)throw new Error("Changing media type not supported");if(a.media[c].label&&o.media[c].label&&a.media[c].label!==o.media[c].label)throw new Error("Changing media label not supported")}o.media[c].descr.label===t.MEDIA_LABEL.audio&&!u?(i=l(e.getDescrFromState(n.audio,t.MEDIA_LABEL.audio),o.media[c].descr),r.push(i),u=!0):o.media[c].descr.label===t.MEDIA_LABEL.video&&f<s?(i=l(e.getDescrFromState(n.video,t.MEDIA_LABEL.video),o.media[c].descr),f>0&&(i.send=!1),r.push(i),f++):r.push({enabled:!1,type:o.media[c].descr.type,label:a&&a.media[c]?a.media[c].descr.label:o.media[c].descr.label})}return r}function h(e,t){var n=t?t.transportParams:[];for(var r=0;r<e.length;r++){e[r]&&(e[r].doRtcpMux=n[r]&&!n[r].doRtcpMux?!1:!0);if(e[r]&&n[r]){var s=!1;for(var o=0;!i.disableSdes&&o<t.media.length;o++)t.media[o].sdesParamsList&&t.media[o].sdesParamsList.length&&(s=!0);n[r].doRtcpMux&&(e[r].rtcpIceParams=null,e[r].rtcpIceCandidates=null),e[r].dtlsParams&&n[r].dtlsParams&&(e[r].dtlsParams.role=n[r].dtlsParams.role==="client"?"server":"client");if(s||!n[r].dtlsParams)e[r].dtlsParams=null}else e[r]&&e[r].dtlsParams&&(e[r].dtlsParams.role=null)}return e}function p(t,n,r){var i;t.sdesParamsList&&n.sdesParamsList&&(i=e.findMatchingSdesParams(t.sdesParamsList,n.sdesParamsList));var s=[],o;return i&&(s.push(i.localSdesParams),o=i.remoteSdesParams),{ssrcRange:t.ssrcRange,remoteSsrcRange:n.ssrcRange,sdesParamsList:s,remoteSdesParams:o,rtpCaps:e.matchRtpCaps(t.rtpCaps,n.rtpCaps,r)}}function d(e,t,n,r,i){if(!e.enabled)return{descr:e};var s=t;return s.descr=e,s.justAdded=n,s.bundledWithOther=r,s.rtcpReducedSize=i,s}function v(e,i,s,a){var f={isOffer:!1,sessionVersion:o.sessionVersion,transportParams:h(i,o),media:[]},l=!1;for(var c=0;c<e.length;c++){var v=l&&e[c].label===t.MEDIA_LABEL.video;e[c].label===t.MEDIA_LABEL.video&&(l=!0);var m,g=n.shallowClone(e[c]);if(g.enabled){m=p(s[c],o.media[c],!1);var y=g.label===t.MEDIA_LABEL.audio?0:1,w=f.transportParams[y];b(g,w,m)||(g.enabled=!1,r.warn("Rejecting media since unable to match parameters")),m.sdesParamsList.length&&m.remoteSdesParams&&(m.sdesParamsList[0].tag=m.remoteSdesParams.tag)}f.media.push(d(g,m,!1,v,o.media[c].rtcpReducedSize))}return r.debug(a?"CREATE PRANSWER":"CREATE ANSWER","params:",JSON.stringify(f)),a||(u=S(f,o,!1)),f}function m(n){var r=[],i,o=!1,u=0;if(a)for(var f=0;f<a.media.length;f++)a.media[f].descr.label===t.MEDIA_LABEL.audio&&!o?(i=e.getDescrFromState(n.audio,t.MEDIA_LABEL.audio),r.push(i),o=!0):a.media[f].descr.label===t.MEDIA_LABEL.video&&u<s?(i=e.getDescrFromState(n.video,t.MEDIA_LABEL.video),u>0&&(i.send=!1),r.push(i),u++):r.push({enabled:!1,type:a.media[f].descr.type,label:a.media[f].descr.label});!o&&n.audio&&(i=e.getDescrFromState(n.audio,t.MEDIA_LABEL.audio),r.push(i));for(var l=u;l<s&&n.video;l++)i=e.getDescrFromState(n.video,t.MEDIA_LABEL.video),l>0&&(i.send=!1),r.push(i);return r}function g(e,n,i){var s={isOffer:!0,sessionVersion:a?a.sessionVersion:0,transportParams:h(n,a),media:[]},u=!1;for(var f=0;f<e.length;f++){var l=(!a||!a.media[f]||!a.media[f].descr.enabled)&&e[f].enabled,c;l?c=i[f]:c=a.media[f];var p=u&&e[f].label===t.MEDIA_LABEL.video;e[f].label===t.MEDIA_LABEL.video&&(u=!0),s.media.push(d(e[f],c,l,p,!0))}return o=s,r.debug("CREATE OFFER","params:",JSON.stringify(o)),o}function y(e){r.debug("PROCESS ANSWER","params:",JSON.stringify(e)),u=S(o,e,!0)}function b(e,t,n){if(e.enabled){if(!n.sdesParamsList.length||!n.remoteSdesParams)if(!t.dtlsParams)return r.warn("no sdes nor dtls params:",n.sdesParamsList,n.remoteSdesParams,t.dtlsParams),!1;if(!n.rtpCaps.codecs.length)return r.warn("no common codecs!",n.rtpCaps),!1}return!0}function w(e,t){var r=[];for(var i=0;i<Math.max(e.length,t.length);i++){var s=null;e[i]&&t[i]&&(s=n.shallowClone(t[i]),s.doRtcpMux=e[i].doRtcpMux&&t[i].doRtcpMux,s.enableDtls=e[i].dtlsParams&&t[i].dtlsParams),r.push(s)}return r}function E(e,n,r,i){var s=l(e.descr,n.descr),o={descr:s};if(s.enabled){var u=s.label===t.MEDIA_LABEL.audio?0:1,a=r[u];o=p(e,n,i);if(!b(s,a,o))throw new Error("Failed to verify negotiated parameters!");o.descr=s,o.rtcpMux=a.doRtcpMux,o.rtcpReducedSize=e.rtcpReducedSize&&n.rtcpReducedSize,o.enableDtls=a.enableDtls}return o}function S(e,t,n){if(e.media.length!==t.media.length)throw new Error("Number of media lines doesn't match in offer & answer l:"+e.media.length+" r: "+t.media.length);var r={sessionVersion:n?e.sessionVersion:t.sessionVersion,transportParams:w(e.transportParams,t.transportParams),media:[]};for(var i=0;i<e.media.length;i++)r.media.push(E(e.media[i],t.media[i],r.transportParams,n));return r}function x(){return u.sessionVersion++,a=u,r.debug("NEGOTIATED","params:",JSON.stringify(a)),a}this.processOffer=f,this.createMediaDescriptorsForAnswer=c,this.createAnswer=v,this.createMediaDescriptorsForOffer=m,this.createOffer=g,this.processAnswer=y,this.completeNegotiation=x;var o=null,u=null,a=null}return r}),define("jSkype/services/mediaAgent/ortcSdp",["microsoft-sdp-transform","./constants"],function(e,t){function n(){function n(e,t){return e.toLowerCase()===t.toLowerCase()}function r(e){var t=e.iceCandidates.slice(0).sort(function(e,t){return t.priority-e.priority});for(var n=0;n<t.length;n++)if(t[n].type==="host")return t[n].ip;return"0.0.0.0"}function i(e,t){return e&&t?"sendrecv":e?"sendonly":t?"recvonly":"inactive"}function s(e,t){var n=e.toUpperCase();if(n==="TCP")switch(t.toLowerCase()){case"active":return"TCP-ACT";case"passive":return"TCP-PASS";case"so":return"TCP-SO"}return n}function o(e,t,r){r.push({foundation:e.foundation,component:t,transport:s(e.protocol,e.tcpType),priority:e.priority,ip:e.ip,port:e.port,type:e.type,raddr:n(e.type,"host")?void 0:e.relatedAddress,rport:n(e.type,"host")?void 0:e.relatedPort})}function u(e,t,n,r){e&&e.forEach(function(e){e.ip.indexOf(":")===-1?o(e,t,n):o(e,t,r)})}function a(e){if(e.iceCandidatePair)return{0:e.iceCandidatePair.local,1:e.rtcpIceCandidatePair?e.rtcpIceCandidatePair.local:null};var t=e.iceCandidates.slice(0).sort(function(e,t){return t.priority-e.priority}),n=t[0],r=null;if(e.rtcpIceCandidates)for(var i=0;i<e.rtcpIceCandidates.length;++i){var s=e.rtcpIceCandidates[i];if(s.foundation===n.foundation){r=s;break}}return{0:n,1:r}}function f(e,r,s,o){function d(e){return e.mkiLength!==0?"|"+e.mkiValue+":"+e.mkiLength:""}var f={rtp:[],fmtp:[],rtcpFb:[],type:r.descr.type,port:0,protocol:"RTP/SAVP",payloads:"",cryptoscale:[],crypto:[],candidates:[],xCandidatesIpv6:[]};if(!r.descr.enabled)return f.type===t.MEDIA_TYPE.video?f.payloads="34":f.payloads="9",f;var l=a(e),c=l[0],h=l[1];f.port=c.port,o.ip!==c.ip&&(f.connection={version:4,ip:c.ip}),f.iceUfrag=e.iceParams.usernameFragment,f.icePwd=e.iceParams.password,f.type===t.MEDIA_TYPE.audio&&(f.maxptime=200,f.ptime=20),f.direction=i(r.descr.send,r.descr.recv),f.xSsrcRange={ssrcMin:r.ssrcRange.min,ssrcMax:r.ssrcRange.max},f.label=r.descr.label,r.bundledWithOther||(f.xSource=r.descr.label),r.rtcpReducedSize&&(f.rtcpRsize=!0),s&&r.justAdded?(e.doRtcpMux&&(f.rtcpMux=!0),f.rtcp={port:h&&h.port||f.port+1}):e.doRtcpMux?f.rtcpMux=!0:f.rtcp={port:h&&h.port||f.port+1};var p=null;r.rtpCaps&&r.rtpCaps.codecs&&r.rtpCaps.codecs.forEach(function(e){f.rtp.push({payload:e.preferredPayloadType,codec:e.name,rate:e.clockRate,encoding:e.numChannels>1?e.numChannels:void 0});var t="";for(var r in e.parameters)e.parameters.hasOwnProperty(r)&&(t!==""&&(t+=";"),t+=r==="events"?e.parameters[r]:r+"="+e.parameters[r]);t!==""&&f.fmtp.push({payload:e.preferredPayloadType,config:t}),f.payloads+=(f.payloads?" ":"")+e.preferredPayloadType;if(!p)for(var i=0;i<e.rtcpFeedback.length;i++)if(n(e.rtcpFeedback[i].type,"x-message")){p=e.rtcpFeedback[i].parameter;break}}),p&&f.rtcpFb.push({payload:"*",type:"x-message",subtype:p});if(r.sdesParamsList)for(var v=0;v<r.sdesParamsList.length;++v){var m=r.sdesParamsList[v];n(m.cryptoSuite,"AES_CM_128_HMAC_SHA1_80")?f.crypto.push({id:m.tag,suite:"AES_CM_128_HMAC_SHA1_80",config:m.keyParams[0].keyMethod+":"+m.keyParams[0].keySalt+"|"+m.keyParams[0].lifetime+d(m.keyParams[0])}):n(m.cryptoSuite,"SCALE_AES_CM_128_HMAC_SHA1_80")&&f.cryptoscale.push({id:m.tag,flavor:"client",suite:"AES_CM_128_HMAC_SHA1_80",config:m.keyParams[0].keyMethod+":"+m.keyParams[0].keySalt+"|"+m.keyParams[0].lifetime+d(m.keyParams[0])})}if(!r.bundledWithOther){e.iceCandidatePair?(u([e.iceCandidatePair.local],1,f.candidates,f.xCandidatesIpv6),e.rtcpIceCandidatePair&&!e.doRtcpMux&&u([e.rtcpIceCandidatePair.local],2,f.candidates,f.xCandidatesIpv6),f.remoteCandidates="1 "+e.iceCandidatePair.remote.ip+" "+e.iceCandidatePair.remote.port,e.doRtcpMux?f.remoteCandidates+=" 2 "+e.iceCandidatePair.remote.ip+" "+e.iceCandidatePair.remote.port:f.remoteCandidates+=" 2 "+e.rtcpIceCandidatePair.remote.ip+" "+e.rtcpIceCandidatePair.remote.port):(u(e.iceCandidates,1,f.candidates,f.xCandidatesIpv6),(s&&r.justAdded||!e.doRtcpMux)&&u(e.rtcpIceCandidates,2,f.candidates,f.xCandidatesIpv6)),f.candidates.sort(function(e,t){return+e.foundation- +t.foundation||e.foundation===t.foundation&&e.component-t.component}),f.xCandidatesIpv6.sort(function(e,t){return+e.foundation- +t.foundation||e.foundation===t.foundation&&e.component-t.component});if(e.dtlsParams){f.fingerprint={type:e.dtlsParams.fingerprints[0].algorithm,hash:e.dtlsParams.fingerprints[0].value};switch(e.dtlsParams.role){case"auto":f.setup="actpass";break;case"client":f.setup="active";break;case"server":f.setup="passive"}}}return f}function l(e){var t=e.toLowerCase();switch(t){case"tcp-act":case"tcp-pass":case"tcp-so":return"tcp";default:return t}}function c(e){switch(e.toLowerCase()){case"tcp-act":return"active";case"tcp-pass":return"passive";case"tcp-so":return"so";default:return void 0}}function h(e){var t={foundation:e.foundation,priority:e.priority,ip:e.ip,protocol:l(e.transport),port:e.port,type:e.type};return n(e.type,"host")||(t.tcpType=c(e.transport),t.relatedAddress=e.raddr,t.relatedPort=e.rport),t}function p(e,t,n){e.candidates&&e.candidates.forEach(function(e){e.component===t&&n.push(h(e))}),e.xCandidatesIpv6&&e.xCandidatesIpv6.forEach(function(e){e.component===t&&n.push(h(e))})}function d(e){var t=/(\w+):([a-zA-Z0-9+\/]+={0,2})(\|([0-9\^]+))?(\|([0-9]+):([0-9]+))?/,n=e.match(t);if(!n)return void 0;var r={keyMethod:n[1],keySalt:n[2],mkiValue:0,mkiLength:0};return typeof n[4]!="undefined"&&(r.lifetime=n[4]),typeof n[7]!="undefined"&&(r.mkiValue=+n[6],r.mkiLength=+n[7]),r}function v(e,t){var n={};n.iceParams={usernameFragment:t.iceUfrag,password:t.icePwd},n.iceCandidates=[],p(t,1,n.iceCandidates),n.doRtcpMux=!!t.rtcpMux,t.rtcpMux||(n.rtcpIceParams={usernameFragment:t.iceUfrag,password:t.icePwd},n.rtcpIceCandidates=[],p(t,2,n.rtcpIceCandidates)),t.remoteCandidates&&(n.iceCandidatePair={});if(e.fingerprint||t.fingerprint){var r=t.fingerprint?t.fingerprint:e.fingerprint,i=t.setup?t.setup:e.setup,s="auto";switch(i){case"actpass":s="auto";break;case"active":s="client";break;case"passive":s="server"}n.dtlsParams={role:s,fingerprints:[{algorithm:r.type,value:r.hash}]}}return n}function m(e){var t=[];return e.rtp.forEach(function(n){t.push({name:n.codec,kind:e.type,clockRate:n.rate,preferredPayloadType:n.payload,numChannels:n.encoding?n.encoding:1,rtcpFeedback:[]})}),{codecs:t,headerExtensions:[],fecMechanisms:[]}}function g(e){e.direction||(e.direction="sendrecv");var t=e.direction.toLowerCase(),n=parseInt(e.port,10)!==0;if(n&&!e.label)throw new Error("No label for enabled media stream");return{enabled:n,type:e.type,label:e.label,send:n?t==="sendrecv"||t==="sendonly":!1,recv:n?t==="sendrecv"||t==="recvonly":!1}}function y(e){function r(e,n,r,i){t.push({tag:e,cryptoSuite:n,keyParams:r,sessionParams:i})}var t=[],i=g(e);return i.enabled?(e.cryptoscale&&e.cryptoscale.forEach(function(e){var t=n(e.flavor,"server")?d(e.config):void 0;t&&r(e.id,"SCALE_"+e.suite,[t],[])}),e.crypto&&e.crypto.forEach(function(e){var t=d(e.config);t&&r(e.id,e.suite,[t],[])}),{descr:g(e),rtpCaps:m(e),sdesParamsList:t,ssrcRange:{min:e.xSsrcRange?e.xSsrcRange.ssrcMin:0,max:e.xSsrcRange?e.xSsrcRange.ssrcMax:0},rtcpReducedSize:e.rtcpRsize?!0:!1}):{descr:i,rtpCaps:null,ssrcRange:null,rtcpReducedSize:!1}}this.paramsToSdp=function(n){var i={},s=n.transportParams[0]?n.transportParams[0]:n.transportParams[1],o=r(s),u=a(s),l=u[0];i.version=0,i.origin={username:"-",sessionId:0,sessionVersion:n.sessionVersion,netType:"IN",ipVer:4,address:o},i.bandwidth=[{type:"CT",limit:99980}],i.timing={start:0,stop:0},i.name="session",i.connection={version:4,ip:l.ip},i.xMediaBw={label:t.MEDIA_LABEL.video,sendBw:8100,receiveBw:8e3},i.media=[];for(var c=0;c<n.media.length;c++){var h=n.media[c].descr.label===t.MEDIA_LABEL.audio?0:1,p=n.transportParams[h];i.media.push(f(p,n.media[c],n.isOffer,l))}return e.write(i)},this.sdpToParams=function(n){var r=e.parse(n),i={sessionVersion:r.origin.sessionVersion,transportParams:[],media:[]};for(var s=0;s<r.media.length;s++){var o=r.media[s],u=y(o);i.media.push(u);if(u.descr.enabled){var a=u.descr.label===t.MEDIA_LABEL.audio?0:1;typeof i.transportParams[a]=="undefined"&&(i.transportParams[a]=v(r,o))}}return i}}return n}),define("jSkype/services/mediaAgent/ortcSession",["./ortcTransport","./ortcMediaChannel","./ortcNegotiation","./ortcSdp","./ortcHelper","./constants","./helper","./userAgentAdapter"],function(e,t,n,r,i,s,o){function u(){function t(t){throw new Error("Invalid state change:"+e.state+" "+t+" changing: "+e.changing)}var e=this;this.STABLE="stable",this.NEGOTIATION_REQUESTED="negotiation_requested",this.HAVE_LOCAL_OFFER="have_local_offer",this.HAVE_REMOTE_PRANSWER="have_remote_pranswer",this.HAVE_REMOTE_ANSWER="have_remote_answer",this.HAVE_REMOTE_OFFER="have_remote_offer",this.HAVE_LOCAL_PRANSWER="have_local_pranswer",this.HAVE_LOCAL_ANSWER="have_local_answer",this.TERMINATED="terminated",this.state=e.STABLE,this.changing=!1,this.change=function(n,r){e.busy&&t(n),r&&(e.changing=r);switch(n){case e.STABLE:e.state!==e.HAVE_REMOTE_ANSWER&&e.state!==e.HAVE_LOCAL_ANSWER&&t(n);break;case e.NEGOTIATION_REQUESTED:e.state!==e.STABLE&&t(n);break;case e.HAVE_LOCAL_OFFER:e.state!==e.STABLE&&e.state!==e.NEGOTIATION_REQUESTED&&t(n);break;case e.HAVE_REMOTE_PRANSWER:case e.HAVE_REMOTE_ANSWER:e.state!==e.HAVE_LOCAL_OFFER&&e.state!==e.HAVE_REMOTE_PRANSWER&&t(n);break;case e.HAVE_REMOTE_OFFER:e.state!==e.STABLE&&e.state!==e.NEGOTIATION_REQUESTED&&t(n);break;case e.HAVE_LOCAL_PRANSWER:case e.HAVE_LOCAL_ANSWER:e.state!==e.HAVE_REMOTE_OFFER&&e.state!==e.HAVE_LOCAL_PRANSWER&&t(n);break;case e.TERMINATED:break;default:t(n)}e.state=n},this.complete=function(){e.changing=!1}}function a(a,f){function P(e){var t=d+e*v;return{min:t,max:t+v-1}}function H(e){var n=0;for(var r=0;r<e.length;r++){e[r].label===s.MEDIA_LABEL.audio&&typeof C[r]=="undefined"?C[r]=new t(m.createChild("AStrm:"),l,e[r].type,e[r].label,F,p):e[r].label===s.MEDIA_LABEL.video&&(typeof C[r]=="undefined"&&(C[r]=new t(m.createChild("VStrm"+n+":"),l,e[r].type,e[r].label,F,P(n))),n++);if(C[r]&&C[r].type!==e[r].type)throw new Error("Error in media descriptors ch.type: "+C[r].type+" descr.type: "+e[r].type);if(C[r]&&C[r].label!==e[r].label)throw new Error("Error in media descriptors ch.label: "+C[r].label+" descr.label: "+e[r].label)}}function B(e,t){for(var n=0;n<e.length;n++)if(e[n].label===t)return e[n];return null}function j(){var e=[];for(var t=0;t<C.length;t++)C[t]&&(e[t]=C[t].getLocalParameters());return e}function F(e){m.error("Media error occurred","type:",e.type,"detail:",e.detail),y.onSessionErrorOccurred&&y.onSessionErrorOccurred(e)}function I(){for(var e in x)x.hasOwnProperty(e)&&x[e].update()}function q(){for(var e in x)x.hasOwnProperty(e)&&x[e].dispose()}function R(e){S?window.detachMediaStream(S):(S=document.createElement("audio"),document.body.appendChild(S),S.autoplay=!0,S.addEventListener("error",function(){m.error("_audio.onerror","error:",S?S.error:"<no audio element>")}));var t=new MediaStream([e]);window.attachMediaStream(S,t)}function U(){S&&(document.body.removeChild(S),window.detachMediaStream(S),S=null)}function z(e){N.state===N.STABLE&&!N.changing?(N.change(N.NEGOTIATION_REQUESTED),m.log("triggerNegotiation","mods:",JSON.stringify(L),"force:",e),O=!1,y.onNegotiationRequired&&y.onNegotiationRequired()):e&&(O=!0)}function W(e){return new Promise(function(t){if(!e||!e.audio&&!e.video)throw new Error("Invalid parameters!"+JSON.stringify(e));var n=!L||!o.areNegotiatedDirectionsFulfilled(e,k);L=e,n&&z(),t()})}function X(e){return new Promise(function(t){m.debug("PROCESS OFFER","sdp:",e),N.change(N.HAVE_REMOTE_OFFER);var n;n=T.sdpToParams(e),E.processOffer(n),w=n.transportParams,t(o.invertModalities(i.getModalitiesFromParams(n)))})}function V(e){return new Promise(function(t){function r(e,t){return t.label===e&&t.enabled}if(e)N.change(N.HAVE_LOCAL_PRANSWER,!0),A={audio:"sendrecv",video:"sendrecv"};else{N.change(N.HAVE_LOCAL_ANSWER,!0);if(!L)throw new Error("Modalities not configured for answer");A=L}var n=E.createMediaDescriptorsForAnswer(A),i=n.some(r.bind(null,s.MEDIA_LABEL.audio)),o=n.some(r.bind(null,s.MEDIA_LABEL.video)),u=_.assureInitAsync("controlled",[i,o]).then(function(){return _.waitIceCompletionIfNeededAsync(w).then(function(){return _.getLocalParamsAsync().then(function(t){H(n);var r=E.createAnswer(n,t,j(),e);N.complete();var i=T.paramsToSdp(r);return m.debug(e?"CREATE PRANSWER":"CREATE ANSWER","sdp:",i),{sdp:i,modalities:A}})})});t(u)})}function $(){return new Promise(function(e){N.change(N.HAVE_LOCAL_OFFER,!0),A=L;var t=E.createMediaDescriptorsForOffer(A),n=_.assureInitAsync("controlling",[!!A.audio,!!A.video]).then(function(){return _.getLocalParamsAsync().then(function(e){H(t);var n=E.createOffer(t,e,j());N.complete();var r=T.paramsToSdp(n);return m.debug("CREATE OFFER","sdp:",r),{sdp:r,modalities:A}})});e(n)})}function J(e,t){return new Promise(function(n){m.debug(t?"PROCESS PRANSWER":"PROCESS ANSWER","sdp:",e);if(t)N.change(N.HAVE_REMOTE_PRANSWER),m.log("ignoring provisional answer"),n();else{N.change(N.HAVE_REMOTE_ANSWER);var r;r=T.sdpToParams(e),E.processAnswer(r),n(o.invertModalities(i.getModalitiesFromParams(r)))}})}function K(e,t){return e||t?g.getMediaStreamRefAsync({audio:e,video:t}):Promise.resolve()}function Q(){return new Promise(function(e){N.change(N.STABLE,!0);var t=E.completeNegotiation(),n=i.findDescrFromMedia(t.media,s.MEDIA_LABEL.audio),r=i.findDescrFromMedia(t.media,s.MEDIA_LABEL.video);e(Promise.all([_.configureTransportAsync(t.transportParams,[n.enabled,r.enabled]),K(n.send,r.send)]).then(function(e){var n=e[1];try{for(var r=0;r<t.media.length;r++)if(t.media[r].descr.label===s.MEDIA_LABEL.audio){var u=C[r].getRecvTrack();C[r].configureChannel(_.audioTransport,n,t.media[r]),C[r].getRecvTrack()&&C[r].getRecvTrack()!==u?(R(C[r].getRecvTrack()),C[r].onContributingSourcesChanged=function(){y.onContributingSourcesChanged&&y.onContributingSourcesChanged.apply(y,arguments)}):!C[r].getRecvTrack()&&u&&(U(),C[r].onContributingSourcesChanged=null)}else t.media[r].descr.label===s.MEDIA_LABEL.video&&C[r].configureChannel(_.videoTransport,n,t.media[r])}finally{n&&n.dispose()}I(),N.complete(),k=i.getModalitiesFromParams(t);var a=O||!o.areNegotiatedDirectionsAcceptable(L,A,k);return a&&z(),m.log("_completeNegotiationAsync: configured:",JSON.stringify(L),"_negotiatingModalities:",JSON.stringify(A),"activeModalities:",JSON.stringify(k)),{isComplete:!a,activeModalities:k,configuredModalities:L}}))})}function G(e,t){return new Promise(function(n){var r=e===s.RENEGOTIATION_ERROR.local;N.state=N.STABLE,m.error("negotiation failed","error:",e),t&&(m.log("retrying failed negotiation"),z()),n({isComplete:r,activeModalities:k,configuredModalities:L})})}function Y(e,t){var n=function(e,t){g.Renderer.call(this,e,t);var n=this,r=this.dispose,i=!1,u=o.defer(),a,f;this._unsubscribeIfSubscribed=function(){a&&(a.remove(n),a=void 0),f=void 0},this._updateRecvTrack=function(e,t){m.log("renderer._updateRecvTrack - attachMediaStream","msi:",e,"track:",t),f=e,n._attachMediaStream(t?new MediaStream([t]):null)},this.subscribeVideoAsync=function(e){return m.info("subscribeVideoAsync","msi:",e),new Promise(function(t){typeof e=="undefined"&&(e=s.MSI.subscribeAny);if(!i){var r=f!==e;r&&n._unsubscribeIfSubscribed(),u.isPending()&&(u.resolve(),u=o.defer());if(e===s.MSI.unsubscribe||!r)u.resolve();else{if(!x.hasOwnProperty(e)){var l=o.defer(),c=[],h,p=!1,d=null,v=function(){p||(c=[],l.isPending()&&l.reject(),h&&h.unsubscribe(),delete x[e],p=!0)},m=function(){if(l.isPending())for(var t=0;t<C.length;t++){var n=C[t];if(n&&n.canSubscribe()&&n.subscribe(e)){h=n,l.resolve();break}}if(h){var r=h.getRecvTrack();r!==d&&(d=r,c.forEach(function(t){t._updateRecvTrack(e,d)}))}};x[e]={add:function(e,t){l.promise.then(t.resolve,t.reject),c.push(e),m()},remove:function(e){var t=c.indexOf(e);t!==-1&&(c.splice(t,1),c.length===0&&v())},update:m,dispose:v}}a=x[e],a.add(n,u)}}t(u.promise)})},this.dispose=function(){m.debug("disposing remote renderer"),n._unsubscribeIfSubscribed(),u.isPending()&&u.reject(new Error("disposing")),i=!0,r()}};return new n(e,t)}function Z(){m.log("_deviceSelectionChanged");var e=o.hasSendDirectionality(k.audio),t=o.hasSendDirectionality(k.video);N.state!==N.TERMINATED&&(e||t)&&g.getMediaStreamRefAsync({audio:e,video:t}).then(function(n){var r;e&&(r=B(C,s.MEDIA_LABEL.audio),r.updateLocalMediaStream(n)),t&&(r=B(C,s.MEDIA_LABEL.video),r.updateLocalMediaStream(n)),n.dispose()}).catch(function(e){F({type:s.MEDIA_ERROR.internalError,detail:e})})}function et(){return N.state===N.TERMINATED?D:(D=new Promise(function(e){var t={localStreams:[{tracks:[]}],remoteStreams:[{tracks:[]}]},n=B(C,s.MEDIA_LABEL.audio),r=B(C,s.MEDIA_LABEL.video);n&&n.getSendTrack()&&t.localStreams[0].tracks.push({stream:null,track:n.getSendTrack()}),r&&r.getSendTrack()&&t.localStreams[0].tracks.push({stream:null,track:r.getSendTrack()}),n&&n.getRecvTrack()&&t.remoteStreams[0].tracks.push({stream:null,track:n.getRecvTrack()}),r&&r.getRecvTrack()&&t.remoteStreams[0].tracks.push({stream:null,track:r.getRecvTrack()}),Promise.all([n?n.getReportsAsync():{},r?r.getReportsAsync():{}]).then(function(n){t.ortc={CorrelationId:f,mainAudio:n[0],mainVideo:n[1]},e(t)}).catch(function(n){m.error("getting statistics should never fail:",n),e(t)})}),D)}function tt(){m.log("terminate"),et().then(function(){N.change(N.TERMINATED),_.stop(),U(),q(),C.forEach(function(e){e.terminate()}),y._onTerminated&&y._onTerminated(y)})}this.configureModalitiesAsync=W,this.processOfferAsync=X,this.createAnswerAsync=V,this.createOfferAsync=$,this.processAnswerAsync=J,this.completeNegotiationAsync=Q,this.rejectNegotiationAsync=G,this.createRemoteRenderer=Y,this.getStatsAsync=et,this.terminate=tt,this._deviceSelectionChanged=Z,this._onTerminated=null,this.onNegotiationRequired=null,this.onContributingSourcesChanged=null,this.onSessionErrorOccurred=null;var l=a.maContext.settings,c=a.config.isConference&&l.numVideoChannelsGvc?l.numVideoChannelsGvc:1,h=Math.floor(Math.random()*4294967295),p={min:h,max:h},d=h+1,v=100,m=a.getLogger(),g=a.getDeviceManager(),y=this,b=!0,w=null,E=new n(m,l,c),S=null,x={},T=new r,N=new u,C=[],k={},L,A,O=!1,M={triggerIceReinvite:function(){if(l.disableIceReinvite){m.log("ICE-reinvite disabled - triggerIceReinvite skipped");return}m.log("triggerIceReinvite"),z(!0)},raiseError:F},_=new e(m,l,M,a.maContext.getRelayManager(),a.config.isRemoteClientLync,b),D=Promise.resolve({});m.log("create session","config:",a.config)}return{build:function(e,t,n){return new a(e,t,n)}}}),define("jSkype/services/mediaAgent/statistics/sessionStatistics",[],function(){function e(){function h(){return{started:function(){n="Offering",d()}}}function p(){return{started:function(){n="Answering",d()}}}function d(){t=t||n,++r}function v(){return{completed:function(){r===1&&(i=!0)},rejected:function(){++l}}}function m(e){return e*1e4}var e=(new Date).getTime(),t,n,r=0,i=!1,s=!1,o,u=0,a=0,f="0",l=0,c={type:"none",detail:"none"};this.negotiation={offering:h(),answering:p(),current:v()},this.terminated=function(){a=(new Date).getTime(),u=(new Date).getTime()-e},this.setMultiParty=function(){s=!0},this.setMediaLegId=function(e){o=e},this.setId=function(e){f=e},this.setError=function(e){c.type=e.type||"internalError",c.detail=e.detail||e.toString()},this.getReport=function(){return{CorrelationId:f,CallNumber:0,RetargetCount:0,CreationTime:m(e),InitTime:m(e),TerminationTime:m(a),CallDuration:m(u),InitialNegotiationType:t||"none",InitialNegotiationCompleted:i,NegotiationCount:r,RejectedNegotiationCount:l,MediaLegId:o,MultiParty:s,ErrorType:c.type,ErrorDetail:c.detail}}}return{build:function(){return new e}}}),define("jSkype/services/mediaAgent/mediaLegId",[],function(){function e(){function t(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1).toUpperCase()}function t(){return e()+e()+e()+"4"+e().substring(1)+"B"+e().substring(1)+e()+e()+e()}return t()}var e;this.process=function(n){return e||(e=n||t()),e}}return{build:function(){return new e}}}),define("jSkype/services/mediaAgent/session",["./webRtcSession","./ortcSession","./statistics/sessionStatistics","./mediaLegId","./constants"],function(e,t,n,r,i){function s(e,t,s,o){function h(e){return i.RENEGOTIATION_ERROR.signaling===e||i.RENEGOTIATION_ERROR.media===e}var u=this,a=n.build(),f=r.build(),l=t.maContext.settings,c=0;a.setId(s),t.config.isConference&&a.setMultiParty(),this.createOfferAsync=function(){return a.negotiation.offering.started(),e.createOfferAsync.apply(e,arguments).then(function(e){return{mediaContent:{blob:e.sdp,contentType:"application/sdp",mediaLegId:f.process()},modalities:e.modalities}}).catch(function(e){throw a.setError(e),e})},this.processOfferAsync=function(t){var n=[].slice.call(arguments);return n.splice(0,1,t.blob),a.negotiation.answering.started(),f.process(t.mediaLegId),e.processOfferAsync.apply(e,n).catch(function(e){throw a.setError(e),e})},this.processAnswerAsync=function(t){var n=[].slice.call(arguments);return n.splice(0,1,t.blob),e.processAnswerAsync.apply(e,n).catch(function(e){throw a.setError(e),e})},this.completeNegotiationAsync=function(){return c=0,e.completeNegotiationAsync.apply(e,arguments).then(function(e){return a.negotiation.current.completed(),e}).catch(function(e){throw a.setError(e),e})},this.rejectNegotiationAsync=function(t){var n=++c<=l.renegotiationAttempts&&h(t);return a.negotiation.current.rejected(),e.rejectNegotiationAsync(t,n).catch(function(e){throw a.setError(e),e})},this.terminate=function(){a.terminated(),e.terminate.apply(e,arguments)},this.getStatsAsync=function(){return e.getStatsAsync.apply(e,arguments).then(function(e){return a.setMediaLegId(f.process()),e.metrics=a.getReport(),e})},this.createAnswerAsync=function(){return e.createAnswerAsync.apply(e,arguments).then(function(e){return{mediaContent:{blob:e.sdp,contentType:"application/sdp",mediaLegId:f.process()},modalities:e.modalities}}).catch(function(e){throw a.setError(e),e})},this.configureModalitiesAsync=e.configureModalitiesAsync,this.createRemoteRenderer=e.createRemoteRenderer,this._deviceSelectionChanged=e._deviceSelectionChanged,this._onTerminated=null,e.onNegotiationRequired=o.onNegotiationRequired,e.onContributingSourcesChanged=o.onContributingSourcesChanged,e.onSessionErrorOccurred=function(t){a.setError(t),o.onSessionErrorOccurred.apply(e,arguments)},e._onTerminated=function(){u._onTerminated&&u._onTerminated.apply(e,arguments)}}return{build:function(n,r,i){var o=typeof RTCIceGatherer=="undefined"?e:t;return new s(o.build.apply(this,arguments),n,r,i)}}}),define("jSkype/services/mediaAgent/deviceEnumerator",["./constants","./common/utils","./userAgentAdapter"],function(e,t,n){function r(r){function p(e){if(!c){if(!s.navigator.mediaDevices||!s.navigator.mediaDevices.enumerateDevices)return Promise.reject(new Error("device enumeration unsupported"));c=Promise.resolve()}else if(!e)return c;return c=c.then(function(){return s.navigator.mediaDevices.enumerateDevices().then(d)}),c}function d(e){var t=m(e);return g(t)}function v(){return c?p(!0).catch(function(e){o.error("failed to reenumerate devices",e)}):Promise.resolve()}function m(t){var n={};return t.forEach(function(t){switch(t.kind){case"audioinput":n[l[e.MEDIA_DEVICE.microphone].id]=l[e.MEDIA_DEVICE.microphone],n[t.deviceId]={id:t.deviceId,label:t.label,kind:e.MEDIA_DEVICE.microphone};break;case"videoinput":n[l[e.MEDIA_DEVICE.camera].id]=l[e.MEDIA_DEVICE.camera],n[t.deviceId]={id:t.deviceId,label:t.label,kind:e.MEDIA_DEVICE.camera}}}),n}function g(e){var n=!1;return a&&(t.forOwn(a,function(t,r){e.hasOwnProperty(r)||(n=!0,o.log("media device removed","kind:",t.kind,"id:",t.id,"label:",t.label))}),t.forOwn(e,function(e,t){a.hasOwnProperty(t)||(n=!0,o.log("media device added","kind:",e.kind,"id:",e.id,"label:",e.label))})),a=e,n&&i.onDevicesChanged&&i.onDevicesChanged(a),a}function y(){function t(){v().then(function(){f=s.setTimeout(t,e)})}var e=typeof u.devicePollingInterval!="undefined"?u.devicePollingInterval:3e3;if(e===0||h||f)return;o.log("starting device polling"),f=s.setTimeout(t,e)}function b(){h=!0,f&&(o.log("stopping device polling"),s.clearTimeout(f),f=void 0)}var i=this,s=n.window,o=r.logger.createChild("DeviceEnumerator"),u=r.settings,a,f,l={},c,h;l[e.MEDIA_DEVICE.microphone]={id:"default_audio_device",label:"Default audio device",kind:e.MEDIA_DEVICE.microphone},l[e.MEDIA_DEVICE.camera]={id:"default_video_device",label:"Default video device",kind:e.MEDIA_DEVICE.camera},this.onDevicesChanged=void 0,this.enumerateDevices=function(){return p(!1).then(function(e){return y(),e})},this.getDefaultDevices=function(){return l},s.navigator.mediaDevices&&(s.navigator.mediaDevices.ondevicechange=function(){b(),v()})}return{build:function(e){return new r(e)}}}),define("jSkype/services/mediaAgent/deviceManager",["./constants","./deviceEnumerator","./userAgentAdapter"],function(e,t){var n=function(n,r){function p(){return c.length?C({audio:!0,video:!0}).then(function(e){c.forEach(function(t){t._attachMediaStreamRef(e)})}):Promise.resolve()}function m(t){return s.log("getUserMedia","constraints:",t),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,new Promise(function(n,r){navigator.getUserMedia(t,n,function(t){r({type:e.MEDIA_ERROR.permissionDeniedError,detail:"permission to use media device was denied: "+t.toString()})})})}function g(e,t){return JSON.stringify(e)===JSON.stringify(t)}function y(){return u.enumerateDevices().then(function(e){return o=e,e})}function b(e){var t={};for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];o.hasOwnProperty(r)?t[n]=r:s.warn("device selection is invalid","kind:",n,"id:",r)}if(!g(a,t)){var u="camera"in a^"camera"in t||"microphone"in a^"microphone"in t;a=t,i._deviceSelectionChanged&&(u||i._deviceSelectionChanged()),p()}}function w(){return a}function E(e,t){return new v(e,t)}function S(e){return C(e)}function x(e,t,n,r,i){var o=1,u=!1,a={getPromise:function(){return o+=1,c},isSuitable:function(i,s){return!u&&i.audio===e&&i.video===t&&(!i.audio||n===s.microphone)&&(!i.video||r===s.camera)},outdateIfAnyDeviceRemoved:function(e){u||(u=!e[n]||!e[r])}},c=i.then(function(n){var r=l++,i=!1,u=!1,c=function(){T(n.getAudioTracks(),!i&&!u)};return typeof h!="undefined"&&(i=!h,c()),e=n.getAudioTracks().length!==0,t=n.getVideoTracks().length!==0,s.log("create media stream","generation:",r,"cached:",f.length,"audio:",e,"video:",t),{getObject:function(){return n},clone:function(){return o+=1,this},setMute:function(e){i=e,c()},setHold:function(e){u=e,c()},dispose:function(){o-=1;if(o===0){try{s.log("release media stream","generation:",r,"cached:",f.length,"audio:",e,"video:",t),window.stopMediaStream(n)}catch(i){s.warn("exception","error:",i)}f.splice(f.indexOf(a),1)}}}}).catch(function(e){throw f.splice(f.indexOf(a),1),e});return f.push(a),c}function T(e,t){e.forEach(function(e){typeof e.enabled!="undefined"&&(e.enabled=t,s.log("control media stream track","kind:",e.kind,"enabled:",e.enabled,"muted:",e.muted))})}function N(e){for(var t=0;t<f.length;t++)if(f[t].isSuitable(e,a))return f[t].getPromise();return null}function C(t){return new Promise(function(n,r){var i=N(t);if(!i){var o={};t.audio&&(a.microphone?a.microphone===u.getDefaultDevices()[e.MEDIA_DEVICE.microphone].id?o.audio=!0:o.audio={deviceId:{exact:a.microphone}}:s.warn("ignoring audio modality due to missing microphone selection")),t.video&&(a.camera?a.camera===u.getDefaultDevices()[e.MEDIA_DEVICE.camera].id?o.video=!0:o.video={deviceId:{exact:a.camera}}:s.warn("ignoring video modality due to missing camera selection")),!o.audio&&!o.video&&r(new Error("requesting nothing")),i=x(!!o.audio,!!o.video,a.microphone,a.camera,m(o))}i.then(n,r)})}function k(e){return h=e,f.reduce(function(t,n){return t.then(function(){return n.getPromise().then(function(t){t.setMute(!e),t.dispose()})})},Promise.resolve())}function L(){return k(!1)}function A(){return k(!0)}this.enumerateDevicesAsync=y,this.selectDevices=b,this.getSelectedDevices=w,this.muteInputAsync=L,this.unmuteInputAsync=A,this.createPreviewRenderer=E,this.getMediaStreamRefAsync=S;var i=this,s=n.logger,o={},u=t.build({logger:s,settings:n.settings});u.onDevicesChanged=function(e){o=e,f.forEach(function(t){t.outdateIfAnyDeviceRemoved(e)}),r.onDevicesChanged&&r.onDevicesChanged(e)};var a={microphone:u.getDefaultDevices()[e.MEDIA_DEVICE.microphone].id,camera:u.getDefaultDevices()[e.MEDIA_DEVICE.camera].id},f=[],l=0,c=[],h,d=function(e,t){function f(t){o&&(t||e.removeChild(n),window.detachMediaStream(n)),t&&(n.hidden=t.getVideoTracks().length===0,window.attachMediaStream(n,t),o||e.appendChild(n)),o=t}var n=document.createElement("video"),r=0,i=0,o=null,u=function(){if(t&&t.onVideoSizeChanged){var e=n.videoWidth,s=n.videoHeight;if(e<32||s<32)e=s=0;if(r!==e||i!==s)r=e,i=s,t.onVideoSizeChanged(e,s)}},a=function(){s.error("_video.onerror","error:",n.error)};n.autoplay=!0,n.muted=!0,n.addEventListener("loadedmetadata",u),n.addEventListener("timeupdate",u),n.addEventListener("error",a),this.getVideoElement=function(){return n},this.dispose=function(){n.removeEventListener("loadedmetadata",u),n.removeEventListener("timeupdate",u),n.removeEventListener("error",a),f(null),n=null},this._attachMediaStream=f};this.Renderer=d;var v=function(e,t){d.call(this,e,t);var n=this,r=this.dispose,i=null,s=!1;this._attachMediaStreamRef=function(e){try{i&&(i.dispose(),i=null),this._attachMediaStream(e.getObject()),i=e}catch(t){throw e.dispose(),t}},this.dispose=function(){s=!0;var e=c.indexOf(n);e!==-1&&c.splice(e,1),r(),i&&(i.dispose(),i=null)},this.startVideoAsync=function(){return C({audio:!0,video:!0}).then(function(e){if(s)throw e.dispose(),new Error("disposed");n._attachMediaStreamRef(e),c.push(n)})}}};return n}),define("jSkype/services/mediaAgent/capabilities",["./userAgentAdapter"],function(e){function t(t){function r(){return typeof n.RTCPeerConnection!="undefined"}function i(){return typeof n.RTCIceGatherer!="undefined"}function s(){return!!n.navigator.getUserMedia}function o(e,n){return t.settings.capabilities&&typeof t.settings.capabilities[e]!="undefined"?t.settings.capabilities[e]:n}var n=e.window;this.audio=!!o("audio",s()&&(i()||r())),this.video=!!o("video",s()&&i())}return{build:function(e){return new t(e)}}}),define("jSkype/services/mediaAgent/mediaAgent",["./session","./deviceManager","./capabilities","./constants","./helper"],function(e,t,n,r,i){var s=function(r,i){function l(){return u}var s=r.getLogger().createChild("MA",r.settings.debug),o=s.createChild("DeviceManager"),u=new t({logger:o,settings:r.settings},i),a=[],f=n.build({settings:r.settings});u._deviceSelectionChanged=function(){a.forEach(function(e){e._deviceSelectionChanged()})},this.createSession=function(t,n,i){var o=s.createChild("Session").createChild(n),u={getDeviceManager:l,getLogger:function(){return o},maContext:r,config:i?i:{}},f=e.build(u,n,t);return f._onTerminated=function(e){var t=a.indexOf(e);t!==-1&&a.splice(t,1)},a.push(f),f},this.getDeviceManager=l,this.getCapabilities=function(){return f}};return{build:function(e,t){return new s(e,t)},isPlatformSupported:function(){return navigator.getUserMedia&&(typeof RTCPeerConnection!="undefined"||typeof RTCIceGatherer!="undefined")},constants:r,helper:i}}),define("jSkype/services/relayManager/relayManager",["lodash-compat","jSkype/services/serviceAccessLayer/requestDispatcher"],function(e,t){return function(n){function a(e,n){if("turn"===e){var r=s.Relay.Turn.url;return t.get(r,{addContentType:!1}).then(function(e){var t=e.response,r=JSON.parse(JSON.stringify(t));return n.Turn[0].addresses=r.relay?[r.relay]:n.Turn[0].addresses,Promise.resolve(n)}).catch(function(e){return o.error("failed to retreive turn relay addresses",e),Promise.resolve(n)})}return Promise.resolve(n)}function f(e){var t=c().then(function(){return l()}).then(function(e){return u=t,e}).catch(function(t){u=null,e?o.warn("failed to retrieve relays",t):o.error("failed to retrieve relays",t)});return t}function l(){var e=s.Service.tokenUrl;return n.tokenProvider().then(function(n){return t.get(e,{headers:{"X-Skypetoken":n}})}).then(function(e){var t=e.response,n=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(t)),u=0,a=s.Token.earlyRefreshMinutes,l=s.Token.earlyRefreshPercentage;u=Math.max(t.expires-a*60,t.expires*l/100),window.setTimeout(f,1e3*u),n.addresses=s.Relay.Skype.addresses,n.tcpPort=s.Relay.Skype.tcpPort,n.udpPort=s.Relay.Skype.udpPort,n.type="msturn",r.addresses=s.Relay.Lync.addresses,r.tcpPort=s.Relay.Lync.tcpPort,r.udpPort=s.Relay.Lync.udpPort,r.type="msturn",i.addresses=s.Relay.Turn.addresses,i.tcpPort=s.Relay.Turn.tcpPort,i.udpPort=s.Relay.Turn.udpPort,i.type="turn";var c={Skype:[n],Lync:[r],Turn:[i]};return o.log("relays from trap",c),c})}function c(){return Promise.resolve(n.configProvider()).then(function(t){e.merge(i,t),o.log("relayManager.getConfigAsync","providedConfig",t,"merged config",s)}).catch(function(e){o.warn("failed to retrieve configuration",e)})}var r={},i={Service:{url:"https://api.trap.skype.net/",tokenUrl:"https://api.trap.skype.net/v1/token",disabled:!1},Relay:{addresses:["13.107.8.2"],tcpPort:443,udpPort:3478,Lync:{addresses:["mr.skype.net"],tcpPort:443,udpPort:3478},Skype:{addresses:["13.107.8.2"],tcpPort:443,udpPort:3478},Turn:{addresses:["104.44.195.106"],tcpPort:443,udpPort:3478,url:"https://world.turn.skype.net/relay"}},Token:{earlyRefreshMinutes:60,earlyRefreshPercentage:50}},s=i,o=n.getLogger().createChild("RM"),u=null;return r.queryRelaysAsync=function(e,t){return u||(u=f()),u.then(function(t){return a(e,t)}).then(function(n){return n?"turn"===e?n.Turn:t?n.Lync:n.Skype:[]})},r.queryRelaysOnStartupAsync=function(){u||(u=f(!0))},r}}),define("jSkype/services/NGCCallAgent/NGCCallAgent/ngcAgent",["require","exports","module","jSkype/client","jSkype/settings","services/ecs/configLoader","swx-enums","utils/common/logTracer/api","browser/detect","jSkype/services/trouter/trouter","jSkype/services/NGCCallAgent/NGCCallAgent/incomingNotificationMessageHandler","jSkype/services/NGCCallAgent/NGCCallAgent/signalingAgentConfig","jSkype/services/NGCCallAgent/NGCCallAgent/signalingAgent","jSkype/services/NGCCallAgent/NGCCallAgent/callHandler","jSkype/services/mediaAgent/mediaAgent","jSkype/services/mediaAgent/constants","jSkype/models/device","jSkype/services/relayManager/relayManager"],function(e,t){function T(){w=new c(new l(x))}function N(){var e=n.get().devicesManager,t=u.getBrowserInfo().getUrlParams().microphoneIdx;return e.microphones(t?+t:0)}function C(){var e=n.get().devicesManager,t=u.getBrowserInfo().getUrlParams().cameraIdx;return e.cameras(t?+t:0)}function k(e,t){t.kind===d.MEDIA_DEVICE.camera?e.cameras._add(new v(t.label,t.id,g[t.kind]),t.id):t.kind===d.MEDIA_DEVICE.microphone&&e.microphones._add(new v(t.label,t.id,g[t.kind]),t.id)}function L(e,t){t.kind===d.MEDIA_DEVICE.camera?e.cameras._remove(t.id):t.kind===d.MEDIA_DEVICE.microphone&&e.microphones._remove(t.id)}function A(e){var t=n.get().devicesManager,r=t.selectedMicrophone(),i=t.selectedCamera(),s;for(s in y)y.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&L(t,y[s]);for(s in e)e.hasOwnProperty(s)&&!y.hasOwnProperty(s)&&k(t,e[s]);y=e,r&&!e.hasOwnProperty(r.deviceId())&&(t.microphones.size()===0?t.selectedMicrophone(null,"ActiveDeviceUnplugged"):t.selectedMicrophone(N(),"ActiveDeviceUnplugged")),!r&&t.microphones.size()>0&&t.selectedMicrophone(N(),"FirstDevicePlugged"),i&&!e.hasOwnProperty(i.deviceId())&&(t.cameras.size()===0?t.selectedCamera(null,"ActiveDeviceUnplugged"):t.selectedCamera(C(),"ActiveDeviceUnplugged")),!i&&t.cameras.size()>0&&t.selectedCamera(C(),"FirstDevicePlugged")}function O(){var e=E.getDeviceManager();g[d.MEDIA_DEVICE.microphone]=s.deviceType.Microphone,g[d.MEDIA_DEVICE.camera]=s.deviceType.Camera,g[d.MEDIA_DEVICE.speaker]=s.deviceType.Speaker,e.enumerateDevicesAsync().then(function(e){var t=n.get().devicesManager;t.cameras._removeAll(),t.microphones._removeAll();for(var r in e)e.hasOwnProperty(r)&&k(t,e[r]);y=e;if(t.cameras.size()>0){var i=C();t.selectedCamera(i)}else t.selectedCamera(null);if(t.microphones.size()>0){var s=N();t.selectedMicrophone(s)}else t.selectedMicrophone(null)})}function M(){var e=new Promise(function(e,t){i.loadConfig(s.ecsClientNames.Skype,r.settings.ecsTrapKey).then(e,t)});S=m({tokenProvider:function(){return new Promise(function(e){e(n.get().signInManager._skypeToken())})},configProvider:function(){return e},getLogger:function(){return x}}),S.queryRelaysOnStartupAsync()}function _(){var e={getLogger:function(){return x},getRelayManager:function(){return{queryRelaysAsync:S.queryRelaysAsync}},settings:r.settings.pluginless.mediaAgent};E=p.build(e,{onDevicesChanged:A})}var n=e("jSkype/client"),r=e("jSkype/settings"),i=e("services/ecs/configLoader"),s=e("swx-enums"),o=e("utils/common/logTracer/api"),u=e("browser/detect"),a=e("jSkype/services/trouter/trouter"),f=e("jSkype/services/NGCCallAgent/NGCCallAgent/incomingNotificationMessageHandler"),l=e("jSkype/services/NGCCallAgent/NGCCallAgent/signalingAgentConfig"),c=e("jSkype/services/NGCCallAgent/NGCCallAgent/signalingAgent"),h=e("jSkype/services/NGCCallAgent/NGCCallAgent/callHandler"),p=e("jSkype/services/mediaAgent/mediaAgent"),d=e("jSkype/services/mediaAgent/constants"),v=e("jSkype/models/device"),m=e("jSkype/services/relayManager/relayManager"),g={},y={},b,w,E,S,x;t.initialize=function(){x=o.getLogger("NGC"),T(),M(),_(),O(),b=new f(w),a.registerMessageHandler(b)},t.callHandler={initialize:function(){return!0},build:function(e){var t={getLogger:function(){return x}};return new h(t,E,w,e)}}}),define("constants/outOfBrowser",{SHELL_APP_ID:"com.skype.shellapp",SHELL_APP_MIME_TYPE:"application/x-skype-shellapp",commandTypes:{REQUEST:"REQUEST",RESPONSE:"RESPONSE"},commands:{SHELL_APP_READY_FOR_BOOTSTRAP:"SHELL_APP_READY_FOR_BOOTSTRAP",BOOTSTRAP:"BOOTSTRAP",INIT:"INIT",SHELL_APP_INITIALISED:"SHELL_APP_INITIALISED",SHOW:"SHOW",HIDE:"HIDE",HOST_CALL:"HOST_CALL",JOIN_CALL:"JOIN_CALL",START:"START",ACCEPT:"ACCEPT",UPDATE_INCOMING_PAYLOAD:"UPDATE_INCOMING_PAYLOAD",REJECT:"REJECT",STOP:"STOP",MUTE:"MUTE",UNMUTE:"UNMUTE",CALL_INFO:"CALL_INFO",CONTACTS_DATA_REQUEST:"CONTACTS_DATA_REQUEST",CONTACTS_DATA_RESPONSE:"CONTACTS_DATA_RESPONSE",CHANGE_STATE:"CHANGE_STATE",PSTN_EVENT:"PSTN_EVENT",SHELL_APP_LOG:"SHELL_APP_LOG",PLUGIN_ERROR:"PLUGIN_ERROR",ESCALATE_CONVERSATION:"ESCALATE_CONVERSATION",SETTINGS_UPDATE:"SETTINGS_UPDATE"},shellAppIndexPagePath:"/shellApp/index.html",shellAppPreloadEnabledVersion:"7.4",shellAppMethods:{PostMessage:"postMessage",GetVersion:"getVersion",ShowWindow:"showWindow",HideWindow:"hideWindow",CloseWindow:"closeWindow"},shellAppEvents:{MessageReceived:"message",WindowShown:"windowShown",WindowHidden:"windowHidden",WindowClosing:"windowClosing"}}),define("constants/extension",[],function(){return{META_SELECTOR:"meta[name=swx-chrome-extension]",SHELL_APP_SIZE_FACTOR:1.6,SHELL_APP_MIN_DIMENSIONS:{WIDTH:345,HEIGHT:460},ERRORS:{MISSING_EXTENSION:"MISSING_EXTENSION",MISSING_PLUGIN:"MISSING_PLUGIN"},CONNECTION_CHANGE_EVENT:"NMHostConnectionChange"}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-extension-api/lib/SkypeExtensionAPI",["require","exports","global-portable"],e)}(function(e,t){function o(){return Math.random().toString(16).slice(2)}function u(){return o()+"@"+Date.now()}function a(){function e(e){return e in this._listeners||(this._listeners[e]=[]),this._listeners[e]}this._listeners={},this.add=function(t,n){var r=e.call(this,t),i=r.indexOf(n);i===-1&&r.push(n)},this.remove=function(t,n){var r=e.call(this,t),i=r.indexOf(n);i!==-1&&r.splice(i,1)},this.dispatchEvent=function(t){var n=e.call(this,t.type).slice();for(var r=0;r<n.length;r++)n[r].call(this,t);return!t.defaultPrevented},this.invokeHandlerWithMessage=function(t){var n=e.call(this,t.cookie).slice();if(n.length>0){for(var r=0;r<n.length;r++)n[r].call(this,t);return}n=e.call(this,t.name).slice();if(n.length>0){for(var r=0;r<n.length;r++)n[r].call(this,t.data);return}}}function l(e,t){return new Promise(function(r,s){function l(e){clearTimeout(a),f.remove(o,l),"error"in e?s(e.error):r(e.data)}function c(){f.remove(o,l),s(new Error("Chrome Extension reply timeout: ("+i+" ms passed)"))}var o=u(),a=null;a=setTimeout(c,i),f.add(o,l),t.cookie=o,e.postMessage({origin:n,message:t},"*")})}function c(e){this.nmHost=e,this.postMessage=function(e){return this.nmHost.postMessage({method:"messageToWindow",args:{message:e}})},this.addMessageHandler=function(e){this.nmHost.addMessageHandler("messageFromWindow",function(t){e(t.message)})}}function h(e,t){this.id=e,this.extension=t,this.hostWindow=null,this.postMessage=function(e){return this.extension.postMessage({name:"MessageToNativeMessagingHost",nmHostID:this.id,content:e})},this.invokeMethod=function(e,t){return t||(t={}),this.postMessage({method:e,args:t})},this.getVersion=function(){return this.invokeMethod("getVersion").then(function(e){return e.message.result})},this.openWindow=function(e){var t=this;return new Promise(function(n,r){t.invokeMethod("openWindow",e).then(function(){t.hostWindow=new c(t),n(t.hostWindow)}).catch(r)})},this.addMessageHandler=function(e,t){this.extension.addMessageHandler("NMHostMessage",function(n){var r=n.message;r.event==e&&t(r.args)})},this.onDisconnected=function(e){var t=this;this.extension.addMessageHandler("NMHostConnectionChange",function(n){if(n.nmHostID!=t.id)return;if(n.isConnected)return;e(n.reason)})};var n=this;this.onDisconnected(function(e){n.hostWindow!=null&&(n.hostWindow.nmHost=null,n.hostWindow=null),n.extension!=null&&(n.extension.nmHost=null)}),this.disconnect=function(){return this.extension.postMessage({name:"DisconnectNativeMessagingHost",nmHostId:this.id})}}function p(e,t){this.id=e,this.version=t,this.nmHost=null,this.postMessage=function(e){return l(window,e)},this.addMessageHandler=function(e,t){f.add(e,t)},this.removeMessageHandler=function(e,t){f.remove(e,t)},this.onDisconnected=function(e){var t=this;this.addMessageHandler("ExtensionConnectionChange",function(n){if(n.extensionID!=t.id)return;if(n.isConnected)return;e()})};var n=this;this.onDisconnected(function(){n.nmHost!=null&&(n.nmHost.extension=null,n.nmHost=null),s=null}),this.connectNMHost=function(e){var t=this;return new Promise(function(n,r){t.postMessage({name:"ConnectNativeMessagingHost",nmHostId:e}).then(function(r){t.nmHost=new h(e,t),n(t.nmHost)}).catch(r)})}}function d(e){this.nmHost=e,this.postMessage=function(e){return this.nmHost.extension.postMessage({method:"messageToWindow",args:e})},this.addMessageHandler=function(e){this.nmHost.extension.addMessageHandler("messageFromWindow",function(t){e(t.message)})}}function v(e,t){this.id=e,this.extension=t,this.hostWindow=null,this.invokeMethod=function(e,t){return t||(t={}),this.extension.invokeMethod(e,t)},this.getVersion=function(){return this.invokeMethod("getVersion")},this.openWindow=function(e){var t=this;return new Promise(function(n,r){t.invokeMethod("openWindow",e).then(function(){t.hostWindow=new d(t),n(t.hostWindow)}).catch(r)})},this.addMessageHandler=function(e,t){f.add(e,t)},this.onDisconnected=function(e){},this.disconnect=function(){this.extension.port.Disconnect()}}function m(e,t,n){this.version=t,this.id=e,this.nmHost=null,this.port=n;var r=this;this.invokeMethod=function(e,t){return new Promise(function(n,s){function c(e){var t=e.data;t.cookie==a&&(clearTimeout(l),f.remove(o,c),"error"in t?s(t.error):n(t.result))}function h(){f.remove(o,c),s(new Error("EdgeActiveX reply timeout: ("+i+" ms passed)"))}var o="MessageReceived",a=u(),l=null;l=setTimeout(h,i),f.add(o,c);var p={cookie:a,method:e,args:t};r.port.PostMessage(p)})},this.postMessage=function(e){var t=e.name;if(t==undefined||t==null)t=e.method;return this.invokeMethod(t,{message:e.args})},this.addMessageHandler=function(e,t){f.add(e,t)},this.removeMessageHandler=function(e,t){f.remove(e,t)},this.onDisconnected=function(e){f.add("NMHostConnectionChange",e)},this.connectNMHost=function(e){var t=this;return new Promise(function(n,r){t.port.Connect(),t.nmHost=new v(e,t),n(t.nmHost)})},this.onPluginMessage=function(e){f.dispatchEvent({type:"MessageReceived",data:e});if(!e||!e.event)return;e.args&&e.args.message?f.dispatchEvent({type:e.event,message:e.args.message,data:e.args.message}):f.dispatchEvent({type:e.event})},this.onPluginDisconnected=function(){var e={type:"NMHostConnectionChange",data:{isConnected:!1}};f.dispatchEvent(e)}}var n="XwaWebSite",r="XwaContentScript",i=3e3,s=null,f=new a;window.addEventListener("message",function(e){var t=window.location.protocol+"//"+window.location.host;if(e.origin!=t)return;var n=e.data;if(n.origin!=r)return;f.invokeHandlerWithMessage(n.message)});var g={connect:function(e,t){return t!=undefined&&t!=null?new Promise(function(n,r){var i=document.createElement("object");i.setAttribute("type",e),i.setAttribute("class","pluginNoSize");var s=t;s.appendChild(i);var o=i.GetVersion(),u=new m(e,o,i);i.OnMessage=u.onPluginMessage,i.OnDisconnected=u.onPluginDisconnected,n(u)}):new Promise(function(t,n){l(window,{name:"ExtensionConnect",extensionId:e}).then(function(){return l(window,{name:"ExtensionVersion"})}).then(function(n){var r=new p(e,n);t(r)}).catch(n)})},sharedExtension:function(e,t){var n=this;return new Promise(function(r,i){if(s!=null){r(s);return}n.connect(e,t).then(function(e){s=e,r(s)}).catch(i)})},sharedNMHost:function(e,t,n){var r=this;return new Promise(function(i,o){if(s!=null&&s.nmHost!=null){i(s.nmHost);return}r.sharedExtension(e,n).then(function(e){return e.connectNMHost(t)}).then(i,o)})},sharedNMHostWindow:function(e,t,n,r){var i=this;return new Promise(function(o,u){if(s!=null&&s.nmHost!=null&&s.nmHost.hostWindow!=null){o(s.nmHost.hostWindow);return}i.sharedNMHost(e,t,r).then(function(e){return e.openWindow(n)}).then(o,u)})},cleanupCallbacks:function(){f._listeners={}}};t.SkypeExtension=g;var y=e("global-portable");y["default"].SkypeExtension=g}),define("swx-extension-api",["swx-extension-api/lib/SkypeExtensionAPI"],function(e){return e}),define("jSkype/services/outOfBrowser/extension",["require","exports","module","jSkype/settings","jSkype/telemetry/logging/callingLogTracer","constants/outOfBrowser","constants/extension","browser/detect","browser/document","browser/window","swx-extension-api"],function(e,t){function l(e){function w(){r.log("Extension - loading shell app"),f&&f.sharedExtension?t.getAppHost().then(N).then(C).catch(k):k("SkypeExtension is not available")}function E(){var e=u.querySelector(s.META_SELECTOR);return e?e.getAttribute("id"):n.settings.shellApp.chromeExtensionId}function S(){return o.getBrowserInfo().browserName===o.BROWSERS.CHROME?f.sharedExtension(E()):f.sharedExtension(i.SHELL_APP_MIME_TYPE,u.body)}function x(){S().then(T).then(A).catch(L)}function T(e){function t(e){return r.log("Extension - Connect app host, max retries:",e),h.connectNMHost(i.SHELL_APP_ID).catch(function(n){return n&&n.message&&/reply timeout/.test(n.message)&&e>0?t(e-1):Promise.reject(n)})}return h=e,t(n.settings.shellApp.connectShellAppHostRetries)}function N(t){var n=O();return t.openWindow({url:e,width:n.width,height:n.height,minWidth:345,minHeight:460,disableHotKeys:!0,hidden:!0})}function C(e){c=e,b&&h.addMessageHandler(s.CONNECTION_CHANGE_EVENT,b),g()}function k(e){r.warn("Extension - Error loading shell app: ",e),y(e)}function L(e){var t=Boolean(h);r.log("Extension - App host init failed, error:",e&&e.message?e.message:e),t?v(s.ERRORS.MISSING_PLUGIN):v(s.ERRORS.MISSING_EXTENSION)}function A(e){l=e,d(e)}function O(){return{width:a.screen.width/s.SHELL_APP_SIZE_FACTOR,height:a.screen.height/s.SHELL_APP_SIZE_FACTOR}}var t=this,l,c,h,p,d,v,m,g,y,b;t.openShellApp=function(e){return m||(m=new Promise(function(e,t){g=e,y=t}),w()),b=e,m},t.getAppHost=function(){return p||(p=new Promise(function(e,t){d=e,v=t}),x()),p},t.postMessage=function(e){return m.then(function(){return r.log("Extension::postMessage",e),c.postMessage(e)})},t.addMessageHandler=function(e){r.log("Extension::addMessageHandler"),l.addMessageHandler("messageFromWindow",e)},t.addEventHandler=function(e,t){l.addMessageHandler(e,t)},t.disconnect=function(){return l&&l.disconnect(),Promise.resolve()},t.dispose=function(){return r.log("Extension::dispose"),p=null,v=null,d=null,m=null,y=null,g=null,h&&h.removeMessageHandler(s.CONNECTION_CHANGE_EVENT,b),Promise.resolve()}}var n=e("jSkype/settings"),r=e("jSkype/telemetry/logging/callingLogTracer").get(),i=e("constants/outOfBrowser"),s=e("constants/extension"),o=e("browser/detect"),u=e("browser/document"),a=e("browser/window"),f=e("swx-extension-api").SkypeExtension;t.build=function(e){return new l(e)}}),define("jSkype/services/outOfBrowser/messagingChannel",["require","exports","module","jcafe-property-model","constants/outOfBrowser"],function(e,t){function i(e){function o(e,t){return{name:e,type:r.commandTypes.REQUEST,data:t}}function u(n){e.postMessage(n).catch(function(){var e=t[n.name];t[n.name]=undefined,e.reject("Failed to post command "+n.name)})}function a(){var e=s[r.shellAppEvents.WindowHidden];e&&e()}function f(e){var t=e.message;t&&t.name&&t.type&&(t.type===r.commandTypes.REQUEST?l(t):t.type===r.commandTypes.RESPONSE&&c(t))}function l(e){var t=i[e.name];t&&t(e.data)}function c(e){var n=t[e.name];n&&(e.error?n.reject(e.error):n.resolve(e.data),t[e.name]=undefined)}var t={},i={},s={};e.addMessageHandler(f),e.addEventHandler(r.shellAppEvents.WindowHidden,a),this.sendCommand=function(e,r){var i,s=n.task();return t[e]?s.reject("Command ",e," is already awaiting response."):(i=o(e,r),t[e]=s,u(i)),s.promise},this.registerCommandHandler=function(e,t){i[e]=t},this.registerEventHandler=function(e,t){s[e]=t},this.unregisterEventHandler=function(e){delete s[e]},this.unregisterCommandHandler=function(e){delete i[e]}}var n=e("jcafe-property-model"),r=e("constants/outOfBrowser");t.build=function(e){return new i(e)}}),define("jSkype/services/calling/platformValidator",["require","browser/detect","utils/calling/callingStack","swx-enums"],function(e){function i(){var e=g(),t=s(e.browserName);return t(e)}function s(e){switch(e){case t.BROWSERS.MSIE:return u;case t.BROWSERS.CHROME:return f;case t.BROWSERS.SAFARI:return o;case t.BROWSERS.FIREFOX:return a;case t.BROWSERS.ELECTRON:return l;case t.BROWSERS.SKYPE_SHELL:return c;case t.BROWSERS.EDGE:return c;default:return h}}function o(e){return!e.isWindowsOS&&!e.isMacOSX?p():c()}function u(e){return e.isWindowsOS?e.browserMajorVersion<10?h():c():p()}function a(e){return!e.isMacOSX&&!e.isWindowsOS&&(!e.isLinux||!n.get().isPluginlessCallingSupported())?p():e.browserMajorVersion<25?h():c()}function f(e){return!e.isMacOSX&&!e.isWindowsOS&&(!e.isLinux||!n.get().isPluginlessCallingSupported())?p():c()}function l(e){return!e.isLinux&&!e.isMacOSX&&!e.isWindowsOS?p():c()}function c(){return{isSupported:!0}}function h(){return{isSupported:!1,reason:r.callingNotSupportedReasons.BrowserNotSupported}}function p(){return{isSupported:!1,reason:r.callingNotSupportedReasons.OSNotSupported}}function d(){try{return t.getSystemInfo().osName===t.OPERATING_SYSTEMS.WINDOWS}catch(e){return!1}}function v(){try{return t.getSystemInfo().osName===t.OPERATING_SYSTEMS.MACOSX}catch(e){return!1}}function m(){try{return t.getSystemInfo().osName===t.OPERATING_SYSTEMS.LINUX}catch(e){return!1}}function g(){var e=t.getBrowserInfo();return e.isWindowsOS=d(),e.isMacOSX=v(),e.isLinux=m(),e}var t=e("browser/detect"),n=e("utils/calling/callingStack"),r=e("swx-enums");return{getPlatformSupport:i}}),define("jSkype/services/plugin/electron/electronSupportDetector",["require","exports","module","jSkype/services/electron","jSkype/telemetry/logging/callingLogTracer","swx-enums"],function(e,t){function s(){}function o(){try{return n.getSkypeModule(),!0}catch(e){return r.warn(e),!1}}var n=e("jSkype/services/electron"),r=e("jSkype/telemetry/logging/callingLogTracer").get(),i=e("swx-enums");s.prototype.getCallingSupport=function(){return o()?Promise.resolve({isSupported:!0,reason:""}):Promise.resolve({isSupported:!1,reason:i.callingNotSupportedReasons.PluginBlocked})},t.build=function(){return new s}}),define("jSkype/services/plugin/pluginSupportDetector",["require","exports","module","browser/window","jcafe-property-model","constants/plugin.const","browser/detect","jSkype/services/plugin/pluginLifecycleFacade","jSkype/services/plugin/electron/electronSupportDetector","swx-enums"],function(e,t){function f(){function t(t){var n=s.getBrowserInfo(),r=u(n);r?t&&n.isBrowserDefaultToBlockPlugin?c():e.resolve({isSupported:!0,reason:""}):e.resolve({isSupported:!1,reason:a.callingNotSupportedReasons.PluginNotInstalled})}function u(e){return e.isIeEngine?f(e):l()}function f(e){try{return new n.ActiveXObject(e.is64bit?i.PROGID_VERSION64:i.PROGID_VERSION),!0}catch(t){return!1}}function l(){return n.navigator.plugins&&n.navigator.plugins.refresh&&n.navigator.plugins.refresh(),n.navigator.mimeTypes?n.navigator.mimeTypes[i.MIME_TYPE]?n.navigator.mimeTypes[i.MIME_TYPE].enabledPlugin!==undefined:!1:!1}function c(){o.createPlugin(),h()?e.resolve({isSupported:!0,reason:""}):e.resolve({isSupported:!1,reason:a.callingNotSupportedReasons.PluginBlocked})}function h(){return o.isLoaded()}var e=null;this.getCallingSupport=function(n){if(!e||e.promise.state()==="resolved")e=r.task(),t(n);return e.promise}}function l(){return s.getBrowserInfo().isElectron}var n=e("browser/window"),r=e("jcafe-property-model"),i=e("constants/plugin.const"),s=e("browser/detect"),o=e("jSkype/services/plugin/pluginLifecycleFacade"),u=e("jSkype/services/plugin/electron/electronSupportDetector"),a=e("swx-enums");t.build=function(){return l()?u.build():new f}}),define("jSkype/services/pluginless/pluginlessSupportDetector",["require","jcafe-property-model"],function(e){function n(){var e=null;this.getCallingSupport=function(){if(!e||e.promise.state()==="resolved")e=t.task(),e.resolve({isSupported:!0,reason:""});return e.promise}}var t=e("jcafe-property-model");return{build:function(){return new n}}}),define("jSkype/services/outOfBrowser/outOfBrowserSupportDetector",["require","jcafe-property-model","jSkype/services/outOfBrowser/extension","swx-enums"],function(e){function i(){function i(){e.resolve({isSupported:!0,reason:""})}function s(){e.resolve({isSupported:!1,reason:r.callingNotSupportedReasons.PluginNotInstalled})}var e=null;this.getCallingSupport=function(){if(!e||e.promise.state()==="resolved")e=t.task(),n.build().getAppHost().then(i).catch(s);return e.promise}}var t=e("jcafe-property-model"),n=e("jSkype/services/outOfBrowser/extension"),r=e("swx-enums");return{build:function(){return new i}}}),define("jSkype/services/calling/supportDetectorFactory",["require","exports","module","utils/calling/callingStack","jSkype/services/plugin/pluginSupportDetector","jSkype/services/pluginless/pluginlessSupportDetector","jSkype/services/outOfBrowser/outOfBrowserSupportDetector"],function(e,t){function o(){return n.get().isInBrowserPluginSupported()?r.build():s.build()}var n=e("utils/calling/callingStack"),r=e("jSkype/services/plugin/pluginSupportDetector"),i=e("jSkype/services/pluginless/pluginlessSupportDetector"),s=e("jSkype/services/outOfBrowser/outOfBrowserSupportDetector");t.buildSupportDetector=function(){return n.get().isPluginlessCallingSupported()?i.build():o()},t.buildPluginBasedSupportDetector=o}),define("jSkype/services/calling/environmentInspector",["require","exports","module","jSkype/telemetry/logging/callingLogTracer","jSkype/services/calling/platformValidator","jSkype/services/calling/supportDetectorFactory","jcafe-property-model"],function(e,t){function f(e){var t=r.getPlatformSupport();t.isSupported?c(e).then(function(e){l(e.isSupported,e.reason)}):l(!1,t.reason)}function l(e,r){n.log("[EnvInspector] check for calling support",e,r),t.isCallingSupported.set(e,r),o.resolve(e)}function c(e){var t=i.buildSupportDetector();return t.getCallingSupport(e)}function h(e){var t=i.buildPluginBasedSupportDetector();return t.getCallingSupport(e)}var n=e("jSkype/telemetry/logging/callingLogTracer").get(),r=e("jSkype/services/calling/platformValidator"),i=e("jSkype/services/calling/supportDetectorFactory"),s=e("jcafe-property-model"),o=null,u=!1,a="";t.disableCalling=function(e){u=!0,a=e,t.isCallingSupported(!1,e)},t.isCallingSupported=s.property({get:function(){return u?(t.isCallingSupported.reason=a,!1):t.checkForCallingSupport()}}),t.checkForCallingSupport=function(e){if(!o||o.promise.state()==="resolved")o=s.task(),f(e);return o.promise},t.checkForPluginBasedCallingSupport=function(e){if(!o||o.promise.state()==="resolved"){o=s.task();var t=r.getPlatformSupport();t.isSupported?h(e).then(function(e){o.resolve(e)}):o.resolve(t)}return o.promise}}),define("jSkype/services/outOfBrowser/extensionCommandHandler",["require","exports","module","jSkype/client","jSkype/settings","constants/common","jSkype/services/calling/environmentInspector","swx-enums","jSkype/telemetry/logging/callingLogTracer","constants/plugin.const","jSkype/modelHelpers/participantHelper","constants/outOfBrowser"],function(e,t){function c(e){function t(e){e===a.PLUGIN_ERRORS.REASON_ALREADY_EXISTS&&s.disableCalling(o.callingNotSupportedReasons.PluginAlreadyRunning)}function c(){var t={};n.get().personsAndGroupsManager.all.persons().forEach(function(e){t[e.id()]={status:e.status()}}),u.get().log("[ExtensionCommand] updating shell with contacts"),e.sendCommand(l.commands.CONTACTS_DATA_RESPONSE,{contactsData:t})}function h(e){try{var t=JSON.parse(window.atob(e.logs)),n=["ShellAppLog"].concat(t);u.get()[e.method].apply(null,n)}catch(r){}}function p(e){var t=g(e.conversationId);t.selfParticipant.audio.state._set(e.state,e.reason)}function d(e){if(!e.conversationId)return;var t=g(e.conversationId),n=f.getOrCreateParticipantInConversation(t,e.participantId);if(!n)return;f.updateParticipantAudioVideoState(n,e.state,e.reason)}function v(e){if(!e.conversationId||!e.messageBody)return;var t=g(e.conversationId);t._callData.pluginCallInfo(e.messageBody)}function m(e){return function(r){var i=n.get().conversationsManager._getOrCreateConversation(r.conversationId);i._callHandler&&i._callHandler.toggleMuteTask&&i._callHandler.toggleMuteTask.promise.state()==="pending"?i._callHandler.toggleMuteTask.resolve(e):(i.selfParticipant.audio.isMuted._set(e),i.selfParticipant.audio.isMuted.set._enabled(!0))}}function g(e){return n.get().conversationsManager._getOrCreateConversation(e)}e.registerCommandHandler(l.commands.PLUGIN_ERROR,t),e.registerCommandHandler(l.commands.CHANGE_STATE,p),e.registerCommandHandler(l.commands.PSTN_EVENT,d),e.registerCommandHandler(l.commands.MUTE,m(!0)),e.registerCommandHandler(l.commands.UNMUTE,m(!1)),e.registerCommandHandler(l.commands.CALL_INFO,v),e.registerCommandHandler(l.commands.CONTACTS_DATA_REQUEST,c),r.isFeatureOn(i.featureFlags.SHELL_APP_LOGS)&&e.registerCommandHandler(l.commands.SHELL_APP_LOG,h)}var n=e("jSkype/client"),r=e("jSkype/settings"),i=e("constants/common"),s=e("jSkype/services/calling/environmentInspector"),o=e("swx-enums"),u=e("jSkype/telemetry/logging/callingLogTracer"),a=e("constants/plugin.const"),f=e("jSkype/modelHelpers/participantHelper"),l=e("constants/outOfBrowser");t.build=function(e){return new c(e)}}),define("jSkype/services/outOfBrowser/extensionLifecycleFacade",["require","exports","module","jcafe-property-model","jSkype/services/outOfBrowser/extension","jSkype/services/outOfBrowser/messagingChannel","jSkype/services/outOfBrowser/extensionCommandHandler","constants/outOfBrowser","jSkype/settings"],function(e,t){function a(e){function d(){h&&h()}function v(){c&&c()}function m(e){p&&p(e)}function g(){f=i.build(a),f.registerCommandHandler(o.commands.SHELL_APP_READY_FOR_BOOTSTRAP,b),f.registerCommandHandler(o.commands.SHELL_APP_INITIALISED,y),f.registerEventHandler(o.shellAppEvents.WindowHidden,v),f.registerCommandHandler(o.commands.ESCALATE_CONVERSATION,m)}function y(){s.build(f),l.resolve(f)}function b(){f.sendCommand(o.commands.BOOTSTRAP,{url:u.settings.shellApp.bootstrapperUrl})}function w(e){l.reject(e)}var t=this,a=null,f=null,l=null,c,h,p;t.getMessagingChannel=function(){return l||(l=n.task(),a=r.build(e),a.getAppHost().then(function(){return g(),a.openShellApp(d)}).catch(w)),l.promise},t.disconnect=function(){return a?a.disconnect():Promise.resolve()},t.getVersion=function(){return a=r.build(e),a.getAppHost().then(function(e){return e.getVersion()})},t.dispose=function(){f&&(f.unregisterCommandHandler(o.commands.SHELL_APP_INITIALISED),f.unregisterCommandHandler(o.commands.SHELL_APP_READY_FOR_BOOTSTRAP),f.unregisterEventHandler(o.shellAppEvents.WindowHidden)),f=null,l=null,c=null,h=null,p=null,a&&(a.disconnect(),a.dispose())},t.onExtensionDisconnected=function(e){h=e},t.onShellAppWindowHidden=function(e){c=e},t.onShellAppCallEscalated=function(e){p=e}}var n=e("jcafe-property-model"),r=e("jSkype/services/outOfBrowser/extension"),i=e("jSkype/services/outOfBrowser/messagingChannel"),s=e("jSkype/services/outOfBrowser/extensionCommandHandler"),o=e("constants/outOfBrowser"),u=e("jSkype/settings");t.build=function(e){return new a(e)}}),define("jSkype/services/outOfBrowser/outOfBrowserFacade",["require","exports","module","jSkype/client","browser/detect","jSkype/settings","jSkype/services/callController","constants/common","jSkype/modelHelpers/calling/escalationHelper","swx-enums","jSkype/services/outOfBrowser/extensionLifecycleFacade","constants/outOfBrowser","utils/common/version"],function(e,t){function h(e,t,h){function w(){return v||(v=n.get().signInManager._skypeToken().then(function(e){return S(l.commands.INIT,{token:e,environment:t,locale:h})})),v}function E(e){var t=w(),n={shellAppHost:r.getBrowserInfo().browserName};return e.initializesAsHidden&&(t=t.then(S.bind(null,l.commands.SHOW,n))),t}function S(e,t){var n=[l.commands.HOST_CALL,l.commands.JOIN_CALL,l.commands.START,l.commands.ACCEPT,l.commands.STOP,l.commands.MUTE,l.commands.UNMUTE,l.commands.CALL_INFO],r=n.indexOf(e)>=0;return t=t||{},r&&(t.conversationId=d.conversationId),p.getMessagingChannel().then(function(n){return n.sendCommand(e,t)})}function x(e){d=e,d.selfParticipant.audio.state.changed(C)}function T(e){function f(){n({version:e,initializesAsHidden:u})}var t,n,r=c.parse(e),s=c.parse(l.shellAppPreloadEnabledVersion),u=r.compareTo(s)>=0,a=u&&i.isFeatureOn(o.featureFlags.PRELOAD_SHELL_APP);return t=new Promise(function(e){n=e}),a?w().then(f):f(),t}function N(){if(i.isFeatureOn(o.featureFlags.PERSISTENT_SHELL_APP))return;y.dispose()}function C(e,t,n){n&&e===a.callConnectionState.Disconnected&&(d.selfParticipant.audio.state.changed.off(C),d=null)}function k(e,t){s.setupCall(t),u.escalateCall(e,t),x(t)}function L(e){var t=n.get().conversationsManager.conversations(e.oldConversationId),r=n.get().conversationsManager.conversations(e.newConversationId);if(!r)var i=n.get().conversationsManager.conversations.added(function(n){n.conversationId===e.newConversationId&&(k(t,n),i.dispose())});else k(t,r)}function A(){if(!i.isFeatureOn(o.featureFlags.SKYPE_VIDEO_CALLING_POLICY_SUPPORT))return;g||(g=n.get().personsAndGroupsManager.mePerson.preferences(b).value.changed(O))}function O(e){y.updateSettings(b,e)}var p,d,v,m,g,y=this,b=o.userSettings.preferences.SKYPE_VIDEO_CALLING_POLICY_SUPPORT;y.initialize=function(){return m||(p=f.build(e),p.onExtensionDisconnected(y.dispose),p.onShellAppWindowHidden(N),p.onShellAppCallEscalated(L),m=p.getVersion().then(T)),m},y.start=function(e){return x(e.conversation),y.initialize().then(E).then(A).then(function(){var t=Boolean(e.callHostId||e.accessToken),n=Boolean(e.conversation.autoCall()),r=e.conversation._autoCallingService.autoCallingMode(),i=e.conversation._autoCallingService.partnerId(),s=e.conversation._autoCallingService.callId();return S(l.commands.START,{withVideo:e.withVideo,joinCall:t,autoCall:n,autoCallMode:r,autoCallPartnerId:i,autoCallId:s,callHostId:e.callHostId,accessToken:e.accessToken,endpoint:e.endpoint})})},y.hostCall=function(e){return d||x(e.conversation),y.initialize().then(function(){return S(l.commands.HOST_CALL,{withVideo:e.withVideo,accessToken:e.accessToken,endpoint:e.endpoint})})},y.joinCall=function(e){return d||x(e.conversation),y.initialize().then(function(){var t=Boolean(e.callHostId||e.accessToken),n=Boolean(e.conversation.autoCall()),r=e.conversation._autoCallingService.autoCallingMode();return S(l.commands.JOIN_CALL,{withVideo:e.withVideo,joinCall:t,autoCall:n,autoCallMode:r,callHostId:e.callHostId,accessToken:e.accessToken,endpoint:e.endpoint})})},y.accept=function(e,t){return x(e),y.initialize().then(E).then(A).then(function(){return S(l.commands.ACCEPT,{incomingCallData:e._callData.getUnprocessedIncomingCallPayloads(),withVideo:t})})},y.updateIncomingCallPayload=function(e){return y.initialize().then(function(){return S(l.commands.UPDATE_INCOMING_PAYLOAD,{incomingCallData:e._callData.getUnprocessedIncomingCallPayloads()})})},y.cancel=function(){return i.isFeatureOn(o.featureFlags.PRELOAD_SHELL_APP)?y.initialize().then(function(e){return e.initializesAsHidden?S(l.commands.HIDE):p.disconnect()}):Promise.resolve()},y.stop=function(){return S(l.commands.STOP)},y.mute=function(){return S(l.commands.MUTE)},y.unmute=function(){return S(l.commands.UNMUTE)},y.requestCallInfo=function(){return d?S(l.commands.CALL_INFO):Promise.reject()},y.updateSettings=function(e,t){return S(l.commands.SETTINGS_UPDATE,{settingsType:e,value:t})},y.dispose=function(e){e=e||{},v=null,m=null,p.onShellAppWindowHidden(null),p.onExtensionDisconnected(null),p.onShellAppCallEscalated(null),p.dispose(),d&&(d.selfParticipant.audio.state.changed.off(C),d.selfParticipant.audio.state._set(a.callConnectionState.Disconnected)),!e.preventReinitialisation&&i.isFeatureOn(o.featureFlags.PERSISTENT_SHELL_APP)&&y.initialize(),g&&g.dispose()}}var n=e("jSkype/client"),r=e("browser/detect"),i=e("jSkype/settings"),s=e("jSkype/services/callController"),o=e("constants/common"),u=e("jSkype/modelHelpers/calling/escalationHelper"),a=e("swx-enums"),f=e("jSkype/services/outOfBrowser/extensionLifecycleFacade"),l=e("constants/outOfBrowser"),c=e("utils/common/version");t.build=function(e,t,n){return new h(e,t,n)}}),define("jSkype/services/outOfBrowser/outOfBrowserCallHandler",["require","exports","module","jSkype/services/outOfBrowser/outOfBrowserFacade","constants/outOfBrowser","jcafe-property-model","browser/detect","swx-enums","constants/common","constants/extension","jSkype/settings","utils/calling/callingStack","jSkype/modelHelpers/participantHelper","jSkype/telemetry/logging/callingLogTracer","browser/window"],function(e,t){function m(e){var t=this,n=!1,r=b(),s=f.isFeatureOn(u.featureFlags.PSTN_ENABLED);t.placeCall=function(n){p.log("[OutOfBrowserCallHandler] placeCall");var i={conversation:e,withVideo:n};s&&!e.isGroupConversation()?i.endpoint=e.participants(0).audio.endpoint():e.isGroupConversation()&&e.activeModalities.audio()&&(i.callHostId=e._callHostId,i.accessToken=e._callPayload.AccessToken);var f=r.start(i);return f.catch(function(t){if(t&&t.type===u.callingErrors.AUTO_CALL_FAILED){p.log("[OutOfBrowserCallHandler] Auto call failed, ignore");return}var n=l.get().isPluginlessCallingSupported()?o.callDisconnectionReason.OutOfBrowserCall:"";c.handleParticipantLeavingStateTransition(e.selfParticipant,n),(t===a.ERRORS.MISSING_EXTENSION||t===a.ERRORS.MISSING_PLUGIN)&&g()}),f},t.hostCall=function(n){p.log("[OutOfBrowserCallHandler] hostCall");var i={conversation:e,withVideo:n};return r.hostCall(i)},t.joinCall=function(n){p.log("[OutOfBrowserCallHandler] joinCall");var i={conversation:e,withVideo:n};return e.isGroupConversation()&&e.activeModalities.audio()&&(i.callHostId=e._callHostId,i.accessToken=e._callPayload.AccessToken),r.joinCall(i)},t.acceptCall=function(i){return p.log("[OutOfBrowserCallHandler] acceptCall"),n=!0,r.accept(e,i)},t.endCall=r.stop,t.cancelCall=r.cancel,t.requestCallInfo=function(){p.log("[OutOfBrowserCallHandler] requestCallInfo");var t=i.task(),n=e._callData.oncePluginCallInfoReady(function(){d.clearTimeout(s),t.resolve(e._callData.pluginCallInfo())}),s=d.setTimeout(function(){n.dispose(),t.reject("Call info request timeout")},5e3);return r.requestCallInfo().catch(function(){n.dispose(),d.clearTimeout(s),t.reject("Shell app not initialized")}),t.promise},t.mute=function(){return p.log("[OutOfBrowserCallHandler] mute"),t.toggleMuteTask&&t.toggleMuteTask.promise.state()==="pending"?t.toggleMuteTask.promise:(t.toggleMuteTask=i.task(),r.mute(),t.toggleMuteTask.promise)},t.unmute=function(){return p.log("[OutOfBrowserCallHandler] unmute"),t.toggleMuteTask&&t.toggleMuteTask.promise.state()==="pending"?t.toggleMuteTask.promise:(t.toggleMuteTask=i.task(),r.unmute(),t.toggleMuteTask.promise)},t.acknowledge=function(){p.log("[OutOfBrowserCallHandler] acknowledge");if(!n&&e.selfParticipant.audio.state()===o.callConnectionState.Disconnected)return p.log("[OutOfBrowserCallHandler] acknowledge, first payload, setting Notified state"),c.updateParticipantAudioVideoState(e.selfParticipant,o.callConnectionState.Notified,o.callDisconnectionReason.OutOfBrowserCall),!0;if(n&&e.selfParticipant.audio.state()===o.callConnectionState.Notified)return p.log("[OutOfBrowserCallHandler] acknowledge, call is connecting, updating payload"),r.updateIncomingCallPayload(e);p.log("[OutOfBrowserCallHandler] acknowledge, call not yet accepted/rejected, ignore update");return},t.rejectCall=function(){return p.log("[OutOfBrowserCallHandler] rejectCall"),c.handleParticipantLeavingStateTransition(e.selfParticipant,o.callDisconnectionReason.Busy),c.handleRemoteParticipantsLeavingStateTransition(e.participants()),Promise.resolve()},t.startParticipantVideo=y,t.stopParticipantVideo=y,t.attachParticipantVideo=y,t.detachParticipantVideo=y,t.dispose=y,t.setSoundLevelEventMode=y}function g(){p.log("[OutOfBrowserCallHandler] dispose"),v&&(v.dispose({preventReinitialisation:!0}),v=null)}function y(){return Promise.resolve()}function b(){if(v)return v;var e=w(),t=f.settings.environment||h,r=f.settings.initParams.locale;return v=n.build(e,t,r),v.initialize(),v}function w(){var e=s.getBrowserInfo().getUrlParams().ecsoverride||E(),t=S()+"?apiKey="+f.settings.initParams.apiKey+"&fingerprint="+f.settings.initParams.fingerprint;return e&&(t+="&ecsoverride="+e),t}function E(){var e=document.cookie.match(/ecsoverride=(.*?)(;|$)/);return e&&e.length>1?e[1]:undefined}function S(){return f.settings.appBaseUrl+r.shellAppIndexPagePath}var n=e("jSkype/services/outOfBrowser/outOfBrowserFacade"),r=e("constants/outOfBrowser"),i=e("jcafe-property-model"),s=e("browser/detect"),o=e("swx-enums"),u=e("constants/common"),a=e("constants/extension"),f=e("jSkype/settings"),l=e("utils/calling/callingStack"),c=e("jSkype/modelHelpers/participantHelper"),h="prod",p=e("jSkype/telemetry/logging/callingLogTracer").get(),d=e("browser/window"),v;t.initialize=function(){if(!f.isFeatureOn(u.featureFlags.PRELOAD_SHELL_APP))return;b()},t.dispose=g,t.build=function(t){return new m(t)}}),define("jSkype/services/callHandlerFactory",["require","exports","module","utils/calling/callingStack","jSkype/services/plugin/pluginCallHandler","jSkype/services/NGCCallAgent/NGCCallAgent/ngcAgent","jSkype/services/outOfBrowser/outOfBrowserCallHandler","swx-enums"],function(e,t){var n=e("utils/calling/callingStack"),r=e("jSkype/services/plugin/pluginCallHandler"),i=e("jSkype/services/NGCCallAgent/NGCCallAgent/ngcAgent").callHandler,s=e("jSkype/services/outOfBrowser/outOfBrowserCallHandler"),o=e("swx-enums"),u;t.createCallHandler=function(t){return t.audioService._canHandlePluginlessCall()?(t._callData.callTechnology(o.callTechnology.NGC),i.build(t)):n.get().isInBrowserPluginSupported()?r.build(t):s.build(t)},t.initialize=function(){return n.get().isPluginlessCallingSupported()?u=i:n.get().isInBrowserPluginSupported()?u=r:u=s,u.initialize()},t.dispose=function(){u&&u.dispose&&u.dispose()}}),define("jSkype/telemetry/callInfoTelemetry",["require","exports","module","lodash-compat","jSkype/client","jSkype/settings","jSkype/modelHelpers/contacts/dataMappers/dataMaps","utils/calling/callingStack","swx-enums","swx-utils-common","constants/common"],function(e,t){function c(e,t){function p(r){var s=n.extend({callCorrelationId:l,name:f.telemetry.calling.CALL_INFO,callState:r,direction:t,callTechnology:e._callData.callTechnology()},d());c.sendEvent(i.settings.telemetry.jSkypeTenantToken,f.telemetry.calling.MASTER_EVENT,s)}function d(){var t=f.telemetry.calling.PARTICIPANTS_COUNT_PREFIX,n={},r=e.participants().map(function(e){return o[e.person._type()]||f.telemetry.calling.UNKNOWN_CONTACT_TYPE});return r.forEach(function(e){n.hasOwnProperty(t+e)?n[t+e]+=1:n[t+e]=1}),n}var o=n.invert(s.contactTypes),l=a.create(),c=r.get()._telemetryManager,h=e.selfParticipant.audio.state.once(u.callConnectionState.Connected,function(){p(f.telemetry.calling.CONNECTED_CALL)});this.dispose=function(){h.dispose()}}function h(e,t){return o.get().isInBrowserCallingSupported()?new c(e,t):{dispose:function(){}}}var n=e("lodash-compat"),r=e("jSkype/client"),i=e("jSkype/settings"),s=e("jSkype/modelHelpers/contacts/dataMappers/dataMaps"),o=e("utils/calling/callingStack"),u=e("swx-enums"),a=e("swx-utils-common").guid,f=e("constants/common"),l={};t.build=function(e,t){return l[e.conversationId]||(l[e.conversationId]=h(e,t)),l[e.conversationId]},t.dispose=function(e){l[e.conversationId]&&(l[e.conversationId].dispose(),delete l[e.conversationId])}}),define("jSkype/services/callController",["require","exports","module","jcafe-property-model","jSkype/client","constants/calling","jSkype/modelHelpers/calling/fallbackMessageHelper","jSkype/settings","jSkype/services/callHandlerFactory","utils/calling/callingStack","jSkype/telemetry/logging/callingLogTracer","jSkype/services/callRegister","jSkype/telemetry/callInfoTelemetry","constants/common","swx-enums","jSkype/modelHelpers/participantHelper","jSkype/services/preferences/settingsUtils/privacySettingsUtil"],function(e,t){function y(e){return a.get().isPluginlessEnabledInCurrentBrowser()&&!a.get().isPluginlessCallingSupported()&&s.sendWindowsUpdateFallbackMessage(e),Promise.resolve(e)}function b(e,t){e.audioService.callId._set(t.convoCallId)}function w(e){e.audioService.callId._set(null)}function E(e,t){var n=t||p.callDisconnectionReason.Terminated;d.handleParticipantLeavingStateTransition(e.selfParticipant,n)}function S(e){return a.get().isPluginlessCallingSupported()&&(e.autoCall()||e._autoCallingService.callId())&&e.selfParticipant.audio.state.reason!==p.callDisconnectionReason.OutOfBrowserCall?(e.selfParticipant.audio.state.reason=p.callDisconnectionReason.OutOfBrowserCall,e.selfParticipant.video.state.reason=p.callDisconnectionReason.OutOfBrowserCall,Promise.reject(new Error(i.ERRORS.P2P_FALLBACK))):e._autoCallingService.handleAutoCall()}function x(e){return e.selfParticipant.audio.state.reason!==p.callDisconnectionReason.OutOfBrowserCall&&a.get().isPluginlessCallingSupported()&&e.activeModalities.audio()&&!e._ngcJoinUrl?(e.selfParticipant.audio.state.reason=p.callDisconnectionReason.OutOfBrowserCall,e.selfParticipant.video.state.reason=p.callDisconnectionReason.OutOfBrowserCall,Promise.reject(new Error(i.ERRORS.P2P_FALLBACK))):Promise.resolve(e)}function T(e,t){return new Promise(function(n,r){e.selfParticipant.audio.state.reason===p.callDisconnectionReason.OutOfBrowserCall?(W(e),Promise.all([e.audioService._checkPluginBasedCapabilitiesSupport(),e.videoService._checkPluginBasedCapabilitiesSupport()]).then(function(){r(t)},function(){r(t)}),E(e,p.callDisconnectionReason.OutOfBrowserCall)):(E(e,p.callDisconnectionReason.Failed),r(t))})}function N(e){return new Promise(function(t,n){l.get().canPlaceCall()?(f.log("[Call controller] checkIfCanPlaceCall: true"),t(e)):(f.log("[Call controller] checkIfCanPlaceCall: false"),n())})}function C(e){return c.build(e,h.telemetry.calling.direction.OUTGOING),Promise.resolve(e)}function k(e){return f.log("[Call Controller] Clean conversation state"),e._callData.resetCallData(),w(e),Promise.resolve(e)}function L(e,t){return f.log("[Call Controller] Place call, withVideo",t),e._callHandler.placeCall(t)}function A(e){var t=o.SoundLevelEventMode||i.SOUND_LEVEL_EVENT_MODE.Boolean,n=o.SoundLevelThreshold||i.SOUND_LEVEL_DEFAULT_THRESHOLD;e._callHandler.setSoundLevelEventMode({mode:t,threshold:n})}function O(e){a.get().isPluginlessCallingSupported()&&e._callData.hasIncomingP2PNotification()&&!e._callData.hasIncomingNGCNotification()&&(e.selfParticipant.audio.state.reason=p.callDisconnectionReason.OutOfBrowserCall,e.selfParticipant.video.state.reason=p.callDisconnectionReason.OutOfBrowserCall)}function M(e){var t;return f.log("[Call Controller] Setup call"),e._callHandler?(f.log("[Call Controller] Setup call, callHandler exists!"),Promise.resolve(e)):(O(e),t=u.createCallHandler(e),e._setCallHandler(t),l.get().registerCall(e),R(e),U(e),A(e),Promise.resolve(e))}function _(e){var t=[p.callConnectionState.Disconnected,p.callConnectionState.Notified];return t.indexOf(e.selfParticipant.audio.state())>-1}function D(e){return e.selfParticipant.audio.state()!==p.callConnectionState.Notified&&(e.audioService._setMediaConnectionType(),a.get().isPluginlessCallingSupported()&&!e.audioService._canHandlePluginlessCall()?d.updateParticipantAudioVideoState(e.selfParticipant,p.callConnectionState.Notified,p.callDisconnectionReason.OutOfBrowserCall):d.updateParticipantAudioVideoState(e.selfParticipant,p.callConnectionState.Notified)),Promise.resolve()}function P(e){var t=e.conversationId,n;return I(e)&&(t=e.conversationId.replace("8:#T/","")),n=r.get().conversationsManager._getOrCreateConversation(t),n._callData.addIncomingCallPayload(e),r.get().conversationsManager.conversations.add(n),n}function H(e){return e.audioService._setMediaConnectionType(),M(e).then(e._callHandler.acknowledge).catch(function(t){return f.log("[Call Controller] Failed to process incomingCall",t),q(e),Promise.reject()})}function B(e){e.audioService.accept.enabled._set(!0),e.audioService.stop.enabled._set(!0),e.videoService.accept.enabled._set(!0),e.videoService.stop.enabled._set(!0)}function j(e,t){var i=n.task();return r.get().personsAndGroupsManager.mePerson.capabilities.audio.get().then(e.audioService._checkPluginBasedCapabilitiesSupport).then(function(n){var i=g.callingAllowed,s=r.get().personsAndGroupsManager.mePerson.capabilities.audio;l.get().canProcessIncomingCall(t.conversationId)||(f.log("[Call Controller] Call Register is not allowing calls. Ignoring incoming call"),i=g.ignore);if(!s()||!n&&!e._callData.hasIncomingNGCNotification())f.log("[Call Controller] Calling is not supported because:",s.reason),F(s.reason)||F(e.audioService.accept.enabled.reason)?(f.log("[Call Controller] Notify Only"),i=g.notifyOnly):(f.log("[Call Controller] Ignoring call"),i=g.ignore);return s()&&!n&&e._callData.hasIncomingNGCNotification()&&!e.audioService._hasPSTNParticipants()&&B(e),e._callData.isGroupIncomingCall()&&!o.isFeatureOn(h.featureFlags.GVC_JOINING)&&(f.log("[Call Controller] This is a group call, but the feature flag is off. Ignoring call"),i=g.ignore),a.get().isPluginlessCallingSupported()&&e.audioService._hasPSTNParticipants()&&!n&&(f.log("[Call Controller] PSTN call in plugin-less env, no plugin installed, notify user"),i=g.notifyOnly),l.get().wasCallEnded(t)&&(f.log("[Call Controller] This call was already ended/rejected, ignoring"),i=g.ignore),v.checkCallPolicySettings(e).then(function(e){return e?i:g.ignore})}).then(function(e){f.log("[Call Controller] Incoming call policy is ",e),i.resolve(e)}).catch(function(){i.resolve(g.ignore)}),i.promise}function F(e){switch(e){case p.callingNotSupportedReasons.PluginNotInstalled:return!0;case p.callingNotSupportedReasons.OSNotSupported:return!0;case p.callingNotSupportedReasons.BrowserNotSupported:return!0}return!1}function I(e){return e.conversationId!=="8:"+e.callerId}function q(e){f.log("[Call Controller] Calling unregister with",e.conversationId),l.get().unregisterCall(e,e._callData.getCallIdFromCurrentCall()),e._callHandler&&(e._callHandler.dispose(),e._callHandler=null),e._autoCallingService.reset(e.selfParticipant.audio.state.reason),k(e),e._callData.resetPluginCallState(),z(e),w(e),c.dispose(e),m[e.conversationId]&&(m[e.conversationId].dispose(),delete m[e.conversationId])}function R(e){function r(t,r,i){f.log("[Call Controller] Audio state changed",t,r,i),i!==undefined&&t===p.callConnectionState.Disconnected&&(q(e),n.dispose())}var t=e.selfParticipant.audio.state,n=e.participants.subscribe();f.log("[Call Controller] subscribe to audio state"),m[e.conversationId]=t.changed(r)}function U(e){function n(){e._callHandler.dispose(),c.dispose(e),t(!1)}var t=e.selfParticipant.audio._isFailedCall;t.once(!0,function(){l.get().unregisterCall(e),e._callHandler.cancelCall(e).then(n,n)})}function z(e){if(!e.isGroupConversation()){var t=e.participants(0);t.audio.endpoint(t.person.id())}}function W(e){if(!a.get().isPluginlessCallingSupported()||e.audioService._hasPSTNParticipants())return;e.selfParticipant.audio.state.reason===p.callDisconnectionReason.OutOfBrowserCall&&s.sendOutgoingP2PCallFallbackMessage(e)}function X(e){y(e);if(!a.get().isPluginlessCallingSupported()||e.audioService._hasPSTNParticipants())return;e._callData.hasIncomingNGCNotification()||s.sendIncomingP2PCallFallbackMessage(e)}var n=e("jcafe-property-model"),r=e("jSkype/client"),i=e("constants/calling"),s=e("jSkype/modelHelpers/calling/fallbackMessageHelper"),o=e("jSkype/settings"),u=e("jSkype/services/callHandlerFactory"),a=e("utils/calling/callingStack"),f=e("jSkype/telemetry/logging/callingLogTracer").get(),l=e("jSkype/services/callRegister"),c=e("jSkype/telemetry/callInfoTelemetry"),h=e("constants/common"),p=e("swx-enums"),d=e("jSkype/modelHelpers/participantHelper"),v=e("jSkype/services/preferences/settingsUtils/privacySettingsUtil"),m={},g={callingAllowed:1,notifyOnly:2,ignore:3};t.placeCall=function(e,n){return N(e).then(y).then(k).then(t.setupCall).then(x).then(S).then(C).then(L.bind(null,e,n)).catch(function(t){return f.log("[Call Controller] Failed to process placeCall",t),T(e,t)})},t.handleIncoming=function(t){var n=P(t);return l.get().registerCallIdMapping(n,t)?j(n,t).then(function(e){c.build(n,h.telemetry.calling.direction.INCOMING);switch(e){case g.callingAllowed:return b(n,t),X(n),H(n);case g.notifyOnly:return b(n,t),X(n),D(n);case g.ignore:return n._callData.markIncomingPayloadsAsProcessed(t),Promise.resolve()}return Promise.reject()}):(k(n),Promise.resolve())},t.cancelCall=function(t){function n(){return t._callHandler?t._callHandler.cancelCall(t):Promise.resolve()}return f.log("[Call Controller] cancel call, audio cancellable",_(t)),_(t)?n().then(function(){E(t,p.callDisconnectionReason.Canceled),q(t)}):Promise.resolve()},t.endCall=function(e){return e._callHandler?e._callHandler.endCall():(e.autoCall()&&(f.log("[Call controller] No call handler, fake disconnect"),E(e)),Promise.resolve())},t.abortAutoCall=function(e){E(e,p.callDisconnectionReason.AutoCallFailed)},t.setupCall=M}),define("jSkype/models/callingServiceBase",["require","jSkype/client","browser/detect","jSkype/settings","jSkype/services/callController","utils/calling/callingStack","jSkype/services/callRegister","constants/common","swx-enums","jSkype/services/calling/environmentInspector","jSkype/modelHelpers/participantHelper","jcafe-property-model","jSkype/modelHelpers/propertyModelHelper","jSkype/services/trouter/trouter"],function(e){function d(e,d){function C(){return v._isCallWithP2PEndpoint()?v._checkPluginBasedCapabilitiesSupport():m[d?"video":"audio"].get()}function k(){g(!0),b(!0),y(!0)}function L(e){g(!1,e),b(!1,e),y(!1,e)}function A(e){g(!1,e)}function O(){return N}function M(){e.isGroupConversation.once(!0,I)}function _(e){e?I():g(!1)}function D(){o.get().canPlaceCall.changed(_)}function P(){m.audio.changed(I),m.video.changed(I)}function H(){e.participantsCount.changed(I)}function B(){e.activeModalities.audio.changed(I),e.activeModalities.video.changed(I)}function j(){s.get().isPluginlessCallingSupported()&&p.trouterUrl.changed(I)}function F(){return n.getSystemInfo().osName===n.OPERATING_SYSTEMS.LINUX}function I(){if(!x)return L(a.callingNotSupportedReasons.FeatureDisabled),!1;if(e.isGroupConversation()&&!E)return L(a.callingNotSupportedReasons.FeatureDisabled),!1;if(O()&&!S)return A(a.callingNotSupportedReasons.FeatureDisabled),!1;if(!T)return L(a.callingNotSupportedReasons.NotInConversation),!1;if(v._hasTooManyParticipants()&&!v._activeConversationModality())return L(a.callingNotSupportedReasons.TooManyParticipants),!1;if(!m.audio())return L(m.audio.reason),!1;if(d&&!m.video())return L(m.video.reason),!1;if(d&&F())return L(a.callingNotSupportedReasons.FeatureDisabled),!1;if(!p.trouterUrl()&&s.get().isPluginlessCallingSupported())return L(a.callingNotSupportedReasons.TrouterNotInitialized),!1;k(),o.get().canPlaceCall()||g(!1)}function q(){I(),x&&(M(),D(),P(),H(),B(),j())}function R(){v.callStarted._set(new Date),s.get().isPluginlessCallingSupported()&&!v._canHandlePluginlessCall()||v._isCallWithP2PEndpoint()?l.updateParticipantAudioVideoState(e.selfParticipant,a.callConnectionState.Connecting,a.callDisconnectionReason.OutOfBrowserCall):(l.updateParticipantsAudioVideoState(e,a.callConnectionState.Disconnected),l.updateParticipantAudioVideoState(e.selfParticipant,a.callConnectionState.Connecting))}var v=this,m=t.get().personsAndGroupsManager.mePerson.capabilities,g=c.property({get:C,value:!0}),y=c.property({get:C,value:!0}),b=c.property({get:C,value:!0}),w=c.property({value:!0}),E=r.isFeatureOn(u.featureFlags.GVC_OUTGOING),S=r.isFeatureOn(u.featureFlags.PSTN_ENABLED),x=r.isFeatureOn(u.featureFlags.CALLING),T=!0,N=!1;return v._setMediaConnectionType=function(){var t=a.mediaConnectionType.Unknown;v._canHandlePluginlessCall()?t=a.mediaConnectionType.Pluginless:e._callData.isCurrentCallIncoming()&&(t=e._callData.hasIncomingNGCNotification()?a.mediaConnectionType.PluginBasedNGC:a.mediaConnectionType.PluginBasedP2P),e.mediaConnectionType(t)},v._checkPluginBasedCapabilitiesSupport=function(){return f.checkForPluginBasedCallingSupport().then(function(e){return o.get().canPlaceCall()&&(g._set(e.isSupported,e.reason),y._set(e.isSupported,e.reason),b._set(e.isSupported,e.reason)),e.isSupported})},v._setPSTNParticipants=function(e){N=e,I()},v._hasPSTNParticipants=function(){return N},v._isCallWithP2PEndpoint=function(){return e.selfParticipant.audio.state.reason===a.callDisconnectionReason.OutOfBrowserCall},v._canHandlePluginlessCall=function(){var t=e._callData.isCurrentCallIncoming()&&!e._callData.hasIncomingNGCNotification();return s.get().isPluginlessCallingSupported()?v._isCallWithP2PEndpoint()?!1:t?!1:v._hasPSTNParticipants()?!1:!0:!1},v._membershipChanged=function(e){T=e,I()},v._hasTooManyParticipants=function(){return!1},v._activeConversationModality=function(){return!1},v.callStarted=c.property({readOnly:!0}),v.sendDtmf=c.command(),v.start=h.createCommandWithSetter(function(){return v._setMediaConnectionType(),R(),i.placeCall(e,d)},g),v.stop=c.command(function(){return l.updateParticipantAudioVideoState(e.selfParticipant,a.callConnectionState.Disconnecting,a.callDisconnectionReason.Terminated),i.endCall(e)},y),v.accept=h.createCommandWithSetter(function(){return R(),e._callHandler.acceptCall(d)},b),v.reject=c.command(function(){return e._callHandler?e._callHandler.rejectCall():(l.handleParticipantLeavingStateTransition(e.selfParticipant,a.callDisconnectionReason.Busy),l.handleRemoteParticipantsLeavingStateTransition(e.participants()),Promise.resolve())},w),q(),this}var t=e("jSkype/client"),n=e("browser/detect"),r=e("jSkype/settings"),i=e("jSkype/services/callController"),s=e("utils/calling/callingStack"),o=e("jSkype/services/callRegister"),u=e("constants/common"),a=e("swx-enums"),f=e("jSkype/services/calling/environmentInspector"),l=e("jSkype/modelHelpers/participantHelper"),c=e("jcafe-property-model"),h=e("jSkype/modelHelpers/propertyModelHelper"),p=e("jSkype/services/trouter/trouter");return d}),define("jSkype/models/audioService",["require","exports","module","jcafe-property-model","jSkype/settings","swx-enums","jSkype/models/callingServiceBase"],function(e,t){function o(e){function l(){t.callConnected._set(null)}function c(e){e!==i.callDisconnectionReason.CallEscalated&&t.callConnected._set(new Date)}function h(t){return new Promise(function(n,r){u.indexOf(t)!==-1?e._callHandler.sendDtmf(t).then(function(){n(t)},function(){r(t)}):r(t)})}var t=this,o=new s(e,!1),u=["0","1","2","3","4","5","6","7","8","9","*","#"];t.callConnected=n.property({readOnly:!0,value:null}),t.disconnectionReason=n.property({readOnly:!0}),t.sendDtmf=n.command(h,t.callConnected),t.callId=n.property({readOnly:!0}),t.start=o.start,t.stop=o.stop,t.accept=o.accept,t.reject=o.reject,t._canHandlePluginlessCall=o._canHandlePluginlessCall,t._isCallWithP2PEndpoint=o._isCallWithP2PEndpoint,t._setMediaConnectionType=o._setMediaConnectionType,t._hasPSTNParticipants=o._hasPSTNParticipants,t._setPSTNParticipants=o._setPSTNParticipants,t._membershipChanged=o._membershipChanged,t._checkPluginBasedCapabilitiesSupport=o._checkPluginBasedCapabilitiesSupport;var a=e.selfParticipant.audio.state.when(i.callConnectionState.Connecting,l),f=e.selfParticipant.audio.state.when(i.callConnectionState.Connected,c);return t._dispose=function(){f.dispose(),a.dispose()},o._hasTooManyParticipants=function(){return e.participantsCount()>=r.settings.maximumParticipantsAudio},o._activeConversationModality=function(){return e.activeModalities.audio()},t}var n=e("jcafe-property-model"),r=e("jSkype/settings"),i=e("swx-enums"),s=e("jSkype/models/callingServiceBase");t.build=function(e,t){return new o(e,t)}}),define("jSkype/services/calling/autoCalling",["require","exports","module","jSkype/client","jSkype/services/callController","jSkype/settings","utils/calling/callingStack","constants/common","swx-enums","swx-utils-common","jSkype/telemetry/logging/callingLogTracer","jcafe-property-model","reqwest","browser/window"],function(e,t){function p(e){function g(e,r){var s=r||{};s.eventName=e,s.mode=t.autoCallingMode(),s.partnerId=t.partnerId(),s.callId=t.callId(),f.log("[AutoCall] telemetry sent",s),n.get()._telemetryManager.sendEvent(i.settings.telemetry.jSkypeTenantToken,o.telemetry.autoCalling.MASTER_EVENT,s)}function y(){d?e.selfParticipant.audio.state()!==u.callConnectionState.Connected&&(t.reset(u.callDisconnectionReason.AutoCallTimeout),r.endCall(e)):(t.reset(u.callDisconnectionReason.AutoCallTimeout),r.abortAutoCall(e))}function b(){h.setTimeout(y,i.settings.autoCalling.callTimeout)}function w(){h.setTimeout(function(){t.reset(u.callDisconnectionReason.AutoCallFailed),r.abortAutoCall(e)},i.settings.autoCalling.serviceFailureTimeout)}function E(e,t){var n=JSON.stringify({host:e.selfParticipant.person.id(),payload:t.Token});f.log("AutoCalling service response:",n),c.compat({url:t.CallbackUrl,crossOrigin:!0,dataType:"json",data:n,method:"PUT",contentType:"application/json",error:function(e){f.log("AutoCalling service error",e),w()},success:function(e){f.log("AutoCalling service success",e)}})}function S(){m.forEach(function(e){return e&&e.dispose()}),m=[]}function x(e){var t=a.get(o.autoCallingThreadId);return t===e.conversationId?(f.log("[AutoCall] conversation with auto call matched"),a.remove(o.autoCallingThreadId),!0):(f.log("[AutoCall] can not match conversation with auto call, ignoring"),!1)}var t=this,p=!1,d=!1,v,m=[];return t.autoCallingMode=l.property(),t.partnerId=l.property(),t.callId=l.property(),t.shellAppCanHost=l.boolProperty(!1),t.shellAppCanJoin=l.boolProperty(!1),t.reset=function(r){f.log("[AutoCall] reset, current autoCall()",e.autoCall());if(r===u.callDisconnectionReason.OutOfBrowserCall){f.log("[AutoCall] reset, fallback to plugin, ignoring");return}e.autoCall()&&(e.autoCall(!1,r),g(o.telemetry.autoCalling.AUTO_CALL_ENDED,{reason:r||"unknown",mode:t.autoCallingMode(),participantsCount:e.participantsCount()}),t.autoCallingMode(""),!d&&v&&v({reason:r,message:"Autocall failed, reason:"+r,type:o.callingErrors.AUTO_CALL_FAILED}),d=!1,n.get()._telemetryManager.setCommonProperty("autoCalling",!1))},t.handleAutoCall=function(){var n=new Promise(function(n,r){function a(){d=!0,S(),n(e)}function l(){g(o.telemetry.autoCalling.ATTEMPT_TO_JOIN),d=!0,S(),n(e)}function c(){g(o.telemetry.autoCalling.ATTEMPT_TO_JOIN),d=!0,n(e)}function p(t){f.log("AutoCalling, waiting for participants, currently",e.participants().length),e.participants().length?t():(m.push(e.participants.subscribe()),m.push(e.participants.added(t)))}function y(e){p(e)}function w(t){f.log("AutoCalling, waiting for active audio",e.activeModalities.audio()),m.push(e.activeModalities.audio.once(!0,t))}function E(){f.log("AutoCalling, handling in parent window, mode:",t.autoCallingMode()),t.autoCallingMode()===o.autoCallingMode.call?(p(function(){S(),e._callHandler.hostCall(!0)}),c()):t.autoCallingMode()===o.autoCallingMode.join?(w(function(){S(),e._callHandler.joinCall(!0)}),c()):t.autoCallingMode()===o.autoCallingMode.golive&&(e._callHandler.joinCall(!0),c())}function x(){f.log("AutoCalling, handling in shellapp, mode:",t.autoCallingMode(),"can host:",t.shellAppCanHost(),"can join",t.shellAppCanJoin()),t.autoCallingMode()===o.autoCallingMode.call?m.push(t.shellAppCanHost.once(!0,l)):t.autoCallingMode()===o.autoCallingMode.join?m.push(t.shellAppCanJoin.once(!0,l)):t.autoCallingMode()===o.autoCallingMode.golive&&m.push(t.shellAppCanJoin.once(!0,l))}function T(){f.log("AutoCalling, handling standard plugin call, mode:",t.autoCallingMode()),t.autoCallingMode()===o.autoCallingMode.call?y(l):t.autoCallingMode()===o.autoCallingMode.join?w(l):t.autoCallingMode()===o.autoCallingMode.golive&&l()}function N(){return s.get().isPluginlessCallingSupported()&&e.selfParticipant.audio.state.reason===u.callDisconnectionReason.OutOfBrowserCall}if(!i.isFeatureOn(o.featureFlags.AUTO_CALLING)){f.log("AutoCalling is disabled, return conversation"),a();return}if(!e.autoCall()){a();return}v=r,f.log("AutoCalling handling, autoCall:",e.autoCall(),", mode:",t.autoCallingMode()),e.autoCall()&&(h.shellApp?(x(),b()):N()||!s.get().isInBrowserCallingSupported()?E():s.get().isInBrowserCallingSupported()&&(T(),b()))});return n.catch(function(e){g(o.telemetry.autoCalling.AUTO_CALL_HANDLING_ERROR),f.error("Error while handling auto calling promise:",e)}),n},t.setupAutoCallTelemetry=function(){n.get()._telemetryManager.setCommonProperty("autoCalling",t.partnerId()),n.get()._telemetryManager.setCommonProperty("autoCallId",t.callId()),n.get()._telemetryManager.setCommonProperty("autoCallMode",t.autoCallingMode())},t.setupMeeting=function(e,n){var r;if(!i.isFeatureOn(o.featureFlags.AUTO_CALLING)){f.log("AutoCalling is disabled");return}if(p||h.shellApp){f.warn("Cant update meeting details, previous message was handled or in shell app");return}try{r=JSON.parse(n)}catch(s){g(o.telemetry.autoCalling.AUTO_CALL_PAYLOAD_INVALID),f.log("Unable to parse autoCallPayload",n);return}if(!x(e))return!1;f.log("Setup autoCalling",e.conversationId,r),p=!0,t.partnerId(r.PartnerService),t.autoCallingMode(r.Mode),t.callId(r.CallId),t.setupAutoCallTelemetry(),e.autoCall(!0),r.Mode===o.autoCallingMode.call?(g(o.telemetry.autoCalling.HOST_JOINED),e.selfParticipant.audio.state.once(u.callConnectionState.Connecting,function(){E(e,r)})):g(o.telemetry.autoCalling.PARTICIPANT_JOINED)},t}var n=e("jSkype/client"),r=e("jSkype/services/callController"),i=e("jSkype/settings"),s=e("utils/calling/callingStack"),o=e("constants/common"),u=e("swx-enums"),a=e("swx-utils-common").sessionStorage,f=e("jSkype/telemetry/logging/callingLogTracer").get(),l=e("jcafe-property-model"),c=e("reqwest"),h=e("browser/window");t.build=function(e){return new p(e)}}),define("jSkype/models/videoService",["require","exports","module","jSkype/models/callingServiceBase","jSkype/settings","jcafe-property-model"],function(e,t){function s(e){var t=this,s=new n(e,!0);return t.maxVideos=i.property(),t.start=s.start,t.stop=s.stop,t.accept=s.accept,t.reject=s.reject,t._canHandlePluginlessCall=s._canHandlePluginlessCall,t._isCallWithP2PEndpoint=s._isCallWithP2PEndpoint,t._setMediaConnectionType=s._setMediaConnectionType,t._hasPSTNParticipants=s._hasPSTNParticipants,t._setPSTNParticipants=s._setPSTNParticipants,t._membershipChanged=s._membershipChanged,t._checkPluginBasedCapabilitiesSupport=s._checkPluginBasedCapabilitiesSupport,s._hasTooManyParticipants=function(){return e.participantsCount()>=r.settings.maximumParticipantsVideo},s._activeConversationModality=function(){return e.activeModalities.video()},t}var n=e("jSkype/models/callingServiceBase"),r=e("jSkype/settings"),i=e("jcafe-property-model");t.build=function(e,t){return new s(e,t)}}),define("jSkype/models/screenSharingService",["require","exports","module","jcafe-property-model","jSkype/modelHelpers/propertyModelHelper","swx-enums"],function(e,t){function a(e){function f(){if(e.selfParticipant.audio.state()!==i.callConnectionState.Connected){s(!1),u(!1),o(!1);return}var n=t.sharer();s(n!==e.selfParticipant),u(!!n),o(n&&n!==e.selfParticipant)}var t=this,a;t.sharer=n.property({value:null}),t.sharedResources=n.collection(),t.controller=n.property({value:null}),t.controlRequesters=n.collection(),t.requestControl=n.disabledCommand(),t.releaseControl=n.disabledCommand(),t.acceptControlRequest=n.disabledCommand(),t.rejectControlRequest=n.disabledCommand(),e.selfParticipant.audio.state.changed(f),t.start=r.createCommandWithSetter(function(){return new Promise(function(n,r){function s(){if(!e._callHandler)return r("No call handler"),!0}if(s())return;e._callHandler.getMonitorList().then(function(o){if(o&&o.length){if(s())return;e._callHandler.setScreenCaptureMonitor(o[0].monitorId).then(function(){t.sharer(e.selfParticipant),e.selfParticipant.screenSharing.state._set(i.callConnectionState.Connecting),n(!0)},r)}else r("Failed to get monitors to share")},r)})},s),t.accept=r.createCommandWithSetter(function(){var e=t.sharer();e&&e.screenSharing.state._set(i.callConnectionState.Connecting)},o),t.reject=n.disabledCommand(),t.stop=r.createCommandWithSetter(function(){var e=t.sharer();e&&e.screenSharing.state()!==i.callConnectionState.Disconnecting&&e.screenSharing.state()!==i.callConnectionState.Disconnected&&e.screenSharing.state._set(i.callConnectionState.Disconnecting)},u),t.sharer.changed(function(e){a&&(a.dispose(),a=null),e&&(a=e.screenSharing.state.changed(function(n,r,s){s&&n===i.callConnectionState.Disconnected&&t.sharer()===e&&t.sharer(null),f()})),f()})}var n=e("jcafe-property-model"),r=e("jSkype/modelHelpers/propertyModelHelper"),i=e("swx-enums"),s=n.property({value:!1}),o=n.property({value:!1}),u=n.property({value:!1});t.build=function(e){return new a(e)}}),define("utils/chat/sort",[],function(){return{byId:function(e,t){return e.id-t.id},byTimestamp:function(e,t){return e.timestamp-t.timestamp},byTimestampDescending:function(e,t){return t.timestamp-e.timestamp}}}),function(){function r(e){var n=!1;return function(){if(n)throw new Error("Callback was already called.");n=!0,e.apply(t,arguments)}}var e={},t,n;t=this,t!=null&&(n=t.async),e.noConflict=function(){return t.async=n,e};var i=Object.prototype.toString,s=Array.isArray||function(e){return i.call(e)==="[object Array]"},o=function(e,t){for(var n=0;n<e.length;n+=1)t(e[n],n,e)},u=function(e,t){if(e.map)return e.map(t);var n=[];return o(e,function(e,r,i){n.push(t(e,r,i))}),n},a=function(e,t,n){return e.reduce?e.reduce(t,n):(o(e,function(e,r,i){n=t(n,e,r,i)}),n)},f=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};typeof process=="undefined"||!process.nextTick?typeof setImmediate=="function"?(e.nextTick=function(e){setImmediate(e)},e.setImmediate=e.nextTick):(e.nextTick=function(e){setTimeout(e,0)},e.setImmediate=e.nextTick):(e.nextTick=process.nextTick,typeof setImmediate!="undefined"?e.setImmediate=function(e){setImmediate(e)}:e.setImmediate=e.nextTick),e.each=function(e,t,n){function s(t){t?(n(t),n=function(){}):(i+=1,i>=e.length&&n())}n=n||function(){};if(!e.length)return n();var i=0;o(e,function(e){t(e,r(s))})},e.forEach=e.each,e.eachSeries=function(e,t,n){n=n||function(){};if(!e.length)return n();var r=0,i=function(){t(e[r],function(t){t?(n(t),n=function(){}):(r+=1,r>=e.length?n():i())})};i()},e.forEachSeries=e.eachSeries,e.eachLimit=function(e,t,n,r){var i=l(t);i.apply(null,[e,n,r])},e.forEachLimit=e.eachLimit;var l=function(e){return function(t,n,r){r=r||function(){};if(!t.length||e<=0)return r();var i=0,s=0,o=0;(function u(){if(i>=t.length)return r();while(o<e&&s<t.length)s+=1,o+=1,n(t[s-1],function(e){e?(r(e),r=function(){}):(i+=1,o-=1,i>=t.length?r():u())})})()}},c=function(t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[e.each].concat(n))}},h=function(e,t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[l(e)].concat(n))}},p=function(t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[e.eachSeries].concat(n))}},d=function(e,t,n,r){t=u(t,function(e,t){return{index:t,value:e}});if(!r)e(t,function(e,t){n(e.value,function(e){t(e)})});else{var i=[];e(t,function(e,t){n(e.value,function(n,r){i[e.index]=r,t(n)})},function(e){r(e,i)})}};e.map=c(d),e.mapSeries=p(d),e.mapLimit=function(e,t,n,r){return v(t)(e,n,r)};var v=function(e){return h(e,d)};e.reduce=function(t,n,r,i){e.eachSeries(t,function(e,t){r(n,e,function(e,r){n=r,t(e)})},function(e){i(e,n)})},e.inject=e.reduce,e.foldl=e.reduce,e.reduceRight=function(t,n,r,i){var s=u(t,function(e){return e}).reverse();e.reduce(s,n,r,i)},e.foldr=e.reduceRight;var m=function(e,t,n,r){var i=[];t=u(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n&&i.push(e),t()})},function(e){r(u(i.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};e.filter=c(m),e.filterSeries=p(m),e.select=e.filter,e.selectSeries=e.filterSeries;var g=function(e,t,n,r){var i=[];t=u(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n||i.push(e),t()})},function(e){r(u(i.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};e.reject=c(g),e.rejectSeries=p(g);var y=function(e,t,n,r){e(t,function(e,t){n(e,function(n){n?(r(e),r=function(){}):t()})},function(e){r()})};e.detect=c(y),e.detectSeries=p(y),e.some=function(t,n,r){e.each(t,function(e,t){n(e,function(e){e&&(r(!0),r=function(){}),t()})},function(e){r(!1)})},e.any=e.some,e.every=function(t,n,r){e.each(t,function(e,t){n(e,function(e){e||(r(!1),r=function(){}),t()})},function(e){r(!0)})},e.all=e.every,e.sortBy=function(t,n,r){e.map(t,function(e,t){n(e,function(n,r){n?t(n):t(null,{value:e,criteria:r})})},function(e,t){if(e)return r(e);var n=function(e,t){var n=e.criteria,r=t.criteria;return n<r?-1:n>r?1:0};r(null,u(t.sort(n),function(e){return e.value}))})},e.auto=function(t,n){n=n||function(){};var r=f(t),i=r.length;if(!i)return n();var u={},l=[],c=function(e){l.unshift(e)},h=function(e){for(var t=0;t<l.length;t+=1)if(l[t]===e){l.splice(t,1);return}},p=function(){i--,o(l.slice(0),function(e){e()})};c(function(){if(!i){var e=n;n=function(){},e(null,u)}}),o(r,function(r){var i=s(t[r])?t[r]:[t[r]],l=function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]);if(t){var s={};o(f(u),function(e){s[e]=u[e]}),s[r]=i,n(t,s),n=function(){}}else u[r]=i,e.setImmediate(p)},d=i.slice(0,Math.abs(i.length-1))||[],v=function(){return a(d,function(e,t){return e&&u.hasOwnProperty(t)},!0)&&!u.hasOwnProperty(r)};if(v())i[i.length-1](l,u);else{var m=function(){v()&&(h(m),i[i.length-1](l,u))};c(m)}})},e.retry=function(t,n,r){var i=5,s=[];typeof t=="function"&&(r=n,n=t,t=i),t=parseInt(t,10)||i;var o=function(i,o){var u=function(e,t){return function(n){e(function(e,r){n(!e||t,{err:e,result:r})},o)}};while(t)s.push(u(n,!(t-=1)));e.series(s,function(e,t){t=t[t.length-1],(i||r)(t.err,t.result)})};return r?o():o},e.waterfall=function(t,n){n=n||function(){};if(!s(t)){var r=new Error("First argument to waterfall must be an array of functions");return n(r)}if(!t.length)return n();var i=function(t){return function(r){if(r)n.apply(null,arguments),n=function(){};else{var s=Array.prototype.slice.call(arguments,1),o=t.next();o?s.push(i(o)):s.push(n),e.setImmediate(function(){t.apply(null,s)})}}};i(e.iterator(t))()};var b=function(e,t,n){n=n||function(){};if(s(t))e.map(t,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},n);else{var r={};e.each(f(t),function(e,n){t[e](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[e]=i,n(t)})},function(e){n(e,r)})}};e.parallel=function(t,n){b({map:e.map,each:e.each},t,n)},e.parallelLimit=function(e,t,n){b({map:v(t),each:l(t)},e,n)},e.series=function(t,n){n=n||function(){};if(s(t))e.mapSeries(t,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},n);else{var r={};e.eachSeries(f(t),function(e,n){t[e](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[e]=i,n(t)})},function(e){n(e,r)})}},e.iterator=function(e){var t=function(n){var r=function(){return e.length&&e[n].apply(null,arguments),r.next()};return r.next=function(){return n<e.length-1?t(n+1):null},r};return t(0)},e.apply=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var w=function(e,t,n,r){var i=[];e(t,function(e,t){n(e,function(e,n){i=i.concat(n||[]),t(e)})},function(e){r(e,i)})};e.concat=c(w),e.concatSeries=p(w),e.whilst=function(t,n,r){t()?n(function(i){if(i)return r(i);e.whilst(t,n,r)}):r()},e.doWhilst=function(t,n,r){t(function(i){if(i)return r(i);var s=Array.prototype.slice.call(arguments,1);n.apply(null,s)?e.doWhilst(t,n,r):r()})},e.until=function(t,n,r){t()?r():n(function(i){if(i)return r(i);e.until(t,n,r)})},e.doUntil=function(t,n,r){t(function(i){if(i)return r(i);var s=Array.prototype.slice.call(arguments,1);n.apply(null,s)?r():e.doUntil(t,n,r)})},e.queue=function(t,n){function i(t,n,r,i){t.started||(t.started=!0),s(n)||(n=[n]);if(n.length==0)return e.setImmediate(function(){t.drain&&t.drain()});o(n,function(n){var s={data:n,callback:typeof i=="function"?i:null};r?t.tasks.unshift(s):t.tasks.push(s),t.saturated&&t.tasks.length===t.concurrency&&t.saturated(),e.setImmediate(t.process)})}n===undefined&&(n=1);var u=0,a={tasks:[],concurrency:n,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(e,t){i(a,e,!1,t)},kill:function(){a.drain=null,a.tasks=[]},unshift:function(e,t){i(a,e,!0,t)},process:function(){if(!a.paused&&u<a.concurrency&&a.tasks.length){var e=a.tasks.shift();a.empty&&a.tasks.length===0&&a.empty(),u+=1;var n=function(){u-=1,e.callback&&e.callback.apply(e,arguments),a.drain&&a.tasks.length+u===0&&a.drain(),a.process()},i=r(n);t(e.data,i)}},length:function(){return a.tasks.length},running:function(){return u},idle:function(){return a.tasks.length+u===0},pause:function(){if(a.paused===!0)return;a.paused=!0},resume:function(){if(a.paused===!1)return;a.paused=!1;for(var t=1;t<=a.concurrency;t++)e.setImmediate(a.process)}};return a},e.priorityQueue=function(t,n){function r(e,t){return e.priority-t.priority}function i(e,t,n){var r=-1,i=e.length-1;while(r<i){var s=r+(i-r+1>>>1);n(t,e[s])>=0?r=s:i=s-1}return r}function u(t,n,u,a){t.started||(t.started=!0),s(n)||(n=[n]);if(n.length==0)return e.setImmediate(function(){t.drain&&t.drain()});o(n,function(n){var s={data:n,priority:u,callback:typeof a=="function"?a:null};t.tasks.splice(i(t.tasks,s,r)+1,0,s),t.saturated&&t.tasks.length===t.concurrency&&t.saturated(),e.setImmediate(t.process)})}var a=e.queue(t,n);return a.push=function(e,t,n){u(a,e,t,n)},delete a.unshift,a},e.cargo=function(t,n){var r=!1,i=[],a={tasks:i,payload:n,saturated:null,empty:null,drain:null,drained:!0,push:function(t,r){s(t)||(t=[t]),o(t,function(e){i.push({data:e,callback:typeof r=="function"?r:null}),a.drained=!1,a.saturated&&i.length===n&&a.saturated()}),e.setImmediate(a.process)},process:function f(){if(r)return;if(i.length===0){a.drain&&!a.drained&&a.drain(),a.drained=!0;return}var e=typeof n=="number"?i.splice(0,n):i.splice(0,i.length),s=u(e,function(e){return e.data});a.empty&&a.empty(),r=!0,t(s,function(){r=!1;var t=arguments;o(e,function(e){e.callback&&e.callback.apply(null,t)}),f()})},length:function(){return i.length},running:function(){return r}};return a};var E=function(e){return function(t){var n=Array.prototype.slice.call(arguments,1);t.apply(null,n.concat([function(t){var n=Array.prototype.slice.call(arguments,1);typeof console!="undefined"&&(t?console.error:console[e]&&o(n,function(t){console[e](t)}))}]))}};e.log=E("log"),e.dir=E("dir"),e.memoize=function(t,n){var r={},i={};n=n||function(e){return e};var s=function(){var s=Array.prototype.slice.call(arguments),o=s.pop(),u=n.apply(null,s);u in r?e.nextTick(function(){o.apply(null,r[u])}):u in i?i[u].push(o):(i[u]=[o],t.apply(null,s.concat([function(){r[u]=arguments;var e=i[u];delete i[u];for(var t=0,n=e.length;t<n;t++)e[t].apply(null,arguments)}])))};return s.memo=r,s.unmemoized=t,s},e.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},e.times=function(t,n,r){var i=[];for(var s=0;s<t;s++)i.push(s);return e.map(i,n,r)},e.timesSeries=function(t,n,r){var i=[];for(var s=0;s<t;s++)i.push(s);return e.mapSeries(i,n,r)},e.seq=function(){var t=arguments;return function(){var n=this,r=Array.prototype.slice.call(arguments),i=r.pop();e.reduce(t,r,function(e,t,r){t.apply(n,e.concat([function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);r(e,t)}]))},function(e,t){i.apply(n,[e].concat(t))})}},e.compose=function(){return e.seq.apply(null,Array.prototype.reverse.call(arguments))};var S=function(e,t){var n=function(){var n=this,r=Array.prototype.slice.call(arguments),i=r.pop();return e(t,function(e,t){e.apply(n,r.concat([t]))},i)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return n.apply(this,r)}return n};e.applyEach=c(S),e.applyEachSeries=p(S),e.forever=function(e,t){function n(r){if(r){if(t)return t(r);throw r}e(n)}n()},typeof module!="undefined"&&module.exports?module.exports=e:typeof define!="undefined"&&define.amd?define("vendor/async",[],function(){return e}):t.async=e}(),define("jSkype/utils/chat/cacheBase",["require","lodash-compat","jcafe-property-model","jSkype/settings","constants/common","vendor/async","utils/common/logTracer/api"],function(e){function u(e,u){function p(e){return!h[e.id]}function d(){return c().filter(p).length}function v(e){e.forEach(function(e){h[e.id]=!0})}var a=this,f,l=o.getLogger("Cache"),c=n.collection(),h={};a.size=c.size,a.log=function(){r.isFeatureOn(i.featureFlags.UNREAD_MSG_LOGGING)&&l.log.apply(l,arguments)},a.onNewItemsLoaded=function(){a.log("onNewItemsLoaded"),f=null},a.forAllItems=function(e){c().forEach(e)},a.clean=function(e){a.log("clean:",e),e?e.forEach(function(e){c.remove(e.id+"")}):c.empty()},a.getItems=function(e,t){if(!t)return c().filter(e);s.filter(c(),e,t)},a.getItem=function(e){return c(e+"")},a.getAllItems=function(){return c()},a.replaceItem=function(e,t){a.log("replaceItem:",e,t),t+="",c.remove(t),a.cacheItem(e,t)},a.cacheItem=function(e,t){if(typeof e.id=="undefined")throw new Error('Cached item has to have "id" property');a.log("Caching item:",e,t),c.add(e,t+""),a._cacheItem&&a._cacheItem(e,t)},a.hasMoreItems=function(){return d()>0||!!a._serverHasMoreItems},a.onItemAdded=function(e){h[e.id]=!0,a._onItemAddedOrUpdated(e)},a.onItemUpdated=function(e){a._onItemAddedOrUpdated(e)},a.onItemRemoved=function(e){a.log("onItemRemoved:",e),c.remove(e+""),a._onItemRemoved&&a._onItemRemoved(e)},a.get=function(t){var r=n.task(),i=a._getCachedItems(t);return i.length===0?(a.log("No items in cache, getting them from service:",t),f=f||a._getItemsFromService(t),f):(a.log("Returning items from cache:",i),r.resolve(i),a._serverHasMoreItems&&d()<e&&(a.log("Not enough items in cache, get more:",d(),a._serverHasMoreItems),f=f||a._getItemsFromService(t-i.length)),r.promise)},a.reset=function(e){a.log("resetting:",e),e&&a._emptyCache(),h={}},a._emptyCache=a.clean,a._obtain=function(){return f=f||a._getItemsFromService(0),f},a._getCachedItems=function(e){var t,n,r;return r=c().filter(p).sort(u),t=Math.max(0,r.length-e),n=r.slice(t),v(n),n},a._getNewUnconsumedItems=function(){var e,n,r;return t.isEmpty(h)?[]:(e=c().sort(u),n=[],r=!1,e.forEach(function(e){!r&&h[e.id]&&(r=!0),r&&!h[e.id]&&n.push(e)}),v(n),n)}}var t=e("lodash-compat"),n=e("jcafe-property-model"),r=e("jSkype/settings"),i=e("constants/common"),s=e("vendor/async"),o=e("utils/common/logTracer/api");return u}),define("jSkype/services/webapi/utils/sanitizer",["require","exports","module"],function(e,t){var n=["id","type","clientmessageid","ackrequired","imdisplayname","from","messagetype","conversationLink","originalarrivaltime","composetime","content","contenttype","contentformat","skypeeditedid","skypeeditoffset","skypeemoteoffset","skypeguid","skypeignore","properties","originalContent","personId","timestamp","contactRequestType","greeting","isOutgoing","pstnEventType","isGroup","participantName","participantEndpoint","pluginFreeMessageType"];t.message=function(e){for(var t in e)e.hasOwnProperty(t)&&n.indexOf(t)===-1&&delete e[t]},t.conversations=function(e){e.forEach(function(e){t.message(e.lastMessage)})}}),define("jSkype/utils/chat/messagesCache",["require","jcafe-property-model","utils/chat/sort","jSkype/utils/chat/cacheBase","jSkype/services/webapi/utils/sanitizer","jSkype/utils/chat/conversation","jSkype/utils/chat/message","jSkype/services/internalPubSub","constants/common","lodash-compat","jSkype/utils/chat/generator"],function(e){function d(e,d){function y(e){if(w(e)){e.isUnread=!1;return}e.isUnread=!o.isMessageReadOnServer(d._consumptionHorizon,e.key,e.id)}function b(e){return typeof e.isUnread=="undefined"&&y(e),e.isUnread}function w(e){return typeof e.isOutgoing=="undefined"&&(e.isOutgoing=o.isMessageOutgoing(e)),e.isOutgoing}function E(e){v.log("cacheMessages",e),e.forEach(function(e){v.log("caching and sanitizing message",e),i.message(e),e.key=s.getMessageKey(e),e.timestamp=e.timestamp||+(new Date(e.originalarrivaltime)),S(e),v.getItem(e.id)?(v.log("updating message",e),v.replaceItem(e,e.id)):(v.log("adding message",e),v.cacheItem(e,e.id),v.size()===1&&m&&C())}),x()}function S(e){if(e.contactRequestType||e.pstnEventType||e.pluginFreeMessageType)return;l.extendRawMessage(e,d)}function x(){var e,t=[],n=d.chatService._notificationKeywords&&d.chatService._notificationKeywords.length>0;e=T().filter(o.canMessageBeMarkedAsUnreadInUI),n&&(t=f.filter(e,function(e){return d.chatService.shouldNotify(e.content)})),v.log("updateUnreadActivityItemsCount",e),v.unreadActivityItemsCount._set(e.length-t.length),v._unreadActivityItemsWithKeywordsCount._set(t.length)}function T(){return v.getItems(function(e){return e.skypeeditedid?!1:b(e)&&!w(e)})}function N(){return v.size()>0&&!v.getOldestServerMessage()}function C(){function e(){m.promise.state()==="pending"?m.resolve(v.unreadActivityItemsCount()):m.promise.state()==="resolved"&&x()}function t(){var n=v.getOldestServerMessage(),r=n&&b(n),i=T().length<h;r&&i&&v._serverHasMoreItems?v._obtain().then(t):e()}function n(){var e=v.getAllItems();return e.forEach(function(e){if(!e.skypeeditedid)return!1}),e.length>0}v.log("getUnreadMessages"),x(),d._isAlive||T().length>0||n()?t():e()}function k(e){return e.contactRequestType}function L(){return m||(m=t.task(),C()),m.promise}function A(){return L().then(function(){return v._unreadActivityItemsWithKeywordsCount()})}function O(){v._serverHasMoreItems=!0}var v=this,m,g=a.events.system;r.call(v,c,n.byTimestamp),this._updateConversationLastMessage=function(e){if(d._lastMessageRefreshed)return;var t=d.historyService.activityItems();if(e.length>0&&t.length>0){var n=f.find(e,function(e){return e.id===t[0]._id});if(!n)return;d.historyService._processRawMessage(n,!1,!1,!0),d._lastMessageRefreshed=!0}},this._getItemsFromService=function(n){function s(e){v.log("received messages from server - error"),v.onNewItemsLoaded(),r.reject(e)}function o(e,t){v._updateConversationLastMessage(e),v.log("received messages from server",e,t),v.onNewItemsLoaded(),v._serverHasMoreItems=t,E(e),i=v._getCachedItems(n),v.log("Returning messages from server",i),r.resolve(i)}var r=t.task(),i;return N()?o([],!0):e.syncMessages(d,p,o,s),r.promise},this._onItemAddedOrUpdated=function(e){v.log("_onItemAddedOrUpdated"),E([e])},this._emptyCache=function(){v.log("_emptyCache");var e=v.getItems(function(e){return!k(e)});v.clean(e)},this._serverHasMoreItems=!0,u.get().subscribe(g.FORCE_RESYNC,O),this.unreadActivityItemsCount=t.property({readOnly:!0,value:0,get:L}),this._unreadActivityItemsWithKeywordsCount=t.property({readOnly:!0,value:0,get:A}),this.getOldestServerMessage=function(){var e=null;return v.forAllItems(function(t){if(k(t))return;if(!e||e.timestamp>t.timestamp)e=t}),e},this.onConsumptionHorizonChanged=function(){v.forAllItems(y),x()},this.getMostRecentEditForMessage=function(e){function r(e){return t.clientmessageid&&e.skypeeditedid===t.clientmessageid&&e.author===t.author}var t=v.getItem(e);return t?v.getItems(r).sort(n.byTimestampDescending)[0]||null:null}}var t=e("jcafe-property-model"),n=e("utils/chat/sort"),r=e("jSkype/utils/chat/cacheBase"),i=e("jSkype/services/webapi/utils/sanitizer"),s=e("jSkype/utils/chat/conversation"),o=e("jSkype/utils/chat/message"),u=e("jSkype/services/internalPubSub"),a=e("constants/common"),f=e("lodash-compat"),l=e("jSkype/utils/chat/generator"),c=10,h=50,p=h+1;return d.prototype=Object.create(r.prototype),d.prototype.constructor=d,d}),define("jSkype/utils/chat/editMessageHandler",["require","exports","module","jSkype/services/annotations/main"],function(e,t){function r(e){return!!e.html}function i(e,t,n){n.timestamp._set(t.timestamp()),e.replaceMessage(t,n)}function s(e,t){r(e)&&r(t)&&(e._actualId=t._id,e.isDeleted._set(t.isDeleted()),e.isEdited._set(t.isEdited()),n.updateMessageProperties(e,t),e.html._set(t.html()))}var n=e("jSkype/services/annotations/main");t.handleMessageEdit=function(e,t,n){n.type()!==t.type()?i(e,t,n):s(t,n)}}),define("jSkype/models/historyService",["require","jcafe-property-model","lodash-compat","constants/common","jSkype/services/webapi/constants","jSkype/utils/chat/message","jSkype/utils/chat/generator","jSkype/utils/chat/editMessageHandler","jSkype/settings","utils/common/logTracer/api","swx-enums","jSkype/services/annotations/main"],function(e){function p(e,p,d){function x(e){var t;y.unreadActivityItemsCount()===0&&!s.isMessageReadOnServer(d,e.key,e.id)&&!s.isMessageOutgoing(e)&&!s.doesMessageTypeSupportUnreadState(e)&&(t=b(e.key),t&&p.setConsumptionHorizonToMessage(d,t))}function T(e){try{b.add(e,e.key()+"")}catch(t){return!1}return!0}function N(e){var t=b(e+"");t&&b.remove(e+"")}function C(){var e=v.activityItems();for(var t=0;t<e.length-1;t++)N(e[t].key());y.reset(),v.getMoreActivityItems.enabled._set(!0)}function k(e){function i(){n.resolve(e)}function s(){r()===e?n.resolve(e):p.historyDisclosed(d.conversationId,e,i,n.reject.bind(n))}var n=t.task(),r=this;return w.promise.then(s,s),w=n,n.promise}function L(){return d._consumptionHorizon.lastReadMessageId===0&&d._consumptionHorizon.lastReadMessageTimestamp===0&&d._consumptionHorizon.modificationTime===0}function A(){h.log("historyService.markAllAsReadCommand:",d.conversationId);var e=v.activityItems().reverse()[0];if(!e)return;if(L()||!s.isMessageReadOnServer(d._consumptionHorizon,e.key(),e._id))h.log("historyService.setConsumptionToLastMessage:",d.conversationId),p.setConsumptionHorizonToMessage(d,e);b().forEach(function(e){e.isRead._set(!0)})}function O(){function e(){y.reset(),b.empty(),E.resolve()}return E?E.promise:(E=t.task(),E.promise.finally(function(){E=null}),p.removeAllMessages(d.conversationId,e,E.reject.bind(E)),E.promise)}function M(e,t,n){var r=v.activityItems.size(),i,s;H(n),i=v.activityItems.size()-r,s=e-i,s>0&&y.hasMoreItems()?D(s,t):t.resolve(),y.hasMoreItems()||v.getMoreActivityItems.enabled._set(!1)}function D(e,t){y.get(e).then(M.bind(v,e,t)).catch(t.reject.bind(t))}function P(e){var n=g;return n?n.promise:(n=g=t.task(),g.promise.finally(function(){g=null}),D(e,n),n.promise)}function H(e){n.forEach(e,function(e){X(e)})}function B(e,t){return e.timestamp()<t.timestamp()}function j(e){return e===l.activityType.ContactRequestOutgoing||e===l.activityType.ContactRequestOutgoingAgent}function F(e){if(j(e.type()))return;e.timestamp&&e.timestamp()>d.lastModificationTimestamp()&&(d.lastModificationTimestamp._set(e.timestamp()),v._lastMessageFromServer=e)}function I(e,t){v._removeMessage(e),T(t)}function q(e,t){var n=y.getMostRecentEditForMessage(e._id);n&&t.timestamp()>=n.timestamp&&u.handleMessageEdit({replaceMessage:I},e,t)}function R(e){var t=y.getMostRecentEditForMessage(e._id),n;t&&(n=o.activityFromRawMessage(t,d),u.handleMessageEdit({replaceMessage:I},e,n))}function U(e,t){var n=t.key(),s=c.getLastPersonFromProperty(t,i.MESSAGE_PROPERTIES.PER_USER.EMOTIONS,r.emotionTypes.HEART);v._messagesWithUnseenHearts(n)&&v._messagesWithUnseenHearts.remove(n);var o={id:n,timestamp:e,type:t.type,html:t.html,text:t.text,sender:t.sender,person:s,isDeleted:t.isDeleted};v._messagesWithUnseenHearts.add(o,n)}function z(e){var t=c.getMessagePropertyLastTimestamp(e,i.MESSAGE_PROPERTIES.PER_USER.EMOTIONS,r.emotionTypes.HEART),n=e.key(),s;W(e,d)?U(t,e):v._messagesWithUnseenHearts(n)&&(s=v._messagesWithUnseenHearts(n).timestamp,(!t||t<s)&&v._messagesWithUnseenHearts.remove(n))}function W(e,t){return c.isMessagePropertyUnseen(e,i.MESSAGE_PROPERTIES.PER_USER.EMOTIONS,r.emotionTypes.HEART,t._consumptionHorizon.modificationTime)}function X(e,t,n){function a(){function e(e){return e._isOriginal&&e._isOriginal()}function n(e){return e.isDeleted&&!!e.isDeleted()?!0:e.isEdited&&!!e.isEdited()?!0:!1}var s=e(i)&&e(r),o=!e(i)&&e(r),a=!n(r)&&n(i);if(r.type()!==i.type()){r.timestamp()-i.timestamp()>=0&&u.handleMessageEdit({replaceMessage:I},i,r);return}if(a){i._id=r._id,i.timestamp._set(r.timestamp()),N(i.key()),T(i);return}if(s&&!t){i._updateAllProperties(r);return}if(o&&!t){i._updateAllProperties(r);return}q(i,r)}var r,i;e.content=e.content||"";try{r=o.activityFromRawMessage(e,d)}catch(s){f.getLogger("failed-msgs").log("historyService.processMessage: failed to get activity item for message",e.id,d.conversationId,s.stack);return}i=b(r.key());if(i){if(r.sender!==i.sender)return;a(),z(i)}else if(!e.skypeeditedid){if(n===!0&&!t){z(r);return}T(r),R(r)}F(r)}var v=this,m=t.boolProperty(!0),g,y=new e(p,d),b=t.collection({subscribed:function(){},unsubscribed:C}),w=t.task(),E,S=t.boolProperty(!0);h||(a.isFeatureOn(r.featureFlags.UNREAD_MSG_LOGGING)?h=f.getLogger("unread-msgs"):h={log:function(){}}),w.resolve(),this.activityItems=b.sort(B),this.unreadActivityItemsCount=y.unreadActivityItemsCount,this._unreadActivityItemsWithKeywordsCount=y._unreadActivityItemsWithKeywordsCount,this.getMoreActivityItems=t.command(P,t.boolProperty(!0)),this.markAllAsRead=t.command(A,m),this.historyDisclosedCommandEnabled=t.property({value:!1}),this.isHistoryDisclosed=t.property({value:!1,set:t.command(k,v.historyDisclosedCommandEnabled)}),this.removeAll=t.command(O,S),this._messagesWithUnseenHearts=t.collection(),this._reset=function(){b.empty(),y.reset(!0),v.getMoreActivityItems.enabled._set(!0)},this._removeMessage=function(e){var t=e.key()+"";y.onItemRemoved(t),N(t)},this._addOutgoingMessage=function(e){return T(e)},this._processRawMessage=function(e,t,n,r){if(!e.id)return;y.getItem(e.id)?y.onItemUpdated(e):n||y.onItemAdded(e),X(e,t,n),!t&&!n&&!r&&x(e)},this._updateReadStatusFromServer=function(){y.onConsumptionHorizonChanged(),b().forEach(function(e){e.isRead._set(s.isMessageReadOnServer(d._consumptionHorizon,e.key(),e._id))})}}var t=e("jcafe-property-model"),n=e("lodash-compat"),r=e("constants/common"),i=e("jSkype/services/webapi/constants"),s=e("jSkype/utils/chat/message"),o=e("jSkype/utils/chat/generator"),u=e("jSkype/utils/chat/editMessageHandler"),a=e("jSkype/settings"),f=e("utils/common/logTracer/api"),l=e("swx-enums"),c=e("jSkype/services/annotations/main"),h;return p}),define("jSkype/models/file",["require","exports","module","jSkype/client","jcafe-property-model","constants/common","swx-enums","jSkype/settings","jSkype/utils/chat/generator","jSkype/services/asyncMedia/main","telemetry/chat/telemetryEnumerator","swx-i18n"],function(e,t){function c(e,t){function h(e){c.name._set(e.name),c.size._set(e.size),c.state._set(s.fileUploadState.Uploading)}var c=this;c._send=function(p){function y(){v.status._set(s.activityStatus.Succeeded),c.state._set(s.fileUploadState.Sent),d.resolve(),T(!0)}function b(e){v.status._set(s.activityStatus.Failed),c.state._set(s.fileUploadState.Failed),d.reject(e),T(!1,e)}function w(e,t){v.shouldAbort()&&t.abort(),e.lengthComputable&&(v.progress(e.loaded/e.total*100),c.progress._set(v.progress()))}function E(e){c.icon._set(e);if(p.isImage()){var t=e.match(/(.+)(\/.+\/.+)$/i)[1];v._uri=t,v.thumbnailUrl.get()}}function S(){function n(t){v=u.outgoingPictureActivityItem(e),e.historyService._addOutgoingMessage(v);if(t.size>i.fileTransfer.MAX_PHOTO_SIZE){b("Upload file size is too big");return}a.sendFile(e.conversationId,t,r,b,w,E)}function r(n){v.documentId._set(n),t.sendPhotoSharingMessage(e,v,n,c.name(),y,b)}return{send:n}}function x(){function n(t){var n=o.isFeatureOn(i.featureFlags.FILE_TRANSFER_ENABLED);if(!n){var s=l.fetch({key:"file_transfer_upload_not_supported"});v=u.outgoingTextMessageActivityItem({content:s},e),e.historyService._addOutgoingMessage(v),b("Feature is disabled");return}v=u.outgoingFileActivityItem(t,e),e.historyService._addOutgoingMessage(v);if(t.size>i.fileTransfer.MAX_FILE_SIZE){b("Upload file size is too big");return}a.sendFile(e.conversationId,t,r,b,w,E)}function r(n){v.documentId._set(n),t.sendFileTransferMessage(e,v,n,c.name(),c.size(),y,b)}return{send:n}}function T(e,t){var r=n.get()._telemetryManager,s=i.telemetry.chat.FILE_TRANSFER,u=c.name().match(/[0-9a-z]+$/i)[0].toLowerCase(),a={success:e,type:u,fileTypeGroup:f.getFileTypeGroup(u),size:c.size()};t&&(a.reason=t),r.sendEvent(o.settings.telemetry.jSkypeTenantToken,s,a)}p.isImage=function(){var e=["image/png","image/x-png","image/jpeg"];return e.some(function(e){return p.type&&p.type===e})};var d=r.task(),v,m=p.isImage(),g=m?S():x();return h(p),g.send(p),d.promise},c.name=r.property({readOnly:!0}),c.size=r.property({readOnly:!0,value:0}),c.icon=r.property({readOnly:!0}),c.progress=r.property({readOnly:!0,value:0}),c.state=r.property({readOnly:!0}),c.cancel=r.disabledCommand(),c.pause=r.disabledCommand(),c.resume=r.disabledCommand()}var n=e("jSkype/client"),r=e("jcafe-property-model"),i=e("constants/common"),s=e("swx-enums"),o=e("jSkype/settings"),u=e("jSkype/utils/chat/generator"),a=e("jSkype/services/asyncMedia/main"),f=e("telemetry/chat/telemetryEnumerator"),l=e("swx-i18n").localization;t.build=function(e,t){return new c(e,t)}}),define("jSkype/models/fileTransferService",["require","exports","module","jcafe-property-model","jSkype/models/file","jSkype/services/asyncMedia/main"],function(e,t){function s(e,t){function o(i){var o,u=[];return Array.prototype.forEach.call(i,function(n){o=r.build(e,t),u.push(o._send(n)),s.files.add(o)}),n.task.waitAll(u)}function u(e){var t=n.task();return i.deleteFile(e,t.resolve.bind(t),t.reject.bind(t)),t.promise}var s=this;s.files=n.collection(),s.send=n.command(o,e.activeModalities.chat),s.remove=n.command(u,e.activeModalities.chat)}var n=e("jcafe-property-model"),r=e("jSkype/models/file"),i=e("jSkype/services/asyncMedia/main");t.build=function(e,t){return new s(e,t)}}),define("jSkype/services/spaces",["require","exports","module","jSkype/client","swx-enums","jcafe-property-model","services/ecs/configLoader","reqwest","jSkype/settings"],function(e,t){var n=e("jSkype/client"),r=e("swx-enums"),i=e("jcafe-property-model"),s=e("services/ecs/configLoader"),o=e("reqwest"),u=e("jSkype/settings"),a=null;t.fetchConfig=function(){return a||(a=s.loadConfig(r.ecsClientNames.Skype,u.settings.ecsSpacesKey)),a},t.getSpacesData=function(e){function u(t,n){var i="https://"+n.UrlGeneratorService.Host;n.UrlGeneratorService.Port!==443&&(i+=":"+n.UrlGeneratorService.Port),i+=n.UrlGeneratorService.Endpoints.Threads,r={method:"post",url:i,dataType:"json",contentType:"application/json",headers:{"X-Skypetoken":t},data:JSON.stringify({baseDomain:n.WebLauncher.BaseUrl,threadId:e}),crossOrigin:!0},o.compat(r).then(s.resolve.bind(s),s.reject.bind(s))}function a(){s.reject(new Error("Loading of ecs configuration for spaces failed"))}var r,s=i.task();return n.get().signInManager._skypeToken().then(function(e){t.fetchConfig().then(u.bind(null,e),a)}),s.promise}}),define("jSkype/modelHelpers/calling/pstnEventsHandler",["require","exports","module","swx-enums","lodash-compat"],function(e,t){function i(e){function o(){s&&s.dispose(),t&&(t.participants().forEach(l),t.selfParticipant.audio.state.changed.off(u)),i={},t=null}function u(e){e===n.callConnectionState.Disconnected?(s&&s.dispose(),t.participants().forEach(l)):e===n.callConnectionState.Connecting&&(s=t.participants.observe(a),t.participants().forEach(f))}function a(e,t){r.forIn(e,function(e){f(e)}),r.forIn(t,function(e){l(e)})}function f(n){function s(r){var i=n.audio.state.reason;e.process(t,n,i,r)}if(!c(n.audio.endpoint()))return;var r=n.person.id();if(r in i)return;i[r]=s,n.audio.state.changed(s)}function l(e){var t,n;n=e.person.id(),n in i&&(t=i[n],e.audio.state.changed.off(t),delete i[n])}function c(e){return/^(\+)?\d+$/.test(e)}var t,i={},s;this.subscribeToConversation=function(e){o(),t=e,t.selfParticipant.audio.state.changed(u)},this.dispose=o}var n=e("swx-enums"),r=e("lodash-compat");t.build=function(e){return new i(e)}}),define("jSkype/modelHelpers/calling/pstnMessageFactory",["require","exports","module","swx-enums","utils/chat/dateTime"],function(e,t){function i(e,t,n){var i=r.getDate();return{id:+i,timestamp:i,pstnEventType:e,isGroup:t,participantName:n.person.displayName(),participantEndpoint:n.audio.endpoint(),isOutgoing:!0}}var n=e("swx-enums").activityType,r=e("utils/chat/dateTime");t.getInsuficientFundsMessage=function(e,t){return i(n.PstnInsufficientFunds,e,t)},t.getInvalidNumberMessage=function(e,t){return i(n.PstnInvalidNumber,e,t)},t.getForbiddenNumberMessage=function(e,t){return i(n.PstnForbiddenNumber,e,t)}}),define("jSkype/modelHelpers/calling/pstnActivityItemAdder",["require","swx-enums","jSkype/modelHelpers/calling/pstnMessageFactory"],function(e){function r(){function e(e,r,i){var s;switch(i){case t.callDisconnectionReason.InsufficientFunds:s=n.getInsuficientFundsMessage(e.isGroupConversation(),r);break;case t.callDisconnectionReason.InvalidNumber:s=n.getInvalidNumberMessage(e.isGroupConversation(),r);break;case t.callDisconnectionReason.EmergencyCallDenied:case t.callDisconnectionReason.ForbiddenNumber:case t.callDisconnectionReason.Refused:s=n.getForbiddenNumberMessage(e.isGroupConversation(),r)}s&&e.historyService._processRawMessage(s)}function r(e){return e.participants.size()===1&&i(e.participants()[0].audio.endpoint())}function i(e){return/^(\+)?\d+$/.test(e)}this.process=function(t,n,i){t.isGroupConversation()?e(t,n,i):r(t)&&e(t,n,i)}}var t=e("swx-enums"),n=e("jSkype/modelHelpers/calling/pstnMessageFactory");return r}),define("jSkype/models/conversation",["require","jSkype/client","browser/window","constants/common","jcafe-property-model","jSkype/modelHelpers/propertyModelHelper","jSkype/modelHelpers/propertyValidator","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/modelHelpers/personHelper","jSkype/utils/chat/parser","jSkype/modelHelpers/calling/callData","jSkype/models/capabilities","jSkype/models/participant","jSkype/models/chatService","jSkype/models/audioService","jSkype/services/calling/autoCalling","jSkype/models/videoService","jSkype/models/screenSharingService","jSkype/utils/chat/messagesCache","jSkype/models/historyService","jSkype/models/fileTransferService","jSkype/services/spaces","jSkype/utils/chat/conversation","jSkype/constants/people","jSkype/settings","swx-enums","jSkype/modelHelpers/calling/pstnEventsHandler","jSkype/modelHelpers/calling/pstnActivityItemAdder","jSkype/utils/chat/generator"],function(e){function D(e,D,P){function it(e){var t={};if(!e)return;var n=!1;e.forEach(function(e){var r=f.getTypeFromKey(e.id),i=f.getId(e.id);e.contactType||(e.contactType=r),e.id=i,t[e.id]=e;var s=e.linkedMri&&e.linkedMri.indexOf(I.id())>0;n=n||e.id===I.id()||s}),st(n),B.each(function(e){t[e.id]||zt(e.id)}),_t(t,function(e){var n=t[e].role.toLowerCase(),r=t[e].contactType;Xt(e,M[n],null,r)})}function st(e){if(e===$)return;$=e,rt&&H._isFavorited()&&!$&&H._isFavorited(!1),mt(),gt()}function ot(t){if(t.length===0)return;return e.setTopic(H.conversationId,t),t}function ut(e){var t=e.threadProperties&&e.threadProperties[_.JOINING_ENABLED];t&&H.isJoiningEnabled._set(t.toLowerCase()==="true")}function at(e){e.threadProperties&&e.threadProperties.autoCallingPayload&&H._autoCallingService.setupMeeting(H,e.threadProperties.autoCallingPayload)}function ft(e){var t=e.threadProperties&&e.threadProperties[_.HISTORY_DISCLOSED],n;t&&(n=t.toLowerCase()==="true",n&&H.historyService.getMoreActivityItems.enabled._set(!0),H.historyService.isHistoryDisclosed._set(n))}function lt(e){var t=e.threadProperties&&e.threadProperties[_.PICTURE];if(!t)return;var n=/^(URL@.*\.com)\//,r=t&&t.match(n);r&&(t=t.replace(r[1],N.settings.amdServiceHost),H.avatarUrl(t))}function ct(e){var t=null;return e.length!==tt&&(t=e.slice(0,4).map(function(e){return f.getId(e.id)}).join(i)),t}function ht(e){var t;e.threadProperties&&e.threadProperties.topic&&e.threadProperties.topic!==" "?t=e.threadProperties.topic:e.members&&(t=ct(e.members)),tt=e.members&&e.members.length||tt;if(!t)return;if(t===I.id()){H.topic._set("");return}var n=t.split(i),r,s=[];vt();for(var o=0;o<n.length;o++){r=n[o];if(r===I.id()||r==="...")continue;if(!pt(r)){tt=null,H.topic._set(l.parseTopic(t));return}s.push(r)}s.forEach(dt)}function pt(e){return!!B(e)}function dt(e){var t=a.getPerson(e);j.push({subscription:t.displayName.changed(Wt),person:t})}function vt(){j.forEach(function(e){e.subscription.dispose()}),j=[]}function mt(){var t=e.isOnline()&&$&&!bt()&&!yt();H.activeModalities.chat._set(t)}function gt(){H.audioService._membershipChanged($),H.videoService._membershipChanged($)}function yt(){return P==="8:echo123"}function bt(){var e=H.participants(0);return e&&e.person.isBlocked()}function wt(t){function i(){n.resolve(t)}function o(){r()===t?n.resolve(t):e.joiningEnabled(H.conversationId,t,i,n.reject.bind(n))}var n=s.task(),r=this;return G.promise.then(o,o),G=n,n.promise}function Et(t){function i(){n.resolve(t)}function o(){n.reject()}function u(){r()===t||!rt?n.resolve(t):e.setFavorites(H.conversationId).then(i,o)}var n=s.task(),r=this;return Y.promise.then(u,u),Y=n,n.promise}function St(e){e.threadProperties&&e.threadProperties.joinURL&&H.uri._set(e.threadProperties.joinURL)}function xt(e){V.promise.state()==="pending"&&V.resolve(e.JoinUrl)}function Tt(){return V||(V=s.task(),H.uri()?V.resolve(H.uri()):H.isJoiningEnabled.once(!0,function(){S.getSpacesData(H.conversationId).then(xt,V.reject.bind(V))})),V.promise}function Nt(){function r(e){st(!0),H.selfParticipant.role._set(n),t.reject(e)}var t=s.task(),n=H.selfParticipant.role();return rt&&H._isFavorited()&&H._isFavorited(!1),H.selfParticipant.role._set(C.participantRole.Attendee),st(!1),e.removeParticipant(H.conversationId,H.selfParticipant.person.id(),t.resolve.bind(t),r),nt.dispose(),nt=null,t.promise}function Ct(t){var n=s.task();return e.sendPollMessage(H,t,n.resolve.bind(n),n.reject.bind(n)),n.promise}function kt(t){var n=s.task(),r=A.outgoingContactInfoActivityItem(t,H);return e.sendContactInfoMessage(H,r,t,n.resolve.bind(n),n.reject.bind(n)),n.promise}function At(e){Lt.push(e),n.clearTimeout(At.asyncRef),At.asyncRef=n.setTimeout(function(){H._callHandler.extendCall(Lt),Lt=[]},0)}function Ot(t){function i(e){zt(r),n.reject(e)}var n,r=t.person.id();if(H.selfParticipant.audio.state()===C.callConnectionState.Connected)return At(r),!0;n=s.task();if(!Ht(t)){n.reject();return}return It({id:r,role:t.role()}),H.conversationId&&e.addParticipant(H.conversationId,r,C.participantRole.Attendee,n.resolve.bind(n),i),n.promise}function Mt(t){function i(e){Q.add(t,r),It({id:r,role:t.role()}),n.reject(e)}var n=s.task(),r=t.person.id();if(!pt(r)){n.reject();return}return zt(r),e.removeParticipant(H.conversationId,t.person.id(),n.resolve.bind(n),i),n.promise}function _t(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n)}function Dt(){H._isAlive=!0,B.each(function(e){Q(e.id)||Ht(Ft(e.id,e.type))})}function Pt(){H._isAlive=!1,Q.empty()}function Ht(e){var t=B(e.person.id());try{t&&e.role._set(t.role),Q.add(e,e.person.id())}catch(n){return!1}return!0}function Bt(){return H._isAlive||!D}function jt(e,t){var n=f.getId(e);return a.getPerson(n,t)}function Ft(e,t){var n=jt(e,t);return H.createParticipant(n)}function It(e){var t=e.id;pt(t)===!1?B.add(e,t):B(t).role=e.role,$t()}function qt(e){pt(e)&&B.remove(e),$t()}function Rt(){}function Ut(e){return q.remove(e)}function zt(e){qt(e),Bt()&&Q.remove(e)}function Wt(){if(F)return;F=!0,setTimeout(function(){var e=j.map(function(e){return e.person.displayName()});H.topic._set(l.parseTopic(e.join(i))),F=!1},0)}function Xt(e,t,n,r){var i,s,o;return t=t||C.participantRole.Attendee,e===I.id()?(st(!0),H.selfParticipant.role._set(t),o=!0):pt(e)?(i=Q(e),s=B(e),s.role!==t&&(It({id:e,role:t,type:r}),i.role._set(t)),o=!1):(It({id:e,role:t,type:r}),Bt()&&(n=n||jt(e,r),i=H.createParticipant(n),o=Ht(i))),mt(),D||(H.participants(0).person._authorization.changed(Jt),H.participants(0).person.isBlocked.changed(Yt)),o}function Vt(){var e=!1;return B.each(function(t){!e&&u.isPhoneNumber(t.id)&&(e=!0)}),e}function $t(){H.audioService._setPSTNParticipants(Vt()),H.videoService._setPSTNParticipants(Vt())}function Jt(){var e=H.isJoiningEnabled(),t=H.activeModalities.chat()&&!H.selfParticipant.isAnonymous()&&!yt();if(!D){var n=H.participants(0)&&H.participants(0).person._authorization()===T.AUTHORIZED;J(t&&n||e)}else J((t||e)&&$)}function Kt(){var e=H.selfParticipant.role()===C.participantRole.Leader;K(e&&H.activeModalities.chat()&&!H.selfParticipant.isAnonymous())}function Qt(){W(!H.selfParticipant.isAnonymous()&&$&&rt)}function Gt(){Z(H._topicSetEnabled()&&H.selfParticipant&&!H.selfParticipant.isAnonymous())}function Yt(){D||mt()}function Zt(){var e=H.activeModalities.chat(),t=N.isFeatureOn(r.featureFlags.SEND_CONTACT_CARD_ENABLED);X(e&&t)}function en(){var e=H.activeModalities.chat(),t=N.isFeatureOn(r.featureFlags.POLLS_ENABLED);z(D&&e&&t)}var H=this,B=s.collection(),j=[],F=!1,I=t.get().personsAndGroupsManager.mePerson,q=s.collection(),R=s.property({value:!1}),U=s.property({value:D}),z=s.property({value:!1}),W=s.property({value:!1}),X=s.boolProperty(!1),V,$=!0,J=s.property({value:!1}),K=s.property({value:!1}),Q=s.collection(D?{subscribed:Dt,unsubscribed:Pt}:null),G=s.task().resolve(),Y=s.task().resolve(),Z=s.boolProperty(!1),et=s.command(ot,Z),tt,nt,rt=N.isFeatureOn(r.featureFlags.FAVORITES_CONVERSATION_ENABLED);this._isAlive=!1,this.avatarUrl=s.property({value:O}),this.topic=s.property({set:et,value:""}),this.isGroupConversation=s.property({readOnly:!0,value:D}),this.spawnedConversation=s.property({readOnly:!0}),this.conversationId=P,this.uri=s.property({readOnly:!0,get:Tt}),this.participantsCount=B.size,this._topicSetEnabled=s.boolProperty(!1),rt&&(this._isFavorited=s.property({value:!1,set:s.command(Et,W)})),this.autoCall=s.boolProperty(!1),this.activeModalities=new h,this.selfParticipant=new p(I,this,e),P&&(this._topicSetEnabled(!0),Gt()),this.lastModificationTimestamp=s.property({readOnly:!0,value:null}),this.isJoiningEnabled=s.property({value:!1,set:s.command(wt,R)}),this.pendingInvitations=q.asWritable({add:s.command(Rt,s.boolProperty(!0)),remove:s.command(Ut,this.activeModalities.chat)}),this.participants=Q.asWritable({add:s.command(Ot,J),remove:s.command(Mt,K)}),this.historyService=new w(b,e,this),this.audioService=v.build(this),this._autoCallingService=m.build(this),this.videoService=g.build(this),this.screenSharingService=y.build(this),this.chatService=new d(e,this),this.fileTransferService=E.build(this,e),this.mediaConnectionType=s.property({value:C.mediaConnectionType.Unknown}),this.leave=s.command(Nt,U),this.sendPollMessage=s.command(Ct,z),this.sendContactInfo=s.command(kt,X),this.acknowledge=s.enabledCommand(function(){return o.createResolvedPromise()}),this.createParticipant=function(t){return new p(t,this,e)},this.createInvitation=function(){return null},this.activeModalities.chat.changed(function(e){Jt(),Kt(),Gt(),U(D&&e),Zt(),en(),Qt()}),this.selfParticipant.role.changed(function(e){var t=e===C.participantRole.Leader;Kt(),Gt(),R(t),H.historyService.historyDisclosedCommandEnabled(t)}),Q.removed(function(e){e.person._authorization.changed.off(Jt),e.person.isBlocked.changed.off(Yt),e._dispose()}),this._onlineStateChanged=function(){mt(),H.audioService.start.enabled._set(e.isOnline())},this._properties={},this._consumptionHorizon={lastReadMessageTimestamp:0,modificationTime:0,lastReadMessageId:0},this._setCallHandler=function(e){this._callHandler=e},this._callData=c.build(),this._addParticipant=function(e,t){return Xt(e.id(),t,e)},this._updateConsumptionHorizon=function(e){if(!e)return;var t=x.parseConsumptionHorizon(e),n=!H._consumptionHorizon||H._consumptionHorizon.modificationTime<t.modificationTime;n&&(H._consumptionHorizon=t,H.historyService._updateReadStatusFromServer())},this._updateConsumptionHorizonModificationTime=function(){if(!H._consumptionHorizon||!H.conversationId)return;H._consumptionHorizon.modificationTime=(new Date).getTime(),e.setConsumptionHorizon(H)},this._update=function(e){H._updateConversationProperties(e),D&&this._updateThreadProperties(e)},this._notificationsEnabled=s.boolProperty(!0),this._updateConversationProperties=function(e){H._updateConsumptionHorizon(e.properties.consumptionhorizon),H.chatService._setNotificationSettings(e.properties.alerts,e.properties.alertmatches),e.lastMessage&&H.historyService._processRawMessage(e.lastMessage,!0)},this._updateThreadProperties=function(e){it(e.members),ht(e),ut(e),at(e),ft(e),lt(e),St(e)},this._setCanJoinCall=function(e,t,n){H._callPayload=n,H._callHostId=t,H.activeModalities.audio._set(e),H.activeModalities.video._set(e)},this._setCanJoinNGCCall=function(e,t,n,r){H.activeModalities.audio._set(e),H.activeModalities.video._set(e),H._ngcJoinUrl=n,H._ngcCorrelationId=r,H._callHostId=t,H._callPayload={}},nt=k.build(new L),nt.subscribeToConversation(H);var Lt=[]}var t=e("jSkype/client"),n=e("browser/window"),r=e("constants/common"),i=r.conversation.TOPIC_DELIMITER,s=e("jcafe-property-model"),o=e("jSkype/modelHelpers/propertyModelHelper"),u=e("jSkype/modelHelpers/propertyValidator"),a=e("jSkype/modelHelpers/personsAndGroupsHelper"),f=e("jSkype/modelHelpers/personHelper"),l=e("jSkype/utils/chat/parser"),c=e("jSkype/modelHelpers/calling/callData"),h=e("jSkype/models/capabilities"),p=e("jSkype/models/participant"),d=e("jSkype/models/chatService"),v=e("jSkype/models/audioService"),m=e("jSkype/services/calling/autoCalling"),g=e("jSkype/models/videoService"),y=e("jSkype/models/screenSharingService"),b=e("jSkype/utils/chat/messagesCache"),w=e("jSkype/models/historyService"),E=e("jSkype/models/fileTransferService"),S=e("jSkype/services/spaces"),x=e("jSkype/utils/chat/conversation"),T=e("jSkype/constants/people").authorizationStates,N=e("jSkype/settings"),C=e("swx-enums"),k=e("jSkype/modelHelpers/calling/pstnEventsHandler"),L=e("jSkype/modelHelpers/calling/pstnActivityItemAdder"),A=e("jSkype/utils/chat/generator"),O=null,M={admin:C.participantRole.Leader,user:C.participantRole.Attendee},_={PICTURE:"picture",AUTOCALLING:"autoCalling",JOINING_ENABLED:"joiningenabled",HISTORY_DISCLOSED:"historydisclosed"};return D}),define("jSkype/models/searchResult",[],function(){function e(e){this.matches={},this.relevance=0,this.result=e}return e}),define("jSkype/models/conversationsSearchQuery",["require","jSkype/client","jcafe-property-model","jSkype/models/searchQuery","jSkype/models/searchResult","lodash-compat","jSkype/modelHelpers/propertyValidator","jSkype/modelHelpers/personHelper"],function(e){function a(e){function l(e,n){var r,i=n.trim().split(" "),s=t.get().personsAndGroupsManager.mePerson.id(),o=!e.members||e.members.length===0;return i.indexOf(s)<0&&i.push(s),o||e.members.length!==i.length?!1:(r=e.members.filter(function(e){return i.indexOf(u.getId(e.id))>-1}),r.length===e.members.length)}function c(e,t){if(!e.threadProperties)return!1;var n,r,i=t.split(" ");for(n=i.length-1;n>=0;n--){var s=new RegExp("\\b"+i[n],"i");r=s.test(e.threadProperties.topic);if(!r)break}return r?!0:!1}function h(e,t){return o.isGroupConversation(e.id)===t}function p(){function o(e){var t=d(e);if(!t)return;s=s.filter(function(e){return v(e,t)})}function u(){s=e.getAllItems(),Object.keys(a.keywords).forEach(o),s.map(function(e){var n=new i(t.get().conversationsManager._getOrCreateConversation(e.id));a.results._add(n)}),r.resolve()}var r=n.task(),s;return e._syncAllConversations.enabled()?e._syncAllConversations().then(u):u(),r.promise}function d(e){var t;t=f.filter(function(t){return t.key===e});if(t.length===0)return;return t[0]}function v(e,t){var n=a.keywords[t.key];return typeof n!="undefined"?t.call(e,n):!1}var a=this,f=[{key:"group",call:h},{key:"topic",call:c},{key:"participantsByIds",call:l}];s.merge(this,new r),f.forEach(function(e){a.supportedKeywords._add(e.key)}),a.getMore=n.command(p,a.moreResultsAvailable)}var t=e("jSkype/client"),n=e("jcafe-property-model"),r=e("jSkype/models/searchQuery"),i=e("jSkype/models/searchResult"),s=e("lodash-compat"),o=e("jSkype/modelHelpers/propertyValidator"),u=e("jSkype/modelHelpers/personHelper");return a}),define("jSkype/services/webapiMapper/conversationLiveStateHandler",["require","exports","module","lodash-compat","browser/window","jSkype/client","jSkype/settings","constants/common","browser/detect","jSkype/utils/chat/parser","utils/common/logTracer/api"],function(e,t){function b(e){g.hasOwnProperty(e.conversationId)&&(r.clearTimeout(g[e.conversationId]),e._setCanJoinNGCCall(!1))}function w(e){try{return JSON.parse(e)}catch(t){return null}}function E(e){return e.filter(function(e){return v.indexOf(e.VoiceStatus)!==-1})}function S(e){return n.isArray(e.Participants)?E(e.Participants).length>0:!1}function x(e,t,n,r){var i=w(t);if(u.getBrowserInfo().browserName===u.BROWSERS.SKYPE_SHELL)return;if(i){if(i.AccessToken===m)return;r._setCanJoinCall(S(i),n,i),T(e,r),y.log("Enabling P2P black bar")}else y.error("Unable to enable P2P black bar, wrong/missing payload")}function T(e,t){r.clearTimeout(g[t.conversationId]),g[t.conversationId]=r.setTimeout(N.bind(null,t),e)}function N(e){if(u.getBrowserInfo().browserName===u.BROWSERS.SKYPE_SHELL)return;r.clearTimeout(g[e.conversationId]),e._setCanJoinCall(!1),y.log("Disabling P2P black bar")}var n=e("lodash-compat"),r=e("browser/window"),i=e("jSkype/client"),s=e("jSkype/settings"),o=e("constants/common"),u=e("browser/detect"),a=e("jSkype/utils/chat/parser"),f=e("utils/common/logTracer/api"),l="2",c="1",h=1e3,p=/1\/([12])\s([^ ]*)\s([01])(\s(\d*)\s(\{(.|[\r\n])*\}))?/,d={PARSING_ERROR:"Could not properly parse LiveState message !",WRONG_VERSION:"Could not properly parse LiveState message - wrong version. We need JSON payload version !",WRONG_PAYLOAD:"Could not properly parse LiveState payload !",WRONG_PARTICIPANTS_FORMAT:"Participants were not provided so live state could not be obtained !"},v=[4,6,7,8],m="NgAccessToken",g={},y=f.getLogger("P2PBlackBar");t.updateCallState=function(e,t){var n=e.match(p),r,s;if(!n)return;y.log("P2P Live state update",{content:e});var o=n[1],u=n[2],f=n[3],d=n[5]*h,v=n[6];if(o!==l)return;r=a.getConversationIdFromUrl(t),s=i.get().conversationsManager._getConversation(r);if(!s){y.warn("Unable to find conversation");return}f===c?x(d,v,u,s):N(s)},t.updateNGCCallState=function(e,t){var n=null,a=null,l,c,h=null,p=null,d=f.getLogger("NGCBlackBar"),v;if(!s.isFeatureOn(o.featureFlags.GVC_JOINING)){d.log("conversationLiveStateHandler:updateNGCCallState: GVC Joining not supported");return}if(!s.isFeatureOn(o.featureFlags.NG_CALLING)){d.log("conversationLiveStateHandler:updateNGCCallState: NGC caling not supported");return}if(u.getBrowserInfo().browserName===u.BROWSERS.SKYPE_SHELL)return;if(!t){d.log("conversationLiveStateHandler:updateNGCCallState: GVC Joining is supported but no awareness_conversationLiveState");return}l=e,c=i.get().conversationsManager._getConversation(l);if(!c){d.error("conversationLiveStateHandler::updateNGCCallState: no conversation found with id = "+l);return}if(!t.awareness_conversationLiveState||t.awareness_conversationLiveState==="null"){b(c);return}try{v=JSON.parse(t.awareness_conversationLiveState),n=v.conversationUrl,a=v.conversationId,h=v.groupCallInitiator,p=v.expiration}catch(m){d.error(m);return}if(n&&a){r.clearTimeout(g[c.conversationId]);var y=p*1e3-(new Date).getTime();d.log("conversationLiveStateHandler::updateNGCCallState: setting timeout for : "+y+" ms"),y>0&&(c._setCanJoinNGCCall(!0,h,n,a),g[c.conversationId]=r.setTimeout(b.bind(null,c),y))}else b(c)}}),define("jSkype/services/webapiMapper/conversationDataFilter",["require","exports","module","constants/common","jSkype/utils/chat/conversation","jSkype/settings","constants/common","jSkype/services/webapiMapper/conversationLiveStateHandler","jSkype/utils/chat/parser"],function(e,t){function l(e){var t=u.getConversationIdFromUrl(e.resource.conversationLink);return r.isMeConversation(t)}function c(e){function n(e){t&&o.updateCallState(e.resource.content,e.resource.conversationLink)}function r(t){var n=e["handle"+t.resourceType];n&&n.call(e,t)}function u(e){e.type==="EventMessage"&&e.resourceType==="ThreadUpdate"&&e.resource.type==="Thread"&&o.updateNGCCallState(e.resource.id,e.resource.properties),r(e)}var t=i.isFeatureOn(s.featureFlags.GVC_JOINING);this.eventMessages=function(t){var r,i,s;for(r=0;r<t.length;r++){i=t[r],s=i.resource.messagetype;if(l(i))return;a.indexOf(s)>-1?e.handleTypingControl(i):s===f?n(i):u(i)}}}var n=e("constants/common").isTyping,r=e("jSkype/utils/chat/conversation"),i=e("jSkype/settings"),s=e("constants/common"),o=e("jSkype/services/webapiMapper/conversationLiveStateHandler"),u=e("jSkype/utils/chat/parser"),a=[n.MESSAGE_TYPE.SET_TYPING,n.MESSAGE_TYPE.CLEAR_TYPING],f="Control/LiveState";t.build=function(e){return new c(e)}}),define("jSkype/services/webapiMapper/conversationDataHandlers",["require","exports","module","constants/common","lodash-compat","jSkype/client","jSkype/settings","jSkype/modelHelpers/personHelper","jSkype/services/webapi/utils/sanitizer","jSkype/utils/chat/parser","jSkype/utils/chat/conversation"],function(e,t){function c(e,t){function h(e){var t={id:e.id,lastMessage:{},properties:{},threadProperties:{version:e.version},members:e.members};for(var n in e.properties)e.properties.hasOwnProperty(n)&&(t.threadProperties[n]=e.properties[n]);return t}var c=this;this.handleNewMessage=function(r){var o=r.resource,l=a.getConversationIdFromUrl(o.conversationLink),c=i.get()._telemetry.messagesCollector;if(f.isPstnConversation(l)&&!s.isFeatureOn(n.featureFlags.PSTN_ENABLED))return;u.message(o),t._handleNewMessage(l,o),c.enqueueReceivedMessageInfo(o),["ThreadActivity/AddMember","ThreadActivity/DeleteMember"].indexOf(o.messagetype)!==-1&&e.syncThread(l)},this.handleMessageUpdate=function(e){var n=e.resource,r=a.getConversationIdFromUrl(n.conversationLink);if(f.isPstnConversation(r))return;u.message(n),t._handleUpdatedMessage(r,n)},this.handleConversationUpdate=function(e){function n(){var t=e.resource.properties.clearedat;if(!t)return!1;var n=new Date(parseInt(t)),i=new Date-n;return i>=0&&i<1e4&&r.isEmpty(e.resource.lastMessage)?!0:!1}if(n()){var i=t._getConversation(e.resource.id);if(i){t.conversations.remove(i);return}}u.conversations([e.resource]),t._conversationPropertiesUpdated(e.resource)},this.handleThreadUpdate=function(e){c.handleThreadSync(e.resource)},this.handleThreadSync=function(e){var n;n=h(e),t._threadPropertiesUpdated(n)},this.handleTypingControl=function(e){var n=a.getConversationIdFromUrl(e.resource.conversationLink),r=a.getConversationIdFromUrl(e.resource.from),i=r?o.getId(r):"",s=e.resource.messagetype===l.MESSAGE_TYPE.SET_TYPING,u=t._getConversation(n);if(!u||!i)return;var f=u.participants(i);f&&f.chat._setIsTyping(s)},this.handleReadReceipt=function(e){var n=e.resource.conversationId,r=t._getConversation(n);if(!r||r.isGroupConversation())return;r.participants(0).lastReadTimestamp._set(e.resource.readReceipt)}}var n=e("constants/common"),r=e("lodash-compat"),i=e("jSkype/client"),s=e("jSkype/settings"),o=e("jSkype/modelHelpers/personHelper"),u=e("jSkype/services/webapi/utils/sanitizer"),a=e("jSkype/utils/chat/parser"),f=e("jSkype/utils/chat/conversation"),l=n.isTyping;t.build=function(e,t){return new c(e,t)}}),define("jSkype/services/webapiMapper/conversationApiHandler",["require","lodash-compat","swx-i18n","constants/common","swx-enums","jSkype/client","jcafe-property-model","jSkype/models/conversationActivityItem","jSkype/modelHelpers/personHelper","jSkype/modelHelpers/propertyValidator","jSkype/services/internalPubSub","jSkype/services/serviceAccessLayer/serviceLocator","services/serviceLocator","jSkype/services/webapi/main","jSkype/services/webapi/utils/conversationMetadataStore","jSkype/services/systemCommands/main","jSkype/services/webapiMapper/conversationDataFilter","jSkype/services/webapiMapper/conversationDataHandlers","jSkype/services/webapiMapper/conversationLiveStateHandler","jSkype/settings","jSkype/telemetry/poll","jSkype/utils/chat/conversation","jSkype/utils/chat/message","jSkype/utils/chat/generator","utils/chat/dateTime","utils/chat/messageSanitizer","utils/common/async","swx-utils-common","telemetry/chat/messageSent","utils/common/logTracer/api"],function(e){var t=e("lodash-compat"),n=e("swx-i18n").localization,r=e("constants/common"),i=e("swx-enums"),s=e("jSkype/client"),o=e("jcafe-property-model"),u=e("jSkype/models/conversationActivityItem").ContactRequestActivityItem,a=e("jSkype/modelHelpers/personHelper"),f=e("jSkype/modelHelpers/propertyValidator"),l=e("jSkype/services/internalPubSub"),c=e("jSkype/services/serviceAccessLayer/serviceLocator"),h=e("services/serviceLocator"),p=e("jSkype/services/webapi/main"),d=e("jSkype/services/webapi/utils/conversationMetadataStore"),v=e("jSkype/services/systemCommands/main"),m=e("jSkype/services/webapiMapper/conversationDataFilter"),g=e("jSkype/services/webapiMapper/conversationDataHandlers"),y=e("jSkype/services/webapiMapper/conversationLiveStateHandler"),b=e("jSkype/settings"),w=e("jSkype/telemetry/poll"),E=e("jSkype/utils/chat/conversation"),S=e("jSkype/utils/chat/message"),x=e("jSkype/utils/chat/generator"),T=e("utils/chat/dateTime"),N=e("utils/chat/messageSanitizer"),C=e("utils/common/async"),k=e("swx-utils-common").sessionStorage,L=e("telemetry/chat/messageSent"),A=r.isTyping,O="User",M=16,_=r.storageKeys,D=r.events.system,P=r.onlineStates;return function(B,j){function V(e){F.isOnline(e===P.ONLINE),B._onlineStateChanged()}function $(){k.set(_.RESURECTION_KEY,"1")}function J(e){e.eventMessages&&W.eventMessages(e.eventMessages),e.actionName==="syncThread"&&(z.handleThreadSync(e),y.updateNGCCallState(e.id,e.properties)),e.actionName==="endpointCreation"&&q.promise.state()==="pending"&&q.resolve()}function K(){var e=l.get();e.subscribe("webapi:data",J),e.subscribe(D.FORCE_RESYNC,$),e.subscribe(D.ONLINE_STATE_CHANGED,V)}function Q(e,t){var n=t.person;return{id:a.getKey(n.id(),n._type()),role:e}}function G(){F.addConversationsCollectionTask.promise.state()==="pending"&&F.addConversationsCollectionTask.resolve()}function Y(){var n=e("utils/common/logTracer/api");return b.isFeatureOn(r.featureFlags.UNREAD_MSG_LOGGING)?n.getLogger("unread-msgs"):{log:t.noop}}var F=this,I=o.task(),q=j||o.task(),R,U=Y(),z=g.build(this,B),W=m.build(z),X;F.addConversationsCollectionTask=o.task(),F.conversationsManager=B,F.isOnline=o.boolProperty(!0),F.init=function(){X=v.get(),F.serviceLocator=c.build(b.settings.webApiServiceHost),F.webAPIService=p.getInstance(F.serviceLocator),K(),F.startPolling(),I.resolve()},F.reset=function(){function t(){I=o.task(),q=o.task(),R=null,F.addConversationsCollectionTask=o.task(),F.isOnline(!0),k.clear()}return F.webAPIService?F.webAPIService.reset().then(t):(t(),Promise.resolve())},F.createConversation=function(e,n,r){function i(t){e.activeModalities.chat._set(e.leave.enabled()),n(t)}C.execute(function(){var n;e.activeModalities.chat._set(!1),n=t.filter(e.participants(),function(e){var t=e.person;return!(a.isPstnId(t.id())&&t.id().length>M)});var s=n.map(Q.bind(null,O));s.push(Q("Admin",e.selfParticipant)),F.webAPIService.createConversation(s,i,r)}),e.activeModalities.chat._set(!0)},F.syncRecents=function(e,t,n){function r(e){var t=E.getSyncStateFromResponse(e.response);G(),R.resolve({conversations:e.response.conversations,syncState:t,hasMoreConversations:!!e.response._metadata.backwardLink,statusCode:e.request.status}),R=null}function i(e){R.reject(e),R=null}function s(){n?F.webAPIService.syncRecentsBySyncState(n,t,r,i):F.webAPIService.syncRecents(e,t,r,i)}return R?R.promise:(R=o.task(),q.promise.then(s),R.promise)},F.syncConversation=function(e,t,n){o.task.waitAll([I.promise,q.promise]).then(function(){F.webAPIService.syncConversation(e,t,n)})},F.syncThread=function(e,t,n){return t=t||function(){},n=n||function(){},new Promise(function(r,i){function s(){t(),r()}function u(e){n(e),i(e)}f.isGroupConversation(e)?o.task.waitAll([I.promise,q.promise]).then(function(){F.webAPIService.syncThread(e,s,u)}):u(new Error("expected valid group conversation id"))})},F.sendMessage=function(e,t,n,r,i){function s(t){F.setConsumptionHorizonToMessage(e,n),f.publish(t.request.status),r()}function o(e){f.publish(e.status),i()}if(X.executeCommand(n._originalContent||t.content,e))return r(),!1;var u=x.messageForService(t),a=u.content?u.content.length:0,f=L.build(e,n,u.skypeeditedid,a);return F.webAPIService.postMessage(e.conversationId,u,s,o),!0},F.removeAllMessages=function(e,t,n){return F.webAPIService.removeAllMessages(e,t,n)},F.sendMojiMessage=function(e,t,n,i){var s=h.resolve(r.serviceLocator.PES_CONFIG_SERVICE),o=s.getConfiguration(),u=T.getDate(),a=o.itemsRoot+"/"+t,f=a+"/views/thumbnail",l=b.settings.xmmFallbackUrl+"?go=webclient.xmm&amp;"+t,c={messagetype:"RichText/Media_FlikMsg",content:'<URIObject type="Video.1/Flik.1" uri="'+a+'" url_thumbnail="'+f+'">'+'To view this Moji, go to: <a href="'+l+'">'+l+"</a>"+"</URIObject>",key:String(u.getTime()),timestamp:u.getTime(),conversationModel:e},p=x.outgoingMojiActivityItem(a,t,c);F.sendMessage(e,c,p,n,i)},F.sendPollMessage=function(e,i,o,u){var f=T.getDate().getTime(),l=s.get().personsAndGroupsManager.mePerson,c=JSON.parse(i),h=t.reduce(c.answers,function(e,t){return e+='<Answer value="'+N.escapeHTML(t)+'" />'},""),p=t.reduce(c.answers,function(e,t){return e+="- "+N.escapeHTML(t)+"\n"},""),d=N.escapeHTML(N.webify(c.question)),v=b.settings.pollFallbackUrl+"&amp;threadId="+e.conversationId,m=n.fetch({key:"poll_fallback_link_text"}),g=n.fetch({key:"poll_message_goto_text",params:{fallbackLink:'<a href="'+v+'">'+m+"</a>"}}),y="poll.1",E={messagetype:"RichText",conversationModel:e,content:'<URIObject type="'+y+'">'+"<Title>"+d+"</Title>"+"\n\n"+"<Description>"+p+"</Description>"+"\n"+g+"<Settings>"+'<MultipleChoice value="'+c.multipleChoice+'" />'+"</Settings>"+'<Question value="'+d+'" />'+"<Answers>"+h+"</Answers>"+"</URIObject>",key:String(f),timestamp:f,isMyself:!0,author:a.getKey(l.id(),l._type())},S=x.outgoingPollMessageActivityItem(E);S.html._set(E.content),F.sendMessage(e,E,S,function(){w.sendPoll(S),o()},function(){w.error(e.conversationId,undefined,y,r.telemetry.poll.errorType.SEND),u()})},F.sendContactInfoMessage=function(e,t,n,r,i){function s(e){var t="<contacts>";return e.forEach(function(e){t+='<c t="s" s="'+e.id()+'" f="'+e.displayName()+'"/>'}),t+="</contacts>",t}var o={messagetype:"RichText/Contacts",content:s(n),key:t.key(),timestamp:T.getDate().getTime(),conversationModel:e};t.html._set(o.content),F.sendMessage(e,o,t,r,i)},F.sendPhotoSharingMessage=function(e,t,n,r,i,s){var o=b.settings.amdServiceHost+"/v1/objects/"+n,u=o+"/views/imgt1",a=b.settings.xmmFallbackUrl+"?go=webclient.xmm&amp;pic="+n,f={messagetype:"RichText/UriObject",content:'<URIObject type="Picture.1" uri="'+o+'" url_thumbnail="'+u+'">'+'To view this shared photo, go to: <a href="'+a+'">'+a+"</a>"+'<OriginalName v="'+r+'"/>'+'<meta type="photo" originalName="'+r+'"/>'+"</URIObject>",key:t.key(),timestamp:(new Date).getTime()};t.html._set(f.content),F.sendMessage(e,f,t,i,s)},F.sendFileTransferMessage=function(e,t,n,r,i,s,o){var u=b.settings.amdServiceHost+"/v1/objects/"+n,a=u+"/views/thumbnail",f=b.settings.xmmFallbackUrl+"?go=webclient.xmm&amp;docid="+n,l={messagetype:"RichText/Media_GenericFile",content:'<URIObject type="File.1" uri="'+u+'" url_thumbnail="'+a+'">'+"<Title>Title: "+r+"</Title>"+"<Description> Description: "+r+"</Description>"+'<a href="'+f+'"> '+f+"</a>"+'<OriginalName v="'+r+'"/>'+'<FileSize v="'+i+'"/>'+"</URIObject>",key:t.key(),timestamp:(new Date).getTime()};t.html._set(l.content),t.fileUri._set(u+"/views/original"),t.fileThumbnailUri._set(u+"/views/thumbnail"),F.sendMessage(e,l,t,s,o)},F.syncMessages=function(e,t,n,r){function i(){d.get(e.conversationId)?F.webAPIService.syncMessagesLoadMore(e.conversationId,t,n,r):F.webAPIService.syncMessages(e.conversationId,0,t,n,r)}F.isOnline.once(!0,function(){o.task.waitAll([I.promise,q.promise]).then(function(){e._requestedJoining?e._requestedJoining.promise.then(function(){i()}):i()})})},F.startPolling=function(){F.webAPIService.poll()},F.addParticipant=function(e,t,n,r,i){F.webAPIService.addParticipant(e,t,n,r,i)},F.removeParticipant=function(e,t,n,r){F.webAPIService.removeParticipant(e,t,n,r)},F.joinConversation=function(e,t){var n;return e._requestedJoining&&e._requestedJoining.promise.state()==="pending"?Promise.reject(new Error("already joining this conversation")):(e._requestedJoining=o.task(),I.promise.then(function(){function r(t){e._requestedJoining.reject(t)}n=s.get().personsAndGroupsManager.mePerson,F.addParticipant(e.conversationId,n.id(),i.participantRole.Attendee,function(){t?F.syncThread(e.conversationId).then(function(){e._requestedJoining.resolve()},r):(F.syncThread(e.conversationId),e._requestedJoining.resolve())},r)}),e._requestedJoining.promise)},F.setAlerts=function(t,n,r,i,s){function o(){i(n&&r==="",r)}function u(){F.webAPIService.setConversationOption(t,"alertmatches",r,o,s)}r||(r=""),F.webAPIService.setConversationOption(t,"alerts",n&&r==="",u,s)},F.setTopic=function(e,t,n,r){F.webAPIService.setThreadOption(e,"topic",t,n,r)},F.joiningEnabled=function(e,t,n,r){F.webAPIService.setThreadOption(e,"joiningenabled",t,n,r)},F.historyDisclosed=function(e,t,n,r){F.webAPIService.setThreadOption(e,"historydisclosed",t,n,r)},F.setConsumptionHorizonToMessage=function(e,t){var n=(new Date).getTime(),r,s=e.historyService.activityItems(),o=s[s.length-1],a=[i.activityType.ContactRequestOutgoing,i.activityType.ContactRequestOutgoingResend,i.activityType.ContactRequestOutgoingAgent],f,l;if(s.length===0){U.log("apiHandler.setConsumptionHorizonToMessage in if messages are empty: ",e.conversationId);return}if(t===o)U.log("apiHandler.setConsumptionHorizonToMessage in if message == lastDisplayedMessage: ",e.conversationId),l=t.timestamp().getTime();else if(t._isOriginal&&t._isOriginal())l=t.timestamp().getTime();else{var c=e.historyService.activityItems(t.key());l=c?c.timestamp().getTime():0}f=t&&t._id&&a.indexOf(t.type())===-1;if(!f||S.isMessageReadOnServer(e._consumptionHorizon,t.key(),l)){U.log("apiHandler.setConsumptionHorizonToMessage in if !isValidMessage: ",e.conversationId);return}r=t.timestamp().getTime()+";"+n+";"+t.key(),e._updateConsumptionHorizon(r),t instanceof u||F.setConsumptionHorizon(e)},F.setConsumptionHorizon=function(e){if(e._consumptionHorizon.lastReadMessageTimestamp===0)return;U.log("apiHandler.setConsumptionHorizonToMessage calling webapi: ",e.conversationId);var t=e._consumptionHorizon.lastReadMessageTimestamp+";"+e._consumptionHorizon.modificationTime+";"+e._consumptionHorizon.lastReadMessageId;F.webAPIService.setConsumptionHorizon(e.conversationId,t,function(){})},F.getFavorites=function(){if(!b.isFeatureOn(r.featureFlags.FAVORITES_CONVERSATION_ENABLED))return;return F.webAPIService.getFavorites()},F.setFavorites=function(e){if(!b.isFeatureOn(r.featureFlags.FAVORITES_CONVERSATION_ENABLED))return;return F.webAPIService.setFavorites(e)},F.setIsTyping=function(e,t,n,r){var i=(new Date).getTime(),s={clientmessageid:String(i),messagetype:t?A.MESSAGE_TYPE.SET_TYPING:A.MESSAGE_TYPE.CLEAR_TYPING,content:"",contenttype:"text"};F.webAPIService.postMessage(e,s,n,r)}}}),define("jSkype/utils/chat/conversationsCache",["require","exports","module","lodash-compat","constants/common","jSkype/client","jcafe-property-model","jSkype/modelHelpers/propertyValidator","jSkype/services/internalPubSub","jSkype/services/webapi/utils/sanitizer","jSkype/settings","jSkype/utils/chat/cacheBase","jSkype/utils/chat/conversation","jSkype/utils/chat/message","jSkype/utils/chat/messageTypes","jSkype/constants/data","utils/common/cache/instance","utils/chat/sort"],function(e,t){function w(){var e=14,t=new Date;return t.setDate(t.getDate()-e),t.getTime()}function E(e,t){function H(e){var t=36e5;return e.threadProperties?e.threadProperties.lastleaveat&&e.threadProperties.lastjoinat&&e.threadProperties.lastleaveat>e.threadProperties.lastjoinat?!1:e.threadProperties.lastjoinat&&Date.now()-e.threadProperties.lastjoinat<t:!1}function B(e){return e.properties?e.properties.clearedat:!1}function j(e){return e.lastMessage&&typeof e.lastMessage.content!="undefined"}function F(e){return!f.isFeatureOn(r.featureFlags.AGENTS_ENABLED)&&c.isAgentConversation(e.id)?!1:!f.isFeatureOn(r.featureFlags.PSTN_ENABLED)&&c.isPstnConversation(e.id)?!1:(j(e)||H(e)&&!B(e))&&!c.isMeConversation(e.id)}function I(e,n,r){var s=i.get().conversationsManager.conversations(e.id),o;s||(t([e],!0),s=i.get().conversationsManager._getConversation(e.id)),o=r?s.historyService._unreadActivityItemsWithKeywordsCount:s.historyService.unreadActivityItemsCount,n(o()>0)}function q(e,t){var r=/false/i.test(e.properties.alerts),i=!n.isEmpty(e.properties.alertmatches);if(e.isBlocked||r&&!i){t(!1);return}if(h.doesMessageTypeSupportUnreadState(e.lastMessage)){if(e.lastMessage.skypeeditedid){I(e,t,r&&i);return}var s=typeof e.lastMessage.content!="undefined"&&!c.isConversationReadOnServer(e)&&!h.isMessageOutgoing(e.lastMessage);r&&i&&s?I(e,t,!0):t(s);return}if(c.isConversationReadOnServer(e)){t(!1);return}I(e,t)}function R(){function t(t){if(e<P)return;P=e,E.unreadConversationsCount._set(t.length)}D++;var e=D;E.getItems(q,t)}function U(e,n){function o(e){var t=E.cacheItem,s;if(F(e)){s=E.getItem(e.id);if(s&&s===e)return;s&&(it(e),t=E.replaceItem,r.push(e)),e.timestamp=+(new Date(e.lastMessage.originalarrivaltime)),t(e,e.id),n||i.push(X(e))}}var r=[],i=[];if(!e.length)return;a.conversations(e),e.forEach(o),R(),i.length?s.task.waitAll(i).then(W):n||W(),r.forEach(function(e){S[e.id]&&tt(e.id)}),t(E._getNewUnconsumedItems().concat(r))}function z(e){function t(e){return e&&e.content&&p._isDeletedMessage(e.content)&&(e.content=""),e}var r=n.omit(e.lastMessage,"conversationModel");return e.lastMessage=t(r),e}function W(){v.get().setItem("recentsSyncState",L)}function X(e){return v.get().setSensitiveItem("conv|"+e.id,z(e))}function V(e){return v.get().removeItem("conv|"+e)}function $(){return T=T||v.get().getSensitiveItems(d.CONVERSATION),T}function J(t){function i(e){U([e.response]),n.resolve(E.getItem(t))}var n=s.task(),r=E.getItem(t);return r?n.resolve(r):e.syncConversation(t,i,n.reject.bind(n)),n.promise}function K(e,t,n){for(var r in n)n.hasOwnProperty(r)&&(e[t][r]=n[r])}function Q(){var e=T||E._obtain();return e.then(function(){return E.unreadConversationsCount()})}function G(t,n){function r(e){L=e,s()}function i(e){L=e.syncState,t(e)}function s(){e.syncRecents(w(),g,L).then(i,n)}n=n||function(){},L?s():v.get().getItem("recentsSyncState").then(r,s)}function Y(){function e(n){U(n.conversations),t(n.conversations),n.hasMoreConversations?G(e):N=!1}if(N)return;N=!0,G(e)}function Z(){function n(){t--,t===0&&e.resolve()}var e=s.task(),t=0;for(var r in S)S.hasOwnProperty(r)&&(t++,tt(r,n,n));return e.promise}function et(){O(Object.keys(S).length>0)}function tt(t,n,r){function i(e,n){x[t].forEach(function(t){var r=e?t.onError:t.onSuccess;r&&r(n)}),delete x[t]}delete S[t],et(),x[t]||(x[t]=[],e.syncThread(t,i.bind(null,!1),i.bind(null,!0))),x[t].push({onSuccess:n,onError:r})}function nt(e){var t=!!e.members,n=o.isGroupConversation(e.id);!t&&n&&(S[e.id]=e.id,et())}function rt(){E.syncFinished._set(!E._serverHasMoreItems&&M)}function it(e){var t=E.getItem(e.id),n=e.lastMessage,r=t?t.lastMessage:null;if(!n||!r||n.properties||!r.properties)return;n.id===r.id&&n.originalarrivaltime===r.originalarrivaltime&&(n.properties=r.properties)}var E=this,S={},x={},T,N,C=!0,k=!1,L,A={},O=s.boolProperty(!1),M=!1,D=0,P=0;l.call(E,y,m.byTimestamp),this._init=function(){u.get().subscribe(b.FORCE_RESYNC,Y)},this._getItemsFromService=function(e,t){function r(e){E.onNewItemsLoaded(),n.reject(e)}function o(t,r){E.onNewItemsLoaded(),U(t,r),$().then(function(){n.promise.state()==="pending"&&n.resolve(e?E._getCachedItems(e):[])})}function u(n){n.hasMoreConversations&&t&&E._getItemsFromService(e,t),i.get()._telemetry.context.timelineLoadStatusCode=n.statusCode,o(n.conversations),E._serverHasMoreItems=n.hasMoreConversations,rt()}var n=s.task();return t=t||C,C=!1,G(u,r),k||(k=!0,$().then(function(e){e&&o(e,!0),M=!0,rt()})),n.promise},this._syncAllConversations=s.command(Z,O),this._onItemAddedOrUpdated=function(e){U([e]),S[e.id]&&tt(e.id)},this._onItemRemoved=function(e){V(e)},this._cacheItem=function(e,t){typeof A[t]!="undefined"&&(e.isBlocked=A[t],delete A[t]),nt(e)},this._serverHasMoreItems=!0,this.unreadConversationsCount=s.property({readOnly:!0,value:0,get:Q}),this.getConversation=function(e){var t=E.getItem(e);return!t&&o.isGroupConversation(e)&&(S[e]=e),S[e]&&tt(e),t},this.conversationUpdated=function(e){if(!!e.version&&!F(e))return;J(e.id).then(function(t){K(t,"properties",e.properties),K(t,"threadProperties",e.threadProperties),e.members&&(t.members=e.members),R(),X(t)})},this.handleUpdatedMessage=function(e,t){var n=E.getItem(e);if(!n)return;n.lastMessage.id===t.id&&(n.lastMessage=t,X(n))},this.handleNewMessage=function(e,t){var n=E.getItem(e);if(!n)return;n.lastMessage=t,n.timestamp=+(new Date(t.originalarrivaltime)),R(),X(n)},this.conversationBlockedUpdate=function(e,t){var n=E.getItem(e);n?(n.isBlocked=t,R(),X(n)):A[e]=t},this.syncFinished=s.property({readOnly:!0,value:!1})}var n=e("lodash-compat"),r=e("constants/common"),i=e("jSkype/client"),s=e("jcafe-property-model"),o=e("jSkype/modelHelpers/propertyValidator"),u=e("jSkype/services/internalPubSub"),a=e("jSkype/services/webapi/utils/sanitizer"),f=e("jSkype/settings"),l=e("jSkype/utils/chat/cacheBase"),c=e("jSkype/utils/chat/conversation"),h=e("jSkype/utils/chat/message"),p=e("jSkype/utils/chat/messageTypes"),d=e("jSkype/constants/data").storageKeyRegExp,v=e("utils/common/cache/instance"),m=e("utils/chat/sort"),g=100,y=-1,b=r.events.system;E.prototype=Object.create(l.prototype),E.prototype.constructor=E,t.build=function(e,t){return new E(e,t)}}),define("jSkype/utils/chat/conversationsFactory",["require","jSkype/modelHelpers/propertyValidator","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/modelHelpers/personHelper","jSkype/models/conversation"],function(e){function s(e){function o(e){var t=n.getPersonByConversationId(e);return s.createByPerson(t)}var s=this;this.createById=function(n){var r;return t.isGroupConversation(n)?r=new i(e,!0,n):r=o(n),r||(r=new i(e),r.conversationId=n),r},this.createByPerson=function(t){var n=r.getKey(t.id(),t._type()),s=new i(e,!1,n);return s._addParticipant(t),s.avatarUrl=t.avatarUrl,s.topic=t.displayName,s}}var t=e("jSkype/modelHelpers/propertyValidator"),n=e("jSkype/modelHelpers/personsAndGroupsHelper"),r=e("jSkype/modelHelpers/personHelper"),i=e("jSkype/models/conversation");return s}),define("jSkype/models/conversationsManager",["require","lodash-compat","swx-enums","jSkype/constants/people","jcafe-property-model","jSkype/models/conversation","jSkype/models/conversationsSearchQuery","jSkype/modelHelpers/contacts/contactActivityItemHelper","jSkype/modelHelpers/contacts/contactMessageFactory","jSkype/modelHelpers/contacts/dataMappers/dataMaps","jSkype/modelHelpers/personHelper","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/modelHelpers/personsRegistry/instance","jSkype/modelHelpers/propertyValidator","jSkype/modelHelpers/contacts/authorizationChange","jSkype/settings","constants/common","jSkype/services/webapi/utils/conversationMetadataStore","jSkype/services/webapiMapper/conversationApiHandler","jSkype/services/webapiMapper/conversationLiveStateHandler","jSkype/utils/chat/conversationsCache","jSkype/utils/chat/conversationsFactory"],function(e){function x(){function D(e,t){var n=x._getConversation(t.id);n&&n[e](t),O.conversationUpdated(t)}function P(e){k(e.conversationId)||k.add(e,e.conversationId)}function H(e){B(k,e),B(L,e)}function B(e,t){try{e.add(t,t.conversationId)}catch(n){}}function j(e,t){var r,s=i.task();return v.isFeatureOn(m.featureFlags.FAVORITES_CONVERSATION_ENABLED)&&e._isFavorited()&&e._isFavorited(!1),t===n.activityType.ContactRequestIncoming?(r=e.participants()[0].person,d.sendDeclineRequest(r).then(s.resolve.bind(s),s.reject.bind(s))):(k.remove(e.conversationId),L.remove(e.conversationId),O.onItemRemoved(e.conversationId),s.resolve()),s.promise}function F(){return T?T.promise:(T=i.task(),O.syncFinished.once(!0,function(){T.resolve(k())}),T.promise)}function I(e){var t=M.createById(e),n=O.getConversation(e);return n&&t._update(n),L.add(t,t.conversationId),t}function q(e){var t,n,r=f.contactTypes[f.contactTypeNames.pstn]+":",i=e.replace(r,"");return t=new s(A,!1,e),n=c.getPerson(i,f.contactTypes[f.contactTypeNames.pstn]),t._addParticipant(n),x.conversations.add(t),t}function R(e,t){e.reverse().forEach(function(e){x.__processConversation(e,t)})}function U(e,t,n){var r=k.size(),i,s;R(n),i=k.size()-r,s=e-i,s>0&&O.hasMoreItems()?z(s,t):t.resolve(),O.hasMoreItems()||C.set(!1)}function z(e,t){O.get(e).then(U.bind(x,e,t),t.reject.bind(t))}function W(e){var t=N;return t?t.promise:(t=N=i.task(),N.promise.finally(function(){N=null}),z(e,t),t.promise)}function X(){if(!v.isFeatureOn(m.featureFlags.FAVORITES_CONVERSATION_ENABLED))return;A.getFavorites().then(function(e){var n,r=e.response.favorites;if(!r)return;r=JSON.parse(r),t.forEach(r,function(e){n=x._getOrCreateConversation(e),n._isFavorited._set(!0),t.indexOf(x.conversations,n)===-1&&x.conversations.add(n)})})}var e,x=this,T,N,C=i.boolProperty(!0),k=i.collection({get:F}),L=i.collection(),A=new y(this),O=w.build(A,R),M=new E(A);x.conversationAPIHandler=A,this.createSearchQuery=function(){return new o(O)},this.getMoreConversations=i.command(W,C),this.conversations=k.fork({add:H,remove:j}),this.createConversation=function(){function t(t){e.historyService.getMoreActivityItems.enabled._set(!0),e.conversationId=t,e._topicSetEnabled(!0),x.conversations.add(e,t),A.syncThread(t),e.selfParticipant.role._set(n.participantRole.Leader)}function r(){}var e=new s(A,!0,null);return e.historyService.getMoreActivityItems.enabled._set(!1),A.createConversation(e,t,r),e},this.getConversation=function(t){function r(){var e=l.getKey(t.id(),t._type()),n=x._getConversation(e);if(!n){n=M.createByPerson(t);var r=O.getItem(e);r&&n._update(r),L.add(n,n.conversationId)}return n}function i(){var e=a.getActivityItemForInitialConversationLoad(t,n);e&&n.historyService._processRawMessage(e)}e.get(t.id())||e.add(t);var n=r();return i(),n},this.getConversationByUri=function(e){function i(e){if(!!e.members){A.joinConversation(e);return}A.syncThread(e.conversationId,function(){e.leave.enabled()||A.joinConversation(e)})}var t,n;if(typeof e!="string")throw new TypeError("expected uri to be a string");t=e.replace(S,"");var r=p.isPhoneNumber(t);if(!p.isGroupConversation(t)&&!r)throw new Error("expected valid conversation uri");n=L(t);if(!n){if(r)return q(t);n=new s(A,!0,t),x.conversations.add(n),A.joinConversation(n)}else n.leave.enabled()||i(n);return n},this._getConversationByUri=function(e){function o(e,i){if(!n&&r){n=q(t),e();return}if(!n){n=new s(A,!0,t),x.conversations.add(n),A.joinConversation(n,!0).then(e,i);return}if(!!n.members){A.joinConversation(n,!0).then(e,i);return}A.syncThread(n.conversationId).then(function(){n.leave.enabled()?e():A.joinConversation(n,!0).then(e,i)},i)}var t,n,r,i;return typeof e!="string"?Promise.reject(new TypeError("expected uri to be a string")):(t=e.replace(S,""),r=p.isPhoneNumber(t),i=p.isGroupConversation(t),!i&&!r?Promise.reject(new Error("expected valid conversation uri")):(n=L(t),new Promise(function(e,t){function r(){e(n)}o(r,t)})))},this.unreadConversationsCount=O.unreadConversationsCount,this._allConversations=function(){return O.getAllItems()},this._conversationsSynced=A.addConversationsCollectionTask,this._onlineStateChanged=function(){k().forEach(function(e){e._onlineStateChanged()})},this._conversationBlockedUpdate=O.conversationBlockedUpdate,this._init=function(){A.init(),O._init(),O.get(0),e=h.build(),X()},x._reset=function(){return A.reset().then(function(){O=w.build(A,R),C(!0),k.empty(),L.empty(),h.reset(),e=null})},this._getConversation=function(e){return L(e)},this._getOrCreateConversation=function(e){return x._getConversation(e)||I(e)},this._handleNewMessage=function(e,t){var n=x._getOrCreateConversation(e);P(n),O.handleNewMessage(e,t),n.historyService._processRawMessage(t)},this._handleUpdatedMessage=function(e,t){var n=x._getOrCreateConversation(e);P(n),O.handleUpdatedMessage(e,t),n.historyService._processRawMessage(t,!1,!0)},this._conversationPropertiesUpdated=function(e){D("_updateConversationProperties",e)},this._threadPropertiesUpdated=function(e){D("_updateThreadProperties",e)},x.__processConversation=function(e,n){function s(){if(!i.historyService._lastMessageFromServer||i.historyService._lastMessageFromServer._actualId!==e.lastMessage.id)g.clear(i.conversationId),i.historyService._reset();i._update(e)}function o(){t.isEmpty(e.lastMessage)||i.historyService._processRawMessage(e.lastMessage,!0);if(!i.isGroupConversation()){var n=i.participants()[0].person;f(n)}}function f(e){var t,n=i.lastModificationTimestamp(),s=new Date(n.getTime()+1e3);e.isBlocked()?(u.clearUnblockContactActivityItems(i),t=a.getUnblockContact(e,s),i.historyService._processRawMessage(t)):l.canRequestContactAuthorization(e)&&(e._authorization()===r.UNAUTHORIZED?(u.clearContactRequestActivityItems(i),t=a.getOutgoing(e,s),i.historyService._processRawMessage(t)):e._authorization()===r.PENDING_OUTGOING?(u.clearContactRequestActivityItems(i),t=a.getOutgoingResend(e,s),i.historyService._processRawMessage(t)):e._authorization()===r.SUGGESTED&&(u.clearContactRequestActivityItems(i),t=a.getSuggested(e,s),i.historyService._processRawMessage(t)))}var i=x._getConversation(e.id);i?s():i=I(e.id),A.addConversationsCollectionTask.promise.then(o),n?B(L,i):P(i),b.updateNGCCallState(e.id,e.threadProperties)}}var t=e("lodash-compat"),n=e("swx-enums"),r=e("jSkype/constants/people").authorizationStates,i=e("jcafe-property-model"),s=e("jSkype/models/conversation"),o=e("jSkype/models/conversationsSearchQuery"),u=e("jSkype/modelHelpers/contacts/contactActivityItemHelper"),a=e("jSkype/modelHelpers/contacts/contactMessageFactory"),f=e("jSkype/modelHelpers/contacts/dataMappers/dataMaps"),l=e("jSkype/modelHelpers/personHelper"),c=e("jSkype/modelHelpers/personsAndGroupsHelper"),h=e("jSkype/modelHelpers/personsRegistry/instance"),p=e("jSkype/modelHelpers/propertyValidator"),d=e("jSkype/modelHelpers/contacts/authorizationChange"),v=e("jSkype/settings"),m=e("constants/common"),g=e("jSkype/services/webapi/utils/conversationMetadataStore"),y=e("jSkype/services/webapiMapper/conversationApiHandler"),b=e("jSkype/services/webapiMapper/conversationLiveStateHandler"),w=e("jSkype/utils/chat/conversationsCache"),E=e("jSkype/utils/chat/conversationsFactory"),S="skype://";return x}),define("jSkype/models/devicesManager",["require","jcafe-property-model","jSkype/modelHelpers/propertyModelHelper","jSkype/services/calling/environmentInspector"],function(e){function i(){var e=t.collection(),i=t.collection(),s=t.collection();return this.selectedCamera=t.property(),this.selectedMicrophone=t.property(),this.selectedSpeaker=t.property(),this.cameras=n.exposeReadOnlyCollection(e),this.microphones=n.exposeReadOnlyCollection(i),this.speakers=n.exposeReadOnlyCollection(s),this.checkMediaCapabilities=t.enabledCommand(function(){return r.checkForCallingSupport(!0)}),this._reset=function(){this.selectedCamera(null),this.selectedMicrophone(null),this.selectedSpeaker(null),e.empty(),i.empty(),s.empty()},this}var t=e("jcafe-property-model"),n=e("jSkype/modelHelpers/propertyModelHelper"),r=e("jSkype/services/calling/environmentInspector");return i}),define("jSkype/models/group",["require","jcafe-property-model","swx-enums"],function(e){function r(e,r){e=e||n.groupType.Root,this.type=t.property({readOnly:!0,value:e}),this.name=t.property({value:i(r,e)}),this.uri=t.property({readOnly:!0}),this.avatarUrl=t.property(),this.relationshipLevel=t.property({readOnly:!0,value:n.groupPrivacyRelationshipLevel.None}),this.persons=t.collection(),this.groups=t.collection()}function i(e,t){var r,i=Boolean(n.groupType[e]);if(!e||i)r=t;else{if(!!i||!s(t))throw new Error("Invalid type/name combination");r=e}return r}function s(e){return e===n.groupType.Custom}var t=e("jcafe-property-model"),n=e("swx-enums");return r}),define("jSkype/models/allGroup",["require","jcafe-property-model","jSkype/client","swx-enums","jSkype/services/serviceFactory","jSkype/modelHelpers/contacts/dataHandlers/factory","swx-agentProvisioningService","swx-i18n","jSkype/models/group","swx-enums","jSkype/modelHelpers/personHelper","jSkype/modelHelpers/contacts/dataMappers/dataMaps","lodash-compat","constants/common","utils/common/settablePromise","jSkype/settings","jSkype/constants/people"],function(e){function y(e){a.call(this),this.persons=b(e),g=null}function b(e){var u=t.collection({get:function(){function u(){g.resolve(),g=null}function a(e){g.reject(e),g=null}if(n.get().signInManager.state()!==r.loginState.SignedIn)return Promise.reject("signed out");if(n.get().personsAndGroupsManager._initialized())return Promise.resolve();if(g)return g;g=d.build();var o=s.getContactListHandlers();return l.isGuest(e)?o.onSuccess({response:{count:0,contacts:[]}}).then(u):i.getContactsService().getMyContacts(e.id()).then(o.onSuccess,o.onError).then(u,a),g}});return u.asWritable({add:function(t,r,a,c){function b(){s.getContactRequestSentHandlers().onSuccess(t)}function w(e){s.getContactRequestSentHandlers().onError(e,t)}function T(){s.getContactRequestAcceptedHandlers().onSuccess(t)}function N(e){s.getContactRequestAcceptedHandlers().onError(e)}var h;if(t.isAgent()&&c===f.ContactRequestOutgoingAgent){var p=n.get().signInManager._skypeToken,d=v.settings.agentProvisioningService,g=o.build(p,d);t._authorization._set(m.PENDING_OUTGOING),h=g.add(t.id()).then(b,w)}if(c&&!l.isGuestId(r)&&!t.isAgent()){var y=i.getStratusService();E(c)?h=y.sendContactRequest(r,x(t)).then(b,w):S(c)&&(h=y.acceptContactRequest(r),h.then(T,N))}return u(r)||u.add(t,r,a),h||Promise.resolve()},remove:function(t,n){function a(){var e=i.getContactsService();return e.deleteContact(t,w(o)).then(c,h)}function f(){var e=i.getStratusService();return e.deleteContact(t).then(c,h)}function c(){s.getContactDeletedHandlers().onSuccess(o)}function h(e){s.getContactDeletedHandlers().onError(e)}var r,o=u(t);return n||l.isGuestId(t)?(u.remove(t),r=Promise.resolve()):v.isFeatureOn(p.featureFlags.DELETE_CONTACT_USING_CONTACTS_SERVICE)?r=a():r=f(),r}})}function w(e){return h.findKey(c.contactTypes,function(t){return t===e._type()})}function E(e){return e===f.ContactRequestOutgoing||e===f.ContactRequestOutgoingResend||e===f.ContactRequestOutgoingAgent||e===f.SuggestedContact}function S(e){return e===f.ContactRequestIncoming}function x(e){return u.fetch({key:"message_text_contactRequestGreeting",params:{displayName:e.displayName()}})}var t=e("jcafe-property-model"),n=e("jSkype/client"),r=e("swx-enums"),i=e("jSkype/services/serviceFactory"),s=e("jSkype/modelHelpers/contacts/dataHandlers/factory"),o=e("swx-agentProvisioningService"),u=e("swx-i18n").localization,a=e("jSkype/models/group"),f=e("swx-enums").activityType,l=e("jSkype/modelHelpers/personHelper"),c=e("jSkype/modelHelpers/contacts/dataMappers/dataMaps"),h=e("lodash-compat"),p=e("constants/common"),d=e("utils/common/settablePromise"),v=e("jSkype/settings"),m=e("jSkype/constants/people").authorizationStates,g;return y.prototype=new a,y.prototype.constructor=y,y.prototype._reset=function(){this.persons.empty(),g=null},y}),define("jSkype/models/entitlement",["require","jcafe-property-model"],function(e){function n(){var e=this;e.name=t.property({readOnly:!0}),e.active=t.property({readOnly:!0})}var t=e("jcafe-property-model");return n}),define("jSkype/models/subscription",["require","jcafe-property-model","jSkype/models/entitlement"],function(e){function r(){var e=this;n.call(this),e.type=t.property({readOnly:!0})}var t=e("jcafe-property-model"),n=e("jSkype/models/entitlement");return r.prototype=new n,r.prototype.constructor=r,r}),define("jSkype/modelHelpers/account/dataHandlers/entitlements",["require","exports","module","jSkype/modelHelpers/propertyModelHelper","lodash-compat","jSkype/models/subscription","jSkype/services/entitlement/serviceSettings","swx-enums","jSkype/client"],function(e,t){function a(){function t(t){if(a(t)){l(t);return}if(f(t)){e.displayBalance._set(t.balanceFormatted),e._balance._set(t.balance),e._currency._set(t.attributes.currency);return}}function a(e){return e.service===o.subscriptionType.Package||e.service===o.subscriptionType.Plan}function f(e){return e.service===s.serviceNames.credit}function l(t){var n=e.entitlements(t.id);n?c(n,t):(n=new i,c(n,t),e.entitlements.add(n,n.name()))}function c(e,t){e.name._set(t.id),e.type._set(t.service),e.active._set(t.active)}function h(e,t){return r.some(t,function(t){return e.name()===t.id})}var e=u.get().personsAndGroupsManager.mePerson.account;this.onSuccess=function(i){var s=[];return r.forEach(i.response,t),r.forEach(e.entitlements(),function(t){h(t,i.response)||s.push(t)}),r.forEach(s,function(n){e.entitlements.remove(n.name())}),n.createResolvedPromise()},this.onError=function(e){return n.createRejectedPromise(e)}}var n=e("jSkype/modelHelpers/propertyModelHelper"),r=e("lodash-compat"),i=e("jSkype/models/subscription"),s=e("jSkype/services/entitlement/serviceSettings"),o=e("swx-enums"),u=e("jSkype/client");t.classFunction=a,t.build=function(){return new a}}),define("jSkype/models/account",["require","jcafe-property-model","jSkype/client","jSkype/modelHelpers/account/dataHandlers/entitlements","jSkype/services/serviceFactory"],function(e){function s(){var e=this;e.entitlements=t.collection({get:function(){var s,o,u=n.get().personsAndGroupsManager.mePerson;return o=r.build(),s=i.getEntitlementService(),s.getEntitlementListingData(u.id()).then(o.onSuccess,o.onError).then(function(){return e.entitlements()})}}),e.displayBalance=t.property({readOnly:!0}),e._currency=t.property({readOnly:!0}),e._balance=t.property({readOnly:!0})}var t=e("jcafe-property-model"),n=e("jSkype/client"),r=e("jSkype/modelHelpers/account/dataHandlers/entitlements"),i=e("jSkype/services/serviceFactory");return s}),define("utils/common/builderMixin",["require","lodash-compat"],function(e){function n(){return n.prototype}var t=e("lodash-compat");return n.prototype={build:function(){var e=Object.create(this.prototype);return this.apply(e,arguments)||e}},t.assign(n,n.prototype),n}),define("jSkype/services/preferences/autoBuddyProvider",["require","lodash-compat","utils/common/builderMixin","jSkype/services/serviceFactory","jSkype/modelHelpers/contacts/dataHandlers/factory"],function(e){function s(){}var t=e("lodash-compat"),n=e("utils/common/builderMixin"),r=e("jSkype/services/serviceFactory"),i=e("jSkype/modelHelpers/contacts/dataHandlers/factory");return s.prototype.read=function(){var t=i.getPeopleSettingsHandlers();return r.getPeopleService().getSettings().then(t.onSuccess,t.onError)},s.prototype.update=function(e){return r.getPeopleService().setSettings(e)},t.assign(s,n),s}),define("jSkype/telemetry/preferences",["require","exports","module","lodash-compat","jSkype/client","constants/common","jSkype/settings"],function(e,t){function o(e,t,r,s){var o={};return n.isObject(t)&&(t=Object.prototype.toString.call(t)),o[i.telemetry.userSettings.property.ITEM_NAME]=(e==null?i.telemetry.userSettings.UNKNOWN:e).toString(),o[i.telemetry.userSettings.property.ITEM_VALUE]=(t==null?i.telemetry.userSettings.UNKNOWN:t).toString(),o[i.telemetry.userSettings.property.OPERATION_DURATION]=isNaN(parseInt(s))?i.telemetry.userSettings.UNKNOWN:s,o[i.telemetry.userSettings.property.OPERATION_OUTCOME]=r?i.telemetry.userSettings.outcomeNames.SUCCESS:i.telemetry.userSettings.outcomeNames.FAILURE,o}var n=e("lodash-compat"),r=e("jSkype/client"),i=e("constants/common"),s=e("jSkype/settings");t.fetchPreference=function(t,n,u,a){var f=o(t,n,u,a);r.get()._telemetryManager.sendEvent(s.settings.telemetry.jSkypeTenantToken,i.telemetry.userSettings.eventName.PREFERENCE_FETCHED,f)},t.changePreference=function(t,n,u,a){var f=o(t,n,u,a);r.get()._telemetryManager.sendEvent(s.settings.telemetry.jSkypeTenantToken,i.telemetry.userSettings.eventName.PREFERENCE_CHANGED,f)}}),define("jSkype/utils/preferences/preference",["require","exports","module","swx-enums","jSkype/settings","constants/common","jcafe-property-model","jSkype/telemetry/preferences","swx-utils-common"],function(e,t){function f(e){function g(){var e=a.build();return c.read().then(function(t){var n=h;return t===null?m._set(o.Unset):(m._set(o.Defined),n=t),w(n,!0,e),n}).catch(function(){var n=t.value();return m._set(o.Unset),w(n,!1,e),n})}function y(e){var t=a.build();return n?n:(m._set(o.Saving),n=Promise.resolve(c.update(e)).then(function(){return m._set(o.Defined),E(e,!0,t),n=null,e}).catch(function(){return m._set(o.Unset),E(e,!1,t),n=null,e}),n)}function b(){return r.isFeatureOn(i.featureFlags.USER_SETTINGS_ENABLED)}function w(t,n,r){e.disableReporting||u.fetchPreference(p,t,n,r.duration())}function E(t,n,r){e.disableReporting||u.changePreference(p,t,n,r.duration())}var t=this,n,f=e.id,l=e.type,c=e.provider,h=e.defaultValue,p=e.telemetryName||e.id,d=g,v=y,m=s.property({readOnly:!0,value:o.Unknown});b()||(d=undefined,v=undefined,m._set(o.Unset)),t.description={id:f,type:l},t.value=s.property({readOnly:!b(),value:h,get:d,set:v}),t.value.state=m}var n=e("swx-enums"),r=e("jSkype/settings"),i=e("constants/common"),s=e("jcafe-property-model"),o=n.preferenceValueState,u=e("jSkype/telemetry/preferences"),a=e("swx-utils-common").stopwatch;t.build=function(e){return new f(e)}}),define("jSkype/services/preferences/proofProvider",["require","exports","module","jSkype/services/serviceFactory","jSkype/modelHelpers/contacts/dataHandlers/factory"],function(e,t){function i(e){var t=this;t.read=function(){return Promise.resolve(e.isSearchable)},t.update=function(t){var i=r.getProfilePhoneNumberUpdateHandlers();return t===null?n.getABCHProfileService().deletePhoneNumber(e).then(i.onSuccess,i.onError):(e.isSearchable=t,n.getABCHProfileService().updatePhoneNumber(e).then(i.onSuccess,i.onError))}}var n=e("jSkype/services/serviceFactory"),r=e("jSkype/modelHelpers/contacts/dataHandlers/factory");t.build=function(e){return new i(e)}}),define("jSkype/services/preferences/profileServiceProvider",["require","exports","module","lodash-compat","swx-enums","constants/common","jSkype/utils/preferences/preference","jSkype/services/preferences/proofProvider","jSkype/services/serviceFactory","jSkype/modelHelpers/contacts/dataHandlers/factory"],function(e,t){function f(){this.read=function(){function t(e){return e===i.proofTypes.EMAIL?r.preferenceType.AutoBuddyDiscoveryEmail:e===i.proofTypes.PHONE?r.preferenceType.AutoBuddyDiscoveryPhone:r.preferenceType.Boolean}var e=a.getABCHProfileServiceHandlers();return u.getABCHProfileService().getProfile().then(e.onSuccess,e.onError).then(function(e){return n.map(e,function(e){var n=t(e.type);return s.build({id:i.userSettings.preferences.DYNAMIC_DISCOVERY+"-"+e.value,type:n,provider:o.build(e),defaultValue:!1,telemetryName:i.userSettings.preferences.DYNAMIC_DISCOVERY+"-"+n})})})}}var n=e("lodash-compat"),r=e("swx-enums"),i=e("constants/common"),s=e("jSkype/utils/preferences/preference"),o=e("jSkype/services/preferences/proofProvider"),u=e("jSkype/services/serviceFactory"),a=e("jSkype/modelHelpers/contacts/dataHandlers/factory");t.build=function(){return new f}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-flags-service-api/lib/flagsService",["require","exports","lodash-compat","reqwest","swx-browser-globals"],e)}(function(e,t){function u(e,t,n,r){var s=i.getWindow();return{dataType:"json",method:e,url:r.replace(/\/$/,"")+"/"+n,crossOrigin:!0,headers:{"X-Skypetoken":s.encodeURIComponent(t)}}}function a(e,t,n,i){return Promise.resolve(r.compat(u(e,t,n,i)))}function f(e){return new o(e)}var n=e("lodash-compat"),r=e("reqwest"),i=e("swx-browser-globals"),s=1e3,o=function(){function e(e){this.apiUrl=e,this._resetGlobalState()}return e.prototype.read=function(e,t){return this.getAllFlags(t).then(function(t){return n.includes(t,e)})},e.prototype.update=function(e,t,n){var r=i.getWindow();return a(t?"PUT":"DELETE",n,r.encodeURIComponent(e.toString()),this.apiUrl).catch(function(e){if(e&&e.status&&e.status===404)return;throw e})},e.prototype._resetGlobalState=function(){var e=this;this.getAllFlags=n.throttle(function(t){return a("GET",t,"",e.apiUrl)},s,{trailing:!1})},e}();t.build=f}),define("swx-flags-service-api",["swx-flags-service-api/lib/flagsService"],function(e){return e}),define("jSkype/services/preferences/flagsServiceProvider",["require","lodash-compat","swx-flags-service-api","jSkype/client","jSkype/settings","utils/common/builderMixin"],function(e){function u(){o=n.build(i.settings.flagsApiUrl)}function a(e){this.flagId=e,o||u()}var t=e("lodash-compat"),n=e("swx-flags-service-api"),r=e("jSkype/client"),i=e("jSkype/settings"),s=e("utils/common/builderMixin"),o;return a.prototype.read=function(){var t=this,n=Promise.resolve(r.get().signInManager._skypeToken());return n.then(function(e){return o.read(t.flagId,e)})},a.prototype.update=function(t){var n=this,i=r.get().signInManager._skypeToken();return i.then(function(e){return o.update(n.flagId,t,e)})},t.assign(a,s),a._resetGlobalState=u,a}),define("jSkype/services/preferences/defaultToTrueFlagProvider",["require","lodash-compat","jSkype/services/preferences/flagsServiceProvider","utils/common/builderMixin"],function(e){function i(e){n.call(this,e)}var t=e("lodash-compat"),n=e("jSkype/services/preferences/flagsServiceProvider"),r=e("utils/common/builderMixin");return i.prototype.read=function(){return n.prototype.read.call(this).then(function(e){return!e})},i.prototype.update=function(e){return n.prototype.update.call(this,!e)},t.assign(i,r),i}),define("jSkype/services/preferences/optionsServiceProvider",["require","lodash-compat","jSkype/client","jSkype/settings","reqwest","browser/window","utils/common/builderMixin"],function(e){function u(e){this.keyName=e}var t=e("lodash-compat"),n=e("jSkype/client"),r=e("jSkype/settings"),i=e("reqwest"),s=e("browser/window"),o=e("utils/common/builderMixin");return u.prototype.read=function(){var t=this,o=Promise.all([n.get().signInManager._skypeToken(),n.get().personsAndGroupsManager.mePerson.id.get()]);return o.then(function(e){var n=e[0],o=e[1],u={dataType:"json",url:r.settings.userOptionsService.host+r.settings.userOptionsService.optionsEndpoint,crossOrigin:!0,headers:{"X-Skypetoken":s.encodeURIComponent(n)}};return u.url=u.url.replace("${userId}",s.encodeURIComponent(o)).replace("${optionName}",s.encodeURIComponent(t.keyName)),Promise.resolve(i.compat(u)).then(function(e){return e.status?null:e.optionInt},function(){return null})})},u.prototype.update=function(t){var o=this,u=Promise.all([n.get().signInManager._skypeToken(),n.get().personsAndGroupsManager.mePerson.id.get()]);return u.then(function(e){var n=e[0],u=e[1],a={dataType:"json",url:r.settings.userOptionsService.host+r.settings.userOptionsService.optionsEndpoint,crossOrigin:!0,method:"POST",headers:{"X-Skypetoken":s.encodeURIComponent(n)},data:"integerValue="+t};return a.url=a.url.replace("${userId}",s.encodeURIComponent(u)).replace("${optionName}",s.encodeURIComponent(o.keyName)),Promise.resolve(i.compat(a)).then(function(e){return e.status?Promise.reject(e):e})})},t.assign(u,o),u}),define("jSkype/services/preferences/callPolicyProvider",["require","lodash-compat","jSkype/services/preferences/optionsServiceProvider","swx-enums","utils/common/builderMixin"],function(e){function s(){n.call(this,"OPT_SKYPE_CALL_POLICY")}var t=e("lodash-compat"),n=e("jSkype/services/preferences/optionsServiceProvider"),r=e("swx-enums"),i=e("utils/common/builderMixin");return s.prototype.read=function(){return n.prototype.read.call(this).then(function(e){return e===2?r.privacyPolicyValues.ContactsOnly:r.privacyPolicyValues.Anyone})},s.prototype.update=function(e){return n.prototype.update.call(this,e===r.privacyPolicyValues.ContactsOnly?2:0)},t.assign(s,i),s}),define("jSkype/services/preferences/videoPolicyProvider",["require","lodash-compat","jSkype/services/preferences/flagsServiceProvider","swx-enums","utils/common/builderMixin"],function(e){function s(){this.allowVideoCallsFromContactsOnly=n.build(r.skypeFlagsApiMappings.ALLOW_VIDEO_CALLS_FROM_CONTACTS_ONLY),this.dontAllowVideoCalls=n.build(r.skypeFlagsApiMappings.DONT_ALLOW_VIDEO_CALLS),this.cachedValue=null}var t=e("lodash-compat"),n=e("jSkype/services/preferences/flagsServiceProvider"),r=e("swx-enums"),i=e("utils/common/builderMixin");return s.prototype.read=function(){var t=this;return Promise.all([this.allowVideoCallsFromContactsOnly.read(),this.dontAllowVideoCalls.read()]).then(function(e){var n=e[0],i=e[1];return i?(n&&t.allowVideoCallsFromContactsOnly.update(!1),t.cachedValue=r.privacyPolicyValues.NoOne):n?t.cachedValue=r.privacyPolicyValues.ContactsOnly:t.cachedValue=r.privacyPolicyValues.Anyone})},s.prototype.update=function(t){var n=this,i=t===r.privacyPolicyValues.NoOne,s=t===r.privacyPolicyValues.ContactsOnly,o=[];return(s||this.cachedValue===r.privacyPolicyValues.ContactsOnly||this.cachedValue===null)&&o.push(this.allowVideoCallsFromContactsOnly.update(s)),(i||this.cachedValue===r.privacyPolicyValues.NoOne||this.cachedValue===null)&&o.push(this.dontAllowVideoCalls.update(i)),Promise.all([o]).then(function(){n.cachedValue=t})},t.assign(s,i),s}),define("jSkype/services/preferences/readReceiptsProvider",["require","lodash-compat","jSkype/services/preferences/optionsServiceProvider","utils/common/builderMixin"],function(e){function i(){n.call(this,"OPT_READ_RECEIPT_OPTOUT")}var t=e("lodash-compat"),n=e("jSkype/services/preferences/optionsServiceProvider"),r=e("utils/common/builderMixin");return i.prototype.read=function(){return n.prototype.read.call(this).then(function(e){return e===0||e===1?!e:e})},i.prototype.update=function(e){return n.prototype.update.call(this,e?0:1)},t.assign(i,r),i}),define("jSkype/utils/preferences/config",["require","exports","module","swx-enums","constants/common","jSkype/services/preferences/autoBuddyProvider","jSkype/services/preferences/profileServiceProvider","jSkype/services/preferences/flagsServiceProvider","jSkype/services/preferences/defaultToTrueFlagProvider","jSkype/services/preferences/callPolicyProvider","jSkype/services/preferences/videoPolicyProvider","jSkype/services/preferences/readReceiptsProvider"],function(e,t){var n=e("swx-enums"),r=e("constants/common"),i=e("jSkype/services/preferences/autoBuddyProvider"),s=e("jSkype/services/preferences/profileServiceProvider"),o=e("jSkype/services/preferences/flagsServiceProvider"),u=e("jSkype/services/preferences/defaultToTrueFlagProvider"),a=e("jSkype/services/preferences/callPolicyProvider"),f=e("jSkype/services/preferences/videoPolicyProvider"),l=e("jSkype/services/preferences/readReceiptsProvider"),c=r.featureFlags,h=r.userSettings.preferences,p=n.skypeFlagsApiMappings,d=n.preferenceType,v=[];v.push({featureFlag:c.URL_PREVIEWS,id:h.URL_PREVIEWS,type:d.Boolean,provider:{"const":u,args:[p.URL_PREVIEWS]},defaultValue:!0}),v.push({featureFlag:c.YOUTUBE_PLAYER_ENABLED,id:h.YOUTUBE_PLAYER,type:d.Boolean,provider:{"const":o,args:[p.YOUTUBE_PLAYER]},defaultValue:!1}),v.push({featureFlag:c.URL_PREVIEW_LOAD_YOUTUBE_PLAYER,id:h.YOUTUBE_PLAYER,type:d.Boolean,provider:{"const":o,args:[p.YOUTUBE_PLAYER]},defaultValue:!1}),v.push({featureFlag:c.MENTIONS_ENABLED,id:h.MENTIONS,type:d.Boolean,provider:{"const":u,args:[p.MENTIONS]},defaultValue:!0}),v.push({featureFlag:c.FILE_PASTE_ENABLED,id:h.FILE_PASTE,type:d.Boolean,provider:{"const":o,args:[p.FILE_PASTE]},defaultValue:!1}),v.push({featureFlag:c.SKYPE_CALL_POLICY_SUPPORT,id:h.SKYPE_CALL_POLICY_SUPPORT,type:d.CallPolicy,provider:{"const":a},defaultValue:n.privacyPolicyValues.Anyone}),v.push({featureFlag:c.SKYPE_VIDEO_CALLING_POLICY_SUPPORT,id:h.SKYPE_VIDEO_CALLING_POLICY_SUPPORT,type:d.VideoPolicy,provider:{"const":f},defaultValue:n.privacyPolicyValues.Anyone}),v.push({featureFlag:c.READ_RECEIPT_ENABLED,id:h.READ_RECEIPT,type:d.Boolean,provider:{"const":l},defaultValue:!1}),v.push({featureFlag:c.SHORT_CIRCUIT_SUPPORT,id:h.AUTO_BUDDY,type:d.AutoBuddy,provider:{"const":i},defaultValue:!1}),v.push({featureFlag:c.SHORT_CIRCUIT_SUPPORT,id:h.AUTO_BUDDY_DISCOVERY,type:d.AutoBuddyDiscovery,provider:{"const":s},defaultValue:!1,disableReporting:!0}),t.preferences=v}),define("jSkype/utils/preferences",["require","exports","module","lodash-compat","jSkype/settings","jSkype/utils/preferences/config","jSkype/utils/preferences/preference"],function(e,t){function o(e){var t=this;t.addPreference=function(t){e(t.id)||e.add(s.build(t),t.id)},t.init=function(){i.forEach(function(e){if(u(e.featureFlag)){var r=n.clone(e),i=e.provider;r.provider=i.const.build.apply(i.const,i.args),t.addPreference(r)}})}}function u(e){return r.isFeatureOn(e)}var n=e("lodash-compat"),r=e("jSkype/settings"),i=e("jSkype/utils/preferences/config").preferences,s=e("jSkype/utils/preferences/preference");t.build=function(e){var t=new o(e);t.init()},t.Preferences=o}),define("jSkype/modelHelpers/presence/presenceMapper",["require","exports","module","lodash-compat","swx-enums","jSkype/settings","constants/common"],function(e,t){var n=e("lodash-compat"),r=e("swx-enums"),i=e("jSkype/settings"),s=e("constants/common"),o={online:r.onlineStatus.Online,offline:r.onlineStatus.Offline,hidden:r.onlineStatus.Hidden,away:r.onlineStatus.Online,idle:r.onlineStatus.Online,busy:r.onlineStatus.Busy,unknown:r.onlineStatus.Unknown,berightback:r.onlineStatus.Online,donotdisturb:r.onlineStatus.Busy,onthephone:r.onlineStatus.Busy,outtolunch:r.onlineStatus.Online};t.map=function(e){if(n.isString(e)){var t=o[e.toLowerCase()];return t===r.onlineStatus.Unknown?undefined:t}},t.toCafeStatus=function(e){return r.onlineStatus[n.capitalize(e)]},t.canMapToOnline=function(e){var t=r.onlineStatus.Offline.toLowerCase(),n=r.onlineStatus.Idle.toLowerCase();return e=e.toLowerCase(),t===e||n===e},t.mapToSelf=function(e){if(!n.isString(e))return r.onlineStatus.Hidden;if(i.isFeatureOn(s.featureFlags.NEW_SELF_PRESENCE)){var t=o[e.toLowerCase()];return t===undefined||t===r.onlineStatus.Unknown||t===r.onlineStatus.Offline?r.onlineStatus.Hidden:t}return e.toLowerCase()===r.onlineStatus.Online.toLowerCase()?r.onlineStatus.Online:r.onlineStatus.Hidden}}),define("jSkype/modelHelpers/contacts/incomingContactRequestsHelper",["require","exports","module","jSkype/modelHelpers/contacts/dataHandlers/factory","jSkype/services/serviceFactory","jSkype/modelHelpers/personHelper","jSkype/client","jSkype/modelHelpers/propertyModelHelper"],function(e,t){var n=e("jSkype/modelHelpers/contacts/dataHandlers/factory"),r=e("jSkype/services/serviceFactory"),i=e("jSkype/modelHelpers/personHelper"),s=e("jSkype/client"),o=e("jSkype/modelHelpers/propertyModelHelper");t.get=function(){var e;return i.isGuest(s.get().personsAndGroupsManager.mePerson)?o.createResolvedPromise():(e=n.getContactRequestsIncomingHandlers(),r.getStratusService().getIncomingContactRequests().then(e.onSuccess,e.onError))}}),define("jSkype/modelHelpers/meData",["require","exports","module","jSkype/modelHelpers/contacts/dataHandlers/factory","jSkype/modelHelpers/contacts/incomingContactRequestsHelper","jSkype/services/serviceFactory","jcafe-property-model"],function(e,t){var n=e("jSkype/modelHelpers/contacts/dataHandlers/factory"),r=e("jSkype/modelHelpers/contacts/incomingContactRequestsHelper"),i=e("jSkype/services/serviceFactory"),s=e("jcafe-property-model");t.initialize=function(){var e=i.getStratusService(),t=n.getMeProfileHandlers(),o,u;return o=e.getProfile().then(t.onSuccess,t.onError),u=r.get(),s.task.waitAll([o,u])}}),define("jSkype/modelHelpers/mePersonSettings",["require","exports","module","jSkype/client","jSkype/services/serviceFactory","swx-enums","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/modelHelpers/contacts/dataHandlers/factory"],function(e,t){function u(){function u(e){if(e===i.selfSettings.autoBuddy){var t,u=o.getPeopleSettingsHandlers();return t=r.getPeopleService().getSettings().then(u.onSuccess,u.onError),t.then(a.bind(null,e),a.bind(null,e,!1)),t}return e===i.selfSettings.linkedMSA?new Promise(function(t){n.get().signInManager._skypeToken().then(function(n){var r=!1,i=s.extractCIDFromToken(n);i!==undefined&&(r=!0),a(e,r),t(r)})}):Promise.reject("Key not recognized")}function a(e,n){t[e]=n}var e=this,t={};e.get=function(e){return typeof t[e]!="undefined"?Promise.resolve(t[e]):u(e)}}var n=e("jSkype/client"),r=e("jSkype/services/serviceFactory"),i=e("swx-enums"),s=e("jSkype/modelHelpers/personsAndGroupsHelper"),o=e("jSkype/modelHelpers/contacts/dataHandlers/factory");t.build=function(){return new u}}),define("jSkype/models/mePerson",["require","jcafe-property-model","jSkype/services/calling/environmentInspector","jSkype/settings","utils/calling/callingStack","jSkype/telemetry/logging/callingLogTracer","jSkype/models/person","jSkype/models/account","jSkype/utils/preferences","swx-enums","constants/common","jSkype/modelHelpers/presence/presenceMapper","jSkype/services/serviceFactory","jSkype/modelHelpers/presence/presenceDataStorage","jSkype/client","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/modelHelpers/meData","jSkype/modelHelpers/contacts/dataHandlers/factory","jSkype/modelHelpers/mePersonSettings"],function(e){function b(e){function N(){var e;return function(){return e||(e=C()),e}}function C(){var e=g.getUserInfoHandlers();return h.getStratusService().getUserInfo().then(e.onSuccess,e.onError)}function k(){r.isFeatureOn(l.featureFlags.CALLING)?(n.isCallingSupported.changed(function(e,t){s.log("[MePerson] calling support changed",e,t),L(e,t),A(e,t)}),O()):(p.capabilities.audio._set(!1,f.callingNotSupportedReasons.FeatureDisabled),p.capabilities.video._set(!1,f.callingNotSupportedReasons.FeatureDisabled))}function L(e,t){s.log("[MePerson] set audio capability",e,t),p.capabilities.audio._set(e,t)}function A(e,t){var n=e,r=t;if(i.get().isPluginlessCallingSupported()){var o=Boolean(d.get().devicesManager.selectedCamera());e&&!o&&(r=f.callingNotSupportedReasons.CameraUnavailable),n=e&&o}s.log("[MePerson] set video capability",n,r),p.capabilities.video._set(n,r)}function O(){i.get().isPluginlessCallingSupported()&&d.get().devicesManager.selectedCamera.changed(function(){A(n.isCallingSupported(),n.isCallingSupported.reason)})}function M(){return i.get().isPluginlessCallingSupported()?d.get().devicesManager.selectedCamera():!0}function _(){return n.isCallingSupported.get().then(function(e){return L(e,n.isCallingSupported.reason),e})}function D(){return n.isCallingSupported.get().then(function(e){return A(e,n.isCallingSupported.reason),Boolean(e&&M())})}var p=this,b,S,x,T=N();o.call(p,e),p.capabilities.audio=t.property({readOnly:!0,get:_}),p.capabilities.video=t.property({readOnly:!0,get:D}),p._msaId=t.property({readOnly:!0}),p.account=new u,p.id=t.property({readOnly:!0,value:e,get:function(){function r(){d.get().signInManager._skypeToken().then(function(e){if(e===x){n.resolve(S);return}x=e;try{var t=v.extractSkypeIdFromToken(e);S=t,p.id._set(t),p.displayName._set(t),n.resolve(t)}catch(r){n.reject(r)}})}var n=t.task();return d.get().signInManager.state.once(f.loginState.SignedIn,r),n.promise}}),p.displayName=t.property({readOnly:!0,value:e,get:function(){return b||(b=t.task(),p.id.get().then(function(){function e(){b.resolve(p.displayName())}m.initialize().then(e,b.reject.bind(b))})),b.promise}}),p.preferences=t.collection({readOnly:!0}),a.build(p.preferences),p.status=t.property({value:f.onlineStatus.Offline,set:function(r){var i=t.task("setting ME status",r),s=c.toCafeStatus(r);return w(s)?(E(e,s),i.resolve(s)):i.reject(new Error("new status value was invalid")),i.promise}}),p.status.reset=function(){},p._registeredAt=t.property({readOnly:!0,get:function(){var n=t.task();return T().then(function(){n.resolve(p._registeredAt())},function(e){n.reject(e)}),n.promise}}),p._settings=y.build(),p.updateAvatar=function(t,n){var r=h.getStratusService();return r.updateAvatar(p.id(),t,n)},p.updateAvatarUrl=function(t){p.avatarUrl._set(t)},p.active=t.boolProperty(!0),p._reset=function(){p.id._set(e),p.displayName._set(e),b=null,p.status._set(f.onlineStatus.Offline),k()},p._initAVCapabilities=k}function w(e){return e&&e!==f.onlineStatus.Unknown}function E(e,t){var n=h.getPresenceService();n.setUserPresence(t),p.getCache().set(e,{status:t})}var t=e("jcafe-property-model"),n=e("jSkype/services/calling/environmentInspector"),r=e("jSkype/settings"),i=e("utils/calling/callingStack"),s=e("jSkype/telemetry/logging/callingLogTracer").get(),o=e("jSkype/models/person"),u=e("jSkype/models/account"),a=e("jSkype/utils/preferences"),f=e("swx-enums"),l=e("constants/common"),c=e("jSkype/modelHelpers/presence/presenceMapper"),h=e("jSkype/services/serviceFactory"),p=e("jSkype/modelHelpers/presence/presenceDataStorage"),d=e("jSkype/client"),v=e("jSkype/modelHelpers/personsAndGroupsHelper"),m=e("jSkype/modelHelpers/meData"),g=e("jSkype/modelHelpers/contacts/dataHandlers/factory"),y=e("jSkype/modelHelpers/mePersonSettings");return b.prototype=new o,b.prototype.constructor=b,b}),define("jSkype/modelHelpers/search/match/multiWord",["require","exports","module","swx-utils-common"],function(e,t){function s(e,t){var n=new RegExp("(^|\\s|\\b)"+t,"i");return e.match(n)}var n=e("swx-utils-common").stringUtils,r=10,i=/\s?\b\s?/;t.func=function(e,t){function l(e,t){if(s(e,f))return o={rank:t/r},!0}var o=null,u=n.clean(t),a=n.clean(e),f;return s(a,u)&&(f=u.split(i)[0],a.split(i).some(l)),o}}),define("jSkype/modelHelpers/search/match/singleWord",["require","exports","module","lodash-compat"],function(e,t){var n=e("lodash-compat");t.func=function(e,t){var r=new RegExp(n.escapeRegExp(t),"i");return!!e.match(r)}}),define("jSkype/modelHelpers/search/match",["require","exports","module","swx-utils-common","jSkype/modelHelpers/search/match/multiWord","jSkype/modelHelpers/search/match/singleWord","jSkype/modelHelpers/propertyValidator"],function(e,t){function u(e,t){return e.rank?t.rank+e.rank:t.rank}var n=e("swx-utils-common").stringUtils,r=e("jSkype/modelHelpers/search/match/multiWord"),i=e("jSkype/modelHelpers/search/match/singleWord"),s=e("jSkype/modelHelpers/propertyValidator");t.displayNameRule={property:"displayName",rank:1,method:r},t.idRule={property:"id",rank:2,method:i},t.phoneNumberRule={property:"phoneNumber",rank:0,method:i};var o=[t.displayNameRule,t.idRule];t.get=function(e,r){var i=null;return s.isPhoneNumber(r)?e.phoneNumbers().some(function(s){t.phoneNumberRule.property=s;var o=t.getMatch(t.phoneNumberRule,n.normalize(s.displayString()),n.normalize(r),e);if(o)return i=o,!0}):o.some(function(s){var o=e[s.property](),u=t.getMatch(s,n.normalize(o),n.normalize(r),e);if(u)return i=u,!0}),i},t.getMatch=function(e,t,r,i){var s=null,o=e.method.func(n.normalize(t),n.normalize(r));return o&&(s={},s.rank=u(o,e),s.property=e.property,s.sortString=i.displayName(),s.person=i),s}}),define("utils/common/array",["require","exports","module","swx-utils-common"],function(e,t){function r(e,t){var r=n.normalize(e.toLowerCase().trim()),i=n.normalize(t.toLowerCase().trim());return r<i?-1:r>i?1:0}var n=e("swx-utils-common").stringUtils;t.sortByProperty=function(e,t){function n(e,t){return e[t]}return e.sort(function(e,i){return r(n(e,t),n(i,t))})},t.sortByObservableProperty=function(e,t){function n(e,t){return e[t]()}return e.sort(function(e,i){return r(n(e,t),n(i,t))})},t.insertAt=function(e,t,n){e.splice(t,0,n)},t.swapItems=function(e,t,n){var r=e[t];e[t]=e[n],e[n]=r},t.removeFrom=function(e,t){return e.splice(t,1)[0]}}),define("jSkype/modelHelpers/search/sort",["require","exports","module","utils/common/array"],function(e,t){function r(e){var t={};return e.forEach(function(e){t[e.rank]||(t[e.rank]=[]),t[e.rank].push(e)}),t}function i(e){return Object.keys(e).forEach(function(t){e[t]=n.sortByProperty(e[t],"sortString")}),e}function s(e){var t=[];return Object.keys(e).sort().forEach(function(n){t=t.concat(e[n])}),t}var n=e("utils/common/array");t.run=function(e){var t=r(e);return t=i(t),s(t)}}),define("jSkype/modelHelpers/search/directoryDataHandler",["require","exports","module","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/modelHelpers/contacts/dataMappers/factory","lodash-compat"],function(e,t){var n=e("jSkype/modelHelpers/personsAndGroupsHelper"),r=e("jSkype/modelHelpers/contacts/dataMappers/factory"),i=e("lodash-compat");t.onResult=function(e){function s(e,r){var i,s;return r.ContactCards?(i=o(r.ContactCards),i?(s=n.getUnknownPerson(i),s?(t.map(r.ContactCards,s),e.push(s),e):e):e):e}function o(e){return e.Skype?e.Skype.SkypeName:e.Lync?e.Lync.SkypeName:""}var t=r.getDirectorySearchMapper();return e&&e.response?i.reduce(e.response,s,[]):[]}}),define("jSkype/modelHelpers/search/directorySearchByIdDataHandler",["require","exports","module","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/modelHelpers/contacts/dataMappers/factory"],function(e,t){var n=e("jSkype/modelHelpers/personsAndGroupsHelper"),r=e("jSkype/modelHelpers/contacts/dataMappers/factory");t.onResult=function(e){var t=[],i=r.getDirectorySearchByIdMapper();return e&&e.response&&e.response.data&&e.response.data.forEach(function(e){if(e.skypename){var r=n.getUnknownPerson(e.skypename);r&&(i.map(e,r),t.push(r))}}),t}}),define("jSkype/modelHelpers/search/main",["require","exports","module","lodash-compat","jSkype/client","jcafe-property-model","constants/common","jSkype/settings","swx-agentProvisioningService","jSkype/modelHelpers/contacts/dataMappers/agentToPerson","jSkype/modelHelpers/search/match","jSkype/modelHelpers/search/sort","jSkype/services/serviceFactory","jSkype/models/searchResult","jSkype/constants/people","jSkype/modelHelpers/search/directoryDataHandler","jSkype/modelHelpers/search/directorySearchByIdDataHandler","jSkype/modelHelpers/propertyModelHelper","jSkype/modelHelpers/personsRegistry/instance","jSkype/modelHelpers/personsAndGroupsHelper"],function(e,t){function w(e){var t=g.build().get(e);return t?[T(t)]:[]}function E(e){var t={};for(var n in e.keywords)e.keywords.hasOwnProperty(n)&&e.supportedKeywords(n)&&(t[n]=e.keywords[n]);return t}function S(e){var t=e.text();return n.isString(t)&&(x(t).forEach(function(t){e.keywords[t[0].trim()]=t[1].trim()}),e.text(t.replace(b,"").trim())),e}function x(e){function n(e){return e.split(":")}var t=e.match(b);return t?t.map(n):[]}function T(e){var t;return e.person?(t=new h(e.person),t.relevance=e.rank,t.matches[e.property]=e.sortString):t=new h(e),t}function N(e){switch(e.result._authorization()){case p.AUTHORIZED:case p.PENDING_OUTGOING:case p.SUGGESTED:return!0;default:return!1}}var n=e("lodash-compat"),r=e("jSkype/client"),i=e("jcafe-property-model"),s=e("constants/common"),o=e("jSkype/settings"),u=e("swx-agentProvisioningService"),a=e("jSkype/modelHelpers/contacts/dataMappers/agentToPerson"),f=e("jSkype/modelHelpers/search/match"),l=e("jSkype/modelHelpers/search/sort"),c=e("jSkype/services/serviceFactory"),h=e("jSkype/models/searchResult"),p=e("jSkype/constants/people").authorizationStates,d=e("jSkype/modelHelpers/search/directoryDataHandler"),v=e("jSkype/modelHelpers/search/directorySearchByIdDataHandler"),m=e("jSkype/modelHelpers/propertyModelHelper"),g=e("jSkype/modelHelpers/personsRegistry/instance"),y=e("jSkype/modelHelpers/personsAndGroupsHelper"),b=/\s*(\w+:[\w\.\_\-\+]+)/gi;t.agents=function(){var e=r.get().signInManager._skypeToken,t=u.build(e,o.settings.agentProvisioningService);return t.search().then(function(e){return e.agentDescriptions.map(function(e){var t=y.getPersonById(e.agentId);return t||(t=y.createDefaultPerson(e.agentId)),new h(a.map(e,t))})}).catch(function(e){throw r.get()._telemetryManager.sendEvent(o.settings.telemetry.jSkypeTenantToken,"ServiceFault",{serviceName:"agents-search",faultCode:e.status,faultContext:s.telemetry.NOT_AVAILABLE,errorCode:e.status||s.telemetry.NOT_AVAILABLE,errorMessage:e.responseText||s.telemetry.NOT_AVAILABLE,verb:"GET",host:o.settings.agentProvisioningService.host}),e})},t.addressBook=function(e,t){var r,s,o,u,a;if(!t)return m.createResolvedPromise([]);r=i.task(),u=[],a=[],o=E(S(t)),s=t.text();if(o.id){var c=e(o.id);c&&(u.push(f.getMatch(f.idRule,c.id(),o.id,c)),a.push(c))}else o.phoneNumber?n.forEach(e(),function(e){n.forEach(e.phoneNumbers(),function(t){t.displayString()===o.phoneNumber&&(u.push(f.getMatch(f.phoneNumberRule,t.displayString(),o.phoneNumber,e)),a.push(c))})}):a=e();return n.isString(s)&&s.length&&(u=[],a.forEach(function(e){var t=f.get(e,s);t&&u.push(t)})),r.resolve(l.run(u).map(T).filter(N)),r.promise},t.skypeDirectory=function(e){var t,n,r,s;if(!e)return m.createResolvedPromise([]);r=i.task(),s=c.getStratusService(),t=E(S(e)),n=e.text();if(!t.id&&!n)return r.resolve([]),r.promise;if(t.id){var o=w(t.id);o.length>0?r.resolve(o):s.searchDirectoryById(t.id).then(function(t){var n=v.onResult(t);r.resolve(n.map(T))},function(t){r.reject(t)})}else s.searchDirectory(n).then(function(t){var n=d.onResult(t);r.resolve(n.map(T))},function(t){r.reject(t)});return r.promise},t.all=function(e,n){var r=i.task();return t.addressBook(e,n).then(function(e){e.length===0?t.skypeDirectory(n).then(function(e){r.resolve(e)}):r.resolve(e)}),r.promise}}),define("jSkype/models/personSearchQuery",["require","jSkype/client","jcafe-property-model","jSkype/models/searchQuery","jSkype/settings","swx-enums","lodash-compat","jSkype/modelHelpers/search/main","jSkype/modelHelpers/propertyModelHelper","constants/common"],function(e){function l(){function c(){var r,i,o,a,f=t.get().personsAndGroupsManager;if(!f._initialized())return p(f);r=n.task(),o=e.sources(),a=f.all.persons;switch(o){case s.searchScope.Agent:i=u.agents(e);break;case s.searchScope.AddressBook:i=u.addressBook(a,e);break;case s.searchScope.SkypeDirectory:i=u.skypeDirectory(e);break;case s.searchScope.All:i=u.all(a,e);break;default:return r.reject(new Error("Required property sources was not valid.")),r.promise}return i.then(function(n){n.forEach(function(t){e.results._add(t)}),h(o,e.text(),n),r.resolve()},function(t){r.reject(t)}),r.promise}function h(e,n,r){var o={},u=n?n.length:0,a=r?r.length:0;o.name=e,o.queryLength=u,o.resultCount=a;if(e===s.searchScope.AddressBook){var l=t.get().personsAndGroupsManager.all.persons().length;o.totalContactsCount=l}i.isFeatureOn(f.featureFlags.TELEMETRY_SEARCH_ENABLED)&&t.get()._telemetryManager.sendEvent(i.settings.telemetry.jSkypeTenantToken,f.telemetry.search.TYPE,o)}function p(){var e=n.task(),r=t.get().personsAndGroupsManager;return r._initialized.changed(function(t){t&&c().then(e.resolve.bind(e),e.reject.bind(e))}),e.promise}var e=this,l=n.collection();o.merge(e,new r),l.add("id","id"),l.add("phoneNumber","phoneNumber"),e.supportedKeywords=a.exposeReadOnlyCollection(l),e.getMore=n.command(c,e.moreResultsAvailable)}var t=e("jSkype/client"),n=e("jcafe-property-model"),r=e("jSkype/models/searchQuery"),i=e("jSkype/settings"),s=e("swx-enums"),o=e("lodash-compat"),u=e("jSkype/modelHelpers/search/main"),a=e("jSkype/modelHelpers/propertyModelHelper"),f=e("constants/common");return l}),define("jSkype/models/personsAndGroupsManager",["require","swx-enums","jcafe-property-model","jSkype/models/group","jSkype/models/allGroup","jSkype/models/mePerson","jSkype/models/personSearchQuery","jSkype/constants/people"],function(e){function f(){this._initialized=n.property({value:!1}),this.mePerson=new s(u),this.all=new i(this.mePerson),this.all.groups.add(l(),a)}function l(){var e=new r(t.groupType.PrivacyRelationship);return e.relationshipLevel._set(a),e.persons=c(e.persons),e}function c(e){return e.asWritable({add:function(n){var r=n.id();e(r)||e.add(n,r)},remove:function(n){e.remove(n.id())}})}var t=e("swx-enums"),n=e("jcafe-property-model"),r=e("jSkype/models/group"),i=e("jSkype/models/allGroup"),s=e("jSkype/models/mePerson"),o=e("jSkype/models/personSearchQuery"),u=e("jSkype/constants/people").SELF,a=t.groupPrivacyRelationshipLevel.Blocked;return f.prototype.createPersonSearchQuery=function(){return new o},f.prototype.createGroupSearchQuery=function(){throw new Error("Not implemented!")},f.prototype.createGroup=function(){return new r(t.groupType.Custom)},f.prototype._reset=function(){this._initialized(!1),this.mePerson._reset(),this.all._reset()},f}),define("jSkype/services/trouter/handlers/contactChangesMessageHandler",["require","exports","module","constants/common"],function(e,t){function s(e){this.handleMessage=function(t){var n={isHandled:!0,resultCode:i.OK};switch(t.eventId){case r.OFFLINE_AUTHREQUEST:return e.onIncomingContactRequestNotification(t.body),n;case r.CONTACTLIST_CHANGE:return e.onContactListChangedNotification(t.body),n}return{isHandled:!1}}}var n=e("constants/common"),r=n.events.trouter,i=n.httpStatusCodes;t.build=function(e){return new s(e)}}),define("jSkype/modelHelpers/contacts/notificationHandlers",["require","exports","module","jSkype/client","jSkype/services/serviceFactory","jSkype/services/trouter/trouter","jSkype/services/trouter/handlers/contactChangesMessageHandler","jSkype/modelHelpers/contacts/incomingContactRequestsHelper","jSkype/modelHelpers/contacts/dataHandlers/factory","jSkype/services/contacts/serviceSettings"],function(e,t){function f(){var e=u.getContactListHandlers();this.onContactListChangedNotification=function(){var t=n.get().personsAndGroupsManager.mePerson.id();r.getContactsService().getMyContacts(t,a.reasons.notification).then(e.onSuccess,e.onError)},this.onIncomingContactRequestNotification=o.get}var n=e("jSkype/client"),r=e("jSkype/services/serviceFactory"),i=e("jSkype/services/trouter/trouter"),s=e("jSkype/services/trouter/handlers/contactChangesMessageHandler"),o=e("jSkype/modelHelpers/contacts/incomingContactRequestsHelper"),u=e("jSkype/modelHelpers/contacts/dataHandlers/factory"),a=e("jSkype/services/contacts/serviceSettings");t.build=function(){var e=new f;return i.registerMessageHandler(s.build(e)),e}}),define("jSkype/services/trouter/handlers/accountChangesMessageHandler",["require","exports","module","constants/common"],function(e,t){function s(e){this.handleMessage=function(t){var n={isHandled:!0,resultCode:i.OK};switch(t.eventId){case r.USER_SERVICES_CHANGE:return e.onUserServicesChange(t.body),n}return{isHandled:!1}}}var n=e("constants/common"),r=n.events.trouter,i=n.httpStatusCodes;t.build=function(e){return new s(e)}}),define("jSkype/modelHelpers/account/dataHandlers/account",["require","exports","module","jSkype/client","jSkype/services/entitlement/serviceSettings"],function(e,t){function i(){function t(t){i(t)&&(e.displayBalance._set(t.balanceFormatted),e._balance._set(t.balance),e._currency._set(t.attributes.currency))}function i(e){return e.service===r.serviceNames.credit}var e=n.get().personsAndGroupsManager.mePerson.account;this.onSuccess=function(e){return e.response.forEach(t),Promise.resolve()},this.onError=function(e){return Promise.reject(e)}}var n=e("jSkype/client"),r=e("jSkype/services/entitlement/serviceSettings");t.classFunction=i,t.build=function(){return new i}}),define("jSkype/modelHelpers/account/dataHandlers/factory",["require","exports","module","jSkype/modelHelpers/account/dataHandlers/account"],function(e,t){var n={account:e("jSkype/modelHelpers/account/dataHandlers/account")};t.getAccountChangedHandler=function(){return n.account.build()}}),define("jSkype/modelHelpers/account/notificationHandlers",["require","exports","module","jSkype/client","jSkype/settings","jSkype/constants/featureFlags","jSkype/services/serviceFactory","jSkype/services/trouter/trouter","jSkype/services/trouter/handlers/accountChangesMessageHandler","jSkype/modelHelpers/account/dataHandlers/factory"],function(e,t){function f(){function t(){return r.isFeatureOn(i.CREDIT_BALANCE_AUTO_UPDATE_ENABLED)}var e=a.getAccountChangedHandler();this.onUserServicesChange=function(){if(!t())return;var r=n.get().personsAndGroupsManager.mePerson.id();s.getEntitlementService().getEntitlementListingData(r).then(e.onSuccess,e.onError)}}var n=e("jSkype/client"),r=e("jSkype/settings"),i=e("jSkype/constants/featureFlags"),s=e("jSkype/services/serviceFactory"),o=e("jSkype/services/trouter/trouter"),u=e("jSkype/services/trouter/handlers/accountChangesMessageHandler"),a=e("jSkype/modelHelpers/account/dataHandlers/factory");t.build=function(){var e=new f;return o.registerMessageHandler(u.build(e)),e}}),define("jSkype/constants/events",{actions:{subscriptionCreation:"subscriptioncreation",getUserPresence:"getuserpresence",setUserPresence:"setuserpresence",getSelfProperties:"getselfproperties",messageSubmitted:"messagesubmitted"},contacts:{CONTACTS_LOADED:"contactsLoaded"},resourceTypes:{USER_PRESENCE:"userpresence"}}),define("jSkype/modelHelpers/presence/presenceDataHandler",["require","exports","module","lodash-compat","jSkype/client","constants/common","jSkype/services/webapi/constants","jSkype/constants/people","swx-enums","jSkype/settings","jSkype/services/serviceFactory","jSkype/modelHelpers/presence/presenceDataStorage","jSkype/modelHelpers/presence/presenceMapper","jSkype/modelHelpers/contacts/dataMappers/dataMaps","jSkype/modelHelpers/personHelper","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/models/person"],function(e,t){function m(){var e=!0,t={serviceStarted:!1,sendContacts:null};this.onInitialContacts=function(e){t.serviceStarted?y(e):t.sendContacts=g(y,e)},this.onMePresenceSet=function(e){if(e.selfLink&&e.status){var t=r.get()._telemetryManager,n={name:i.telemetry.presence.name.SET_ME_PRESENCE,presence:e.status};t.sendEvent(a.settings.telemetry.jSkypeTenantToken,i.telemetry.presence.TYPE,n)}},this.onSelfProperties=function(e){var t=r.get().personsAndGroupsManager,n=t.mePerson,i=e.primaryMemberName,s=e.skypeName;if(!s||!i)return;s!==i&&n._msaId._set(p.getKey(i,h.contactTypes.msn))},this.onPresence=function(e){if(e.selfLink&&e.status){var t=E(e.selfLink),n=p.getId(t),r=N(e),i=C(r);k(t)?S(e.status):x(n,e.status,e.lastSeenAt,i)}},this.onBatchPresenceUpdated=function(t){if(t&&e){var n=r.get()._telemetryManager,s={name:i.telemetry.presence.name.GET_CONTACTS_PRESENCE,batchCount:t};n.sendEvent(a.settings.telemetry.jSkypeTenantToken,i.telemetry.presence.TYPE,s),e=!1}},this.onServiceError=function(e){e.actionName===s.SERVICE_CALLS.SET_USER_PRESENCE&&S(u.onlineStatus.Hidden)},this.onServiceStarted=function(){t.serviceStarted=!0,t.sendContacts&&t.sendContacts()},this.onOnlineStateChanged=function(e){var t=r.get().personsAndGroupsManager,n=t.all.persons(),s=t.mePerson;e===i.onlineStates.OFFLINE?(s.status._set(u.onlineStatus.Hidden),n.forEach(function(e){!p.isPstn(e)&&e.status()!==u.onlineStatus.Unknown&&e.status._set(u.onlineStatus.Hidden)})):e===i.onlineStates.ONLINE&&l.getCache().restore(t)}}function g(e,t){return function(){e(t)}}function y(e){if(!a.isFeatureOn(i.featureFlags.DO_NOT_SEND_CONTACTS_TO_CHAT_SERVICE)){var t=n.filter(e,b);if(t.length>0){var r=f.getPresenceService();r.sendContactsList(t)}}}function b(e){return w(e)||(e=d.getPersonById(e.id())),!!e&&p.canAddToChatServiceContactList(e)}function w(e){return e instanceof v}function E(e){var t=/\/users\/(.+)\/presenceDocs/,n=e.match(t);return n&&n[1]}function S(e){var t=r.get().personsAndGroupsManager.mePerson,n;c.canMapToOnline(e)?t.status(u.onlineStatus.Online):(n=c.mapToSelf(e),t.status._set(n),l.getCache().set(t.id(),{status:n}))}function x(e,t,n,r){var i=d.getPersonById(e);if(i){var s=c.map(t);T(s,i)&&i.status._set(s),i.endpointType._set(r),i.lastSeenAt(n),l.getCache().set(e,{status:s,lastSeenAt:n,endpointType:r})}}function T(e,t){return e&&!t.isAgent()&&!p.isPstn(t)&&!p.isEchoContact(t)}function N(e){var t=e.capabilities;return t?t.split("|").map(function(e){return e.toLowerCase().trim()}):[]}function C(e){var t=o.endpoints.MOBILE.toLowerCase();return e.indexOf(t)!==-1?u.endpointType.Mobile:u.endpointType.Desktop}function k(e){var t=r.get().personsAndGroupsManager.mePerson,n=p.getKey(t.id());return e===n||e===t._msaId()}var n=e("lodash-compat"),r=e("jSkype/client"),i=e("constants/common"),s=e("jSkype/services/webapi/constants"),o=e("jSkype/constants/people"),u=e("swx-enums"),a=e("jSkype/settings"),f=e("jSkype/services/serviceFactory"),l=e("jSkype/modelHelpers/presence/presenceDataStorage"),c=e("jSkype/modelHelpers/presence/presenceMapper"),h=e("jSkype/modelHelpers/contacts/dataMappers/dataMaps"),p=e("jSkype/modelHelpers/personHelper"),d=e("jSkype/modelHelpers/personsAndGroupsHelper"),v=e("jSkype/models/person");t.build=function(){return new m}}),define("jSkype/modelHelpers/presence/presenceDataEvents",["require","constants/common","jSkype/constants/events","jSkype/modelHelpers/presence/presenceDataHandler","jSkype/services/internalPubSub"],function(e){function o(e){return e.resourceType.toLowerCase()===n.resourceTypes.USER_PRESENCE}var t=e("constants/common"),n=e("jSkype/constants/events"),r=e("jSkype/modelHelpers/presence/presenceDataHandler"),i=e("jSkype/services/internalPubSub"),s={init:function(){function u(e){function r(e){o(e)&&(s.onPresence(e.resource),n++)}var t=e.eventMessages,n=0;t?(t.forEach(r),s.onBatchPresenceUpdated(n)):a(e)}function a(e){var t=e.actionName.toLowerCase(),r=n.actions;if(t===r.subscriptionCreation)return s.onServiceStarted();if(t===r.setUserPresence)return s.onMePresenceSet(e);if(t===r.getSelfProperties)return s.onSelfProperties(e)}var e=i.get(),s=r.build();e.subscribe("webapi:data",u),e.subscribe("webapi:error",s.onServiceError),e.subscribe("contacts:loaded",s.onInitialContacts),e.subscribe(t.events.system.ONLINE_STATE_CHANGED,s.onOnlineStateChanged)}};return s}),define("jSkype/modelHelpers/dataOrchestrator",["require","exports","module","lodash-compat","constants/common","utils/common/cache/instance","jSkype/constants/data","jSkype/modelHelpers/contacts/notificationHandlers","jSkype/modelHelpers/account/notificationHandlers","jSkype/modelHelpers/presence/presenceDataEvents","jSkype/modelHelpers/presence/presenceDataStorage","jSkype/modelHelpers/personsAndGroupsHelper","jSkype/settings","jSkype/modelHelpers/contacts/dataProcessors/agents","jSkype/client"],function(e,t){function d(){return p.get().personsAndGroupsManager.all.persons.get()}function v(){return i.get().removeItem(s.ETAG)}function m(){function e(e,t){var n=l.createPersonFromRawData(t);return t.isAgent&&e.push(n),e}return i.get().getSensitiveItem(s.CONTACT_PROFILES).then(function(t){var r;if(!t||!t.length)throw new Error("Empty contact cache; force service delta reset");return r=n.reduce(t,e,[]),h.build().process(r)})}function g(){return f.restoreData()}var n=e("lodash-compat"),r=e("constants/common"),i=e("utils/common/cache/instance"),s=e("jSkype/constants/data").storageKeys,o=e("jSkype/modelHelpers/contacts/notificationHandlers"),u=e("jSkype/modelHelpers/account/notificationHandlers"),a=e("jSkype/modelHelpers/presence/presenceDataEvents"),f=e("jSkype/modelHelpers/presence/presenceDataStorage"),l=e("jSkype/modelHelpers/personsAndGroupsHelper"),c=e("jSkype/settings"),h=e("jSkype/modelHelpers/contacts/dataProcessors/agents"),p=e("jSkype/client");t.initialize=function(){return p.get().personsAndGroupsManager.mePerson.id.get().then(function(){return o.build(),u.build(),a.init(),p.get().conversationsManager._init(),c.isFeatureOn(r.featureFlags.CONTACT_PROFILE_CACHE)?m().then(function(){return g().then(d,d)},function(){return v().then(d,d).then(g,g)}):g().then(d,d)})}}),define("jSkype/services/calling/incomingCallMessageProxy",["require","exports","module","jSkype/client","jSkype/settings","jSkype/services/callController","utils/calling/callingStack","constants/common","usertiming","browser/window","lodash-compat"],function(e,t){function d(){function v(e,t){return f.some(e,function(e){return e===t})}function m(){var e=u.getEntriesByName(h.CALLING.INCOMING.TBN),t=e&&e.length>0&&e[0].duration?e[0].duration:"undefined",i={name:p.P2P_TO_NGC_NOTIFICATION_DURATION,duration:t};n.get()._telemetryManager.sendEvent(r.settings.telemetry.jSkypeTenantToken,p.MASTER_EVENT,i)}function g(e){v(o,e.convoCallId)||(t.push(e.convoCallId),u.mark(c.CALLING.INCOMING.P2P_IN_PLUGINLESS_START))}function y(e){o.push(e.convoCallId),v(t,e.convoCallId)&&(u.mark(c.CALLING.INCOMING.P2P_IN_PLUGINLESS_END),u.measure(h.CALLING.INCOMING.TBN,c.CALLING.INCOMING.P2P_IN_PLUGINLESS_START,c.CALLING.INCOMING.P2P_IN_PLUGINLESS_END),m(),u.clearMarks(c.CALLING.INCOMING.P2P_IN_PLUGINLESS_START),u.clearMarks(c.CALLING.INCOMING.P2P_IN_PLUGINLESS_END),u.clearMeasures(h.CALLING.INCOMING.TBN))}function b(){a.clearTimeout(d),i.handleIncoming(e),e=null}var e=null,t=[],o=[],d;this.handleMessage=function(t){e=t,s.get().isPluginlessCallingSupported()&&t.evt===l.INCOMING_CALL?(g(t),d=a.setTimeout(function(){b()},r.settings.incomingCalls.p2pToNgcNotificationTimeout)):(y(t),b())}}var n=e("jSkype/client"),r=e("jSkype/settings"),i=e("jSkype/services/callController"),s=e("utils/calling/callingStack"),o=e("constants/common"),u=e("usertiming"),a=e("browser/window"),f=e("lodash-compat"),l=o.events.trouter,c=o.telemetry.performanceMarks,h=o.telemetry.measurements,p=o.telemetry.calling;t.build=function(){return new d}}),define("jSkype/services/trouter/handlers/incomingCallMessageHandler",["require","exports","module","jSkype/modelHelpers/personHelper","constants/common","jSkype/telemetry/logging/callingLogTracer","jSkype/services/calling/incomingCallMessageProxy","jSkype/settings","jSkype/modelHelpers/propertyValidator","constants/common"],function(e,t){function c(){function t(e){return e.eventId===i.INCOMING_CALL}function r(e){return e.eventId===i.INCOMING_SKYPE_NGC_CALL||e.eventId===i.INCOMING_SKYPE_NGC_GVC_CALL||e.eventId===i.INCOMING_LYNC_NGC_CALL}function c(e){return t(e)||r(e)}function p(e){return f.isPhoneNumber(e.body.callerId)}function d(){return a.isFeatureOn(l.featureFlags.NG_CALLING)}function v(){return a.isFeatureOn(l.featureFlags.PSTN_ENABLED)}function m(e){var t={evt:e.body.evt,callerId:e.body.callerId,displayName:e.body.displayName,convoCallId:e.body.convoCallId,nsp:e.body.nsp,body:{gp:e.body.gp}},r=e.body.conversationId||e.body.callerId;return r?(t.conversationId=n.getKey(r),o.log("Incoming P2P payload",t),t):(o.log("Rejecting due to missing conversationId in payload"),!1)}function g(e){var t={},r,i;try{r=atob(e.body.gp),i=JSON.parse(r)}catch(s){return o.error("Error when parsing gp payload",e.body.gp),!1}return i.callNotification?(t.conversationId=i.groupChat&&i.groupChat.threadId?i.groupChat.threadId:i.callNotification.from.id,t.callerId=n.getId(i.callNotification.from.id),t.convoCallId=i.debugContent.callId,t.ngcCall=!0,t.nsp=e.body.nsp||"",t.body=e.body,t.evt=e.body.evt,o.log("Incoming NGC payload",t),t):(o.log("Unable to create incoming NGC payload"),!1)}var e=u.build();this.handleMessage=function(n){var i;o.log("Incoming trouter notification",n);if(!c(n))return h(!1);if(p(n)&&!v())return o.log("Rejecting due to PSTN incoming calls not enabled"),h(!0,s.preconditionFailed);if(t(n)){i=m(n);if(!i)return h(!0,s.unprocessableEntity)}if(r(n)&&d()){i=g(n);if(!i)return h(!0,s.badRequest)}return i?(e.handleMessage(i),h(!0,s.OK)):h(!0,s.unprocessableEntity)}}function h(e,t){return{isHandled:e,resultCode:t}}var n=e("jSkype/modelHelpers/personHelper"),r=e("constants/common"),i=r.events.trouter,s=r.httpStatusCodes,o=e("jSkype/telemetry/logging/callingLogTracer").get(),u=e("jSkype/services/calling/incomingCallMessageProxy"),a=e("jSkype/settings"),f=e("jSkype/modelHelpers/propertyValidator"),l=e("constants/common");t.build=function(){return new c}}),define("jSkype/services/trouter/handlers/stopRingingMessageHandler",["require","exports","module","jSkype/services/callRegister","jSkype/services/callController","constants/common","constants/common"],function(e,t){function o(){this.handleMessage=function(e){if(e.eventId!==i.INCOMING_STOP_RINGER&&e.eventId!==i.INCOMING_SKYPE_NGC_STOP_RINGER)return{isHandled:!1};if(!e.body.callId)return{isHandled:!1};var t=n.get().getConversationByCallId(e.body.callId);return t&&r.cancelCall(t),{isHandled:!0,resultCode:s.OK}}}var n=e("jSkype/services/callRegister"),r=e("jSkype/services/callController"),i=e("constants/common").events.trouter,s=e("constants/common").httpStatusCodes;t.build=function(){return new o}}),define("jSkype/services/outOfBrowser/shellApp/pstnEventsDispatcher",["require","constants/outOfBrowser"],function(e){function n(e){this.process=function(n,r,i,s){e.sendCommand({name:t.commands.PSTN_EVENT,type:t.commandTypes.REQUEST,data:{state:s,conversationId:n.conversationId,participantId:r.person.id(),reason:i}})}}var t=e("constants/outOfBrowser");return n}),define("jSkype/services/outOfBrowser/shellApp/browserCommandHandler",["require","exports","module","jcafe-property-model","constants/outOfBrowser","jSkype/telemetry/logging/callingLogTracer","jSkype/services/callController","jSkype/services/callRegister","jSkype/modelHelpers/calling/pstnEventsHandler","jSkype/services/outOfBrowser/shellApp/pstnEventsDispatcher","jSkype/client","jSkype/settings","jSkype/modelHelpers/participantHelper","swx-enums","constants/common","browser/window"],function(e,t){function v(e){function b(){var e=o.get().activeCalls(),t=!1;return e.length===0&&(t=!0),e.forEach(function(e){e.selfParticipant.audio.state()===h.callConnectionState.Disconnected?t=!0:e.audioService.stop()}),t}function w(e){return e.contactsData&&f.get().personsAndGroupsManager.all.persons().forEach(function(t){try{e.contactsData[t.id()]&&t.status._set(e.contactsData[t.id()].status)}catch(n){i.warn("Unable to apply contact data")}}),m&&(v=d.setTimeout(S,l.settings.shellApp.contactPollingInterval)),Promise.resolve()}function E(){d.clearTimeout(v),m=!1}function S(){e.sendCommand({name:r.commands.CONTACTS_DATA_REQUEST,type:r.commandTypes.REQUEST})}function x(e){return f.get()._telemetryManager.setCommonProperty("shellAppHost",e.shellAppHost),d.shellApp.invoke(r.shellAppMethods.ShowWindow),d.shellApp.addEventListener(r.shellAppEvents.WindowClosing,b),l.isFeatureOn(p.featureFlags.GVC_LOCAL_ESCALATION)&&(m=!0,S()),n.task().resolve().promise}function T(){return d.shellApp.removeEventListener(r.shellAppEvents.WindowClosing,b),d.shellApp.invoke(r.shellAppMethods.HideWindow),E(),n.task().resolve().promise}function N(e){return P().then(function(){var t=F(e.conversationId);return t._autoCallingService.shellAppCanHost(!0),Promise.resolve()})}function C(e){return P().then(function(){var t=F(e.conversationId);return e.joinCall?t._setCanJoinCall(!0,e.callHostId,{AccessToken:e.accessToken}):t._setCanJoinCall(!1),t._autoCallingService.shellAppCanJoin(!0),Promise.resolve()})}function k(e){return i.log("[BrowserCommandHelper] startHandler",e),P().then(function(){var t=F(e.conversationId),n=I(t,e.withVideo);return i.log("[BrowserCommandHelper] startHandler, conversation synced",t),g&&H(e,t)&&t.participants(0).audio.endpoint(e.endpoint),c.updateParticipantsAudioVideoState(t,h.callConnectionState.Disconnected),y.subscribeToConversation(t),e.autoCall?(t._autoCallingService.autoCallingMode(e.autoCallMode),t._autoCallingService.partnerId(e.autoCallPartnerId),t._autoCallingService.callId(e.autoCallId),t._autoCallingService.setupAutoCallTelemetry(),t.autoCall(!0)):e.joinCall?t._setCanJoinCall(!0,e.callHostId,{AccessToken:e.accessToken}):t._setCanJoinCall(!1),B(t),n.start()})}function L(e){return i.log("[BrowserCommandHelper] acceptHandler",e),P().then(function(){function f(){r.accept(),o.resolve()}function l(e){e!==h.callDisconnectionReason.CallEscalated&&M()}function c(e,t,n){n&&e===h.callConnectionState.Disconnected&&(o.promise.state()==="pending"&&(o.reject(t),l(t)),u&&u.dispose(),a&&a.dispose())}var t=F(e.conversationId),r=I(t,e.withVideo),o=n.task(),u,a;return i.log("[BrowserCommandHelper] acceptHandler, conversation synced",t),B(t),e.incomingCallData.length?(u=t.selfParticipant.audio.state.once(h.callConnectionState.Notified,f),a=t.selfParticipant.audio.state.changed(c),e.incomingCallData.forEach(function(e){s.handleIncoming(e).catch(o.reject.bind(o))})):o.reject(),o.promise})}function A(e){return P().then(function(){return e.incomingCallData.forEach(function(e){s.handleIncoming(e)}),Promise.resolve()})}function O(e){return function(n){var r=F(n.conversationId);return r.selfParticipant.audio.isMuted.set(e)}}function M(){E(),d.shellAppInfo.supportsPreloading?d.shellApp.invoke(r.shellAppMethods.HideWindow):d.shellApp.invoke(r.shellAppMethods.CloseWindow)}function _(e){d.shellApp.removeEventListener(r.shellAppEvents.WindowClosing,b);var t=F(e.conversationId);return y.dispose(),t.audioService.stop()}function D(e){var t=F(e.conversationId);return t._callHandler?t._callHandler.requestCallInfo():Promise.reject()}function P(){return f.get().conversationsManager._conversationsSynced.promise}function H(e,t){return e.endpoint&&e.endpoint!==t.conversationId&&!t.isGroupConversation()}function B(t){function n(u,a,f){if(!f)return;if(u===h.callConnectionState.Notified)return;u===h.callConnectionState.Disconnecting&&j()&&(a=h.callDisconnectionReason.MissingSpeaker),u===h.callConnectionState.Disconnected&&(t.selfParticipant.audio.state.changed.off(n),t.selfParticipant.audio.isMuted.changed.off(i),t.spawnedConversation.changed.off(s),t.spawnedConversation._set(undefined),t._callData.pluginCallInfo.changed.off(o)),e.sendCommand({name:r.commands.CHANGE_STATE,type:r.commandTypes.REQUEST,data:{state:u,conversationId:t.conversationId,reason:a}})}function i(n){var i;if(n===undefined)return;n?i=r.commands.MUTE:i=r.commands.UNMUTE,e.sendCommand({name:i,type:r.commandTypes.REQUEST,data:{conversationId:t.conversationId}})}function s(n){e.sendCommand({name:r.commands.ESCALATE_CONVERSATION,type:r.commandTypes.REQUEST,data:{newConversationId:n.conversationId,oldConversationId:t.conversationId}}),B(n)}function o(){e.sendCommand({name:r.commands.CALL_INFO,type:r.commandTypes.REQUEST,data:{conversationId:t.conversationId,messageBody:t._callData.pluginCallInfo()}})}t.selfParticipant.audio.state.changed(n),t.selfParticipant.audio.isMuted.changed(i),t.spawnedConversation.changed(s),t._callData.pluginCallInfo.changed(o)}function j(){var e=f.get().devicesManager;return e._initializedDevices&&e.speakers().length===0}function F(e){var t=f.get().conversationsManager._getOrCreateConversation(e);return f.get().conversationsManager.conversations.add(t),t}function I(e,t){var n;return t?n=e.videoService:n=e.audioService,n}function q(e){var t=e.settingsType,n=e.value;f.get().personsAndGroupsManager.mePerson.preferences(t).value.set(n)}var t,v,m,g=l.isFeatureOn(p.featureFlags.PSTN_ENABLED),y=u.build(new a(e));t={show:x,hide:T,start:k,hostCall:N,joinCall:C,accept:L,updateIncomingCallPayload:A,mute:O(!0),unmute:O(!1),stop:_,callInfo:D,contactsData:w,settings:q},e.registerCommandHandler(r.commands.SHOW,t.show),e.registerCommandHandler(r.commands.HIDE,t.hide),e.registerCommandHandler(r.commands.START,t.start),e.registerCommandHandler(r.commands.HOST_CALL,t.hostCall),e.registerCommandHandler(r.commands.JOIN_CALL,t.joinCall),e.registerCommandHandler(r.commands.ACCEPT,t.accept),e.registerCommandHandler(r.commands.UPDATE_INCOMING_PAYLOAD,t.updateIncomingCallPayload),e.registerCommandHandler(r.commands.MUTE,t.mute),e.registerCommandHandler(r.commands.UNMUTE,t.unmute),e.registerCommandHandler(r.commands.STOP,t.stop),e.registerCommandHandler(r.commands.CALL_INFO,t.callInfo),e.registerCommandHandler(r.commands.CONTACTS_DATA_RESPONSE,t.contactsData),e.registerCommandHandler(r.commands.SETTINGS_UPDATE,t.settings)}var n=e("jcafe-property-model"),r=e("constants/outOfBrowser"),i=e("jSkype/telemetry/logging/callingLogTracer").get(),s=e("jSkype/services/callController"),o=e("jSkype/services/callRegister"),u=e("jSkype/modelHelpers/calling/pstnEventsHandler"),a=e("jSkype/services/outOfBrowser/shellApp/pstnEventsDispatcher"),f=e("jSkype/client"),l=e("jSkype/settings"),c=e("jSkype/modelHelpers/participantHelper"),h=e("swx-enums"),p=e("constants/common"),d=e("browser/window");t.build=function(e){return new v(e)}}),define("jSkype/services/outOfBrowser/shellApp/messagingChannel",["require","exports","module","constants/outOfBrowser"],function(e,t){function r(){function r(r){var i=r.data;if(i.type===n.commandTypes.REQUEST){var s={name:i.name,type:n.commandTypes.RESPONSE},o=function(){e.sendCommand(s)},u=function(t){s.error=t,e.sendCommand(s)},a;try{var f=t[i.name];a=Promise.resolve(f(i.data))}catch(l){a=Promise.reject(l)}a.then(o,u)}}var e=this,t={};window.shellApp.addEventListener(n.shellAppEvents.MessageReceived,r),e.sendCommand=function(e){window.shellApp.invoke(n.shellAppMethods.PostMessage,{message:e})},e.registerCommandHandler=function(e,n){t[e]=n}}var n=e("constants/outOfBrowser");t.build=function(){return new r}}),define("jSkype/services/outOfBrowser/shellApp/shellAppLogs",["require","exports","module","jSkype/settings","constants/common","constants/outOfBrowser","browser/window"],function(e,t){var n=e("jSkype/settings"),r=e("constants/common"),i=e("constants/outOfBrowser"),s=e("browser/window");t.intercept=function(e){if(!n.isFeatureOn(r.featureFlags.SHELL_APP_LOGS))return;var t=["log","warn","info","error"];t.forEach(function(t){s.console&&s.console[t]&&(s.console[t]=function(){try{var n={name:i.commands.SHELL_APP_LOG,type:i.commandTypes.REQUEST,data:{logs:s.btoa(JSON.stringify(Array.prototype.slice.call(arguments))),method:t}};e.sendCommand(n)}catch(r){}})})}}),define("jSkype/services/outOfBrowser/shellApp/shellAppExperience",["require","exports","module","jSkype/services/outOfBrowser/shellApp/browserCommandHandler","jSkype/services/outOfBrowser/shellApp/messagingChannel","jSkype/services/outOfBrowser/shellApp/shellAppLogs","constants/outOfBrowser"],function(e,t){var n=e("jSkype/services/outOfBrowser/shellApp/browserCommandHandler"),r=e("jSkype/services/outOfBrowser/shellApp/messagingChannel"),i=e("jSkype/services/outOfBrowser/shellApp/shellAppLogs"),s=e("constants/outOfBrowser");t.init=function(){function o(e,n,r){var i={name:e,type:n};r&&(i.data=r),t.sendCommand(i)}var e={},t;return t=r.build(),n.build(t),i.intercept(t),o(s.commands.INIT,s.commandTypes.RESPONSE),e.sendPluginErrorCommand=function(e){o(s.commands.PLUGIN_ERROR,s.commandTypes.REQUEST,e)},e}}),define("jSkype/services/calling/callingInitializer",["require","exports","module","jSkype/client","browser/detect","utils/calling/callingStack","jSkype/settings","jSkype/services/callHandlerFactory","jSkype/services/calling/environmentInspector","swx-enums","jSkype/services/trouter/handlers/incomingCallMessageHandler","jSkype/services/NGCCallAgent/NGCCallAgent/ngcAgent","constants/plugin.const","jSkype/services/trouter/handlers/stopRingingMessageHandler","jSkype/services/outOfBrowser/shellApp/shellAppExperience","jSkype/services/trouter/trouter"],function(e,t){function v(){d.registerMessageHandler(f.build()),d.registerMessageHandler(h.build())}var n=e("jSkype/client"),r=e("browser/detect"),i=e("utils/calling/callingStack"),s=e("jSkype/settings"),o=e("jSkype/services/callHandlerFactory"),u=e("jSkype/services/calling/environmentInspector"),a=e("swx-enums"),f=e("jSkype/services/trouter/handlers/incomingCallMessageHandler"),l=e("jSkype/services/NGCCallAgent/NGCCallAgent/ngcAgent"),c=e("constants/plugin.const"),h=e("jSkype/services/trouter/handlers/stopRingingMessageHandler"),p=e("jSkype/services/outOfBrowser/shellApp/shellAppExperience"),d=e("jSkype/services/trouter/trouter");t.preSignInInitialize=function(){s.settings.isPollingEnabled&&v()},t.postSignInInitialize=function(){function f(e){if(!e)return;n.get().conversationsManager._conversationsSynced.promise.then(o.initialize).then(null,function(e){e===c.PLUGIN_ERRORS.REASON_ALREADY_EXISTS&&u.disableCalling(a.callingNotSupportedReasons.PluginAlreadyRunning),r.getBrowserInfo().isShellApp&&t.sendPluginErrorCommand(e)})}var t;i.get().isPluginlessCallingSupported()&&l.initialize(),r.getBrowserInfo().isShellApp&&(t=p.init()),s.settings.isPollingEnabled&&d.start(),n.get().personsAndGroupsManager.mePerson._initAVCapabilities(),u.checkForCallingSupport(!1).then(f)},t.destroy=function(){s.settings.isPollingEnabled&&d.stop(),o.dispose()}}),define("jSkype/services/keyEncryption",["require","jSkype/services/serviceAccessLayer/serviceLocator","jSkype/services/stratus/optionsBuilder","jSkype/settings","constants/common"],function(e){function s(){function o(e){var t=new n;return t.setOption("payload",JSON.stringify(e)),t.build()}var e=r.isFeatureOn(i.featureFlags.KEY_ENCRYPTION_SERVICE_V2_ENABLED)?r.settings.keyEncryptionServiceHostV2:r.settings.keyEncryptionServiceHost,s=t.build(e);this.decrypt=function(e){return o(e).then(function(e){return s.post("/key",e)})},this.encrypt=function(e){return o(e).then(function(e){return s.post("/newkey",e)})}}var t=e("jSkype/services/serviceAccessLayer/serviceLocator"),n=e("jSkype/services/stratus/optionsBuilder"),r=e("jSkype/settings"),i=e("constants/common");return s}),define("jSkype/application",["require","helpers/polyfills","lodash-compat","constants/common","swx-enums","jSkype/client","jcafe-property-model","jSkype/models/signInManager","jSkype/models/translatorService","jSkype/services/messageSearch/main","jSkype/models/marketplaceManager","jSkype/models/conversationsManager","jSkype/models/devicesManager","jSkype/models/personsAndGroupsManager","jSkype/modelHelpers/dataOrchestrator","jSkype/settings","jSkype/services/asyncMedia/main","jSkype/services/calling/callingInitializer","jSkype/services/keyEncryption","jSkype/services/serviceFactory","jSkype/services/webapi/constants","jSkype/services/spaces","utils/common/logTracer/api","utils/common/cache/instance","swx-utils-common"],function(e){function T(e){var T=this;return e=t.defaults({},e,{settings:{}}),d.settings=e.settings,x.remove("chat-4171"),E.configure({logToConsole:d.isFeatureOn(n.featureFlags.CONSOLE_LOGGING),logToBuffer:d.isFeatureOn(n.featureFlags.ISSUE_REPORTING),logUnhandled:d.isFeatureOn(n.featureFlags.ISSUE_REPORTING),reporting:{enabled:d.isFeatureOn(n.featureFlags.ERROR_LOG_REPORTING),throttleInterval:d.settings.telemetry?d.settings.telemetry.logThrottleInterval:0,telemetryManager:e.telemetryManager,telemetryToken:d.settings.telemetry?d.settings.telemetry.logReportingToken:null}}),T._standbyMode=s.property({value:d.isFeatureOn(n.featureFlags.SUPPORT_STANDBY_MODE)}),T._telemetryManager=e.telemetryManager,T._telemetry=e.telemetry,T.signInManager=o.build(),T.personsAndGroupsManager=new h,T.conversationsManager=new l,T.devicesManager=new c,T.suspended=s.boolProperty(!1),T.marketplaceManager=new f,m.preSignInInitialize(),d.isFeatureOn(n.featureFlags.TRANSLATOR_SENDING_ENABLED)&&(T.translatorService=u.build()),d.isFeatureOn(n.featureFlags.CONTENT_SEARCH)&&(T._messagesSearchService=a.build()),T.signInManager.state.when(r.loginState.SignedIn,function(){S.get().init(g),p.initialize(),m.postSignInInitialize(),w.fetchConfig()}),T.signInManager.state.when(r.loginState.SigningOut,function(){S.get().destroy(),m.destroy(),T.suspended(!1),T.devicesManager._reset(),T.conversationsManager._reset().then(function(){T.personsAndGroupsManager._reset(),T.signInManager.state._set(r.loginState.SignedOut)})}),T.signInManager._skypeToken.changed(function(e){v.authenticate(e)}),T.isEndpointActive=s.property({value:!1,set:function(){function n(){T.isEndpointActive(!1)}function r(){y.getPresenceService().activateEndpoint(),e&&clearTimeout(e),e=setTimeout(n,b.ACTIVATE_ENDPOINT_TIMEOUT)}var e=null,i=t.debounce(r,0,{leading:!0,trailing:!1,maxWait:b.ACTIVATE_ENDPOINT_TIMEOUT-b.ACTIVATE_ENDPOINT_TOLERANCE});return function(e){return e&&i(),e}}()}),i.set(T),T}e("helpers/polyfills");var t=e("lodash-compat"),n=e("constants/common"),r=e("swx-enums"),i=e("jSkype/client"),s=e("jcafe-property-model"),o=e("jSkype/models/signInManager"),u=e("jSkype/models/translatorService"),a=e("jSkype/services/messageSearch/main"),f=e("jSkype/models/marketplaceManager"),l=e("jSkype/models/conversationsManager"),c=e("jSkype/models/devicesManager"),h=e("jSkype/models/personsAndGroupsManager"),p=e("jSkype/modelHelpers/dataOrchestrator"),d=e("jSkype/settings"),v=e("jSkype/services/asyncMedia/main"),m=e("jSkype/services/calling/callingInitializer"),g=e("jSkype/services/keyEncryption"),y=e("jSkype/services/serviceFactory"),b=e("jSkype/services/webapi/constants"),w=e("jSkype/services/spaces"),E=e("utils/common/logTracer/api"),S=e("utils/common/cache/instance"),x=e("swx-utils-common").sessionStorage;return T}),define("jSkype/root",["require","exports","module","jSkype/application","jSkype/settings"],function(e,t){var n=e("jSkype/application"),r=e("jSkype/settings");t.Application=n,t.version=r.version}),define("services/telemetry/common/telemetryContext",["require","constants/common"],function(e){function r(){this.sentEmoticonsInfo=[],this.sentMessagesInfo=[],this.receivedMessagesInfo=[],this.currentConversation=null,this.timelineLoadOrigin=t.telemetry.NOT_AVAILABLE,this.historyLoadOrigin=t.telemetry.NOT_AVAILABLE,this.timelineInSearchMode=t.telemetry.NOT_AVAILABLE,this.timelineLoadStatusCode=t.telemetry.NOT_AVAILABLE,this.activeEndpoints=t.telemetry.NOT_AVAILABLE,this.isChatHistoryLoad404=t.telemetry.NOT_AVAILABLE,this.chatHistoryLoadResult={},this.statusCode=!1}var t=e("constants/common"),n;return r.get=function(){return n||(n=new r),n},r}),define("services/telemetry/eventBus",["require","services/pubSub/pubSub"],function(e){var t=e("services/pubSub/pubSub");return{get:function(){return t}}}),define("telemetry/chat/activityItemHelper",["require","constants/common","swx-enums"],function(e){function i(){function e(e,t){return(e&t)!==0}function i(e){return e.originalContent||e.content}function s(n,r){e(r,t.telemetry.messageTypes.RICHTEXT_MASK)&&(e(r,t.telemetry.messageTypes.RICHTEXT_FORMAT)&&n.richtext.format++,e(r,t.telemetry.messageTypes.RICHTEXT_EMOTICONS)&&n.richtext.emoticons++,e(r,t.telemetry.messageTypes.RICHTEXT_ME)&&n.richtext.me++,n.richtext.total++)}this.updateResult=function(n,r){switch(r){case t.telemetry.messageTypes.MEDIA_VIDEO:n.media.video++;break;case t.telemetry.messageTypes.MEDIA_PICTURE:n.media.picture++;break;case t.telemetry.messageTypes.MEDIA_LOCATION:n.media.location++;break;case t.telemetry.messageTypes.CALLING_OTHER:n.calling.total++;break;case t.telemetry.messageTypes.FILES_PICTURE:n.files.picture++;break;case t.telemetry.messageTypes.FILES_VIDEO:n.files.video++;break;case t.telemetry.messageTypes.FILES_OFFICE:n.files.office++;break;case t.telemetry.messageTypes.FILES_ARCHIVE:n.files.zip++;break;case t.telemetry.messageTypes.FILES_BINARY:n.files.binary++;break;case t.telemetry.messageTypes.FILES_PDF:n.files.pdf++;break;case t.telemetry.messageTypes.CONTACT_OTHER:n.contact.total++;break;case t.telemetry.messageTypes.TEXT_ME:n.text.me++;break;case t.telemetry.messageTypes.OTHER_TYPES:n.other++;break;default:if(!e(r,t.telemetry.messageTypes.FILES_MASK|t.telemetry.messageTypes.RICHTEXT_MASK|t.telemetry.messageTypes.TEXT_MASK))throw new Error("Not supported:"+r)}e(r,t.telemetry.messageTypes.FILES_MASK)&&n.files.total++,e(r,t.telemetry.messageTypes.RICHTEXT_MASK)&&s(n,r),e(r,t.telemetry.messageTypes.TEXT_MASK)&&n.text.total++},this.getEmptyResult=function(){var e={media:{picture:0,video:0,location:0},files:{total:0,picture:0,video:0,office:0,zip:0,binary:0,pdf:0},richtext:{total:0,format:0,emoticons:0,me:0},text:{total:0,me:0},contact:{total:0},calling:{total:0},other:0};return e},this.getTelemetryMessageType=function(e){switch(e.type()){case n.activityType.VideoMessage:return t.telemetry.messageTypes.MEDIA_VIDEO;case n.activityType.PictureMessage:return t.telemetry.messageTypes.MEDIA_PICTURE;case n.activityType.CallStarted:case n.activityType.CallEnded:case n.activityType.CallMissed:return t.telemetry.messageTypes.CALLING_OTHER;case n.activityType.TextMessage:var r=0,i=e.html().indexOf("raw_pre")>-1;i&&(r|=t.telemetry.messageTypes.RICHTEXT_FORMAT);var s=e.html().indexOf('<span class="emoSprite">')>-1;return s&&(r|=t.telemetry.messageTypes.RICHTEXT_EMOTICONS),r===0?t.telemetry.messageTypes.RICHTEXT_OTHER:r;case n.activityType.CONTACTS:return t.telemetry.messageTypes.CONTACT_OTHER;default:return t.telemetry.messageTypes.OTHER_TYPES}},this.getTelemetryMessageTypeObsolete=function(e){switch(e.messagetype){case r.VIDEO:return t.telemetry.messageTypes.MEDIA_VIDEO;case r.PICTURE:return t.telemetry.messageTypes.MEDIA_PICTURE;case r.LOCATION:return t.telemetry.messageTypes.MEDIA_LOCATION;case r.CALL_EVENT:return t.telemetry.messageTypes.CALLING_OTHER;case r.FILE_TRANSFER:var n=new RegExp(".([a-z0-9]{1,4})<","i"),s=n.exec(i(e))[1];switch(s){case"png":case"jpg":case"gif":case"bmp":return t.telemetry.messageTypes.FILES_PICTURE;case"avi":case"mp4":case"mkv":return t.telemetry.messageTypes.FILES_VIDEO;case"xls":case"xlsx":case"doc":case"docx":case"ppt":case"pptx":return t.telemetry.messageTypes.FILES_OFFICE;case"zip":case"rar":case"ace":case"7z":return t.telemetry.messageTypes.FILES_ARCHIVE;case"exe":case"msi":case"iso":return t.telemetry.messageTypes.FILES_BINARY;case"pdf":return t.telemetry.messageTypes.FILES_PDF;default:return t.telemetry.messageTypes.FILES_OTHER}break;case r.RICH_TEXT:var o=0,u=i(e).indexOf("raw_pre")>-1;u&&(o|=t.telemetry.messageTypes.RICHTEXT_FORMAT);var a=i(e).indexOf("<ss")>-1;return a&&(o|=t.telemetry.messageTypes.RICHTEXT_EMOTICONS),e.skypeemoteoffset&&(o|=t.telemetry.messageTypes.RICHTEXT_ME),o===0?t.telemetry.messageTypes.RICHTEXT_OTHER:o;case r.CONTACTS:return t.telemetry.messageTypes.CONTACT_OTHER;case r.TEXT:if(e.skypeemoteoffset)return t.telemetry.messageTypes.TEXT_ME;return t.telemetry.messageTypes.TEXT_OTHER;default:return t.telemetry.messageTypes.OTHER_TYPES}},this.processConversation=function(e){var t=this.getEmptyResult(),n,r=e.historyService.activityItems();for(n=0;n<r.length;n++){var i=r[n],s=this.getTelemetryMessageType(i);this.updateResult(t,s)}return t}}var t=e("constants/common"),n=e("swx-enums"),r={VIDEO:"Event/SkypeVideoMessage",PICTURE:"RichText/UriObject",LOCATION:"RichText/Location",CALL_EVENT:"Event/Call",FILE_TRANSFER:"RichText/Files",RICH_TEXT:"RichText",CONTACTS:"RichText/Contacts",TEXT:"Text"};return new i}),define("services/telemetry/skypeData",["require","exports","module","experience/settings","ui/telemetry/telemetryClient"],function(e,t){function i(e,t){var n,r={},i=/([A-Z])/g;for(n in e.contextIds)if(e.contextIds.hasOwnProperty(n)){var o=n.replace(i,"_$1");s(t,o.toLowerCase(),e.contextIds[n])}return r}function s(e,t,n){var r=typeof n=="string"?n:String(n);e[t]=r}function o(e,t,n,r){typeof r=="object"?Object.keys(r).forEach(function(i){o(e,t,n+"_"+i,r[i])}):s(e,n,r)}function u(e,t){var n=e.data||{},r={};Object.keys(n).forEach(function(e){o(t,r,e,n[e])})}function a(e){return e.type?e.data?!0:!1:!1}function f(e){var t={};return u(e,t),i(e,t),t}var n=e("experience/settings"),r=e("ui/telemetry/telemetryClient");t.push=function(e){if(!a(e))return;var t=f(e);r.get().sendEvent(n.telemetry.uiTenantToken,e.type,t)}}),define("telemetry/chat/messagesSent",["require","services/telemetry/skypeData","constants/common","telemetry/chat/activityItemHelper"],function(e){function i(){this.publish=function(i){var s,o,u=0;if(i.length===0)return;var a=r.getEmptyResult();a.totalCount=i.length,a.failedCount=0,a.balance404Count=0,a.tts=[],a.t404=[];for(s=0;s<i.length;s++)o=i[s],r.updateResult(a,o.typeId),u+=o.tts,a.tts.push(o.tts),a.t404.push(o.t404),o.t404!==n.telemetry.NOT_AVAILABLE&&a.balance404Count++,o.isSuccess||a.failedCount++;a.tts.sort();var f={type:"chat_IM_sentBatch",data:a};a.ttsAvg=u/a.totalCount,a.deliveryRate=(1-a.failedCount/a.totalCount)*100,t.push(f)}}var t=e("services/telemetry/skypeData"),n=e("constants/common"),r=e("telemetry/chat/activityItemHelper");return i}),define("telemetry/chat/messagesReceived",["require","services/telemetry/skypeData","telemetry/chat/activityItemHelper"],function(e){function r(){this.publish=function(r){var i,s,o=0;if(r.length===0)return;var u=n.getEmptyResult();u.totalCount=r.length;for(i=0;i<r.length;i++)s=r[i],n.updateResult(u,s.typeId),s.appIsActive&&o++;u.inOpenedApp=o;var a={type:"chat_IM_receiveBatch",data:u};t.push(a)}}var t=e("services/telemetry/skypeData"),n=e("telemetry/chat/activityItemHelper");return r}),define("utils/common/styleModeHelper",["require","exports","module","lodash-compat","browser/window","vendor/knockout","constants/common","experience/settings"],function(e,t){function l(){function p(){var e=0;return l.length===0?r.innerWidth:(l.forEach(function(t){e+=t.offsetWidth}),e)}function d(){var t=p();e.currentMode(v(t))}function v(e){return e<=u.breakpoint.MEDIUM?u.NARROW:e>u.breakpoint.MEDIUM&&e<=u.breakpoint.WIDE?u.MEDIUM:u.WIDE}function m(){var e=n.find(f,function(e){return o.biAppName.toLowerCase().indexOf(e.toLowerCase())>-1});return e&&(c=e),!!e}var e=this,t=500,a=n.debounce(d,t),l=[],c,h=m();e.currentMode=i.observable(v(p())),h||r.addEventListener(s.events.browser.RESIZE,a),e.addContainer=function(t){l.push(t),e.currentMode(v(p()))},e.appIsVisible=function(){return l.length>0&&p()>0},e.isIntegratedProperty=function(){return h},e.host=function(){return c},e.dispose=function(){h||r.removeEventListener(s.events.browser.RESIZE,a),l=[]}}var n=e("lodash-compat"),r=e("browser/window"),i=e("vendor/knockout"),s=e("constants/common"),o=e("experience/settings"),u=s.styleMode,a=null,f={kahuna:"kahuna",owa:"outlook",o365:"o365",wac:"wac"};t.get=function(){return a===null&&(a=new l),a},t.dispose=function(){a!==null&&(a.dispose(),a=null)}}),define("telemetry/chat/messagesCollector",["require","constants/common","usertiming","telemetry/chat/activityItemHelper","telemetry/chat/messagesSent","telemetry/chat/messagesReceived","services/telemetry/common/telemetryContext","utils/common/styleModeHelper"],function(e){function p(){function d(){function t(){h=new o,h.publish(e.sentMessagesInfo),e.sentMessagesInfo=[],window.setTimeout(t,l)}function n(){p=new u,p.publish(e.receivedMessagesInfo),e.receivedMessagesInfo=[],window.setTimeout(n,c)}window.setTimeout(t,l),window.setTimeout(n,c)}var e=a.get(),h,p,v=function(s){var o=r.IM_SEND.TTS+s,u=r.IM_SEND.TTS404+s,a=n.IM_SEND.POST_START+s,f=n.IM_SEND.POST_END_OK+s,l=n.IM_SEND.POST_END_404+s,c=n.IM_SEND.POST_END_ERROR+s,h=i.getEntriesByName(f),p=h.length>0;p?(i.measure(o,a,f),i.clearMarks(f)):(i.measure(o,a,c),i.clearMarks(c));var d=t.telemetry.NOT_AVAILABLE,v=i.getEntriesByName(o);v&&v.length>0&&(d=v[0].duration);var m=t.telemetry.NOT_AVAILABLE,g=i.getEntriesByName(l),y=g.length>0;return y&&(i.measure(u,a,c),i.getEntriesByName(u)&&i.getEntriesByName(u).length>0&&(m=i.getEntriesByName(u)[0].duration),i.clearMeasures(u)),i.clearMarks(a),i.clearMeasures(o),{cmid:s,tts:d,t404:m,isSuccess:p}};this.enqueueSentMessageInfo=function(n){var r=v(n.clientmessageid);r.typeId=s.getTelemetryMessageTypeObsolete(n),e.sentMessagesInfo.push(r)},this.enqueueReceivedMessageInfo=function(n){var r={cmid:n.clientmessageid};r.typeId=s.getTelemetryMessageTypeObsolete(n),r.appIsActive=f.get().appIsVisible(),e.receivedMessagesInfo.push(r)},d()}var t=e("constants/common"),n=t.telemetry.performanceMarks,r=t.telemetry.measurements,i=e("usertiming"),s=e("telemetry/chat/activityItemHelper"),o=e("telemetry/chat/messagesSent"),u=e("telemetry/chat/messagesReceived"),a=e("services/telemetry/common/telemetryContext"),f=e("utils/common/styleModeHelper"),l=2e4,c=3e4,h;return p.get=function(){return h||(h=new p),h},p}),define("jCafe",["require","lodash-compat","jSkype/root","services/telemetry/common/telemetryContext","services/telemetry/eventBus","telemetry/chat/messagesCollector"],function(e){var t=e("lodash-compat"),n=e("jSkype/root"),r=e("services/telemetry/common/telemetryContext"),i=e("services/telemetry/eventBus"),s=e("telemetry/chat/messagesCollector"),o=t.clone(n);return o.Application=function(e){e=e||{};var o=t.clone(e);return o.telemetry={context:r.get(),messagesCollector:s.get(),eventBus:i.get()},new n.Application(o)},o.Application.create=o.Application,o}),define("utils/common/cafeObservable",["require","vendor/knockout"],function(e){function r(e,t){if(n[t])return n[t];for(var r in e)if(r!==t&&e[r]===e[t])return n[t]=r,r;return n[t]=t,t}function i(e){return t.utils.extend(e,t.observableArray.fn),e.extend({trackArrayChanges:!0})}function s(e,n){function l(){i.valueHasMutated()}function c(){var t;s.getSubscriptionsCount()||(e.observed()||(t=e.get.bind(e)),f&&(a=e.subscribe()),e.changed(l,t))}function h(){e.changed.off(l),a&&(a.dispose(),a=null)}var i=t.observable(),s,o,u,a,f;return n=n||{},f=n.keepAlive,s=t.pureComputed({deferEvaluation:!0,read:function(){return i(),e()}}),o=r(s,"subscribe"),u=s[o],s.subscribe=s[o]=function(){var e,t,n;return c(),t=r(s,"dispose"),e=u.apply(s,arguments),n=e[t].bind(e),e.dispose=e[t]=function(){n(),s.getSubscriptionsCount()||h()},e},s}function o(e,n){function c(){i.valueHasMutated()}function h(){var e;s&&!f&&u.getSubscriptionsCount()&&(s.observed()||(e=s.get.bind(s)),l&&(f=s.subscribe()),s.changed(c,e))}function p(){s&&!u.getSubscriptionsCount()&&(s.changed.off(c),f&&(f.dispose(),f=null))}var i=t.observable(),s,o,u,a,f,l;return n=n||{},l=n.keepAlive,u=t.pureComputed({deferEvaluation:!0,read:function(){return i(),s?s():e}}),o=r(u,"subscribe"),a=u[o],u.subscribe=u[o]=function(){var e,t,n;return t=r(u,"dispose"),e=a.apply(u,arguments),n=e[t].bind(e),h(),e.dispose=e[t]=function(){n(),p()},e},u.bindToProperty=function(e){s=e,h(),c()},u}function u(e,n){function h(){var t;o.getSubscriptionsCount()||(e.observed()||(t=e.get.bind(e)),c&&(l=e.subscribe()),f=f||e.observe(function(){s.valueHasMutated()}),t&&t())}function p(){f&&(f.dispose(),f=null),l&&(l.dispose(),l=null)}var s=t.observable(),o,u,a,f,l,c;return n=n||{},c=n.keepAlive,o=t.pureComputed({deferEvaluation:!0,read:function(){return s(),e()}}),u=r(o,"subscribe"),a=o[u].bind(o),o.subscribe=o[u]=function(){var e,t,n;return h(),t=r(o,"dispose"),e=a.apply(o,arguments),n=e[t].bind(e),e.dispose=e[t]=function(){n(),o.getSubscriptionsCount()===s.getSubscriptionsCount()&&p()},e},o=i(o),o}var t=e("vendor/knockout"),n={};return{newObservableProperty:s,newDeferredObservableProperty:o,newObservableCollection:u}}),define("ui/telemetry/actions/actionNames",{audioVideo:{videoCall:"av_call_with_video",audioCall:"av_call_with_audio",pstnCall:"av_call_with_pstn",apiVideoCall:"av_api_call_with_video",apiAudioCall:"av_api_call_with_audio",toggleMute:"av_mute_unmute",toggleVideo:"av_video_on_off",toggleFullScreen:"av_full_screen",toggleNarrowMenu:"av_narrow_menu",toggleDialpad:"av_dialpad_on_off",zoomInOut:"av_zoom_in_out",endCall:"av_end_call",acceptWithAudio:"av_accept_with_audio",acceptWithVideo:"av_accept_with_video",reject:"av_reject_call",joinCall:"av_join_call",moreActions:"av_more_actions",addParticipants:"av_add_participants",shareScreen:"av_share_screen",stopSharingScreen:"av_stop_sharing_screen",submitParticipantsIn1to1:"av_submit_participants_in_1_1",submitParticipantsInGroup:"av_submit_participants_in_group",pluginInstall:{start:"av_plugin_install_start",installExtension:"av_install_extension",installPlugin:"av_install_plugin",restart:"av_plugin_install_restart",leave:"av_plugin_install_leave",stayInFlow:"av_plugin_install_cancel_leave"},timeline:{endCall:"av_timeline_end_call",toggleMute:"av_timeline_mute_unmute"}},contacts:{openPage:"contacts_contactsPage_openPage",openConversation:"contacts_contactsPage_openConversation",showContextMenu:"contacts_contactsPage_showContextMenu",contactRequestSent:"contacts_contactRequest_sent",contactRequestSuggestedSent:"contacts_contactRequest_suggestedSent",contactRequestAccepted:"contacts_contactRequest_accepted",contactRequestDeclined:"contacts_contactRequest_declined",contactBlocked:"contactBlocked",contactUnblocked:"contactUnblocked",contactDeleted:"contactDeleted",informationButtonClicked:"contacts_informationButton_clicked"},discoverAgents:{openPage:"agents_discoverAgentsPage_openPage",openConversation:"agents_discoverAgentsPage_openConversation"},contextMenu:{shown:"contextMenuShown",hidden:"contextMenuHidden"},search:{directorySearchActivated:"directorySearchActivated",started:"searchStarted",reset:"searchReset"},focusManager:{tryRestoreFocus:"tryRestoreFocus"},conversation:{addParticipantsButton:"conversation_addParticipants_button_clicked",scheduleCallButton:"conversation_scheduleCall_button_clicked",moreActionsButton:"conversation_moreActions_button_clicked"},scheduleCall:{scheduleCallConfirmButton:"conversation_scheduleCall_confirm_clicked"},chat:{removeMessage:"removeMessage",sendMessageButton:"send_message_button_clicked",editMessageButton:"edit_message_button_clicked",sendMessageEnter:"send_message_enter_key",editMessageEnter:"edit_message_enter_key",saveVideoMessage:"save_video_message"},skypeOut:{openPage:"skypeOut_openPage"},invites:{shareButton:"invites_share_button_clicked",copyButton:"invites_copy_button_clicked",mailButton:"invites_mail_button_clicked"},presence:{change:"mepresence_change"},userSettings:{openPage:"user_settings_open_page"},educationBubbles:{educationBubbleShown:"education_bubble_shown"},me:{expanded:"me_expanded",collapsed:"me_collapsed",accountLinkClicked:"me_account_link_clicked",signOutClicked:"me_sign_out_clicked",installPluginLinkClicked:"me_install_plugin_link_clicked",avatarFilePickerClicked:"me_avatar_file_picker_clicked",presenceChanged:"me_presence_changed",presenceLoaded:"me_presence_loaded"},externalSignIn:{signIn:"external_sign_in",signInRequest:"external_sign_in_request",signInRequestAfterTokenRefresh:"external_sign_in_request_after_token_refresh",openSignInWindow:"external_open_sign_in_window"},shortCircuit:{contactsPageOpen:"sc_open_contactsPage",manageAddressBooks:"sc_open_manageAddressBooks",addNewNumber:"sc_open_pnv",deleteNumber:"sc_delete_phoneProof",toggleAutoBuddy:"sc_toggle_autoBuddy",togglePhoneProof:"sc_toggle_phoneProof"}}),define("ui/telemetry/actions/registry/traceableAction",["require","exports","module","lodash-compat","swx-utils-common","usertiming","experience/settings","services/serviceLocator","constants/common","ui/telemetry/telemetryClient"],function(e,t){function f(e,t){function v(e){var t=e+"_mark_";return{start:t+"start",beforeRender:t+"before_render",afterRender:t+"after_render"}}function m(e){var t=e+"_duration_";return{beforeRenderDuration:t+"before_render",afterRenderDuration:t+"after_render"}}function g(){n.forIn(c,function(e){i.clearMarks(e)}),n.forIn(h,function(e){i.clearMeasures(e)})}function y(t){var n=i.getEntriesByName(t);n&&n[0]&&(e[b(t)]=n[0].duration)}function b(e){return e.replace(l+"_","")}function w(){return i.getEntriesByName(c.start).length>0}var f=this,l=r.create(),c=v(l),h=m(l),p=!1,d=o.resolve(u.serviceLocator.FEATURE_FLAGS);f.startTrace=function(){i.mark(c.start)},f.markBeforeRender=function(){w()&&(i.mark(c.beforeRender),i.measure(h.beforeRenderDuration,c.start,c.beforeRender),y(h.beforeRenderDuration),p=!0)},f.markAfterRender=function(){w()&&(i.mark(c.afterRender),i.measure(h.afterRenderDuration,c.start,c.afterRender),y(h.afterRenderDuration),p=!0)},f.addEventData=function(t){n.isPlainObject(t)&&n.merge(e,t)},f.endTrace=function(){p&&(d.isFeatureOn(u.featureFlags.TELEMETRY_UIACTIONPERF_ENABLED)&&a.get().sendEvent(s.telemetry.uiTenantToken,"ui_action_perf",e),g(),t())}}var n=e("lodash-compat"),r=e("swx-utils-common").guid,i=e("usertiming"),s=e("experience/settings"),o=e("services/serviceLocator"),u=e("constants/common"),a=e("ui/telemetry/telemetryClient");t.build=function(e,t){return new f(e,t)}}),define("ui/telemetry/actions/registry/api",["require","ui/telemetry/actions/registry/traceableAction"],function(e){function n(){function n(t){delete e[t]}var e={};this.createAction=function(r){return e[r.actionName]=t.build(r,n.bind(undefined,r.actionName)),e[r.actionName]},this.getAction=function(t){return e[t]}}var t=e("ui/telemetry/actions/registry/traceableAction");return n}),define("ui/telemetry/actions/registry/singleton",["require","exports","module","ui/telemetry/actions/registry/api"],function(e,t){var n=e("ui/telemetry/actions/registry/api"),r;t.getInstance=function(){return r||(r=new n),r}}),define("ui/telemetry/actions/actionTelemetryApi",["require","exports","module","lodash-compat","experience/settings","ui/telemetry/actions/registry/singleton","ui/telemetry/telemetryClient"],function(e,t){function o(){var e=this;e.recordAction=function(e,t){var i=n.merge({actionName:e},t);s.get().sendEvent(r.telemetry.uiTenantToken,"ui_action",i)},e.createTraceableAction=function(e){var t={actionName:e};return i.getInstance().createAction(t)},e.getTraceableAction=function(e){return i.getInstance().getAction(e)}}var n=e("lodash-compat"),r=e("experience/settings"),i=e("ui/telemetry/actions/registry/singleton"),s=e("ui/telemetry/telemetryClient");t.build=function(){return new o}}),define("experience/api/me",["require","exports","module","vendor/knockout","cafe/applicationInstance","swx-enums","ui/modelHelpers/personHelper","utils/common/cafeObservable","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionTelemetryApi"],function(e,t){var n=e("vendor/knockout"),r=e("cafe/applicationInstance"),i=e("swx-enums"),s=e("ui/modelHelpers/personHelper"),o=e("utils/common/cafeObservable"),u=e("ui/telemetry/actions/actionNames"),a=e("ui/telemetry/actions/actionTelemetryApi"),f=n.observable(!1);t.isExpanded=f,t.expose=function(){function v(){var e=[];return d()?(e=h().filter(function(e){return!s.isAgent(e)}),e.length):0}function m(t){e.status(t),p.recordAction(u.presence.change,{presence:t})}function g(){e.status.reset()}var e=r.get().personsAndGroupsManager.mePerson,t=n.observable(!1),l=o.newObservableProperty(e.status,{keepAlive:!0}),c={read:function(){return l()},write:m},h=o.newObservableCollection(r.get().personsAndGroupsManager.all.persons,{keepAlive:!0}),p=a.build(),d=n.observable(!1);return r.get().signInManager.state.changed(function(e){t(e===i.loginState.SignedIn||e===i.loginState.SigningOut)}),e.id.get().then(function(){d(!0)}),{authenticated:t,uri:o.newObservableProperty(e.id),displayName:o.newObservableProperty(e.displayName),avatar:o.newObservableProperty(e.avatarUrl),status:n.computed(c),resetStatus:g,mood:o.newObservableProperty(e.activity),numberOfNonAgentContacts:n.computed({read:v}),isExpanded:f}}}),define("experience/api/contact",["require","exports","module","cafe/applicationInstance","swx-enums","constants/common","ui/telemetry/actions/actionNames","utils/common/cafeObservable","services/serviceLocator"],function(e,t){var n=e("cafe/applicationInstance"),r=e("swx-enums"),i=e("constants/common"),s=e("ui/telemetry/actions/actionNames"),o=e("utils/common/cafeObservable"),u=e("services/serviceLocator");t.getByUri=function(e){function p(){var e=c.results().length,t=e?c.results(0).result:undefined;t&&(f.status.bindToProperty(t.status),f.displayName.bindToProperty(t.displayName),f.avatar.bindToProperty(t.avatarUrl),f.uri.bindToProperty(t.id)),l.markBeforeRender(),l.addEventData({source:"api_contact_search",results:e}),l.endTrace()}var t=u.resolve(i.serviceLocator.FEATURE_FLAGS),a=!t.isFeatureOn(i.featureFlags.DISABLE_PERSISTENT_CONTACT_PRESENCE_SUBSCRIPTION),f={status:o.newDeferredObservableProperty(null,{keepAlive:a}),displayName:o.newDeferredObservableProperty(),avatar:o.newDeferredObservableProperty(),uri:o.newDeferredObservableProperty()},l=u.resolve(i.serviceLocator.ACTION_TELEMETRY).createTraceableAction(s.search.started),c=n.get().personsAndGroupsManager.createPersonSearchQuery(),h=r.searchScope.AddressBook;return l.startTrace(),c.sources(h).keywords.id=e,c.getMore().then(p),f}}),define("services/plugin/pluginDownload",["require","browser/dom","browser/detect","experience/settings"],function(e){function i(){var e;n.getSystemInfo().osName===n.OPERATING_SYSTEMS.WINDOWS?e=r.plugin.download.msi:e=r.plugin.download.pkg,s(e)}function s(e){var n=t.createElement("iframe");n.src=e,n.width="0",n.height="0",n.style.border="0",n.style.position="absolute",n.style.top="0",n.style.left="0",document.body.appendChild(n)}var t=e("browser/dom"),n=e("browser/detect"),r=e("experience/settings");return{downloadPlatformSpecificInstaller:i}}),define("ui/viewModels/calling/helpers/browserInstallContent",["require","browser/detect","experience/settings","swx-i18n"],function(e){function u(){var e,n,r={osName:t.getSystemInfo().osName,browserName:t.getBrowserInfo().browserName};return r.osName!==t.OPERATING_SYSTEMS.MACOSX?n={osName:t.OPERATING_SYSTEMS.WINDOWS,browserName:t.BROWSERS.MSIE}:n={osName:t.OPERATING_SYSTEMS.MACOSX,browserName:t.BROWSERS.SAFARI},a(t.getSystemInfo().osName)?e=r:e=n,f(e.osName,e.browserName)}function a(e){return e===t.OPERATING_SYSTEMS.WINDOWS||e===t.OPERATING_SYSTEMS.MACOSX}function f(e,t){var n,i=o[e][t];return i||(i=o.Windows.Unknown),n={images:{closeScreen:h(i.closeScreen.image),download:h(i.download.image),install:h(i.install.image),enjoy:h(i.enjoy.image)},text:{closeScreen:r.fetch({key:i.closeScreen.text}),download:r.fetch({key:i.download.text}),install:r.fetch({key:i.install.text}),enjoy:r.fetch({key:i.enjoy.text})}},i.unblock&&l(n,i.unblock),i.extensionStart&&c(n,i),n}function l(e,t){e.images.unblock=h(t.image),e.text.unblock=r.fetch({key:t.text})}function c(e,t){e.images.extensionStart=h(t.extensionStart.image),e.text.extensionStart=r.fetch({key:t.extensionStart.text}),e.images.extensionInstallPlugin=h(t.extensionInstallPlugin.image),e.text.extensionInstallPlugin=r.fetch({key:t.extensionInstallPlugin.text}),e.images.extensionInstallFailed=h(t.extensionInstallFailed.image),e.text.extensionInstallFailed=r.fetch({key:t.extensionInstallFailed.text})}function h(e){return[n.assetsBaseUrl,i,e,s].join("")}var t=e("browser/detect"),n=e("experience/settings"),r=e("swx-i18n").localization,i="/images/components/av/installSteps/",s=".jpg",o={"Mac OS X":{Chrome:{closeScreen:{image:"CloseScreen",text:"pluginInstall_main_close_screen_subtitle"},download:{image:"Mac_01_Chrome",text:"pluginInstall_mac_chrome_text_download"},install:{image:"Mac_02_Install",text:"pluginInstall_mac_chrome_text_install"},enjoy:{image:"Mac_03_Skype",text:"pluginInstall_mac_chrome_text_enjoy"},unblock:{image:"Blocked_Chrome",text:"pluginInstall_unblock_text_chrome_subtitle"},extensionStart:{image:"PluginChromeIcon",text:"pluginInstall_extension_main_text_subtitle"},extensionInstallFailed:{image:"CloseScreen",text:"pluginInstall_extension_main_install_failed_text_subtitle"},extensionInstallPlugin:{image:"DownloadIcon",text:"pluginInstall_extension_main_installed_text_subtitle"}},Safari:{closeScreen:{image:"CloseScreen",text:"pluginInstall_main_close_screen_subtitle"},download:{image:"Mac_01_Safari",text:"pluginInstall_mac_safari_text_download"},install:{image:"Mac_02_Install",text:"pluginInstall_mac_safari_text_install"},enjoy:{image:"Mac_03_Skype",text:"pluginInstall_mac_safari_text_enjoy"}},Firefox:{closeScreen:{image:"CloseScreen",text:"pluginInstall_main_close_screen_subtitle"},download:{image:"Mac_01_Firefox",text:"pluginInstall_mac_firefox_text_download"},install:{image:"Mac_02_Install",text:"pluginInstall_mac_firefox_text_install"},enjoy:{image:"Mac_03_Skype",text:"pluginInstall_mac_firefox_text_enjoy"},unblock:{image:"Blocked_Firefox",text:"pluginInstall_unblock_text_firefox_subtitle"}},Unknown:{closeScreen:{image:"CloseScreen",text:"pluginInstall_main_close_screen_subtitle"},download:{image:"Mac_01_Safari",text:"pluginInstall_mac_unknown_text_download"},install:{image:"Mac_02_Install",text:"pluginInstall_mac_unknown_text_install"},enjoy:{image:"Mac_03_Skype",text:"pluginInstall_mac_unknown_text_enjoy"}}},Windows:{Chrome:{closeScreen:{image:"CloseScreen",text:"pluginInstall_main_close_screen_subtitle"},download:{image:"Windows_01_Chrome",text:"pluginInstall_windows_chrome_text_download"},install:{image:"Windows_02_Install",text:"pluginInstall_windows_chrome_text_install"},enjoy:{image:"Windows_03_Skype",text:"pluginInstall_windows_chrome_text_enjoy"},unblock:{image:"Blocked_Chrome",text:"pluginInstall_unblock_text_chrome_subtitle"},extensionStart:{image:"PluginChromeIcon",text:"pluginInstall_extension_main_text_subtitle"},extensionInstallFailed:{image:"CloseScreen",text:"pluginInstall_extension_main_install_failed_text_subtitle"},extensionInstallPlugin:{image:"DownloadIcon",text:"pluginInstall_extension_main_installed_text_subtitle"}},MSIE:{closeScreen:{image:"CloseScreen",text:"pluginInstall_main_close_screen_subtitle"},download:{image:"Windows_01_IE",text:"pluginInstall_windows_msie_text_download"},install:{image:"Windows_02_Install",text:"pluginInstall_windows_msie_text_install"},enjoy:{image:"Windows_03_Skype",text:"pluginInstall_windows_msie_text_enjoy"}},Firefox:{closeScreen:{image:"CloseScreen",text:"pluginInstall_main_close_screen_subtitle"},download:{image:"Windows_01_Firefox",text:"pluginInstall_windows_firefox_text_download"},install:{image:"Windows_02_Firefox",text:"pluginInstall_windows_firefox_text_install"},enjoy:{image:"Windows_03_Skype",text:"pluginInstall_windows_firefox_text_enjoy"},unblock:{image:"Blocked_Firefox",text:"pluginInstall_unblock_text_firefox_subtitle"}},Unknown:{closeScreen:{image:"CloseScreen",text:"pluginInstall_main_close_screen_subtitle"},download:{image:"Windows_01_IE",text:"pluginInstall_windows_unknown_text_download"},install:{image:"Windows_02_Install",text:"pluginInstall_windows_unknown_text_install"},enjoy:{image:"Windows_03_Skype",text:"pluginInstall_windows_unknown_text_enjoy"}}}};return{getInstallResources:u}}),define("constants/calling.resources",[],function(){return{notifications:{incomingCall:{linkTemplate:'<a href="http://skype.com/go/help.faq.skype.for.web" target="_blank">{notification_text_learnMore}</a>'}},fallbackMessages:{windowsUpdateLink:'<a href="http://windows.microsoft.com/en-us/windows-10/windows-update-faq" target="_blank">http://windows.microsoft.com/en-us/windows-10/windows-update-faq</a>',skypeUpgradeLink:'<a href="http://www.skype.com/en/download-skype" target="_blank">http://www.skype.com/en/download-skype</a>',ngcUpgradeLink:'<a href="https://go.skype.com/groupupgrade/" target="_blank">https://go.skype.com/groupupgrade/</a>'},pluginInstall:{terms:'<a href="https://www.skype.com/en/legal/tou/" target="_blank">{pluginInstall_steps_text_termsLink}</a>',privacy:'<a href="https://www.skype.com/en/legal/privacy/" target="_blank">{pluginInstall_steps_text_privacyLink}</a>'}}}),define("ui/viewModels/calling/plugin/downloadStepViewModel",["require","exports","module","cafe/applicationInstance","services/plugin/pluginDownload","constants/calling","ui/viewModels/calling/helpers/browserInstallContent","swx-enums","swx-i18n","constants/calling.resources","ui/telemetry/actions/actionNames","constants/common","services/serviceLocator"],function(e,t){var n=e("cafe/applicationInstance"),r=e("services/plugin/pluginDownload"),i=e("constants/calling"),s=e("ui/viewModels/calling/helpers/browserInstallContent"),o=e("swx-enums"),u=e("swx-i18n").localization,a=e("constants/calling.resources").pluginInstall,f=e("ui/telemetry/actions/actionNames"),l=e("constants/common"),c=e("services/serviceLocator"),h=function(h){function y(){m.changed(w)}function b(){m.changed.off(w)}function w(e,t){t!==o.callingNotSupportedReasons.PluginNotInstalled&&(!h.conversation&&!h.suppressEndedEvent&&h.onPluginInstallEnded(i.PLUGIN_INSTALL_EXIT_METHOD.PLUGIN_DETECTED,!0),b(),p())}var p=h.next,d=h.close,v=s.getInstallResources(),m=n.get().personsAndGroupsManager.mePerson.capabilities.audio,g={terms:"pluginInstall_steps_text_termsLink",privacy:"pluginInstall_steps_text_privacyLink"};this.id=t.STEP_ID,this.label=u.fetch({key:"pluginInstall_label_text_download"}),this.downloadImage=v.images.download,this.downloadText=v.text.download,this.installImage=v.images.install,this.installText=v.text.install,this.enjoyImage=v.images.enjoy,this.enjoyText=v.text.enjoy,h.conversation&&h.conversation.audioService.start.enabled.reason===o.callingNotSupportedReasons.PluginNotInstalled&&(m=h.conversation.audioService.start.enabled),this.show=function(){var e=c.resolve(l.serviceLocator.ACTION_TELEMETRY);if(m.reason!==o.callingNotSupportedReasons.PluginNotInstalled){b(),p();return}y(),r.downloadPlatformSpecificInstaller(),e.recordAction(f.audioVideo.pluginInstall.installPlugin)},this.restartDownload=function(){var e=c.resolve(l.serviceLocator.ACTION_TELEMETRY);r.downloadPlatformSpecificInstaller(),e.recordAction(f.audioVideo.pluginInstall.restart)},this.close=function(){b(),d()},this.getLink=function(e){var t=g[e],n=u.fetch({key:t}),r=a[e];return r.replace("{"+t+"}",n)}};t.STEP_ID=i.CALLING_SETUP_STEPS.OVERLAY_PLUGIN_STEPS,t.build=function(e){return new h(e)}}),define("ui/viewModels/calling/plugin/startStepViewModel",["require","exports","module","constants/calling","utils/common/cafeObservable","swx-i18n","ui/telemetry/actions/actionNames","constants/common","services/serviceLocator"],function(e,t){var n=e("constants/calling"),r=e("utils/common/cafeObservable"),i=e("swx-i18n").localization,s=e("ui/telemetry/actions/actionNames"),o=e("constants/common"),u=e("services/serviceLocator"),a=function(n){var a=n.next;this.id=t.STEP_ID,this.label=i.fetch({key:"pluginInstall_label_text_start"}),this.avatar=r.newObservableProperty(n.conversation.avatarUrl),this.isGroupConversation=r.newObservableProperty(n.conversation.isGroupConversation),this.show=function(){var e=u.resolve(o.serviceLocator.ACTION_TELEMETRY);e.recordAction(s.audioVideo.pluginInstall.start)},this.close=function(){n.close()},this.installClick=function(){a()}};t.STEP_ID=n.CALLING_SETUP_STEPS.OVERLAY_PLUGIN_START,t.build=function(e){return new a(e)}}),define("ui/viewModels/calling/plugin/closeStepViewModel",["require","exports","module","ui/viewModels/calling/helpers/browserInstallContent","constants/calling","ui/telemetry/actions/actionNames","constants/common","services/serviceLocator"],function(e,t){var n=e("ui/viewModels/calling/helpers/browserInstallContent"),r=e("constants/calling"),i=e("ui/telemetry/actions/actionNames"),s=e("constants/common"),o=e("services/serviceLocator"),u=function(u){var a=u.next,f=u.close,l=n.getInstallResources();this.id=t.STEP_ID,this.closeScreenImageUrl=l.images.closeScreen,this.isFirefox=u.isFirefox,this.next=function(){var e=o.resolve(s.serviceLocator.ACTION_TELEMETRY);a(),e.recordAction(i.audioVideo.pluginInstall.stayInFlow)},this.close=function(){var e=o.resolve(s.serviceLocator.ACTION_TELEMETRY);u.onPluginInstallEnded(r.PLUGIN_INSTALL_EXIT_METHOD.CLOSE,!1),f(),e.recordAction(i.audioVideo.pluginInstall.leave)}};t.STEP_ID=r.CALLING_SETUP_STEPS.CLOSE_CALLING_SETUP,t.build=function(e){return new u(e)}}),define("browser/chrome",[],function(){return window.chrome||{}}),define("ui/viewModels/calling/plugin/extensionInstallHelper",["require","exports","module","browser/document","experience/settings"],function(e,t){var n=e("browser/document"),r=e("experience/settings"),i=function(){this.buildLinkElement=function(){var t=n.createElement("link");return t.setAttribute("rel","chrome-webstore-item"),t.setAttribute("href",r.shellApp.chromeExtensionWebstoreUrl),t},this.buildContentScriptElement=function(){var t=n.createElement("script"),i="chrome-extension://"+r.shellApp.chromeExtensionId+"/content-script.js";return t.setAttribute("src",i),t}};t.build=function(){return new i}}),define("ui/viewModels/calling/plugin/extensionInstallStepViewModel",["require","exports","module","browser/chrome","browser/document","experience/settings","constants/calling","ui/viewModels/calling/plugin/extensionInstallHelper","ui/viewModels/calling/helpers/browserInstallContent","ui/telemetry/actions/actionNames","constants/common","services/serviceLocator"],function(e,t){var n=e("browser/chrome"),r=e("browser/document"),i=e("experience/settings"),s=e("constants/calling"),o=e("ui/viewModels/calling/plugin/extensionInstallHelper"),u=e("ui/viewModels/calling/helpers/browserInstallContent"),a=e("ui/telemetry/actions/actionNames"),f=e("constants/common"),l=e("services/serviceLocator"),c=function(s){function p(){m(),s.next()}function d(){s.nextOnFailed()}function v(){var e=h.buildLinkElement();r.head.appendChild(e)}function m(){var e=h.buildContentScriptElement();r.head.appendChild(e)}var c=u.getInstallResources(),h=o.build();this.id=t.STEP_ID,this.skypeChromeImageUrl=c.images.extensionStart,this.isFirefox=s.isFirefox,this.show=function(){var e=l.resolve(f.serviceLocator.ACTION_TELEMETRY);v(),e.recordAction(a.audioVideo.pluginInstall.installExtension)},this.close=function(){s.close()},this.installClick=function(){try{n.webstore.install(i.shellApp.chromeExtensionWebstoreUrl,p,d)}catch(e){d()}}};t.STEP_ID=s.CALLING_SETUP_STEPS.OVERLAY_EXTENSION_INSTALL,t.build=function(e){return new c(e)}}),define("ui/viewModels/calling/plugin/extensionInstallFailedStepViewModel",["require","exports","module","browser/document","browser/window","experience/settings","constants/calling","ui/viewModels/calling/plugin/extensionInstallHelper","ui/viewModels/calling/helpers/browserInstallContent"],function(e,t){var n=e("browser/document"),r=e("browser/window"),i=e("experience/settings"),s=e("constants/calling"),o=e("ui/viewModels/calling/plugin/extensionInstallHelper"),u=e("ui/viewModels/calling/helpers/browserInstallContent"),a=function(s){function c(){var e=n.querySelector("head"),t=f.buildContentScriptElement();t.onload=h,t.onerror=e.removeChild.bind(e,t),e.appendChild(t)}function h(){r.clearInterval(l),s.next()}var a=u.getInstallResources(),f=o.build(),l;this.id=t.STEP_ID,this.chromeWebstoreUrl=i.shellApp.chromeExtensionWebstoreUrl,this.imageUrl=a.images.extensionInstallFailed,this.isFirefox=s.isFirefox,this.show=function(){l=r.setInterval(c,1e3)},this.close=function(){l&&r.clearInterval(l),s.close()}};t.STEP_ID=s.CALLING_SETUP_STEPS.OVERLAY_EXTENSION_INSTALL_FAILED,t.build=function(e){return new a(e)}}),define("ui/viewModels/calling/plugin/extensionInstalledStepViewModel",["require","exports","module","swx-enums","cafe/applicationInstance","constants/calling","ui/viewModels/calling/helpers/browserInstallContent"],function(e,t){var n=e("swx-enums"),r=e("cafe/applicationInstance"),i=e("constants/calling"),s=e("ui/viewModels/calling/helpers/browserInstallContent"),o=function(i){function f(){a.changed(c)}function l(){a.changed.off(c)}function c(e,t){t!==n.callingNotSupportedReasons.PluginNotInstalled&&(l(),o())}var o=i.next,u=s.getInstallResources(),a=r.get().personsAndGroupsManager.mePerson.capabilities.audio;this.id=t.STEP_ID,this.getPluginImageUrl=u.images.extensionInstallPlugin,this.isFirefox=i.isFirefox,this.show=function(){a.reason===n.callingNotSupportedReasons.PluginNotInstalled?f():o()},this.close=function(){l(),i.close()},this.installClick=function(){l(),o()}};t.STEP_ID=i.CALLING_SETUP_STEPS.OVERLAY_EXTENSION_INSTALLED,t.build=function(e){return new o(e)}}),define("ui/viewModels/calling/plugin/unblockStepViewModel",["require","exports","module","cafe/applicationInstance","ui/viewModels/calling/helpers/browserInstallContent","swx-enums","swx-i18n","constants/calling"],function(e,t){var n=e("cafe/applicationInstance"),r=e("ui/viewModels/calling/helpers/browserInstallContent"),i=e("swx-enums"),s=e("swx-i18n").localization,o=e("constants/calling"),u=function(u){function h(){c.changed(d)}function p(){c.changed.off(d)}function d(e,t){t!==i.callingNotSupportedReasons.PluginBlocked&&(u.conversation||u.onPluginInstallEnded(o.PLUGIN_INSTALL_EXIT_METHOD.PLUGIN_DETECTED,!0,o.CALLING_SETUP_STEPS.OVERLAY_PLUGIN_UNBLOCK),p(),a())}var a=u.next,f=u.close,l=r.getInstallResources(),c=n.get().personsAndGroupsManager.mePerson.capabilities.audio;this.id=t.STEP_ID,this.label=s.fetch({key:"pluginInstall_label_text_unblock"}),this.unblockText=l.text.unblock,this.unblockImageUrl=l.images.unblock,this.isFirefox=u.isFirefox,this.show=function(){h()},this.close=function(){f()}};t.STEP_ID=o.CALLING_SETUP_STEPS.OVERLAY_PLUGIN_UNBLOCK,t.build=function(e){return new u(e)}}),define("ui/viewModels/calling/plugin/callbackStepViewModel",["require","exports","module","constants/calling","utils/common/cafeObservable","swx-i18n"],function(e,t){var n=e("constants/calling"),r=e("utils/common/cafeObservable"),i=e("swx-i18n").localization,s=function(s){var o=s.next,u=s.conversation;this.id=t.STEP_ID,this.label=i.fetch({key:"pluginInstall_label_text_continue"}),this.conversationModel=u,this.avatar=r.newObservableProperty(u.avatarUrl),this.isGroupConversation=r.newObservableProperty(u.isGroupConversation),this.conversationTopic=r.newObservableProperty(u.topic),this.placeCall=function(){s.onPluginInstallEnded(n.PLUGIN_INSTALL_EXIT_METHOD.CALL_STARTED,!0,n.CALLING_SETUP_STEPS.OVERLAY_PLUGIN_CALLBACK),o()},this.notNow=function(){s.onPluginInstallEnded(n.PLUGIN_INSTALL_EXIT_METHOD.CLOSE,!0,n.CALLING_SETUP_STEPS.OVERLAY_PLUGIN_CALLBACK),o()}};t.STEP_ID=n.CALLING_SETUP_STEPS.OVERLAY_PLUGIN_CALLBACK,t.build=function(e){return new s(e)}}),define("constants/keys",{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMBER_0:48,NUMBER_9:57,NUMPAD_0:96,NUMPAD_9:105,A:65,G:71,H:72,J:74,K:75,L:76,Z:90,F6:117,F10:121}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-overlay/lib/helpers",["require","exports"],e)}(function(e,t){t.urlRedirect=function(e){window.location.href=e},t.platform=function(){var e=window.navigator.userAgent,t="";return e.match(/windows/i)?t="windows":e.match(/macintosh/i)?t="mac":e.match(/linux/i)?t="linux":e.match(/android/i)?t="android":e.match(/iphone|ipad|ipod/i)?t="ios":e.match(/blackberry/i)&&(t="blackberry"),t}(),t.onMobileBrowser=function(){var e=e,t=window.navigator.userAgent;return["android","ios","blackberry"].indexOf(e)!==-1?!0:e==="windows"&&t.match(/phone|iemobile/i)?!0:!1}(),t.extend=function(e,t){var n=Object.keys(t),r=n.length,i,s;for(s=0;s<r;s++)i=n[s],e[i]=t[i];return e},t.cssTransitionEndEventName=function(){function e(){var e=document.createElement("div"),t={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},n;for(n in t)if(t.hasOwnProperty(n)&&e.style[n]!==undefined)return t[n];return""}return e()}(),t.cssTransitionsSupported=function(){return t.cssTransitionEndEventName!==""}(),t.hasClass=function(e,t){var n=new RegExp("(?:^|\\s)"+t+"(?!\\S)","g");return e.className.match(n)?!0:!1},t.addClass=function(e,n){return!e||t.hasClass(e,n)===!0?!1:(e.className+=" "+n,!0)},t.removeClass=function(e,n){var r;return!e||t.hasClass(e,n)===!1?!1:(r=new RegExp("(?:^|\\s)"+n+"(?!\\S)","g"),e.className=e.className.replace(r,""),!0)},t.bind=function(){function e(e,t,n){e.addEventListener(t,n,!1)}function t(e,t,n){e.attachEvent(t,n)}return document.addEventListener?e:t}(),t.unbind=function(){function e(e,t,n){e.removeEventListener(t,n,!1)}function t(e,t,n){e.detachEvent(t,n)}return document.removeEventListener?e:t}(),t.base64Decode=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n,r,i,s,o,u,a,f,l=0,c=0,h="",p=[];if(!e)return e;e+="";do s=t.indexOf(e.charAt(l++)),o=t.indexOf(e.charAt(l++)),u=t.indexOf(e.charAt(l++)),a=t.indexOf(e.charAt(l++)),f=s<<18|o<<12|u<<6|a,n=f>>16&255,r=f>>8&255,i=f&255,u===64?p[c++]=String.fromCharCode(n):a===64?p[c++]=String.fromCharCode(n,r):p[c++]=String.fromCharCode(n,r,i);while(l<e.length);return h=p.join(""),h.replace(/\0+$/,"")},t.murmurhash=function(e,t){var n=e.length&3,r=e.length-n,i=t,s=3432918353,o=461845907,u=0,a,f;while(u<r)f=e.charCodeAt(u)&255|(e.charCodeAt(++u)&255)<<8|(e.charCodeAt(++u)&255)<<16|(e.charCodeAt(++u)&255)<<24,++u,f=(f&65535)*s+(((f>>>16)*s&65535)<<16)&4294967295,f=f<<15|f>>>17,f=(f&65535)*o+(((f>>>16)*o&65535)<<16)&4294967295,i^=f,i=i<<13|i>>>19,a=(i&65535)*5+(((i>>>16)*5&65535)<<16)&4294967295,i=(a&65535)+27492+(((a>>>16)+58964&65535)<<16);f=0;switch(n){case 3:f^=(e.charCodeAt(u+2)&255)<<16;case 2:f^=(e.charCodeAt(u+1)&255)<<8;case 1:f^=e.charCodeAt(u)&255,f=(f&65535)*s+(((f>>>16)*s&65535)<<16)&4294967295,f=f<<15|f>>>17,f=(f&65535)*o+(((f>>>16)*o&65535)<<16)&4294967295,i^=f}return i^=e.length,i^=i>>>16,i=(i&65535)*2246822507+(((i>>>16)*2246822507&65535)<<16)&4294967295,i^=i>>>13,i=(i&65535)*3266489909+(((i>>>16)*3266489909&65535)<<16)&4294967295,i^=i>>>16,i>>>0},t.parseJSONString=function(e){var t;try{t=JSON.parse(e)}catch(n){return!1}return t}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-overlay/lib/overlay",["require","exports","./helpers"],e)}(function(e,t){function f(){return!u.content||!u.contentParent?!1:(u.contentParent.appendChild(u.content),r.removeChild(u.slide),u={},!0)}function l(){var e=document.createElement("div"),t=document.createElement("div"),r=document.createElement("div"),s=document.createElement("div");n.addClass(e,"overlaySlide"),n.addClass(t,"table"),n.addClass(r,"tableCell"),n.addClass(s,"overlaySlideContent"),n.addClass(s,"themeWhite"),s.tabIndex=-1,s.setAttribute("role","dialog"),s.setAttribute("aria-label",""),r.appendChild(s),t.appendChild(r),e.appendChild(t),i=e}function c(){var e=document.createElement("div");n.addClass(e,"overlayContainer"),r=e}function h(e){var t={};return t.content=e,t.contentParent=e.parentNode,t.slide=i.cloneNode(!0),t.contentContainer=t.slide.querySelector(".overlaySlideContent"),t.contentContainer.appendChild(e),t}function p(e){var t=u.slide;if(s===!1){f();return}if(n.cssTransitionsSupported===!1||e===null){f();return}e.inactiveTransitionClass!==""&&(n.bind(t,n.cssTransitionEndEventName,function(){n.removeClass(t,e.inactiveTransitionClass)}),n.addClass(t,e.inactiveTransitionClass)),n.bind(t,n.cssTransitionEndEventName,f),n.addClass(t,e.inactiveClass)}function d(e){if(n.cssTransitionsSupported===!1||e===null){r.appendChild(o.slide);return}e.activeTransitionClass!==""&&(n.bind(o.slide,n.cssTransitionEndEventName,function(){n.removeClass(o.slide,e.activeTransitionClass)}),n.addClass(o.slide,e.activeTransitionClass)),n.addClass(o.slide,e.activeClass),window.setTimeout(function(){n.removeClass(o.slide,e.activeClass)},10),r.appendChild(o.slide)}function v(e){var t;if(s===!1)return;t=e.target,r.contains(t)===!1&&o.contentContainer.focus()}function m(e){e.keyCode===27&&t.hide()}function g(e){var t=e.length,i;for(i=0;i<t;i++)n.addClass(r,e[i])}function y(){c(),l(),n.bind(document,"focusin",v)}var n=e("./helpers"),r=null,i=null,s=!1,o={},u={},a={next:{activeClass:"next",activeTransitionClass:"",inactiveClass:"prev",inactiveTransitionClass:"prevInTransition"},previous:{activeClass:"prev",activeTransitionClass:"prevInTransition",inactiveClass:"next",inactiveTransitionClass:""}};y(),t.display=function(e,t,i,f){var l,c=null;return f=f||{},typeof e!="string"?!1:(typeof t!="string"&&(t=""),e.indexOf("#")===0&&(e=e.substr(1)),l=document.getElementById(e),l===null?!1:l===o.content?!1:(i!==undefined&&s===!0&&a[i]!==undefined&&(c=a[i]),u=n.extend({},o),o=h(l),o.contentContainer.setAttribute("aria-label",t),s===!1&&(document.body.appendChild(r),s=!0),c!==null&&(n.removeClass(r,c.activeClass),n.removeClass(r,c.inactiveClass),n.addClass(r,c.activeClass)),g(f.containerClasses),p(c),d(c),o.contentContainer.focus(),!0))},t.hide=function(){return u=n.extend({},o),f()===!1?!1:(r.parentNode.removeChild(r),s=!1,n.unbind(document,"keydown",m),o={},!0)},t.bindHide=function(e){return!e||typeof e!="object"?!1:(n.bind(e,"click",t.hide),n.bind(document,"keydown",m),!0)},t.isOverlayDisplayed=function(){return s},t.getOverlayContainer=function(){return r}}),define("swx-overlay",["swx-overlay/lib/overlay"],function(e){return e}),define("constants/cssClasses",["require","exports","module"],function(e,t){t.HIDE="swx-hide",t.LIST_SELECTABLE="list-selectable",t.SEARCH_ITEM="searchItem",t.MODAL_DIALOG="swx-overlayModal",t.contextMenu={CONTEXT_MENU:"swxContextMenu",FLIPPED:"flipped",items:{BLOCK_CONTACT:"blockContactMenuItem",CALL_SKYPE:"callSkypeMenuItem",DELETE_CONTACT:"deleteContactMenuItem",START_PSTN_CALL:"startPSTNCallMenuItem",UNBLOCK_CONTACT:"unblockContactMenuItem",VIDEO_CALL:"videoCallMenuItem",SCHEDULE_CALL:"scheduleCallMenuItem"}},t.avatar={AVATAR:"Avatar",AVATAR_PRESENCE:"Avatar--presence",AVATAR_GROUP:"Avatar--group",AVATAR_SELECTED:"Avatar--selected",AVATAR_AGENT:"Avatar--agent",AVATAR_PSTN:"Avatar--pstn",AVATAR_SIZE:"Avatar--size"},t.avatarDeprecated={GROUP_AVATAR:"group",SHOW_PRESENCE:"presence"},t.presence={BLOCKED:"blocked"},t.contacts={CONTACT_TILE:"contactTile",TILE_NAME:"tileName"},t.discoverAgents={PAGE:"DiscoverAgentsPage"},t.base={SWX:"swx",DESKTOP:"desktop",OVERLAY_CONTAINER:"overlayContainer"},t.educationBubbles={PREFIX:"EducationBubble--",LARGE:"EducationBubble--large"}}),define("utils/common/accessibility",["require","exports","module","browser/dom","vendor/knockout"],function(e,t){var n=e("browser/dom"),r=e("vendor/knockout"),i="showFocusRing";t.initFocusRing=function(e){e.addEventListener("keydown",function(){n.hasClass(e,i)||n.addClass(e,i)},!1),e.addEventListener("mousedown",function(){n.removeClass(e,i)},!1)},t.updateAriaLiveHtml=function(e,t){if(!r.isObservable(e))throw new Error("Parameter must be a ko.observable.");e(""),e("<span>"+t+"</span>")}}),define("ui/modalDialog/modalDialog",["require","exports","module","browser/dom","browser/document","vendor/knockout","constants/keys","constants/common","swx-overlay","constants/cssClasses","utils/common/accessibility","services/g11n/globalization"],function(e,t){function c(e,t){var s,o=n.getElementById(e);return o&&i.removeNode(o),s=n.createElement("div"),s.innerHTML=t,o=s.firstChild,r.body.appendChild(o),o}function h(){return n.findElement("."+a.MODAL_DIALOG+":not(."+a.HIDE+")")}function p(){r.addEventListener(o.events.browser.KEYDOWN,v,!1)}function d(){r.removeEventListener(o.events.browser.KEYDOWN,v,!1)}function v(e){e.keyCode===s.ESCAPE&&t.hide()}var n=e("browser/dom"),r=e("browser/document"),i=e("vendor/knockout"),s=e("constants/keys"),o=e("constants/common"),u=e("swx-overlay"),a=e("constants/cssClasses"),f=e("utils/common/accessibility"),l=e("services/g11n/globalization");t.build=function(e,t,n){var r=c(e,n);return i.applyBindings(t,r),r},t.show=function(e,t,r){var i,s,o=u.isOverlayDisplayed();r=r||"",u.display(e,t,r,{containerClasses:[a.base.SWX,a.base.DESKTOP]}),o||f.initFocusRing(u.getOverlayContainer()),i=n.getElementById(e),s=n.getParentWithClass(i,a.base.OVERLAY_CONTAINER),l.initLocaleDirection(s),n.removeClass(i,a.HIDE),p()},t.hide=function(e){var t=n.getElementById(e)||h();d(),u.hide(),t&&n.addClass(t,a.HIDE)},t.dispose=function(e){var r=n.getElementById(e)||h();t.hide(e),r&&i.removeNode(r)}}),define("ui/viewModels/calling/plugin/pluginInstallViewModel",["require","exports","module","ui/viewModels/calling/plugin/downloadStepViewModel","ui/viewModels/calling/plugin/startStepViewModel","ui/viewModels/calling/plugin/closeStepViewModel","ui/viewModels/calling/plugin/extensionInstallStepViewModel","ui/viewModels/calling/plugin/extensionInstallFailedStepViewModel","ui/viewModels/calling/plugin/extensionInstalledStepViewModel","ui/viewModels/calling/plugin/unblockStepViewModel","ui/viewModels/calling/plugin/callbackStepViewModel","ui/telemetry/telemetryClient","browser/document","swx-utils-common","swx-enums","vendor/knockout","constants/extension","constants/calling","experience/settings","swx-utils-common","browser/detect","ui/modalDialog/modalDialog","cafe/applicationInstance","browser/window"],function(e,t){var n=e("ui/viewModels/calling/plugin/downloadStepViewModel"),r=e("ui/viewModels/calling/plugin/startStepViewModel"),i=e("ui/viewModels/calling/plugin/closeStepViewModel"),s=e("ui/viewModels/calling/plugin/extensionInstallStepViewModel"),o=e("ui/viewModels/calling/plugin/extensionInstallFailedStepViewModel"),u=e("ui/viewModels/calling/plugin/extensionInstalledStepViewModel"),a=e("ui/viewModels/calling/plugin/unblockStepViewModel"),f=e("ui/viewModels/calling/plugin/callbackStepViewModel"),l=e("ui/telemetry/telemetryClient"),c=e("browser/document"),h=e("swx-utils-common").guid,p=e("swx-enums"),d=e("vendor/knockout"),v=e("constants/extension"),m=e("constants/calling"),g=e("experience/settings"),y=e("swx-utils-common").stopwatch,b=e("browser/detect"),w=e("ui/modalDialog/modalDialog"),E=e("cafe/applicationInstance"),S=e("browser/window"),x=4e3,T=function(t,T){function F(e){return e&&e.selfParticipant.audio.state.reason===p.callDisconnectionReason.OutOfBrowserCall?p.callDisconnectionReason.OutOfBrowserCall:m.NA}function I(){var e=C.isBrowserDefaultToBlockPlugin,t=C.isInBrowserPluginSupported,n=C.browserName===b.BROWSERS.EDGE,r=C.browserName===b.BROWSERS.CHROME,i=Boolean(c.querySelector(v.META_SELECTOR));H&&P&&(t||n)&&R(),r&&!t&&!i&&(U(),z(),W()),X({isUnblockStepIncluded:e}),e&&V(),P&&$(),q()}function q(){var e={onPluginInstallEnded:tt,next:K,close:J};_=i.build(e)}function R(){var e={onPluginInstallEnded:tt,next:G,close:Q,conversation:P};A.push(r.build(e))}function U(){var e={isFirefox:k,onPluginInstallEnded:tt,next:Y,nextOnFailed:G,close:Q,conversation:P};A.push(s.build(e))}function z(){var e={isFirefox:k,onPluginInstallEnded:tt,next:G,close:Q,conversation:P};A.push(o.build(e))}function W(){var e={isFirefox:k,onPluginInstallEnded:tt,next:G,close:Q,conversation:P};A.push(u.build(e))}function X(e){var t;e=e||{},t={onPluginInstallEnded:tt,next:P||e.isUnblockStepIncluded?G:J,close:Q,conversation:P,suppressEndedEvent:e.isUnblockStepIncluded},A.push(n.build(t))}function V(){var e={isFirefox:k,onPluginInstallEnded:tt,next:P?G:J,close:Q,conversation:P};A.push(a.build(e))}function $(){var e={onPluginInstallEnded:tt,next:J,close:J,conversation:P,isVideo:T.isVideo};A.push(f.build(e))}function J(){st(),w.hide()}function K(){O=M,Z("next")}function Q(){M=O,O=A.length-1,et(_,"next")}function G(){M=O,O++,Z("next")}function Y(){M=O,O+=2,Z("next")}function Z(e){if(O>=A.length){J();return}var t=A[O];et(t,e)}function et(e,t){N.activeStep(e),w.show(e.id,e.label,t),e.show&&e.show()}function tt(e,t,n){rt(e,t,n),T.done&&T.done(e,t)}function nt(){var e={name:m.TELEMETRY_EVENTS.PLUGIN_INSTALL_STARTED,plugin_install_context_id:L,source:t,installationReason:D,success:m.NA,exitMethod:m.NA,durationInMs:m.NA,closeScreen:m.NA};l.get().sendEvent(g.telemetry.uiTenantToken,"PluginInstall",e)}function rt(e,t,n){var r={name:m.TELEMETRY_EVENTS.PLUGIN_INSTALL_ENDED,plugin_install_context_id:L,source:m.NA,installationReason:D,success:t.toString(),exitMethod:e,durationInMs:B.duration().toString(10),closeScreen:n||A[M].id};l.get().sendEvent(g.telemetry.uiTenantToken,"PluginInstall",r)}function it(){T.conversation?j=S.setInterval(function(){T.conversation.videoService.start.enabled.get(),T.conversation.audioService.start.enabled.get()},x):j=S.setInterval(function(){E.get().devicesManager.checkMediaCapabilities()},x)}function st(){S.clearInterval(j)}if(typeof t!="string")throw new Error("source param is mandatory");T=T||{};var N=this,C=b.getBrowserInfo(),k=C.browserName===b.BROWSERS.FIREFOX,L=h.create(),A=[],O=0,M=0,_,D,P=T.conversation,H=T.isOutgoing,B,j;D=F(P),this.activeStep=d.observable(),this.start=function(){B=y.build(),I(),O=0,Z(""),it(),nt()}};t.build=function(e,t){return new T(e,t)}}),define("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("text!views/calling/pluginInstall.html",[],function(){return'<div id="overlayPluginSlides" class="swx-overlayModal swx-hide">\r\n    <!-- ko with: activeStep -->\r\n\r\n    <div id="overlayPluginStart" data-bind="if: $parent.activeStep().id === $element.id">\r\n        <div class="overlayControls">\r\n              <div class="right">\r\n                <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n                    <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'pluginInstall_main_text_close\' }"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <div class="overlayMain">\r\n            <div class="title">\r\n                <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'pluginInstall_main_text_title\' }"></h1>\r\n            </div>\r\n            <div class="subtitle">\r\n                <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="l10n: { \'key\': \'pluginInstall_main_text_subtitle\' }"></p>\r\n            </div>\r\n            <swx-avatar-deprecated params="isGroupAvatar: isGroupConversation, avatar: avatar" class="avatar"></swx-avatar-deprecated>\r\n            <div class="buttonRow">\r\n                <button class="btn green narrow large" data-bind="click: installClick" type="button">\r\n                    <span class="iconfont after arrowRight pull2" data-bind="l10n: { \'key\': \'pluginInstall_main_text_install\' }"></span>\r\n                </button>\r\n            </div>\r\n            <div class="autoUpdateDisclaimer">\r\n                <p data-bind="l10n: { \'key\': \'pluginInstall_label_text_autoUpdateDisclaimer\' }"></p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div id="overlayExtensionInstall" data-bind="if: $parent.activeStep().id === $element.id">\r\n        <div class="overlayControls">\r\n              <div class="right">\r\n                <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n                    <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'pluginInstall_main_text_close\' }"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <div class="overlayMain">\r\n            <div class="title">\r\n                <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'pluginInstall_extension_main_text_title\' }"></h1>\r\n            </div>\r\n            <div class="subtitle">\r\n                <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="l10n: { \'key\': \'pluginInstall_extension_main_text_subtitle\' }"></p>\r\n            </div>\r\n            <div class="illustration">\r\n                <img data-bind="attr: { src: skypeChromeImageUrl }, css: { firefox: isFirefox }" alt="" role="presentation" aria-hidden="true"/>\r\n            </div>\r\n            <div class="buttonRow">\r\n                <button class="btn green narrow large" data-bind="click: installClick" type="button">\r\n                    <span class="iconfont after arrowRight pull2" data-bind="l10n: { \'key\': \'pluginInstall_extension_main_text_add_extension\' }"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div id="overlayExtensionInstallFailed" data-bind="if: $parent.activeStep().id === $element.id">\r\n        <div class="overlayControls">\r\n              <div class="right">\r\n                <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n                    <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'pluginInstall_main_text_close\' }"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <div class="overlayMain">\r\n            <div class="title">\r\n                <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'pluginInstall_extension_main_install_failed_text_title\' }"></h1>\r\n            </div>\r\n            <div class="subtitle">\r\n                <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="l10n: { \'key\': \'pluginInstall_extension_main_install_failed_text_subtitle\' }"></p>\r\n            </div>\r\n            <div class="illustration">\r\n                <img data-bind="attr: { src: imageUrl }, css: { firefox: isFirefox }" alt="" role="presentation" aria-hidden="true"/>\r\n            </div>\r\n            <div class="buttonRow">\r\n                <a class="btn green narrow large" target="_blank" data-bind="attr: { href: chromeWebstoreUrl }">\r\n                    <span class="iconfont after arrowRight pull2" data-bind="l10n: { \'key\': \'pluginInstall_extension_main_install_failed_go_to_chrome_webstore_text\' }"></span>\r\n                </a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div id="overlayExtensionInstalled" data-bind="if: $parent.activeStep().id === $element.id">\r\n        <div class="overlayControls">\r\n              <div class="right">\r\n                <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n                    <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'pluginInstall_main_text_close\' }"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <div class="overlayMain">\r\n            <div class="title">\r\n                <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'pluginInstall_extension_main_installed_text_title\' }"></h1>\r\n            </div>\r\n            <div class="subtitle">\r\n                <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="l10n: { \'key\': \'pluginInstall_extension_main_installed_text_subtitle\' }"></p>\r\n            </div>\r\n            <div class="illustration">\r\n                <img data-bind="attr: { src: getPluginImageUrl }, css: { firefox: isFirefox }" alt="" role="presentation" aria-hidden="true"/>\r\n            </div>\r\n            <div class="buttonRow">\r\n                <button class="btn green narrow large" data-bind="click: installClick" type="button">\r\n                    <span class="iconfont after arrowRight pull2" data-bind="l10n: { \'key\': \'pluginInstall_extension_main_installed_get_plugin_text\' }"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div id="closeCallingSetup" data-bind="if: $parent.activeStep().id === $element.id">\r\n        <div class="overlayMain">\r\n            <div class="title">\r\n                <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'pluginInstall_main_close_screen_title\' }"></h1>\r\n            </div>\r\n            <div class="subtitle">\r\n                <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="l10n: { \'key\': \'pluginInstall_main_close_screen_subtitle\' }"></p>\r\n            </div>\r\n            <div class="illustration">\r\n                <img data-bind="attr: { src: closeScreenImageUrl }, css: { firefox: isFirefox }" alt="" role="presentation" aria-hidden="true"/>\r\n            </div>\r\n            <div class="buttonRow">\r\n                <button class="btn green narrow large" data-bind="click: next" type="button">\r\n                    <span class="iconfont after arrowRight pull2" data-bind="l10n: { \'key\': \'pluginInstall_main_close_screen_finish_text\' }">\r\n                    </span>\r\n                </button>\r\n\r\n                <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n                    <span data-bind="l10n: { \'key\': \'pluginInstall_main_close_screen_leave_text\' }"></span>\r\n                </button>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div id="overlayPluginSteps" data-bind="if: $parent.activeStep().id === $element.id">\r\n        <div class="overlayControls">\r\n            <div class="left">\r\n                <button class="btn narrow transparent" data-bind="click: restartDownload" type="button">\r\n                    <span class="iconfont reload pull2" data-bind="l10n: { \'key\': \'pluginInstall_steps_text_restart\' }"></span>\r\n                </button>\r\n            </div>\r\n            <div class="right">\r\n                <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n                    <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'pluginInstall_main_text_close\' }"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <div class="overlayMain">\r\n            <div class="title">\r\n                <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'pluginInstall_steps_text_title\' }"></h1>\r\n            </div>\r\n            <div class="subtitle">\r\n                <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="l10n: { \'key\': \'pluginInstall_steps_text_subtitle\' }"></p>\r\n            </div>\r\n            <div class="grid verticalGutter">\r\n                <div class="row">\r\n                    <div class="column unit4">\r\n                        <div class="icon">\r\n                            <img data-bind="attr: { src: downloadImage }" alt="" role="presentation" aria-hidden="true"/>\r\n                        </div>\r\n                        <div class="text">\r\n                            <p class="fontSize-h3 fontSizeNarrow-h4" data-bind="text: downloadText"></p>\r\n                        </div>\r\n                    </div>\r\n                    <div class="column unit4">\r\n                        <div class="icon">\r\n                            <img data-bind="attr: { src: installImage }" alt="" role="presentation" aria-hidden="true"/>\r\n                        </div>\r\n                        <div class="text">\r\n                            <p class="fontSize-h3 fontSizeNarrow-h4" data-bind="text: installText"></p>\r\n                        </div>\r\n                    </div>\r\n                    <div class="column unit4">\r\n                        <div class="icon">\r\n                            <img data-bind="attr: { src: enjoyImage }" alt="" role="presentation" aria-hidden="true"/>\r\n                        </div>\r\n                        <div class="text">\r\n                            <p class="fontSize-h3 fontSizeNarrow-h4" data-bind="text: enjoyText"></p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="termsOfUse">\r\n                <p data-bind="l10n: { \'key\': \'pluginInstall_steps_text_termsAndPrivacy\', \'params\': { \'terms_link\': getLink(\'terms\'), \'privacy_link\': getLink(\'privacy\') } }"></p>\r\n            </div>\r\n            <div class="autoUpdateDisclaimer">\r\n                <p data-bind="l10n: { \'key\': \'pluginInstall_label_text_autoUpdateDisclaimer\' }"></p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div id="overlayPluginUnblock" data-bind="if: $parent.activeStep().id === $element.id">\r\n        <div class="overlayControls">\r\n            <div class="right">\r\n                <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n                    <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'pluginInstall_main_text_close\' }"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <div class="overlayMain">\r\n            <div class="title">\r\n                <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'pluginInstall_unblock_text_title\' }"></h1>\r\n            </div>\r\n            <div class="subtitle">\r\n                <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="text: unblockText"></p>\r\n            </div>\r\n            <div class="illustration">\r\n                <img data-bind="attr: { src: unblockImageUrl }, css: { firefox: isFirefox }" alt="" role="presentation" aria-hidden="true"/>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div id="overlayPluginCallback" data-bind="if: $parent.activeStep().id === $element.id">\r\n        <div class="overlayMain">\r\n            <h1 class="ellipsis" data-bind="l10n: { \'key\': \'pluginInstall_callback_text_title\', params: { displayName: conversationTopic }  }"></h1>\r\n            <div class="subtitle">\r\n                <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="l10n: { \'key\': \'pluginInstall_callback_text_subtitle\' }"></p>\r\n            </div>\r\n            <swx-avatar-deprecated params="isGroupAvatar: isGroupConversation, avatar: avatar" class="avatar"></swx-avatar-deprecated>\r\n            <div class="dual buttonRow">\r\n                <div class="column alignRight">\r\n                    <button class="btn primary large" data-bind="click: placeCall" type="button">\r\n                        <span data-bind="l10n: { \'key\': \'pluginInstall_callback_text_call\' }"></span>\r\n                    </button>\r\n                </div>\r\n                <div class="column alignLeft">\r\n                    <button class="btn secondary large" data-bind="click: notNow" type="button">\r\n                        <span data-bind="l10n: { \'key\': \'pluginInstall_callback_text_notNow\' }"></span>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("services/calling/pluginInstall",["require","exports","module","ui/viewModels/calling/plugin/pluginInstallViewModel","cafe/applicationInstance","swx-enums","text!views/calling/pluginInstall.html","ui/modalDialog/modalDialog"],function(e,t){var n=e("ui/viewModels/calling/plugin/pluginInstallViewModel"),r=e("cafe/applicationInstance"),i=e("swx-enums"),s=e("text!views/calling/pluginInstall.html"),o=e("ui/modalDialog/modalDialog"),u="overlayPluginSlides";t.startInstallFlow=function(t,r){var i=n.build(t,r);return o.build(u,i,s),i.start(),i},t.isPluginInstalled=function(t,n){var s=r.get().personsAndGroupsManager.mePerson.capabilities.audio,o=r.get().personsAndGroupsManager.mePerson.capabilities.video;return n?t.videoService.start.enabled.get().then(function(e){return o.reason!==i.callingNotSupportedReasons.PluginNotInstalled&&e}):t.audioService.start.enabled.get().then(function(e){return s.reason!==i.callingNotSupportedReasons.PluginNotInstalled&&e})}}),define("constants/components",{calling:{CALL_SCREEN:"swx-call-screen",PARTICIPANT:"swx-call-participant",ROSTER:"swx-call-roster",CALL_ANIMATION:"swx-call-animation",END_CALL:"swx-end-call",CONTENT:"swx-call-content",HEADER:"swx-call-header",FOOTER:"swx-call-footer",PARTICIPANT_MENU:"swx-participant-menu",JOINCALL_BUTTON:"swx-joincall-button",START_CALL_BUTTON:"swx-start-call-button",SKYPEOUT_PAGE:"swx-skype-out",SKYPEOUT_HEADER:"swx-skype-out-header",SKYPEOUT_DIALPAD:"swx-dialpad",SKYPEOUT_COUNTRY_PICKER:"swx-countrypicker",CQF:"swx-cqf",CQF_QUESTION:"swx-cqf-question"},chat:{CHAT_LOG:"swx-chat-log",CHAT_INPUT:"swx-chat-input",CONVERSATION:"swx-conversation",GROUP_SEARCH:"swx-group-search",INVITE_LINK:"swx-invite-link",HEADER_NEW_CONVERSATION:"swx-header-new-conversation",MESSAGE:"swx-message",NAVIGATION:"swx-navigation",SIDEBAR:"swx-sidebar",NEW_CONVERSATION:"swx-new-conversation",CONTACT_PICKER_INPUT:"swx-contact-picker-input",SPACE_SETTINGS:"swx-space-settings",RECENTS:"swx-recents",TEXTAREA:"swx-textarea",CURRENT_CALL:"swx-current-call",UNREAD_MESSAGE_COUNTER:"swx-unread-message-counter",CURRENT_CALL_ACTIONS:"swx-current-call-actions",RECENT_ITEM:"swx-recent-item",CONTACT_PILL:"swx-contact-pill",CONTACT_CARD:"swx-contact-card",MENU_ITEM:"swx-menu-item",HEADER:"swx-header",HEADER_SINGLE_CONVERSATION:"swx-header-single-conversation",GROUP_PROFILE:"swx-group-profile",TYPING_INDICATOR:"swx-typing-indicator",EXPRESSION_PICKER:"swx-expression-picker",EXPRESSION_ITEMS_PICKER:"swx-expressionitems-picker",EXPRESSION_ITEM_ROSTER:"swx-expressionitem-roster",EXPRESSION_STORE_V2_BROWSE_PACKS:"swx-expressionstore-v2-browsepacks",CONVERSATION_SHARE_LINK:"swx-conversation-share-link",SELECTED_PARTICIPANTS_CONVERSATION:"swx-selected-participants-conversation",CONVERSATION_CARD:"swx-conversation-card",SHARE_DIALOG_INPUT:"swx-share-dialog-input",FILE_PICKER:"swx-file-picker",NOTIFICATIONS_CENTER:"swx-notifications-center",NOTIFICATIONS_MENU_ITEM:"swx-notifications-menu-item",NOTIFICATIONS_TOGGLE_BUTTON:"swx-notifications-toggle-button",UPLOAD_MANAGER:"swx-upload-manager",POLL_DESIGNER:"swx-poll-designer",STICKY_MESSAGE:"swx-sticky-message",FILE_TRANSFER_ACTIVITY_ACTIONS:"swx-filetransfer-activity-actions",CHAT_INPUT_ACTION_PICKER:"swx-chat-input-action-picker",CHAT_INPUT_SEND_CONTACT_CARD:"swx-chat-input-send-contact-card",CHAT_INPUT_POLL_BUTTON:"swx-chat-input-poll-button",SHARE_CONTROL:"swx-share-control",START_CONVERSATION_OVERLAY:"swx-start-conversation-overlay",SUGGESTION_LIST:"swx-suggestion-list",VIDEO_PLAYER:"swx-video-player",HEART_TOAST:"swx-heart-toast",USER_LIST_POPUP:"swx-user-list-popup",TRANSLATOR_SETTINGS:"swx-translator-settings",TRANSLATOR_LANGUAGE_PICKER:"swx-translator-language-picker",MORE_ACTIONS_BUTTON:"swx-more-actions-button",HEART:"swx-heart",MESSAGES_SEARCH:"swx-messages-search"},experience:{BUTTON:"swx-button",SEARCH_INPUT:"swx-search-input",SEARCH_RESULTS:"swx-search-results",LOADING_ANIMATION:"swx-loading-animation",RADIO_BUTTON:"swx-radio-button",SELECT_BOX:"swx-select-box",TOGGLE_BUTTON:"swx-toggle-button"},people:{AVATAR:"swx-avatar",AVATAR_DEPRECATED:"swx-avatar-deprecated",NAME:"swx-name",CONTACT_PICKER:"swx-contact-picker",PEOPLE_SEARCH:"swx-people-search",CONTACT_LIST_MENU_ITEM:"swx-contact-list-menu-item",DIRECTORY_SEARCH:"swx-directory-search",DISCOVER_AGENTS_PAGE:"swx-discover-agents",CONTACTS_PAGE:"swx-contacts",CONTACT_PROFILE:"swx-contact-profile",CONTACT_PROFILE_PHONE_NUMBER:"swx-contact-profile-phone-number",CONTACT_REQUEST_INCOMING:"swx-contact-request-incoming",CONTACT_REQUEST_OUTGOING:"swx-contact-request-outgoing",CONTACT_REQUEST_OUTGOING_RESEND:"swx-contact-request-outgoing-resend"},commerce:{CREDIT_BALANCE:"swx-credit-balance",SUBSCRIPTION_ENTITLEMENT:"swx-subscription-entitlement"},me:{AREA:"swx-me-area",AVATAR_FILE_PICKER:"swx-me-avatar-file-picker",PRESENCE_POPUP:"swx-me-presence-popup"},userSettings:{USER_SETTINGS_PAGE:"swx-user-settings-page",SHORT_CIRCUIT:"swx-short-circuit",ABOUT:"swx-about"}}),define("ui/viewModels/chat/navigationHelper",["require","exports","module","lodash-compat","services/pubSub/pubSub","constants/common","constants/components"],function(e,t){var n=e("lodash-compat"),r=e("services/pubSub/pubSub"),i=e("constants/common"),s=e("constants/components");t.navigateToContactsPage=function(t){function o(){r.publish(i.events.navigation.NAVIGATE,{page:s.people.CONTACTS_PAGE}),t()}t=n.isFunction(t)?t:n.noop,o()},t.navigateToConversation=function(t,n){r.publish(i.events.navigation.OPEN_CONVERSATION,{model:t,origin:n})}}),define("ui/viewModels/calling/helpers/callingFacade",["require","exports","module","services/pubSub/pubSub","constants/calling","services/calling/pluginInstall","ui/viewModels/chat/navigationHelper","swx-enums"],function(e,t){function u(e,t,n,r){return a(e,t,n,r).catch(function(i){return l(i,e,t,n,r)})}function a(e,t,n,r){return i.isPluginInstalled(e,t).then(function(i){return i?f(e,t,n).then(function(){r&&s.navigateToConversation(e,n)}):c(e,t,!0,"outgoing",n,r)})}function f(e,t,i){return n.publish(r.EVENTS.START_CALL,{conversation:e,isVideo:t,source:i}),t?e.videoService.start():e.audioService.start()}function l(e,t,n,i,s){return t.selfParticipant.audio.state.reason===o.callDisconnectionReason.OutOfBrowserCall&&e.message===r.ERRORS.P2P_FALLBACK?a(t,n,i,s):Promise.reject(e)}function c(e,t,n,o,u,a){return new Promise(function(l,c){function h(n,i){if(e&&i&&n===r.PLUGIN_INSTALL_EXIT_METHOD.CALL_STARTED){var o=f(e,t,"pluginInstallCallback");a&&s.navigateToConversation(e,u),l(o)}else c(Error("Plugin install result: "+i+", exitMethod: "+n))}i.startInstallFlow(o,{isOutgoing:n,conversation:e,isVideo:t,done:h})})}var n=e("services/pubSub/pubSub"),r=e("constants/calling"),i=e("services/calling/pluginInstall"),s=e("ui/viewModels/chat/navigationHelper"),o=e("swx-enums");t.placeCall=function(e,t,n,r){return u(e,t,n,r)},t.acceptCall=function(e,t){n.publish(r.EVENTS.ANSWER,{conversation:e,isVideo:t}),t&&e.videoService.accept.enabled()?e.videoService.accept():e.audioService.accept()},t.rejectCall=function(e){n.publish(r.EVENTS.REJECT,{conversation:e}),e.audioService.reject()},t.installPlugin=function(e,t,n,r){r=r||!1,c(t,r,n,e)}}),define("experience/api/helpers/modality",["require","exports","module","lodash-compat","constants/common","swx-enums","ui/viewModels/calling/helpers/callingFacade","ui/telemetry/actions/actionNames","services/serviceLocator"],function(e,t){function l(e){return n.contains(e,a.VIDEO)}function c(e){return n.contains(e,a.AUDIO)}function h(e){return n.contains(e,a.CHAT)}function p(e){return l(e)||c(e)||h(e)}var n=e("lodash-compat"),r=e("constants/common"),i=e("swx-enums"),s=e("ui/viewModels/calling/helpers/callingFacade"),o=e("ui/telemetry/actions/actionNames"),u=e("services/serviceLocator"),a=r.modalityType,f=r.api.modality.errorMessages;t.startModalities=function(e,t,a){function g(){n.isFunction(t)&&t()}function y(e){if(n.isFunction(a))try{a(e)}catch(t){}}function b(e){e.start.enabled.reason===i.callingNotSupportedReasons.PluginNotInstalled?w(e===v.videoService):m=f.MODALITY_START_FAILED}function w(e){var t=u.resolve(r.serviceLocator.ACTION_TELEMETRY),n=e?o.audioVideo.apiVideoCall:o.audioVideo.apiAudioCall;t.recordAction(n),s.placeCall(v,e,"integrationAPI")}var d=e.modalities,v=e.conversation,m="";if(!d||n.isEmpty(d)){g();return}if(!n.isArray(d)){y(f.INVALID_MODALITIES);return}if(!p(d)){y(f.MODALITY_TYPE_NOT_SUPPORTED);return}l(d)&&(v.videoService.start.enabled()?v.videoService.start():b(v.videoService)),c(d)&&(v.audioService.start.enabled()?v.audioService.start():b(v.audioService)),h(d)&&v.chatService.start.enabled()&&e.startChatService&&v.chatService.start(),m===""?g():y(m)}}),define("experience/api/error",["require","exports","module","lodash-compat"],function(e,t){var n=e("lodash-compat");t.asApiError=function(e,t){var r;return e instanceof Error?r=Object.create(e):n.isString(e)?r=new Error(e):(r=new Error("Unknown: please check *data* property for more info"),r.data=e),r.name=["SWXApi",t||"",r.name].join(":"),r}}),define("telemetry/chat/conversationJoined",["require","exports","module","experience/settings","ui/modelHelpers/personHelper","ui/telemetry/telemetryClient","browser/window","constants/common"],function(e,t){function a(){function t(e){return r.isGuestId(e)?o.result.SIGNED_OUT:o.result.SIGNED_IN}function u(t,r){r=r||o.result.INCONCLUSIVE;var u=o.TYPE,a={milestone:t,result:r.toString(),client_time:(new s.Date).getMilliseconds().toString(),Prefix:e._prefix,thread_id:e._threadId.toString()};i.get().sendEvent(n.telemetry.uiTenantToken,u,a)}function a(e){return/^(.*):/.exec(e)[1]}function f(){e._threadId=undefined,e._prefix=undefined}var e=this;return e._threadId=undefined,e._prefix=undefined,e.onJoinConversation=function(n){var r=n.prefix.indexOf(":")===-1,i=t(n.prefix);e._threadId=n.uri,e._prefix=r?"":a(n.prefix),u(o.milestoneType.CLIENT_INIT,i)},e.onJoinConversationError=function(e){u(o.milestoneType.ERROR,e),f()},e.onConversationJoined=function(){if(!e.isTriggered())return;u(o.milestoneType.END,o.result.SUCCESS),f()},e.isTriggered=function(){return e._threadId},e}var n=e("experience/settings"),r=e("ui/modelHelpers/personHelper"),i=e("ui/telemetry/telemetryClient"),s=e("browser/window"),o=e("constants/common").telemetry.conversationJoined,u;t.get=function(){return u||(u=new a),u}}),define("experience/api/helpers/conversationsSynchronizer",["require","exports","module","cafe/applicationInstance"],function(e,t){var n=e("cafe/applicationInstance");t.sync=function(){function r(e){var t=n.get().conversationsManager;return t.conversations.size()<1&&t.getMoreConversations.enabled()?t.getMoreConversations(1).then(s).catch(i):s(e)}function i(){return Promise.all([])}function s(e){e=e||n.get().conversationsManager.conversations();var t=e.reduce(function(e,t){return t.conversationId?e.concat([t.conversationId]):e.concat([t.uri()||t.uri.get()])},[]);return Promise.all(t)}var t=n.get().conversationsManager.conversations.get();return t.then(r)}}),define("experience/api/helpers/conversationFacade",["require","exports","module","vendor/knockout"],function(e,t){function r(e){function r(){t.participantsCount(e.participantsCount())}var t=this;return t.participantsCount=n.observable(0),t.init=function(){e.participants.changed(r)},t.dispose=function(){e.participants.changed.off(r)},t.isJoinable=function(){return e.isJoiningEnabled.set.enabled()},t.makeJoinable=function(){e.isJoiningEnabled.set.enabled.once(!0,function(){e.isJoiningEnabled.set(!0)})},t}var n=e("vendor/knockout");t.build=function(e){return new r(e)}}),define("experience/api/helpers/contentNavigator",["require","exports","module","constants/common","services/serviceLocator"],function(e,t){function i(e){function u(){return r.resolve(n.serviceLocator.PUBSUB)}function a(e){f(e.contentElementId)&&(u().unsubscribe(o,a),t=!0,i&&(i(),i=null))}function f(e){return s=s||l(),e===s}function l(){return e.firstChild?e.firstChild.getAttribute("id"):null}function c(e){u().publish(n.events.navigation.OPEN_CONVERSATION,{model:e,origin:n.telemetry.historyLoadOrigin.NEW_CHAT_API_START_CONVERSATION,contentElementId:s})}var t=!1,i=null,s=null,o=n.apiUIEvents.SWX_CONTENT_LOADED;u().subscribe(o,a),this.navigateToConversation=function(e){t?c(e):i=c.bind(undefined,e)}}var n=e("constants/common"),r=e("services/serviceLocator");t.build=function(e){return new i(e)}}),define("experience/api/helpers/contentNavigatorStore",["require","exports","module","lodash-compat","experience/api/helpers/contentNavigator","browser/dom"],function(e,t){function o(){if(s.length>0)return s[0].navigator}var n=e("lodash-compat"),r=e("experience/api/helpers/contentNavigator"),i=e("browser/dom"),s=[];t.add=function(e){var t=i.getElement(e),n=r.build(t);s.push({contentContainer:t,navigator:n})},t.get=function(e){var t=i.getElement(e);return t?n.find(s,function(e){return e.contentContainer===t}).navigator:o()},t.clear=function(){s=[]}}),define("experience/api/helpers/conversation",["require","exports","module","lodash-compat","cafe/applicationInstance","experience/api/auth/authEventHandler","experience/api/helpers/modality","experience/api/error","ui/modelHelpers/conversationHelper","swx-enums","constants/common","telemetry/chat/conversationJoined","experience/api/helpers/conversationsSynchronizer","experience/api/helpers/conversationFacade","experience/settings","services/serviceLocator","experience/api/helpers/contentNavigatorStore"],function(e,t){function g(e,t,r){if(!n.isFunction(t))return;try{t(S(e))}catch(i){y(r,m.SUCCESS_CALLBACK_ERROR)}}function y(e,t){n.isFunction(e)&&e(o(t))}function b(e){var t=d.resolve(f.serviceLocator.FEATURE_FLAGS),n;if(!t.isFeatureOn(f.featureFlags.SINGLE_CONVERSATION_MODE))return;i.deferActionOnSplashscreen(function(e){n=d.resolve(f.serviceLocator.PUBSUB),n.publish(f.apiUIEvents.SWX_SINGLE_CONVERSATION,e)},e)}function w(e,t,r){if(!n.isFunction(t))return;try{t(S(e)),b()}catch(i){E(r,m.SUCCESS_CALLBACK_ERROR)}}function E(e,t){try{b(t)}catch(n){}l.get().onJoinConversationError(t),y(e,t)}function S(e){return p.API.version===2?e:h.build(e)}function x(e){var t,n=a.searchScope.All;return t=e.map(function(e){var t=r.get().personsAndGroupsManager.createPersonSearchQuery();return new Promise(function(r,i){function s(){t.results().length?r(t.results(0).result):i()}t.sources(n).keywords.id=e,t.getMore().then(s,i)})}),Promise.all(t)}var n=e("lodash-compat"),r=e("cafe/applicationInstance"),i=e("experience/api/auth/authEventHandler"),s=e("experience/api/helpers/modality"),o=e("experience/api/error").asApiError,u=e("ui/modelHelpers/conversationHelper"),a=e("swx-enums"),f=e("constants/common"),l=e("telemetry/chat/conversationJoined"),c=e("experience/api/helpers/conversationsSynchronizer"),h=e("experience/api/helpers/conversationFacade"),p=e("experience/settings"),d=e("services/serviceLocator"),v=e("experience/api/helpers/contentNavigatorStore"),m=f.api.conversation.errorMessages;t.startConversation=function(e,t,n,r,i){function f(e,a){var f=u.createConversation(e,a),l={modalities:t,conversation:f},c=v.get(i);s.startModalities(l,function(){c&&c.navigateToConversation(f),g(f,n,r)},o)}var o=y.bind(null,r),a;if(!Array.isArray(e)){o(m.URI_NOT_VALID);return}if(e.length===0){f([],!0);return}a=p.startConversationMaxParticipantCount,a>0&&e.length>a&&(e=e.slice(0,a));if(p.authentication&&p.authentication.anonymousMode){f(e);return}x(e).then(function(e){f(e)},function(){o(m.SEARCH_FAILED)}).catch(o)},t.joinConversation=function(e,t,i,o,u,a){function p(e){var n={modalities:t,conversation:e,startChatService:!0},r=v.get(a);s.startModalities(n,function(){r&&r.navigateToConversation(e),w(e,i,o)},f)}var f=E.bind(null,o),h=r.get().conversationsManager;if(!n.isString(e)){f(m.URI_NOT_VALID);return}r.get().personsAndGroupsManager.mePerson.id.get().then(function(t){l.get().onJoinConversation({uri:e,prefix:t}),c.sync().then(function(){if(u)h._getConversationByUri(e).then(p).catch(f);else try{var t=h.getConversationByUri(e);p(t)}catch(n){f(n)}})}).catch(f)}}),define("experience/api/conversation",["require","exports","module","experience/api/helpers/conversation","experience/api/helpers/modality","ui/modelHelpers/conversationHelper","constants/common","constants/components","experience/settings","services/serviceLocator","services/pubSub/pubSub","experience/api/helpers/contentNavigatorStore"],function(e,t){function c(e,t){return new Promise(function(r,i){function f(t){var n=a.resolve(s.serviceLocator.CONTROLS_BUILDER);n.build(u.controls.content.toLowerCase(),e),r(t)}function c(e){i(e)}var o=t&&t.modalities?t.modalities:null;if(!e){c(s.api.renderConversation.errorMessages.CONTAINER_UNDEFINED);return}if(!(typeof e=="string"||e instanceof Node)){c(s.api.renderConversation.errorMessages.CONTAINER_NOT_ELEMENT_NOT_SELECTOR);return}l.add(e);if(!t||!t.participants&&!t.conversationId){h(o,e,f,c);return}if(t.participants){Array.isArray(t.participants)?n.startConversation(t.participants,o,f,c,e):c(s.api.renderConversation.errorMessages.PARTICIPANTS_WRONG_FORMAT);return}t.conversationId&&(typeof t.conversationId=="string"?n.joinConversation(t.conversationId,o,f,c,!1,e):c(s.api.renderConversation.errorMessages.CONVERSATION_ID_WRONG_FORMAT))})}function h(e,t,n,s){function a(){var e=l.get(t);e&&e.navigateToConversation(o),n(o)}var o=i.createConversation([],!0),u={modalities:e,conversation:o};r.startModalities(u,a,s)}var n=e("experience/api/helpers/conversation"),r=e("experience/api/helpers/modality"),i=e("ui/modelHelpers/conversationHelper"),s=e("constants/common"),o=e("constants/components"),u=e("experience/settings"),a=e("services/serviceLocator"),f=e("services/pubSub/pubSub"),l=e("experience/api/helpers/contentNavigatorStore");t.newConversation=function(){var e={page:o.chat.NEW_CONVERSATION,origin:s.telemetry.historyLoadOrigin.NEW_CONVERSATION_API};f.publish(s.events.navigation.NAVIGATE,e)},t.startConversation=function(e,t,r,i){n.startConversation(e,t,r,i)},t.joinConversation=function(e,t,r,i){var o=a.resolve(s.serviceLocator.FEATURE_FLAGS);o.isFeatureOn(s.featureFlags.SYNC_THREAD_BEFORE_JOIN_CONVERSATION_FLOW_ENABLED)?n.joinConversation(e,t,r,i,!0):n.joinConversation(e,t,r,i,!1)},t.renderConversation=function(e,t){return c(e,t)}}),define("notifications/common/notificationHub",[],function(){var e,t={};return t.notify=function(t){if(e){t.active(!0);try{e(t)}catch(n){}}},t.addNotificationListener=function(t){e=t},t.removeNotificationListener=function(){e&&(e=null)},t}),define("experience/api/notifications",["require","exports","module","notifications/common/notificationHub"],function(e,t){var n=e("notifications/common/notificationHub");t.setNotificationHandler=function(e){n.addNotificationListener(e)}}),define("utils/chat/unreadConversations",["require","vendor/knockout","cafe/applicationInstance","utils/common/cafeObservable"],function(e){function s(){function u(n,r){t.utils.addOrRemoveItem(e(),n,!r),e.valueHasMutated()}function a(e){e.__subUnread&&e.__subUnread.dispose();var t=e.historyService.activityItems;t().length&&(e.__subUnread=t(t().length-1).isRead.changed(u.bind(null,e)))}function f(e){e.__subUnreadActivityItems=e.historyService.activityItems.changed(a.bind(null,e))}function l(e){e.__subUnreadActivityItems.dispose()}var e=t.observableArray(),i,s=r.newObservableProperty(n.get().conversationsManager.unreadConversationsCount).extend({rateLimit:300}),o=t.pureComputed({deferEvaluation:!0,read:function(){return i||(n.get().conversationsManager.conversations.added(f),n.get().conversationsManager.conversations.removed(l),i=!0),e()}});return{getUnread:o,getCount:s}}var t=e("vendor/knockout"),n=e("cafe/applicationInstance"),r=e("utils/common/cafeObservable"),i;return{getInstance:function(){return i||(i=s()),i},destroy:function(){i=null}}}),define("experience/api/calling",["require","vendor/knockout","cafe/applicationInstance","constants/calling","services/pubSub/pubSub","ui/viewModels/calling/helpers/callingFacade","constants/common","constants/components","swx-enums"],function(e){function h(){p(),d()}function p(){i.subscribe(r.EVENTS.FULLSCREEN_CHANGED,function(e){l(e)})}function d(){n.get().personsAndGroupsManager.mePerson.capabilities.audio.changed(function(e,t){var n=t!==a.callingNotSupportedReasons.PluginNotInstalled;c(n)})}function v(){s.installPlugin("callingApi")}function m(){var e={page:u.calling.SKYPEOUT_PAGE,origin:o.telemetry.historyLoadOrigin.SKYPEOUT_PAGE_API};i.publish(o.events.navigation.NAVIGATE,e)}function g(){return h(),{isPluginInstalled:t.computed(function(){return c()}),openPstnPage:m,startPluginInstall:v,isFullScreen:t.computed(function(){return l()})}}var t=e("vendor/knockout"),n=e("cafe/applicationInstance"),r=e("constants/calling"),i=e("services/pubSub/pubSub"),s=e("ui/viewModels/calling/helpers/callingFacade"),o=e("constants/common"),u=e("constants/components"),a=e("swx-enums"),f,l=t.observable(!1),c=t.observable(!1);return f={buildApi:g},f}),define("telemetry/authentication/setAuthProvider",["require","exports","module","ui/telemetry/telemetryClient","experience/settings"],function(e,t){function i(){function e(e){var t="setAuthProvider",i={};i.authType=e.authType,i.success=e.hasSucceed,i.implicitSignIn=e.implicitSignIn,i.hostname=location.hostname,e.hasSucceed||(i.error=e.error,e.details&&(i.details=e.details)),n.get().sendEvent(r.telemetry.uiTenantToken,t,i),n.get().setAuthType&&n.get().setAuthType(e.authType)}return{send:e}}var n=e("ui/telemetry/telemetryClient"),r=e("experience/settings");t.build=function(){return new i}}),define("experience/api/authentication",["require","cafe/applicationInstance","constants/common","experience/settings","experience/api/auth/linking","experience/api/error","telemetry/authentication/signIn","telemetry/authentication/setAuthProvider","experience/api/auth/authEventHandler","experience/authContext","services/serviceLocator","lodash-compat","services/pubSub/pubSub","swx-enums"],function(e){function E(){y=!0,a.init()}function S(){y=!1,a.destroy()}function x(e){if(c.isFunction(e))try{e.apply(null,[].slice.call(arguments,1))}catch(t){}}function T(e,t,n){function s(){_(i,e,r),x(t)}function o(t){_(i,e,r,t),x(n)}var r=t!==!1,i=u.build();d=!1,v=e,r?(f.get().implicitSignIn=!0,N(s,o)):_(i,e,r)}function N(e,t,n){try{k(O(v),e,t,n)}catch(r){x(t,s(r,"signIn"))}}function C(e,r){function u(){y=B(),f.reset(),o.status(p.onlineStatus.Offline),x(e)}function a(e){f.reset(),x(r,s(e,"signOut"))}var i=t.get().signInManager,o=t.get().personsAndGroupsManager.mePerson;d=!1,i.signOut.enabled()?i.signOut().then(u,a):a(n.api.auth.errorMessages.ALREADY_SIGNED_OUT)}function k(e,i,u,l){function w(){f.reset(),window.clearTimeout(p),x(i)}function E(e){f.reset(),F(e)?D(e,i,u):(x(u,s(e)),a.deferActionOnSplashscreen(function(){h.publish(n.events.auth.SIGNIN_FAILED,e)},e)),d=!0}function S(){var t;O(),t=A(b),E(t),i=null,u=null,M(g,e.type,t,l.isExternalSignIn)}function T(){var e=n.api.auth.DEFAULT_SIGNIN_TIMEOUT;return r.authentication&&r.authentication.signInTimeout&&(e=r.authentication.signInTimeout),e}function N(){p||(p=window.setTimeout(S,T()))}function C(){p&&(window.clearTimeout(p),p=undefined)}function k(){window.addEventListener(n.events.browser.FOCUS,N),window.addEventListener(n.events.browser.BLUR,C)}function O(){window.removeEventListener(n.events.browser.FOCUS,N),window.removeEventListener(n.events.browser.BLUR,C)}var p,v=t.get().signInManager,m=c.defaults(e,{id:r.application.endpointId,version:j()}),g=o.build(),b;l=l||{};if(!y){E(new Error(n.api.auth.errorMessages.AUTH_DISABLED));return}if(!v.signIn.enabled()){E(new Error(n.api.auth.errorMessages.ALREADY_SIGNED_IN));return}N(),k(),v.signIn(m).then(function(){C(),O(),M(g,e.type,null,l.isExternalSignIn),w()},function(n){var r;C(),O(),r=L(n),M(g,e.type,r,l.isExternalSignIn),E(r)},function(t){b=t})}function L(e){var t,r,i,s;e=e||{},m=e.rps_token,g=e.site_name,t=e.reason,r=e.req||e.request,i=e.rsp||e.response,s=new Error(e.error||e.code||e.message||""),a.setErrorType(s),s.details={},t&&(s.details.reason=JSON.stringify(t)),r&&(s.details.request=JSON.stringify(r));if(i){s.details.response=JSON.stringify(i);if(i.status===b||i.data&&i.data.subcode===w)s.name=n.api.auth.errorTypes.TOO_MANY_CONNECTIONS_ERROR}return s}function A(e){var t=new Error(n.silentLogin.errorMessages.TIMED_OUT);return t.jCafeStatus=e,t}function O(e){var i=t.get().signInManager,s;if(e.type===n.api.auth.authProviderType.SKYPE_TOKEN)return i.createTokenSignInParameter({getToken:e.getToken});if(e.type===n.api.auth.authProviderType.IMPLICIT_AUTH)return i.createImplicitOAuthSignInParameter(r.implicitOAuthParams);if(e.type===n.api.auth.authProviderType.PASSWORD)return i.createPasswordSignInParameter({username:e.username,password:e.password});if(e.type===n.api.auth.authProviderType.ANONYMOUS)return s={type:"Anonymous",meeting:e.options.conferenceUri,name:e.options.displayName},e.options.useInternalAnonFlow&&(s.xmscwt=e.options.useInternalAnonFlow),e.options.discoverUri&&(s.root={user:e.options.discoverUri}),s;throw new Error("invalid auth type")}function M(e,t,n,r){var i;i={authType:t,hasSucceed:!0,retry:d,isExternalSignIn:Boolean(r)},n&&(i.hasSucceed=!1,i.error=n.message,i.details=n.details,n.jCafeStatus&&(i.jCafeStatus=n.jCafeStatus)),e.send(i)}function _(e,t,n,r){var i={authType:t.type,hasSucceed:!0,implicitSignIn:n};r&&(i.hasSucceed=!1,i.error=r.message||"Unknown error",r.data&&(i.details=r.data)),e.send(i)}function D(e,t,r){function u(e){return function(){var s={rps_token:m,onSuccess:t,onFailure:r};e===n.api.auth.accountLinking.WELCOME_FLOW&&(s.welcome=!0),e===n.api.auth.accountLinking.INLINE_NEW_USER_FLOW&&(s.createTechnical=!0,s.hidden=!0),P(s),i.start(s)}}var s=u(n.api.auth.accountLinking.WELCOME_FLOW),o=!1;H()&&(s=u(n.api.auth.accountLinking.INLINE_NEW_USER_FLOW),o=!0),a.startAuthFailedFlow(e,s,o)}function P(e){!g||(e.site_name=g)}function H(){var e=l.resolve(n.serviceLocator.FEATURE_FLAGS);return e.isFeatureOn(n.featureFlags.SILENT_LINKING)}function B(){var e=l.resolve(n.serviceLocator.FEATURE_FLAGS);return e.isFeatureOn(n.featureFlags.RE_AUTH_ENABLED)}function j(){return"{product}({version} - {workload})".replace("{product}",r.productName||"unknown").replace("{version}",r.version||"").replace("{workload}",r.initParams.correlationIds.hostProperty||"unknown")}function F(e){return e&&e.name===n.api.auth.errorTypes.NOT_LINKED}var t=e("cafe/applicationInstance"),n=e("constants/common"),r=e("experience/settings"),i=e("experience/api/auth/linking"),s=e("experience/api/error").asApiError,o=e("telemetry/authentication/signIn"),u=e("telemetry/authentication/setAuthProvider"),a=e("experience/api/auth/authEventHandler"),f=e("experience/authContext"),l=e("services/serviceLocator"),c=e("lodash-compat"),h=e("services/pubSub/pubSub"),p=e("swx-enums"),d,v,m,g,y,b=410,w="LimitExceeded";return{init:E,destroy:S,setAuthProvider:T,signIn:N,signOut:C}}),define("experience/api/events",["require","exports","module","lodash-compat","services/serviceLocator","constants/common"],function(e,t){var n=e("lodash-compat"),r=e("services/serviceLocator"),i=e("constants/common");t.subscribeUI=function(e,t){var s=r.resolve(i.serviceLocator.PUBSUB);if(!n.isString(e)||!n.isFunction(t))throw new TypeError("invalid arguments; expected an event name (String) and callback (Function)");s.subscribe(e,t)}}),define("utils/common/applicationFocusManager",["require","exports","module","services/serviceLocator","constants/common","ui/telemetry/actions/actionNames","browser/dom","browser/document","browser/detect"],function(e,t){function m(e){if(t.focusTrackingEnabled){e.target!==t.getLastFocusedElement()&&(e.target.setAttribute("data-focusManager",v),p.push(v),v++);if(p.length>h){var n=p.shift();y(n)}}}function g(e){return o.querySelector("["+c+'="'+e+'"]')}function y(e){var t=g(e);t&&t.removeAttribute(c)}var n=e("services/serviceLocator"),r=e("constants/common"),i=e("ui/telemetry/actions/actionNames"),s=e("browser/dom"),o=e("browser/document"),u=e("browser/detect"),a=".swx .chat .inputField",f=".swx .search .inputField",l="#swxSplashScreen",c="data-focusManager",h=2,p=[],d=null,v=0;return t.focusTrackingEnabled=!1,t.reset=function(){p.forEach(y),p=[],v=0},t.setDefaultFocusElement=function(e){d=e},t.getDefaultFocusElement=function(){return d},t.getLastFocusedElement=function(){return p.length?g(p[p.length-1]):null},t.removeLastFocusedElement=function(){var e=p.pop();y(e)},t.registerContainer=function(e){e.addEventListener("focus",m,!0)},t.unregisterContainer=function(e){e.removeEventListener("focus",m,!0)},t.tryRestoreFocus=function(){if(!t.focusTrackingEnabled)return;var e=n.resolve(r.serviceLocator.ACTION_TELEMETRY);e.recordAction(i.focusManager.tryRestoreFocus);var s=t.getLastFocusedElement();s&&s.focus();if(s===o.activeElement)return;var u=o.querySelector(l);if(u)return;var c=o.querySelector(a),h=o.querySelector(f);c&&c.focus();if(c===o.activeElement)return;h&&h.focus()},t.isAnyElementFocused=function(){var e=o.activeElement;return!!(!u.getBrowserInfo().isIeEngine||e&&Object.keys(e).length)&&!s.isA(e,"body")},t}),define("utils/common/appVisibilityProvider",["require","exports","module","vendor/knockout","browser/document","browser/window","utils/common/applicationFocusManager"],function(e,t){var n=e("vendor/knockout"),r=e("browser/document"),i=e("browser/window"),s=e("utils/common/applicationFocusManager");t.hasFocus=n.observable(),t.isVisible=function(e){e&&s.tryRestoreFocus()},t.init=function(){i.addEventListener("focus",t.hasFocus.bind(null,!0)),i.addEventListener("blur",t.hasFocus.bind(null,!1)),t.hasFocus(r.hasFocus())}}),define("experience/api/visibility",["require","exports","module","utils/common/appVisibilityProvider"],function(e,t){var n=e("utils/common/appVisibilityProvider");t.setFocus=function(e){n.isVisible(e)}}),define("experience/api/focus",["require","exports","module","utils/common/applicationFocusManager"],function(e,t){var n=e("utils/common/applicationFocusManager");t.restoreFocus=function(){n.tryRestoreFocus()}}),define("experience/api/rendering",["require","exports","module","constants/common","experience/settings","services/serviceLocator","experience/api/helpers/contentNavigatorStore"],function(e,t){function o(e,t,r){var s=i.resolve(n.serviceLocator.CONTROLS_BUILDER);return s.build(e,t,r)}var n=e("constants/common"),r=e("experience/settings"),i=e("services/serviceLocator"),s=e("experience/api/helpers/contentNavigatorStore");t.renderContent=function(e,t){s.add(e),o(r.controls.content.toLowerCase(),e,t)},t.renderSidebar=function(e,t){o(r.controls.sidebar.toLowerCase(),e,t)},t.renderMe=function(e,t){o(r.controls.me.toLowerCase(),e,t)}}),define("experience/api/messageFilter",["require","lodash-compat","experience/settings"],function(e){function r(e){if(!t.isFunction(e))throw"Message filter needs to be a valid function object";n.messageFilters.outgoingMessageFilter=e}function i(e){if(!t.isFunction(e))throw"Message filter needs to be a valid function object";n.messageFilters.chatLogMessageFilter=e}var t=e("lodash-compat"),n=e("experience/settings");return{setOutgoingMessageFilter:r,setChatLogMessageFilter:i}}),define("experience/api/flagsObservable",["require","exports","module","lodash-compat","constants/common","vendor/knockout","services/serviceLocator","experience/settings"],function(e,t){var n=e("lodash-compat"),r=e("constants/common"),i=e("vendor/knockout"),s=e("services/serviceLocator"),o=e("experience/settings");t.expose=function(){var e=i.observable(""),t=s.resolve(r.serviceLocator.PUBSUB);return t.subscribe(r.events.flags.SET_FLAG,function(t){if(!n.isString(t))throw new TypeError("invalid arguments; expected a flag name (String)");e(o.version+"/"+t)}),{setFlag:e}}}),define("experience/api/builder",["require","exports","module","jCafe","cafe/applicationInstance","experience/api/me","experience/api/contact","experience/api/conversation","experience/api/notifications","utils/chat/unreadConversations","experience/api/calling","experience/api/authentication","experience/api/events","experience/api/visibility","experience/api/focus","experience/api/rendering","experience/settings","experience/api/messageFilter","experience/api/flagsObservable"],function(e,t){function y(e){e.isAvailable=function(){return!0}}function b(e){e.setPluginAutoUpdate=function(e){v.featureFlags.pluginAutoUpdate=e}}function w(e){e.application=n.Application}function E(e){e.subscribeUI=c.subscribeUI}function S(e){e.renderContent=d.renderContent,e.renderSidebar=d.renderSidebar,e.renderMe=d.renderMe}function x(e){e.me=i.expose()}function T(e){e.contact=s.getByUri}function N(e){e.setNotificationHandler=u.setNotificationHandler}function C(e){e.startConversation=o.startConversation,e.joinConversation=o.joinConversation,e.newConversation=o.newConversation}function k(e){e.activity={unreadConversations:a.getInstance().getCount}}function L(e){e.setFocus=h.setFocus}function A(e){e.focus={restoreFocus:p.restoreFocus}}function O(e){e.calling=f.buildApi()}function M(e){l.init(),e.setAuthProvider=l.setAuthProvider,e.signIn=l.signIn,e.signOut=l.signOut}function _(e){e.getVersion=function(){return v.version}}function D(e){e.renderConversation=o.renderConversation}function P(e){e.setAnonymousUserMode=function(e){v.authentication.anonymousMode=!!e}}function H(e){e.UIApplicationInstance=r.get()}function B(e){e.setOutgoingMessageFilter=m.setOutgoingMessageFilter}function j(e){e.setChatLogMessageFilter=m.setChatLogMessageFilter}function F(e){e.setFlag=g.expose().setFlag}var n=e("jCafe"),r=e("cafe/applicationInstance"),i=e("experience/api/me"),s=e("experience/api/contact"),o=e("experience/api/conversation"),u=e("experience/api/notifications"),a=e("utils/chat/unreadConversations"),f=e("experience/api/calling"),l=e("experience/api/authentication"),c=e("experience/api/events"),h=e("experience/api/visibility"),p=e("experience/api/focus"),d=e("experience/api/rendering"),v=e("experience/settings"),m=e("experience/api/messageFilter"),g=e("experience/api/flagsObservable");t.get=function(){var t={};return v.API.version===1&&(M(t),x(t),T(t),N(t),S(t),C(t),k(t),L(t),A(t),E(t),_(t),O(t),b(t),y(t),F(t)),v.API.version===2&&(H(t),D(t),P(t),B(t),j(t)),v.API.exposeCafe&&w(t),t}}),define("experience/componentsInitializer",[],function(){function t(t,n,r){function o(){++i===t.length&&(window.clearTimeout(s),n&&(n(),u()))}function u(){t.forEach(function(e){e.load&&e.load()})}function a(){n=null,r("Initialization not completed by timeout period.")}var i=0,s=window.setTimeout(a,e);t.forEach(function(e){e.init(o)})}var e=3e3;return{init:t}}),define("text!views/experience/sidebar.html",[],function(){return'<swx-sidebar data-bind="event: { mousemove: handleUserAction, click: handleUserAction, mousewheel: handleUserAction, keydown: handleUserAction }"></swx-sidebar>\r\n'}),define("text!views/chat/shareDialog.html",[],function(){return'<div id="swx-share-dialog" data-bind="css:{ \'swx-hide\': isHidden }">\r\n    <div id="top-bar">\r\n        <div id="title-holder">\r\n            <span id="title"\r\n                  data-bind="l10n: { \'key\': \'share_on_skype_dialog_title\'}">\r\n            </span>\r\n        </div>\r\n    </div>\r\n\r\n    <div id="lower-pane">\r\n\r\n        <div id="link-preview-placeholder"></div>\r\n\r\n        <div class="conversationControl chat themeLight">\r\n            <swx-chat-input\r\n                class="input"\r\n                data-bind="css: { showCover: false, hide: false }"\r\n                params="conversationModel: null,\r\n                        alwaysHideExpressionPicker: true">\r\n            </swx-chat-input>\r\n        </div>\r\n\r\n        <div class="shareButtonHolder">\r\n            <swx-button params="cssClass: \'primary circle\',\r\n                                disabled: !shareButtonEnabled,\r\n                                textKey: \'share_on_skype_share_button\',\r\n                                titleKey: \'share_on_skype_share_button\',\r\n                                action: share">\r\n            </swx-button>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("utils/common/eventMixin",["require","lodash-compat"],function(e){function n(){this.listeners=null,this._disposeExtended=!1,this._parentContext=null,this._childrenContexts=null}function r(e,t,n){return e.filter(function(e){return e.callback===t&&e.context===n})[0]}function i(e,t){e.splice(e.indexOf(t),1)}function s(e,t,n,r){var i=e&&e.listeners&&e.listeners[t],s=!1;return i?(i.forEach(function(e){e.direction&n&&(e.callback.call(e.context,r),s=!0)}),s):!1}function o(e){if(e._disposeExtended)return;var t=e.dispose;e.dispose=function(){e.disposeEvents(),t&&t.call(e)},e._disposeExtended=!0}var t=e("lodash-compat");return n.prototype.DIRECTION={PARENT:1,CHILD:2,ANY:3},n.prototype.dispatchEvent=function(t,r,i){var o=!1;return t?(i=i||n.DIRECTION.ANY,i&n.DIRECTION.PARENT&&(!this._parentContext,o=s(this._parentContext,t,n.DIRECTION.CHILD,r)),i&n.DIRECTION.CHILD&&this._childrenContexts&&this._childrenContexts.forEach(function(e){o=s(e,t,n.DIRECTION.PARENT,r)||o}),o):!1},n.prototype.addChildContext=function(t){this._childrenContexts=this._childrenContexts||[],this._childrenContexts.push(t),o(this)},n.prototype.removeChildContext=function(t){if(this._childrenContexts){var n=this._childrenContexts.indexOf(t);n!==-1&&this._childrenContexts.splice(n,1)}},n.prototype.setContext=function(t){this._parentContext=t,this._parentContext.addChildContext&&this._parentContext.addChildContext(this),o(this)},n.prototype.disposeEvents=function(){this.listeners=null,this._childrenContexts=null,this._parentContext&&this._parentContext.removeChildContext&&this._parentContext.removeChildContext(this),this._parentContext=null},n.prototype.registerEvent=function(t,s,u,a){var f,l,c;return!t||!s?null:(o(this),this.listeners=this.listeners||{},this.listeners[t]=this.listeners[t]||[],f=this.listeners[t],(u&n.DIRECTION.ANY)===0&&(a=u,u=n.DIRECTION.ANY),u=u||n.DIRECTION.ANY,l=r(f,s,a),l?null:(c={callback:s,direction:u,context:a},f.push(c),{dispose:function(){i(f,c)}}))},n.prototype.forwardEvent=function(t,r,i,s,o){(s&n.DIRECTION.ANY)===0&&(o=s,s=n.DIRECTION.ANY),this.registerEvent(t,function(e){i&&i.call(o,e),this.dispatchEvent(t,e,r,o)},s,this)},t.assign(n,n.prototype),n}),define("ui/viewModels/chat/shareDialog",["require","exports","module","lodash-compat","vendor/knockout","constants/common","utils/common/eventMixin","cafe/applicationInstance"],function(e,t){function u(e,t){function a(){return s.chatInputAsync.then(function(e){f().then(function(t){var r=e();n.forEach(t,function(e){l(e,r)})})})}function f(){var e=o.get().conversationsManager,t,r=e.conversations();return r.length>0?(t=n.max(r,function(e){return e.lastModificationTimestamp()}),Promise.resolve([t])):e.getMoreConversations.enabled()?e.getMoreConversations(1).then(function(){return[n.first(e.conversations())]}):Promise.resolve([])}function l(e,t){var n=e.chatService;t=t.trim(),t.length>0&&n.sendMessage(t),s.sharedUrl&&n.sendMessage(s.sharedUrl)}var s=this,u=[];s.sharedUrl=e,s.flowId=t,s.isHidden=r.observable(!0),s.show=function(){s.isHidden(!1)},s.dispose=function(){},s.shareButtonEnabled=r.observable(!0),s.chatInputAsync=new Promise(function(e){s.registerEvent(i.textarea.INITIALIZATION_COMPLETE,function(n){e(n.messageBody)})}),s.share=function(){var e=a();return u.push(e),e.then(function(){u.remove(e)}),e},s.whenAllSharingOpsCompleted=function(){return Promise.all(u)}}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("constants/common").events,s=e("utils/common/eventMixin"),o=e("cafe/applicationInstance");n.assign(u.prototype,s),t.build=function(e,t){return new u(e,t)}}),define("ui/controls/experience/shareDialogController",["require","exports","module","vendor/knockout","browser/dom","browser/window","constants/common","services/serviceLocator","text!views/chat/shareDialog.html","ui/viewModels/chat/shareDialog"],function(e,t){function c(){h();var e=p(),t=a.build(e.sharedUrl,e.flowId),r=d();n.applyBindings(t,r),t.show()}function h(){var e=r.getElement("#"+l);if(e)throw new Error("Internal API error: Share Dialog should not be launched more than once")}function p(){var e=t.getRawQueryString()||"";e=e.replace(/^\??/,"");var n=e.split("&"),r={};for(var i=0;i<n.length;i++){var s=n[i].split("="),o=decodeURIComponent(s[0]||"").toLowerCase(),u=decodeURIComponent(s[1]||""),a=r[o];a||(a=[],r[o]=a),a.push(u)}return{sharedUrl:(r.sharedurl||[])[0],flowId:(r.flowid||[])[0]}}function d(){var e=r.createElement("div");e.innerHTML=u;var t=e.firstChild,n=r.getElement(f);return n.appendChild(t),t}var n=e("vendor/knockout"),r=e("browser/dom"),i=e("browser/window"),s=e("constants/common"),o=e("services/serviceLocator"),u=e("text!views/chat/shareDialog.html"),a=e("ui/viewModels/chat/shareDialog"),f=".swx",l="swx-share-dialog";t.getRawQueryString=function(){return i.location.search},t.conditionallyLaunchSharingExperience=function(){var e=o.resolve(s.serviceLocator.FEATURE_FLAGS),t=e.isFeatureOn(s.featureFlags.SHOW_ALTERNATE_SHARE_DIALOG_EXPERIENCE);t&&c()}}),define("utils/common/resizeHandler",["require","browser/dom"],function(e){function i(e){function o(){t.removeClass(e,r),clearTimeout(s),s=null}if(!e)throw new Error("Container must not be null");var i=this,s=null;i.resize=function(){s?clearTimeout(s):t.addClass(e,r),s=setTimeout(o,n)},i.dispose=function(){o()}}var t=e("browser/dom"),n=500,r="RESIZING";return i}),define("ui/viewModels/experience/sidebar",["require","lodash-compat","cafe/applicationInstance","vendor/knockout","browser/window","utils/common/async","constants/common","services/serviceLocator","utils/common/styleModeHelper","utils/common/resizeHandler"],function(e){function g(e){function L(e){e(v.NAVIGATE,P),e(v.OPEN_CONVERSATION,P),e(d.SHOW_SIDEBAR,g.slideIn),e(d.HIDE_SIDEBAR,g.slideOut)}function A(e){e(m.QUERY_CHANGED,D),e(m.INPUT_FOCUS,O),e(m.INPUT_BLUR,M)}function O(){x=!0,g.expand()}function M(e){x=!1,e===0&&g.collapse()}function D(e){e?T=!0:!e&&x?T=!1:P()}function P(){x=!1,T=!1,g.collapse()}function H(){!g.isExpanded()&&(T||x)&&g.expand(),k.resize()}function B(e){clearTimeout(C),e.timeout?C=i.setTimeout(g.isExpanded.bind(g,e.expanded),e.timeout):g.isExpanded(e.expanded)}function j(e){clearTimeout(N),N=i.setTimeout(g.showTooltips.bind(g,e),p)}function F(e){b.publish(d.SIDEBAR_STATE_CHANGED,e)}function I(e){L(e?b.subscribe.bind(b):b.unsubscribe.bind(b)),!e&&g.isExpanded()&&g.isExpanded(!1)}function q(e){return function(){g.isActive()&&e.apply(g,arguments)}}var g=this,y=n.get(),b=u.resolve(o.serviceLocator.PUBSUB),w,E,S,x=!1,T=!1,N=0,C=0,k;g.isActive=r.pureComputed(function(){return a.get().currentMode()===o.styleMode.NARROW}),g.isExpanded=r.observable(!1),g.showTooltips=r.observable(!1),g.showPreSlideClass=r.observable(!1),g.addSlideInClass=r.observable(!1),g.addSlideOutClass=r.observable(!1),g.init=function(){E=g.isActive.subscribe(I),S=g.isExpanded.subscribe(F),A(b.subscribe.bind(b)),w=t.debounce(H,l),i.addEventListener(o.events.browser.RESIZE,w),k=new f(e),s.execute(H),g.isActive()&&L(b.subscribe.bind(b))},g.dispose=function(){k.dispose(),E.dispose(),S.dispose(),L(b.unsubscribe.bind(b)),A(b.unsubscribe.bind(b)),i.removeEventListener(o.events.browser.RESIZE,w)},g.expand=q(function(e){g.isExpanded()||j(!0),B({expanded:!0,timeout:e&&h})}),g.collapse=q(function(e){x||(j(!1),T||B({expanded:!1,timeout:e&&c}))}),g.slideIn=q(function(){g.addSlideInClass(!0),g.addSlideOutClass(!1)}),g.slideOut=q(function(){g.addSlideInClass(!1),g.addSlideOutClass(!0)}),g.slideTransitionEnded=function(){b.publish(d.SIDEBAR_TRANSITION_ENDED)},g.handleUserAction=function(){return y.isEndpointActive&&y.isEndpointActive.set(!0),!0}}var t=e("lodash-compat"),n=e("cafe/applicationInstance"),r=e("vendor/knockout"),i=e("browser/window"),s=e("utils/common/async"),o=e("constants/common"),u=e("services/serviceLocator"),a=e("utils/common/styleModeHelper"),f=e("utils/common/resizeHandler"),l=1e3,c=500,h=1500,p=c,d=o.events.narrowMode,v=o.events.navigation,m=o.events.search;return g}),define("ui/controls/experience/sidebar",["require","exports","module","vendor/knockout","browser/dom","text!views/experience/sidebar.html","ui/controls/experience/shareDialogController","ui/viewModels/experience/sidebar","utils/common/styleModeHelper","constants/common","lodash-compat","services/serviceLocator"],function(e,t){function p(e){return e&&f.has(e,"sidebarPosition")&&f.isString(e.sidebarPosition)&&e.sidebarPosition.toLowerCase()===a.sidebar.position.LEFT}function d(e){return a.sidebar.cssClasses[p(e)?"SLIDE_LEFT_TO_RIGHT":"SLIDE_RIGHT_TO_LEFT"]}function v(e){function n(){e.parentElement.style.display="none"}var t=l.resolve(a.serviceLocator.PUBSUB);t.subscribe(a.apiUIEvents.SWX_TIMELINE_LOADED,n)}function m(e){var t;return e.setAttribute("data-bind",g()),r.addClass(e,h),t=new o(e),t.init(),t}function g(){function t(){var t=["mouseover: expand","mouseout: collapse","webkitTransitionEnd: slideTransitionEnded","otransitionend: slideTransitionEnded","oTransitionEnd: slideTransitionEnded","msTransitionEnd: slideTransitionEnded","transitionend: slideTransitionEnded"].join(e);return"event:{"+t+"}"}function n(){var t=["active: isExpanded()","inactive: !isExpanded()","showTooltips: showTooltips()","slideIn: addSlideInClass()","slideOut: addSlideOutClass()"].join(e);return"css:{"+t+"}"}var e=",";return[t(),n()].join(e)}var n=e("vendor/knockout"),r=e("browser/dom"),i=e("text!views/experience/sidebar.html"),s=e("ui/controls/experience/shareDialogController"),o=e("ui/viewModels/experience/sidebar"),u=e("utils/common/styleModeHelper"),a=e("constants/common"),f=e("lodash-compat"),l=e("services/serviceLocator"),c="side themeWhite",h="inactive";t.name="sidebar",t.render=function(e,t){var o=r.createElement("div"),f=l.resolve(a.serviceLocator.FEATURE_FLAGS);o.className=c,r.addClass(o,d(e)),o.innerHTML=i,f.isFeatureOn(a.featureFlags.HIDE_SIDEBAR_ON_START)&&v(o),n.applyBindings(m(o),o),t(o),s.conditionallyLaunchSharingExperience(),u.get().addContainer(o)}}),define("text!views/experience/content.html",[],function(){return'<swx-navigation></swx-navigation>\r\n\r\n<!-- content overlay used for masking chat area when sidebar is expanded -->\r\n<span class="swxContentOverlay" data-bind="css: { active: showOverlay }, click: hideOverlay"></span>\r\n\r\n<!-- named templates for various message types contents -->\r\n<script type="text/html" id="pictureMessageContentTemplate">\r\n    <p class="PictureSharing">\r\n        <a class="thumbnailHolder"\r\n           data-bind="click: open, attr: {href: pictureUrl}, l10n_attr: {\'aria-label\': \'media_picturesharing_label\', \'title\': \'media_picturesharing_label\'}"\r\n           target="_blank" tabindex="-1">\r\n\r\n            <span class="pictureIcon">\r\n                <span class="iconfont picture"></span>\r\n            </span>\r\n\r\n            <!-- ko if: hasFailed -->\r\n            <span class="failedIcon">\r\n                <span class="iconfont errorSad"></span>\r\n            </span>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: isPending -->\r\n            <span class="progressIndicatorContainer">\r\n                <span class="progressIndicator" data-bind="style: {backgroundImage: progressIndicatorBG}"></span>\r\n                <span class="fill"></span>\r\n            </span>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: thumbnailUrl -->\r\n            <span class="thumbnail" data-bind="style: { backgroundImage: \'url(\\\'\' + thumbnailUrl() + \'\\\')\' }"></span>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko ifnot: thumbnailUrl -->\r\n            <span class="thumbnail" style="display:none"></span>\r\n            <!-- /ko -->\r\n        </a>\r\n        <span class="offScreen" data-bind="text: content"></span>\r\n    </p>\r\n</script>\r\n\r\n<script type="text/html" id="contactInfoMessageContentTemplate">\r\n    <span class="offScreen" data-bind="text: content"></span>\r\n    <div class ="contactsList" data-bind="foreach: contacts">\r\n        <div class="contact clickable">\r\n            <!--ko ifnot: ($parent.isMePersonContactMessage(name()) || $parent.isPSTNContactMessage(name())) -->\r\n            <a class="avatarLink" data-bind="click: $parent.openConversationWithUser.bind(this, name()), attr: {title: titleKey}" role="button">\r\n                <swx-avatar-deprecated params="avatar: avatar" class="avatar"></swx-avatar-deprecated>\r\n            </a>\r\n            <!-- /ko -->\r\n            <!--ko if: ($parent.isMePersonContactMessage(name()) && !$parent.isPSTNContactMessage(name())) -->\r\n            <swx-avatar-deprecated params="avatar: avatar" class="avatar"></swx-avatar-deprecated>\r\n            <!-- /ko -->\r\n            <!--ko if: (!$parent.isMePersonContactMessage(name()) && $parent.isPSTNContactMessage(name())) -->\r\n            <span class="iconfont callStart pstn"></span>\r\n            <!-- /ko -->\r\n            <div class="info">\r\n                <!--ko if: $parent.contactHasFullName(name()) -->\r\n                <div class="fullName" data-bind="css: {pstn: $parent.isPSTNContactMessage(name())}">\r\n                    <span class="strong fontSize-p" data-bind="text: fullName"></span>\r\n                </div>\r\n                <!-- /ko -->\r\n                <!--ko ifnot: $parent.isPSTNContactMessage(name()) -->\r\n                <div class="name">\r\n                    <span class="fontSize-p" data-bind="text: name"></span>\r\n                </div>\r\n                <!--ko ifnot: $parent.isMePersonContactMessage(name()) -->\r\n                <div class="action">\r\n                    <a role="button" class="actionLink clickable" data-bind="click: $parent.openConversationWithUser.bind(this, name()), l10n: {key: actionKey}" tabindex="-2">\r\n                    </a>\r\n                </div>\r\n                <!-- /ko -->\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="fileTransferMessageContentTemplate">\r\n    <p data-bind="css:typeClasses" data-bind="css:{aborted:isAborted}" class="FileTransfer">\r\n        <span class="icon iconfont file" data-bind="css:iconClasses"></span>\r\n\r\n        <span class="filename" data-bind="text:fileName"></span>\r\n\r\n        <!-- ko if: isAborted -->\r\n        <span class="aborted iconfont cancel" data-bind="l10n_attr: {\'title\': \'file_transfer_upload_canceled\' }"></span>\r\n        <span class="errorMessage" data-bind="l10n: {\'key\': \'file_transfer_upload_canceled\' }, l10n_attr: {\'title\':\'file_transfer_upload_canceled\'}, l10n_attr:{\'aria-label\':\'file_transfer_upload_canceled\'}"></span>\r\n        <span class="filesize" data-bind="text:fileSize"></span>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko ifnot: isAborted -->\r\n        <span class="filesize" data-bind="text:fileSize"></span>\r\n        <swx-filetransfer-activity-actions params="message:$data, onabort:abortUploading"></swx-filetransfer-activity-actions>\r\n        <!-- /ko -->\r\n    </p>\r\n</script>\r\n\r\n<script type="text/html" id="videoMessageContentTemplate">\r\n    <div class="video-message">\r\n\r\n        <div class="media-holder" data-bind="css: orientationClass">\r\n            <div class="media-content">\r\n\r\n                <div class="videoIcon">\r\n                    <span class="iconfont videomail"></span>\r\n                </div>\r\n\r\n                <!-- ko if: hasFailed -->\r\n                <span class="failedIcon">\r\n                    <span class="iconfont errorSad"></span>\r\n                </span>\r\n                <!-- /ko -->\r\n\r\n                <!-- ko if: isLoaded() & !isPlaying() -->\r\n                <div class="thumbnail" data-bind="click: play, style: { backgroundImage: \'url(\\\'\' + thumbnailUrl + \'\\\')\' }"></div>\r\n                <a href="#" class="iconfont play playButton" data-bind="click: play, l10n_attr: { \'aria-label\': \'media_clicktoplay\' }" role="button" tabindex="-1"></a>\r\n                <!-- /ko -->\r\n\r\n                <!-- ko if: isPlaying -->\r\n                <swx-video-player params="media: mediaUrl, poster: thumbnailUrl, autoplay: true"></swx-video-player>\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n\r\n        <!-- ko if: hasExpired -->\r\n        <p class="errorMessage" data-bind="l10n: { key: \'media_videomessage_expired\' }"></p>\r\n        <!-- /ko -->\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="mojiMessageContentTemplate">\r\n    <p data-bind="css: typeClasses">\r\n        <span class="mojiContent">\r\n            <span class="mojiplaceholder"></span>\r\n            <img class="mojithumbnail" data-bind="attr: { src: mojiThumbnailUrl}" alt="" role="presentation"\r\n                 aria-hidden="true"/>\r\n            <video class="moji" data-bind="css: {hide: !isMojiPlaying()}, attr: { src: mojiUrl }"></video>\r\n            <span class="mojimask" data-bind="click: stopMojiPlay"></span>\r\n            <a href="#" class="actionButtons iconfont play mojiplay clickable"\r\n               data-bind="css: {hide: isMojiPlaying}, click: playMoji,\r\n                          l10n_attr: { \'aria-label\': \'pes_moji_playbutton_label\' }"\r\n               role="button" tabindex="-1"></a>\r\n        </span>\r\n        <span class="mojitext" data-bind="visible: isMojiPlayed()">\r\n            <span class="mojiTitle" data-bind="css: {hide: !mojiTitle() && mojiTitle() === \'\'}, text: mojiTitle"></span>\r\n            <span class="mojiLink">\r\n                <a data-bind="css: {hide: !mojiLinkName() && mojiLinkName() === \'\'}, text: mojiLinkName,\r\n                              attr: {href: mojiLinkUrl}"\r\n                   target="_blank" tabindex="-1"></a>\r\n            </span>\r\n            <span class="mojiCopyright"\r\n                  data-bind="css: {hide: !mojiCopyright() || mojiCopyright() === \'\'}, text: mojiCopyright"></span>\r\n        </span>\r\n    </p>\r\n</script>\r\n\r\n<script type="text/html" id="textMessageContentTemplate">\r\n    <p data-bind="html: content, css: typeClasses, visible: !translationItem.visible()"></p>\r\n    <!-- ko if: translationItem.isEnabled -->\r\n    <p data-bind="html: translationItem.translationText, visible: translationItem.visible()"></p>\r\n    <p><a href="#" role="button" data-bind="text: translationItem.toggleText, attr: {title: translationItem.toggleText, \'aria-label\': translationItem.toggleText}, click: translationItem.toggle"></a></p>\r\n    <!-- /ko -->\r\n</script>\r\n\r\n\r\n<script type="text/html" id="callingMessageContentTemplate">\r\n    <p data-bind="html: content, css: typeClasses"></p>\r\n    <p class="liveSessionDuration small" data-bind="html: liveSessionDuration"></p>\r\n</script>\r\n\r\n<script type="text/html" id="ngcUpgradeMessageContentTemplate">\r\n    <p data-bind="html: content, css: typeClasses"></p>\r\n</script>\r\n\r\n<script type="text/html" id="pluginFreeMessageContentTemplate">\r\n    <p data-bind="html: content, css: typeClasses"></p>\r\n</script>\r\n\r\n<script type="text/html" id="pstnMessageContentTemplate">\r\n    <p data-bind="css: typeClasses"><span data-bind="html: content, click: addCreditTelemetry"></span><a data-bind="click: navigateToDialPad, visible: linkVisible" class="clickable"> <span data-bind="html: linkContent"></span></a></p>\r\n</script>\r\n\r\n<script type="text/html" id="contactRequestIncomingMessageContentTemplate">\r\n    <p data-bind="css: typeClasses">\r\n        <swx-avatar-deprecated params="avatar: author.avatar, isAgent: author.isAgent"></swx-avatar-deprecated>\r\n    </p>\r\n    <div class="contactRequestMessage contactRequestIncomingMessage">\r\n        <p data-bind="l10n: { key: \'message_text_contactRequestIncomingMessage\', params: { displayName: author.displayName } }"></p>\r\n\r\n        <p data-bind="html: greeting"></p>\r\n\r\n        <p data-bind="html: setTimestamp" class="timestamp"></p>\r\n    </div>\r\n    <div class="triple buttonRow">\r\n        <div class="column">\r\n            <button type="button" class="btn primary clickable contactRequestAccept"\r\n                    data-bind="click: acceptContactRequest, disable: actionInProgress, css: { \'in-progress\': actionInProgress }" tabindex="-1"><span\r\n                data-bind="l10n: { key: \'message_text_contactRequestAcceptAction\' }"></span></button>\r\n        </div>\r\n        <div class="column">\r\n            <button type="button" class="btn secondary clickable contactRequestDecline"\r\n                    data-bind="click: declineContactRequest, disable: actionInProgress, css: { \'in-progress\': actionInProgress }" tabindex="-1"><span\r\n                data-bind="l10n: { key: \'message_text_contactRequestDeclineAction\' }"></span></button>\r\n        </div>\r\n        <div class="column">\r\n            <button type="button" class="btn secondary clickable contactRequestBlock"\r\n                    data-bind="click: blockContactRequest, disable: actionInProgress, css: { \'in-progress\': actionInProgress }" tabindex="-1"><span\r\n                data-bind="l10n: { key: \'action_button_block\' }"></span></button>\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="contactRequestIncomingInviteFreeMessageContentTemplate">\r\n    <p class="contactRequestResendMessage" data-bind="css: typeClasses"><span\r\n        data-bind="html: content"></span>\r\n        <a data-bind="l10n: { key: \'invite_free_block_person\' }, click: blockContactRequest"\r\n           class="clickable" tabindex="-1"></a></p>\r\n</script>\r\n\r\n<script type="text/html" id="contactRequestOutgoingMessageContentTemplate">\r\n    <p data-bind="css: typeClasses">\r\n        <swx-avatar-deprecated params="avatar: author.avatar, isAgent: author.isAgent"></swx-avatar-deprecated>\r\n    </p>\r\n    <div class="contactRequestMessage contactRequestOutgoingMessage">\r\n        <p data-bind="l10n: { key: \'message_text_contactRequestOutgoingMessage\', params: { displayName: author.displayName } }"></p>\r\n    </div>\r\n    <div class="buttonRow">\r\n        <button type="button" class="btn primary clickable contactRequestSend" data-swx-testId="sendContactRequest"\r\n                data-bind="click: sendContactRequest, disable: actionInProgress, css: { \'in-progress\': actionInProgress }" tabindex="-1"><span\r\n            data-bind="l10n: { key: \'message_text_contactRequestSendAction\' }"></span></button>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="contactRequestOutgoingResendMessageContentTemplate">\r\n    <p class="contactRequestResendMessage" data-bind="css: typeClasses"><span\r\n        data-bind="l10n: { key: \'message_text_contactRequestOutgoingResendMessage\' }, css: { \'in-progress\': actionInProgress }"></span> - <a\r\n        data-bind="l10n: { key: \'message_text_contactRequestOutgoingResendAction\' }, click: sendContactRequest, css: { \'in-progress\': actionInProgress }"\r\n        class="clickable"></a></p>\r\n</script>\r\n\r\n<script type="text/html" id="contactRequestOutgoingAgentMessageContentTemplate">\r\n    <p data-bind="css: typeClasses">\r\n        <swx-avatar-deprecated params="avatar: author.avatar, isAgent: author.isAgent"></swx-avatar-deprecated>\r\n    </p>\r\n    <div class="contactRequestMessage contactRequestOutgoingMessage">\r\n        <p data-bind="l10n: { key: \'message_text_contactRequestOutgoingMessage\', params: { displayName: author.displayName } }"></p>\r\n    </div>\r\n    <div class="buttonRow">\r\n        <button type="button" class="btn primary clickable contactRequestSend" data-swx-testId="sendContactRequest"\r\n                data-bind="click: sendContactRequest, disable: actionInProgress, css: { \'in-progress\': actionInProgress }" tabindex="-1"><span\r\n            data-bind="l10n: { key: \'message_text_contactRequestSendAction\' }"></span></button>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="suggestedContactMessageContentTemplate">\r\n    <p data-bind="css: typeClasses">\r\n        <swx-avatar-deprecated params="avatar: author.avatar, isAgent: author.isAgent"></swx-avatar-deprecated>\r\n    </p>\r\n    <div class="contactRequestMessage suggestedContactMessage">\r\n        <p data-bind="l10n: { key: \'message_text_suggestedContactGreeting\', params: { displayName: author.displayName } }"></p>\r\n    </div>\r\n    <div class="buttonRow">\r\n        <button type="button" class="btn primary clickable contactRequestSend" data-bind="click: sendContactRequest, disable: actionInProgress, css: { \'in-progress\': actionInProgress }" tabindex="-1"\r\n               ><span data-bind="l10n: { key: \'message_text_suggestedContactConnectAction\' }"></span>\r\n        </button>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="unblockContactMessageContentTemplate">\r\n    <div data-bind="css: typeClasses">\r\n        <div class="contactRequestMessage unblockContactMessage">\r\n            <p data-bind="l10n: { key: \'message_text_contactBlockedMessage\', params: { displayName: author.displayName } }"></p>\r\n        </div>\r\n        <div class="buttonRow">\r\n            <div class="column alignLeft">\r\n                <button type="button" class="btn primary clickable unblockContact"\r\n                        data-bind="click: unblockContact, disable: actionInProgress, css: { \'in-progress\': actionInProgress }" tabindex="-1"\r\n                       ><span data-bind="l10n: { key: \'message_text_unblockContact\' }"></span></button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="spacesWelcomeMessageContentTemplate">\r\n    <div class="welcomeMessage">\r\n        <span class="emoticon hi large animated"><span class="emoSprite">(hi)</span></span>\r\n\r\n        <div data-bind="css: {clickable: spaceLink() || showSpacesCTA()}">\r\n            <div data-bind="l10n: { key: \'spaces_welcomeTitle\' }" class="title fontSize-h2"></div>\r\n            <div data-bind="text: welcomeMessage" class="fontSize-p"></div>\r\n        </div>\r\n        <!-- ko if: isJoiningEnabled -->\r\n        <swx-invite-link class="invite-link"\r\n                         params="topic: conversation.topic, uri: conversation.uri, isMessageContent: true">\r\n        </swx-invite-link>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- ko if: showSpacesCTA -->\r\n    <div class="ctas">\r\n        <div class="cta clickable" data-bind="click: editTopicAction, enterKey: editTopicAction" tabindex="-1">\r\n            <div data-bind="l10n: { key: \'spaces_welcomeRenameBtnTitle\' }"\r\n                 class="title fontSize-h3 iconfont edit"></div>\r\n            <div data-bind="l10n: { key: \'spaces_welcomeRenameBtnMessage\' }" class="description fontSize-p"></div>\r\n        </div>\r\n        <div class="cta clickable" data-bind="click: settingsAction, enterKey: settingsAction" tabindex="-1">\r\n            <div data-bind="l10n: { key: \'spaces_welcomeSettingsBtnTitle\' }"\r\n                 class="title fontSize-h3 iconfont settings"></div>\r\n            <div data-bind="l10n: { key: \'spaces_welcomeSettingsBtnMessage\' }" class="description fontSize-p"></div>\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- ko if: othersAddedMessageContent -->\r\n    <div class="participantMessage clickable">\r\n        <p data-bind="html: othersAddedMessageContent, css: typeClasses"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n</script>\r\n\r\n<script type="text/html" id="urlMessageContentTemplate">\r\n    <!--ko if: !copyLinkEnabled() -->\r\n    <div  class="messageTextWrapper">\r\n        <p data-bind="html: content, visible: !translationItem.visible()" class="urlPreviewText"></p>\r\n        <!-- ko if: translationItem.isEnabled -->\r\n        <p data-bind="html: translationItem.translationText, visible: translationItem.visible()" class="urlPreviewText"></p>\r\n        <p><a href="#" role="button" data-bind="text: translationItem.toggleText, attr: {title: translationItem.toggleText, \'aria-label\': translationItem.toggleText}, click: translationItem.toggle"></a></p>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- ko if: copyActive -->\r\n    <input class="copyArea fontSize-p" data-bind="value: urlLinkToCopy, css: {active: copyActive}" readonly="" style="width:2px; height: 2px;">\r\n    <!-- /ko -->\r\n    <div data-bind="foreach: previews">\r\n        <!--ko if: !ytPlayer() -->\r\n        <div data-bind="css: typeClasses" class="urlPreview">\r\n            <a class="thumbnail"\r\n               data-bind="attr: { href: url, title: url, target: target}, event: {click: $parent.openUrlPreview.bind(this, url())}, css: {noScale: originalSize(), scaledByW: scaledByW(), scaledByH: scaledByH(), gif: isGif()}" tabindex="-1">\r\n                <!-- ko if: typeClasses.youtube -->\r\n                <span class="iconfont play"></span>\r\n                <!-- /ko -->\r\n\r\n                <img class="scaled" alt="" aria-hidden="true" role="presentation"\r\n                     data-bind="css: {scaledW: scaledByW(), scaledH: scaledByH(), originalSize: originalSize(), originalGif: isGif(), tall: tall, wide: wide}, attr: {src: thumbnail}"/>\r\n                <span class="mask"></span>\r\n                <div class="info" data-bind="css: {gif: isGif()}">\r\n                    <span class="title strong fontSize-p" data-bind="text: title"></span>\r\n                    <span class="description fontSize-p" data-bind="text: description"></span>\r\n                    <div class="domainName site fontSize-p">\r\n                        <img class="favicon" alt="" role="presentation" aria-hidden="true"\r\n                                                                              data-bind="attr: {src: favicon}, css: { hide: !favicon() }"/>\r\n                        <span data-bind="text: site"></span>\r\n                    </div>\r\n                </div>\r\n            </a>\r\n        </div>\r\n        <!-- /ko -->\r\n        <!--ko if: ytPlayer() -->\r\n        <div class="message-youtube-embed">\r\n            <iframe data-bind="attr: {\'id\': playerId, \'src\': youtubeUri }"\r\n                    type="text/html" allowfullscreen frameborder="0"\r\n                    class="chat-youtube-iframe" tabindex="-2"></iframe>\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n</script>\r\n\r\n\r\n<script type="text/html" id="pollMessageContentTemplate">\r\n    <div data-bind="css: { \'poll-message\': true, \'poll-message--disabled\': answerSent }">\r\n        <p class="poll-message-heading" data-bind="html: content"></p>\r\n\r\n        <fieldset class="poll-message-content" data-bind="template: { name: \'pollMessageAnswerTemplate\', foreach: pollAnswers, as: \'answer\' }"></fieldset>\r\n\r\n        <div data-bind="text: peopleVotedText" class="fontSize-p"></div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="pollMessageAnswerTemplate">\r\n    <label class="poll-message-answer">\r\n        <input type="radio" data-bind="value: $index, checked: $parent.checkedAnswer, disable: $parent.answerSent, click: $parent.onAnswerClick" tabindex="-1" />\r\n        <div class="poll-message-answer-box">\r\n            <div class="poll-message-answer-votes-bar" data-bind="style: { width: (answer.barWidth + \'%\') }"></div>\r\n            <span class="poll-message-answer-text" data-bind="html: answer.answerText"></span>\r\n            <span class="poll-message-answer-votes-count" data-bind="text: answer.users.length || \'\'"></span>\r\n        </div>\r\n    </label>\r\n    <div class="poll-message-answer-votes">\r\n        <div class="poll-message-answer-avatars" data-bind="foreach: answer.users">\r\n            <!-- ko if: ($index() < 2) -->\r\n                <!-- ko if: person -->\r\n                    <swx-avatar-deprecated params="avatar: person.avatarUrl(), isGroupAvatar: false" data-bind="attr: {title: displayName}"></swx-avatar-deprecated>\r\n                <!-- /ko -->\r\n                <!-- ko ifnot: person -->\r\n                    <swx-avatar-deprecated params="isGroupAvatar: false" data-bind="attr: {title: displayName}"></swx-avatar-deprecated>\r\n                <!-- /ko -->\r\n            <!-- /ko -->\r\n        </div>\r\n        <!-- ko if: (answer.users.length > 2) -->\r\n            <div class="poll-message-answer-ellipsis" data-bind="click: $parent.pollAvatarsVM.onEllipsisClick.bind($data, $index())"></div>\r\n            <swx-user-list-popup params="\r\n                eventContext: $parent,\r\n                isSelfPopup: $parent.pollAvatarsVM.isSelfPopup.bind(null, $index()),\r\n                title: $parent.pollAvatarsVM.votedByCount(answer.users.length),\r\n                users: $parent.pollAvatarsVM.users"></swx-user-list-popup>\r\n        <!-- /ko -->\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="outlookSwiftCardMessageContentTemplate">\r\n    <!-- ko if: swiftCard.themeColor -->\r\n    <div class="outlookSwiftCard-theme" data-bind="style: {backgroundColor: swiftCard.themeColor}"></div>\r\n    <!-- /ko -->\r\n    <div class="outlookSwiftCard-wrapper">\r\n        <!-- ko if: swiftCard.senderImage || swiftCard.sender -->\r\n        <div class="outlookSwiftCard-senderWrapper">\r\n            <!-- ko if: swiftCard.senderImage -->\r\n            <div class="outlookSwiftCard-senderImage" data-bind="style: {backgroundImage: \'url(\' + swiftCard.senderImage + \')\'}"></div>\r\n            <!-- /ko -->\r\n            <!-- ko if: swiftCard.sender -->\r\n            <h3 class="outlookSwiftCard-senderName" data-bind="html: swiftCard.sender"></h3>\r\n            <!-- /ko -->\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: swiftCard.title || swiftCard.text -->\r\n        <div class="outlookSwiftCard-titleWrapper">\r\n            <!-- ko if: swiftCard.title -->\r\n            <h3 class="outlookSwiftCard-title" data-bind="html: swiftCard.title"></h3>\r\n            <!-- /ko -->\r\n            <!-- ko if: swiftCard.text -->\r\n            <p data-bind="html: swiftCard.text"></p>\r\n            <!-- /ko -->\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko foreach: { data: swiftCard.sections, as: \'section\' } -->\r\n        <div>\r\n            <!-- ko if: section.title -->\r\n            <h4 class="outlookSwiftCard-sectionTitle" data-bind="html: section.title"></h4>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: section.activityTitle || section.activitySubtitle || section.activityText || section.activityImage -->\r\n            <div class="outlookSwiftCard-sectionWrapper">\r\n                <!-- ko if: section.activityImage -->\r\n                <div class="outlookSwiftCard-sectionImage">\r\n                    <img data-bind="attr: {src: section.activityImage}" />\r\n                </div>\r\n                <!-- /ko -->\r\n                <!-- ko if: section.activityTitle || section.activitySubtitle || section.activityText -->\r\n                <div>\r\n                    <!-- ko if: section.activityTitle -->\r\n                    <p><b data-bind="html: section.activityTitle"></b></p>\r\n                    <!-- /ko -->\r\n                    <!-- ko if: section.activitySubtitle -->\r\n                    <p data-bind="html: section.activitySubtitle"></p>\r\n                    <!-- /ko -->\r\n                    <!-- ko if: section.activityText -->\r\n                    <p class="outlookSwiftCard-secondaryText" data-bind="html: section.activityText"></p>\r\n                    <!-- /ko -->\r\n                </div>\r\n                <!-- /ko -->\r\n            </div>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: section.text -->\r\n            <p class="outlookSwiftCard-secondaryText" data-bind="html: section.text"></p>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: section.facts -->\r\n            <div class="outlookSwiftCard-factsWrapper" data-bind="foreach: { data: section.facts, as: \'fact\' }">\r\n                <div class="outlookSwiftCard-factRow">\r\n                    <span class="outlookSwiftCard-factName" data-bind="text: fact.name"></span>\r\n                    <span class="outlookSwiftCard-factValue swiftCard-secondaryText" data-bind="html: fact.value"></span>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: section.images -->\r\n            <div class="outlookSwiftCard-imagesWrapper" data-bind="foreach: { data: section.images, as: \'image\' }">\r\n                <img data-bind="attr: {src: image}"/>\r\n            </div>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: section.potentialAction -->\r\n            <div class="outlookSwiftCard-actionsWrapper" data-bind="foreach: { data: section.potentialAction, as: \'action\' }">\r\n                <a data-bind="attr: {href: action.target}, click: action.clickHandler, html: action.name"\r\n                    target="_blank" role="button" class="outlookSwiftCard-action"></a>\r\n            </div>\r\n            <!-- /ko -->\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: swiftCard.potentialAction -->\r\n        <div class="outlookSwiftCard-actionsWrapper" data-bind="foreach: { data: swiftCard.potentialAction, as: \'action\' }">\r\n            <a data-bind="attr: {href: action.target}, click: action.clickHandler, html: action.name"\r\n                target="_blank" role="button" class="outlookSwiftCard-action"></a>\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="skypeSwiftCardMessageContentTemplate">\r\n    <div class="skypeSwiftCard-wrapper">\r\n        <!-- ko if: swiftCard.title -->\r\n        <h3 data-bind="html: swiftCard.title"></h3>\r\n        <!-- /ko -->\r\n        <!-- ko if: swiftCard.text -->\r\n        <p data-bind="html: swiftCard.text"></p>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko foreach: { data: swiftCard.sections, as: \'section\' } -->\r\n        <div class="skypeSwiftCard-sectionWrapper">\r\n            <!-- ko if: section.images.length > 0 -->\r\n            <img class="skypeSwiftCard-heroImage" data-bind="attr: {src: section.images[0].image}" />\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: section.title -->\r\n            <h4 class="skypeSwiftCard-sectionTitle" data-bind="html: section.title"></h4>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: section.subtitle -->\r\n            <p><b data-bind="html: section.subtitle"></b></p>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: section.text -->\r\n            <p data-bind="html: section.text"></p>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: section.facts -->\r\n            <div class="skypeSwiftCard-factsWrapper" data-bind="foreach: { data: section.facts, as: \'fact\' }">\r\n                <div class="skypeSwiftCard-factRow">\r\n                    <span class="skypeSwiftCard-factKey" data-bind="text: fact.key"></span>\r\n                    <span class="skypeSwiftCard-factValue swiftCard-secondaryText" data-bind="html: fact.value"></span>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n\r\n        <!-- ko foreach: { data: section.buttons, as: \'buttonRows\' } -->\r\n        <div class="skypeSwiftCard-buttonsWrapper">\r\n            <!-- ko foreach: { data: buttonRows, as: \'button\' } -->\r\n            <a data-bind="attr: {href: button.isLink ? button.url : null}, click: button.clickHandler, html: button.label"\r\n                target="_blank" role="button" class="skypeSwiftCard-button"></a>\r\n            <!-- /ko -->\r\n        </div>\r\n        <!-- /ko -->\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko foreach: { data: swiftCard.buttons, as: \'buttonRows\' } -->\r\n        <div class="skypeSwiftCard-buttonsWrapper">\r\n            <!-- ko foreach: { data: buttonRows, as: \'button\' } -->\r\n            <a data-bind="attr: {href: button.isLink ? button.url : null}, click: button.clickHandler, html: button.label"\r\n                target="_blank" role="button" class="skypeSwiftCard-button"></a>\r\n            <!-- /ko -->\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n</script>\r\n'}),define("ui/telemetry/actions/actionSources",{contactRequestIncomingActivityItem:"ContactRequestIncomingActivityItem",unblockActivityItem:"UnblockActivityItem",recentItem:"recentItem",searchItem:{addressBook:"addressBookSearchItem",skypeDirectory:"skypeDirectorySearchItem"},contactsPage:{contact:"contactsPageContact"},discoverAgentsPage:{agent:"discoverAgentsPageAgent"},contextMenuItem:{block:"blockContactMenuItem",callSkype:"callSkypeMenuItem",deleteItem:"deleteContactMenuItem",removeMessage:"removeMessageMenuItem",startPSTNCall:"startPSTNCallMenuItem",unblock:"unblockContactMenuItem",videoCall:"videoCallMenuItem"},contactProfile:"contactProfile",search:{reset:{resetXButton:"resetXButton",content:"experienceContent",openConversation:"openConversation",escapeKey:"escapeKey",emptyQuery:"emptyQuery"}},conversation:{conversationItem:"conversationItem",messageItem:"messageItem",groupRoster:"groupRoster",header:{button:"conversationHeaderButton"}},invitesShareButtons:{header:"header",newConversation:"new_conversation_area",groupInformationPanel:"group_information_panel"},skypeOutPage:{skypeOutHeader:"skypeOutHeader"},me:{area:"me_area",avatar:"me_avatarFilePicker"}}),define("ui/viewModels/experience/content",["require","vendor/knockout","constants/common","services/serviceLocator","ui/telemetry/actions/actionSources","usertiming"],function(e){function a(){var e=this,a=r.resolve(n.serviceLocator.PUBSUB);e.showOverlay=t.observable(!1),e.init=function(){a.subscribe(o.narrowMode.SIDEBAR_STATE_CHANGED,e.showOverlay),s.mark(u.EXPERIENCE.CONTENT_INIT)},e.dispose=function(){a.unsubscribe(o.narrowMode.SIDEBAR_STATE_CHANGED,e.showOverlay)},e.hideOverlay=function(){var t={source:i.search.reset.content};e.showOverlay(!1),a.publish(o.search.RESET,t)}}var t=e("vendor/knockout"),n=e("constants/common"),r=e("services/serviceLocator"),i=e("ui/telemetry/actions/actionSources"),s=e("usertiming"),o=n.events,u=n.telemetry.performanceMarks;return a}),define("ui/controls/experience/content",["require","exports","module","vendor/knockout","text!views/experience/content.html","ui/viewModels/experience/content","utils/common/styleModeHelper","browser/detect"],function(e,t){var n=e("vendor/knockout"),r=e("text!views/experience/content.html"),i=e("ui/viewModels/experience/content"),s=e("utils/common/styleModeHelper"),o=e("browser/detect"),u=0;t.name="content",t.render=function(e,t){var a=document.createElement("div"),f=new i;u++,a.id="swxContent"+u,a.className="swxContent",a.innerHTML=r,s.get().isIntegratedProperty()&&o.getBrowserInfo().browserName!=="SkypeShell"&&(a.className+=" "+s.get().host()),f.init(),n.applyBindings(f,a),t(a),s.get().addContainer(a)}}),define("ui/contextMenu/menuItemGroup",[],function(){function e(e,t){this.type=e,this.items=t}return e}),define("utils/common/eventHelper",["require","exports","module","constants/keys"],function(e,t){function i(){}function s(e){e.preventDefault()}function o(e){return e.which||e.keyCode}function u(e){return l(e)?r[o(e)]:!1}function a(e){var t=o(e);return t===n.ENTER||t===n.SPACE}function f(e){var t=o(e);return t>=n.NUMBER_0&&t<=n.NUMBER_9||t>=n.A&&t<=n.Z}function l(e){var t=o(e);return t>=n.NUMPAD_0&&t<=n.NUMPAD_9}function c(e){var t=o(e);return t===n.ESCAPE}var n=e("constants/keys"),r={96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"};i.prototype.emit=function(){},i.prototype.done=function(){},t.swallow=s,t.getKeyCode=o,t.getNumpadKey=u,t.isActivation=a,t.isAlphaNumericKey=f,t.isNumPadKey=l,t.emptyEmitter=new i,t.isDeactivation=c}),define("ui/contextMenu/contextMenu",["require","exports","module","vendor/knockout","lodash-compat","constants/cssClasses","constants/common","services/serviceLocator","browser/window","browser/dom","utils/common/accessibility","utils/common/async","ui/telemetry/actions/actionNames","browser/document","ui/contextMenu/menuItemGroup","constants/keys","utils/common/eventHelper"],function(e,t){function T(e){if(e&&!N(e)){var t=o.resolve(s.serviceLocator.ACTION_TELEMETRY);t.recordAction(c.contextMenu.hidden)}}function N(e){return C(e.target)}function C(e){return!!a.getParentWithClass(e,i.contextMenu.CONTEXT_MENU)}function k(e){var t,n;for(t=0;t<e.length;t++){n=e[t];if(D(n)&&k(n.items)||!D(n)&&n.isEnabled())return!0}return!1}function L(e){b=a.createElement("ul"),b.classList.add(i.contextMenu.CONTEXT_MENU),A(),O(e),f.initFocusRing(b),b.setAttribute("data-bind",'keyboardNavigation: { itemSelector: ".'+i.LIST_SELECTABLE+'" }'),n.applyBindings(g,b),h.body.appendChild(b),b.focus()}function A(){m=a.createElement("div"),m.className="arrow",b.appendChild(m)}function O(e){var t,n;for(t=0;t<e.length;t++)n=e[t],!M(t)&&H(n)&&!P(e,t)&&F(),D(n)?B(n.items):n.isEnabled()&&j(n),H(n)&&_(e,t)&&F()}function M(e){return e===0}function _(e,t){return t<e.length-1}function D(e){return e instanceof p}function P(e,t){return!M(t)&&D(e[t-1])}function H(e){return D(e)&&k(e.items)}function B(e){e.forEach(function(e){e.isEnabled()&&j(e)})}function j(e){var n=a.createElement("li"),r=a.createElement("span");a.addClass(n,i.LIST_SELECTABLE),e.cssClass&&a.addClass(n,e.cssClass),r.textContent=e.label,n.appendChild(r),n.addEventListener(s.events.browser.CLICK,e.action,!0),g.itemActions.push(function(){e.action(),t.hide()}),n.setAttribute("data-bind","enterKey: itemActions["+(g.itemActions.length-1)+"]"),b.appendChild(n)}function F(){var e=a.createElement("hr");b.appendChild(e)}function I(e){e.clientX===undefined&&(e.clientX=0),e.clientY===undefined&&(e.clientY=0),q(e),U(e)}function q(e){var n,r,i=W(e),s=b.offsetWidth/2,o=i+s,u=window.innerWidth-o>0;u?(r=i-s>t.MENU_BORDER_WIDTH,r?n=i-s:n=t.MENU_BORDER_WIDTH):n=window.innerWidth-b.offsetWidth-t.MENU_BORDER_WIDTH,b.style.left=n+"px",R(e,n)}function R(e,n){var r=W(e),i=r-n,s=i-t.ARROW_WIDTH/2,o=t.MENU_BORDER_WIDTH,u=b.offsetWidth-t.MENU_BORDER_WIDTH-t.ARROW_WIDTH;s=Math.max(o,Math.min(s,u)),m.style.left=s+"px"}function U(e){var n,r=X(e),i=window.innerHeight-(r+b.offsetHeight)>0;i?(n=r+t.ARROW_HEIGHT,b.style.top=n+"px"):z(e)}function z(e){var n=X(e);a.addClass(b,i.contextMenu.FLIPPED),b.style.top=n-t.ARROW_HEIGHT-b.offsetHeight+"px"}function W(e){return e.customClientOffset?e.customClientOffset.offsetLeft:e.clientX}function X(e){return e.customClientOffset?e.customClientOffset.offsetTop:e.clientY}function V(e){var n=v.getKeyCode(e);n===d.ESCAPE&&t.hide(e)}function $(e){e.preventDefault(),e.stopPropagation()}function J(){var e=o.resolve(s.serviceLocator.PUBSUB);l.execute(function(){h.addEventListener(s.events.browser.CLICK,t.hide),h.addEventListener(s.events.browser.KEYDOWN,V),u.addEventListener(s.events.browser.RESIZE,t.hide),e.subscribe(s.events.interaction.SCROLL_START,t.hide),b.addEventListener(s.events.browser.CONTEXTMENU,$)})}function K(){var e=o.resolve(s.serviceLocator.PUBSUB);h.removeEventListener(s.events.browser.CLICK,t.hide),h.removeEventListener(s.events.browser.KEYDOWN,V),u.removeEventListener(s.events.browser.RESIZE,t.hide),e.unsubscribe(s.events.interaction.SCROLL_START,t.hide),b.removeEventListener(s.events.browser.CONTEXTMENU,$)}function Q(){y&&r.forEach(y,function(e){e.dispose&&e.dispose()})}var n=e("vendor/knockout"),r=e("lodash-compat"),i=e("constants/cssClasses"),s=e("constants/common"),o=e("services/serviceLocator"),u=e("browser/window"),a=e("browser/dom"),f=e("utils/common/accessibility"),l=e("utils/common/async"),c=e("ui/telemetry/actions/actionNames"),h=e("browser/document"),p=e("ui/contextMenu/menuItemGroup"),d=e("constants/keys"),v=e("utils/common/eventHelper"),m,g={itemActions:[]},y,b=null,w=null,E,S=0,x=200;t.MENU_BORDER_WIDTH=1,t.ARROW_WIDTH=40,t.ARROW_HEIGHT=11,t.show=function(e,n,r){var i=o.resolve(s.serviceLocator.ACTION_TELEMETRY);t.hide(),E=h.activeElement,y=e,r=r||{},k(e)&&(S=Date.now(),w=n.target,L(e),I(n),J(),i.recordAction(c.contextMenu.shown,r))},t.hide=function(e){function t(){var t;return b?(t=Date.now()-S,!e||e.type===s.events.browser.SCROLL&&n(w,e.target)||e.type===s.events.browser.RESIZE||t>x):!1}function n(e,t){while(e){if(e===t)return!0;e=e.parentNode}return!1}if(e&&e.which===3)return;t()&&(T(e),K(),Q(),m=null,w=null,b.parentElement.removeChild(b),b=null,S=0,g.itemActions=[],e&&v.getKeyCode(e)===d.ESCAPE&&E.focus(),E=null)},t.isShowing=function(){return b!==null}}),define("ui/viewModels/buttons/button",["require","vendor/knockout","swx-i18n","ui/contextMenu/contextMenu","browser/dom"],function(e){function s(e){function o(){var t="btn ";return s.disabled()&&(t+="disabled "),typeof e.cssClass=="function"?t+=e.cssClass():t+=e.cssClass,t}function u(){var n=t.utils.unwrapObservable(e.icon);return n?(n=n.split(" "),n.length?(n.unshift("iconfont"),n.join(" ")):{}):{}}function a(){return!s.disabled()&&s.hasMenuOptions()}function f(e){var t=s.menuOptions(),n={source:"button",isGroupConversation:!1},i=c(e);e.customClientOffset=i,r.show(t,e,n)}function l(e){r.hide(e)}function c(e){var t=e.target,n=i.getElementOffset(t),r=t.offsetWidth/2;return n.offsetLeft+=r,n.offsetTop+=t.offsetHeight,n}function h(e){return typeof e=="function"?e:e===undefined||e===null?t.observable(!1):t.observable(e)}function p(e){if(e.text)throw new Error("You have to provide i18n enabled textKey param value or set already localized value to i18nText instead of text");if(e.title)throw new Error("You have to provide i18n enabled titleKey param value or set already localized value to i18nTitle instead of using title property");if(!e.textKey&&!e.i18nText)throw new Error("You have to set either textKey or i18nText parameters");e.cssClass=e.cssClass||[]}var s=this;p(e),s.ariaLabel=e.ariaLabel?e.ariaLabel:"",s.title=e.title?e.title:"",s.disabled=h(e.disabled),s.tabindex=t.observable(e.tabindex),s.buttonCssClass=t.computed(o,s),s.spanCssClass=t.computed(u,s),s.hasMenuOptions=e.hasMenuOptions?e.hasMenuOptions:t.observable(!1),s.showMenuOptions=e.showMenuOptions?e.showMenuOptions:t.computed(a,s),s.menuOptions=e.menuOptions?e.menuOptions:t.observable([]),s.dispose=function(){s.buttonCssClass.dispose(),s.spanCssClass.dispose(),s.showMenuOptions.dispose&&s.showMenuOptions.dispose()},s.onClickHandler=function(t,n){s.hasMenuOptions()?r.isShowing()?l(n):f(n):e.action(n)},e.textKey?s.text=n.fetch({key:e.textKey}):s.text=e.i18nText,e.titleKey?s.title=n.fetch({key:e.titleKey}):e.i18nTitle&&(s.title=e.i18nTitle),e.ariaLabelKey&&(s.ariaLabel=n.fetch({key:e.ariaLabelKey}))}var t=e("vendor/knockout"),n=e("swx-i18n").localization,r=e("ui/contextMenu/contextMenu"),i=e("browser/dom");return s}),define("text!views/common/buttons/regular.html",[],function(){return'<button data-bind="click: onClickHandler, disable: disabled, attr: { class: buttonCssClass, title: title, \'aria-label\': ariaLabel }" type="button">\r\n    <span data-bind="css: spanCssClass, text: text"></span>\r\n    <!-- ko if: showMenuOptions -->\r\n    <div class="buttonMenuOptionsIcon">\r\n        <span class="iconfont chevronDown"></span>\r\n    </div>\r\n    <!-- /ko -->\r\n</button>\r\n'}),define("ui/components/experience/button",["require","exports","module","constants/components","ui/viewModels/buttons/button","text!views/common/buttons/regular.html"],function(e,t){t.name=e("constants/components").experience.BUTTON,t.viewModel=e("ui/viewModels/buttons/button"),t.template=e("text!views/common/buttons/regular.html")}),define("text!views/common/spinner.html",[],function(){return'<div class="circle one">\r\n    <div class="rotate">\r\n        <div class="position">\r\n            <div class="scale">\r\n                <div class="shape"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="circle two">\r\n    <div class="rotate">\r\n        <div class="position">\r\n            <div class="scale">\r\n                <div class="shape"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="circle three">\r\n    <div class="rotate">\r\n        <div class="position">\r\n            <div class="scale">\r\n                <div class="shape"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="circle four">\r\n    <div class="rotate">\r\n        <div class="position">\r\n            <div class="scale">\r\n                <div class="shape"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/experience/loadingAnimation",["require","exports","module","constants/components","text!views/common/spinner.html"],function(e,t){t.name=e("constants/components").experience.LOADING_ANIMATION,t.template=e("text!views/common/spinner.html")}),define("ui/viewModels/experience/radioButton",["require","vendor/knockout"],function(e){function n(e){var n=this;n.id=e.id,n.value=e.value?e.value:"",n.name=e.name?e.name:"",n.ariaLabel=e.ariaLabel?e.ariaLabel:"",n.labelKey=e.labelKey?e.labelKey:"",n.checked=e.checked,n.isInputChecked=t.pureComputed(function(){return n.checked()===n.value?"checked":""},n)}var t=e("vendor/knockout");return n}),define("text!views/common/buttons/radioButton.html",[],function(){return'<label class="RadioButton" data-bind="attr: {for: id}">\r\n    <div class="RadioButton-element">\r\n        <input class="RadioButton-input" type="radio" data-bind="checked: checked, attr: { id: id, name: name, value: value, \'aria-label\': ariaLabel}" />\r\n        <div class="RadioButton-outerCircle" data-bind="css: {RadioButton-outerCircle--checked : isInputChecked}">\r\n            <div class="RadioButton-innerCircle"></div>\r\n        </div>\r\n    </div>\r\n    <span class="text RadioButton-label" data-bind="l10n: {key: labelKey}"></span>\r\n</label>\r\n'}),define("ui/components/experience/radioButton",["require","exports","module","ui/viewModels/experience/radioButton","constants/components","text!views/common/buttons/radioButton.html"],function(e,t){function r(e){var t=new n(e);return t}var n=e("ui/viewModels/experience/radioButton");t.name=e("constants/components").experience.RADIO_BUTTON,t.template=e("text!views/common/buttons/radioButton.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/search/input",["require","vendor/knockout","utils/common/accessibility","constants/common","services/serviceLocator","constants/keys","utils/common/eventHelper","swx-i18n","utils/common/applicationFocusManager","ui/telemetry/actions/actionSources"],function(e){function d(){function E(){e.isEnabled(!0)}function S(){e.isEnabled(!1),e.resetQuery()}function x(e){return v?e+"_4b":e}function T(t){e.query()&&t&&e.showMoreResultsAvailableMessage(b&&t.moreResultsAvailable)}function N(t){t.length===0&&(e.directorySearchActive=!1)}function C(){e.searchStatus(""),g={people:null,groups:null,SkypeDirectory:null}}function k(){var t=e.query();if(t===l){var n={source:f.search.reset.emptyQuery};d.publish(c.RESET,n)}else e.showSpinner(e.directorySearchActive);C(),d.publish(c.QUERY_CHANGED,t)}function L(t){t?d.publish(c.INPUT_FOCUS):d.publish(c.INPUT_BLUR,e.query().length)}function A(t){t||e.hasFocus(!1)}function O(){var t="";e.directorySearchActive?g.people===0&&g.groups===0&&g.SkypeDirectory===0?t=u.fetch({key:"accessibility_totalSearchNoResults"}):g.SkypeDirectory!==null&&(t=u.fetch({key:"accessibility_totalSearchUpdated",params:{totalSearchResults:g.people+g.groups+g.SkypeDirectory,peopleSearchResults:g.people,groupsSearchResults:g.groups,SkypeDirectorySearchResults:g.SkypeDirectory},count:g.people+g.groups+g.SkypeDirectory})):g.people===0&&g.groups===0&&!w?t=u.fetch({key:x("accessibility_localSearchNoResults")}):g.people===0&&g.groups===0&&w?t=u.fetch({key:x("accessibility_localSearchNoResults")})+u.fetch({key:"accessibility_searchSkypeDirectory"}):g.people!==null&&g.groups!==null&&(t=u.fetch({key:x("accessibility_localSearchUpdated"),params:{totalSearchResults:g.people+g.groups,peopleSearchResults:g.people,groupsSearchResults:g.groups},count:g.people+g.groups})),t!==""&&n.updateAriaLiveHtml(e.searchStatus,t)}function M(e){g.people=e,O()}function _(e){g.groups=e,O()}function D(t){t?n.updateAriaLiveHtml(e.searchStatus,u.fetch({key:"accessibility_searching"})):e.searchStatus("")}var e=this,d=i.resolve(r.serviceLocator.PUBSUB),v,m={inputFocus:null,inputValue:null,showSpinner:null,searchResults:null},g={people:null,groups:null,SkypeDirectory:null},y=[s.UP,s.DOWN,s.PAGE_UP,s.PAGE_DOWN,s.ENTER,s.F10],b,w;e.inputAriaLabel=t.observable(""),e.hasFocus=t.observable(!1),e.isEnabled=t.observable(!1),e.showSpinner=t.observable(!1),e.directorySearchActive=!1,e.searchStatus=t.observable("").extend({rateLimit:{method:"notifyWhenChangesStop",timeout:500}}),e.query=t.observable(l).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:500}}),e.init=function(){var n=i.resolve(r.serviceLocator.FEATURE_FLAGS);b=n.isFeatureOn(r.featureFlags.SHOW_SEARCH_QUERY_MORE_RESULTS_AVAILABLE),w=n.isFeatureOn(r.featureFlags.SKYPE_DIRECTORY_SEARCH),v=n.isFeatureOn(r.featureFlags.USE_BUSINESS_WORDING),d.subscribe(c.DIRECTORY_SEARCH_ACTIVATED,e.onDirectorySearchActivated),d.subscribe(c.DIRECTORY_SEARCH_DEACTIVATED,e.onDirectorySearchDeactivated),d.subscribe(c.DIRECTORY_SEARCH_RESULTS,e.onDirectorySearchResults),d.subscribe(c.GROUPS_SEARCH_RESULTS,_),d.subscribe(c.LOCAL_SEARCH_RESULTS,M),d.subscribe(c.RESET,e.onReset),d.subscribe(p.SIDEBAR_STATE_CHANGED,A),d.subscribe(c.QUERY_EXECUTED,T),d.subscribe(h.SWX_TIMELINE_LOADED,E),d.subscribe(h.SWX_ON_SIGN_OUT,S),m.inputFocus=e.hasFocus.subscribe(L),m.inputValue=e.query.subscribe(k),m.searchResults=e.query.subscribe(N),m.showSpinner=e.showSpinner.subscribe(D),e.showMoreResultsAvailableMessage=t.observable(!1),e.inputAriaLabel(u.fetch({key:x("input_searchSkype_ariaLabel")}))},e.dispose=function(){d.unsubscribe(c.DIRECTORY_SEARCH_ACTIVATED,e.onDirectorySearchActivated),d.unsubscribe(c.DIRECTORY_SEARCH_DEACTIVATED,e.onDirectorySearchDeactivated),d.unsubscribe(c.DIRECTORY_SEARCH_RESULTS,e.onDirectorySearchResults),d.unsubscribe(c.GROUPS_SEARCH_RESULTS,_),d.unsubscribe(c.LOCAL_SEARCH_RESULTS,M),d.unsubscribe(c.RESET,e.onReset),d.unsubscribe(p.SIDEBAR_STATE_CHANGED,A),d.unsubscribe(c.QUERY_EXECUTED,T),d.unsubscribe(h.SWX_TIMELINE_LOADED,E),d.unsubscribe(h.SWX_ON_SIGN_OUT,S),m.inputFocus.dispose(),m.inputValue.dispose(),m.searchResults.dispose(),m.showSpinner.dispose()},e.onDirectorySearchActivated=function(){e.directorySearchActive=!0,D(e.directorySearchActive)},e.onDirectorySearchDeactivated=function(){e.directorySearchActive=!1,e.showSpinner(e.directorySearchActive)},e.onDirectorySearchResults=function(t){g.SkypeDirectory=t,e.hasFocus(!0),e.showSpinner(!1),O()},e.onKeyDown=function(t,n){var r=o.getKeyCode(n);if(r===s.ESCAPE){if(e.query()){var i={source:f.search.reset.escapeKey};d.publish(c.RESET,i),e.hasFocus(!0),n.stopPropagation();return}e.hasFocus(!1),n.stopPropagation(),a.removeLastFocusedElement(),a.tryRestoreFocus();return}if(y.indexOf(r)>-1){if(r===s.ENTER&&(g.people===null||g.groups===null))return!1;(r===s.UP||r===s.DOWN||r===s.ENTER)&&o.swallow(n)}return!0},e.resetQuery=function(){var t={source:f.search.reset.resetXButton};e.hasFocus(!0),d.publish(c.RESET,t)},e.onReset=function(){e.searchStatus(""),e.query(l),e.showMoreResultsAvailableMessage(!1),C()},e.setFocus=e.hasFocus.bind(null,!0)}var t=e("vendor/knockout"),n=e("utils/common/accessibility"),r=e("constants/common"),i=e("services/serviceLocator"),s=e("constants/keys"),o=e("utils/common/eventHelper"),u=e("swx-i18n").localization,a=e("utils/common/applicationFocusManager"),f=e("ui/telemetry/actions/actionSources"),l="",c=r.events.search,h=r.apiUIEvents,p=r.events.narrowMode;return d}),define("text!views/search/input.html",[],function(){return'<div class="input" data-bind="css: { active: hasFocus() }, click: setFocus">\r\n    <div class="icon" data-bind="css: { showSpinner: showSpinner }">\r\n        <div class="iconfont search"></div>\r\n        <swx-loading-animation class="spinner small blue"></swx-loading-animation>\r\n    </div>\r\n	<input role="search" type="text" data-bind="visible: isEnabled, hasFocus: hasFocus, textInput: query, event: { keydown: onKeyDown }, l10n_attr: { \'placeholder\': \'input_placeholder_searchSkype\'}, attr: { \'aria-label\': inputAriaLabel}" maxlength="250" value="" name="query" class="inputField fontSize-h4"/>\r\n	<button data-bind="visible: query().length, event: { mousedown: resetQuery }, enterKey: resetQuery, l10n_attr: { \'aria-label\': \'clear_search_input_label\'}" type="button" class="btn primary circle small transparent searchReset">\r\n        <span class="iconfont cross"></span>\r\n    </button>\r\n	<div class="offScreen" role="alert" aria-live="assertive" aria-atomic="true" data-bind="html: searchStatus"></div>\r\n</div>\r\n<!-- ko if: showMoreResultsAvailableMessage() -->\r\n<div class="moreSearchResults">\r\n    <p class="strong" data-bind="l10n: {key: \'message_more_search_results_available\'}"></p>\r\n</div>\r\n<!-- /ko-->\r\n'}),define("ui/components/experience/searchInput",["require","exports","module","ui/viewModels/search/input","constants/components","text!views/search/input.html"],function(e,t){function r(){var e=new n;return e.init(),e}var n=e("ui/viewModels/search/input");t.name=e("constants/components").experience.SEARCH_INPUT,t.template=e("text!views/search/input.html"),t.viewModel={createViewModel:r}}),define("utils/common/scroll",[],function(){function a(a){function L(e){e.preventDefault()}function A(){C?(E.style.width=g+e,E.style.left=S.scrollLeft*v+e):(E.style.height=g+e,E.style.top=S.scrollTop*v+e)}function O(){f.update()}function M(e){C?S.scrollLeft=(e.pageX-b)*m:S.scrollTop=(e.pageY-b)*m}function _(e){T||(window.addEventListener("mouseup",D),window.addEventListener("mousemove",M),a.classList.add("scrolling"),b=C?e.pageX-E.offsetLeft:e.pageY-E.offsetTop,T=!0),L(e)}function D(){a.classList.remove("scrolling"),window.removeEventListener("mouseup",D),window.removeEventListener("mousemove",M),T=!1}function P(e){C?S.scrollLeft=B(e)+S.scrollLeft:S.scrollTop=B(e)+S.scrollTop}function H(e){C?S.scrollLeft=(e.pageX-y)*m:S.scrollTop=(e.pageY-y)*m,L(e)}function B(e){if(e.deltaY)return e.deltaY>0?100:-100;if(e.originalEvent&&e.originalEvent.wheelDelta)return e.originalEvent.wheelDelta}function j(){E.addEventListener("mousedown",_),w.addEventListener("wheel",P),C&&S.addEventListener("wheel",P),w.addEventListener("mousedown",H)}function F(){E.removeEventListener("mousedown",_),w.removeEventListener("wheel",P),w.removeEventListener("mousedown",H),C&&S.removeEventListener("wheel",P)}function I(){var e="rail";w=document.createElement("div"),w.className=e+" "+(C?"railH":"railV"),w.innerHTML='<div class="slider"></div>',a.appendChild(w),a.classList.add("hyperscroll",C?"hyperscrollH":"hyperscrollV"),S=a.querySelector(".scrollViewport"),E=a.querySelector("."+e+" .slider")}function q(){w.innerHTML="",a.removeChild(w)}function R(){a.classList.add(o),window.setTimeout(function(){a.classList.remove(o)},u)}if(!a)throw new Error("Container must not be null");var f=this,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T=!1,N=!1,C=!1,k=null;f.resize=function(){h=l,p=c;if(C){l=a.offsetWidth,c=S.scrollWidth;if(p===c&&h===l)return;y=S.getBoundingClientRect().left}else{l=a.offsetHeight,c=S.scrollHeight;if(p===c&&h===l)return;y=S.getBoundingClientRect().top}v=l/c,g=l*v;if(g<t){d=l-t+g,v=d/c,m=c/d;return}m=c/l},f.update=function(){f.resize(),c>l?(f.show(),A()):f.hide()},f.startRepaintInterval=function(){var e=0;k===null&&(k=window.setInterval(function(){e+=1,R(),e>s&&f.stopRepaintInterval()},i))},f.stopRepaintInterval=function(){k&&(window.clearInterval(k),k=null)},f.connect=function(e,t){!x&&window.MutationObserver&&(x=new MutationObserver(t),x.observe(e,{childList:!0,subtree:!0}))},f.disconnect=function(){x&&(x.disconnect(),x=null)},f.show=function(){N||(a.classList.add("active"),j(),N=!0)},f.hide=function(){N&&(a.classList.remove("active"),F(),N=!1)},f.scrollToBottom=function(){C||(S.scrollTop=S.scrollHeight)},f.scrollToElement=function(e){S.scrollTop=e.offsetTop},f.adjustToRTLLayout=function(){var t=document.createElement("div");t.style.cssText="position: absolute; overflow-y: scroll; width: 30px; visibility: hidden;",t.innerHTML='<div class="probe"></div>',t.classList.add("adjustWebkitScrollBarsLegacy"),a.appendChild(t);var i=t.querySelector(".probe"),s=t.getBoundingClientRect(),o=i.getBoundingClientRect(),u=Math.abs(s.left-o.left)<1,f=Math.abs(s.right-o.right)<1,l=u&&f;a.classList.remove(r),a.classList.remove(n),l?a.classList.add(r):u&&a.classList.add(n),t.innerHTML="",a.removeChild(t)},f.init=function(e){e=e||{},e.connect&&f.connect(a,f.update),e.horizontal&&(C=!0),f.adjustToRTLLayout(),I(),f.show(),f.update(),a.addEventListener("mouseenter",f.update),S.addEventListener("scroll",O)},f.dispose=function(){D(),a.removeEventListener("mouseenter",f.update),S.removeEventListener("scroll",O),f.disconnect(),f.hide(),q()}}var e="px",t=15,n="ltroverride",r="neutraloverride",i=1e3,s=15,o="forceBrowserRepaint",u=100;return{build:function(e){return new a(e)}}}),define("ui/viewModels/search/results",["require","lodash-compat","vendor/knockout","swx-i18n","constants/common","services/serviceLocator","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","utils/common/scroll"],function(e){function v(){function y(t){g?e.showDirectoryButton(t):e.showDirectoryButton(!1)}function b(){v.publish(f.interaction.SCROLL_START)}function w(){e.showSpinner(!1)}var e=this,v=s.resolve(i.serviceLocator.PUBSUB),m=s.resolve(i.serviceLocator.FEATURE_FLAGS),g=m.isFeatureOn(i.featureFlags.SKYPE_DIRECTORY_SEARCH);e.cssClass=n.observable(c),e.showSpinner=n.observable(!1),e.showDirectoryButton=n.observable(g),e.directoryButtonText=r.fetch({key:"button_text_searchDirectory"}),e.directorySearchActive=!1,e.selectedItem=n.observable(""),e.init=function(t){v.subscribe(h.QUERY_CHANGED,e.onQueryChanged),v.subscribe(h.DIRECTORY_SEARCH_RESULTS,e.onDirectorySearchResults),v.subscribe(h.LOCAL_SEARCH_RESULTS,w),v.subscribe(h.RESET,e.hideView),v.subscribe(p.OPEN_CONVERSATION,e.onOpenConversation),d=a.build(t),d.init()},e.dispose=function(){v.unsubscribe(h.QUERY_CHANGED,e.onQueryChanged),v.unsubscribe(h.DIRECTORY_SEARCH_RESULTS,e.onDirectorySearchResults),v.unsubscribe(h.LOCAL_SEARCH_RESULTS,w),v.unsubscribe(h.RESET,e.hideView),v.unsubscribe(p.OPEN_CONVERSATION,e.onOpenConversation),d.dispose()},e.onScroll=t.debounce(b,1e3,{leading:!0,trailing:!1}),e.onQueryChanged=function(t){t!==l&&e.showView()},e.onOpenConversation=function(){if(e.cssClass()===l){var t={source:u.search.reset.openConversation};v.publish(h.RESET,t)}},e.onDirectorySearchResults=function(){e.showSpinner(!1),y(!1)},e.activateDirectorySearch=function(){if(!g)return;var t=s.resolve(i.serviceLocator.ACTION_TELEMETRY);e.showSpinner(!0),y(!1),e.directorySearchActive=!0,v.publish(h.DIRECTORY_SEARCH_ACTIVATED,e.showSpinner()),t.recordAction(o.search.directorySearchActivated)},e.deactivateDirectorySearch=function(){e.showSpinner(!1),y(!0),e.directorySearchActive=!1,v.publish(h.DIRECTORY_SEARCH_DEACTIVATED,e.showSpinner())},e.hideView=function(t){var n=s.resolve(i.serviceLocator.ACTION_TELEMETRY);e.selectedItem(""),e.cssClass(c),e.deactivateDirectorySearch(),n.recordAction(o.search.reset,t),d.stopRepaintInterval()},e.showView=function(){e.cssClass(l),e.showSpinner(!0),y(!e.directorySearchActive),d.startRepaintInterval()}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-i18n").localization,i=e("constants/common"),s=e("services/serviceLocator"),o=e("ui/telemetry/actions/actionNames"),u=e("ui/telemetry/actions/actionSources"),a=e("utils/common/scroll"),f=i.events,l="",c="hide",h=f.search,p=f.navigation,d;return v}),define("text!views/search/results.html",[],function(){return'<div class="results scrollable scrollViewport scrollViewportV fixSmall hide" data-bind="css: cssClass, event: { scroll: onScroll }" tabindex="-1">\r\n    <div class="scrollViewport-inner">\r\n        <div class="offScreen" role="tooltip" aria-live="polite" data-bind="text: selectedItem"></div>\r\n        <swx-messages-search></swx-messages-search>\r\n        <swx-people-search></swx-people-search>\r\n        <swx-group-search></swx-group-search>\r\n        <!-- ko if: showSpinner -->\r\n        <div class="grid container">\r\n            <swx-loading-animation data-bind="visible: showSpinner" class="spinner fog"></swx-loading-animation>\r\n        </div>\r\n        <!-- /ko -->\r\n        <!-- ko if: showDirectoryButton -->\r\n        <div class="grid container">\r\n            <div class="button row">\r\n                <button data-bind="click: activateDirectorySearch, l10n_attr: { \'aria-label\': \'input_searchSkypeDirectory_ariaLabel\', \'data-title\': \'input_searchSkypeDirectory_ariaLabel\' }" class="btn primary searchDirectory list-selectable" type="button">\r\n                    <span><!-- ko text: directoryButtonText -->&nbsp;<!-- /ko --></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <!-- /ko -->\r\n        <swx-directory-search></swx-directory-search>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/experience/searchResults",["require","exports","module","ui/viewModels/search/results","constants/components","text!views/search/results.html"],function(e,t){function r(e,t){var r=new n;return r.init(t.element),r}var n=e("ui/viewModels/search/results");t.name=e("constants/components").experience.SEARCH_RESULTS,t.template=e("text!views/search/results.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/experience/selectBox",["require","exports","module","lodash-compat","utils/common/async","constants/common","browser/dom","utils/common/eventHelper","utils/common/eventMixin","swx-i18n","constants/keys","vendor/knockout","utils/common/scroll","swx-utils-common"],function(e,t){function p(e){function w(e){function r(t){return(new RegExp("^"+e,"i")).test(h.normalize(t.name))}window.clearTimeout(g),e===p?m=m<u.length-1?m+1:0:(m=0,n?u=t.selectOptions().filter(r):(e=p+e,u=u.filter(r))),n=!1,p=e,g=window.setTimeout(function(){n=!0},y)}function E(){t.selectBoxOpened(!0),x()}function S(){t.selectBoxOpened(!1),T(),p="",n=!0,window.clearTimeout(g)}function x(){r.execute(function(){document.addEventListener(i.events.browser.CLICK,S),window.addEventListener(i.events.browser.RESIZE,S)})}function T(){document.removeEventListener(i.events.browser.CLICK,S),window.removeEventListener(i.events.browser.RESIZE,S)}var t=this,n=!0,u=[],p="",d,v,m,g,y=700,b=".SelectBox-scrollWrapper";t.selectOptions=e.selectOptions?e.selectOptions:[],t.selectedOption=e.selectedOption?e.selectedOption:l.observable(),t.showArrow=e.showArrow?e.showArrow:!0,t.selectBoxOpened=l.observable(!1),t.tabindex=e.tabindex?e.tabindex:null,t.disabled=e.disabled?e.disabled:l.observable(!1),e.placeholderKey?t.placeholder=a.fetch({key:e.placeholderKey}):e.placeholder?t.placeholder=e.placeholder:t.placeholder="",t.selectValue=function(e){t.selectedOption(e),S()},t.toggleSelectBox=function(){if(t.disabled())return!1;t.selectBoxOpened()?S():E()},t.dispose=function(){d.dispose(),T()},t.init=function(e){v=s.getElement(b,e),d=c.build(v),d.init(),t.registerEvent(i.events.selectBox.TOGGLE,t.toggleSelectBox)},t.listKeyDown=function(e,t){var n=o.getKeyCode(t);return o.isNumPadKey(t)&&(w(o.getNumpadKey(t)),t.stopPropagation()),o.isAlphaNumericKey(t)&&(w(String.fromCharCode(n)),t.stopPropagation()),!0},t.onKeyDown=function(e,n){var r=o.getKeyCode(n);return(r===f.ENTER||r===f.SPACE)&&t.toggleSelectBox(),!0},t.onBoxClick=function(e,t){t.stopPropagation()}}var n=e("lodash-compat"),r=e("utils/common/async"),i=e("constants/common"),s=e("browser/dom"),o=e("utils/common/eventHelper"),u=e("utils/common/eventMixin"),a=e("swx-i18n").localization,f=e("constants/keys"),l=e("vendor/knockout"),c=e("utils/common/scroll"),h=e("swx-utils-common").stringUtils;n.assign(p.prototype,u),t.build=function(e){return new p(e)}}),define("text!views/common/selectBox.html",[],function(){return'<div class="SelectBox-header" data-bind="\r\n        click: toggleSelectBox,\r\n        event: { keydown: onKeyDown },\r\n        attr: { \'aria-label\': placeholder }"\r\n        tabindex="0" role="combobox">\r\n    <span class="SelectBox-selectedName" data-bind="text: selectedOption() ? selectedOption().name : placeholder"></span>\r\n    <span class="SelectBox-selectedDescription" data-bind="text: selectedOption() ? selectedOption().description : \'\'"></span>\r\n    <span class="SelectBox-arrowIcon iconfont chevronDown" data-bind="visible: showArrow"></span>\r\n</div>\r\n<div class="SelectBox-options" data-bind="visible: selectBoxOpened, click:onBoxClick">\r\n    <div class="SelectBox-arrow"></div>\r\n    <div class="SelectBox-scrollWrapper" data-bind="keyboardNavigation: { itemSelector: \'.list-selectable\' }">\r\n        <div class="scrollViewport scrollViewportV" tabindex="-1">\r\n            <ul role="listbox" data-bind="foreach: selectOptions">\r\n                <li role="option" class="SelectBox-option list-selectable" data-option\r\n                    data-bind="click: $parent.selectValue,\r\n                        enterKey: $parent.selectValue,\r\n                        css: {selected: $parent.selectedOption() === $data },\r\n                        attr: {title: name, \'data-value\': value},\r\n                        event: {keydown: $parent.listKeyDown}">\r\n                    <span class="SelectBox-optionName" data-bind="text: name"></span>\r\n                    <span class="SelectBox-optionDescription"data-bind="text: description"></span>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n    </div>\r\n</div>\r\n<select class="SelectBox-select"\r\n        data-bind="options: selectOptions,\r\n                   value: selectedOption,\r\n                   optionsCaption: placeholder"></select>\r\n'}),define("ui/components/experience/selectBox",["require","exports","module","vendor/knockout","ui/viewModels/experience/selectBox","constants/components","text!views/common/selectBox.html"],function(e,t){function i(e,t){var i=r.build(e),s=t.element,o=n.dataFor(s);return i.setContext(o),i.init(s),i}var n=e("vendor/knockout"),r=e("ui/viewModels/experience/selectBox");t.name=e("constants/components").experience.SELECT_BOX,t.template=e("text!views/common/selectBox.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/buttons/toggle",[],function(){function e(e){this.checked=e.checked,this.ariaLabel=e.ariaLabel,this.labelledById=e.labelledById,this.onClick=e.click||function(){}}return e.build=function(t){return new e(t)},e}),define("text!views/common/buttons/toggleButton.html",[],function(){return'<a href="#" role="checkbox" data-bind="click: onClick, attr: { \'aria-label\': ariaLabel, \'aria-checked\': checked, \'aria-labelledby\': labelledById }">\r\n	<label class="ToggleButton" data-bind="css: { \'ToggleButton--checked\': checked }">\r\n	    <input type="checkbox" id="availability" class="ToggleButton-realElement" tabindex="-1" />\r\n	</label>\r\n</a>\r\n'}),define("ui/components/experience/toggleButton",["require","exports","module","constants/components","ui/viewModels/buttons/toggle","text!views/common/buttons/toggleButton.html"],function(e,t){t.name=e("constants/components").experience.TOGGLE_BUTTON,t.viewModel=e("ui/viewModels/buttons/toggle"),t.template=e("text!views/common/buttons/toggleButton.html")}),define("ui/components/experience/index",["require","ui/components/experience/button","ui/components/experience/loadingAnimation","ui/components/experience/radioButton","ui/components/experience/searchInput","ui/components/experience/searchResults","ui/components/experience/selectBox","ui/components/experience/toggleButton"],function(e){return[e("ui/components/experience/button"),e("ui/components/experience/loadingAnimation"),e("ui/components/experience/radioButton"),e("ui/components/experience/searchInput"),e("ui/components/experience/searchResults"),e("ui/components/experience/selectBox"),e("ui/components/experience/toggleButton")]}),define("ui/components/registrar",["require","exports","module","vendor/knockout"],function(e,t){var n=e("vendor/knockout");t.register=function(e){e.forEach(function(e){n.components.isRegistered(e.name)||n.components.register(e.name,e)})}}),define("experience/components/experience",["require","exports","module","constants/common","services/serviceLocator","ui/controls/experience/sidebar","ui/controls/experience/content","ui/components/experience/index","ui/components/registrar"],function(e,t){var n=e("constants/common"),r=e("services/serviceLocator"),i=e("ui/controls/experience/sidebar"),s=e("ui/controls/experience/content"),o=e("ui/components/experience/index"),u=e("ui/components/registrar");t.init=function(e){var t=r.resolve(n.serviceLocator.CONTROLS_BUILDER);t.register(s),t.register(i),u.register(o),e()}}),define("text!views/people/avatar.html",[],function(){return'<div role="button" class="Avatar" data-bind="css: containerClass, attr: {tabindex: tabindex}">\r\n    <img class="Avatar-image" data-bind="fallBackOnDefaultAvatarOnError: avatarUrl, isPstn: isPstn, isGroupAvatar: isGroupAvatar" alt="" aria-hidden="true" role="presentation">\r\n</div>\r\n'}),define("utils/common/ko",["require","exports","module","vendor/knockout","lodash-compat","utils/common/array"],function(e,t){function s(e,t){return t(e()),e.subscribe(t)}function o(e,t,n){var i=r.isFunction(t)?t:function(e){return e===t},o=!1,u={dispose:function(){o=!0}};return u=s(e,function(e){i(e)&&n.call(u,e)}),o&&u.dispose(),u}var n=e("vendor/knockout"),r=e("lodash-compat"),i=e("utils/common/array");t.disposeAndClearArray=function(e){var t=e();t.forEach(function(e){e.dispose&&e.dispose()}),t.splice(0)},t.wrapObservable=function(e){return e===null||r.isUndefined(e)?n.observable():n.isObservable(e)?e:n.observable(e)},t.changed=s,t.when=o,t.once=function(e,t,n){return o(e,t,function(e){this.dispose(),n(e)})},t.handleArrayChanges=function(e,t,n,r){function f(e){return o.filter(function(t){return t.key===e})[0]}function l(t){t.moved>=0?(a=f(t.value),i.insertAt(e,t.index,a?a.value:e[t.moved+s])):n(t.index,t.value),s++}function c(t){var n=t.index+s;t.moved>=0&&o.push({key:t.value,value:e[n]}),r(n,t.value),s--}var s=0,o=[],u,a;n=n||i.insertAt.bind(null,e),r=r||i.removeFrom.bind(null,e);for(var h=0;h<t.length;h++)u=t[h],u.status==="added"?l(u):c(u)}}),define("ui/viewModels/people/avatar",["require","vendor/knockout","utils/common/ko","lodash-compat","constants/cssClasses"],function(e){function s(e){return i.AVATAR_PRESENCE+" "+i.AVATAR+"--"+e}function o(e){var o=this,u=t.utils.unwrapObservable(e.isAgent),a=e.status||r.noop,f=e.isSelected||r.noop,l=e.size;o.isPstn=n.wrapObservable(e.isPstn),o.isGroupAvatar=n.wrapObservable(e.isGroupAvatar),o.avatarUrl=e.avatar||"",o.tabindex=e.tabindex||"",o.containerClass=t.computed(function(){return r.filter([l&&i.AVATAR_SIZE+l,o.isGroupAvatar()&&i.AVATAR_GROUP,u&&i.AVATAR_AGENT,o.isPstn()&&i.AVATAR_PSTN,a()&&s(a()),f()&&i.AVATAR_SELECTED],r.isString).join(" ")}),o.dispose=function(){o.containerClass.dispose()}}var t=e("vendor/knockout"),n=e("utils/common/ko"),r=e("lodash-compat"),i=e("constants/cssClasses").avatar;return o}),define("ui/components/people/avatar",["require","exports","module","constants/components","text!views/people/avatar.html","ui/viewModels/people/avatar"],function(e,t){t.name=e("constants/components").people.AVATAR,t.template=e("text!views/people/avatar.html"),t.viewModel=e("ui/viewModels/people/avatar")}),define("text!views/people/avatarDeprecated.html",[],function(){return'<span class="tile" data-bind="css: containerClass">\r\n    <span role=\'button\' class="tileAvatar circle" data-bind="css: presenceClass">\r\n        <span class="tileImage" data-bind="css: {agent: isAgent, pstn: isPstn}">\r\n            <img data-bind="fallBackOnDefaultAvatarOnError: avatarUrl, isPstn: isPstn, isGroupAvatar: isGroupAvatar" alt="" aria-hidden="true" role="presentation">\r\n        </span>\r\n    </span>\r\n</span>\r\n'}),define("ui/viewModels/people/avatarDeprecated",["require","vendor/knockout","utils/common/ko","lodash-compat","constants/cssClasses"],function(e){function o(e){function i(){var t=a(e.status);return r.isGroupAvatar()?s.GROUP_AVATAR:t}function o(){return!r.isGroupAvatar()&&!e.isCalling?s.SHOW_PRESENCE:""}var r=this;if(u(e.isGroupAvatar)||u(e.status))throw new Error("[AvatarDeprecated] Passing incorrect parameter, did you used property instead of ko observable ?");r.isPstn=n.wrapObservable(e.isPstn),r.isGroupAvatar=n.wrapObservable(e.isGroupAvatar),r.isAgent=e.isAgent,r.avatarUrl=e.avatar||"",r.containerClass=t.computed(i),r.presenceClass=t.computed(o),r.tabindex=e.tabindex||"",this.dispose=function(){r.containerClass.dispose(),r.presenceClass.dispose()}}function u(e){return r.isFunction(e)&&!t.isObservable(e)}function a(e){return e?t.utils.unwrapObservable(e):""}var t=e("vendor/knockout"),n=e("utils/common/ko"),r=e("lodash-compat"),i=e("constants/cssClasses"),s=i.avatarDeprecated;return o}),define("ui/components/people/avatarDeprecated",["require","exports","module","constants/components","text!views/people/avatarDeprecated.html","ui/viewModels/people/avatarDeprecated"],function(e,t){t.name=e("constants/components").people.AVATAR_DEPRECATED,t.template=e("text!views/people/avatarDeprecated.html"),t.viewModel=e("ui/viewModels/people/avatarDeprecated")}),define("text!views/people/contactListMenuItem.html",[],function(){return'<p>\r\n	<a href="#" class="strong MenuItem-link" data-bind="text: text, click: onClick, css: { \'MenuItem-link--selected\': selected }"></a>\r\n</p>'}),define("ui/components/people/contactListMenuItem",["require","exports","module","text!views/people/contactListMenuItem.html","constants/components"],function(e,t){function i(e){return e.viewModel}var n=e("text!views/people/contactListMenuItem.html"),r=e("constants/components");t.name=r.people.CONTACT_LIST_MENU_ITEM,t.viewModel={createViewModel:i},t.template=n}),define("services/telemetry/common/afterRenderHandler",[],function(){return function(t,n){var r=0;return function(){r++,r===t&&(n(),r=0)}}}),define("utils/people/organizePersons",["require","exports","module","swx-utils-common","utils/common/array","swx-i18n"],function(e,t){function s(e){var t,n=[],s=i.fetch({key:"message_bucketName_other"});return Object.keys(e).sort().forEach(function(i){var a;i===s?t={name:i,contacts:e[i]}:(a=e[i].map(o),a=r.sortByProperty(a,"sortValue"),n.push({name:i,contacts:a.map(u)}))}),t&&n.push(t),n}function o(e){return{sortValue:n.clean(n.normalize(e.displayName())),person:e}}function u(e){return e.person}var n=e("swx-utils-common").stringUtils,r=e("utils/common/array"),i=e("swx-i18n").localization;return t.getBucketName=function(e){var t,r=e.displayName()||e.id()||"",s=n.clean(n.normalize(r))[0];return n.isNotEmpty(s)?t=s.toUpperCase():t=i.fetch({key:"message_bucketName_other"}),t},t.byAlphabet=function(e){var n={};return e.forEach(function(e){var r=t.getBucketName(e);n[r]||(n[r]=[]),n[r].push(e)}),s(n)},t}),define("utils/common/statusMapper",["require","exports","module","swx-enums","swx-i18n","services/serviceLocator","constants/common"],function(e,t){function o(){return i.resolve(s.serviceLocator.FEATURE_FLAGS).isFeatureOn(s.featureFlags.ENABLE_BUSINESS_PRESENCE_MAPPING)}function u(e,t){return e.toLowerCase()===t.toLowerCase()}function a(e,t,r){return e&&t===n.endpointType.Mobile&&f(r)}function f(e){return u(e,n.onlineStatus.Online)}function l(e){return u(e,n.onlineStatus.Hidden)||u(e,n.onlineStatus.Offline)}function c(e){return u(e,n.onlineStatus.Busy)||u(e,n.onlineStatus.DoNotDisturb)||u(e,n.onlineStatus.OnThePhone)}function h(e){return u(e,n.onlineStatus.Idle)||u(e,n.onlineStatus.Away)||u(e,n.onlineStatus.BeRightBack)||u(e,n.onlineStatus.OutForLunch)}function p(e){return u(e,n.onlineStatus.Online)}var n=e("swx-enums"),r=e("swx-i18n").localization,i=e("services/serviceLocator"),s=e("constants/common");t.getStatusIconClass=function(e,t,r){var i;return e?(a(r,t,e)?i=n.endpointType.Mobile.toLowerCase():p(e)?o()?i=n.onlineStatus.Online.toLowerCase()+"withtick":i=n.onlineStatus.Online.toLowerCase():l(e)?i=n.onlineStatus.Offline.toLowerCase():h(e)?i=n.onlineStatus.Idle.toLowerCase():c(e)?o()&&u(e,n.onlineStatus.Busy)?i=n.onlineStatus.DoNotDisturb.toLowerCase():i=n.onlineStatus.Busy.toLowerCase():i=e.toLowerCase(),i):""},t.getAvailabilityText=function(e){switch(e){case n.onlineStatus.Online:return r.fetch({key:"message_text_presenceAvailable"});case n.onlineStatus.Offline:case n.onlineStatus.Hidden:return r.fetch({key:"message_text_presenceNotAvailable"});case n.onlineStatus.BeRightBack:case n.onlineStatus.OutForLunch:case n.onlineStatus.Away:case n.onlineStatus.Idle:return r.fetch({key:"message_text_presenceAway"});case n.onlineStatus.DoNotDisturb:if(o())return r.fetch({key:"message_text_presenceDoNotDisturb"});return r.fetch({key:"message_text_presenceBusy"});case n.onlineStatus.OnThePhone:case n.onlineStatus.Busy:return r.fetch({key:"message_text_presenceBusy"});case n.onlineStatus.Unknown:return r.fetch({key:"message_text_presenceUnknown"});default:return null}}}),define("ui/modelHelpers/activities",{"in-a-meeting":"inAMeeting","urgent-interruptions-only":"urgentInterruptionsOnly","on-the-phone":"onThePhone","in-a-conference":"inAConference","off-work":"offWork","out-of-office":"outOfOffice",presenting:"presenting"}),define("ui/modelHelpers/activityMapper",["require","exports","module","swx-i18n","ui/modelHelpers/activities"],function(e,t){var n=e("swx-i18n").localization,r=e("ui/modelHelpers/activities");t.map=function(e){return r[e]?n.fetch({key:"message_text_activity_"+r[e]}):e}}),define("utils/people/lastSeenConverter",["require","exports","module","swx-i18n","services/g11n/globalization","constants/common","utils/chat/dateTime"],function(e,t){function f(e){return s.getDate(parseInt(s.now()-e*6e4,10))}function l(e){return e.getFullYear()===s.getDate().getFullYear()}function c(e){return e>u.SEVEN_DAYS}function h(e){var t,n,r,i={};for(t=0;t<o.length;t++){n=o[t],i={};if(e>n.max)continue;r=n.recalculate!==undefined?Math.floor(e/n.recalculate):e,i.key=n.msg,i.params={number:r};break}return i}var n=e("swx-i18n").localization,r=e("services/g11n/globalization"),i=e("constants/common"),s=e("utils/chat/dateTime"),o=[{max:2,msg:"presence_lastseen_moments"},{max:59,msg:"presence_lastseen_minutes"},{max:1439,msg:"presence_lastseen_hours",recalculate:60},{max:10080,msg:"presence_lastseen_days",recalculate:1440}],u={SEVEN_DAYS:10080,TXT_DATE_SHORT:"presence_lastseen_date_short",TXT_DATE_FULL:"presence_lastseen_date_full"},a=i.globalizationFormatKeys;t.getMessage=function(e){var t,i,s={};return typeof e!="number"?"":(c(e)?(i=f(e),l(i)?(s.key=u.TXT_DATE_SHORT,s.params={shortdate:r.formatDate(i,a.date.DAY_MONTH)}):(s.key=u.TXT_DATE_FULL,s.params={fulldate:r.formatDate(i,a.date.DAY_MONTH_YEAR)})):s=h(e),t=n.fetch(s),t)}}),define("utils/people/progressiveTimeout",["require","exports","module","swx-utils-common","browser/window","services/serviceLocator","constants/common"],function(e,t){function a(){function t(n){var i,s=e.timeouts[n];s.timeoutId=r.setTimeout(function(){t(n)},s.timeout);for(i in s.callbacks)s.callbacks.hasOwnProperty(i)&&s.callbacks[i].call()}var e=this;e.timeouts={},e.start=function(r,i){var s,o=n.create();return e.timeouts.hasOwnProperty(r)||(e.timeouts[r]={callbacks:{},timeoutId:null,timeout:l()}),s=e.timeouts[r],s.callbacks||(s.callbacks={}),s.callbacks[o]=i,s.timeoutId===null&&t(r),o},e.stop=function(t,n){var i=e.timeouts[t];if(!i)return;i.callbacks.hasOwnProperty(n)&&delete i.callbacks[n],Object.keys(i.callbacks).length===0&&(r.clearTimeout(i.timeoutId),i.timeoutId=null)},e.reset=function(t,n){e.timeouts.hasOwnProperty(t)&&(e.timeouts[t].timeout=l(n))}}function f(e){return e*60*1e3}function l(e){var t,n;if(e===undefined)return f(u[0].timeout);for(t=0;t<u.length;t++){n=u[t];if(e>n.limit)continue;return f(n.timeout)}return f(u[u.length-1].timeout)}var n=e("swx-utils-common").guid,r=e("browser/window"),i=e("services/serviceLocator"),s=e("constants/common"),o={ONE_MINUTE:1,LIMIT_HOUR:59,ONE_HOUR:60,LIMIT_DAY:1439,ONE_DAY:1440},u=[{timeout:o.ONE_MINUTE,limit:o.LIMIT_HOUR},{timeout:o.ONE_HOUR,limit:o.LIMIT_DAY},{timeout:o.ONE_DAY}];t.classFunction=a,t.get=function(){return i.resolve(s.serviceLocator.PROGRESSIVE_TIMEOUT)}}),define("ui/viewModels/people/properties/locationText",["require","swx-utils-common","utils/common/cafeObservable"],function(e){function r(e){var t=this;return t.location={city:n.newObservableProperty(e.location.city),country:n.newObservableProperty(e.location.country)},t.compute=function(){return r.format({city:t.location.city(),country:t.location.country()})},t.dispose=function(){t.location.city.dispose(),t.location.country.dispose()},t}var t=e("swx-utils-common").stringUtils,n=e("utils/common/cafeObservable");return r.build=function(e){return new r(e)},r.format=function(e){if(e&&t.isNotEmpty(e.city)&&t.isNotEmpty(e.country))return e.city+", "+e.country},r}),define("ui/viewModels/people/properties/displayNameText",["require","swx-i18n","swx-utils-common","ui/modelHelpers/personHelper","ui/modelHelpers/conversationHelper","utils/common/cafeObservable"],function(e){function o(e){var t=this;return t.displayName=s.newObservableProperty(e.displayName),t.compute=function(){return o.format(e.id(),t.displayName())},t.dispose=function(){t.displayName.dispose()},t}var t=e("swx-i18n").localization,n=e("swx-utils-common").stringUtils,r=e("ui/modelHelpers/personHelper"),i=e("ui/modelHelpers/conversationHelper"),s=e("utils/common/cafeObservable");return o.build=function(e){return new o(e)},o.format=function(e,s){var o=s;return r.isGuestId(e)&&(o=t.fetch({key:"guest_user_displayname",params:{displayName:s}})),i.isPstnEndpoint(o)&&(o=n.forceLTREmbedding(o)),o},o}),define("ui/viewModels/people/properties/agentDetails",["require","lodash-compat","vendor/knockout","utils/common/cafeObservable"],function(e){function i(e){function o(){return s||(s={certification:r.newObservableProperty(e.agentDetails.certification),rating:r.newObservableProperty(e.agentDetails.rating),author:r.newObservableProperty(e.agentDetails.author),description:r.newObservableProperty(e.agentDetails.description),website:r.newObservableProperty(e.agentDetails.website),privacyStatement:r.newObservableProperty(e.agentDetails.privacyStatement),termsOfService:r.newObservableProperty(e.agentDetails.termsOfService),extraInfo:r.newObservableProperty(e.agentDetails.extraInfo)},s.ratingStars=n.computed(a)),s}function u(){s&&(t.invoke(s,"dispose"),s=undefined)}function a(){var e=[],t=s.rating()||0,n=(t%1).toFixed(1);for(var r=1;r<=t;r++)e.push(1);return n>=.5&&n<.75?e.push(.5):n>=.75&&e.push(1),e}var i=this,s;return t.isFunction(e.isAgent)?i.isAgent=r.newObservableProperty(e.isAgent):i.isAgent=n.observable(!1),i.compute=function(){return i.isAgent()?o():u()},i.dispose=function(){i.isAgent.dispose&&i.isAgent.dispose(),u()},i}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/cafeObservable");return i.build=function(e){return new i(e)},i}),define("ui/viewModels/people/contact",["require","lodash-compat","vendor/knockout","swx-i18n","constants/common","services/serviceLocator","swx-utils-common","swx-enums","constants/cssClasses","utils/common/statusMapper","ui/modelHelpers/activityMapper","utils/common/cafeObservable","utils/people/lastSeenConverter","utils/people/progressiveTimeout","ui/viewModels/people/properties/locationText","ui/viewModels/people/properties/displayNameText","ui/viewModels/people/properties/agentDetails","ui/modelHelpers/personHelper","utils/chat/messageSanitizer"],function(e){function b(e,b){function O(){E.phoneNumbers(e.phoneNumbers())}function M(){return E.isBlocked()?a.presence.BLOCKED:f.getStatusIconClass(E.status(),E.endpointType(),k)}function D(){var e,n,r;if(A()===undefined)return;return e=t.isString(A())?(new Date(A())).getTime():A().getTime(),n=Math.floor((Date.now()-e)/1e3),r=Math.round(n/60),p.get().reset(E.id(),r),h.getMessage(r)}function P(){return E.displayName()+", "+E.id()+", "+f.getAvailabilityText(E.status())}function H(){A.notifySubscribers()}function B(){return E.endpointType()===u.endpointType.Mobile&&L}function j(){var e,t=E.phoneNumbers();if(E.isBlocked())return r.fetch({key:"message_text_contactBlocked"});if(E.isAgent()&&E.agentDetails()){var n=E.agentDetails().description();if(n)return n}return E.isPstn()&&t.length===1?t[0].displayString()===E.displayName()?"":o.forceLTREmbedding(t[0].displayString()):(b.moodMessageFirst?e=F()||I():e=I()||F(),e||E.locationText()||f.getAvailabilityText(E.status()))}function F(){return l.map(E.activity())}function I(){var e,t=E.status()===u.onlineStatus.Online;return t?(e=E.isMobile()?"message_text_presenceActiveMobile":"message_text_presenceAvailable",r.fetch({key:e})):E.lastSeen()}var w,E=this,S=v.build(e),x=d.build(e),T=m.build(e),N=s.resolve(i.serviceLocator.FEATURE_FLAGS),C=N.isFeatureOn(i.featureFlags.LAST_SEEN),k=N.isFeatureOn(i.featureFlags.MOBILE_INDICATOR),L=N.isFeatureOn(i.featureFlags.MOBILE_ACTIVE),A=c.newObservableProperty(e.lastSeenAt,{keepAlive:b.keepLastSeenAtSubscription});E.id=c.newObservableProperty(e.id),E.avatar=c.newObservableProperty(e.avatarUrl,{keepAlive:!0}),E.status=c.newObservableProperty(e.status,{keepAlive:b.keepPresenceSubscription}),E.activity=c.newObservableProperty(e.activity,{keepAlive:b.keepActivitySubscription}),E.endpointType=c.newObservableProperty(e.endpointType,{keepAlive:b.keepEndpointTypeSubscription}),E.isAgent=T.isAgent,E.agentDetails=n.computed(T.compute),E.isEcho=n.observable(g.isEchoContact(e)),E.isBlocked=c.newObservableProperty(e.isBlocked),E.isActive=n.observable(!1),E.location=x.location,E.locationText=n.computed(x.compute),E.isPstn=n.observable(g.isPstn(e)),E.phoneNumbers=n.observable([]),E.isMobile=n.computed(B),E.displayName=n.computed(S.compute),E.lastSeen=C?n.computed(D):n.observable(null),E.statusClassName=n.computed(M),E.textDetails=n.computed(P),e.phoneNumbers.changed(O),E.displayMessage=n.computed(j),E.ariaLabel=n.computed(function(){var e=f.getAvailabilityText(E.status()),t=y.stripHTML(E.displayMessage());return e===t?E.displayName()+" "+e:E.displayName()+" "+e+" "+t}),E.getPerson=function(){return e},E.dispose=function(){p.get().stop(E.id(),w),E.id.dispose(),E.avatar.dispose(),E.status.dispose(),E.activity.dispose(),E.endpointType.dispose(),E.isBlocked.dispose(),E.locationText.dispose(),E.displayName.dispose(),E.agentDetails.dispose(),A.dispose(),S.dispose(),x.dispose(),T.dispose(),C&&E.lastSeen.dispose(),E.statusClassName.dispose(),E.displayMessage.dispose(),E.textDetails.dispose(),E.isMobile.dispose(),e.phoneNumbers.changed.off(O)},w=p.get().start(E.id(),H)}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-i18n").localization,i=e("constants/common"),s=e("services/serviceLocator"),o=e("swx-utils-common").stringUtils,u=e("swx-enums"),a=e("constants/cssClasses"),f=e("utils/common/statusMapper"),l=e("ui/modelHelpers/activityMapper"),c=e("utils/common/cafeObservable"),h=e("utils/people/lastSeenConverter"),p=e("utils/people/progressiveTimeout"),d=e("ui/viewModels/people/properties/locationText"),v=e("ui/viewModels/people/properties/displayNameText"),m=e("ui/viewModels/people/properties/agentDetails"),g=e("ui/modelHelpers/personHelper"),y=e("utils/chat/messageSanitizer");return b.build=function(e,t){return new b(e,t)},b}),define("ui/viewModels/people/contactBuilder",["require","exports","module","ui/viewModels/people/contact","vendor/knockout","constants/people","swx-enums","lodash-compat"],function(e,t){function u(e){var t=e.dispose;return e.hideStrategy=r.observable(),e.isHidden=r.computed(function(){return e.hideStrategy()===i.AVAILABLE_ONLY?!e.status()||e.status()!==s.Online:e.hideStrategy()===i.AGENTS_ONLY?!e.isAgent():!1},e),e.dispose=function(){t.call(e),e.isHidden.dispose()},e}var n=e("ui/viewModels/people/contact"),r=e("vendor/knockout"),i=e("constants/people").showStrategies,s=e("swx-enums").onlineStatus,o=e("lodash-compat");t.build=function(e,t){var r;return t=t||{},o.defaults(t,{keepPresenceSubscription:!0,keepActivitySubscription:!0,keepLastSeenAtSubscription:!0,keepEndpointTypeSubscription:!0,moodMessageFirst:!1,hideable:!1}),r=n.build(e,t),t.hideable&&(r=u(r)),r}}),define("ui/viewModels/people/contactListHelper",["require","exports","module","lodash-compat","utils/people/organizePersons","ui/viewModels/people/contactBuilder","ui/modelHelpers/personHelper"],function(e,t){function o(e){return e.isBlocked()}function u(e,t,n){var i=r.getBucketName(t);n.contactGroups().some(function(n){if(n.name===i)return n.contacts().some(function(n){if(n.id()===t.id())return n.isActive(e),!0}),!0})}var n=e("lodash-compat"),r=e("utils/people/organizePersons"),i=e("ui/viewModels/people/contactBuilder"),s=e("ui/modelHelpers/personHelper");t.deselectContactFromDefaultList=function(e,t){u(!1,e,t)},t.selectContactFromDefaultList=function(e,t){u(!0,e,t)},t.filterSearchResults=function(e,n){return e.reduce(function(e,r){var s=r.result;return t.shouldPersonBeIncluded(s,n)?e.concat([i.build(s)]):e},[])},t.organizeByAlphabet=function(e){return r.byAlphabet(e)},t.setObservablePropertyOnContacts=function(e,r,i){function s(n){t.setObservablePropertyOnContact(e,r,n)}if(!(n.isArray(i)&&i.length>0))return;n.isFunction(i[0].contacts)?i.forEach(function(e){e.contacts().forEach(s)}):i.forEach(s)},t.setObservablePropertyOnContact=function(e,t,r){if(!r.hasOwnProperty(e))return;n.isFunction(t)&&t.bind(r),r[e](t)},t.personExistsInCollection=function(e,t){function n(t){return e.id()===t.id()}return t?Boolean(t.filter(n).length):!1},t.shouldPersonBeIncluded=function(e,n){var r=t.personExistsInCollection(e,n),i=s.isEchoContact(e);return!r&&!o(e)&&!i}}),define("ui/contextMenu/menuItem",[],function(){function e(e,n,r){this.type=e,this.label=n,this.action=r||t,this.isEnabled=function(){return!0}}function t(){}return e}),define("ui/viewModels/people/blockContactModal",["require","lodash-compat","vendor/knockout","utils/common/eventMixin","ui/modalDialog/modalDialog","ui/telemetry/actions/actionNames","constants/common","ui/modelHelpers/personHelper","ui/viewModels/people/properties/displayNameText","services/serviceLocator"],function(e){function c(e,t){function c(){i.hide(l),r.actionsInProgress(!1)}function h(){r.actionsInProgress(!1)}var r=this;t=t||{},r.displayName=a.format(e.id(),e.displayName()),r.avatar=e.avatarUrl(),r.reportAbuse=!1,r.isAgent=u.isAgent(e),r.actionsInProgress=n.observable(!1),r.cancel=function(){i.hide(l)},r.blockContact=function(){function i(){var e=f.resolve(o.serviceLocator.ACTION_TELEMETRY);e.recordAction(s.contacts.contactBlocked,t)}var n;return r.actionsInProgress(!0),e.isBlocked.set.enabled()?n=e.isBlocked.set(!0,r.reportAbuse):n=Promise.resolve(!0),n.then(c,h),i(),n}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/eventMixin"),i=e("ui/modalDialog/modalDialog"),s=e("ui/telemetry/actions/actionNames"),o=e("constants/common"),u=e("ui/modelHelpers/personHelper"),a=e("ui/viewModels/people/properties/displayNameText"),f=e("services/serviceLocator"),l="swx-overlayBlockContact";return c.ELEMENT_ID=l,t.assign(c.prototype,r),c}),define("text!views/people/blockContactModal.html",[],function(){return'<div id="swx-overlayBlockContact" class="swx-overlayModal swx-hide" tabindex="-1">\r\n\r\n    <div class="overlayMain">\r\n        <div class="title">\r\n            <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'modal_blockContact_text_title\', params: { displayName: displayName } }"></h1>\r\n        </div>\r\n\r\n        <swx-avatar-deprecated params="avatar: avatar, isAgent: isAgent" class="avatar"></swx-avatar-deprecated>\r\n\r\n        <p class="subtitle" data-bind="l10n: { \'key\': \'modal_blockContact_text_message\', params: { displayName: displayName } }" data-swx-testId="modalBlockContactText"></p>\r\n\r\n        <p class="subtitle"><label><input type="checkbox" name="reportAbuse" data-bind="checked: reportAbuse"/><strong data-bind="l10n: { key: \'modal_blockContact_text_reportAbuse\' }"></strong></label></p>\r\n\r\n        <div class="dual buttonRow">\r\n            <div class="column alignRight">\r\n                <button type="button" class="btn primary" data-swx-testId="modalBlockContact" data-bind="click: blockContact, disable: actionsInProgress, css: { \'in-progress\': actionsInProgress }"><span data-bind="l10n: { key: \'action_button_block\' }"></span></button>\r\n            </div>\r\n            <div class="column alignLeft">\r\n                <button type="button" class="btn secondary cancel" data-bind="click: cancel, disable: actionsInProgress, css: { \'in-progress\': actionsInProgress }"><span data-bind="l10n: { key: \'action_button_cancel\' }" class="clickable"></span></button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n</div>\r\n'}),define("ui/contextMenu/items/blockContact",["require","swx-i18n","ui/contextMenu/menuItem","ui/modalDialog/modalDialog","ui/viewModels/people/blockContactModal","text!views/people/blockContactModal.html","ui/telemetry/actions/actionSources","constants/cssClasses"],function(e){function a(e,f){function c(){var n=new i(e.getPerson(),f),o=t.fetch({key:"modal_blockContact_text_aria_label"});r.build(i.ELEMENT_ID,n,s),r.show(i.ELEMENT_ID,o)}var l;f=f||{source:o.contextMenuItem.block};if(!e)throw new Error("Parameter missing: contactVM is required");l=t.fetch({key:"label_text_blockContact"}),n.call(this,a.TYPE,l,c),this.cssClass=u.contextMenu.items.BLOCK_CONTACT,this.isEnabled=function(){return e.getPerson().isBlocked.set.enabled()&&!e.isBlocked()&&!e.isPstn()}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("ui/modalDialog/modalDialog"),i=e("ui/viewModels/people/blockContactModal"),s=e("text!views/people/blockContactModal.html"),o=e("ui/telemetry/actions/actionSources"),u=e("constants/cssClasses");return a.prototype=Object.create(n.prototype),a.TYPE="BlockContactMenuItem",a}),define("ui/contextMenu/items/baseCallingMenuItem",["require","ui/contextMenu/menuItem","services/serviceLocator","constants/common","swx-enums","ui/viewModels/calling/helpers/callingFacade","ui/modelHelpers/personHelper","cafe/applicationInstance","ui/controls/calling/sounds","ui/modelHelpers/conversationHelper"],function(e){function l(e,o,l,h,p,d){function g(e){return!m.getCallingService(e).start.enabled()&&m.getCallingService(e).start.enabled.reason===i.callingNotSupportedReasons.PluginNotInstalled}function y(){var e=n.resolve(r.serviceLocator.MODEL_UI_OBSERVER).conversationsCallStateObserver;return e.activeCalls().length>0}function b(){function i(){return m.setCallingServiceEndpoint(t),a.playOnce(a.KEYS.CALL_DIALING),s.placeCall(t,m.isVideoCall(),p,!0)}function o(){var e=n.resolve(r.serviceLocator.ACTION_TELEMETRY);d=d||{source:m.getDefaultTelemetrySource()},m.addTelemetryContextData(d),e.recordAction(m.getTelemetryActionName(),d)}var e,t;return o(),m.sendFeatureTelemetry(),e=u.get().conversationsManager,t=e.getConversation(v),i()}var v,m=this;t.call(m,e,o,b),v=h.getPerson(),m.cssClass=l,m.featuresAreEnabled=function(){return!1},m.mePersonHasCallingCapability=function(){return!1},m.conversationHasCallingCapability=function(e){return m.getCallingService(e).start.enabled()},m.personHasSkypeCallingCapability=function(){return!1},m.getCallingService=function(){},m.isVideoCall=function(){return!1},m.getDefaultTelemetrySource=function(){},m.getTelemetryActionName=function(){},m.addTelemetryContextData=function(){},m.sendFeatureTelemetry=function(){},m.setCallingServiceEndpoint=function(e){var t=n.resolve(r.serviceLocator.FEATURE_FLAGS);if(t.isFeatureOn(r.featureFlags.PSTN_ENABLED)){var i=e.participants(0);i.audio.endpoint(i.person.id())}},m.isEnabled=function(){var e=f.getExistingConversationWithPerson(v);return!m.featuresAreEnabled()||c()||v.isBlocked()||!m.personHasSkypeCallingCapability(v)||y()?!1:!e||g(e)?!0:m.conversationHasCallingCapability(e)&&m.mePersonHasCallingCapability()}}function c(){return o.isGuest(u.get().personsAndGroupsManager.mePerson)}var t=e("ui/contextMenu/menuItem"),n=e("services/serviceLocator"),r=e("constants/common"),i=e("swx-enums"),s=e("ui/viewModels/calling/helpers/callingFacade"),o=e("ui/modelHelpers/personHelper"),u=e("cafe/applicationInstance"),a=e("ui/controls/calling/sounds"),f=e("ui/modelHelpers/conversationHelper");return l.prototype=Object.create(t.prototype),l}),define("ui/contextMenu/items/callSkype",["require","ui/contextMenu/items/baseCallingMenuItem","swx-i18n","services/serviceLocator","constants/common","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","constants/cssClasses","ui/modelHelpers/personHelper","cafe/applicationInstance"],function(e){function l(e,c,h){var p,d,v=this;p=n.fetch({key:"label_text_call_skype_audio"}),d=u.contextMenu.items.CALL_SKYPE,t.call(v,l.TYPE,p,d,e,c,h),v.featuresAreEnabled=function(){var e=r.resolve(i.serviceLocator.FEATURE_FLAGS);return e.isFeatureOn(i.featureFlags.CALLING)},v.mePersonHasCallingCapability=function(){return f.get().personsAndGroupsManager.mePerson.capabilities.audio()},v.personHasSkypeCallingCapability=function(e){return!a.isPstn(e)&&e.capabilities.audio()},v.getCallingService=function(e){return e.audioService},v.getDefaultTelemetrySource=function(){return o.contextMenuItem.callSkype},v.getTelemetryActionName=function(){return s.audioVideo.audioCall}}var t=e("ui/contextMenu/items/baseCallingMenuItem"),n=e("swx-i18n").localization,r=e("services/serviceLocator"),i=e("constants/common"),s=e("ui/telemetry/actions/actionNames"),o=e("ui/telemetry/actions/actionSources"),u=e("constants/cssClasses"),a=e("ui/modelHelpers/personHelper"),f=e("cafe/applicationInstance");return l.prototype=Object.create(t.prototype),l.TYPE="CallSkypeMenuItem",l}),define("ui/viewModels/people/deleteContactModal",["require","lodash-compat","cafe/applicationInstance","services/serviceLocator","utils/common/eventMixin","ui/modalDialog/modalDialog","constants/common","ui/telemetry/actions/actionNames","vendor/knockout"],function(e){function l(e,t,i){function p(){var e=r.resolve(o.serviceLocator.ACTION_TELEMETRY);e.recordAction(u.contacts.contactDeleted,i)}function d(){v(),s.hide(f)}function v(){l.actionsInProgress(!1)}var l=this,c=e.getPerson(),h=r.resolve(o.serviceLocator.FEATURE_FLAGS);i=i||{},l.displayName=e.displayName,l.avatar=e.avatar,l.isAgent=e.isAgent,l.actionsInProgress=a.observable(!1),l.cancel=function(){s.hide(f)},l.deleteContact=function(){var e,t=n.get().personsAndGroupsManager.all;return l.actionsInProgress(!0),h.isFeatureOn(o.featureFlags.ENABLE_BUSINESS_CONTACT_MANAGEMENT)?e=t.persons.remove(t.persons().filter(function(e){return e.id()===c.id()})[0]):e=t.persons.remove(c.id()),e.then(d,v),p(),e}}var t=e("lodash-compat"),n=e("cafe/applicationInstance"),r=e("services/serviceLocator"),i=e("utils/common/eventMixin"),s=e("ui/modalDialog/modalDialog"),o=e("constants/common"),u=e("ui/telemetry/actions/actionNames"),a=e("vendor/knockout"),f="swx-overlayDeleteContact";return l.ELEMENT_ID=f,t.assign(l.prototype,i),l}),define("text!views/people/deleteContactModal.html",[],function(){return'<div id="swx-overlayDeleteContact" class="swx-overlayModal swx-hide" tabindex="-1">\r\n\r\n    <div class="overlayMain">\r\n        <div class="title">\r\n            <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'modal_deleteContact_text_title\', params: { displayName: displayName } }"></h1>\r\n        </div>\r\n\r\n        <swx-avatar-deprecated params="avatar: avatar, isAgent: isAgent" class="avatar"></swx-avatar-deprecated>\r\n\r\n        <p data-bind="l10n: { \'key\': \'modal_deleteContact_text_message\', params: { displayName: displayName } }" data-swx-testId="modalDeleteContactText"></p>\r\n\r\n        <div class="dual buttonRow">\r\n            <div class="column alignRight">\r\n                <button type="button" class="btn primary" data-swx-testId="modalDeleteContact" data-bind="click: deleteContact, disable: actionsInProgress, css: { \'in-progress\': actionsInProgress }"><span data-bind="l10n: { key: \'action_button_delete\' }"></span></button>\r\n            </div>\r\n            <div class="column alignLeft">\r\n                <button type="button" class="btn secondary cancel" data-bind="click: cancel, disable: actionsInProgress, css: { \'in-progress\': actionsInProgress }"><span data-bind="l10n: { key: \'action_button_cancel\' }" class="clickable"></span></button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n</div>\r\n'}),define("ui/contextMenu/items/deleteContact",["require","swx-i18n","ui/contextMenu/menuItem","ui/modalDialog/modalDialog","ui/viewModels/people/deleteContactModal","text!views/people/deleteContactModal.html","ui/telemetry/actions/actionSources","constants/cssClasses","ui/modelHelpers/personHelper"],function(e){function f(e,l,c){function p(){var n=new i(e,l,c),o=t.fetch({key:"modal_deleteContact_text_aria_label"});r.build(i.ELEMENT_ID,n,s),r.show(i.ELEMENT_ID,o)}var h;if(!e)throw new Error("Parameter missing: contactVM is required");if(!l)throw new Error("Parameter missing: origin is required");c=c||{source:o.contextMenuItem.deleteItem},h=t.fetch({key:"label_text_deleteContact"}),n.call(this,f.TYPE,h,p),this.cssClass=u.contextMenu.items.DELETE_CONTACT,this.isEnabled=function(){return a.isKnownPerson(e.getPerson())}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("ui/modalDialog/modalDialog"),i=e("ui/viewModels/people/deleteContactModal"),s=e("text!views/people/deleteContactModal.html"),o=e("ui/telemetry/actions/actionSources"),u=e("constants/cssClasses"),a=e("ui/modelHelpers/personHelper");return f.prototype=Object.create(n.prototype),f.TYPE="DeleteContactMenuItem",f}),define("ui/contextMenu/items/editMessage",["require","swx-i18n","ui/contextMenu/menuItem","swx-enums","constants/common"],function(e){function s(e,o){function a(){e.dispatchEvent(i.message.EDIT,o,e.DIRECTION.PARENT)}if(!e||!o)throw new Error("Parameter missing: context and message are required");var u=t.fetch({key:"chatLogmenuItem_text_edit"});n.call(this,s.TYPE,u,a),this.isEnabled=function(){var e=o.status()===r.activityStatus.Succeeded,t=o.html&&o.html.set.enabled()&&o.text&&o.type()!==r.activityType.SystemMessage;return!!e&&!!t}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("swx-enums"),i=e("constants/common").events;return s.prototype=Object.create(n.prototype),s.TYPE="EditMessageMenuItem",s}),define("text!views/ui/modalDialog/confirmationDialog.html",[],function(){return'<div id="swx-overlayConfirmationDialog" class="swx-overlayModal swx-hide" tabindex="-1">\r\n     <div class="overlayMain">\r\n        <div class="title">\r\n            <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="text:title"></h1>\r\n        </div>\r\n\r\n        <div id="swx-overlayConfirmationDialog-content" class="content"></div>\r\n\r\n        <div class="dual buttonRow">\r\n            <div class="column alignRight">\r\n                <button type="button" class="btn primary" data-bind="click: _confirm"><span data-bind="text:confirmButtonTitle"></span></button>\r\n            </div>\r\n            <div class="column alignLeft">\r\n                <button type="button" class="btn secondary cancel" data-bind="click: _cancel"><span data-bind="text:cancelButtonTitle" class="clickable"></span></button>\r\n            </div>\r\n        </div>\r\n     </div>\r\n</div>\r\n'}),define("ui/modalDialog/confirmationDialog",["require","lodash-compat","utils/common/eventMixin","ui/modalDialog/modalDialog","swx-i18n","utils/chat/messageSanitizer","vendor/knockout","text!views/ui/modalDialog/confirmationDialog.html","browser/dom"],function(e){function l(e){var t=this,n=e.onConfirm,l=e.onCancel;t.title=s.unboxHrefContent(e.title),t.text=e.text,t.content=e.content,t.contentViewModel=e.contentViewModel,t.avatar=e.avatar,t.confirmButtonTitle=e.confirmButtonTitle||i.fetch({key:"action_button_confirm"}),t.cancelButtonTitle=e.cancelButtonTitle||i.fetch({key:"action_button_cancel"}),t.isGroupConversation=o.observable(e.isGroupConversation||!1),t._cancel=function(){r.hide(f),l&&l()},t._confirm=function(){r.hide(f),n&&n()},t.show=function(){r.build(f,t,u),r.show(f,t.title);var e=a.getElementById("swx-overlayConfirmationDialog-content");e.innerHTML=t.content,t.contentViewModel&&(o.cleanNode(e),o.applyBindings(t.contentViewModel,e))}}var t=e("lodash-compat"),n=e("utils/common/eventMixin"),r=e("ui/modalDialog/modalDialog"),i=e("swx-i18n").localization,s=e("utils/chat/messageSanitizer"),o=e("vendor/knockout"),u=e("text!views/ui/modalDialog/confirmationDialog.html"),a=e("browser/dom"),f="swx-overlayConfirmationDialog";return l.ELEMENT_ID=f,l.build=function(e){return new l(e)},t.assign(l.prototype,n),l}),define("telemetry/chat/leaveConversationTelemetry",["require","exports","module","constants/common","services/telemetry/skypeData","services/telemetry/common/telemetryContext"],function(e,t){function o(e,t){function h(){o.data={cta:e||l,action:l,participantsCount:t.participantsCount()||l,statusCode:l,tim:l,ttd:l,lmg:l}}function p(){var e={type:r.TYPE,data:o.data};i.push(e),h()}function d(e,t){return t-e}function v(){return(new Date).getTime()}var o=this,u=v(),a,f,l=n.telemetry.NOT_AVAILABLE,c=s.get();t.historyService._lastMessageFromServer&&(a=t.historyService._lastMessageFromServer.timestamp()),o.started=function(){f=v()},o.canceled=function(){var e=v();o.data.action=r.action.CANCELED,o.data.tim=d(u,v()),a&&(o.data.lmg=d(a,e)),p()},o.completed=function(){o.data.action=r.action.CONFIRMED;var e=v();o.data.statusCode=c.statusCode,o.data.tim=d(u,e),a&&(o.data.lmg=d(a,e)),f&&(o.data.ttd=d(f,e)),p()},h()}var n=e("constants/common"),r=n.telemetry.leaveConversation,i=e("services/telemetry/skypeData"),s=e("services/telemetry/common/telemetryContext");t.build=function(e,t){return new o(e,t)}}),define("text!views/chat/leaveConversationDialogContent.html",[],function(){return'<swx-avatar-deprecated params="avatar: avatar, isAgent:true, isGroupAvatar: isGroupConversation" class="avatar"></swx-avatar-deprecated>\r\n<p data-bind="text:text"></p>\r\n'}),define("ui/modalDialog/leaveConversationDialog",["require","exports","module","swx-i18n","ui/modalDialog/confirmationDialog","constants/common","services/serviceLocator","telemetry/chat/leaveConversationTelemetry","utils/chat/messageSanitizer","text!views/chat/leaveConversationDialogContent.html"],function(e,t){function f(e){function t(){var e="leave_conversation_confirmation_text";return h()?n.fetch({key:p(e)}):n.fetch({key:e})}this.text=t(),this.avatar=e.avatarUrl(),this.isGroupConversation=e.isGroupConversation()}function l(e){return e||i.telemetry.NOT_AVAILABLE}function c(e){var t="leave_conversation_confirmation_title",r=n.fetch({key:"conversation_header_topic_untitled_conversation"}),i=e.topic()?u.getSanitizedTopic(e.topic()):r;return h()?n.fetch({key:p(t)}):n.fetch({key:t,params:{topic:i}})}function h(){return s.resolve(i.serviceLocator.FEATURE_FLAGS).isFeatureOn(i.featureFlags.USE_BUSINESS_WORDING)}function p(e){return e+"_4b"}var n=e("swx-i18n").localization,r=e("ui/modalDialog/confirmationDialog"),i=e("constants/common"),s=e("services/serviceLocator"),o=e("telemetry/chat/leaveConversationTelemetry"),u=e("utils/chat/messageSanitizer"),a=e("text!views/chat/leaveConversationDialogContent.html");t.start=function(e,t){var i,s;i=o.build(l(t),e),s={title:c(e),content:a,contentViewModel:new f(e),confirmButtonTitle:n.fetch({key:"action_button_leave"}),onConfirm:function(){e.leave.enabled()&&(i.started(),e.leave().finally(function(){i.completed()}))},onCancel:function(){i.canceled()}},r.build(s).show()},t.canLeaveConversation=function(e){var t=s.resolve(i.serviceLocator.FEATURE_FLAGS),n=!t.isFeatureOn(i.featureFlags.DISABLE_LEAVE_CONVERSATION);return n&&e.leave.enabled()}}),define("ui/contextMenu/items/leaveConversation",["require","swx-i18n","ui/contextMenu/menuItem","ui/modalDialog/leaveConversationDialog","constants/common"],function(e){function s(e){function u(){r.start(e,i.TIMELINE_MENU)}if(!e)throw new Error("Parameter missing: conversation is required");var o=t.fetch({key:"recentItemMenuItem_text_leave"});n.call(this,s.TYPE,o,u),this.isEnabled=function(){return r.canLeaveConversation(e)}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("ui/modalDialog/leaveConversationDialog"),i=e("constants/common").telemetry.removeConversationHistory.cta;return s.prototype=Object.create(n.prototype),s.TYPE="LeaveConversationMenuItem",s}),define("ui/contextMenu/items/openConversation",["require","swx-i18n","ui/contextMenu/menuItem","services/pubSub/pubSub","constants/common"],function(e){function o(e){function a(){r.publish(s.OPEN_CONVERSATION,{model:e,origin:i.telemetry.historyLoadOrigin.ROSTER})}var u=t.fetch({key:"label_text_headerMenuInstantMessage"});n.call(this,o.TYPE,u,a)}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("services/pubSub/pubSub"),i=e("constants/common"),s=i.events.navigation;return o.prototype=Object.create(n.prototype),o.TYPE="OpenConversationMenuItem",o}),define("ui/contextMenu/items/openConversationWithPerson",["require","swx-i18n","ui/contextMenu/menuItem","services/serviceLocator","constants/common","cafe/applicationInstance"],function(e){function o(e,u){function l(){var t=r.resolve(i.serviceLocator.PUBSUB),n=s.get().conversationsManager.getConversation(e),o={model:n,origin:u||i.telemetry.historyLoadOrigin.ROSTER};t.publish(i.events.navigation.OPEN_CONVERSATION,o),s.get().conversationsManager.conversations.add(n)}var a=this,f=t.fetch({key:"label_text_headerMenuInstantMessage"});n.call(a,o.TYPE,f,l)}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("services/serviceLocator"),i=e("constants/common"),s=e("cafe/applicationInstance");return o.prototype=Object.create(n.prototype),o.TYPE="OpenConversationWithPersonMenuItem",o}),define("ui/contextMenu/items/viewPersonProfile",["require","swx-i18n","ui/contextMenu/menuItem","services/serviceLocator","constants/common","cafe/applicationInstance"],function(e){function o(e,u,a){function h(){var t=r.resolve(i.serviceLocator.PUBSUB),n=s.get().conversationsManager.getConversation(e),o={model:n,origin:u,target:{expandProfile:!0},telemetryContext:a};t.publish(i.events.navigation.OPEN_CONVERSATION,o),s.get().conversationsManager.conversations.add(n)}var f=this,l=t.fetch({key:"label_text_view_profile_menu_item"}),c=r.resolve(i.serviceLocator.FEATURE_FLAGS);n.call(f,o.TYPE,l,h),f.isEnabled=function(){return c.isFeatureOn(i.featureFlags.CONTACT_PROFILE)}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("services/serviceLocator"),i=e("constants/common"),s=e("cafe/applicationInstance");return o.prototype=Object.create(n.prototype),o.TYPE="ViewPersonProfileMenuItem",o}),define("ui/contextMenu/items/quoteMessage",["require","swx-i18n","ui/contextMenu/menuItem","services/serviceLocator","constants/common","swx-enums"],function(e){function o(e,u){function l(){e.dispatchEvent(i.events.message.QUOTE,u,e.DIRECTION.PARENT)}if(!e||!u)throw new Error("Parameter missing: context and message are required");var a=t.fetch({key:"chatLogmenuItem_text_quote"}),f=r.resolve(i.serviceLocator.FEATURE_FLAGS);n.call(this,o.TYPE,a,l),this.isEnabled=function(){var e=f.isFeatureOn(i.featureFlags.CONTEXT_MENU_QUOTE_MESSAGES_ENABLED);return e&&!!u.text&&!u.isDeleted()&&u.type()!==s.activityType.SystemMessage}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("services/serviceLocator"),i=e("constants/common"),s=e("swx-enums");return o.prototype=Object.create(n.prototype),o.TYPE="QuoteMessageMenuItem",o}),define("telemetry/chat/removeConversationHistoryTelemetry",["require","exports","module","constants/common","services/telemetry/skypeData","services/telemetry/common/telemetryContext"],function(e,t){function o(e,t){function h(){o.data={cta:e||l,action:l,participantsCount:t.participantsCount()||l,statusCode:l,tim:l,ttd:l,lmg:l}}function p(){var e={type:r.TYPE,data:o.data};i.push(e),h()}function d(e,t){return t-e}function v(){return(new Date).getTime()}var o=this,u=v(),a,f,l=n.telemetry.NOT_AVAILABLE,c=s.get();t.historyService._lastMessageFromServer&&(a=t.historyService._lastMessageFromServer.timestamp()),o.started=function(){f=v()},o.canceled=function(){var e=v();o.data.action=r.action.CANCELED,o.data.tim=d(u,e),a&&(o.data.lmg=d(a,e)),p()},o.completed=function(){o.data.action=r.action.CONFIRMED;var e=v();o.data.statusCode=c.statusCode,o.data.tim=d(u,e),a&&(o.data.lmg=d(a,e)),f&&(o.data.ttd=d(f,e)),p()},h()}var n=e("constants/common"),r=n.telemetry.removeConversationHistory,i=e("services/telemetry/skypeData"),s=e("services/telemetry/common/telemetryContext");t.build=function(e,t){return new o(e,t)}}),define("text!views/chat/removeConversationHistoryDialogContent.html",[],function(){return'<div id="removeConversationHistoryDialogContent">\r\n    <swx-avatar-deprecated params="avatar: avatar, isAgent:true, isGroupAvatar: isGroupConversation" class="avatar"></swx-avatar-deprecated>\r\n    <p data-bind="text:text"></p>\r\n</div>\r\n'}),define("ui/modalDialog/removeConversationHistoryDialog",["require","exports","module","cafe/applicationInstance","swx-i18n","ui/modalDialog/confirmationDialog","services/serviceLocator","constants/common","telemetry/chat/removeConversationHistoryTelemetry","text!views/chat/removeConversationHistoryDialogContent.html"],function(e,t){function f(e){this.text=h(),this.avatar=e.avatarUrl(),this.isGroupConversation=e.isGroupConversation()}function l(){return s.resolve(o.serviceLocator.FEATURE_FLAGS).isFeatureOn(o.featureFlags.USE_BUSINESS_WORDING)}function c(e){return e+"_4b"}function h(){var e="remove_conversation_confirmation_text";return l()?r.fetch({key:c(e)}):r.fetch({key:e})}function p(){var e="remove_conversation_confirmation_title";return l()?r.fetch({key:c(e)}):r.fetch({key:e})}function d(){var e="action_button_delete";return l()?r.fetch({key:c(e)}):r.fetch({key:e})}var n=e("cafe/applicationInstance"),r=e("swx-i18n").localization,i=e("ui/modalDialog/confirmationDialog"),s=e("services/serviceLocator"),o=e("constants/common"),u=e("telemetry/chat/removeConversationHistoryTelemetry"),a=e("text!views/chat/removeConversationHistoryDialogContent.html");t.start=function(e,t){function v(){e.historyService.removeAll.enabled()&&(c.started(),e.historyService.removeAll().then(function(){l.conversations.remove(e).finally(function(){c.completed();var t={model:e,page:"swx-conversation"};h.publish(o.events.navigation.FRAGMENT_REMOVE,t)})}))}function m(){c.canceled()}var r,l=n.get().conversationsManager,c,h;h=s.resolve(o.serviceLocator.PUBSUB),c=u.build(t,e),r=i.build({title:p(),content:a,contentViewModel:new f(e),avatar:e.avatarUrl(),onConfirm:v,onCancel:m,confirmButtonTitle:d()}),r.show()},t.canDeleteConversation=function(e){var t=s.resolve(o.serviceLocator.FEATURE_FLAGS),n=t.isFeatureOn(o.featureFlags.REMOVE_CONVERSATION_HISTORY);return n&&e.historyService.removeAll.enabled()}}),define("ui/contextMenu/items/removeConversationHistory",["require","swx-i18n","ui/contextMenu/menuItem","ui/modalDialog/removeConversationHistoryDialog","services/serviceLocator","constants/common"],function(e){function o(){return i.resolve(s.serviceLocator.FEATURE_FLAGS).isFeatureOn(s.featureFlags.USE_BUSINESS_WORDING)}function u(e){return e+"_4b"}function a(){var e="recentItemMenuItem_text_remove";return o()?t.fetch({key:u(e)}):t.fetch({key:e})}function f(e){function t(){r.start(e,s.telemetry.leaveConversation.cta.TIMELINE_MENU)}if(!e)throw new Error("Parameter missing: conversation is required");n.call(this,f.TYPE,a(),t),this.isEnabled=function(){return r.canDeleteConversation(e)}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("ui/modalDialog/removeConversationHistoryDialog"),i=e("services/serviceLocator"),s=e("constants/common");return f.prototype=Object.create(n.prototype),f.TYPE="RemoveConversationHistoryMenuItem",f}),define("ui/contextMenu/items/addToFavorites",["require","experience/settings","swx-i18n","ui/contextMenu/menuItem","services/serviceLocator","constants/common","telemetry/chat/telemetryEnumerator","ui/telemetry/telemetryClient"],function(e){function a(){return n.fetch({key:"favorites_add_to_favorite"})}function f(e,n){function l(){e._isFavorited&&(e._isFavorited(!0),c())}function c(){var r="favorite_added",i=e.participantsCount(),a={origin:n||s.telemetry.NOT_AVAILABLE,isGroup:e.isGroupConversation(),participantCount:i,participantCountGroup:o.getParticipantCountGroup(i)};u.get().sendEvent(t.telemetry.uiTenantToken,r,a)}if(!e)throw new Error("Parameter missing: conversation is required");r.call(this,f.TYPE,a(),l),this.isEnabled=function(){var t=i.resolve(s.serviceLocator.FEATURE_FLAGS).isFeatureOn(s.featureFlags.FAVORITES_CONVERSATION_ENABLED);return t&&!!e._isFavorited&&!e._isFavorited()&&e.leave.enabled()}}var t=e("experience/settings"),n=e("swx-i18n").localization,r=e("ui/contextMenu/menuItem"),i=e("services/serviceLocator"),s=e("constants/common"),o=e("telemetry/chat/telemetryEnumerator"),u=e("ui/telemetry/telemetryClient");return f.prototype=Object.create(r.prototype),f.TYPE="AddToFavoritesMenuItem",f}),define("ui/contextMenu/items/removeFromFavorites",["require","experience/settings","swx-i18n","ui/contextMenu/menuItem","services/serviceLocator","constants/common","telemetry/chat/telemetryEnumerator","ui/telemetry/telemetryClient"],function(e){function a(){return n.fetch({key:"favorites_remove_from_favorite"})}function f(e,n){function l(){e._isFavorited&&(e._isFavorited(!1),c())}function c(){var r="favorite_removed",i=e.participantsCount(),a={origin:n||s.telemetry.NOT_AVAILABLE,isGroup:e.isGroupConversation(),participantCount:i,participantCountGroup:o.getParticipantCountGroup(i)};u.get().sendEvent(t.telemetry.uiTenantToken,r,a)}if(!e)throw new Error("Parameter missing: conversation is required");r.call(this,f.TYPE,a(),l),this.isEnabled=function(){var t=i.resolve(s.serviceLocator.FEATURE_FLAGS).isFeatureOn(s.featureFlags.FAVORITES_CONVERSATION_ENABLED);return t&&!!e._isFavorited&&e._isFavorited()}}var t=e("experience/settings"),n=e("swx-i18n").localization,r=e("ui/contextMenu/menuItem"),i=e("services/serviceLocator"),s=e("constants/common"),o=e("telemetry/chat/telemetryEnumerator"),u=e("ui/telemetry/telemetryClient");return f.prototype=Object.create(r.prototype),f.TYPE="RemoveFromFavoritesMenuItem",f}),define("ui/contextMenu/items/removeMessage",["require","swx-i18n","ui/contextMenu/menuItem","swx-enums","services/serviceLocator","constants/common","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","telemetry/chat/telemetryEnumerator"],function(e){function f(e,l){function h(){e.html(""),d()}function p(){return new Date-e.timestamp()}function d(){l.lifetime=p(),l.timedelta=a.getMessageLifeDurationGroup(new Date-e.timestamp()),l.type=e.type();var t=i.resolve(s.serviceLocator.ACTION_TELEMETRY);t.recordAction(o.chat.removeMessage,l)}if(!e)throw new Error("Parameter missing: message is required");var c=t.fetch({key:"chatLogmenuItem_text_remove"});l=l||{source:u.contextMenuItem.removeMessage},n.call(this,f.TYPE,c,h),this.isEnabled=function(){var t=e.status()===r.activityStatus.Succeeded,n=e.html&&e.html.set.enabled(),i=n&&!e.isDeleted()&&e.type()!==r.activityType.SystemMessage;return!!t&&!!i}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("swx-enums"),i=e("services/serviceLocator"),s=e("constants/common"),o=e("ui/telemetry/actions/actionNames"),u=e("ui/telemetry/actions/actionSources"),a=e("telemetry/chat/telemetryEnumerator");return f.prototype=Object.create(n.prototype),f.TYPE="RemoveMessageMenuItem",f}),define("ui/contextMenu/items/copyLink",["require","experience/settings","swx-i18n","ui/contextMenu/menuItem","telemetry/chat/telemetryEnumerator","ui/telemetry/telemetryClient","browser/window"],function(e){function u(e,a){function l(){a.copyUrlPreviewText(),c()}function c(){var n="message_urlpreview_copy_link",r=e.conversation.participantsCount(),u=(new o.Date).getTime()-a.timestamp.getTime(),f={tis:u,ttcGroup:i.getMessageLifeDurationGroup(u),participantCount:r,participantCountGroup:i.getParticipantCountGroup(r),contentType:a.previews()[0].type()};s.get().sendEvent(t.telemetry.uiTenantToken,n,f)}if(!e||!a)throw new Error("Parameter missing: context and message are required");var f=n.fetch({key:"chatLogmenuItem_copy_link"});r.call(this,u.TYPE,f,l),this.isEnabled=function(){return a.copyLinkEnabled()}}var t=e("experience/settings"),n=e("swx-i18n").localization,r=e("ui/contextMenu/menuItem"),i=e("telemetry/chat/telemetryEnumerator"),s=e("ui/telemetry/telemetryClient"),o=e("browser/window");return u.prototype=Object.create(r.prototype),u.TYPE="CopyLinkMenuItem",u}),define("ui/contextMenu/items/openLink",["require","experience/settings","swx-i18n","ui/contextMenu/menuItem","telemetry/chat/telemetryEnumerator","ui/telemetry/telemetryClient","browser/window"],function(e){function u(e,a){function l(){var e=a.previews()[0].originalRequest,t=o.open(e,"_blank");t.focus(),c()}function c(){var n="message_urlpreview_open_link",r=e.conversation.participantsCount(),u=(new o.Date).getTime()-a.timestamp.getTime(),f={tis:u,ttcGroup:i.getMessageLifeDurationGroup(u),participantCount:r,participantCountGroup:i.getParticipantCountGroup(r),contentType:a.previews()[0].type()};s.get().sendEvent(t.telemetry.uiTenantToken,n,f)}if(!e||!a)throw new Error("Parameter missing: context and message are required");var f=n.fetch({key:"chatLogmenuItem_open_link"});r.call(this,u.TYPE,f,l),this.isEnabled=function(){return a.copyLinkEnabled()}}var t=e("experience/settings"),n=e("swx-i18n").localization,r=e("ui/contextMenu/menuItem"),i=e("telemetry/chat/telemetryEnumerator"),s=e("ui/telemetry/telemetryClient"),o=e("browser/window");return u.prototype=Object.create(r.prototype),u.TYPE="OpenLinkMenuItem",u}),define("ui/contextMenu/items/removeParticipant",["require","swx-i18n","ui/contextMenu/menuItem"],function(e){function r(e,i){function o(){e.participants.remove(i)}if(!e||!i)throw new Error("Parameter missing: conversation and participant are required");var s=t.fetch({key:"label_text_headerMenuRemoveGroup"});n.call(this,r.TYPE,s,o),this.isEnabled=function(){return e.participants.remove.enabled()}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem");return r.prototype=Object.create(n.prototype),r.TYPE="RemoveParticipantMenuItem",r}),define("ui/contextMenu/items/saveVideoMessage",["require","swx-i18n","browser/dom","ui/contextMenu/menuItem","services/serviceLocator","constants/common","swx-enums","ui/telemetry/actions/actionNames"],function(e){function a(e){function c(){var t=n.createElement("a");t.href=e.mediaUrl(),t.click()}function h(){var e=i.resolve(s.serviceLocator.ACTION_TELEMETRY);e.recordAction(u.chat.saveVideoMessage)}function p(){c(),h()}if(!e)throw new Error("Parameter missing: message is required");var f=t.fetch({key:"chatLogmenuItem_text_save"}),l=i.resolve(s.serviceLocator.FEATURE_FLAGS);r.call(this,a.TYPE,f,p),this.isEnabled=function(){var t=l.isFeatureOn(s.featureFlags.CONTEXT_MENU_SAVE_VIDEO_MESSAGES_ENABLED),n=e.type()===o.activityType.VideoMessage;return t&&n&&!e.isDeleted()}}var t=e("swx-i18n").localization,n=e("browser/dom"),r=e("ui/contextMenu/menuItem"),i=e("services/serviceLocator"),s=e("constants/common"),o=e("swx-enums"),u=e("ui/telemetry/actions/actionNames");return a.prototype=Object.create(r.prototype),a.TYPE="SaveVideoMessageMenuItem",a}),define("telemetry/calling/pstn/pstn",["require","experience/settings","ui/telemetry/telemetryClient","constants/common"],function(e){function i(){function e(e,r){var i={Entry_Point:r};n.get().sendEvent(t.telemetry.uiTenantToken,e,i)}function i(e,r){var i={Credit_Update_Duration_Seconds:r};n.get().sendEvent(t.telemetry.uiTenantToken,e,i)}this.initiatingPSTNCall=function(t){e(r.eventName.PSTN_CALL_INITIATED,t)},this.addingSubscription=function(t){e(r.eventName.ADD_SUBSCRIPTION,t)},this.addingCredit=function(t){e(r.eventName.ADD_CREDIT,t)},this.updatingCreditBalance=function(e){i(r.eventName.CREDIT_BALANCE_UPDATE_CALL_END,e)}}var t=e("experience/settings"),n=e("ui/telemetry/telemetryClient"),r=e("constants/common").telemetry.pstn;return new i}),define("ui/contextMenu/items/startPSTNCall",["require","ui/contextMenu/items/baseCallingMenuItem","swx-i18n","services/serviceLocator","constants/common","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","constants/cssClasses","swx-enums","cafe/applicationInstance","telemetry/calling/pstn/pstn","constants/common","swx-utils-common","lodash-compat"],function(e){function d(e,n,h,p){var m,g,y=this;m=v(n),g=u.contextMenu.items.START_PSTN_CALL,t.call(y,d.TYPE,m,g,e,h,p),y.featuresAreEnabled=function(){var e=r.resolve(i.serviceLocator.FEATURE_FLAGS);return e.isFeatureOn(i.featureFlags.PSTN_ENABLED)},y.mePersonHasCallingCapability=function(){return f.get().personsAndGroupsManager.mePerson.capabilities.audio()},y.personHasSkypeCallingCapability=function(){return!0},y.getCallingService=function(e){return e.audioService},y.getDefaultTelemetrySource=function(){return o.contextMenuItem.startPSTNCall},y.getTelemetryActionName=function(){return s.audioVideo.pstnCall},y.addTelemetryContextData=function(e){if(!e.phoneNumberType){var t=n.type()||a.phoneType.Other;e.phoneNumberType=t}},y.setCallingServiceEndpoint=function(e){var t=e.participants(0);t.audio.endpoint(n.telUri())},y.sendFeatureTelemetry=function(){var e;p.parent===o.conversation.header.button?e=c.entryPoint.CONVERSATION:p.parent===o.contactsPage.contact?e=c.entryPoint.CONTACT_LIST:p.parent===o.recentItem?e=c.entryPoint.RECENTS:p.parent===o.searchItem.addressBook&&(e=c.entryPoint.SEARCH),l.initiatingPSTNCall(e)}}function v(e){var t=e.type(),r=h.forceLTREmbedding(e.displayString());return t&&m(t)&&t!==a.phoneType.Other?n.fetch({key:"label_text_call_phone_number_"+t.toLowerCase(),params:{phoneNumber:r}}):n.fetch({key:"label_text_call_phone_number",params:{phoneNumber:r}})}function m(e){var t=!1;return p.forOwn(a.phoneType,function(n){n===e&&(t=!0)}),t}var t=e("ui/contextMenu/items/baseCallingMenuItem"),n=e("swx-i18n").localization,r=e("services/serviceLocator"),i=e("constants/common"),s=e("ui/telemetry/actions/actionNames"),o=e("ui/telemetry/actions/actionSources"),u=e("constants/cssClasses"),a=e("swx-enums"),f=e("cafe/applicationInstance"),l=e("telemetry/calling/pstn/pstn"),c=e("constants/common").telemetry.pstn,h=e("swx-utils-common").stringUtils,p=e("lodash-compat");return d.prototype=Object.create(t.prototype),d.TYPE="StartPSTNCallMenuItem",d}),define("ui/contextMenu/items/unblockContact",["require","swx-i18n","ui/contextMenu/menuItem","cafe/applicationInstance","services/serviceLocator","constants/common","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","constants/cssClasses"],function(e){function f(e,l){function d(){function t(){var e=i.resolve(s.serviceLocator.ACTION_TELEMETRY);e.recordAction(o.contacts.contactUnblocked,l)}var e;return h.isBlocked.set.enabled()?e=h.isBlocked.set(!1):e=Promise.resolve(!1),e.then(function(){p.publish(s.events.navigation.OPEN_CONVERSATION,{model:r.get().conversationsManager.getConversation(h),origin:s.telemetry.historyLoadOrigin.CONTACT_SEARCH})}),t(),e}var c,h,p=i.resolve(s.serviceLocator.PUBSUB);if(!e)throw new Error("Parameter missing: contactVM is required");h=e.getPerson(),l=l||{source:u.contextMenuItem.unblock},c=t.fetch({key:"label_text_unblockContact"}),n.call(this,f.TYPE,c,d),this.cssClass=a.contextMenu.items.UNBLOCK_CONTACT,this.isEnabled=function(){return h.isBlocked.set.enabled()&&e.isBlocked()&&!e.isPstn()}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("cafe/applicationInstance"),i=e("services/serviceLocator"),s=e("constants/common"),o=e("ui/telemetry/actions/actionNames"),u=e("ui/telemetry/actions/actionSources"),a=e("constants/cssClasses");return f.prototype=Object.create(n.prototype),f.TYPE="UnblockContactMenuItem",f}),define("ui/contextMenu/items/videoCall",["require","ui/contextMenu/items/baseCallingMenuItem","swx-i18n","services/serviceLocator","constants/common","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","constants/cssClasses","cafe/applicationInstance"],function(e){function f(e,l,c){var h,p,d=this;h=n.fetch({key:"label_text_call_skype_video"}),p=u.contextMenu.items.VIDEO_CALL,t.call(d,f.TYPE,h,p,e,l,c),d.featuresAreEnabled=function(){var e=r.resolve(i.serviceLocator.FEATURE_FLAGS);return e.isFeatureOn(i.featureFlags.CALLING)},d.mePersonHasCallingCapability=function(){return a.get().personsAndGroupsManager.mePerson.capabilities.video()},d.personHasSkypeCallingCapability=function(e){return e.capabilities.video()},d.getCallingService=function(e){return e.videoService},d.isVideoCall=function(){return!0},d.getDefaultTelemetrySource=function(){return o.contextMenuItem.videoCall},d.getTelemetryActionName=function(){return s.audioVideo.videoCall}}var t=e("ui/contextMenu/items/baseCallingMenuItem"),n=e("swx-i18n").localization,r=e("services/serviceLocator"),i=e("constants/common"),s=e("ui/telemetry/actions/actionNames"),o=e("ui/telemetry/actions/actionSources"),u=e("constants/cssClasses"),a=e("cafe/applicationInstance");return f.prototype=Object.create(t.prototype),f.TYPE="VideoCallMenuItem",f}),define("ui/contextMenu/items/addParticipants",["require","exports","module","swx-i18n","ui/contextMenu/menuItem"],function(e,t){function i(e,i){var s=n.fetch({key:"actionsMenuItem_text_addParticipants"});r.call(this,t.TYPE,s,i),this.isEnabled=function(){return!e()}}var n=e("swx-i18n").localization,r=e("ui/contextMenu/menuItem");i.prototype=Object.create(r.prototype),t.TYPE="AddParticipantsMenuItem",t.build=function(e,t){return new i(e,t)}}),define("ui/viewModels/chat/conversationTopic",["require","exports","module","vendor/knockout","swx-i18n","utils/common/async","constants/common","utils/common/cafeObservable","ui/modelHelpers/conversationHelper","swx-utils-common","utils/chat/messageSanitizer"],function(e,t){var n=e("vendor/knockout"),r=e("swx-i18n").localization,i=e("utils/common/async"),s=e("constants/common"),o=e("utils/common/cafeObservable"),u=e("ui/modelHelpers/conversationHelper"),a=e("swx-utils-common").stringUtils,f=e("utils/chat/messageSanitizer"),l=function(e){function m(){d||(d=!0,i.execute(function(){if(!d)return;t.topic(y()),d=!1}))}function g(){w();if(!l.participants().length){t.topic(v);return}l.participants().slice(0,s.conversation.NUMBER_OF_PARTICIPANT_NAMES_IN_TOPIC).forEach(function(e){p.push({displayName:e.person.displayName,subscription:e.person.displayName.changed(m)})})}function y(){var e=p.map(function(e){return u.isPstnEndpoint(e.displayName())?a.forceLTREmbedding(e.displayName()):e.displayName()});return e.length<1?v:e.join(s.conversation.TOPIC_DELIMITER)}function b(){l.participants.changed(g)}function w(){p.forEach(function(e){e.subscription.dispose()}),p=[]}function E(){w(),l.participants.changed.off(g)}function S(e){var n=e?f.getSanitizedTopic(e):v;u.isPstnEndpoint(n)&&(n=a.forceLTREmbedding(n)),t.topic(n),d=!1}function x(e){S(e),E()}var t=this,l=e,c=o.newObservableProperty(l.topic),h=c.subscribe(x),p=[],d,v=r.fetch({key:"conversation_header_topic_untitled_conversation"});t.topic=n.observable(v),c()?S(c()):b(),t.dispose=function(){h.dispose(),E()}};t.build=function(e){return new l(e)}}),define("ui/modelHelpers/meetingScheduler",["require","exports","module","ui/modelHelpers/conversationHelper","ui/viewModels/chat/conversationTopic","swx-i18n","constants/common","experience/settings","services/serviceLocator"],function(e,t){function a(e){return e?e.isGroupConversation()?e.isJoiningEnabled()?e:l(e):f(e):l()}function f(e){var t=c(e);return h(t,e)}function l(e){return h([],e)}function c(e){var t,n=[];if(e)for(t=0;t<e.participants.size();++t)n.push(e.participants(t).person);return n}function h(e,t){var r=n.createConversation(e,!0),i=p(t);return r.topic.set.enabled.once(!0,function(){r.topic.set(i)}),r}function p(e){var t,n;return!e||e.participants.size()===0?i.fetch({key:"schedule_call_new_conversation_topic"}):(t=r.build(e),n=t.topic(),t.dispose(),i.fetch({key:"schedule_call_subject_text",params:{topic:n}}))}function d(e){var t=u.resolve(s.serviceLocator.PUBSUB);t.publish(s.events.navigation.OPEN_CONVERSATION,{model:e,origin:s.telemetry.historyLoadOrigin.CREATE_CONVERSATION_FOR_SCHEDULED_CALL})}function v(e){return new Promise(function(t){e.isJoiningEnabled.set.enabled.once(!0,function(){e.isJoiningEnabled.set(!0).then(function(){e.uri.get().then(t)})})})}function m(e,t,n){var r,i,s;return n?(s=o.legacyCalendarUrl,r=g(e,t)):(s=o.calendarUrl,r=y(e,t)),i=Object.keys(r).map(function(e){return e+"="+encodeURIComponent(r[e])}),s+i.join("&")}function g(e,t){var n=p(t);return{summary:n,description:b(e,n),location:n,dtstart:x(w()),dtend:x(E())}}function y(e,t){var n=p(t);return{subject:n,location:n,body:b(e,n),startdt:S(w()),enddt:S(E())}}function b(e,t){return t+"\n"+e.uri()}function w(){var e=new Date;return e.setUTCDate(e.getUTCDate()+7),e}function E(){var e=w();return e.setUTCHours(e.getUTCHours()+1),e}function S(e){var t=e.getUTCFullYear(),n=T(e.getUTCMonth()+1),r=T(e.getUTCDate()),i=T(e.getUTCHours()),s=T(e.getUTCMinutes()),o=T(e.getUTCSeconds()),u=i+":"+s+":"+o;return t+"-"+n+"-"+r+"T"+u}function x(e){var t=e.getUTCFullYear(),n=T(e.getUTCMonth()+1),r=T(e.getUTCDate()),i=T(e.getUTCHours()),s=T(e.getUTCMinutes()),o=T(e.getUTCSeconds()),u=i.toString()+s.toString()+o.toString();return t.toString()+n.toString()+r.toString()+"T"+u}function T(e){return("0"+e).slice(-2)}var n=e("ui/modelHelpers/conversationHelper"),r=e("ui/viewModels/chat/conversationTopic"),i=e("swx-i18n").localization,s=e("constants/common"),o=e("experience/settings"),u=e("services/serviceLocator");t.generateMeetingUri=function(t,n){var r=a(t);return d(r),v(r).then(function(){return m(r,t,n)})}}),define("ui/viewModels/chat/scheduleCallModal",["require","exports","module","lodash-compat","vendor/knockout","browser/window","services/serviceLocator","utils/common/eventMixin","ui/modalDialog/modalDialog","constants/common","ui/telemetry/actions/actionNames","ui/modelHelpers/meetingScheduler"],function(e,t){function h(e){function o(){var t=s.resolve(a.serviceLocator.FEATURE_FLAGS),r=t.isFeatureOn(a.featureFlags.USE_LEGACY_SCHEDULER_URI_FORMAT);l.generateMeetingUri(e,r).then(n)}function h(){i.open(n(),a.window.BLANK_NAME)}function p(){var e=s.resolve(a.serviceLocator.ACTION_TELEMETRY);e.recordAction(f.scheduleCall.scheduleCallConfirmButton)}var t=this,n=r.observable();o(),t.isGeneratingJoinUrl=r.computed(function(){return!n()}),t.goToCalendar=function(){h(),p(),t.close()},t.close=function(){u.hide(c)}}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("browser/window"),s=e("services/serviceLocator"),o=e("utils/common/eventMixin"),u=e("ui/modalDialog/modalDialog"),a=e("constants/common"),f=e("ui/telemetry/actions/actionNames"),l=e("ui/modelHelpers/meetingScheduler"),c="swx-overlayScheduleCall";n.assign(h.prototype,o),t.ELEMENT_ID=c,t.build=function(e){return new h(e)}}),define("text!views/chat/scheduleCallModal.html",[],function(){return'<div id="swx-overlayScheduleCall" class="overlayScheduleCall" tabindex="-1">\r\n    <div class="overlayControls">\r\n        <div class="right">\r\n            <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n                <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'modal_scheduleCall_close_button\' }"></span>\r\n            </button>\r\n        </div>\r\n    </div>\r\n    <div class="overlayScheduleCallMain">\r\n        <span class="iconfont subscription"></span>\r\n\r\n        <!-- ko if: isGeneratingJoinUrl() -->\r\n        <p class="label" data-bind="l10n: { \'key\': \'modal_scheduleCall_getting_ready_label\' }"></p>\r\n        <!-- /ko -->\r\n        <!-- ko if: !isGeneratingJoinUrl() -->\r\n        <p class="label" data-bind="l10n: { \'key\': \'modal_scheduleCall_ready_label\' }"></p>\r\n        <!-- /ko -->\r\n\r\n        <div class="row">\r\n            <!-- ko if: isGeneratingJoinUrl() -->\r\n            <div class="swx-spinner blue">\r\n                <div class="circle one">\r\n                    <div class="rotate">\r\n                        <div class="position">\r\n                            <div class="scale">\r\n                                <div class="shape"></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="circle two">\r\n                    <div class="rotate">\r\n                        <div class="position">\r\n                            <div class="scale">\r\n                                <div class="shape"></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="circle three">\r\n                    <div class="rotate">\r\n                        <div class="position">\r\n                            <div class="scale">\r\n                                <div class="shape"></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="circle four">\r\n                    <div class="rotate">\r\n                        <div class="position">\r\n                            <div class="scale">\r\n                                <div class="shape"></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: !isGeneratingJoinUrl() -->\r\n            <button type="button" class="btn primary" data-bind="click: goToCalendar">\r\n                <span data-bind="l10n: { key: \'modal_scheduleCall_create_event_button\' }"></span>\r\n            </button>\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("services/flagsApi/flagsApiService",["require","exports","module","cafe/applicationInstance","reqwest","experience/settings","browser/window"],function(e,t){function o(){this.getAll=function(){function e(e){var t=a(e,"GET");return r.compat(t)}function t(){return Promise.reject()}return u().then(e,t)},this.set=function(e){function t(t){var i=a(t,"PUT",e);return r.compat(i).then(function(e){return e.status===201?Promise.resolve():n()})}function n(){return Promise.reject()}return u().then(t).catch(n)}}function u(){return n.get().signInManager._skypeToken()}function a(e,t,n){var r={url:i.flagsApiUrl,dataType:"json",crossOrigin:!0,headers:{"X-Skypetoken":e}};return t&&(r.method=t),n&&(r.url+="/"+s.encodeURIComponent(n)),r}var n=e("cafe/applicationInstance"),r=e("reqwest"),i=e("experience/settings"),s=e("browser/window");t.build=function(){return new o}}),define("services/flagsApi/flagsApiServiceBusiness",["require","exports","module","constants/common","services/pubSub/pubSub","experience/settings"],function(e,t){function s(){this.getAll=function(){var e=[],t=[];if(i.initParams&&i.initParams.flags==null)e=[-1];else if(i.initParams&&i.initParams.flags)try{t=JSON.parse(i.initParams.flags),t.forEach(function(t){e.push(parseInt(t.split("-")[1]))})}catch(n){}return Promise.resolve(e)},this.set=function(e){parseInt(e)&&r.publish(n.events.flags.SET_FLAG,"EducationBubble-"+e)}}var n=e("constants/common"),r=e("services/pubSub/pubSub"),i=e("experience/settings");t.build=function(){return new s}}),define("services/flagsApi/flagsProvider",["require","exports","module","services/flagsApi/flagsApiService","services/flagsApi/flagsApiServiceBusiness"],function(e,t){function s(e){function o(t){return e?i.indexOf(t)>-1||i[0]===-1:i.indexOf(t)>-1}var t,i=[],s=null;e?t=r.build():t=n.build(),this.fetchFlags=function(){function n(e,n){function r(t){i=t,e()}t.getAll().then(r,n)}return s||(s=new Promise(n)),s},this.get=function(t){return o(t)},this.set=function(n){return i.push(n),t.set(n)}}var n=e("services/flagsApi/flagsApiService"),r=e("services/flagsApi/flagsApiServiceBusiness"),i;t.getInstance=function(e){return i||(i=new s(e)),i},t.destroy=function(){i=null}}),define("text!views/ui/educationBubbles.html",[],function(){return"<div class=\"EducationBubble swx\" data-bind=\"css: { 'EducationBubble--hidden': hidden, 'EducationBubble--orientTop': orientation() === 'TOP', 'EducationBubble--orientLeft': orientation() === 'LEFT', 'EducationBubble--orientRight': orientation() === 'RIGHT' }, attr: { 'data-swx-testId': 'education-bubble-' + id }\">\r\n    <div class=\"EducationBubble-arrow\" data-bind=\"style: { top: arrowTop, bottom: arrowBottom, left: arrowLeft, right: arrowRight }\"></div>\r\n    <div class=\"EducationBubble-content\" data-bind=\"style: { top: top, bottom: bottom, left: left, right: right, backgroundImage: 'url(' + iconUrl + ')' }\">\r\n        <p class=\"EducationBubble-text js-EducationBubble-text\" tabindex=\"-1\" data-bind=\"text: text\" role=\"alert\"></p>\r\n    </div>\r\n</div>\r\n"}),define("utils/common/rtlChecker",["require","exports","module","browser/dom"],function(e,t){function i(e){e=e||n.getElement("div.swx");var t=document.createElement("div");t.style.cssText="position: absolute; visibility: hidden; width: 10px;",t.innerHTML='<span class="probe" style="display: inline-block;"></span>',e.appendChild(t);var i=t.querySelector(".probe"),s=t.getBoundingClientRect(),o=i.getBoundingClientRect(),u=s.right===o.right;t.innerHTML="",e.removeChild(t),r=u}var n=e("browser/dom"),r=null;t.isRtl=function(e){return r===null&&i(e),r},t.reset=function(){r=null}}),define("ui/viewModels/educationBubbles/educationBubbleViewModel",["require","exports","module","services/serviceLocator","constants/common","browser/window","browser/document","browser/dom","vendor/knockout","lodash-compat","utils/common/rtlChecker"],function(e,t){function h(e,h,p,d,v,m){function x(){f.isRtl()&&(m.orientation===r.educationBubbles.ORIENTATION.LEFT?m.orientation=r.educationBubbles.ORIENTATION.RIGHT:m.orientation===r.educationBubbles.ORIENTATION.RIGHT&&(m.orientation=r.educationBubbles.ORIENTATION.LEFT))}function T(){if(!b.hidden())switch(m.orientation){case r.educationBubbles.ORIENTATION.TOP:N();break;case r.educationBubbles.ORIENTATION.LEFT:C();break;case r.educationBubbles.ORIENTATION.RIGHT:k();break;default:L()}}function N(){P(),j()}function C(){A()?M():O()?D():L()}function k(){O()?D():A()?M():L()}function L(){H(),j()}function A(){var e=t.BUBBLE_WIDTH_IN_PX+t.ARROW_HEIGHT_IN_PX,n=h.getBoundingClientRect();return n.left-e>t.OUTER_SPACING_IN_PX}function O(){var e=t.BUBBLE_WIDTH_IN_PX+t.ARROW_HEIGHT_IN_PX,n=h.getBoundingClientRect();return n.right+e<s.documentElement.clientWidth-t.OUTER_SPACING_IN_PX}function M(){B(),F()}function D(){B(),I()}function P(){var e=Math.ceil(p.getBoundingClientRect().bottom-h.getBoundingClientRect().top);b.bottom(e+t.ARROW_HEIGHT_IN_PX+c),b.arrowBottom(e+c),b.orientation(r.educationBubbles.ORIENTATION.TOP)}function H(){var e=Math.floor(h.getBoundingClientRect().bottom-p.getBoundingClientRect().top);b.top(e+t.ARROW_HEIGHT_IN_PX+c),b.arrowTop(e+c),b.orientation(r.educationBubbles.ORIENTATION.BOTTOM)}function B(){var e=Math.floor(h.getBoundingClientRect().bottom-p.getBoundingClientRect().top-h.getBoundingClientRect().height/2);b.top(e-t.BUBBLE_MIN_HEIGH_IN_PX/2+c),b.arrowTop(e+c)}function j(){var e=p.getBoundingClientRect(),n=h.getBoundingClientRect(),r=n.left-e.left+n.width/2,i=t.OUTER_SPACING_IN_PX,o=s.documentElement.clientWidth-t.BUBBLE_WIDTH_IN_PX-t.OUTER_SPACING_IN_PX,u=Math.max(Math.min(r-t.BUBBLE_WIDTH_IN_PX/2,o),i);b.left(Math.floor(u)+c),b.right(l),b.arrowLeft(Math.floor(r-t.ARROW_WIDTH_IN_PX/2)+c),b.arrowRight(l)}function F(){var e=t.BUBBLE_WIDTH_IN_PX+t.ARROW_HEIGHT_IN_PX,n=h.getBoundingClientRect();b.left(n.left-e+c),b.right(l),b.arrowLeft(Math.floor(n.left-t.ARROW_HEIGHT_IN_PX/2-t.ARROW_WIDTH_IN_PX/2)+c),b.arrowRight(l),b.orientation(r.educationBubbles.ORIENTATION.LEFT)}function I(){var e=h.getBoundingClientRect();b.left(e.right+t.ARROW_HEIGHT_IN_PX+c),b.right(l),b.arrowLeft(Math.floor(e.right+t.ARROW_HEIGHT_IN_PX/2-t.ARROW_WIDTH_IN_PX/2)+c),b.arrowRight(l),b.orientation(r.educationBubbles.ORIENTATION.RIGHT)}function q(e){var t=s.querySelector(e);t&&(y=o.createDomObserverSubscription(t,T))}function R(){i.removeEventListener(r.events.browser.RESIZE,E),w.unsubscribe(r.events.narrowMode.SIDEBAR_STATE_CHANGED,S),g.dispose(),y&&y.dispose()}var g,y,b=this,w=n.resolve(r.serviceLocator.PUBSUB),E=a.debounce(T,100),S=function(){b.hidden(!0)};m=m||{},b.id=e,b.text=d,b.iconUrl=v,b.hidden=u.observable(!1),b.left=u.observable(),b.right=u.observable(),b.top=u.observable(),b.bottom=u.observable(),b.arrowLeft=u.observable(),b.arrowRight=u.observable(),b.arrowTop=u.observable(),b.arrowBottom=u.observable(),b.orientation=u.observable(),g=b.hidden.subscribe(R),x(),T(),i.addEventListener(r.events.browser.RESIZE,E),w.subscribe(r.events.narrowMode.SIDEBAR_STATE_CHANGED,S),m.mutatingContainerElementQuery&&q(m.mutatingContainerElementQuery)}var n=e("services/serviceLocator"),r=e("constants/common"),i=e("browser/window"),s=e("browser/document"),o=e("browser/dom"),u=e("vendor/knockout"),a=e("lodash-compat"),f=e("utils/common/rtlChecker"),l="auto",c="px";t.OUTER_SPACING_IN_PX=15,t.ARROW_WIDTH_IN_PX=35,t.ARROW_HEIGHT_IN_PX=9,t.BUBBLE_WIDTH_IN_PX=288,t.BUBBLE_MIN_HEIGH_IN_PX=68,t.build=function(e,t,n,r,i,s){return new h(e,t,n,r,i,s)}}),define("ui/viewModels/experience/welcomeDialog",["require","exports","module","experience/settings"],function(e,t){function i(e){this.cookiesPrivacyUrl=n.cookiesPrivacyUrl,this.close=function(){e()}}var n=e("experience/settings"),r="swx-overlayWelcome";t.ELEMENT_ID=r,t.build=function(e){return new i(e)}}),define("text!views/experience/welcomeDialog.html",[],function(){return'<div id="swx-overlayWelcome" class="swx-overlayModal swx-overlayWelcome">\r\n    <div class="title">\r\n        <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { key: \'welcomeDialog_header\' }"></h1>\r\n    </div>\r\n\r\n    <div class="subtitle">\r\n        <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="l10n: { key: \'welcomeDialog_getInTouch\' }"></p>\r\n    </div>\r\n\r\n    <div class="featureTiles">\r\n        <div class="row">\r\n            <div class="column unit4">\r\n                <span class="iconfont message"></span>\r\n                <div class="text">\r\n                    <p class="fontSize-h3 fontSizeNarrow-p" data-bind="l10n: { key: \'welcomeDialog_sendIM\' }"></p>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="column unit4">\r\n                <span class="iconfont callStart"></span>\r\n                <div class="text">\r\n                    <p class="fontSize-h3 fontSizeNarrow-p" data-bind="l10n: { key: \'welcomeDialog_makeCalls\' }"></p>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="column unit4">\r\n                <span class="iconfont video"></span>\r\n                <div class="text">\r\n                    <p class="fontSize-h3 fontSizeNarrow-p" data-bind="l10n: { key: \'welcomeDialog_makeVideoCalls\' }"></p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="buttonRow">\r\n        <button type="btn" class="btn green narrow large close" data-bind="click: close">\r\n            <span data-bind="l10n: { key: \'welcomeDialog_getStarted_button\' }" tabindex="-1"></span>\r\n        </button>\r\n    </div>\r\n\r\n    <div class="legalNotices">\r\n        <div class="emergencyCalling">\r\n            <span class="iconfont callOff"></span>\r\n            <p data-bind="l10n: { key: \'welcomeDialog_notForEmergencyCalls\' }"></p>\r\n        </div>\r\n\r\n        <div class="cookiesNotice">\r\n            <p data-bind="l10n: { key: \'welcomeDialog_cookiesConsent\' }"></p>\r\n            <p><a data-bind="attr: { href: cookiesPrivacyUrl }, l10n: { key: \'welcomeDialog_readMore\' }" target=\'_blank\'></a></p>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/modalDialog/welcomeDialog",["require","exports","module","swx-i18n","constants/common","services/serviceLocator","services/flagsApi/flagsProvider","ui/modalDialog/modalDialog","ui/viewModels/experience/welcomeDialog","text!views/experience/welcomeDialog.html"],function(e,t){function f(){function n(){return e.get(t.WELCOME_DIALOG_FLAG_ID)}var e=s.getInstance();return e.fetchFlags().then(function(){n()||l()})}function l(){var e=u.build(c),t=n.fetch({key:"welcomeDialog_header"});o.build(u.ELEMENT_ID,e,a),o.show(u.ELEMENT_ID,t)}function c(){var e=s.getInstance();o.hide(u.ELEMENT_ID),e.set(t.WELCOME_DIALOG_FLAG_ID)}var n=e("swx-i18n").localization,r=e("constants/common"),i=e("services/serviceLocator"),s=e("services/flagsApi/flagsProvider"),o=e("ui/modalDialog/modalDialog"),u=e("ui/viewModels/experience/welcomeDialog"),a=e("text!views/experience/welcomeDialog.html");t.WELCOME_DIALOG_FLAG_ID=1,t.init=function(){var e=i.resolve(r.serviceLocator.FEATURE_FLAGS),t;e.isFeatureOn(r.featureFlags.WELCOME_DIALOG)&&(t=i.resolve(r.serviceLocator.PUBSUB),t.subscribe(r.apiUIEvents.SWX_TIMELINE_LOADED,f))}}),define("ui/educationBubbles/educationBubble",["require","exports","module","lodash-compat","browser/dom","browser/document","vendor/knockout","swx-i18n","constants/common","constants/cssClasses","constants/keys","utils/common/async","services/g11n/globalization","services/serviceLocator","ui/telemetry/actions/actionNames","experience/settings","services/flagsApi/flagsProvider","text!views/ui/educationBubbles.html","ui/viewModels/educationBubbles/educationBubbleViewModel","ui/modalDialog/welcomeDialog"],function(e,t){function b(e,t,b,w,E){function T(){return S.get(e)}function N(){var e=h.resolve(u.serviceLocator.FEATURE_FLAGS);return!S.get(y.WELCOME_DIALOG_FLAG_ID)&&e.isFeatureOn(u.featureFlags.WELCOME_DIALOG)}function C(){var e=E&&E.prerequisiteBubbleIds||[];return n.every(e,function(e){return S.get(e)})}function k(e,t,n,r,s){var o=i.querySelector(t),u=L(n,s),a=d.appBaseUrl+r;return o?(A(e,o,u,a,s),S.set(e),j(e),!0):!1}function L(e,t){return t&&t.i18nParams?o.fetch({key:e,params:t.i18nParams}):o.fetch({key:e})}function A(e,t,n,r,i){var o=O(i),u=o.parentNode;x=g.build(e,t,u,n,r,i),P(o),H(o,x),B(o,x),c.initLocaleDirection(o),s.applyBindings(x,o)}function O(e){var t=r.createElement("div"),n=M();return t.innerHTML=m,t=t.firstChild,d.mode&&r.addClass(t,a.educationBubbles.PREFIX+d.mode),e&&e.size===u.educationBubbles.SIZE.LARGE&&r.addClass(t,a.educationBubbles.LARGE),n.appendChild(t),t}function M(){var e=D(d.controls.content.toLowerCase()),t=D(d.controls.sidebar.toLowerCase());return r.findFirstCommonAncestor(e,t)}function D(e){var t=h.resolve(u.serviceLocator.CONTROLS_BUILDER),s=n.find(t.registeredElements,function(t){return t.name===e}).element;return r.isElement(s)||(s=i.querySelector(s)),s}function P(e){var t=function(){e.parentNode.removeChild(e),e.removeEventListener(u.events.browser.TRANSITIONEND,t)};e.addEventListener(u.events.browser.TRANSITIONEND,t)}function H(e,t){function n(s){var o=r.getLastChildElement(e);o.contains(s.target)||(t.hidden(!0),i.removeEventListener(u.events.browser.CLICK,n))}l.execute(function(){i.addEventListener(u.events.browser.CLICK,n,!0)})}function B(e,t){function n(e){e.keyCode===f.ESCAPE&&(t.hidden(!0),i.removeEventListener(u.events.browser.KEYDOWN,n))}i.addEventListener(u.events.browser.KEYDOWN,n)}function j(e){var t=h.resolve(u.serviceLocator.ACTION_TELEMETRY);t.recordAction(p.educationBubbles.educationBubbleShown,{educationBubbleId:e})}var S,x;E&&E.isBusinessFlagService?S=v.getInstance(E.isBusinessFlagService):S=v.getInstance(),this.show=function(){return S.fetchFlags().then(function(){return!T()&&!N()&&C()?k(e,t,b,w,E):!1})},this.hide=function(){x&&x.hidden(!0)}}var n=e("lodash-compat"),r=e("browser/dom"),i=e("browser/document"),s=e("vendor/knockout"),o=e("swx-i18n").localization,u=e("constants/common"),a=e("constants/cssClasses"),f=e("constants/keys"),l=e("utils/common/async"),c=e("services/g11n/globalization"),h=e("services/serviceLocator"),p=e("ui/telemetry/actions/actionNames"),d=e("experience/settings"),v=e("services/flagsApi/flagsProvider"),m=e("text!views/ui/educationBubbles.html"),g=e("ui/viewModels/educationBubbles/educationBubbleViewModel"),y=e("ui/modalDialog/welcomeDialog");t.EDUCATION_BUBBLE_TEXT_ELEMENT_CLASS="js-EducationBubble-text",t.build=function(e,t,n,r,i){return new b(e,t,n,r,i)}}),define("ui/educationBubbles/educationBubbleInfo",["require","exports","module","lodash-compat","constants/common"],function(e,t){var n=e("lodash-compat"),r=e("constants/common");t.SEARCH_EDUCATION_BUBBLE={id:8,anchorElementQuery:".swx .icon .search",i18nKey:"education_bubble_search",iconUrlPath:"/assets/images/components/educationBubbles/educationBubbleSearch.svg"},t.SEARCH_EDUCATION_BUBBLE_BUSINESS={id:9,anchorElementQuery:".swx .icon .search",i18nKey:"education_bubble_search_4b",iconUrlPath:"/assets/images/components/educationBubbles/educationBubbleSearch.svg",options:{isBusinessFlagService:!0}},t.CALL_EDUCATION_BUBBLE={id:6,anchorElementQuery:".fragment:not(.hide) .headerMain .headerControls .callButtons button",i18nKey:"education_bubble_call",iconUrlPath:"/assets/images/components/educationBubbles/educationBubbleCall.svg",options:{mutatingContainerElementQuery:".fragment:not(.hide) .headerMain"}},t.CHAT_EDUCATION_BUBBLE={id:10,anchorElementQuery:".ContactsPage-body .contactTile:not(.echo)",i18nKey:"education_bubble_chat",iconUrlPath:"/assets/images/components/educationBubbles/educationBubbleChat.svg",options:{orientation:r.educationBubbles.ORIENTATION.TOP}},t.CHAT_EDUCATION_BUBBLE_BUSINESS={id:11,anchorElementQuery:".ContactsPage-body .contactTile:not(.echo)",i18nKey:"education_bubble_chat_4b",iconUrlPath:"/assets/images/components/educationBubbles/educationBubbleChat.svg",options:{orientation:r.educationBubbles.ORIENTATION.TOP,isBusinessFlagService:!0}},t.SCHEDULE_CALL_EDUCATION_BUBBLE_1_GROUP={id:17,anchorElementQuery:".fragment:not(.hide) .headerMain .headerControls .moreActions button",i18nKey:"education_bubble_schedule_call_1_group",iconUrlPath:"/assets/images/components/educationBubbles/educationBubbleScheduleCall.svg",options:{prerequisiteBubbleIds:[6],mutatingContainerElementQuery:".fragment:not(.hide) .headerMain",size:r.educationBubbles.SIZE.LARGE}},t.SCHEDULE_CALL_EDUCATION_BUBBLE_1=n.extend({},t.SCHEDULE_CALL_EDUCATION_BUBBLE_1_GROUP,{i18nKey:"education_bubble_schedule_call_1"}),t.SCHEDULE_CALL_EDUCATION_BUBBLE_2_GROUP={id:18,anchorElementQuery:".swxContextMenu .scheduleCallMenuItem",i18nKey:"education_bubble_schedule_call_1_group",iconUrlPath:"/assets/images/components/educationBubbles/educationBubbleScheduleCall.svg",options:{prerequisiteBubbleIds:[17],orientation:r.educationBubbles.ORIENTATION.LEFT}},t.SCHEDULE_CALL_EDUCATION_BUBBLE_2=n.extend({},t.SCHEDULE_CALL_EDUCATION_BUBBLE_2_GROUP,{i18nKey:"education_bubble_schedule_call_1_group"})}),define("ui/contextMenu/items/scheduleCall",["require","exports","module","swx-i18n","ui/contextMenu/menuItem","services/serviceLocator","constants/common","constants/cssClasses","ui/telemetry/actions/actionNames","ui/modalDialog/modalDialog","ui/viewModels/chat/scheduleCallModal","text!views/chat/scheduleCallModal.html","ui/educationBubbles/educationBubble","ui/educationBubbles/educationBubbleInfo"],function(e,t){function p(e){function v(){m(),g()}function m(){var t=f.build(e),r=n.fetch({key:"modal_scheduleCall_text_aria_label"});a.build(f.ELEMENT_ID,t,l),a.show(f.ELEMENT_ID,r)}function g(){var e=i.resolve(s.serviceLocator.ACTION_TELEMETRY);e.recordAction(u.conversation.scheduleCallButton)}function y(){var e=h.SCHEDULE_CALL_EDUCATION_BUBBLE_2,t=i.resolve(s.serviceLocator.FEATURE_FLAGS);t.isFeatureOn(s.featureFlags.SCHEDULE_CALL_EDUCATION_BUBBLE_2)&&(d=c.build(e.id,e.anchorElementQuery,e.i18nKey,e.iconUrlPath,e.options),d.show())}var p=n.fetch({key:"actionsMenuItem_text_scheduleCall"}),d;r.call(this,t.TYPE,p,v),y(),this.cssClass=o.contextMenu.items.SCHEDULE_CALL,this.dispose=function(){d&&d.hide()}}var n=e("swx-i18n").localization,r=e("ui/contextMenu/menuItem"),i=e("services/serviceLocator"),s=e("constants/common"),o=e("constants/cssClasses"),u=e("ui/telemetry/actions/actionNames"),a=e("ui/modalDialog/modalDialog"),f=e("ui/viewModels/chat/scheduleCallModal"),l=e("text!views/chat/scheduleCallModal.html"),c=e("ui/educationBubbles/educationBubble"),h=e("ui/educationBubbles/educationBubbleInfo");p.prototype=Object.create(r.prototype),t.TYPE="ScheduleCallMenuItem",t.build=function(e){return new p(e)}}),define("ui/contextMenu/items/shareScreen",["require","exports","module","swx-i18n","ui/contextMenu/menuItem"],function(e,t){function i(e,i,s){var o=n.fetch({key:"callscreen_text_shareScreen"}),u=n.fetch({key:"callscreen_text_stopSharingScreen"});r.call(this,t.TYPE,i?o:u,s),this.isEnabled=function(){return!e()}}var n=e("swx-i18n").localization,r=e("ui/contextMenu/menuItem");i.prototype=Object.create(r.prototype),t.TYPE="ShareScreenMenuItem",t.build=function(e,t,n){return new i(e,t,n)}}),define("ui/contextMenu/items/all",["require","exports","module","ui/contextMenu/menuItemGroup","ui/contextMenu/items/blockContact","ui/contextMenu/items/callSkype","ui/contextMenu/items/deleteContact","ui/contextMenu/items/editMessage","ui/contextMenu/items/leaveConversation","ui/contextMenu/items/openConversation","ui/contextMenu/items/openConversationWithPerson","ui/contextMenu/items/viewPersonProfile","ui/contextMenu/items/quoteMessage","ui/contextMenu/items/removeConversationHistory","ui/contextMenu/items/addToFavorites","ui/contextMenu/items/removeFromFavorites","ui/contextMenu/items/removeMessage","ui/contextMenu/items/copyLink","ui/contextMenu/items/openLink","ui/contextMenu/items/removeParticipant","ui/contextMenu/items/saveVideoMessage","ui/contextMenu/items/startPSTNCall","ui/contextMenu/items/unblockContact","ui/contextMenu/items/videoCall","ui/contextMenu/items/addParticipants","ui/contextMenu/items/scheduleCall","ui/contextMenu/items/shareScreen"],function(e,t){t.MenuItemGroup=e("ui/contextMenu/menuItemGroup"),t.BlockContactMenuItem=e("ui/contextMenu/items/blockContact"),t.CallSkypeMenuItem=e("ui/contextMenu/items/callSkype"),t.DeleteContactMenuItem=e("ui/contextMenu/items/deleteContact"),t.EditMessageMenuItem=e("ui/contextMenu/items/editMessage"),t.LeaveConversationMenuItem=e("ui/contextMenu/items/leaveConversation"),t.OpenConversationMenuItem=e("ui/contextMenu/items/openConversation"),t.OpenConversationWithPersonMenuItem=e("ui/contextMenu/items/openConversationWithPerson"),t.ViewPersonProfileMenuItem=e("ui/contextMenu/items/viewPersonProfile"),t.QuoteMessageMenuItem=e("ui/contextMenu/items/quoteMessage"),t.RemoveConversationMenuItem=e("ui/contextMenu/items/removeConversationHistory"),t.AddToFavoritesMenuItem=e("ui/contextMenu/items/addToFavorites"),t.RemoveFromFavoritesMenuItem=e("ui/contextMenu/items/removeFromFavorites"),t.RemoveMessageMenuItem=e("ui/contextMenu/items/removeMessage"),t.CopyLinkMenuItem=e("ui/contextMenu/items/copyLink"),t.OpenLinkMenuItem=e("ui/contextMenu/items/openLink"),t.RemoveParticipantMenuItem=e("ui/contextMenu/items/removeParticipant"),t.SaveVideoMessageMenuItem=e("ui/contextMenu/items/saveVideoMessage"),t.StartPSTNCallMenuItem=e("ui/contextMenu/items/startPSTNCall"),t.UnblockContactMenuItem=e("ui/contextMenu/items/unblockContact"),t.VideoCallMenuItem=e("ui/contextMenu/items/videoCall"),t.AddParticipantsMenuItem=e("ui/contextMenu/items/addParticipants"),t.ScheduleCallMenuItem=e("ui/contextMenu/items/scheduleCall"),t.ShareScreen=e("ui/contextMenu/items/shareScreen"),t.itemOrderPriorities={},t.itemOrderPriorities[t.OpenConversationMenuItem.TYPE]={priority:0},t.itemOrderPriorities[t.OpenConversationWithPersonMenuItem.TYPE]={priority:0},t.itemOrderPriorities[t.CallSkypeMenuItem.TYPE]={priority:1},t.itemOrderPriorities[t.StartPSTNCallMenuItem.TYPE]={priority:2,subPriorities:{Cell:{priority:0},Home:{priority:1},Work:{priority:2},Other:{priority:3}}},t.itemOrderPriorities[t.VideoCallMenuItem.TYPE]={priority:3},t.itemOrderPriorities[t.ViewPersonProfileMenuItem.TYPE]={priority:4},t.itemOrderPriorities[t.BlockContactMenuItem.TYPE]={priority:5},t.itemOrderPriorities[t.UnblockContactMenuItem.TYPE]={priority:6},t.itemOrderPriorities[t.DeleteContactMenuItem.TYPE]={priority:7},t.itemOrderPriorities[t.LeaveConversationMenuItem.TYPE]={priority:8},t.itemOrderPriorities[t.RemoveConversationMenuItem.TYPE]={priority:9},t.itemOrderPriorities[t.AddToFavoritesMenuItem.TYPE]={priority:10},t.itemOrderPriorities[t.RemoveFromFavoritesMenuItem.TYPE]={priority:10}}),define("telemetry/shortCircuit/shortCircuit",["require","exports","module","ui/telemetry/telemetryClient","constants/common","experience/settings"],function(e,t){function s(){this.sendStartEvent=function(){n.get().sendEvent(i.telemetry.uiTenantToken,r.shortCircuit.START,{})},this.sendFinishedEvent=function(){n.get().sendEvent(i.telemetry.uiTenantToken,r.shortCircuit.FINISHED,{})}}var n=e("ui/telemetry/telemetryClient"),r=e("constants/common").telemetry.contacts,i=e("experience/settings");t.build=function(){return new s}}),define("ui/shortCircuit/shortCircuit",["require","exports","module","experience/settings","browser/window","constants/common","swx-enums","ui/session/localSession","cafe/applicationInstance","services/serviceLocator","telemetry/shortCircuit/shortCircuit"],function(e,t){function y(){function t(e){return new Promise(function(t){function r(){e.closed&&(clearInterval(n),t())}var n;n=setInterval(r,1e3)})}function y(e,t,n){return w()+S(t,n)+"#"+T(e)}function b(e,t){return r.open(t||"",e,"width="+c+",height="+h+",scrollbars,status")}function w(){var e=[];return e.push(n.pnvService.host),e.push(n.pnvService.pnvEndpoint),e.push("?"),e.join("")}function E(){var e=[];return e.push(n.pnvService.host),e.push(n.pnvService.finishEndpoint),e.join("")}function S(e,t){var r=[];return r.push("client_id="+n.pnvService.clientId),r.push("redirect_uri="+E()),r.push("response_type="+d),r.push("partner="+p),r.push("setlang="+n.initParams.locale),r.push("clientVersion="+n.uiVersion),r.push("scenario="+(t||x(e))),r.push("session_id="+o.getSessionId()),r.join("&")}function x(e){return Date.now()- +e<v?m:g}function T(e){var t=[];return t.push("Skypetoken="+e),t.join("&")}var e=this;e.open=function(e){var n,r=f.build(),i=u.get(),s=l+ +Date.now(),o=b(s);return r.sendStartEvent(),n=t(o),n.then(function(){r.sendFinishedEvent()}),i.signInManager._skypeToken().then(function(t){return i.personsAndGroupsManager.mePerson._registeredAt.get().then(function(r){return b(s,y(t,r,e)),n})}).catch(function(){return o.close(),n})},e.isEnabled=function(){var e=u.get().personsAndGroupsManager.mePerson,t=a.resolve(i.serviceLocator.FEATURE_FLAGS),n=t.isFeatureOn(i.featureFlags.SHORT_CIRCUIT);return!n||e._settings===undefined||e._registeredAt===undefined?Promise.resolve(!1):e._settings.get(s.selfSettings.linkedMSA).then(function(t){return t?e._settings.get(s.selfSettings.autoBuddy).then(function(e){return!e}):!1})}}var n=e("experience/settings"),r=e("browser/window"),i=e("constants/common"),s=e("swx-enums"),o=e("ui/session/localSession"),u=e("cafe/applicationInstance"),a=e("services/serviceLocator"),f=e("telemetry/shortCircuit/shortCircuit"),l="Skype.ShortCircuit",c=720,h=472,p=999,d="postmessage",v=36e5,m="signup",g="afterlogin";t.build=function(){return new y}}),define("ui/viewModels/people/contactGroup",["require","vendor/knockout","utils/common/ko","ui/viewModels/people/contactBuilder"],function(e){function i(e){function n(e){return r.build(e)}this.name=e.name,this.contacts=t.observableArray(e.contacts.map(n))}var t=e("vendor/knockout"),n=e("utils/common/ko"),r=e("ui/viewModels/people/contactBuilder");return i.prototype.dispose=function(){n.disposeAndClearArray(this.contacts)},i.build=function(e){return new i(e)},i}),define("ui/contextMenu/menuItemHelper",["require","exports","module","ui/telemetry/actions/actionSources","ui/contextMenu/items/all","lodash-compat","swx-enums"],function(e,t){function o(e,t){return e.type()===t.type()?u(e.displayString(),t.displayString()):a(e,t)}function u(e,t){var n=e.trim().toLowerCase(),r=t.trim().toLowerCase();return n.localeCompare(r)}function a(e,t){var n=e.type()||s.phoneType.Other,i=t.type()||s.phoneType.Other;return r.itemOrderPriorities.StartPSTNCallMenuItem.subPriorities[n].priority-r.itemOrderPriorities.StartPSTNCallMenuItem.subPriorities[i].priority}function f(e,t){return c(e,t.type)||h(e,t)?u(e.label,t.label):i.isUndefined(r.itemOrderPriorities[t.type])?-1:i.isUndefined(r.itemOrderPriorities[e.type])?1:l(e,t)}function l(e,t){var n=r.itemOrderPriorities[e.type],i=r.itemOrderPriorities[t.type];return n.priority-i.priority}function c(e,t){return e.type===t.type}function h(e,t){var n=r.itemOrderPriorities[e.type],i=r.itemOrderPriorities[t.type];return p(n,i)||d(n,i)&&n.priority===i.priority}function p(e,t){return i.isUndefined(e)&&i.isUndefined(t)}function d(e,t){return!i.isUndefined(e)&&!i.isUndefined(t)}var n=e("ui/telemetry/actions/actionSources"),r=e("ui/contextMenu/items/all"),i=e("lodash-compat"),s=e("swx-enums");t.getMenuItemTelemetryContext=function(e,t){var n={source:e};return t&&t.source&&(n.parent=t.source),n},t.getConversationContextMenuItemGroup=function(e,n,i){var s=[],o=t.getCallPhoneContextMenuItems(e,n,i);return s.push(new r.CallSkypeMenuItem(e,n,i)),Array.prototype.push.apply(s,o),s.push(new r.VideoCallMenuItem(e,n,i)),s.push(new r.ViewPersonProfileMenuItem(e.getPerson(),n,i)),new r.MenuItemGroup(r.CallSkypeMenuItem.TYPE,s)},t.getCallPhoneContextMenuItems=function(e,s,u){var a=[],f=e.getPerson();if(f.phoneNumbers.size()){var l=f.phoneNumbers();l.sort(o),i.forEach(l,function(i){a.push(new r.StartPSTNCallMenuItem(e,i,s,t.getMenuItemTelemetryContext(n.contextMenuItem.startPSTNCall,u)))})}return a},t.sortMenuItems=function(e){e.sort(f)}}),define("ui/viewModels/people/baseContactList",["require","lodash-compat","vendor/knockout","cafe/applicationInstance","constants/common","browser/dom","browser/window","utils/common/ko","utils/common/eventMixin","constants/common","services/serviceLocator","ui/viewModels/people/contactListHelper","ui/contextMenu/contextMenu","ui/contextMenu/items/all","ui/telemetry/actions/actionSources","utils/common/scroll","ui/shortCircuit/shortCircuit","ui/viewModels/people/contactGroup","ui/contextMenu/menuItemHelper"],function(e){function w(){function t(){return e.isSelectable()?E("selectable"):E("default")}var e=this;e.contactGroups=n.observableArray(),e.contactsCount=n.observable(0),e.batchTimers=[],e.exclusionList=[],e.subscriptions={},e.isSelectable=n.observable(!1),e.templateName=n.computed(t),e.isShortCircuitEnabled=n.observable(!1)}function E(e){return"contactList-"+e}function S(e){return s.getElement("div.scrollinWrapper",e)}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("cafe/applicationInstance"),i=e("constants/common"),s=e("browser/dom"),o=e("browser/window"),u=e("utils/common/ko"),a=e("utils/common/eventMixin"),f=e("constants/common").serviceLocator,l=e("services/serviceLocator"),c=e("ui/viewModels/people/contactListHelper"),h=e("ui/contextMenu/contextMenu"),p=e("ui/contextMenu/items/all"),d=e("ui/telemetry/actions/actionSources"),v=e("utils/common/scroll"),m=e("ui/shortCircuit/shortCircuit"),g=e("ui/viewModels/people/contactGroup"),y=e("ui/contextMenu/menuItemHelper"),b=i.telemetry.historyLoadOrigin.CONTACTS_PAGE;return t.assign(w.prototype,a,{init:function(e,t){return this.isSelectable(Boolean(e.isSelectable)),this.scrollbar=v.build(S(t)),this.scrollbar.init(),this.populate(e,t)},populate:function(e){function o(){i().forEach(function(e){e.displayName()===undefined&&u(e)}),n.populateGroups(i(),e)}function u(r){function o(){t.contains(s,r)&&(t.remove(s,r),n.populateGroups(i(),e))}t.contains(s,r)||(s.push(r),r.displayName.get().then(o))}var n=this,r=l.resolve(f.SUBSCRIPTION_PROVIDER),i=r.getPersonsObservable(),s=[];return e.isShortCircuitEnabledOnce=t.once(m.build().isEnabled),n.subscriptions.persons=i.subscribe(o,null,"arrayChange"),o(),Promise.resolve()},populateGroups:function(e,t){var n=this,r=e.filter(function(e){return e.displayName()!==undefined&&n.shouldPersonBeIncluded(e,n.exclusionList)}),i=t.contactGroupConstructor||g,s=c.organizeByAlphabet(r).map(function(e){return i.build(e)});n.contactsCount(r.length),n.setContactGroups(s),n.contactsCount()===0&&!!t.isShortCircuitEnabledOnce&&t.isShortCircuitEnabledOnce().then(function(e){n.isShortCircuitEnabled(e)})},dispose:function(){this.contactsCount(0),this.exclusionList=[],u.disposeAndClearArray(this.contactGroups),this.scrollbar.dispose(),this.templateName.dispose(),this.subscriptions&&this.subscriptions.persons&&this.subscriptions.persons.dispose(),this.batchTimers=this.batchTimers.reduce(function(e,t){return o.clearTimeout(t),e},[])},afterRender:function(e){return e||t.noop},openConversation:function(e,n,s){var o=l.resolve(i.serviceLocator.PUBSUB),u={model:r.get().conversationsManager.getConversation(e.getPerson()),origin:b};t.assign(u,s),o.publish(i.events.navigation.OPEN_CONVERSATION,u)},setContactGroups:function(e){e.length===0?this.contactGroups(e):this.addNextGroup(e,[])},addNextGroup:function(e,t){var n,r;e.length>0&&(r=e.shift(),this.applyPropertyChangeToContacts(r.contacts()),t=t.concat(r),n=this.addNextGroup.bind(this,e,t),this.contactGroups(t),this.batchTimers.push(o.setTimeout(n,10)))},showContextMenu:function(e,t,n){var r=[];r.push(y.getConversationContextMenuItemGroup(e,b,n)),r.push(new p.BlockContactMenuItem(e,y.getMenuItemTelemetryContext(d.contextMenuItem.block,n))),r.push(new p.UnblockContactMenuItem(e,y.getMenuItemTelemetryContext(d.contextMenuItem.unblock,n))),r.push(new p.DeleteContactMenuItem(e,b,y.getMenuItemTelemetryContext(d.contextMenuItem.deleteItem,n))),y.sortMenuItems(r),h.show(r,t,n)},shouldPersonBeIncluded:c.shouldPersonBeIncluded,applyPropertyChangeToContacts:t.noop}),w}),define("ui/viewModels/people/contactPicker",["require","vendor/knockout","usertiming","cafe/applicationInstance","experience/settings","swx-enums","utils/common/ko","constants/common","constants/people","services/serviceLocator","services/telemetry/common/afterRenderHandler","ui/viewModels/people/contactListHelper","ui/viewModels/people/baseContactList","ui/modelHelpers/personHelper","ui/telemetry/telemetryClient"],function(e){function y(){function k(){return e.state()===v.STATE_SEARCH}function L(){return e.state()===v.STATE_DEFAULT}function A(){var t=e.hasSearchList()&&e.contactsCount()>0,n=e.hasDefaultList()&&e.contactGroups().length>0;return t||n}function O(){var e,t=r.get().personsAndGroupsManager.all.persons();return e=t.filter(function(e){var t=!p.isAuthorizedContact(e);return t||M(e)}),e}function M(e){return p.isAgent(e)&&typeof e.capabilities._groupChat=="function"&&!e.capabilities._groupChat()}function _(){var t=O(),n;n=x().map(function(e){return e.person}),e.exclusionList=n.concat(t)}var e=this,y=t.observable(""),x=null,T=null,N=f.resolve(u.serviceLocator.FEATURE_FLAGS),C=null;h.call(e),e.searchResults=t.observableArray(),e.selectedContacts=t.observableArray(),e.state=t.observable(v.STATE_DEFAULT),e.hasSearchList=t.computed(k),e.hasDefaultList=t.computed(L),e.isVisible=t.computed(A),e.css=t.computed(y),e.spacesEnabled=N.isFeatureOn(u.featureFlags.SPACES),e.selectedItemTextDetails=t.observable(""),e.init=function(n,r){return e.showJumpToConversation=n.showJumpToConversation,y(n.className),t.isObservable(n.conversation.participants)?e.exclusionList=O():(x=n.conversation.participants,C=x.subscribe(),x.changed(_)),e.registerEvent(m.ROSTER_QUERY_CHANGED,function(t){t&&Boolean(t.query)?e.search(t.query,E(t.selectedContacts,e.exclusionList)):(e.state(v.STATE_DEFAULT),e.contactsCount(0))}),e.registerEvent(m.ROSTER_SELECTION_REMOVED,function(t){if(t&&t.person){var n=w(e.selectedContacts(),t.person.id());S(n),e.selectedContacts.remove(n),c.deselectContactFromDefaultList(n.getPerson(),e)}}),h.prototype.init.call(e,n,r)},e.dispose=function(){o.disposeAndClearArray(e.searchResults),o.disposeAndClearArray(e.selectedContacts),e.hasSearchList.dispose(),e.hasDefaultList.dispose(),e.isVisible.dispose(),e.css.dispose(),C!==null&&(C.dispose(),C=null,x.changed.off(_),x=null),h.prototype.dispose.call(e)},e.afterRender=function(){function n(){var t=f.resolve(u.serviceLocator.PUBSUB);t.publish(u.events.search.LOCAL_SEARCH_RESULTS_RENDERED,{resultCount:e.contactsCount()})}var t=l(e.contactsCount(),n);return e.selectedItemTextDetails(""),h.prototype.afterRender.call(e,t)},e.search=function(t,f){var l=r.get().personsAndGroupsManager.createPersonSearchQuery(),h;n.mark(g.SEARCH.LOCAL.START);if(T!==null)try{T.cancel("Another search query triggered")}catch(p){d.get().sendEvent(i.telemetry.uiTenantToken,u.telemetry.promiseInvalidStateException.TYPE,{feature:u.telemetry.promiseInvalidStateException.feature.CONTACT_PICKER,exception:JSON.stringify(p)})}return l.limit(a.searchLimit),l.sources(s.searchScope.AddressBook),l.text(t),h=l.getMore().then(function(){if(h!==T)return;var t=c.filterSearchResults(l.results(),f);T=null,e.state(v.STATE_SEARCH),n.mark(g.SEARCH.LOCAL.END),o.disposeAndClearArray(e.searchResults),e.contactsCount(t.length),e.searchResults(t),e.dispatchEvent(m.ROSTER_QUERY_EXECUTED,{moreResultsAvailable:l.moreResultsAvailable()})}),T=h,T},e.onContactSelected=function(t,n){n.preventDefault(),S(t),t.isActive()?b(t,e.selectedContacts())||(e.selectedContacts.push(t),e.dispatchEvent(m.PICKER_CONTACT_SELECTED,t.getPerson()),c.selectContactFromDefaultList(t.getPerson(),e)):(e.selectedContacts.remove(w(e.selectedContacts(),t.id())),e.dispatchEvent(m.PICKER_CONTACT_DESELECTED,t.getPerson()),c.deselectContactFromDefaultList(t.getPerson(),e)),e.state(v.STATE_DEFAULT)}}function b(e,t){return Boolean(w(t,e.id()))}function w(e,n){return t.utils.arrayFirst(e,function(e){return e.id()===n})}function E(e,t){var n=e||[];return n.concat(t)}function S(e){var t=e.isActive();e.isActive(!t)}var t=e("vendor/knockout"),n=e("usertiming"),r=e("cafe/applicationInstance"),i=e("experience/settings"),s=e("swx-enums"),o=e("utils/common/ko"),u=e("constants/common"),a=e("constants/people"),f=e("services/serviceLocator"),l=e("services/telemetry/common/afterRenderHandler"),c=e("ui/viewModels/people/contactListHelper"),h=e("ui/viewModels/people/baseContactList"),p=e("ui/modelHelpers/personHelper"),d=e("ui/telemetry/telemetryClient"),v=a.contactPicker.states,m=u.events.roster,g=u.telemetry.performanceMarks;return y.prototype=new h,y.prototype.constructor=y,y}),define("text!views/people/picker.html",[],function(){return'<div data-bind="visible: isVisible, css: css, keyboardNavigation: { itemSelector: \'.contactList:not(.hidden) .searchItem\', persistSelection: false }" class="scrollinWrapper">\r\n    <div class="scrollViewport scrollViewportV" tabindex="-1">\r\n        <div class="scrollingPane peoplePicker themeWhite" data-bind="css: { all: hasDefaultList }">\r\n            <div class="offScreen" role="tooltip" aria-live="polite" data-bind="text: selectedItemTextDetails"></div>\r\n\r\n            <!-- ko if: spacesEnabled && showJumpToConversation -->\r\n            <swx-selected-participants-conversation params="contacts: selectedContacts"></swx-selected-participants-conversation>\r\n            <!-- /ko -->\r\n\r\n            <div class="grid verticalGutter fixSmall contactList" data-bind="css: { hidden: hasSearchList, visible: hasDefaultList }">\r\n                <div class="row">\r\n                    <div class="separator peopleFilter">\r\n                        <p class="strong" data-bind="l10n: {key: \'message_title_allContacts\'}"></p>\r\n                    </div>\r\n                </div>\r\n\r\n                <ul role="list" class="row" data-bind="foreach: { data: contactGroups }">\r\n                    <div class="column">\r\n                        <div role="presentation" aria-hidden="true" class="separator">\r\n                            <p role="presentation" aria-hidden="true"  class="strong" data-bind="text: $data.name"></p>\r\n                        </div>\r\n\r\n                        <div class="grid verticalGutter fixSmall row people">\r\n                            <!-- ko foreach: { data: $data.contacts, as: \'contact\' } -->\r\n                            <li class="column searchItem" data-bind="css: { active: contact.isActive }, attr: { \'data-title\': contact.textDetails, \'aria-label\': contact.ariaLabel },  enterKey: $parentContext.$parent.onContactSelected, event: { click: $parentContext.$parent.onContactSelected }">\r\n                                 <label>\r\n                                    <span class="icon">\r\n                                        <span class="iconfont tick"></span>\r\n                                    </span>\r\n                                    <swx-avatar-deprecated params="status: contact.statusClassName, avatar: contact.avatar, isAgent: contact.isAgent"></swx-avatar-deprecated>\r\n                                    <span class="text">\r\n                                        <span class="tileName">\r\n                                            <h4 data-bind="html: contact.displayName"></h4>\r\n                                        </span>\r\n                                        <!-- ko if: $data.displayMessage -->\r\n                                        <span class="message tile">\r\n                                            <p data-bind="html: contact.displayMessage" class="small"></p>\r\n                                        </span>\r\n                                        <!-- /ko -->\r\n                                    </span>\r\n                                </label>\r\n                            </li>\r\n                            <!-- /ko -->\r\n                        </div>\r\n                    </div>\r\n                </ul>\r\n            </div>\r\n\r\n            <div class="grid verticalGutter fixSmall contactList" data-bind="css: { hidden: hasDefaultList, visible: hasSearchList }">\r\n                <ul class="row people" data-bind="foreach: { data: searchResults, as: \'contact\', afterRender: afterRender() }">\r\n\r\n                    <li class="column" data-bind="attr: { \'data-title\': contact.textDetails }">\r\n                        <div role="button" data-bind="css: { searchItem: true, active: isActive }, enterKey: $parent.onContactSelected">\r\n                            <label>\r\n                                <input type="checkbox" tabindex="-1" name="sampleOne" data-bind="event: { change: $parent.onContactSelected }" />\r\n                                <span class="icon">\r\n                                    <span class="iconfont tick"></span>\r\n                                </span>\r\n                                <swx-avatar-deprecated params="status: contact.statusClassName, avatar: contact.avatar, isAgent: contact.isAgent"></swx-avatar-deprecated>\r\n                                <span class="text">\r\n                                    <span class="tileName">\r\n                                        <h4 data-bind="html: contact.displayName"></h4>\r\n                                    </span>\r\n                                    <!-- ko if: $data.displayMessage -->\r\n                                    <span class="message tile">\r\n                                        <p data-bind="html: contact.displayMessage" class="small"></p>\r\n                                    </span>\r\n                                    <!-- /ko -->\r\n                                </span>\r\n                            </label>\r\n                        </div>\r\n                    </li>\r\n\r\n                </ul>\r\n            </div>\r\n\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/people/contactPicker",["require","exports","module","vendor/knockout","ui/viewModels/people/contactPicker","constants/components","text!views/people/picker.html"],function(e,t){function i(e,t){var i=new r;return e.isSelectable=!0,i.setContext(n.dataFor(t.element)),i.init(e,t.element),i}var n=e("vendor/knockout"),r=e("ui/viewModels/people/contactPicker");t.name=e("constants/components").people.CONTACT_PICKER,t.template=e("text!views/people/picker.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/people/contactProfile",["require","exports","module","lodash-compat","utils/common/eventMixin","swx-i18n","utils/common/cafeObservable","vendor/knockout","services/serviceLocator","constants/common","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","ui/modalDialog/modalDialog","ui/viewModels/people/blockContactModal","text!views/people/blockContactModal.html","cafe/applicationInstance","swx-enums","ui/viewModels/people/deleteContactModal","text!views/people/deleteContactModal.html","ui/modelHelpers/personHelper"],function(e,t){function b(e,t){function C(){return x()&&!r.contact.isPstn()&&!r.contact.isAgent()}function k(){r.isInContacts(y.isKnownPerson(E))}function L(e,t){w.publish(a.events.interaction.SCROLL_START,t)}function A(){r.dispatchEvent(a.events.conversation.CLOSE_PROFILE,undefined,r.DIRECTION.PARENT),j()}function O(){return r.contact.isAgent()?v.activityType.ContactRequestOutgoingAgent:v.activityType.ContactRequestOutgoing}function M(){var e=u.resolve(a.serviceLocator.ACTION_TELEMETRY);e.recordAction(f.contacts.contactRequestSent,{isResend:!1})}function D(){var e=E.isBlocked.set(!1);return P(),e}function P(){var e=u.resolve(a.serviceLocator.ACTION_TELEMETRY);e.recordAction(f.contacts.contactUnblocked,N)}function H(){var e=new h(T,N),t=i.fetch({key:"modal_blockContact_text_aria_label"});return c.build(h.ELEMENT_ID,e,p),c.show(h.ELEMENT_ID,t),Promise.resolve()}function B(){var e={key:"label_text_blockContact_with_name",params:{name:r.contact.displayName()}};return S()&&(e.key="label_text_unblockContact_with_name"),i.fetch(e)}function j(){r.actionsInProgress(!1)}function F(){return!!r.contact.locationText()}function I(){return b.isFeatureOn(a.featureFlags.SHOW_AGENT_RATING_ON_PROFILE)&&r.contact.isAgent()&&$("rating")}function q(){return r.contact.isAgent()&&$("author")}function R(){return r.contact.isAgent()&&$("description")}function U(){return r.contact.isAgent()&&$("website")}function z(){return r.contact.isAgent()&&$("privacyStatement")}function W(){return r.contact.isAgent()&&$("termsOfService")}function X(){return r.contact.isAgent()&&$("extraInfo")}function V(){return r.contact.isAgent()&&(z()||W())}function $(e){var t;return J(e)?(t=r.contact.agentDetails()[e](),t!==undefined&&t!==null&&(""+t).trim().length>0):!1}function J(e){return!!r.contact.agentDetails()&&typeof r.contact.agentDetails()[e]=="function"}var r=this,b=u.resolve(a.serviceLocator.FEATURE_FLAGS),w=u.resolve(a.serviceLocator.PUBSUB),E=e.conversationModel.participants(0).person,S=s.newObservableProperty(E.isBlocked),x=s.newObservableProperty(E.isBlocked.set.enabled),T=e.conversationTile.contact().getPerson(),N={source:l.contactProfile};r.closeLabel=i.fetch({key:"header_text_close"}),r.model=E,r.contact=e.conversationTile.contact(),r.avatar=s.newObservableProperty(e.conversationModel.avatarUrl),r.hasContactInfo=o.computed(F),r.actionsInProgress=o.observable(!1),r.canBlockContact=o.computed(C),r.isInContacts=o.observable(!1),r.blockContactText=o.computed(B),r.hasAgentRating=o.computed(I),r.hasAgentAuthor=o.computed(q),r.hasAgentDescription=o.computed(R),r.hasAgentWebsite=o.computed(U),r.hasAgentPrivacyStatement=o.computed(z),r.hasAgentTermsOfService=o.computed(W),r.hasAgentExtraInfo=o.computed(X),r.hasAgentPrivacyLinks=o.computed(V),r.addContact=function(){var t,n=O();return r.actionsInProgress(!0),d.get().conversationsManager.conversations.add(e.conversationModel),t=d.get().personsAndGroupsManager.all.persons.add(T,T.id(),undefined,n),M(),t.then(A,j),t},r.toggleContactBlocked=function(){var e;return r.actionsInProgress(!0),S()?e=D():e=H(),e.then(j,j),e},r.deleteContact=function(){var e=N.source,t=new m(r.contact,e,N),n=i.fetch({key:"modal_deleteContact_text_aria_label"});return c.build(m.ELEMENT_ID,t,g),c.show(m.ELEMENT_ID,n),Promise.resolve()},r.onScroll=n.debounce(L,1e3,{leading:!0,trailing:!1}),r.init=function(){t.init()},r.dispose=function(){d.get().personsAndGroupsManager.all.persons.changed.off(k),r.hasContactInfo.dispose(),r.hasAgentRating.dispose(),r.hasAgentAuthor.dispose(),r.hasAgentDescription.dispose(),r.hasAgentWebsite.dispose(),r.hasAgentPrivacyStatement.dispose(),r.hasAgentTermsOfService.dispose(),r.hasAgentExtraInfo.dispose(),r.hasAgentPrivacyLinks.dispose(),r.contact.dispose(),r.canBlockContact.dispose(),r.blockContactText.dispose(),t.dispose()},d.get().personsAndGroupsManager.all.persons.changed(k)}var n=e("lodash-compat"),r=e("utils/common/eventMixin"),i=e("swx-i18n").localization,s=e("utils/common/cafeObservable"),o=e("vendor/knockout"),u=e("services/serviceLocator"),a=e("constants/common"),f=e("ui/telemetry/actions/actionNames"),l=e("ui/telemetry/actions/actionSources"),c=e("ui/modalDialog/modalDialog"),h=e("ui/viewModels/people/blockContactModal"),p=e("text!views/people/blockContactModal.html"),d=e("cafe/applicationInstance"),v=e("swx-enums"),m=e("ui/viewModels/people/deleteContactModal"),g=e("text!views/people/deleteContactModal.html"),y=e("ui/modelHelpers/personHelper");n.assign(b.prototype,r),t.classFunction=b,t.build=function(e,t){return new b(e,t)}}),define("text!views/people/contactProfile.html",[],function(){return'<div class="ContactProfile fixSmall">\r\n    <div class="ContactProfile--avatar">\r\n        <swx-avatar-deprecated params="avatar: avatar, isAgent: contact.isAgent, isPstn: contact.isPstn" class="AvatarDeprecated AvatarDeprecated--XXL"></swx-avatar-deprecated>\r\n        <swx-avatar-deprecated params="avatar: avatar, isAgent: contact.isAgent, isPstn: contact.isPstn" class="AvatarDeprecated AvatarDeprecated--M"></swx-avatar-deprecated>\r\n    </div>\r\n\r\n    <div class="ContactProfile--main">\r\n\r\n        <div class="ContactProfile--actions" data-bind="css: { \'ContactProfile--actions-agent\': hasAgentPrivacyLinks }">\r\n            <!-- ko if: !isInContacts() -->\r\n            <div class="ContactProfile--action-item fontSize-p">\r\n                <span data-bind="css: { \'in-progress\': actionsInProgress }">\r\n                    <a href="#" role="button" data-bind="l10n: {key: \'contact_information_add_to_contacts\'}, click: addContact, css: { \'in-progress\': actionsInProgress }"></a>\r\n                </span>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: isInContacts -->\r\n            <div class="ContactProfile--action-item fontSize-p">\r\n                <span data-bind="css: { \'in-progress\': actionsInProgress }">\r\n                    <a href="#" role="button" data-bind="l10n: {key: \'label_text_deleteContact\'}, click: deleteContact, css: { \'in-progress\': actionsInProgress }"></a>\r\n                </span>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: canBlockContact -->\r\n            <div class="ContactProfile--action-item fontSize-p">\r\n                <span data-bind="css: { \'in-progress\': actionsInProgress }">\r\n                    <a href="#" role="button" data-bind="click: toggleContactBlocked, text: blockContactText, css: { \'in-progress\': actionsInProgress }"></a>\r\n                </span>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: hasAgentPrivacyLinks -->\r\n                <div class="ContactProfile--action-item-privacy">\r\n                    <!-- ko if: hasAgentTermsOfService -->\r\n                    <div class="ContactProfile--action-item fontSize-p">\r\n                        <a href="#" target="_blank" role="button" data-bind="l10n: {key: \'label_text_agent_profile_link_text_terms_of_service\'}, attr: { href: contact.agentDetails().termsOfService }"></a>\r\n                    </div>\r\n                    <!-- /ko -->\r\n                    <!-- ko if: hasAgentPrivacyStatement -->\r\n                    <div class="ContactProfile--action-item fontSize-p">\r\n                        <a href="#" target="_blank" role="button" data-bind="l10n: {key: \'label_text_agent_profile_link_text_privacy_statement\'}, attr: { href: contact.agentDetails().privacyStatement }"></a>\r\n                    </div>\r\n                    <!-- /ko -->\r\n                </div>\r\n            <!-- /ko -->\r\n        </div>\r\n\r\n        <div class="ContactProfile--data scrollingContainer">\r\n            <div class="scrollViewport scrollViewportV" data-bind="event: { scroll: onScroll }" tabindex="-1">\r\n\r\n                <!-- ko if: !contact.isAgent() -->\r\n                <div class="ContactProfile--data-section ContactProfile--details fontSize-p">\r\n                    <h2 data-bind="l10n: {key: \'label_text_contact_profile_details\'}"></h2>\r\n                    <ul>\r\n                        <!-- ko if: !contact.isPstn() -->\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_contact_profile_skype_name\'}"></span>\r\n                            <span data-swx-testId="contact-profile-contact-id" data-bind="text: contact.id"></span>\r\n                        </li>\r\n                        <!-- /ko -->\r\n\r\n                        <!-- ko foreach: contact.phoneNumbers -->\r\n                        <li class="ContactProfile--data-item">\r\n                            <swx-contact-profile-phone-number params="phoneNumber: $data"></swx-contact-profile-phone-number>\r\n                        </li>\r\n                        <!-- /ko -->\r\n                    </ul>\r\n                </div>\r\n                <!-- /ko -->\r\n\r\n                <!-- ko if: !contact.isAgent() && hasContactInfo() -->\r\n                <div class="ContactProfile--data-section ContactProfile--info fontSize-p">\r\n                    <h2 data-bind="l10n: {key: \'label_text_contact_profile_information\'}"></h2>\r\n                    <ul>\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_contact_profile_location\'}"></span>\r\n                            <span data-swx-testId="contact-profile-contact-location" data-bind="text: contact.locationText"></span>\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n                <!-- /ko -->\r\n\r\n                <!-- ko if: contact.isAgent() -->\r\n                <div class="ContactProfile--data-section ContactProfile--agent-details fontSize-p">\r\n                    <ul>\r\n                        <!-- ko if: hasAgentAuthor -->\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_agent_profile_label_author\'}"></span>\r\n                            <span data-swx-testId="contact-profile-agent-author" data-bind="html: contact.agentDetails().author"></span>\r\n                        </li>\r\n                        <!-- /ko -->\r\n                        <!-- ko if: hasAgentDescription -->\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_agent_profile_label_description\'}"></span>\r\n                            <span data-swx-testId="contact-profile-agent-description" data-bind="html: contact.agentDetails().description"></span>\r\n                        </li>\r\n                        <!-- /ko -->\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_agent_profile_label_agentid\'}"></span>\r\n                            <span data-swx-testId="contact-profile-agent-id" data-bind="text: contact.id"></span>\r\n                        </li>\r\n                        <!-- ko if: hasAgentRating -->\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_agent_profile_label_rating\'}"></span>\r\n                            <span class="ContactProfile--agent-rating-value">\r\n                                <!-- ko foreach: { data: contact.agentDetails().ratingStars, as: \'star\' } -->\r\n                                <!-- ko if: star === 1 -->\r\n                                <span class="ContactProfile--agent-rating-star ContactProfile--agent-rating-star-full iconfont favourite"></span>\r\n                                <!-- /ko -->\r\n                                <!-- ko if: star !== 1 -->\r\n                                <span class="ContactProfile--agent-rating-star ContactProfile--agent-rating-star-half iconfont favourite"></span>\r\n                                <!-- /ko -->\r\n                                <!-- /ko -->\r\n                                <span class="ContactProfile--agent-rating-number" data-swx-testId="contact-profile-agent-rating">\r\n                                    (<span data-swx-testId="contact-profile-agent-rating" data-bind="text: contact.agentDetails().rating"></span>)\r\n                                </span>\r\n                            </span>\r\n                        </li>\r\n                        <!-- /ko -->\r\n                        <!-- ko if: hasAgentWebsite -->\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_agent_profile_label_website\'}"></span>\r\n                            <a data-swx-testId="contact-profile-agent-website" data-bind="attr: { href: contact.agentDetails().website }, text: contact.agentDetails().website" target="_blank"></a>\r\n                        </li>\r\n                        <!-- /ko -->\r\n                    </ul>\r\n                </div>\r\n                <div class="ContactProfile--data-section ContactProfile--agent-details fontSize-p">\r\n                    <ul>\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_agent_profile_label_capabilities\'}"></span>\r\n                            <span data-swx-testId="contact-profile-agent-capabilities" data-bind="l10n: {key: \'label_text_agent_profile_value_capabilities\'}"></span>\r\n                        </li>\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_agent_profile_label_privacy\'}"></span>\r\n                            <span data-swx-testId="contact-profile-agent-privacy" data-bind="l10n: {key: \'label_text_agent_profile_value_privacy\'}"></span>\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n                <!-- /ko -->\r\n\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n\r\n</div>\r\n'}),define("ui/components/people/contactProfile",["require","exports","module","ui/viewModels/people/contactProfile","browser/dom","utils/common/scroll","vendor/knockout","constants/components","text!views/people/contactProfile.html"],function(e,t){function o(e,t){var o=s.dataFor(t.element),u=r.getElement(".scrollingContainer",t.element),a=i.build(u),f=n.build(e,a);return f.setContext(o),f.init(),f}var n=e("ui/viewModels/people/contactProfile"),r=e("browser/dom"),i=e("utils/common/scroll"),s=e("vendor/knockout");t.name=e("constants/components").people.CONTACT_PROFILE,t.template=e("text!views/people/contactProfile.html"),t.viewModel={createViewModel:o}}),define("ui/viewModels/people/phoneNumber",["require","exports","module","vendor/knockout","utils/common/cafeObservable","swx-utils-common","swx-i18n","swx-enums"],function(e,t){function u(e){function u(){var e=t.type()||o.phoneType.Other,n="label_text_phone_number_type_"+e.toLowerCase();return s.fetch({key:n})}function a(){return i.forceLTREmbedding(t.phoneNumber())}var t=this;t.phoneNumber=r.newObservableProperty(e.displayString),t.displayString=n.computed(a),t.type=r.newObservableProperty(e.type),t.displayType=n.computed(u)}var n=e("vendor/knockout"),r=e("utils/common/cafeObservable"),i=e("swx-utils-common").stringUtils,s=e("swx-i18n").localization,o=e("swx-enums");u.prototype.dispose=function(){this.displayType.dispose(),this.displayString.dispose()},t.classFunction=u,t.build=function(e){return new u(e)}}),define("text!views/people/contactProfilePhoneNumber.html",[],function(){return'<span data-bind="text: displayType" class="ContactProfile--phone-number-type fontSize-h2"></span>\r\n<span data-bind="text: displayString" class="ContactProfile--phone-number-value"></span>\r\n'}),define("ui/components/people/contactProfilePhoneNumber",["require","exports","module","ui/viewModels/people/phoneNumber","constants/components","text!views/people/contactProfilePhoneNumber.html"],function(e,t){function r(e){var t=n.build(e.phoneNumber);return t}var n=e("ui/viewModels/people/phoneNumber");t.name=e("constants/components").people.CONTACT_PROFILE_PHONE_NUMBER,t.template=e("text!views/people/contactProfilePhoneNumber.html"),t.viewModel={createViewModel:r}}),define("ui/modelHelpers/groupHelper",["require","exports","module","lodash-compat","cafe/applicationInstance","ui/modelHelpers/personHelper","swx-enums"],function(e,t){function o(e){return!i.isEchoContact(e)}function u(e){return!i.isAgent(e)}var n=e("lodash-compat"),r=e("cafe/applicationInstance"),i=e("ui/modelHelpers/personHelper"),s=e("swx-enums");t.getBlockedGroup=function(){var e=r.get().personsAndGroupsManager.all,t=n.find(e.groups(),function(e){return e.relationshipLevel()===s.groupPrivacyRelationshipLevel.Blocked});return t},t.getPersonsOtherThanEcho=function(){var e=r.get().personsAndGroupsManager.all.persons();return n.filter(e,o)},t.getPersonsOtherThanEchoAndAgents=function(){return n.filter(t.getPersonsOtherThanEcho(),u)}}),define("ui/viewModels/people/contactListMenuItem",["require","exports","module","lodash-compat","vendor/knockout","usertiming","constants/common","services/serviceLocator","experience/settings","ui/telemetry/telemetryClient"],function(e,t){function f(e){var t=this,f=o.resolve(s.serviceLocator.ACTION_TELEMETRY);t.id=e.id?"menuItem-"+e.id:"",t.strategy=e.strategy,t.text=e.text||"",t.selected=r.observable(Boolean(e.selected)),t.onClick=function(t,r){return e.uiAction&&f.recordAction(e.uiAction),e.perfMarker&&i.mark(e.perfMarker),e.event&&a.get().sendEvent(u.uiTenantToken,e.event.name,e.event.data),n.isFunction(e.callback)&&e.callback(),r.preventDefault(),!0}}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("usertiming"),s=e("constants/common"),o=e("services/serviceLocator"),u=e("experience/settings").telemetry,a=e("ui/telemetry/telemetryClient");t.build=function(e){return e||(e={}),new f(e)}}),define("ui/viewModels/people/contactPageContactGroup",["require","lodash-compat","vendor/knockout","utils/common/ko","ui/viewModels/people/contactBuilder"],function(e){function s(e){function r(){return this._hiddenContacts().every(function(e){return e()})}function s(){this._hiddenContacts(t.map(this.contacts(),"isHidden"))}function o(e){return i.build(e,{hideable:!0})}this.name=e.name,this.contacts=n.observableArray(e.contacts.map(o)),this._hiddenContacts=n.observableArray(),this._contactsSubscription=this.contacts.subscribe(s,this,"arrayChange"),s.call(this),this.isHidden=n.computed(r,this)}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/ko"),i=e("ui/viewModels/people/contactBuilder");return s.prototype.dispose=function(){this._contactsSubscription.dispose(),this.isHidden.dispose(),r.disposeAndClearArray(this.contacts)},s.build=function(e){return new s(e)},s}),define("ui/viewModels/people/contactsPage",["require","lodash-compat","cafe/applicationInstance","vendor/knockout","usertiming","constants/common","constants/components","constants/people","browser/dom","ui/telemetry/actions/actionNames","experience/settings","ui/telemetry/telemetryClient","services/telemetry/common/afterRenderHandler","ui/viewModels/people/baseContactList","services/serviceLocator","ui/telemetry/actions/actionSources","ui/viewModels/people/contactListHelper","swx-i18n","ui/modelHelpers/personHelper","ui/modelHelpers/groupHelper","ui/viewModels/people/contactListMenuItem","ui/shortCircuit/shortCircuit","ui/educationBubbles/educationBubble","ui/viewModels/people/contactPageContactGroup","ui/educationBubbles/educationBubbleInfo","services/pubSub/pubSub","utils/common/async"],function(e){function _(){d.call(this),D().isFeatureOn(s.featureFlags.SHOW_CONTACTS_PAGE_HINT)?this.showHint=r.computed(function(){return this.contactsCount()>0},this):this.showHint=function(){return!1},this.showSignIn=I(),this.signInHtml=R(y.fetch({key:"aggressiveLinking_intro_signin"})),this.menuItems=[]}function D(){return v.resolve(s.serviceLocator.FEATURE_FLAGS)}function P(e,t){var n=v.resolve(s.serviceLocator.ACTION_TELEMETRY);n.recordAction(e,t)}function H(e){var t,n=B();n.ttc&&n.ttr&&(t={name:s.telemetry.contacts.name.CONTACTS_PAGE_PERFORMANCE,timeToComplete:n.ttc.duration.toString(),timeToRender:n.ttr.duration.toString(),contactsCount:e.toString()},h.get().sendEvent(c.telemetry.uiTenantToken,s.telemetry.contacts.type.CONTACTS,t)),F()}function B(){return{ttc:i.getEntriesByName(M.TTC)[0],ttr:i.getEntriesByName(M.TTR)[0]}}function j(){return i.getEntriesByName(O.OPENED).length>0}function F(){i.clearMarks(O.OPENED),i.clearMarks(O.INITIALIZED),i.clearMarks(O.RENDERED),i.clearMeasures(M.TTC),i.clearMeasures(M.TTR)}function I(){return D().isFeatureOn(s.featureFlags.SHOW_CONTACTS_PAGE_SIGN_IN)&&q()}function q(){return b.isTechnicalAccount(n.get().personsAndGroupsManager.mePerson)}function R(e){return e.replace("{link_start}",'<a href="#">').replace("{link_end}","</a>")}function U(){var e={},t=D().isFeatureOn(s.featureFlags.SEARCH_EDUCATION_BUBBLE_BUSINESS),r=D().isFeatureOn(s.featureFlags.SEARCH_EDUCATION_BUBBLE);if(t&&r)throw new Error("Search education bubble should not be set for business and consumer flavors in the same time.");t&&(e=N.SEARCH_EDUCATION_BUBBLE_BUSINESS),r&&(e=N.SEARCH_EDUCATION_BUBBLE),(r||t)&&n.get().personsAndGroupsManager.all.persons.get().then(function(){var t=w.getPersonsOtherThanEchoAndAgents(),r=n.get().conversationsManager.conversations;t.length===0&&r.size()===0&&X(e)})}function z(){var e=D().isFeatureOn(s.featureFlags.CHAT_EDUCATION_BUBBLE),r=D().isFeatureOn(s.featureFlags.CHAT_EDUCATION_BUBBLE_BUSINESS);if(e&&r)throw new Error("Chat education bubble should not be set for business and consumer flavors in the same time.");e&&n.get().personsAndGroupsManager.all.persons.get().then(function(){var e=w.getPersonsOtherThanEchoAndAgents(),n=e.length,r=t.filter(e,b.isSuggestedContact).length;n>0&&r===n&&X(N.CHAT_EDUCATION_BUBBLE)}),r&&n.get().personsAndGroupsManager.all.persons.get().then(function(){var e=w.getPersonsOtherThanEchoAndAgents(),t=e.length;t>0&&X(N.CHAT_EDUCATION_BUBBLE_BUSINESS)})}function W(){var e=D().isFeatureOn(s.featureFlags.SHOW_CONTACTS_PAGE_INFORMATIONAL_MESSAGE),t=c.contactsPageInformationalMessage;e&&t&&t.key&&t.link?(this.contactsPageInformationalMessage=t,this.showInformationalMessage=!0):this.showInformationalMessage=!1}function X(e){var t=x.build(e.id,e.anchorElementQuery,e.i18nKey,e.iconUrlPath,e.options);t.show()}function V(){function t(t){this.applyPropertyChangeToContacts=g.setObservablePropertyOnContacts.bind(this,"hideStrategy",t),this.applyPropertyChangeToContacts(this.contactGroups()),e.forEach(function(e){var n=e.strategy===t;e.selected(n)})}var e=[];return e.push(E.build({id:a.contactPageTabIds.ALL_CONTACTS_TAB,strategy:a.showStrategies.ALL,text:y.fetch({key:"contactPage_text_tab_allContacts"}),callback:t.bind(this,a.showStrategies.ALL),selected:!0})),D().isFeatureOn(s.featureFlags.CONTACT_PAGE_FILTER_TABS)&&(e.push(E.build({id:a.contactPageTabIds.AVAILABLE_TAB,strategy:a.showStrategies.AVAILABLE_ONLY,text:y.fetch({key:"contactPage_text_tab_available"}),callback:t.bind(this,a.showStrategies.AVAILABLE_ONLY)})),D().isFeatureOn(s.featureFlags.AGENTS_DISCOVERABLE)&&e.push(E.build({id:a.contactPageTabIds.AGENTS_TAB,strategy:a.showStrategies.AGENTS_ONLY,text:y.fetch({key:"contactPage_text_tab_agents"}),callback:t.bind(this,a.showStrategies.AGENTS_ONLY)}))),e}function $(e){k.execute(function(){e.focus()}),C.subscribe(o.FRAGMENT_LOADED,J)}function J(e){e===u.people.CONTACTS_PAGE&&L.focus()}var t=e("lodash-compat"),n=e("cafe/applicationInstance"),r=e("vendor/knockout"),i=e("usertiming"),s=e("constants/common"),o=s.events.navigation,u=e("constants/components"),a=e("constants/people"),f=e("browser/dom"),l=e("ui/telemetry/actions/actionNames"),c=e("experience/settings"),h=e("ui/telemetry/telemetryClient"),p=e("services/telemetry/common/afterRenderHandler"),d=e("ui/viewModels/people/baseContactList"),v=e("services/serviceLocator"),m=e("ui/telemetry/actions/actionSources"),g=e("ui/viewModels/people/contactListHelper"),y=e("swx-i18n").localization,b=e("ui/modelHelpers/personHelper"),w=e("ui/modelHelpers/groupHelper"),E=e("ui/viewModels/people/contactListMenuItem"),S=e("ui/shortCircuit/shortCircuit"),x=e("ui/educationBubbles/educationBubble"),T=e("ui/viewModels/people/contactPageContactGroup"),N=e("ui/educationBubbles/educationBubbleInfo"),C=e("services/pubSub/pubSub"),k=e("utils/common/async"),L=null,A=s.telemetry,O=A.performanceMarks.CONTACTS.PAGE,M=A.measurements.CONTACTS.PAGE;return _.prototype=new d,_.prototype.constructor=_,_.prototype.init=function(e,t){var n;return L=f.getElement(".ContactsPage",t),j()&&(i.mark(O.INITIALIZED),i.measure(M.TTC,O.OPENED,O.INITIALIZED)),D().isFeatureOn(s.featureFlags.CONTACT_PAGE_FILTER_TABS)&&(e.contactGroupConstructor=T),n=d.prototype.init.call(this,e,L),Array.prototype.push.apply(this.menuItems,V.call(this)),W.call(this),U(),z(),$(L),n},_.prototype.dispose=function(){L=null,this.showHint.dispose&&this.showHint.dispose(),C.unsubscribe(o.FRAGMENT_LOADED,J),d.prototype.dispose.call(this)},_.prototype.afterRender=function(){function n(){j()&&(i.mark(O.RENDERED),i.measure(M.TTR,O.OPENED,O.RENDERED),H(e.contactsCount()))}var e=this,t=p(e.contactGroups().length,n);return d.prototype.afterRender.call(this,t)},_.prototype.openConversation=function(e,t){P(l.contacts.openConversation),d.prototype.openConversation.call(this,e,t)},_.prototype.showContextMenu=function(e,t){var n={source:m.contactsPage.contact};d.prototype.showContextMenu.call(this,e,t,n)},_.prototype.launchShortCircuit=function(){S.build().open(),v.resolve(s.serviceLocator.ACTION_TELEMETRY).recordAction(l.shortCircuit.contactsPageOpen)},_.prototype.openInformationalMessageLink=function(){P(l.contacts.informationButtonClicked,{link:this.contactsPageInformationalMessage.link}),window.open(this.contactsPageInformationalMessage.link,"_blank")},_.prototype.shouldPersonBeIncluded=function(e,t){return g.personExistsInCollection(e,t)?!1:b.isEchoContact(e)?w.getPersonsOtherThanEcho().length>0:!0},_.prototype.startRelinkFlow=function(){n.get().signInManager.signIn({relink:!0})},_}),define("text!views/people/contactsPage.html",[],function(){return'<div data-swx-testId="contactsPage" class="ContactsPage themeWhite" tabindex="-1">\r\n    <div class="ContactsPage-header">\r\n        <h1 class="ContactsPage-heading" data-bind="l10n: { key: \'contactPage_text_header\' }"></h1>\r\n\r\n        <!-- ko if: showHint() -->\r\n        <p class="ContactsPage-hint" data-bind="l10n: { key: \'contactPage_text_hint_search\' }"></p>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: contactsCount() > 0 -->\r\n        <ul role="tablist" class="ContactsPage-categories" data-bind="foreach: menuItems">\r\n            <li role="tab" class="ContactsPage-categoryItem" data-bind="attr: { \'aria-selected\': !!$data.selected() }">\r\n                <swx-contact-list-menu-item params="viewModel: $data"></swx-contact-list-menu-item>\r\n            </li>\r\n        </ul>\r\n        <!-- /ko -->\r\n    </div>\r\n    <div data-swx-testId="contactsPageBody" class="scrollinWrapper ContactsPage-body">\r\n        <div class="scrollViewport scrollViewportV" tabindex="-1">\r\n            <div class="scrollingPane themeWhite peoplePicker all">\r\n                <!-- ko template: { name: templateName } --><!-- /ko -->\r\n\r\n                <!-- ko if: !contactsCount() && !isShortCircuitEnabled() -->\r\n                <div class="ContactsPage-cta">\r\n                    <div class="ContactsPage-ctaContent">\r\n                        <div class="ContactsPage-ctaCover"></div>\r\n                        <h1 class="ContactsPage-ctaHeading fontSize-h0" data-swx-testId="contactsPageCtaHeading" data-bind="l10n: {key: \'newbee_text_header\'}"></h1>\r\n                        <p class="ContactsPage-ctaText fontSize-h2" data-bind="businessAwareL10n: {key: \'newbee_text_cta\'}"></p>\r\n                    </div>\r\n                </div>\r\n                <!-- /ko -->\r\n\r\n                <!-- ko if: !contactsCount() && isShortCircuitEnabled() -->\r\n                <div class="ContactsPage-cta">\r\n                    <div class="ContactsPage-ctaContent">\r\n                        <div class="ContactsPage-ctaCover ContactsPage-ctaCover--findFriends"></div>\r\n                        <p class="ContactsPage-ctaText fontSize-h2" data-bind="l10n: {key: \'short_circuit_contacts_page_message\'}"></p>\r\n                        <button type="button" class="ContactsPage-ctaButton btn primary cancel" data-bind="click: launchShortCircuit"><span class="clickable" data-bind="l10n: {key: \'short_circuit_contacts_page_cta\'}"></span></button>\r\n                    </div>\r\n                </div>\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <!-- ko if: showSignIn -->\r\n    <p class="ContactsPage-signIn" data-bind="html: signInHtml, click: startRelinkFlow"></p>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: showInformationalMessage -->\r\n    <div class="InformationalMessage">\r\n        <a href="#" role="button" data-bind="click: openInformationalMessageLink, l10n: {key: contactsPageInformationalMessage.key}"></a>\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n\r\n<script type="text/html" id="contactList-default">\r\n    <ul class="grid verticalGutter fixSmall" data-bind="foreach: { data: contactGroups, afterRender: afterRender() }, keyboardNavigation: { itemSelector: \'li.contactTile:not(.swx-hide)\', persistSelection: false }">\r\n        <div class="row separator">\r\n            <p role="presentation" aria-hidden="true" class="strong" data-bind="text: $data.name, css: { \'swx-hide\': $data.isHidden }"></p>\r\n            <div class="row people">\r\n                <!-- ko foreach: { data: contacts } -->\r\n                <li class="column contactTile searchItem" data-bind="css: { \'swx-hide\': $data.isHidden, echo: $data.isEcho, active: $data.isActive },  enterKey: $parentContext.$parent.openConversation,\r\n                event: { click: $parentContext.$parent.openConversation, contextmenu: $parentContext.$parent.showContextMenu }, attr: { \'aria-label\': $data.ariaLabel }" tabindex="0">\r\n                        <swx-avatar-deprecated params="status: $data.statusClassName, avatar: $data.avatar, isAgent: $data.isAgent"></swx-avatar-deprecated>\r\n                        <span class="text">\r\n                            <span class="tile">\r\n                                <span class="tileName">\r\n                                    <h4>\r\n                                        <span class="topic" data-bind="text: $data.displayName, attr: {title: $data.displayName}"></span>\r\n                                        <!-- ko if: $data.agentDetails() && $data.agentDetails().certification() -->\r\n                                        <span class="iconfont avatarBotCertified"></span>\r\n                                        <!-- /ko -->\r\n                                    </h4>\r\n                                </span>\r\n                            </span>\r\n                            <!-- ko if: $data.displayMessage -->\r\n                            <span class="message tile">\r\n                                <p data-bind="html: $data.displayMessage" data-swx-testId="displayMessage" class="small"></p>\r\n                            </span>\r\n                            <!-- /ko -->\r\n                        </span>\r\n                </li>\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n    </ul>\r\n</script>\r\n\r\n<script type="text/html" id="contactList-selectable">\r\n    <ol role="list" class="grid verticalGutter fixSmall" data-bind="foreach: { data: contactGroups }">\r\n        <li class="row separator" data-bind="css: { \'swx-hide\': $data.isHidden }">\r\n            <p role="presentation" aria-hidden="true" class="strong" data-bind="text: $data.name"></p>\r\n            <div class="row people">\r\n                <ul data-bind="foreach: { data: $data.contacts }">\r\n                    <li class="column contactTile" data-bind="css: { echo: $data.isEcho }">\r\n                        <div data-bind="css: { \'swx-hide\': $data.isHidden, active: $data.isActive }">\r\n                            <label>\r\n                                <input type="checkbox" name="sampleOne">\r\n                                <span class="icon">\r\n                                    <span class="iconfont tick"></span>\r\n                                </span>\r\n                                <swx-avatar-deprecated params="status: $data.statusClassName, avatar: $data.avatar, isAgent: $data.isAgent"></swx-avatar-deprecated>\r\n                                <span class="text">\r\n                                    <span class="tileName">\r\n                                        <h4 data-bind="html: $data.displayName"></h4>\r\n                                    </span>\r\n                                    <!-- ko if: $data.displayMessage -->\r\n                                    <span class="message tile">\r\n                                        <p data-bind="html: $data.displayMessage" data-swx-testId="displayMessage" class="small"></p>\r\n                                    </span>\r\n                                    <!-- /ko -->\r\n                                </span>\r\n                            </label>\r\n                        </div>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n        </li>\r\n    </ol>\r\n</script>\r\n'}),define("ui/components/people/contactsPage",["require","exports","module","vendor/knockout","ui/viewModels/people/contactsPage","constants/components","text!views/people/contactsPage.html"],function(e,t){function i(e,t){var i=new r;return i.setContext(n.dataFor(t.element)),i.init(s(),t.element),i}function s(){return{className:"ContactsPage",isSelectable:!1}}var n=e("vendor/knockout"),r=e("ui/viewModels/people/contactsPage");t.name=e("constants/components").people.CONTACTS_PAGE,t.template=e("text!views/people/contactsPage.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/people/baseList",["require","vendor/knockout","cafe/applicationInstance","experience/settings","swx-i18n","services/serviceLocator","constants/common","constants/people","swx-enums","ui/viewModels/people/contactBuilder","services/telemetry/common/afterRenderHandler","ui/telemetry/actions/actionNames","ui/telemetry/telemetryClient","utils/common/statusMapper"],function(e){function v(e){this.listSource=t.observable(e),this.contacts=t.observableArray(),this.emptyListText=i.fetch({key:"message_text_emptySearchResults"}),this.showEmptyListText=t.observable(!1),this.listHasContacts=t.computed(function(){return this.contacts().length>0},this),this.isLocal=e===a.searchScope.AddressBook,this.isLocal?(this.listClass=t.observable(u.contactList.className.LOCAL),this.listTitle=t.observable(i.fetch({key:"message_text_contactTitleLocal"})),this.showListTitle=t.observable(!0),this.events={results:d.LOCAL_SEARCH_RESULTS,rendered:d.LOCAL_SEARCH_RESULTS_RENDERED},this.historyLoadOrigin=o.telemetry.historyLoadOrigin.CONTACT_SEARCH,this.searchItemI18nKey="accessibility_searchItem_oneToOne"):(this.listClass=t.observable(u.contactList.className.DIRECTORY),this.listTitle=t.observable(i.fetch({key:"message_text_contactTitleDirectory"})),this.showListTitle=t.observable(!1),this.events={results:d.DIRECTORY_SEARCH_RESULTS,rendered:d.DIRECTORY_SEARCH_RESULTS_RENDERED},this.historyLoadOrigin=o.telemetry.historyLoadOrigin.DIRECTORY_SEARCH,this.searchItemI18nKey="accessibility_searchItem_directoryList")}function m(){return s.resolve(o.serviceLocator.PUBSUB)}function g(){return s.resolve(o.serviceLocator.ACTION_TELEMETRY)}var t=e("vendor/knockout"),n=e("cafe/applicationInstance"),r=e("experience/settings"),i=e("swx-i18n").localization,s=e("services/serviceLocator"),o=e("constants/common"),u=e("constants/people"),a=e("swx-enums"),f=e("ui/viewModels/people/contactBuilder"),l=e("services/telemetry/common/afterRenderHandler"),c=e("ui/telemetry/actions/actionNames"),h=e("ui/telemetry/telemetryClient"),p=e("utils/common/statusMapper"),d=o.events.search;return v.prototype.init=function(){m().subscribe(d.QUERY_CHANGED,this.search)},v.prototype.dispose=function(){m().unsubscribe(d.QUERY_CHANGED,this.search)},v.prototype.reset=function(){this.showListTitle(!1),this.showEmptyListText(!1),this.contacts([])},v.prototype.search=function(t){function v(){if(l.activeSearchPromise!==a)return;y(),l.contacts(i.results().map(function(e){return f.build(e.result,{keepPresenceSubscription:!1,keepLastSeenAtSubscription:!1,keepActivitySubscription:!1,keepEndpointTypeSubscription:!1})})),m().publish(d.QUERY_EXECUTED,{moreResultsAvailable:i.moreResultsAvailable()})}function y(){if(l.activeSearchPromise!==a)return;var e=s.getTraceableAction(c.search.started);e.markBeforeRender(),e.addEventData({source:l.listSource(),results:i.results().length}),l.activeSearchPromise=null,l.totalSearchResults=i.results().length,m().publish(l.events.results,l.totalSearchResults),l.showListTitle(!0),l.showEmptyListText(!i.results().length)}var i,s,a,l=this;if(!t)return;if(l.activeSearchPromise)try{l.activeSearchPromise.cancel("Another search query triggered")}catch(p){h.get().sendEvent(r.telemetry.uiTenantToken,o.telemetry.promiseInvalidStateException.TYPE,{feature:o.telemetry.promiseInvalidStateException.feature.PEOPLE_SEARCH,exception:JSON.stringify(p)})}return s=g(),s.recordAction(c.search.started,{queryLength:t.length}),s.createTraceableAction(c.search.started).startTrace(),i=n.get().personsAndGroupsManager.createPersonSearchQuery(),i.sources(l.listSource()),i.text(t),i.limit(u.searchLimit),a=i.getMore().then(v,y),this.activeSearchPromise=a,this.activeSearchPromise},v.prototype.sendOpenConversationEvent=function(t){m().publish(o.events.navigation.OPEN_CONVERSATION,{model:t,origin:this.historyLoadOrigin})},v.prototype.getSearchItemDetails=function(t,n){var r=p.getAvailabilityText(t.status());return i.fetch({key:this.searchItemI18nKey,params:{contactName:t.displayName(),id:t.id(),status:r!==null?r:"",index:n+1,totalResults:this.totalSearchResults}})},v.prototype.afterRender=function(){var t=this;return l(t.contacts().length,function(){var e=g().getTraceableAction(c.search.started);e.markAfterRender(),e.endTrace(),m().publish(t.events.rendered,{resultCount:t.contacts().length})})},v}),define("ui/viewModels/people/directoryList",["require","ui/viewModels/people/baseList","cafe/applicationInstance","services/serviceLocator","constants/common","swx-enums","lodash-compat","ui/telemetry/actions/actionSources","ui/contextMenu/contextMenu","ui/contextMenu/items/all"],function(e){function c(){function c(){return r.resolve(i.serviceLocator.PUBSUB)}function h(e){return{source:e,parent:u.searchItem.skypeDirectory}}var e=this,o=t.prototype;t.call(e,s.searchScope.SkypeDirectory),e.lastQuery="",e.isActive=!1,e.init=function(){c().subscribe(l.DIRECTORY_SEARCH_ACTIVATED,e.activate),c().subscribe(l.DIRECTORY_SEARCH_DEACTIVATED,e.deactivate),o.init.call(e)},e.dispose=function(){c().unsubscribe(l.DIRECTORY_SEARCH_ACTIVATED,e.activate),c().unsubscribe(l.DIRECTORY_SEARCH_DEACTIVATED,e.deactivate),o.dispose.call(e)},e.search=function(n){e.lastQuery=n,o.reset.call(e);if(e.isActive)return o.search.call(e,n)},e.openConversation=function(r){var i=n.get().conversationsManager.getConversation(r.getPerson());o.sendOpenConversationEvent.call(e,i)},e.showContextMenu=function(t,n){var r,i={source:u.searchItem.skypeDirectory},s=h(u.contextMenuItem.unblock);r=[new f.UnblockContactMenuItem(t,s)],a.show(r,n,i)},e.activate=function(){e.isActive=!0,e.search(e.lastQuery)},e.deactivate=function(){e.isActive=!1}}var t=e("ui/viewModels/people/baseList"),n=e("cafe/applicationInstance"),r=e("services/serviceLocator"),i=e("constants/common"),s=e("swx-enums"),o=e("lodash-compat"),u=e("ui/telemetry/actions/actionSources"),a=e("ui/contextMenu/contextMenu"),f=e("ui/contextMenu/items/all"),l=i.events.search;return c.prototype=o.create(t.prototype,{constructor:c}),c}),define("text!views/people/list.html",[],function(){return'<ul data-bind="css: listClass, keyboardNavigation: { itemSelector: \'.searchItem\', persistSelection: false }">\r\n    <!-- ko if: showListTitle -->\r\n    <div class="separator">\r\n        <p class="strong" data-bind="text: listTitle"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: showEmptyListText -->\r\n    <li class="grid container">\r\n        <p data-bind="text: emptyListText"></p>\r\n    </li>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: listHasContacts -->\r\n    <!-- ko foreach: { data: contacts, as: \'contact\', afterRender: afterRender() } -->\r\n    <li class="list-selectable searchItem clearfix" data-bind="attr: { \'data-title\': $parent.getSearchItemDetails(contact, $index()) },\r\n    event: { click: $parent.openConversation, contextmenu: $parent.showContextMenu }, enterKey: $parent.openConversation, css: { active: contact.isActive }">\r\n        <swx-avatar-deprecated params="status: contact.statusClassName, avatar: contact.avatar, isAgent: contact.isAgent"></swx-avatar-deprecated>\r\n        <span class="text">\r\n            <span class="arrow"></span>\r\n            <span class="tileName">\r\n                <h4 data-bind="html: contact.displayName"></h4>\r\n            </span>\r\n            <!-- ko if: contact.displayMessage -->\r\n            <span class="message">\r\n                <p class="small" data-bind="html: contact.displayMessage"></p>\r\n            </span>\r\n            <!-- /ko -->\r\n        </span>\r\n    </li>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n</ul>\r\n'}),define("ui/components/people/directorySearch",["require","exports","module","ui/viewModels/people/directoryList","constants/components","text!views/people/list.html"],function(e,t){function r(){var e=new n;return e.init(),e}var n=e("ui/viewModels/people/directoryList");t.name=e("constants/components").people.DIRECTORY_SEARCH,t.template=e("text!views/people/list.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/people/discoverAgentsPage",["require","cafe/applicationInstance","usertiming","constants/common","constants/components","browser/dom","ui/telemetry/actions/actionNames","experience/settings","ui/telemetry/telemetryClient","services/telemetry/common/afterRenderHandler","ui/viewModels/people/baseContactList","services/serviceLocator","ui/telemetry/actions/actionSources","ui/viewModels/people/contactListHelper","constants/cssClasses","swx-enums","vendor/knockout","ui/contextMenu/items/all","ui/contextMenu/contextMenu","services/pubSub/pubSub","utils/common/async"],function(e){function L(){var e=this;c.call(e),e.menuItems=[],e.searchInProgress=g.observable(!1),e.hasResults=g.computed(function(){return!e.searchInProgress()&&!!e.contactGroups().length}),e.hasZeroResults=g.computed(function(){return!e.searchInProgress()&&e.contactGroups().length===0})}function A(e){var t=h.resolve(r.serviceLocator.ACTION_TELEMETRY);t.recordAction(e)}function O(e){var t,n=M();n.ttc&&n.ttr&&(t={name:r.telemetry.agents.name.DISCOVER_AGENTS_PAGE_PERFORMANCE,timeToComplete:n.ttc.duration.toString(),timeToRender:n.ttr.duration.toString(),contactsCount:e.toString()},f.get().sendEvent(a.telemetry.uiTenantToken,r.telemetry.agents.type.AGENTS,t)),D()}function M(){return{ttc:n.getEntriesByName(N.TTC)[0],ttr:n.getEntriesByName(N.TTR)[0]}}function _(){return n.getEntriesByName(T.OPENED).length>0}function D(){n.clearMarks(T.OPENED),n.clearMarks(T.INITIALIZED),n.clearMarks(T.RENDERED),n.clearMeasures(N.TTC),n.clearMeasures(N.TTR)}function P(e){E.execute(function(){e.focus()}),w.subscribe(i.FRAGMENT_LOADED,H)}function H(e){e===s.people.DISCOVER_AGENTS_PAGE&&S.focus()}var t=e("cafe/applicationInstance"),n=e("usertiming"),r=e("constants/common"),i=r.events.navigation,s=e("constants/components"),o=e("browser/dom"),u=e("ui/telemetry/actions/actionNames"),a=e("experience/settings"),f=e("ui/telemetry/telemetryClient"),l=e("services/telemetry/common/afterRenderHandler"),c=e("ui/viewModels/people/baseContactList"),h=e("services/serviceLocator"),p=e("ui/telemetry/actions/actionSources"),d=e("ui/viewModels/people/contactListHelper"),v=e("constants/cssClasses"),m=e("swx-enums"),g=e("vendor/knockout"),y=e("ui/contextMenu/items/all"),b=e("ui/contextMenu/contextMenu"),w=e("services/pubSub/pubSub"),E=e("utils/common/async"),S=null,x=r.telemetry,T=x.performanceMarks.DISCOVER_AGENTS.PAGE,N=x.measurements.DISCOVER_AGENTS.PAGE,C=r.telemetry.historyLoadOrigin.DISCOVER_AGENTS_PAGE,k={source:p.discoverAgentsPage.agent};return L.prototype=new c,L.prototype.constructor=L,L.prototype.init=function(e,t){var r;return S=o.getElement("."+v.discoverAgents.PAGE,t),_()&&(n.mark(T.INITIALIZED),n.measure(N.TTC,T.OPENED,T.INITIALIZED)),r=c.prototype.init.call(this,e,S),P(S),r},L.prototype.dispose=function(){S=null,this.hasResults.dispose(),this.hasZeroResults.dispose(),w.unsubscribe(i.FRAGMENT_LOADED,H),c.prototype.dispose.call(this)},L.prototype.afterRender=function(){function r(){_()&&(n.mark(T.RENDERED),n.measure(N.TTR,T.OPENED,T.RENDERED),O(e.contactsCount()))}var e=this,t=l(e.contactGroups().length,r);return c.prototype.afterRender.call(this,t)},L.prototype.openConversation=function(e,t){var n={origin:C,target:{expandProfile:!0},telemetryContext:k};A(u.discoverAgents.openConversation),c.prototype.openConversation.call(this,e,t,n)},L.prototype.showContextMenu=function(e,t){var n=[new y.ViewPersonProfileMenuItem(e.getPerson(),C,k)];b.show(n,t,k)},L.prototype.shouldPersonBeIncluded=function(e,t){return!d.personExistsInCollection(e,t)},L.prototype.populate=function(e){function a(){n.exclusionList=o(),u.then(f)}function f(){var t=i.results().map(function(e){return e.result});n.populateGroups(t,e),n.searchInProgress(!1)}var n=this,i=t.get().personsAndGroupsManager.createPersonSearchQuery(),s=h.resolve(r.serviceLocator.SUBSCRIPTION_PROVIDER),o=s.getPersonsObservable(),u;return n.searchInProgress(!0),n.exclusionList=o(),i.sources(m.searchScope.Agent),u=i.getMore(),u.then(f),n.subscriptions.persons=o.subscribe(a,null,"arrayChange"),u},L}),define("text!views/people/discoverAgentsPage.html",[],function(){return'<div data-swx-testId="DiscoverAgentsPage" class="DiscoverAgentsPage themeWhite" tabindex="-1">\r\n    <div class="DiscoverAgentsPage--header">\r\n        <h1 class="DiscoverAgentsPage--heading" data-bind="l10n: { key: \'label_text_discover_agents_page_header\' }"></h1>\r\n        <p class="DiscoverAgentsPage--hint" data-bind="l10n: { key: \'label_text_discover_agents_page_hint\' }"></p>\r\n    </div>\r\n    <div data-swx-testId="discoverAgentsPageBody" class="scrollinWrapper DiscoverAgentsPage--body">\r\n        <div class="scrollViewport scrollViewportV" tabindex="-1">\r\n            <div class="scrollingPane themeWhite peoplePicker all">\r\n                <!-- ko if: searchInProgress -->\r\n                <div class="DiscoverAgentsPage--spinner">\r\n                    <swx-loading-animation data-bind="visible: searchInProgress" class="spinner fog"></swx-loading-animation>\r\n                </div>\r\n                <!-- /ko -->\r\n\r\n                <!-- ko if: hasResults -->\r\n                <!-- ko template: { name: templateName } --><!-- /ko -->\r\n                <!-- /ko -->\r\n\r\n                <!-- ko if: hasZeroResults -->\r\n                <div class="DiscoverAgentsPage--zero-results">\r\n                    <p data-bind="l10n: { key: \'label_text_discover_agents_page_zero_results_text_part_1\' }"></p>\r\n                    <p data-bind="l10n: { key: \'label_text_discover_agents_page_zero_results_text_part_2\' }"></p>\r\n                </div>\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<script type="text/html" id="contactList-default">\r\n    <ul class="grid verticalGutter fixSmall" data-bind="foreach: { data: contactGroups, afterRender: afterRender() },\r\n    keyboardNavigation: { itemSelector: \'li.contactTile:not(.swx-hide)\', persistSelection: false }, attr_l10n: {\'aria-label\': \'label_text_discover_agents_page_header\'}">\r\n        <div class="row separator">\r\n            <p role="presentation" aria-hidden="true" class="strong" data-bind="text: $data.name"></p>\r\n            <div class="row people">\r\n                <!-- ko foreach: { data: contacts } -->\r\n                <li class="column contactTile searchItem" data-bind="css: { \'swx-hide\': $data.isHidden, echo: $data.isEcho, active: $data.isActive },  enterKey: $parentContext.$parent.openConversation,\r\n                event: { click: $parentContext.$parent.openConversation, contextmenu: $parentContext.$parent.showContextMenu }, attr: { \'aria-label\': $data.ariaLabel }">\r\n                    <swx-avatar-deprecated params="status: $data.statusClassName, avatar: $data.avatar, isAgent: $data.isAgent"></swx-avatar-deprecated>\r\n                        <span class="text">\r\n                            <span class="tile">\r\n                                <span class="tileName">\r\n                                    <h4>\r\n                                        <span class="topic" data-bind="text: $data.displayName, attr: {title: $data.displayName}"></span>\r\n                                        <!-- ko if: $data.agentDetails() && $data.agentDetails().certification() -->\r\n                                        <span class="iconfont avatarBotCertified"></span>\r\n                                        <!-- /ko -->\r\n                                    </h4>\r\n                                </span>\r\n                            </span>\r\n                            <!-- ko if: $data.displayMessage -->\r\n                            <span class="message tile">\r\n                                <p data-bind="html: $data.displayMessage" data-swx-testId="displayMessage" class="small"></p>\r\n                            </span>\r\n                            <!-- /ko -->\r\n                        </span>\r\n                </li>\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n    </ul>\r\n</script>\r\n'}),define("ui/components/people/discoverAgentsPage",["require","exports","module","vendor/knockout","constants/cssClasses","ui/viewModels/people/discoverAgentsPage","constants/components","text!views/people/discoverAgentsPage.html"],function(e,t){function s(e,t){var r=new i;return r.setContext(n.dataFor(t.element)),r.init(o(),t.element),r}function o(){return{className:r.discoverAgents.PAGE,isSelectable:!1}}var n=e("vendor/knockout"),r=e("constants/cssClasses"),i=e("ui/viewModels/people/discoverAgentsPage");t.name=e("constants/components").people.DISCOVER_AGENTS_PAGE,t.template=e("text!views/people/discoverAgentsPage.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/people/name",["require","vendor/knockout","ui/viewModels/people/contact","ui/viewModels/people/contactBuilder"],function(e){function s(e){function r(){var e=i.replace(/\{importance\}/g,n.headerImportance());return e.replace("{displayName}",n.contact.displayName())}var n=this;n.contact=o(e),n.headerImportance=t.observable(4),n.heading=t.computed(r)}function o(e){return e instanceof n?e:r.build(e)}var t=e("vendor/knockout"),n=e("ui/viewModels/people/contact"),r=e("ui/viewModels/people/contactBuilder"),i="<h{importance}>{displayName}</h{importance}>";return s.prototype.dispose=function(){this.heading.dispose(),this.contact.dispose()},s}),define("text!views/people/name.html",[],function(){return'<span class="tile" data-bind="css: contact.statusClassName">\r\n    <span class="tileName" data-bind="html: heading"></span>\r\n</span>\r\n'}),define("ui/components/people/name",["require","exports","module","ui/viewModels/people/name","ui/viewModels/people/contact","constants/components","text!views/people/name.html"],function(e,t){function i(e){var t;if(e&&typeof e.person=="object")return t=new n(s(e)),e.headerImportance&&t.headerImportance(e.headerImportance),t;throw new Error('missing parameter: "person"')}function s(e){return e.person instanceof r?e.person.getPerson():e.person}var n=e("ui/viewModels/people/name"),r=e("ui/viewModels/people/contact");t.name=e("constants/components").people.NAME,t.template=e("text!views/people/name.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/people/contactList",["require","lodash-compat","constants/common","cafe/applicationInstance","swx-enums","services/serviceLocator","ui/contextMenu/contextMenu","ui/contextMenu/items/all","ui/contextMenu/menuItemHelper","ui/telemetry/actions/actionSources","ui/viewModels/people/baseList"],function(e){function c(){function c(e){return{source:e,parent:f.searchItem.addressBook}}var e=this,t=l.prototype;l.call(e,i.searchScope.AddressBook),e.search=function(r){return e.contacts([]),t.search.call(e,r)},e.openConversation=function(o){var u=s.resolve(n.serviceLocator.PUBSUB),a=r.get().conversationsManager.getConversation(o.getPerson()),l={source:f.search.reset.openConversation};r.get().conversationsManager.conversations.add(a),u.publish(n.events.search.RESET,l),t.sendOpenConversationEvent.call(e,a)},e.showContextMenu=function(t,r){var i={source:f.searchItem.addressBook},s=c(f.contextMenuItem.block),l=c(f.contextMenuItem.unblock),h=c(f.contextMenuItem.deleteItem),p=[];p.push(a.getConversationContextMenuItemGroup(t,n.telemetry.historyLoadOrigin.CONTACT_SEARCH,i)),p.push(new u.BlockContactMenuItem(t,s)),p.push(new u.UnblockContactMenuItem(t,l)),p.push(new u.DeleteContactMenuItem(t,n.telemetry.historyLoadOrigin.CONTACT_SEARCH,h)),a.sortMenuItems(p),o.show(p,r,i)}}var t=e("lodash-compat"),n=e("constants/common"),r=e("cafe/applicationInstance"),i=e("swx-enums"),s=e("services/serviceLocator"),o=e("ui/contextMenu/contextMenu"),u=e("ui/contextMenu/items/all"),a=e("ui/contextMenu/menuItemHelper"),f=e("ui/telemetry/actions/actionSources"),l=e("ui/viewModels/people/baseList");return c.prototype=t.create(l.prototype,{constructor:c}),c}),define("ui/components/people/peopleSearch",["require","exports","module","ui/viewModels/people/contactList","constants/components","text!views/people/list.html"],function(e,t){function r(){var e=new n;return e.init(),e}var n=e("ui/viewModels/people/contactList");t.name=e("constants/components").people.PEOPLE_SEARCH,t.template=e("text!views/people/list.html"),t.viewModel={createViewModel:r}}),define("ui/components/people/index",["require","ui/components/people/avatar","ui/components/people/avatarDeprecated","ui/components/people/contactListMenuItem","ui/components/people/contactPicker","ui/components/people/contactProfile","ui/components/people/contactProfilePhoneNumber","ui/components/people/contactsPage","ui/components/people/directorySearch","ui/components/people/discoverAgentsPage","ui/components/people/name","ui/components/people/peopleSearch"],function(e){return[e("ui/components/people/avatar"),e("ui/components/people/avatarDeprecated"),e("ui/components/people/contactListMenuItem"),e("ui/components/people/contactPicker"),e("ui/components/people/contactProfile"),e("ui/components/people/contactProfilePhoneNumber"),e("ui/components/people/contactsPage"),e("ui/components/people/directorySearch"),e("ui/components/people/discoverAgentsPage"),e("ui/components/people/name"),e("ui/components/people/peopleSearch")]}),define("experience/components/people",["require","exports","module","ui/components/people/index","ui/components/registrar"],function(e,t){var n=e("ui/components/people/index"),r=e("ui/components/registrar");t.init=function(e){r.register(n),e()}}),define("services/telemetry/common/telemetry",["require","exports","module","services/telemetry/eventBus","services/telemetry/skypeData"],function(e,t){function i(e){return function(t){var n=e?e(t):t;r.push(n)}}var n=e("services/telemetry/eventBus"),r=e("services/telemetry/skypeData");t.instrumentEvent=function(e,t){n.get().subscribe(e,i(t))},t.instrumentAllEvents=function(e){Object.keys(e).forEach(function(n){t.instrumentEvent(n,e[n])})}}),define("services/telemetry/common/instrumentation",["require","lodash-compat","cafe/applicationInstance","swx-enums"],function(e){function i(e){var t={};return Object.keys(e).forEach(function(n){e[n].forEach(function(e){t[e.eventName]=s(e.telemetryName,n,e.extensions,e.newContextIds)})}),t}function s(e,t,n,r){return function(i){var s={type:t,data:{name:e},contextIds:{},isPluginInstalled:u(),mePersonId:a()};return i=i||{},o(i,n,s.data),o(i,r,s.contextIds),s}}function o(e,n,r){function i(t){e[t]!==null&&e[t]!==undefined&&(r[t]=e[t])}if(!n)return;if(typeof n=="function")return t.merge(r,n(e));n.forEach(i)}function u(){return n.get().personsAndGroupsManager&&n.get().personsAndGroupsManager.mePerson?n.get().personsAndGroupsManager.mePerson.capabilities.audio.reason!==r.callingNotSupportedReasons.PluginNotInstalled:"unknown"}function a(){return n.get().personsAndGroupsManager&&n.get().personsAndGroupsManager.mePerson?n.get().personsAndGroupsManager.mePerson.id():"unknown"}var t=e("lodash-compat"),n=e("cafe/applicationInstance"),r=e("swx-enums");return{create:function(e){return i(e)}}}),define("services/telemetry/calling.instrumentation.eventTypes",["require","constants/calling"],function(e){function n(e){return e.isGroupConversation()?"multiparty":"single"}function r(e){return e?"video":"audio"}var t=e("constants/calling");return{Calling:[{eventName:t.EVENTS.START_CALL,telemetryName:"AttemptCall",extensions:function(e){return{source:e.source,conversationType:n(e.conversation),modality:r(e.isVideo)}}},{eventName:t.EVENTS.ANSWER,telemetryName:"AcceptCall",extensions:function(e){return{conversationType:n(e.conversation),modality:r(e.isVideo)}}},{eventName:t.EVENTS.REJECT,telemetryName:"RejectCall",extensions:function(e){return{conversationType:n(e.conversation),modality:r(e.isVideo)}}}],TrouterInit:[{eventName:t.EVENTS.INCOMING_INIT_ERROR,telemetryName:"IncomingInitialisationError"},{eventName:t.EVENTS.INCOMING_INIT_SUCCESS,telemetryName:"IncomingInitialisationSuccess",extensions:["durationInMs"]}]}}),define("text!views/calling/endCallButton.html",[],function(){return'<button data-bind="click: endCall, enable: isCallControlEnabled(), css: { disabled: !isCallControlEnabled() }, l10n_attr: { \'title\': \'callscreen_text_endCall\' }" class="btn small red circle endCall" type="button">\r\n    <span class="iconfont callEnd" data-bind="l10n: { \'key\': \'callscreen_text_endCall\' }"></span>\r\n</button>\r\n'}),define("ui/viewModels/calling/baseCallControlViewModel",["require","vendor/knockout","utils/common/cafeObservable","swx-enums"],function(e){function i(e,i){var o=n.newObservableProperty(e.selfParticipant.audio.state);this.isCallControlEnabled=t.computed(function(){var e=o();return s(e)&&(!i||i())}),this.isCallConnected=t.computed(function(){var e=o();return e===r.callConnectionState.Connected}),this.dispose=function(){o.dispose(),this.isCallControlEnabled.dispose(),this.isCallConnected.dispose()}}function s(e){return e===r.callConnectionState.Connecting||e===r.callConnectionState.Ringing||e===r.callConnectionState.EarlyMedia||e===r.callConnectionState.Connected}var t=e("vendor/knockout"),n=e("utils/common/cafeObservable"),r=e("swx-enums");return i}),define("ui/viewModels/calling/endCallControlViewModel",["require","vendor/knockout","ui/viewModels/calling/baseCallControlViewModel","ui/telemetry/actions/actionNames","constants/common","services/serviceLocator"],function(e){function o(e,o){function u(){var e=s.resolve(i.serviceLocator.ACTION_TELEMETRY),t=o?r.audioVideo.endCall:r.audioVideo.timeline.endCall;e.recordAction(t)}n.call(this,e),this.endCall=function(){e.audioService.stop(),u()},this.isButtonFocused=t.observable(!0)}var t=e("vendor/knockout"),n=e("ui/viewModels/calling/baseCallControlViewModel"),r=e("ui/telemetry/actions/actionNames"),i=e("constants/common"),s=e("services/serviceLocator");return o.prototype=Object.create(n.prototype),o.prototype.constructor=o,{build:function(e,t){return new o(e,t)}}}),define("ui/controls/calling/endCallControl",["require","text!views/calling/endCallButton.html","vendor/knockout","constants/calling","ui/viewModels/calling/endCallControlViewModel"],function(e){var t=e("text!views/calling/endCallButton.html"),n=e("vendor/knockout"),r=e("constants/calling"),i=e("ui/viewModels/calling/endCallControlViewModel");return{name:r.CONTROLS.END_CALL_CONTROL,render:function(e,r){var s,o=document.createElement("div"),u=e.conversation;s=i.build(u),o.innerHTML=t,n.applyBindings(s,o),r(o.firstElementChild)}}}),define("text!views/calling/muteButton.html",[],function(){return'<button data-bind="click: toggleMicrophone, css: { disabled: !isMicrophoneButtonEnabled() }, attr: { title: microphoneStateText(), \'aria-disabled\': isMicrophoneButtonEnabled() }" class="btn small primary circle toggleMic" type="button">\r\n    <span class="iconfont microphoneOn" data-bind="css: { microphoneOff: !isMicrophoneOn() }, text: microphoneStateText"></span>\r\n</button>\r\n'}),define("ui/viewModels/calling/micControlViewModel",["require","ui/viewModels/calling/baseCallControlViewModel","vendor/knockout","utils/common/cafeObservable","swx-i18n","cafe/applicationInstance","utils/common/eventHelper","ui/telemetry/actions/actionNames","constants/common","services/serviceLocator"],function(e){function l(e,l){function v(){var e=f.resolve(a.serviceLocator.ACTION_TELEMETRY),t=l?u.audioVideo.toggleMute:u.audioVideo.timeline.toggleMute;e.recordAction(t)}var c=this,h=r.newObservableProperty(s.get().devicesManager.selectedMicrophone),p=r.newObservableProperty(e.selfParticipant.audio.isMuted),d=r.newObservableProperty(e.selfParticipant.audio.isMuted.set.enabled);t.call(c,e,d),c.isMicrophoneAvailable=n.computed(function(){return h()!==null}),c.isMicrophoneOn=n.computed(function(){return c.isMicrophoneAvailable()&&!p()}),c.microphoneStateText=n.computed(function(){return c.isMicrophoneOn()?i.fetch({key:"callscreen_text_microphoneOff"}):i.fetch({key:"callscreen_text_microphoneOn"})}),c.isMicrophoneButtonEnabled=n.computed(function(){return c.isMicrophoneAvailable()&&c.isCallControlEnabled()}),c.toggleMicrophone=function(t,n){c.isMicrophoneButtonEnabled()&&(e.selfParticipant.audio.isMuted(c.isMicrophoneOn()),v()),o.swallow(n)},c.dispose=function(){h.dispose(),c.microphoneStateText.dispose(),p.dispose()}}var t=e("ui/viewModels/calling/baseCallControlViewModel"),n=e("vendor/knockout"),r=e("utils/common/cafeObservable"),i=e("swx-i18n").localization,s=e("cafe/applicationInstance"),o=e("utils/common/eventHelper"),u=e("ui/telemetry/actions/actionNames"),a=e("constants/common"),f=e("services/serviceLocator");return l.prototype=Object.create(t.prototype),l.prototype.constructor=l,{build:function(e,t){return new l(e,t)}}}),define("ui/controls/calling/micControl",["require","text!views/calling/muteButton.html","vendor/knockout","constants/calling","ui/viewModels/calling/micControlViewModel"],function(e){var t=e("text!views/calling/muteButton.html"),n=e("vendor/knockout"),r=e("constants/calling"),i=e("ui/viewModels/calling/micControlViewModel");return{name:r.CONTROLS.MUTE_CONTROL,render:function(e,r){var s,o=document.createElement("div"),u=e.conversation;s=i.build(u),o.innerHTML=t,n.applyBindings(s,o),r(o.firstElementChild)}}}),define("ui/viewModels/calling/callScreenViewModel/callState",["require","vendor/knockout","swx-enums","constants/calling"],function(e){function s(e){function c(){s.state()===r.ENDING?o=window.setTimeout(h,i):window.clearTimeout(o)}function h(){s.state(r.ENDED)}function p(){s.state(r.CONNECTING)}function d(t,i){if(!i||i===n.callConnectionState.Disconnected)return;e.selfParticipant.audio.state.reason!==n.callDisconnectionReason.CallEscalated?(s.totalCallDuration=s.getCurrentDuration(),s.state(r.ENDING)):s.state(r.ENDED)}function v(){s.state()!==r.EARLY_MEDIA&&s.state(r.CALLING)}function m(){v(),s.state(r.EARLY_MEDIA)}function g(){l=e.audioService.callConnected(),s.state(r.CONNECTED),y()}function y(){x(f),x(a)}function b(e){function t(t,n){var r=e.audio.state.when(t,n);r.participant=e,f.push(r)}t(n.callConnectionState.Ringing,v),t(n.callConnectionState.EarlyMedia,m),t(n.callConnectionState.Disconnected,E)}function w(e){for(var t=f.length;t--;){var n=f[t];n.participant===e&&(f.splice(t,1),n.dispose())}E()}function E(){var t=e.participants().some(function(e){return e.audio.state()===n.callConnectionState.EarlyMedia});s.state()===r.EARLY_MEDIA&&!t&&s.state(r.CALLING)}function S(){u.push(s.state.subscribe(c),e.selfParticipant.audio.state.when(n.callConnectionState.Connecting,p),e.selfParticipant.audio.state.when(n.callConnectionState.Connected,g),e.selfParticipant.audio.state.when(n.callConnectionState.Disconnecting,d),e.selfParticipant.audio.state.when(n.callConnectionState.Disconnected,d)),e.selfParticipant.audio.state()!==n.callConnectionState.Connected&&a.push(e.participants.added(b)),a.push(e.participants.removed(w))}function x(e){e.forEach(function(e){e.dispose()}),e.length=0}var s=this,o,u=[],a=[],f=[],l=null;this.state=t.observable(r.CONNECTING),this.totalCallDuration=null,this.dispose=function(){x(u),y(),window.clearTimeout(o)},this.getCurrentDuration=function(){return l!==null?Date.now()-l:null},S()}var t=e("vendor/knockout"),n=e("swx-enums"),r=e("constants/calling").CALL_STATES,i=3500;return{build:function(e){return new s(e)}}}),define("utils/common/elementQueryHelper",["require","exports","module","browser/window"],function(e,t){var n=e("browser/window"),r={".swx .av":{"max-width":["680px","600px","420px","305px"],"max-height":["600px","480px","420px"]}};t.initialiseSelectors=function(){n.elementQuery&&n.elementQuery(r)},t.refresh=function(){n.elementQuery&&n.elementQuery()}}),define("ui/viewModels/calling/callScreenViewModel/sounds",["require","ui/controls/calling/sounds","constants/calling"],function(e){function i(e){r=e.state.subscribe(function(e){switch(e){case n.CALLING:u();break;case n.EARLY_MEDIA:case n.CONNECTED:case n.ENDED:a();break;case n.ENDING:a(),o()}})}function s(){r.dispose()}function o(){t.playOnce(t.KEYS.CALL_END_CALL)}function u(){t.playOnce(t.KEYS.CALL_OUTGOING_P1,function(){t.playLoop(t.KEYS.CALL_OUTGOING_P2)})}function a(){t.stop(t.KEYS.CALL_OUTGOING_P1),t.stop(t.KEYS.CALL_OUTGOING_P2)}var t=e("ui/controls/calling/sounds"),n=e("constants/calling").CALL_STATES,r;return{init:i,dispose:s}}),function(e,t){function st(e){return G.test(e+"")}function ot(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>i.cacheLength&&delete e[t.shift()],e[n]=r}}function ut(e){return e[y]=!0,e}function at(e){var t=c.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ft(e,t,n,r){var i,s,o,u,a,f,h,v,m,E;(t?t.ownerDocument||t:b)!==c&&l(t),t=t||c,n=n||[];if(!e||typeof e!="string")return n;if((u=t.nodeType)!==1&&u!==9)return[];if(p&&!r){if(i=Y.exec(e))if(o=i[1]){if(u===9){s=t.getElementById(o);if(!s||!s.parentNode)return n;if(s.id===o)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(o))&&g(t,s)&&s.id===o)return n.push(s),n}else{if(i[2])return P.apply(n,t.getElementsByTagName(e)),n;if((o=i[3])&&w.getElementsByClassName&&t.getElementsByClassName)return P.apply(n,t.getElementsByClassName(o)),n}if(w.qsa&&(!d||!d.test(e))){v=h=y,m=t,E=u===9&&e;if(u===1&&t.nodeName.toLowerCase()!=="object"){f=mt(e),(h=t.getAttribute("id"))?v=h.replace(tt,"\\$&"):t.setAttribute("id",v),v="[id='"+v+"'] ",a=f.length;while(a--)f[a]=v+gt(f[a]);m=V.test(e)&&t.parentNode||t,E=f.join(",")}if(E)try{return P.apply(n,m.querySelectorAll(E)),n}catch(S){}finally{h||t.removeAttribute("id")}}}return Nt(e.replace(z,"$1"),t,n,r)}function lt(e,t){var n=t&&e,r=n&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ct(e,n,r){var i;return r?t:(i=e.getAttributeNode(n))&&i.specified?i.value:e[n]===!0?n.toLowerCase():null}function ht(e,n,r){var i;return r?t:i=e.getAttribute(n,n.toLowerCase()==="type"?1:2)}function pt(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function dt(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function vt(e){return ut(function(t){return t=+t,ut(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function mt(e,t){var n,r,s,o,u,a,f,l=T[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=i.preFilter;while(u){if(!n||(r=W.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(s=[]);n=!1;if(r=X.exec(u))n=r.shift(),s.push({value:n,type:r[0].replace(z," ")}),u=u.slice(n.length);for(o in i.filter)(r=Q[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(n=r.shift(),s.push({value:n,type:o,matches:r}),u=u.slice(n.length));if(!n)break}return t?u.length:u?ft.error(e):T(e,a).slice(0)}function gt(e){var t=0,n=e.length,r="";for(;t<n;t++)r+=e[t].value;return r}function yt(e,t,n){var i=t.dir,s=n&&i==="parentNode",o=S++;return t.first?function(t,n,r){while(t=t[i])if(t.nodeType===1||s)return e(t,n,r)}:function(t,n,u){var a,f,l,c=E+" "+o;if(u){while(t=t[i])if(t.nodeType===1||s)if(e(t,n,u))return!0}else while(t=t[i])if(t.nodeType===1||s){l=t[y]||(t[y]={});if((f=l[i])&&f[0]===c){if((a=f[1])===!0||a===r)return a===!0}else{f=l[i]=[c],f[1]=e(t,n,u)||r;if(f[1]===!0)return!0}}}}function bt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function wt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function Et(e,t,n,r,i,s){return r&&!r[y]&&(r=Et(r)),i&&!i[y]&&(i=Et(i,s)),ut(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||Tt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?wt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=wt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?B.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=wt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):P.apply(o,g)})}function St(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[" "],f=o?1:0,l=yt(function(e){return e===t},u,!0),c=yt(function(e){return B.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==a)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;f<s;f++)if(n=i.relative[e[f].type])h=[yt(bt(h),n)];else{n=i.filter[e[f].type].apply(null,e[f].matches);if(n[y]){r=++f;for(;r<s;r++)if(i.relative[e[r].type])break;return Et(f>1&&bt(h),f>1&&gt(e.slice(0,f-1)).replace(z,"$1"),n,f<r&&St(e.slice(f,r)),r<s&&St(e=e.slice(r)),r<s&&gt(e))}h.push(n)}return bt(h)}function xt(e,t){var n=0,s=t.length>0,o=e.length>0,u=function(u,f,l,h,p){var d,v,m,g=[],y=0,b="0",w=u&&[],S=p!=null,x=a,T=u||o&&i.find.TAG("*",p&&f.parentNode||f),N=E+=x==null?1:Math.random()||.1;S&&(a=f!==c&&f,r=n);for(;(d=T[b])!=null;b++){if(o&&d){v=0;while(m=e[v++])if(m(d,f,l)){h.push(d);break}S&&(E=N,r=++n)}s&&((d=!m&&d)&&y--,u&&w.push(d))}y+=b;if(s&&b!==y){v=0;while(m=t[v++])m(w,g,f,l);if(u){if(y>0)while(b--)!w[b]&&!g[b]&&(g[b]=_.call(h));g=wt(g)}P.apply(h,g),S&&!u&&g.length>0&&y+t.length>1&&ft.uniqueSort(h)}return S&&(E=N,a=x),w};return s?ut(u):u}function Tt(e,t,n){var r=0,i=t.length;for(;r<i;r++)ft(e,t[r],n);return n}function Nt(e,t,n,r){var s,o,a,f,l,c=mt(e);if(!r&&c.length===1){o=c[0]=c[0].slice(0);if(o.length>2&&(a=o[0]).type==="ID"&&t.nodeType===9&&p&&i.relative[o[1].type]){t=(i.find.ID(a.matches[0].replace(nt,rt),t)||[])[0];if(!t)return n;e=e.slice(o.shift().value.length)}s=Q.needsContext.test(e)?0:o.length;while(s--){a=o[s];if(i.relative[f=a.type])break;if(l=i.find[f])if(r=l(a.matches[0].replace(nt,rt),V.test(o[0].type)&&t.parentNode||t)){o.splice(s,1),e=r.length&&gt(o);if(!e)return P.apply(n,r),n;break}}}return u(e,c)(r,t,!p,n,V.test(e)),n}function Ct(){}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y="sizzle"+ -(new Date),b=e.document,w={},E=0,S=0,x=ot(),T=ot(),N=ot(),C=!1,k=function(){return 0},L=typeof t,A=1<<31,O=w.hasOwnProperty,M=[],_=M.pop,D=M.push,P=M.push,H=M.slice,B=M.indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},j="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",I="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",q=I.replace("w","w#"),R="\\["+F+"*("+I+")"+F+"*(?:([*^$|!~]?=)"+F+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+q+")|)|)"+F+"*\\]",U=":("+I+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+R.replace(3,8)+")*)|.*)\\)|)",z=new RegExp("^"+F+"+|((?:^|[^\\\\])(?:\\\\.)*)"+F+"+$","g"),W=new RegExp("^"+F+"*,"+F+"*"),X=new RegExp("^"+F+"*([>+~]|"+F+")"+F+"*"),V=new RegExp(F+"*[+~]"),$=new RegExp("="+F+"*([^\\]'\"]*)"+F+"*\\]","g"),J=new RegExp(U),K=new RegExp("^"+q+"$"),Q={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I.replace("w","w*")+")"),ATTR:new RegExp("^"+R),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+F+"*(even|odd|(([+-]|)(\\d*)n|)"+F+"*(?:([+-]|)"+F+"*(\\d+)|))"+F+"*\\)|)","i"),bool:new RegExp("^(?:"+j+")$","i"),needsContext:new RegExp("^"+F+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+F+"*((?:-\\d)?\\d*)"+F+"*\\)|)(?=[^-]|$)","i")},G=/^[^{]+\{\s*\[native \w/,Y=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Z=/^(?:input|select|textarea|button)$/i,et=/^h\d$/i,tt=/'|\\/g,nt=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,rt=function(e,t){var n="0x"+t-65536;return n!==n?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,n&1023|56320)};try{P.apply(M=H.call(b.childNodes),b.childNodes),M[b.childNodes.length].nodeType}catch(it){P={apply:M.length?function(e,t){D.apply(e,H.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}o=ft.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},l=ft.setDocument=function(e){var n=e?e.ownerDocument||e:b;if(n===c||n.nodeType!==9||!n.documentElement)return c;c=n,h=n.documentElement,p=!o(n),w.getElementsByTagName=at(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),w.attributes=at(function(e){return e.className="i",!e.getAttribute("className")}),w.getElementsByClassName=at(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",e.getElementsByClassName("i").length===2}),w.sortDetached=at(function(e){return e.compareDocumentPosition(c.createElement("div"))&1}),w.getById=at(function(e){return h.appendChild(e).id=y,!n.getElementsByName||!n.getElementsByName(y).length}),w.getById?(i.find.ID=function(e,t){if(typeof t.getElementById!==L&&p){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){return e.getAttribute("id")===t}}):(i.find.ID=function(e,n){if(typeof n.getElementById!==L&&p){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==L&&r.getAttributeNode("id").value===e?[r]:t:[]}},i.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=w.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==L)return t.getElementsByTagName(e)}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if(e==="*"){while(n=s[i++])n.nodeType===1&&r.push(n);return r}return s},i.find.CLASS=w.getElementsByClassName&&function(e,t){if(typeof t.getElementsByClassName!==L&&p)return t.getElementsByClassName(e)},v=[],d=[];if(w.qsa=st(n.querySelectorAll))at(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+F+"*(?:value|"+j+")"),e.querySelectorAll(":checked").length||d.push(":checked")}),at(function(e){var t=c.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&d.push("[*^$]="+F+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||d.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),d.push(",.*:")});return(w.matchesSelector=st(m=h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&at(function(e){w.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),v.push("!=",U)}),d=d.length&&new RegExp(d.join("|")),v=v.length&&new RegExp(v.join("|")),g=st(h.contains)||h.compareDocumentPosition?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&r.nodeType===1&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&e.compareDocumentPosition(r)&16)}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},k=h.compareDocumentPosition?function(e,t){if(e===t)return C=!0,0;var r=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t);if(r)return r&1||!w.sortDetached&&t.compareDocumentPosition(e)===r?e===n||g(b,e)?-1:t===n||g(b,t)?1:f?B.call(f,e)-B.call(f,t):0:r&4?-1:1;return e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,s=e.parentNode,o=t.parentNode,u=[e],a=[t];if(e===t)return C=!0,0;if(!s||!o)return e===n?-1:t===n?1:s?-1:o?1:f?B.call(f,e)-B.call(f,t):0;if(s===o)return lt(e,t);r=e;while(r=r.parentNode)u.unshift(r);r=t;while(r=r.parentNode)a.unshift(r);while(u[i]===a[i])i++;return i?lt(u[i],a[i]):u[i]===b?-1:a[i]===b?1:0},c},ft.matches=function(e,t){return ft(e,null,null,t)},ft.matchesSelector=function(e,t){(e.ownerDocument||e)!==c&&l(e),t=t.replace($,"='$1']");if(w.matchesSelector&&p&&(!v||!v.test(t))&&(!d||!d.test(t)))try{var n=m.call(e,t);if(n||w.disconnectedMatch||e.document&&e.document.nodeType!==11)return n}catch(r){}return ft(t,c,null,[e]).length>0},ft.contains=function(e,t){return(e.ownerDocument||e)!==c&&l(e),g(e,t)},ft.attr=function(e,n){(e.ownerDocument||e)!==c&&l(e);var r=i.attrHandle[n.toLowerCase()],s=r&&(O.call(i.attrHandle,n.toLowerCase())?r(e,n,!p):t);return s===t?w.attributes||!p?e.getAttribute(n):(s=e.getAttributeNode(n))&&s.specified?s.value:null:s},ft.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ft.uniqueSort=function(e){var t,n=[],r=0,i=0;C=!w.detectDuplicates,f=!w.sortStable&&e.slice(0),e.sort(k);if(C){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return e},s=ft.getText=function(e){var t,n="",r=0,i=e.nodeType;if(!i)for(;t=e[r];r++)n+=s(t);else if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(i===3||i===4)return e.nodeValue;return n},i=ft.selectors={cacheLength:50,createPseudo:ut,match:Q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(nt,rt),e[3]=(e[4]||e[5]||"").replace(nt,rt),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1].slice(0,3)==="nth"?(e[3]||ft.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(e[3]==="even"||e[3]==="odd")),e[5]=+(e[7]+e[8]||e[3]==="odd")):e[3]&&ft.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return Q.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&J.test(n)&&(t=mt(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(nt,rt).toLowerCase();return e==="*"?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=x[e+" "];return t||(t=new RegExp("(^|"+F+")"+e+"("+F+"|$)"))&&x(e,function(e){return t.test(typeof e.className=="string"&&e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=ft.attr(r,e);return i==null?t==="!=":t?(i+="",t==="="?i===n:t==="!="?i!==n:t==="^="?n&&i.indexOf(n)===0:t==="*="?n&&i.indexOf(n)>-1:t==="$="?n&&i.slice(-n.length)===n:t==="~="?(" "+i+" ").indexOf(n)>-1:t==="|="?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s=e.slice(0,3)!=="nth",o=e.slice(-4)!=="last",u=t==="of-type";return r===1&&i===0?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),b=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:c.nodeType===1)return!1;d=v=e==="only"&&!d&&"nextSibling"}return!0}d=[o?m.firstChild:m.lastChild];if(o&&b){l=m[y]||(m[y]={}),f=l[e]||[],p=f[0]===E&&f[1],h=f[0]===E&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(c.nodeType===1&&++h&&c===t){l[e]=[E,p,h];break}}else if(b&&(f=(t[y]||(t[y]={}))[e])&&f[0]===E)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:c.nodeType===1)&&++h){b&&((c[y]||(c[y]={}))[e]=[E,h]);if(c===t)break}return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||ft.error("unsupported pseudo: "+e);return r[y]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?ut(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=B.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:ut(function(e){var t=[],n=[],r=u(e.replace(z,"$1"));return r[y]?ut(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:ut(function(e){return function(t){return ft(e,t).length>0}}),contains:ut(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),lang:ut(function(e){return K.test(e||"")||ft.error("unsupported lang: "+e),e=e.replace(nt,rt).toLowerCase(),function(t){var n;do if(n=p?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||n.indexOf(e+"-")===0;while((t=t.parentNode)&&t.nodeType===1);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===c.activeElement&&(!c.hasFocus||c.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||e.nodeType===3||e.nodeType===4)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return et.test(e.nodeName)},input:function(e){return Z.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},text:function(e){var t;return e.nodeName.toLowerCase()==="input"&&e.type==="text"&&((t=e.getAttribute("type"))==null||t.toLowerCase()===e.type)},first:vt(function(){return[0]}),last:vt(function(e,t){return[t-1]}),eq:vt(function(e,t,n){return[n<0?n+t:n]}),even:vt(function(e,t){var n=0;for(;n<t;n+=2)e.push(n);return e}),odd:vt(function(e,t){var n=1;for(;n<t;n+=2)e.push(n);return e}),lt:vt(function(e,t,n){var r=n<0?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:vt(function(e,t,n){var r=n<0?n+t:n;for(;++r<t;)e.push(r);return e})}};for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[n]=pt(n);for(n in{submit:!0,reset:!0})i.pseudos[n]=dt(n);u=ft.compile=function(e,t){var n,r=[],i=[],s=N[e+" "];if(!s){t||(t=mt(e)),n=t.length;while(n--)s=St(t[n]),s[y]?r.push(s):i.push(s);s=N(e,xt(i,r))}return s},i.pseudos.nth=i.pseudos.eq,Ct.prototype=i.filters=i.pseudos,i.setFilters=new Ct,w.sortStable=y.split("").sort(k).join("")===y,l(),[0,0].sort(k),w.detectDuplicates=C,at(function(e){e.innerHTML="<a href='#'></a>";if(e.firstChild.getAttribute("href")!=="#"){var t="type|href|height|width".split("|"),n=t.length;while(n--)i.attrHandle[t[n]]=ht}}),at(function(e){if(e.getAttribute("disabled")!=null){var t=j.split("|"),n=t.length;while(n--)i.attrHandle[t[n]]=ct}}),e.Sizzle=ft}(window),define("sizzle",function(){}),function(e,t,n){var r=e.Sizzle||jQuery.find,i={},s=null,o=function(){if(t.styleSheets[0]){try{t.styleSheets[0].cssRules}catch(e){return}s=t.styleSheets[0].cssRules!==n?"cssRules":"rules"}},u=function(e,t,s,o,u){e=c(e);if(e!=""){var a;!o&&!u&&(a=/^([0-9]*.?[0-9]+)(px|em)$/.exec(s),a!=null&&(o=Number(a[1]),o+""!="NaN"&&(u=a[2]))),u&&(r.compile&&r.compile(e),i[e]===n&&(i[e]={}),i[e][t]===n&&(i[e][t]={}),i[e][t][s]=[o,u])}},a=function(e,t){var n,r,i;for(n in e)for(r in e[n])if(typeof e[n][r]=="string")u(n,r,e[n][r]);else if(typeof e[n][r]=="object")for(i=0;i<e[n][r].length;i++)u(n,r,e[n][r][i]);t==1&&m()},f=function(e){if(e){var t=/(\[(min\-width|max\-width|min\-height|max\-height)\~\=(\'|\")([0-9]*.?[0-9]+)(px|em)(\'|\")\])(\[(min\-width|max\-width|min\-height|max\-height)\~\=(\'|\")([0-9]*.?[0-9]+)(px|em)(\'|\")\])?/gi,r=e.split(","),i,s,o,a,f,l,c,h;for(i=0;i<r.length;i++){s=null,f=0,l=0;while(l==0||o!=null)o=t.exec(r[i]),o!=null&&(a=Number(o[4]),a+""!="NaN"&&(s==null&&(s=r[i].substring(f,o.index),c=r[i].substring(o.index+o[1].length),c.length>0&&(h=c.indexOf(" "),h!=0&&(h>0&&(c=c.substring(0,h)),c=c.replace(/(\[(min\-width|max\-width|min\-height|max\-height)\~\=(\'|\")([0-9]*.?[0-9]+)(px|em)(\'|\")\])/gi,""),s+=c))),u(s,o[2],o[4]+o[5],a,o[5])),o[7]===n||o[7]==""?(f=o.index+o[1].length,s=null):t.lastIndex=o.index+o[1].length),l++}}},l=function(e,t){s==null&&o();try{e[s].length}catch(n){return}if(e[s]&&e[s].length>0){var r=e.ownerNode||e.owningElement;if(t||r.getAttribute("data-elementquery-bypass")===null&&r.getAttribute("data-elementquery-processed")===null){var i,u,a;for(i=0;i<e[s].length;i++){a=e[s][i];if(a[s]&&a[s].length>0)for(u=0;u<a[s].length;u++)f(a[s][u].selectorText);else f(a.selectorText)}r.setAttribute("data-elementquery-processed","")}}},c=function(e){if(e==null)return"";var t="".trim;return t&&!t.call("﻿ ")?t.call(e):(e+"").replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},h=function(e,t){var n=e.getAttribute(t);return n?(" "+n+" ").replace(/[\t\r\n]/g," "):" "},p=function(e,t,n){if(e.nodeType===1){var r=c(n);if(r!=""){var i=h(e,t);i.indexOf(" "+r+" ")<0&&e.setAttribute(t,c(i+r))}}},d=function(e,t,n){if(e.nodeType===1){var r=c(n);if(r!=""){var i=h(e,t),s=!1;while(i.indexOf(" "+r+" ")>=0)i=i.replace(" "+r+" "," "),s=!0;s&&e.setAttribute(t,c(i))}}},v=function(){var e;for(e=0;e<t.styleSheets.length;e++)l(t.styleSheets[e]);m()},m=function(){var n,s,o,u,a,f,l;for(n in i){a=r(n);if(a.length>0)for(s=0;s<a.length;s++){f=a[s];for(o in i[n])for(u in i[n][o])l=i[n][o][u][0],i[n][o][u][1]=="em"&&(l*=e.getEmPixels?getEmPixels(f):16),o=="min-width"&&f.offsetWidth>=l||o=="max-width"&&f.offsetWidth<=l||o=="min-height"&&f.offsetHeight>=l||o=="max-height"&&f.offsetHeight<=l?p(f,o,u):d(f,o,u)}}if(!e.addEventListener&&e.attachEvent){var c=t.documentElement.className;t.documentElement.className=" "+c,t.documentElement.className=c}};e.elementQuery=function(e,t){e&&typeof e=="object"?e.cssRules||e.rules?(l(e,!0),t==1&&m()):a(e,t):!e&&!t&&m()},e.elementQuery.selectors=function(){var e={},t,r,s;for(t in i)for(r in i[t])for(s in i[t][r])e[t]===n&&(e[t]={}),e[t][r]===n&&(e[t][r]=[]),e[t][r][e[t][r].length]=s;return e},e.addEventListener?(e.addEventListener("resize",m,!1),e.addEventListener("DOMContentLoaded",v,!1),e.addEventListener("load",v,!1)):e.attachEvent&&(e.attachEvent("onresize",m),e.attachEvent("onload",v))}(this,document,undefined),function(e,t){var n="!important;",r="position:absolute"+n+"visibility:hidden"+n+"width:1em"+n+"font-size:1em"+n+"padding:0"+n;window.getEmPixels=function(i){var s;i||(i=s=e.createElement("body"),s.style.cssText="font-size:1em"+n,t.insertBefore(s,e.body));var o=e.createElement("i");o.style.cssText=r,i.appendChild(o);var u=o.clientWidth;return s?t.removeChild(s):i.removeChild(o),u}}(document,document.documentElement),define("elementQuery",["sizzle"],function(){}),define("ui/viewModels/calling/callScreenViewModel/callScreenViewModel",["require","lodash-compat","ui/telemetry/actions/actionNames","browser/detect","utils/common/cafeObservable","constants/calling","constants/calling","ui/modelHelpers/conversationHelper","constants/common","ui/viewModels/calling/callScreenViewModel/callState","utils/common/eventMixin","utils/common/elementQueryHelper","swx-i18n","vendor/knockout","browser/window","services/pubSub/pubSub","ui/viewModels/calling/callScreenViewModel/sounds","services/serviceLocator","constants/common","elementQuery"],function(e){function S(e){function C(){A(),S=null}function k(e){var t=g.resolve(a.serviceLocator.ACTION_TELEMETRY),r=e?n.audioVideo.submitParticipantsInGroup:n.audioVideo.submitParticipantsIn1to1;t.recordAction(r)}function L(){var e=!0;l.addParticipantMode(e),l.dispatchEvent(a.events.callScreen.ADD_PARTICIPANT_VISIBLE,e,l.DIRECTION.CHILD)}function A(){var e=!1;l.addParticipantMode(e),l.dispatchEvent(a.events.callScreen.ADD_PARTICIPANT_VISIBLE,e,l.DIRECTION.CHILD)}function O(){l.dispatchEvent(a.events.callScreen.SIDEBAR_TOGGLED,l.DIRECTION.CHILD),c.refresh()}function M(e){e?l.handleMouseOver():l.handleMouseLeave()}function _(){l.addClassToShowSidebar()?(v.publish(E.HIDE_SIDEBAR),l.addClassToShowSidebar(!1),l.addClassToHideSidebar(!0)):(v.publish(E.SHOW_SIDEBAR),l.addClassToShowSidebar(!0),l.addClassToHideSidebar(!1)),P()}function D(e){l.isContainerFullScreen(e),c.refresh(),e&&t&&l.bottomValueInPixels(t)}function P(){d.setTimeout(c.refresh,1e3)}function H(e){switch(e){case s.CALLING:case s.EARLY_MEDIA:_(),c.refresh();break;case s.ENDED:j()}}function B(e){l.isConversationVisible(e),e&&c.refresh()}function j(){v.publish(E.SHOW_SIDEBAR),l.dispatchEvent(o.EVENTS.CALL_SCREEN_CLOSE,l.DIRECTION.PARENT),l.dispose()}function F(){b=d.setTimeout(q,w)}function I(){d.clearTimeout(b)}function q(){l.controlsVisible(!1)}function R(){l.controlsVisible()||(l.controlsVisible(!0),l.dispatchEvent(a.events.callScreen.CONTROLS_VISIBLE,!0,l.DIRECTION.CHILD))}function U(){function t(){return e.autoCall&&e.autoCall()}function n(){return T()===s.CONNECTING&&!t()}function r(){return t()&&T()===s.CONNECTING||T()===s.CALLING||T()===s.EARLY_MEDIA}return{connecting:n(),calling:r(),connected:T()===s.CONNECTED,ended:T()===s.ENDED,ending:T()===s.ENDING,showControls:l.controlsVisible(),hideControls:!l.controlsVisible()}}function z(e){return e<6e4?h.fetch({key:"callscreen_text_statusMessageScreenReaderEnding_less_than_minute"}):h.fetch({key:"callscreen_text_statusMessageScreenReaderEnding_minutes",count:Math.floor(e/1e3/60)})}var t,l=this,S,x=f.build(e),T=x.state,N=g.resolve(y.FEATURE_FLAGS);this.callScreenStrings={CONNECTING:h.fetch({key:"callscreen_text_statusMessageConnecting"}),CALLING:h.fetch({key:"callscreen_text_statusMessageCalling"}),ENDED:h.fetch({key:"callscreen_text_terminationMessage"}),CONTROLS_ANIMATION_NAME:"av-controls-hide"},this.conversation=e,this.callingState=x,this.isContainerFullScreen=p.observable(!1),this.bottomValueInPixels=p.observable("0%"),this.avatarUrl=i.newObservableProperty(e.avatarUrl),this.addClassToShowSidebar=p.observable(!0),this.addClassToHideSidebar=p.observable(!1),this.controlsVisible=p.observable(!0),this.isConversationVisible=p.observable(!0),this.isResizeVisible=N.isFeatureOn(o.FEATURE_FLAGS.RESIZE_CALL_AND_CHAT),this.footerButtonsWidth=p.observable(0),this.addParticipantMode=p.observable(!1),this.addParticipantsTitle=h.fetch({key:"button_text_addParticipants"}),this.cancelAddParticipantsTitle=h.fetch({key:"button_text_cancelAddParticipants"}),this.setParticipantProvider=function(e){S=e},this.submitSelectedParticipants=function(){var t=S.selectedContacts;t().length>0&&(e.isGroupConversation()||l.dispatchEvent(a.events.callScreen.CALL_ESCALATED_TO_GROUP,!0,l.DIRECTION.CHILD),k(e.isGroupConversation()),u.addPersonsToConversation(t(),e)),C()},this.undoSelectedParticipants=C,this.callStatusScreenReader=p.computed(function(){var t=T();if(t===s.ENDING)return z(x.totalCallDuration);if(t===s.CONNECTING)return h.fetch({key:"callscreen_text_statusMessageScreenReaderConnecting",params:{contactName:e.topic()}})}),this.mainClass=p.computed(U),this.isContainerFullScreen.subscribe(function(e){v.publish(o.EVENTS.FULLSCREEN_CHANGED,e)}),this.handleMouseLeave=function(){T()===s.CONNECTED&&F()},this.handleMouseOver=function(){T()===s.CONNECTED&&(I(),R())},this.handleAnimationEnded=function(e,t){var n=t&&t.originalEvent&&t.originalEvent.animationName&&t.originalEvent.animationName.search(l.callScreenStrings.CONTROLS_ANIMATION_NAME)>-1||t&&t.animationName&&t.animationName.search(l.callScreenStrings.CONTROLS_ANIMATION_NAME)>-1;n&&l.dispatchEvent(a.events.callScreen.CONTROLS_VISIBLE,!1,l.DIRECTION.CHILD)},this.init=function(){m.init(x),T.subscribe(H),l.registerEvent(a.events.callScreen.ADD_PARTICIPANT,L),l.forwardEvent(a.events.roster.ROSTER_QUERY_CHANGED),l.forwardEvent(a.events.roster.ROSTER_QUERY_EXECUTED),l.forwardEvent(a.events.roster.ROSTER_SELECTION_REMOVED),l.forwardEvent(a.events.roster.PICKER_CONTACT_SELECTED),l.forwardEvent(a.events.roster.PICKER_CONTACT_DESELECTED),l.registerEvent(a.events.callScreen.BUTTONS_WIDTH_CHANGED,l.footerButtonsWidth.bind(l)),l.registerEvent(a.events.callScreen.TOGGLE_NARROW_MENU,_),l.registerEvent(a.events.callScreen.BUTTON_FOCUSED,M),l.forwardEvent(a.events.callScreen.TOGGLE_FULLSCREEN,l.DIRECTION.CHILD,D),l.forwardEvent(a.events.navigation.FRAGMENT_SHOW,l.DIRECTION.CHILD,B.bind(l,!0)),l.forwardEvent(a.events.navigation.FRAGMENT_BEFORE_HIDE,l.DIRECTION.CHILD,B.bind(l,!1)),r.getBrowserInfo().browserName===r.BROWSERS.SKYPE_SHELL&&l.isContainerFullScreen(!0),e.autoCall&&e.autoCall()&&l.isContainerFullScreen(!0),A(),c.refresh(),v.subscribe(E.SIDEBAR_TRANSITION_ENDED,O)},this.dispose=function(){m.dispose(),l.isContainerFullScreen(!1),x.dispose(),l.mainClass.dispose(),l.callStatusScreenReader.dispose(),v.unsubscribe(E.SIDEBAR_TRANSITION_ENDED,O)}}var t=e("lodash-compat"),n=e("ui/telemetry/actions/actionNames"),r=e("browser/detect"),i=e("utils/common/cafeObservable"),s=e("constants/calling").CALL_STATES,o=e("constants/calling"),u=e("ui/modelHelpers/conversationHelper"),a=e("constants/common"),f=e("ui/viewModels/calling/callScreenViewModel/callState"),l=e("utils/common/eventMixin"),c=e("utils/common/elementQueryHelper"),h=e("swx-i18n").localization,p=e("vendor/knockout"),d=e("browser/window"),v=e("services/pubSub/pubSub"),m=e("ui/viewModels/calling/callScreenViewModel/sounds"),g=e("services/serviceLocator"),y=e("constants/common").serviceLocator;e("elementQuery");var b,w=2e3,E=a.events.narrowMode;return t.assign(S.prototype,l),{build:function(e){return new S(e)}}}),define("text!views/calling/callScreen.html",[],function(){return'<div class="av themeDark" data-bind="\r\n    css: { fullscreen: isContainerFullScreen(), isHidden: !isConversationVisible(), showSidebar: addClassToShowSidebar(), hideSidebar: addClassToHideSidebar() },\r\n    style: { bottom: bottomValueInPixels() },\r\n    event: {\r\n        mouseout: handleMouseLeave, mouseover: handleMouseOver,\r\n        webkitAnimationEnd: handleAnimationEnded, animationend: handleAnimationEnded, oanimationend: handleAnimationEnded, MSAnimationEnd: handleAnimationEnded\r\n    }">\r\n\r\n    <div class="main animate" data-bind="css: mainClass">\r\n\r\n        <div class="top">\r\n            <!-- ko component: { name: "swx-call-header", params: { state: callingState, conversation: conversation, callScreenStrings: callScreenStrings } } --><!-- /ko -->\r\n        </div>\r\n\r\n        <!-- ko if: addParticipantMode() -->\r\n        <div class="contactPickerWrapper">\r\n            <div class="headerAdd">\r\n                <swx-contact-picker-input params="setParticipantProvider: setParticipantProvider"></swx-contact-picker-input>\r\n            </div>\r\n            <swx-contact-picker params="conversation: conversation, className: \'addToCallPicker\'"></swx-contact-picker>\r\n            <div class="actions">\r\n                <div class="submitConversation">\r\n                    <swx-button params="cssClass: \'secondary circle\', textKey: \'button_text_cancelAddParticipants\', i18nTitle: cancelAddParticipantsTitle, action: undoSelectedParticipants, tabindex:10600"></swx-button>\r\n                    <swx-button params="cssClass: \'primary circle\', textKey: \'button_text_addParticipants\', i18nTitle: addParticipantsTitle, action: submitSelectedParticipants, tabindex:10601"></swx-button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <div class="table" data-bind="css: {invisible: addParticipantMode()}">\r\n            <div class="cell">\r\n                <swx-call-animation params="onAnimationIteration: function() {}, onAnimationEnded: function() {}, avatarUrl: $data.avatarUrl, isGroupConversation: conversation.isGroupConversation()"></swx-call-animation>\r\n                <swx-loading-animation class="spinner white"></swx-loading-animation>\r\n            </div>\r\n        </div>\r\n\r\n        <swx-call-content  data-bind="css: {invisible: addParticipantMode()}" params="callState: callingState, conversation: conversation, footerButtonsWidth: footerButtonsWidth"></swx-call-content>\r\n\r\n\r\n        <div class="bottom" data-bind="css: {invisible: addParticipantMode()}">\r\n            <swx-call-footer params="conversation: conversation"></swx-call-footer>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="background">\r\n        <span class="connecting"></span>\r\n        <span class="connected"></span>\r\n    </div>\r\n\r\n    <div aria-live="polite" role="status" class="offScreen" data-bind="text: callStatusScreenReader"></div>\r\n</div>\r\n'}),define("ui/components/calling/callScreen",["require","exports","module","vendor/knockout","ui/viewModels/calling/callScreenViewModel/callScreenViewModel","constants/components","text!views/calling/callScreen.html"],function(e,t){function i(e,t){var i=r.build(e.conversation);return i.setContext(n.dataFor(t.element)),i.init(),i}var n=e("vendor/knockout"),r=e("ui/viewModels/calling/callScreenViewModel/callScreenViewModel");t.name=e("constants/components").calling.CALL_SCREEN,t.template=e("text!views/calling/callScreen.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/calling/callScreenViewModel/participantViewModel",["require","exports","module","lodash-compat","vendor/knockout","swx-enums","constants/common","constants/calling","constants/keys","utils/common/eventMixin","ui/telemetry/actions/actionNames","services/serviceLocator"],function(e,t){function c(e){function E(e){!t.isScreenSharing&&t.isGroupConversation&&g&&A(g,!!e)}function S(e){e&&t.isZoomedIn()&&t.isZoomedIn(!1)}function x(){t.videoIsAllowed()&&t.dispatchEvent(s.events.callScreen.VIDEO_ZOOMED_IN,t.isZoomedIn(),t.DIRECTION.PARENT)}function T(e){t.videoIsAllowed()&&(D(t.videoElement()),t.dispatchEvent(s.events.callScreen.VIDEO_STATE_CHANGED,e,t.DIRECTION.PARENT),t.isSelfParticipant||t.isZoomedIn(e===i.mediaStreamState.Active))}function N(e){D(e?t.videoElement():null)}function C(e){var n=e===i.callConnectionState.Connecting||e===i.callConnectionState.Ringing,r=e===i.callConnectionState.Disconnecting||e===i.callConnectionState.Disconnected;t.isConnecting(n),t.isDisconnecting(r)}function k(n){e.isGroupConversation&&n.audio.isSpeaking.changed(t.isSpeaking),n.audio.state.changed(C),n.video.channels.added(O),n.video.channels.removed(M),t.isScreenSharing&&_(n.screenSharing.stream),v=t.videoElement.subscribe(D)}function L(n){!n||(n.audio.state.changed.off(C),n.video.channels.added.off(O),n.video.channels.removed.off(M),e.isGroupConversation&&n.audio.isSpeaking.changed.off(t.isSpeaking),a&&(a.state.changed.off(c),H()))}function A(e,t){e.isStarted()!==t&&e.isStarted.set.enabled()&&e.isStarted(t)}function O(e){g=e,t.isScreenSharing||(!t.isSelfParticipant&&t.isGroupConversation&&A(g,t.videoIsAllowed()),_(g.stream))}function M(){t.dispose()}function _(e){a=e,D(t.videoElement()),P(a),a.state.changed(c)}function D(e){if(a){var t=c()!==i.mediaStreamState.Stopped?e||null:null;a.source.sink.container()!==t&&a.source.sink.container(t)}}function P(e){b=e.width.changed(function(){j(e)}),w=e.height.changed(function(){j(e)})}function H(){b&&b.dispose(),w&&w.dispose()}function B(e){var t=(e.width()/e.height()).toFixed(2);switch(t){case"1.78":n(o.CLASSES.ASPECT_RATIO_16BY9);break;default:n(o.CLASSES.ASPECT_RATIO_4BY3)}}function j(e){t.videoIsAllowed()&&t.dispatchEvent(s.events.callScreen.VIDEO_SIZE_CHANGED,null,t.DIRECTION.PARENT),e.width()&&e.height()&&B(e)}function F(e){return e.keyCode||e.which}var t=this,n=r.observable(o.CLASSES.ASPECT_RATIO_1BY1),a,c=r.observable(),h,p,d,v,m,g,y,b,w;t.participant=r.observable(),t.isSelfParticipant=Boolean(e.isSelfParticipant),t.isGroupConversation=Boolean(e.isGroupConversation),t.isScreenSharing=Boolean(e.isScreenSharing),t.videoIsAllowed=e.videoIsAllowed,t.isVisible=e.isVisible,t.isZoomedIn=r.observable(!1),t.videoElement=r.observable(),t.isSpeaking=r.observable(!1),t.isFocused=r.observable(),t.avatarVisible=r.computed(function(){return!!t.participant()&&(!t.videoIsAllowed()||c()===i.mediaStreamState.Stopped)}),t.isVideoLoading=r.computed(function(){return!!t.participant()&&t.videoIsAllowed()&&(c()===i.mediaStreamState.Started||c()===i.mediaStreamState.Inactive)}),t.isVideoActive=r.computed(function(){return!!t.participant()&&t.videoIsAllowed()&&c()===i.mediaStreamState.Active}),t.cssClasses=r.computed(function(){var e=[];return t.isVideoLoading()||t.isVideoActive()?(e.push(o.CLASSES.VIDEO_ON),e.push(n())):e.push(o.CLASSES.ASPECT_RATIO_1BY1),t.isSelfParticipant&&e.push(o.CLASSES.LOCAL_PIP),e.join(" ")}),t.isConnecting=r.observable(!1),t.isDisconnecting=r.observable(!1),t.init=function(){p=t.participant.subscribe(k),d=t.participant.subscribe(L,this,"beforeChange"),m=t.isVisible.subscribe(N),t.participant(e.participant),t.isVisible(e.isVisible),h=c.subscribe(T),t.avatarVisible.subscribe(S),t.isZoomedIn.subscribe(x),y=t.videoIsAllowed.subscribe(E)},t.toggleZoom=function(){var e=l.resolve(s.serviceLocator.ACTION_TELEMETRY);t.isZoomedIn(!t.isZoomedIn()),e.recordAction(f.audioVideo.zoomInOut)},t.onZoomToggleKeyUp=function(e,n){var r=F(n);return r===u.TAB&&t.isFocused(!0),!0},t.onZoomToggleKeyDown=function(e,n){var r=F(n);return(r===u.ENTER||r===u.SPACE)&&t.toggleZoom(),r===u.TAB&&t.isFocused(!1),!0},t.onZoomToggleBlur=function(){t.isFocused(!1)},t.dispose=function(){L(t.participant()),E(!1),g&&((t.isSelfParticipant||t.isGroupConversation)&&A(g,!1),g=null),a&&(a.source.sink.container(null),a.state.changed.off(c),a=null),v&&v.dispose(),h&&h.dispose(),p&&p.dispose(),d&&d.dispose(),m&&m.dispose(),y&&y.dispose(),t.avatarVisible.dispose(),t.isVideoLoading.dispose()}}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("swx-enums"),s=e("constants/common"),o=e("constants/calling"),u=e("constants/keys"),a=e("utils/common/eventMixin"),f=e("ui/telemetry/actions/actionNames"),l=e("services/serviceLocator");n.assign(c.prototype,a),t.build=function(e){return new c(e)}}),define("text!views/calling/participant.html",[],function(){return'<div class="participant-wrapper" data-bind="css: cssClasses">\r\n\r\n    <div class="participant" data-bind="css: { self: isSelfParticipant}">\r\n\r\n        <div class="videoElement" data-bind="getElement: videoElement, css: { videoActive: isVideoActive()}">\r\n            <a class="button" data-bind="event: { dblclick: toggleZoom, keyup: onZoomToggleKeyUp, keydown: onZoomToggleKeyDown, blur: onZoomToggleBlur }, visible: !avatarVisible(), css: { zoomedIn: isZoomedIn, focused: isFocused }, l10n_attr: { \'title\': \'callscreen_title_zoom\' }"></a>\r\n        </div>\r\n\r\n        <!-- ko if: !isSelfParticipant -->\r\n        <div class="avatar" data-bind="visible: avatarVisible()">\r\n            <swx-avatar-deprecated params="avatar: participant().person.avatarUrl()"></swx-avatar-deprecated>\r\n            <div class="overlay" data-bind="visible: isConnecting() || isDisconnecting() || isVideoLoading()"></div>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: isGroupConversation && !isSelfParticipant && !isScreenSharing -->\r\n        <swx-participant-menu params="person: participant().person"></swx-participant-menu>\r\n\r\n        <div class="participantStateIcon" data-bind="visible: isConnecting() || isDisconnecting()">\r\n            <span class="iconfont callIn white" data-bind="css: { callIn: isConnecting(), callEnd: isDisconnecting()}"></span>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <swx-loading-animation class="spinner white" data-bind="visible: isVideoLoading()"></swx-loading-animation>\r\n\r\n        <!-- ko if: isSpeaking -->\r\n        <div class="speakingIndicator"></div>\r\n        <!-- /ko -->\r\n\r\n    </div>\r\n\r\n</div>\r\n'}),define("ui/components/calling/participant",["require","exports","module","vendor/knockout","ui/viewModels/calling/callScreenViewModel/participantViewModel","constants/components","text!views/calling/participant.html"],function(e,t){function i(e,t){var i=r.build(e),s=n.contextFor(t.element).$parent;return i.setContext(s),i.init(),i}var n=e("vendor/knockout"),r=e("ui/viewModels/calling/callScreenViewModel/participantViewModel");t.name=e("constants/components").calling.PARTICIPANT,t.template=e("text!views/calling/participant.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/people/contactName",["require","lodash-compat","vendor/knockout","utils/common/eventMixin","ui/viewModels/people/properties/displayNameText"],function(e){function s(e){var t=this,r=i.build(e);t.displayName=n.computed(r.compute),t.getPerson=function(){return e},t.dispose=function(){t.displayName.dispose(),r.dispose()}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/eventMixin"),i=e("ui/viewModels/people/properties/displayNameText");return t.assign(s.prototype,r),s}),define("text!views/calling/participantMenu.html",[],function(){return'<div class="participantMenuPill">\r\n    <div class="wrapper">\r\n        <button class="btn primary" type="button" data-bind="attr: { title: displayName }">\r\n            <span class="menu" data-bind="text: displayName"></span>\r\n        </button>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/calling/participantMenu",["require","exports","module","vendor/knockout","ui/viewModels/people/contactName","constants/components","text!views/calling/participantMenu.html"],function(e,t){function i(e,t){var i=new r(e.person()),s=n.contextFor(t.element).$parent;return i.setContext(s),i}var n=e("vendor/knockout"),r=e("ui/viewModels/people/contactName");t.name=e("constants/components").calling.PARTICIPANT_MENU,t.template=e("text!views/calling/participantMenu.html"),t.viewModel={createViewModel:i}}),define("jsviews/calling/roster",["require","constants/common","browser/window"],function(e){function s(e){var s;this.getRosterWidth=function(){return e.querySelector(t).offsetWidth+n},this.init=function(e){s=e,i.addEventListener(r.events.browser.RESIZE,s)},this.dispose=function(){i.removeEventListener(r.events.browser.RESIZE,s)}}var t=".participants",n=50,r=e("constants/common"),i=e("browser/window");return{build:function(e){return new s(e)}}}),define("ui/viewModels/calling/callScreenViewModel/rosterViewModel",["require","lodash-compat","vendor/knockout","constants/common","swx-enums","browser/window","utils/common/eventMixin","utils/common/async","utils/common/scroll"],function(e){function f(e,t){function v(){u.execute(function(){d||o.dispatchEvent(r.events.callScreen.ROSTER_WIDTH_CHANGED,p.getRosterWidth(),o.DIRECTION.PARENT)})}var o=this,f,l,c,h,p,d=!1;o.participants=e.participants,o.isGroupConversation=e.isGroupConversation,o.selfParticipant=e.selfParticipant,o.isLocalVideoOn=e.isLocalVideoOn,o.localAspectRatio=n.observable(""),o.isVisible=e.isVisible,o.isLocalVideoAllowed=e.isLocalVideoAllowed,o.disposed=!1,o.init=function(e){p=e,p.init(v),f=a.build(t),f.init({horizontal:!0}),l=o.participants.subscribe(v),c=o.isLocalVideoOn.subscribe(v),h=o.selfParticipant.audio.state.when(i.callConnectionState.Connected,v)},o.dispose=function(){d=!0,p.dispose(),f.dispose(),l.dispose(),c.dispose(),h.dispose(),s.removeEventListener(r.events.browser.RESIZE,v)}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("constants/common"),i=e("swx-enums"),s=e("browser/window"),o=e("utils/common/eventMixin"),u=e("utils/common/async"),a=e("utils/common/scroll");return t.assign(f.prototype,o),{build:function(e,t){return new f(e,t)}}}),define("text!views/calling/roster.html",[],function(){return'<div class="roster">\r\n    <div class="participants">\r\n\r\n        <div class="scrollWrapper">\r\n            <div class="others scrollViewport scrollViewportH"\r\n                data-bind="visible: participants().length, overflowClass: { right: \'partially-hidden\' }, css: {videoActive: isLocalVideoOn()}" tabindex="-1">\r\n\r\n                <!-- ko foreach: participants -->\r\n                <swx-call-participant params="participant: $data.participant,\r\n                                        videoIsAllowed: $data.videoIsAllowed,\r\n                                        aspectRatio: $data.aspectRatio,\r\n                                        isGroupConversation: $parent.isGroupConversation,\r\n                                        isVisible: $parent.isVisible,\r\n                                        isScreenSharing: $data.isScreenSharing">\r\n                </swx-call-participant>\r\n                <!-- /ko -->\r\n\r\n            </div>\r\n        </div>\r\n\r\n        <swx-call-participant params="participant: selfParticipant,\r\n                                  isGroupConversation: isGroupConversation,\r\n                                  videoIsAllowed: isLocalVideoAllowed,\r\n                                  aspectRatio: localAspectRatio,\r\n                                  isVisible: isVisible,\r\n                                  isSelfParticipant: true">\r\n        </swx-call-participant>\r\n\r\n    </div>\r\n</div>\r\n'}),define("ui/components/calling/roster",["require","exports","module","vendor/knockout","jsviews/calling/roster","ui/viewModels/calling/callScreenViewModel/rosterViewModel","constants/components","text!views/calling/roster.html"],function(e,t){function s(e,t){var s=t.element.getElementsByClassName("scrollWrapper")[0],o=i.build(e,s),u=n.dataFor(t.element),a=r.build(t.element);return o.setContext(u),o.init(a),o}var n=e("vendor/knockout"),r=e("jsviews/calling/roster"),i=e("ui/viewModels/calling/callScreenViewModel/rosterViewModel");t.name=e("constants/components").calling.ROSTER,t.template=e("text!views/calling/roster.html"),t.viewModel={createViewModel:s}}),define("text!views/calling/callAnimation.html",[],function(){return'<div class="animation" data-bind="event: { webkitAnimationIteration: onAnimationIteration, animationiteration: onAnimationIteration, oanimationiteration: onAnimationIteration, MSAnimationIteration: onAnimationIteration,\r\nwebkitAnimationEnd:onAnimationEnded, animationend:onAnimationEnded, oanimationend:onAnimationEnded, MSAnimationEnd:onAnimationEnded }">\r\n    <div class="radial one">\r\n        <span class="shape"></span>\r\n    </div>\r\n    <div class="radial two">\r\n        <span class="shape"></span>\r\n    </div>\r\n    <div class="radial three">\r\n        <span class="shape"></span>\r\n    </div>\r\n    <div class="circle small">\r\n        <div class="right">\r\n            <span class="shape"></span>\r\n        </div>\r\n        <div class="left">\r\n            <span class="shape"></span>\r\n        </div>\r\n    </div>\r\n    <div class="circle large inner">\r\n        <span class="shape"></span>\r\n    </div>\r\n    <div class="avatar">\r\n        <swx-avatar-deprecated params="avatar: avatarUrl, isGroupAvatar: isGroupConversation"></swx-avatar-deprecated>\r\n    </div>\r\n    <div class="circle large outer">\r\n        <span class="shape"></span>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/calling/callAnimation",["require","exports","module","constants/components","text!views/calling/callAnimation.html"],function(e,t){t.name=e("constants/components").calling.CALL_ANIMATION,t.template=e("text!views/calling/callAnimation.html")}),define("text!views/calling/endCall.html",[],function(){return'<div class="avatar">\r\n    <swx-avatar-deprecated params="avatar: avatarUrl, isGroupAvatar: isGroupConversation"></swx-avatar-deprecated>\r\n</div>\r\n<div class="text summary">\r\n    <p class="fontSize-h2" data-bind="l10n: {key: \'callscreen_text_terminationMessage\'}"></p>\r\n</div>\r\n<div class="text duration">\r\n    <p class="fontSize-h1 large" data-bind="text: duration"></p>\r\n</div>\r\n'}),define("ui/components/calling/endCall",["require","exports","module","constants/components","text!views/calling/endCall.html"],function(e,t){t.name=e("constants/components").calling.END_CALL,t.template=e("text!views/calling/endCall.html")}),define("jsviews/calling/callScreenContent",["require","browser/window","constants/common"],function(e){function i(e){var i;this.getContentWidth=function(){return e.querySelector(r).offsetWidth},this.init=function(e){i=e,t.addEventListener(n.events.browser.RESIZE,i)},this.dispose=function(){t.removeEventListener(n.events.browser.RESIZE,i)}}var t=e("browser/window"),n=e("constants/common"),r=".stage";return{build:function(e){return new i(e)}}}),define("services/calling/activeSpeakerManager",["require","utils/chat/sort","lodash-compat","experience/settings"],function(e){function f(e,r){function p(){h&&(c=setInterval(m,i))}function d(){c&&(clearInterval(c),c=null),l=[]}function v(e){var t=e.speaking!==e.audio.isSpeaking(),n=e.speaking?e.tick<o:e.tick<s;return t?(e.cancelTick=1,n?e.tick++:(e.speaking=!e.speaking,e.timestamp=new Date,e.tick=1),!n):(e.tick>1&&(e.cancelTick>u?(e.tick=1,e.cancelTick=1):e.cancelTick++),!1)}function m(){var e=!1;f.forEach(function(t){e=v(t)||e}),e&&y()}function g(e){return e.rawParticipant}function y(){var i=[],s=[],o,u,c=new Date;f.forEach(function(e){e.speaking?i.push(e):c-e.timestamp<a&&s.push(e)}),i.sort(t.byTimestamp),s.sort(t.byTimestampDescending),u=Math.max(0,e-i.length),o=i.slice(0,e).map(g).concat(s.slice(0,u).map(g)),n.isEqual(l,o)||(l=o,r(o))}function b(e){return f.filter(function(t){return t.rawParticipant===e})[0]}function w(e){f=f.filter(function(t){return t.rawParticipant!==e})}function E(e){f.push({tick:1,speaking:!1,cancelTick:1,audio:e.audio,rawParticipant:e})}var f=[],l=[],c=0,h=!0;this.onParticipantAdded=function(e){if(b(e))return;E(e),!c&&f.length>1&&p()},this.onParticipantRemoved=function(e){if(!b(e))return;w(e),f.length<2&&d()},this.pause=function(){h=!1,d()},this.unpause=function(){h=!0,!c&&f.length>1&&p()},this.dispose=function(){d()}}var t=e("utils/chat/sort"),n=e("lodash-compat"),r=e("experience/settings"),i=r.activeSpeaker.tickInterval,s=r.activeSpeaker.timeToPromote/i,o=r.activeSpeaker.timeToDemote/i,u=r.activeSpeaker.ticksToCancel,a=r.activeSpeaker.recentlySpokenTimeout;return{build:function(e,t){return new f(e,t)}}}),define("services/calling/participantManager",["require","swx-enums","constants/calling"],function(e){function r(e){function l(){return e.selfParticipant.audio.state()===t.callConnectionState.Connected}function c(e){return e===t.callConnectionState.Connecting||e===t.callConnectionState.Ringing||e===t.callConnectionState.Connected}function h(e,n){return n===t.callConnectionState.Disconnecting&&e===t.callConnectionState.Disconnected}function p(e){if(!a[e.person.id()]){var t=window.setTimeout(m.bind(r,e),n.PARTICIPANT_REMOVE_FROM_CALLSCREEN_TIMEOUT);a[e.person.id()]=t}}function d(e){var t=e.person.id();a[t]&&(window.clearTimeout(a[t]),delete a[t]);if(s[t])return;s[t]=!0,o(e)}function v(e){function t(t,n,r){if(r===t)return;l()&&(d(e),p(e)),c(t)&&d(e),h(t,r)&&p(e)}f[e.person.id()]=function(){e.audio.state.changed.off(t)},e.audio.state.changed(t)}function m(e){var t=e.person.id();delete a[t],delete s[t],u(e)}function g(e){var t=e.person.id();f[t]&&(f[t](),delete f[t]),a[t]&&(window.clearTimeout(a[t]),delete a[t]),delete s[t],u(e)}var r=this,i=function(){},s={},o=i,u=i,a={},f={};return r.onParticipantAddedToCall=function(e){o=e},r.onParticipantRemovedFromCall=function(e){u=e},r.dispose=function(){Object.keys(f).forEach(function(e){f[e]()}),f={},Object.keys(a).forEach(function(e){window.clearTimeout(a[e])}),a={},e.participants.added.off(v),e.participants.removed.off(g),o=i,u=i},r.init=function(){e.participants.added(v),e.participants.removed(g)},r}var t=e("swx-enums"),n=e("constants/calling");return{build:function(e){return new r(e)}}}),define("services/calling/screenSharingHandler",["require","swx-enums"],function(e){function n(e){function a(e){return e===t.mediaStreamState.Started||e===t.mediaStreamState.Active||e===t.mediaStreamState.Inactive}function f(e,n){var r=a(n);return r&&e===t.mediaStreamState.Stopped}function l(e){var t=e.person.id();if(o[t])return;o[t]=!0,i(e)}function c(e){var t=e.person.id();delete o[t],s(e)}function h(e){function t(t,n,r){a(t)&&l(e),f(t,r)&&c(e)}u[e.person.id()]=function(){e.screenSharing.stream.state.changed.off(t)},e.screenSharing.stream.state.changed(t)}function p(e){var t=e.person.id();u[t]&&(u[t](),delete u[t]),o[t]&&(s(e),delete o[t])}var n=this,r=function(){},i=r,s=r,o={},u={};n.init=function(){e.participants.added(h),e.participants.removed(p)},n.onScreenSharingStarted=function(e){i=e||r},n.onScreenSharingStopped=function(e){s=e||r},n.dispose=function(){Object.keys(u).forEach(function(e){u[e]()}),u={},e.participants.added.off(h),e.participants.removed.off(p),i=r,s=r}}var t=e("swx-enums");return{build:function(e){return new n(e)}}}),define("ui/viewModels/calling/callScreenViewModel/participantLayoutWrapper",[],function(){function e(e){this.participant=e.participant,this.layoutPosition=-1,this.isScreenSharing=e.isScreenSharing||!1,this.videoIsAllowed=e.videoIsAllowed,this.aspectRatio=e.aspectRatio}return{build:function(t){return new e(t)}}}),define("ui/viewModels/calling/helpers/textFormatter",[],function(){function e(e){var n=[],r=Math.floor(e/1e3/60/60);e-=r*1e3*60*60;var i=Math.floor(e/1e3/60);e-=i*1e3*60;var s=Math.floor(e/1e3);return r&&n.push(t(r)),n.push(t(i)),n.push(t(s)),n.join(":")}function t(e){return e=e.toString(),e.length>1?e:"0"+e}return{getFormattedDuration:e}}),define("ui/viewModels/calling/helpers/stageResizer",["require","vendor/knockout","swx-enums","browser/detect","browser/window"],function(e){function f(e){function c(e){if(!e)return null;var t=e.video.channels(0).stream,r=e.screenSharing.stream;return r.state()!==n.mediaStreamState.Stopped?r:t.state()!==n.mediaStreamState.Stopped?t:null}function h(e){if(!e)return u;var t=e.video.channels(0).stream;return t.state()===n.mediaStreamState.Stopped?u:parseFloat((t.width()/t.height()).toFixed(10))}function p(e,t,n){e.style.height=n+"px",e.style.width=t+"px"}function d(e,t,n,r){var i=t.width(),s=t.height(),o=n/i,u=r/s;o<u?(e.style.width=n+"px",e.style.height=s*o+"px"):(e.style.width=i*u+"px",e.style.height=r+"px")}function v(){return r.supportsCssProperty(r.CSS_PROPERTIES.OBJECT_FIT)||r.getBrowserInfo().browserName!==r.BROWSERS.EDGE}function m(e){if(!v()){var t=e.querySelector(o);t&&(t.style.position="",t.style.height="",t.style.width="",t.style.top="",t.style.left="")}}function g(e,t,n,r){var i=t.width(),s=t.height(),u=n/i,a=r/s,f=e.querySelector(o),l=(1-r/(s*u))/2*100,c=(1-n/(i*a))/2*100;f&&(f.style.position="relative",u>a?(f.style.height="auto",f.style.top="-"+l+"%"):(f.style.width="auto",f.style.left="-"+c+"%"))}function y(e,t,n,r){v()||(m(e),g(e,t,n,r))}function b(t,n,r){var i=e()[0].participant,s=c(i);if(!s){var o=Math.min(r,n);p(t,o,o);return}f.isZoomedIn()?(t.style.width="100%",t.style.height="100%",y(t,s,n,r)):(m(t),d(t,s,n,r))}function w(){var t=f.isVideoFullScreenRequested&&e().length===1&&c(e()[0].participant);f.isZoomedIn(t)}function E(){w();var t,n,r=l.querySelectorAll(s),i=l.offsetWidth,o=l.offsetHeight;if(r.length===1){b(r[0],i,o),a=null;return}var u=0,f=[];Array.prototype.forEach.call(r,function(r,i){m(r),n=e()[i].participant,t=h(n),u+=t,f.push(t)}),Array.prototype.forEach.call(r,function(e,t){var n=Math.min(o,i/u)*f[t],r=n/f[t];p(e,n,r)}),a=null}var f=this,l;f.setStageContainer=function(e){l=e},f.isZoomedIn=t.observable(),f.isVideoFullScreenRequested=!1,f.recalculateLayout=function(){if(!l)return;a&&i.cancelAnimationFrame(a),a=i.requestAnimationFrame(E)}}var t=e("vendor/knockout"),n=e("swx-enums"),r=e("browser/detect"),i=e("browser/window"),s=".participant-wrapper",o="video",u=1,a;return{build:function(e){return new f(e)}}}),define("services/calling/layouts/baseLayout",[],function(){function e(){}return e}),define("services/calling/layouts/galleryLayout",["require","lodash-compat","services/calling/layouts/baseLayout","constants/calling","utils/common/array"],function(e){function u(e,u){function h(t,n){t.layoutPosition!==n&&(t.layoutPosition=n,e(t))}function p(e){l=Math.floor(e/s),l=Math.min(u,Math.max(o,l))}function d(){var e=m(),t=c.filter(function(t){return t!==e}),n=l;e&&(h(e,r.STAGE),n=0);for(var i=t.length-1;i>=0;i--)h(t[i],i<n?r.STAGE:r.ROSTER)}function v(e){return c.filter(function(t){return t.participant===e&&!t.isScreenSharing})[0]}function m(){return c.filter(function(e){return e.isScreenSharing===!0})[0]}function g(e,n,r){var s,o,a=Math.min(u,c.length);for(var f=0;f<a;f++){s=c[f];if(s.participant===r)return!1;o=t.contains(e,s.participant);if(!o)return i.swapItems(c,f,n),!0}}n.call(this);var a=this,f,l=1,c=[];a.addItem=function(e){i.insertAt(c,l,e),d()},a.removeItems=function(e){var n=c.filter(e);n.length>0&&(n.forEach(function(e){t.remove(c,e)}),d())},a.onActiveSpeakerChanged=function(e){var t,n,r;e.forEach(function(i){t=v(i),n=c.indexOf(t),t&&n>=l&&(r=g(e,n,i)||r)}),r&&d()},a.onWidthChanged=function(e){if(e===f)return;f=e,p(e),d()}}var t=e("lodash-compat"),n=e("services/calling/layouts/baseLayout"),r=e("constants/calling").LAYOUT_PLACES,i=e("utils/common/array"),s=400,o=1;return u.prototype=Object.create(n.prototype),u.prototype.constructor=u,{build:function(e,t){return new u(e,t)}}}),define("ui/viewModels/calling/callScreenViewModel/callScreenContentViewModel",["require","lodash-compat","vendor/knockout","utils/common/eventMixin","browser/window","swx-enums","utils/common/cafeObservable","constants/calling","services/calling/activeSpeakerManager","services/calling/participantManager","services/calling/screenSharingHandler","ui/viewModels/calling/callScreenViewModel/participantLayoutWrapper","ui/viewModels/calling/helpers/textFormatter","ui/viewModels/calling/helpers/stageResizer","services/calling/layouts/galleryLayout","constants/common","swx-i18n"],function(e){function w(e){function A(e){N=e.stream.state.changed(function(e){t.isLocalVideoOn(e!==s.mediaStreamState.Stopped)})}function O(e,n){var r=x.state()===u.CALL_STATES.CONNECTED;r&&t.participantNotification(y.fetch({key:e,params:{name:n}}))}function M(e,i){var s=p.build({participant:e,isScreenSharing:i,videoIsAllowed:n.observable(!1)});r.addItem(s),t.updateContentWidth()}function _(e){t.participantsInStage.remove(e),t.participantsInRoster.remove(e),r.removeItems(e),t.updateContentWidth()}function D(e){M(e,!1),w.onParticipantAdded(e),O("callscreen_text_participant_joined_notification",e.person.displayName())}function P(e){M(e,!0),w.pause(),O("callscreen_text_participant_screen_shared_notification",e.person.displayName())}function H(e){_(function(t){return t.participant===e&&t.isScreenSharing}),w.unpause(),O("callscreen_text_participant_screen_unshared_notification",e.person.displayName())}function B(e){_(function(t){return t.participant===e}),w.onParticipantRemoved(e),O("callscreen_text_participant_left_notification",e.person.displayName())}function j(e){e.layoutPosition===c.ROSTER?(t.participantsInStage.remove(e),t.participantsInRoster.unshift(e),e.videoIsAllowed(F(e.participant))):(t.participantsInRoster.remove(e),t.participantsInStage.unshift(e),e.videoIsAllowed(!0))}function F(e){return e.screenSharing.stream.state()!==s.mediaStreamState.Stopped}function I(){x.totalCallDuration&&t.duration(d.getFormattedDuration(x.totalCallDuration))}function q(){x.state()===u.CALL_STATES.CONNECTED&&t.stageResizer.recalculateLayout()}function R(){return e.autoCall&&e.autoCall()}function U(){return e.autoCall&&!e.autoCall()}function z(){var e=R()?y.fetch({key:"callscreen_text_autoCallConnectingMessage"}):"";t.callScreenMessageText(e)}function W(){t.callScreenMessageText("")}function X(){U()?e.autoCall.reason===s.callDisconnectionReason.AutoCallFailed?t.callScreenMessageText(y.fetch({key:"callscreen_text_autoCallFailedMessage"})):e.autoCall.reason===s.callDisconnectionReason.AutoCallTimeout&&t.callScreenMessageText(y.fetch({key:"callscreen_text_autoCallTimeoutMessage"})):t.callScreenMessageText("")}function V(e){switch(e){case u.CALL_STATES.CONNECTING:t.isCallConnected(!1),z();break;case u.CALL_STATES.ENDING:t.isCallConnected(!1),X(),I();break;case u.CALL_STATES.CONNECTED:t.isCallConnected(!0),q(),W()}}function $(e){t.stageResizer.isVideoFullScreenRequested=e,q()}function J(){t.stageContainer()&&r.onWidthChanged(t.stageContainer().parentNode.offsetWidth),q(),t.updateContentWidth()}function K(){t.stageResizer.setStageContainer(t.stageContainer()),J()}function Q(){t.isVisible(!0),J()}function G(){var e={},n=t.layoutName();return e.fit=t.canFit(),e[n]=n,e}var t=this,r=m.build(j,b),w,E,S,x,T,N,C,k,L;t.conversation=e,t.participantsInStage=n.observableArray(),t.participantsInRoster=n.observableArray(),t.layoutName=n.observable(h.ACTIVE_SPEAKER),t.stageContainer=n.observable(),t.isCallConnected=n.observable(!1),t.showEndCall=n.observable(!1),t.avatarUrl=o.newObservableProperty(e.avatarUrl),t.callScreenMessageText=n.observable(""),t.duration=n.observable(""),t.isVisible=n.observable(!0),t.isLocalVideoOn=n.observable(!1),t.isLocalVideoAllowed=n.observable(!0),t.participantNotification=n.observable(""),t.canFit=n.observable(!1),t.mainClass=n.computed(G),t.rosterWidth=n.observable(50),t.participantRendered=function(){i.setTimeout(q,100)},t.init=function(n,i,s){C=n,C.init(J),x=i,t.footerButtonsWidth=s,e.selfParticipant.video.channels.added(A),t.stageResizer=v.build(t.participantsInStage),t.stageContainer.subscribe(K),w=a.build(b,r.onActiveSpeakerChanged),E=f.build(e),E.onParticipantAddedToCall(D),E.onParticipantRemovedFromCall(B),E.init(),S=l.build(e),S.onScreenSharingStarted(P),S.onScreenSharingStopped(H),S.init(),t.forwardEvent(g.events.callScreen.TOGGLE_FULLSCREEN,t.DIRECTION.CHILD,J),t.registerEvent(g.events.navigation.FRAGMENT_SHOW,Q),t.registerEvent(g.events.navigation.FRAGMENT_BEFORE_HIDE,t.isVisible.bind(t,!1)),t.registerEvent(g.events.callScreen.VIDEO_ZOOMED_IN,$),t.registerEvent(g.events.callScreen.CONTROLS_VISIBLE,q),t.registerEvent(g.events.callScreen.SIDEBAR_TOGGLED,J),t.registerEvent(g.events.callScreen.VIDEO_STATE_CHANGED,q),t.registerEvent(g.events.callScreen.VIDEO_SIZE_CHANGED,q),t.registerEvent(g.events.callScreen.TOGGLE_FULLSCREEN,t.updateContentWidth),t.registerEvent(g.events.callScreen.TOGGLE_NARROW_MENU,t.updateContentWidth),t.registerEvent(g.events.callScreen.ROSTER_WIDTH_CHANGED,t.rosterWidth.bind(t)),T=x.state.subscribe(V),V(x.state()),k=s.subscribe(t.updateContentWidth),L=t.rosterWidth.subscribe(t.updateContentWidth),t.updateContentWidth()},t.updateContentWidth=function(){var e=(C.getContentWidth()-t.footerButtonsWidth())/2;t.canFit(e>t.rosterWidth())},t.dispose=function(){e.selfParticipant.video.channels.added.off(A),C.dispose(),N&&N.dispose(),k&&k.dispose(),L&&L.dispose(),w&&w.dispose(),E&&E.dispose(),T.dispose()}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/eventMixin"),i=e("browser/window"),s=e("swx-enums"),o=e("utils/common/cafeObservable"),u=e("constants/calling"),a=e("services/calling/activeSpeakerManager"),f=e("services/calling/participantManager"),l=e("services/calling/screenSharingHandler"),c=u.LAYOUT_PLACES,h=u.LAYOUT_TYPES,p=e("ui/viewModels/calling/callScreenViewModel/participantLayoutWrapper"),d=e("ui/viewModels/calling/helpers/textFormatter"),v=e("ui/viewModels/calling/helpers/stageResizer"),m=e("services/calling/layouts/galleryLayout"),g=e("constants/common"),y=e("swx-i18n").localization,b=3;return t.assign(w.prototype,r),{build:function(e){return new w(e)}}}),define("text!views/calling/callScreenContent.html",[],function(){return'<div class="stage" data-bind="css: mainClass, getVisibility: isVisible">\r\n\r\n    <div class="participantsInStage"\r\n        data-bind="getElement: stageContainer, css : { zoomedIn: stageResizer.isZoomedIn, singleParticipant: participantsInStage().length === 1 }">\r\n        <!-- ko foreach: {data: participantsInStage, afterRender: participantRendered} -->\r\n            <!-- ko component: {\r\n                name: "swx-call-participant",\r\n                params: {\r\n                    participant: $data.participant,\r\n                    videoIsAllowed: $data.videoIsAllowed,\r\n                    isGroupConversation: $parent.conversation.isGroupConversation(),\r\n                    isVisible: $parent.isVisible,\r\n                    isScreenSharing: $data.isScreenSharing\r\n                }\r\n            } --><!-- /ko -->\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n    <!-- ko if: callScreenMessageText -->\r\n    <div class="callScreenMessage fontSize-h2" data-bind="text: callScreenMessageText"></div>\r\n    <!-- /ko -->\r\n\r\n    <swx-end-call class="end-call"\r\n            params="avatarUrl: avatarUrl,\r\n                    duration: duration,\r\n                    isGroupConversation: $parent.conversation.isGroupConversation()">\r\n    </swx-end-call>\r\n\r\n    <swx-call-roster class="call-roster"\r\n                     data-bind="css: { hasBorder: isLocalVideoOn() || (isCallConnected() && participantsInRoster().length > 0)}"\r\n                     params="participants: participantsInRoster,\r\n                        isGroupConversation: $parent.conversation.isGroupConversation(),\r\n                        selfParticipant: conversation.selfParticipant,\r\n                        isLocalVideoOn: isLocalVideoOn,\r\n                        isVisible: isVisible,\r\n                        isLocalVideoAllowed: isLocalVideoAllowed">\r\n    </swx-call-roster>\r\n\r\n    <div aria-live="polite" role="status" class="offScreen" data-bind="text: participantNotification"></div>\r\n</div>\r\n'}),define("ui/components/calling/callScreenContent",["require","exports","module","vendor/knockout","jsviews/calling/callScreenContent","ui/viewModels/calling/callScreenViewModel/callScreenContentViewModel","constants/components","text!views/calling/callScreenContent.html"],function(e,t){function s(e,t){var s=i.build(e.conversation),o=r.build(t.element),u=n.dataFor(t.element);return s.setContext(u),s.init(o,e.callState,e.footerButtonsWidth),s}var n=e("vendor/knockout"),r=e("jsviews/calling/callScreenContent"),i=e("ui/viewModels/calling/callScreenViewModel/callScreenContentViewModel");t.name=e("constants/components").calling.CONTENT,t.template=e("text!views/calling/callScreenContent.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/calling/callScreenViewModel/callScreenHeaderViewModel",["require","lodash-compat","vendor/knockout","utils/common/cafeObservable","browser/detect","swx-i18n","utils/common/eventMixin","ui/viewModels/calling/helpers/textFormatter","constants/calling","constants/common","services/pubSub/pubSub","ui/telemetry/actions/actionNames","ui/modelHelpers/conversationHelper","swx-utils-common","utils/chat/messageSanitizer","services/serviceLocator"],function(e){function g(e,t,o){function S(){return E.isContainerFullScreen()?s.fetch({key:"callscreen_text_exitFullscreen"}):s.fetch({key:"callscreen_text_enterFullscreen"})}function x(){return(b()===a.CONNECTED||b()===a.ENDING)&&E.watermarkCanBeShown()}function T(){var e=w();return e=d.removeAnchorTags(e),e=d.unescapeHTML(e),h.isPstnEndpoint(e)&&(e=p.forceLTREmbedding(e)),e}function N(e){b()===a.CONNECTED&&E.watermarkCanBeShown(!e)}function C(){g?(L(),window.clearInterval(g)):E.callStatusDisplay(o.ENDED)}function k(e){switch(e){case a.CALLING:case a.EARLY_MEDIA:E.callStatusDisplay(o.CALLING);break;case a.CONNECTED:A();break;case a.ENDING:C()}}function L(){E.callStatusDisplay(u.getFormattedDuration(e.getCurrentDuration()))}function A(){L(),g=window.setInterval(L,m)}var g,y,b=e.state,w=r.newObservableProperty(t.topic),E=this;E.conversationTopic=n.computed(T),E.callStatusDisplay=n.observable(o.CONNECTING),E.watermarkCanBeShown=n.observable(!1),E.isContainerFullScreen=n.observable(!1),E.isInShellApp=n.observable(!1),E.fullscreenText=n.computed(S),E.isWatermarkVisible=n.computed(x),E.onButtonFocused=function(){E.dispatchEvent(f.events.callScreen.BUTTON_FOCUSED,!0,E.DIRECTION.PARENT)},E.onButtonBlurred=function(){E.dispatchEvent(f.events.callScreen.BUTTON_FOCUSED,!1,E.DIRECTION.PARENT)},E.toggleContainerFullScreen=function(){var e=v.resolve(f.serviceLocator.ACTION_TELEMETRY);E.isContainerFullScreen(!E.isContainerFullScreen()),E.dispatchEvent(f.events.callScreen.TOGGLE_FULLSCREEN,E.isContainerFullScreen(),E.DIRECTION.PARENT),l.publish(f.apiUIEvents.SWX_CALLSCREEN_MAXIMIZE,E.isContainerFullScreen()),e.recordAction(c.audioVideo.toggleFullScreen)},E.toggleNarrowMenu=function(){var e=v.resolve(f.serviceLocator.ACTION_TELEMETRY);E.dispatchEvent(f.events.callScreen.TOGGLE_NARROW_MENU,null,E.DIRECTION.PARENT),e.recordAction(c.audioVideo.toggleNarrowMenu)},E.init=function(){E.registerEvent(f.events.callScreen.CONTROLS_VISIBLE,N),y=b.subscribe(k),k(b()),i.getBrowserInfo().browserName===i.BROWSERS.SKYPE_SHELL&&(E.isContainerFullScreen(!0),E.isInShellApp(!0)),t.autoCall&&t.autoCall()&&E.isContainerFullScreen(!0)},E.dispose=function(){y.dispose(),E.fullscreenText.dispose(),E.isWatermarkVisible.dispose(),g&&window.clearInterval(g)}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/cafeObservable"),i=e("browser/detect"),s=e("swx-i18n").localization,o=e("utils/common/eventMixin"),u=e("ui/viewModels/calling/helpers/textFormatter"),a=e("constants/calling").CALL_STATES,f=e("constants/common"),l=e("services/pubSub/pubSub"),c=e("ui/telemetry/actions/actionNames"),h=e("ui/modelHelpers/conversationHelper"),p=e("swx-utils-common").stringUtils,d=e("utils/chat/messageSanitizer"),v=e("services/serviceLocator"),m=1e3;return t.assign(g.prototype,o),{build:function(e,t,n){return new g(e,t,n)}}}),define("text!views/calling/callScreenHeader.html",[],function(){return'<div class="header">\r\n    <div class="name">\r\n        <h3 class="conversationTopic" data-bind="text: conversationTopic"></h3>\r\n    </div>\r\n\r\n    <div class="info">\r\n        <h3 class="callStatus" data-bind="text: callStatusDisplay"></h3>\r\n    </div>\r\n</div>\r\n<div class="controls">\r\n    <div class="button row right">\r\n        <button class="calling btn circle small semiopaque" data-bind="click: toggleContainerFullScreen, css: { hide: isInShellApp() }, attr: { title: fullscreenText }, event: {focus: onButtonFocused, blur: onButtonBlurred}" type="button">\r\n            <span class="iconfont fullscreenOn" data-bind="css: { fullscreenOff: isContainerFullScreen() }, text: fullscreenText"></span>\r\n        </button>\r\n        <button class="calling btn circle small semiopaque menuButton" data-bind="click: toggleNarrowMenu, l10n_attr: { \'title\': \'button_title_more\' }, event: {focus: onButtonFocused, blur: onButtonBlurred}" type="button">\r\n            <span class="iconfont menu" data-bind="l10n: { \'key\': \'button_title_more\' }"></span>\r\n        </button>\r\n    </div>\r\n</div>\r\n<div class="watermark" data-bind="visible: isWatermarkVisible()"></div>\r\n'}),define("ui/components/calling/callScreenHeader",["require","exports","module","vendor/knockout","ui/viewModels/calling/callScreenViewModel/callScreenHeaderViewModel","constants/components","text!views/calling/callScreenHeader.html"],function(e,t){function i(e,t){var i=r.build(e.state,e.conversation,e.callScreenStrings),s=n.dataFor(t.element);return i.setContext(s),i.init(),i}var n=e("vendor/knockout"),r=e("ui/viewModels/calling/callScreenViewModel/callScreenHeaderViewModel");t.name=e("constants/components").calling.HEADER,t.template=e("text!views/calling/callScreenHeader.html"),t.viewModel={createViewModel:i}}),define("jsviews/calling/callScreenFooter",["require","constants/common","browser/window"],function(e){function i(e){var i;this.getButtonsWidth=function(){return e.querySelector(t).offsetWidth},this.init=function(e){i=e,r.addEventListener(n.events.browser.RESIZE,i)},this.dispose=function(){r.removeEventListener(n.events.browser.RESIZE,i)}}var t=".button.row.center",n=e("constants/common"),r=e("browser/window");return{build:function(e){return new i(e)}}}),define("ui/viewModels/calling/moreActionsControlViewModel",["require","lodash-compat","utils/common/eventMixin","vendor/knockout","ui/viewModels/calling/baseCallControlViewModel","ui/telemetry/actions/actionNames","constants/common","services/serviceLocator","ui/contextMenu/items/all","ui/contextMenu/contextMenu","ui/telemetry/actions/actionSources","utils/common/cafeObservable","swx-enums","swx-i18n"],function(e){function d(e){function N(){t.dispatchEvent(o.events.callScreen.ADD_PARTICIPANT,null,t.DIRECTION.PARENT),k(s.audioVideo.addParticipants)}function C(){var t=e.screenSharingService;m()?(t.start(),k(s.audioVideo.shareScreen)):g()&&(t.stop(),k(s.audioVideo.stopSharingScreen))}function k(e){var t=u.resolve(o.serviceLocator.ACTION_TELEMETRY);t.recordAction(e)}function L(){f.hide()}var t=this,n=r.observable(!0),d=c.newObservableProperty(e.selfParticipant.audio.state),v=c.newObservableProperty(e.participants.add.enabled),m=c.newObservableProperty(e.screenSharingService.start.enabled),g=c.newObservableProperty(e.screenSharingService.stop.enabled),y,b,w,E=r.observable(!1),S=p.fetch({key:"callscreen_text_shareScreen"}),x=p.fetch({key:"callscreen_text_stopSharingScreen"});i.call(t,e,n),t.addParticipantText=p.fetch({key:"callscreen_text_addParticipants"}),t.moreActionsText=p.fetch({key:"callscreen_text_plusButton"}),t.screenShareText=r.pureComputed(function(){return m()||!g()?S:x}),t.isAddingParticipantsAllowed=r.pureComputed(function(){return!E()&&v()&&d()===h.callConnectionState.Connected}),t.isScreenSharingAllowed=r.pureComputed(function(){return m()||g()}),t.hasAllowedActions=r.pureComputed(function(){return t.isAddingParticipantsAllowed()||t.isScreenSharingAllowed()}),t.showMoreActionsMenu=function(t,n){var r=[a.AddParticipantsMenuItem.build(function(){return!v()},N),a.ShareScreen.build(function(){return!m()&&!g()},m(),C)],i={source:l.recentItem,isGroupConversation:e.isGroupConversation()};f.show(r,n,i),k(s.audioVideo.moreActions)},t.registerEvent(o.events.callScreen.ADD_PARTICIPANT_VISIBLE,E),t.registerEvent(o.events.callScreen.CALL_ESCALATED_TO_GROUP,n.bind(null,!1)),t.addParticipant=N,t.shareScreen=C,y=v.subscribe(L),b=m.subscribe(L),w=g.subscribe(L);var T=t.dispose;t.dispose=function(){y&&y.dispose(),b&&b.dispose(),w&&w.dispose(),d.dispose(),v.dispose(),m.dispose(),g.dispose(),T.call(t)}}var t=e("lodash-compat"),n=e("utils/common/eventMixin"),r=e("vendor/knockout"),i=e("ui/viewModels/calling/baseCallControlViewModel"),s=e("ui/telemetry/actions/actionNames"),o=e("constants/common"),u=e("services/serviceLocator"),a=e("ui/contextMenu/items/all"),f=e("ui/contextMenu/contextMenu"),l=e("ui/telemetry/actions/actionSources"),c=e("utils/common/cafeObservable"),h=e("swx-enums"),p=e("swx-i18n").localization;return d.prototype=Object.create(i.prototype),d.prototype.constructor=d,t.assign(d.prototype,n),{build:function(e){return new d(e)}}}),define("ui/viewModels/calling/videoControlViewModel",["require","ui/viewModels/calling/baseCallControlViewModel","vendor/knockout","swx-enums","utils/common/cafeObservable","swx-i18n","cafe/applicationInstance","ui/telemetry/actions/actionNames","constants/common","ui/modelHelpers/personHelper","services/serviceLocator"],function(e){function c(e){function m(e){e.stream.state.changed(p),e.isStarted.set.enabled.changed(h)}function g(){var t=e.participants();v(t.length===1&&f.isEchoContact(t[0].person))}function y(t){e.selfParticipant.video.channels(0).isStarted(t)}var c=this,h=n.observable(!1),p=n.observable(),d=i.newObservableProperty(o.get().devicesManager.selectedCamera),v=n.observable(!1);e.participants.changed(g),t.call(c,e,h),c.isLocalVideoAvailable=n.computed(function(){return d()!==null}),c.isLocalVideoOn=n.computed(function(){return p&&c.isLocalVideoAvailable()&&!!p()&&p()!==r.mediaStreamState.Stopped}),c.isLocalVideoButtonEnabled=n.computed(function(){return c.isLocalVideoAvailable()&&c.isCallControlEnabled()&&!v()}),c.videoStateText=n.computed(function(){return c.isLocalVideoOn()?s.fetch({key:"callscreen_text_videoOff"}):s.fetch({key:"callscreen_text_videoOn"})}),c.toggleVideo=function(){if(!c.isLocalVideoButtonEnabled())return;var t=l.resolve(a.serviceLocator.ACTION_TELEMETRY);t.recordAction(u.audioVideo.toggleVideo),c.isLocalVideoOn()?y(!1):e.selfParticipant.video.state()===r.callConnectionState.Disconnected&&e.videoService.start.enabled()?e.videoService.start().then(function(){y(!0)}):y(!0)},c.dispose=function(){d.dispose(),c.videoStateText.dispose(),e.selfParticipant.video.channels.added.off(m),e.participants.changed.off(g)},e.selfParticipant.video.channels.added(m)}var t=e("ui/viewModels/calling/baseCallControlViewModel"),n=e("vendor/knockout"),r=e("swx-enums"),i=e("utils/common/cafeObservable"),s=e("swx-i18n").localization,o=e("cafe/applicationInstance"),u=e("ui/telemetry/actions/actionNames"),a=e("constants/common"),f=e("ui/modelHelpers/personHelper"),l=e("services/serviceLocator");return c.prototype=Object.create(t.prototype),c.prototype.constructor=c,{build:function(e){return new c(e)}}}),define("ui/viewModels/calling/callScreenDialpadViewModel",["require","ui/viewModels/calling/baseCallControlViewModel","vendor/knockout","utils/common/async","swx-i18n","utils/common/eventHelper","ui/telemetry/actions/actionNames","lodash-compat","swx-utils-common","constants/common","utils/common/eventMixin","services/serviceLocator"],function(e){function h(e){function h(e){var t=u.dialpadText(),n=a.inject(t,e,t.length);u.dialpadText(n),r.execute(function(){p(n.length)})}function p(e){l.selectionStart=e,l.selectionEnd=e}function d(){var e=c.resolve(f.serviceLocator.ACTION_TELEMETRY),t=o.audioVideo.toggleDialpad;e.recordAction(t)}var u=this,l;u.isDialpadOn=n.observable(!1),u.dialpadText=n.observable(""),t.call(u,e),u.init=function(e){l=e,u.registerEvent(f.events.skypeOut.DIAL_BUTTON_CLICKED,u.sendDtmf)},u.sendDtmf=function(t){return e.audioService.sendDtmf(t.text).then(function(e){h(e)})},u.toggleDialpad=function(e,t){u.isDialpadButtonEnabled()&&(u.isDialpadOn(!u.isDialpadOn()),d()),s.swallow(t)},u.isDialpadButtonEnabled=n.computed(function(){return u.isCallConnected()}),u.displayDialpad=n.computed(function(){return u.isDialpadButtonEnabled()&&u.isDialpadOn()}),u.dialpadStateText=n.computed(function(){return u.isDialpadOn()?i.fetch({key:"callscreen_text_dialpadOff"}):i.fetch({key:"callscreen_text_dialpadOn"})}),u.dispose=function(){u.dialpadStateText.dispose(),u.displayDialpad.dispose(),u.isDialpadButtonEnabled.dispose(),u.isDialpadOn(!1),u.dialpadText("")}}var t=e("ui/viewModels/calling/baseCallControlViewModel"),n=e("vendor/knockout"),r=e("utils/common/async"),i=e("swx-i18n").localization,s=e("utils/common/eventHelper"),o=e("ui/telemetry/actions/actionNames"),u=e("lodash-compat"),a=e("swx-utils-common").stringUtils,f=e("constants/common"),l=e("utils/common/eventMixin"),c=e("services/serviceLocator");return h.prototype=Object.create(t.prototype),h.prototype.constructor=h,u.assign(h.prototype,l),{build:function(e){return new h(e)}}}),define("ui/viewModels/calling/callScreenViewModel/callScreenFooterViewModel",["require","lodash-compat","browser/detect","vendor/knockout","browser/dom","utils/calling/callingStack","constants/common","services/serviceLocator","utils/common/eventMixin","ui/modelHelpers/conversationHelper","ui/viewModels/calling/endCallControlViewModel","ui/viewModels/calling/moreActionsControlViewModel","ui/viewModels/calling/micControlViewModel","ui/viewModels/calling/videoControlViewModel","ui/viewModels/calling/callScreenDialpadViewModel"],function(e){function v(e,t){function b(){return!s.get().isPluginlessCallingSupported()&&!e.selfParticipant.isAnonymous()&&v.isFeatureOn(o.featureFlags.GVC_LOCAL_ESCALATION)}function w(){return!s.get().isPluginlessCallingSupported()&&!e.selfParticipant.isAnonymous()&&v.isFeatureOn(o.featureFlags.OUTGOING_SCREEN_SHARING)}function E(){return n.getSystemInfo().osName===n.OPERATING_SYSTEMS.LINUX?!1:e.isGroupConversation()?!0:!g}function S(){a.dispatchEvent(o.events.callScreen.BUTTONS_WIDTH_CHANGED,a.view.getButtonsWidth(),a.DIRECTION.PARENT)}var a=this,v=u.resolve(o.serviceLocator.FEATURE_FLAGS),m=v.isFeatureOn(o.featureFlags.PSTN_ENABLED),g=f.isConversationWithPstn(e),y=m&&g;a.endCallControl=l.build(e,!0),a.micControl=h.build(e,!0),a.videoControl=p.build(e,!0),a.moreActionsControl=c.build(e),a.moreActionsControl.setContext(a),a.showDialpadControl=r.observable(y),a.showVideoControl=E(),a.isLocalEscalationEnabled=b(),a.isScreenSharingEnabled=w(),a.hasMoreThanOneMoreAction=a.isLocalEscalationEnabled&&a.isScreenSharingEnabled,y&&(a.dialpadControl=d.build(e)),a.view=null,a.onButtonFocused=function(){a.dispatchEvent(o.events.callScreen.BUTTON_FOCUSED,!0,a.DIRECTION.PARENT)},a.onButtonBlurred=function(){a.dispatchEvent(o.events.callScreen.BUTTON_FOCUSED,!1,a.DIRECTION.PARENT)},a.init=function(e){a.view=e,a.view.init(S),a.dialpadControl&&a.dialpadControl.init(i.getElement(".DialPadController-input",t)),a.forwardEvent(o.events.callScreen.CALL_ESCALATED_TO_GROUP,a.DIRECTION.CHILD),a.forwardEvent(o.events.callScreen.ADD_PARTICIPANT,a.DIRECTION.PARENT),a.forwardEvent(o.events.callScreen.ADD_PARTICIPANT_VISIBLE,a.DIRECTION.CHILD),S()},a.dispose=function(){a.view&&a.view.dispose(),a.endCallControl.dispose(),a.micControl.dispose(),a.videoControl.dispose(),a.moreActionsControl.dispose(),a.dialpadControl&&a.dialpadControl.dispose()}}var t=e("lodash-compat"),n=e("browser/detect"),r=e("vendor/knockout"),i=e("browser/dom"),s=e("utils/calling/callingStack"),o=e("constants/common"),u=e("services/serviceLocator"),a=e("utils/common/eventMixin"),f=e("ui/modelHelpers/conversationHelper"),l=e("ui/viewModels/calling/endCallControlViewModel"),c=e("ui/viewModels/calling/moreActionsControlViewModel"),h=e("ui/viewModels/calling/micControlViewModel"),p=e("ui/viewModels/calling/videoControlViewModel"),d=e("ui/viewModels/calling/callScreenDialpadViewModel");return t.assign(v.prototype,a),{build:function(e,t){return new v(e,t)}}}),define("text!views/calling/callScreenFooter.html",[],function(){return'<div class="controls">\r\n    <div class="button row center">\r\n        <!-- ko if: showVideoControl -->\r\n            <!-- ko with: videoControl -->\r\n            <button data-bind="click: toggleVideo, event: {focus: $parent.onButtonFocused, blur: $parent.onButtonBlurred}, enable: isLocalVideoAvailable(), css: { disabled: !isLocalVideoButtonEnabled() }, attr: { title: videoStateText, \'aria-disabled\': !isLocalVideoButtonEnabled() }" class="calling btn primary circle large toggleVideo protected" type="button">\r\n                <span class="iconfont videoOn" data-bind="css: { videoOff: !isLocalVideoOn() }, text: videoStateText"></span>\r\n            </button>\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n        <!-- ko with: micControl -->\r\n        <button data-bind="click: toggleMicrophone, event: {focus: $parent.onButtonFocused, blur: $parent.onButtonBlurred}, enable: isMicrophoneAvailable(), css: { disabled: !isMicrophoneButtonEnabled() }, attr: { title: microphoneStateText, \'aria-disabled\': !isMicrophoneButtonEnabled() }" class="calling btn primary circle large toggleMic protected" type="button">\r\n            <span class="iconfont microphoneOn" data-bind="css: { microphoneOff: !isMicrophoneOn() }, text: microphoneStateText"></span>\r\n        </button>\r\n        <!-- /ko -->\r\n        <!-- ko if: showDialpadControl -->\r\n            <!-- ko with: dialpadControl -->\r\n            <div class="DialPadController">\r\n                <div class="DialPadController-container popup arrow down" data-bind="css: { \'DialPadController-container--active\': displayDialpad() }">\r\n                    <div class="DialPadController-inputContainer">\r\n                        <input type="text" name="dialPadController-input" class="DialPadController-input" data-bind="textInput: dialpadText" readonly="true" disabled />\r\n                    </div>\r\n                    <swx-dialpad class="DialPad DialPad--themeDark"></swx-dialpad>\r\n                </div>\r\n                <button data-bind="click: toggleDialpad, event: {focus: $parent.onButtonFocused, blur: $parent.onButtonBlurred}, enable: isDialpadButtonEnabled(), css: { disabled: !isDialpadButtonEnabled() }, attr: { title: dialpadStateText, \'aria-disabled\': !isDialpadButtonEnabled() }" class="calling btn primary circle large toggleDialpad protected" type="button">\r\n                    <span class="iconfont dialpad" data-bind="css: { dialpadOff: !isDialpadButtonEnabled() }, text: dialpadStateText"></span>\r\n                </button>\r\n            </div>\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: hasMoreThanOneMoreAction -->\r\n            <!-- ko with: moreActionsControl -->\r\n            <button data-bind="click: showMoreActionsMenu, enable: hasAllowedActions(), css: { disabled: !hasAllowedActions() }, event: {focus: $parent.onButtonFocused, blur: $parent.onButtonBlurred}, attr: { title: moreActionsText, \'aria-disabled\': !hasAllowedActions() }" class="calling btn primary circle large plus protected" type="button">\r\n                <span class="iconfont plus"></span>\r\n            </button>\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n\r\n        <!-- ko ifnot: hasMoreThanOneMoreAction -->\r\n            <!-- ko if: isLocalEscalationEnabled -->\r\n                <!-- ko with: moreActionsControl -->\r\n                <button data-bind="click: addParticipant, enable: isAddingParticipantsAllowed(), css: { disabled: !isAddingParticipantsAllowed() }, event: {focus: $parent.onButtonFocused, blur: $parent.onButtonBlurred}, attr: { title: addParticipantText, \'aria-disabled\': !isAddingParticipantsAllowed() }" class="calling btn primary circle large toggleAdd protected" type="button">\r\n                    <span class="iconfont contactAdd"></span>\r\n                </button>\r\n                <!-- /ko -->\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: isScreenSharingEnabled -->\r\n                <!-- ko with: moreActionsControl -->\r\n                <button data-bind="click: shareScreen, enable: isScreenSharingAllowed(), css: { disabled: !isScreenSharingAllowed() }, event: {focus: $parent.onButtonFocused, blur: $parent.onButtonBlurred}, attr: { title: screenShareText, \'aria-disabled\': !isScreenSharingAllowed() }" class="calling btn primary circle large screenshare protected" type="button">\r\n                    <span class="iconfont screenshare"></span>\r\n                </button>\r\n                <!-- /ko -->\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n\r\n        <!-- ko with: endCallControl -->\r\n        <button data-bind="click: endCall, event: {focus: $parent.onButtonFocused, blur: $parent.onButtonBlurred}, enable: isCallControlEnabled(), css: { disabled: !isCallControlEnabled() }, hasFocus: isButtonFocused, l10n_attr: { \'title\': \'callscreen_text_endCall\' }" class="calling btn primary circle large red endCall protected" type="button">\r\n            <span class="iconfont callEnd" data-bind="l10n: { \'key\': \'callscreen_text_endCall\' }"></span>\r\n        </button>\r\n        <!-- /ko -->\r\n    </div>\r\n</div>\r\n'}),define("ui/components/calling/callScreenFooter",["require","exports","module","vendor/knockout","jsviews/calling/callScreenFooter","ui/viewModels/calling/callScreenViewModel/callScreenFooterViewModel","constants/components","text!views/calling/callScreenFooter.html"],function(e,t){function s(e,t){var s=i.build(e.conversation,t.element),o=r.build(t.element),u=n.dataFor(t.element);return s.setContext(u),s.init(o),s}var n=e("vendor/knockout"),r=e("jsviews/calling/callScreenFooter"),i=e("ui/viewModels/calling/callScreenViewModel/callScreenFooterViewModel");t.name=e("constants/components").calling.FOOTER,t.template=e("text!views/calling/callScreenFooter.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/chat/conversationActivity",["require","exports","module","vendor/knockout","swx-enums","browser/window","constants/common","constants/calling","services/serviceLocator"],function(e,t){function a(e){function h(e){t.isOnCall(e===r.callConnectionState.Connected)}function p(){var n=!!e.activeModalities.audio(),i=e.selfParticipant.audio.state()===r.callConnectionState.Disconnected||e.selfParticipant.audio.state()===r.callConnectionState.Notified,a=e.isGroupConversation(),f=u.resolve(s.serviceLocator.FEATURE_FLAGS),l=f.isFeatureOn(o.FEATURE_FLAGS.CALLING);t.canJoinCall(a&&n&&i&&l)}function d(e){h(e),p(e);switch(e){case r.callConnectionState.Connected:g();break;case r.callConnectionState.Disconnected:y()}}function v(e,n){var i=!e,s=n!==r.callingNotSupportedReasons.PluginNotInstalled;t.isCallingDisabled(i&&s)}function m(e,n){var i=!e,s=n!==r.callingNotSupportedReasons.PluginNotInstalled;t.isVideoCallingDisabled(i&&s)}function g(){t.callDuration(c),f=e.audioService.callConnected(),a=i.setInterval(b,l)}function y(){a&&i.clearInterval(a),t.callDuration(c)}function b(){var e=new Date,n=e-f;t.callDuration(n)}function w(){return t.isCallingDisabled()||!t.canJoinCall()}var t=this,a,f,l=1e3,c=-1;t.callDuration=n.observable(c),t.isOnCall=n.observable(!1),t.isCallingDisabled=n.observable(!0),t.isVideoCallingDisabled=n.observable(!0),t.canJoinCall=n.observable(!1),t.isJoinCallDisabled=n.computed(w),e.selfParticipant.audio.state.changed(d),e.activeModalities.audio.changed(p),e.audioService.start.enabled.changed(v),e.videoService.start.enabled.changed(m),t.dispose=function(){t.isJoinCallDisabled.dispose(),e.selfParticipant.audio.state.changed.off(d),e.activeModalities.audio.changed.off(p),e.audioService.start.enabled.changed.off(v),e.videoService.start.enabled.changed.off(m),a&&i.clearInterval(a)}}var n=e("vendor/knockout"),r=e("swx-enums"),i=e("browser/window"),s=e("constants/common"),o=e("constants/calling"),u=e("services/serviceLocator");t.classFunction=a,t.build=function(e){return new a(e)}}),define("ui/viewModels/calling/joinCallButtonViewModel",["require","lodash-compat","utils/common/eventMixin","swx-i18n","cafe/applicationInstance","ui/telemetry/actions/actionNames","ui/viewModels/calling/helpers/callingFacade","ui/controls/calling/sounds","ui/viewModels/chat/conversationActivity","constants/common","services/serviceLocator"],function(e){function c(e){function h(){var e=!1;i.get().conversationsManager.conversations.add(n),o.placeCall(n,e,"startCallButton"),u.playOnce(u.KEYS.CALL_DIALING)}var t=this,n=e.conversationModel,c;c=a.build(n),t.icon=e.showIcon===!0?"callStart":"",t.cssClass=e.cssClass,t.tabIndex=e.tabIndex,t.isOnCall=c.isOnCall,t.isJoinCallDisabled=c.isJoinCallDisabled,t.joinCallTitle=r.fetch({key:"button_text_joinCall"}),t.joinCall=function(){var e=l.resolve(f.serviceLocator.ACTION_TELEMETRY);e.recordAction(s.audioVideo.joinCall),h()},t.dispose=function(){c.dispose()}}var t=e("lodash-compat"),n=e("utils/common/eventMixin"),r=e("swx-i18n").localization,i=e("cafe/applicationInstance"),s=e("ui/telemetry/actions/actionNames"),o=e("ui/viewModels/calling/helpers/callingFacade"),u=e("ui/controls/calling/sounds"),a=e("ui/viewModels/chat/conversationActivity"),f=e("constants/common"),l=e("services/serviceLocator");return t.assign(c.prototype,n),c}),define("text!views/calling/joinCallButton.html",[],function(){return" <swx-button params=\"icon:icon,\r\n                        cssClass: cssClass,\r\n                        disabled: isJoinCallDisabled,\r\n                        action: joinCall,\r\n                        titleKey: 'button_text_joinCall',\r\n                        textKey: 'button_text_joinCall',\r\n                        i18nTitle: joinCallTitle,\r\n                        ariaLabelKey: 'button_text_joinCall'\"></swx-button>\r\n"}),define("ui/components/calling/joinCallButton",["require","exports","module","vendor/knockout","ui/viewModels/calling/joinCallButtonViewModel","constants/components","text!views/calling/joinCallButton.html"],function(e,t){function i(e,t){var i=new r(e);return i.setContext(n.dataFor(t.element)),i}var n=e("vendor/knockout"),r=e("ui/viewModels/calling/joinCallButtonViewModel");t.name=e("constants/components").calling.JOINCALL_BUTTON,t.template=e("text!views/calling/joinCallButton.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/calling/startCallButtonViewModel",["require","exports","module","lodash-compat","utils/common/eventMixin","vendor/knockout","constants/common","services/serviceLocator","ui/contextMenu/menuItemHelper","ui/contextMenu/items/all","ui/modelHelpers/personHelper"],function(e,t){function l(e){function c(){n.callButtonViewModel.conversationModel.participants.changed.off(p),t=null}function h(){t&&t.phoneNumbers.changed.off(d)}function p(){h(),n.callButtonViewModel.isOneToOneConversation()&&(t=n.callButtonViewModel.participantPerson(),t.phoneNumbers.changed(d))}function d(){n.phoneNumbers(t.phoneNumbers())}function v(){return!!n.phoneNumbers().length}function m(){var e=o.resolve(s.serviceLocator.FEATURE_FLAGS);return e.isFeatureOn(s.featureFlags.PSTN_ENABLED)}var t,n=this,r=e.historyOrigin,l=e.telemetryContext;n.callButtonViewModel=e.callButtonViewModel,n.phoneNumbers=i.observable([]),n.callButtonViewModel.conversationModel.participants.changed(p),n.getMenuOptions=function(){var e,t=[],i={getPerson:n.callButtonViewModel.participantPerson};return m()&&(f.isPstn(n.callButtonViewModel.participantPerson())||t.push(new a.CallSkypeMenuItem(i,r,l)),e=u.getCallPhoneContextMenuItems(i,r,l),e&&!!e.length&&Array.prototype.push.apply(t,e)),t},n.hasMenuOptions=function(){function e(){return n.getMenuOptions().filter(function(e){return e.isEnabled()})}return n.callButtonViewModel.isOneToOneConversation()&&v()&&e().length>1},n.dispose=function(){h(),c()}}var n=e("lodash-compat"),r=e("utils/common/eventMixin"),i=e("vendor/knockout"),s=e("constants/common"),o=e("services/serviceLocator"),u=e("ui/contextMenu/menuItemHelper"),a=e("ui/contextMenu/items/all"),f=e("ui/modelHelpers/personHelper");n.assign(l.prototype,r),t.classFunction=l,t.build=function(e){return new l(e)}}),define("text!views/calling/startCallButton.html",[],function(){return"<swx-button params=\"icon: 'callStart',\r\n                cssClass: 'primary circle',\r\n                disabled: callButtonViewModel.isAudioDisabled,\r\n                textKey: 'button_text_audioCall',\r\n                i18nTitle: callButtonViewModel.buttonCallTitle,\r\n                action: callButtonViewModel.startCallWithAudio,\r\n                ariaLabel: callButtonViewModel.buttonCallAriaLabel\"></swx-button>\r\n"}),define("ui/components/calling/startCallButton",["require","exports","module","vendor/knockout","ui/viewModels/calling/startCallButtonViewModel","constants/components","text!views/calling/startCallButton.html"],function(e,t){function i(e,t){var i=r.build(e);return i.setContext(n.dataFor(t.element)),i}var n=e("vendor/knockout"),r=e("ui/viewModels/calling/startCallButtonViewModel");t.name=e("constants/components").calling.START_CALL_BUTTON,t.template=e("text!views/calling/startCallButton.html"),t.viewModel={createViewModel:i}}),define("ui/calling/telemetry/cqfActions",["require","exports","module","constants/common","experience/settings","ui/telemetry/telemetryClient"],function(e,t){function o(){function e(e){var s=n.NA,o={call_id:e.callId||s,node_id:e.nodeId||s,endpoint_id:e.ngcEndpointId||s,participant_id:e.ngcParticipantId||s,call_mos_score_questionary_id:e.questionaryId||s,call_mos_score:e.score,call_mos_score_tracking_reason:e.reason,call_mos_score_problem_tokens:t(e)};i.get().sendEvent(r.telemetry.uiTenantToken,n.MASTER_EVENT,o)}function t(e){var t=n.PROBLEM_TOKEN_PREFIX,r="%20",i=e.tokensSelected||[];i.forEach(function(e){e.token&&(t+=r+e.token)});var s=e.othersSelected||[];return s.forEach(function(e){e.token&&e.value&&(t+=r+e.token+"&"+e.token+"="+encodeURIComponent(e.value))}),t}this.submit=function(t){if(typeof t.score!="number")return this.cancel(t);t.reason=n.reason.RANDOM,e(t)},this.cancel=function(t){t.score=n.CANCEL_SCORE,t.reason=n.reason.CANCEL,t.problemTokens=n.PROBLEM_TOKEN_PREFIX,t.tokensSelected=[],t.othersSelected=[],e(t)}}var n=e("constants/common").telemetry.callQualityFeedback,r=e("experience/settings"),i=e("ui/telemetry/telemetryClient"),s;t.get=function(){return s||(s=new o),s}}),define("services/cqf/questionnaire",[],function(){return[{qid:103},{category:"q",token:101,uri:"skype:?cqg&target=audio.nolocal&ui_entrypoint=cqf",text:"cqf_audio_nolocal"},{category:"q",token:102,uri:"skype:?cqg&target=audio.noremote&ui_entrypoint=cqf",text:"cqf_audio_noremote"},{category:"q",token:103,uri:"skype:?cqg&target=audio.quality.echo&ui_entrypoint=cqf",text:"cqf_audio_quality_echo"},{category:"q",token:104,uri:"skype:?cqg&target=audio.quality.noise&ui_entrypoint=cqf",text:"cqf_audio_quality_noise"},{category:"q",token:105,uri:"skype:?cqg&target=audio.quality.volume&ui_entrypoint=cqf",text:"cqf_audio_quality_volume"},{category:"q",token:106,uri:"skype:?cqg&target=audio.dropped&ui_entrypoint=cqf",text:"cqf_audio_dropped"},{category:"q",token:107,uri:"skype:?cqg&target=audio.quality.distorted&ui_entrypoint=cqf",text:"cqf_audio_quality_distorted"},{category:"q",token:108,uri:"skype:?cqg&target=audio.quality.delay&ui_entrypoint=cqf",text:"cqf_audio_quality_delay"},{category:"pq",token:301,uri:"skype:?cqg&target=audio.quality.dialpad&ui_entrypoint=cqf",text:"cqf_audio_quality_dialpad"},{category:"qe",token:109,uri:"skype:?cqg&target=audio.other&ui_entrypoint=cqf",text:"cqf_audio_other",editlength:100},{category:"vq",token:201,uri:"skype:?cqg&target=video.nolocal&ui_entrypoint=cqf",text:"cqf_video_nolocal"},{category:"vq",token:202,uri:"skype:?cqg&target=video.noremote&ui_entrypoint=cqf",text:"cqf_video_noremote"},{category:"vq",token:203,uri:"skype:?cqg&target=video.quality.poor&ui_entrypoint=cqf",text:"cqf_video_quality_poor"},{category:"vq",token:204,uri:"skype:?cqg&target=video.quality.freezing&ui_entrypoint=cqf",text:"cqf_video_quality_freezing"},{category:"vq",token:205,uri:"skype:?cqg&target=video.dropped&ui_entrypoint=cqf",text:"cqf_video_dropped"},{category:"vq",token:206,uri:"skype:?cqg&target=video.quality.dark&ui_entrypoint=cqf",text:"cqf_video_quality_dark"},{category:"vq",token:207,uri:"skype:?cqg&target=video.quality.sync&ui_entrypoint=cqf",text:"cqf_video_quality_sync"},{category:"vqe",token:208,uri:"skype:?cqg&target=video.other&ui_entrypoint=cqf",text:"cqf_video_other",editlength:100}]}),define("ui/viewModels/calling/cqfViewModel",["require","lodash-compat","constants/calling","ui/calling/telemetry/cqfActions","browser/document","utils/common/eventMixin","swx-i18n","vendor/knockout","services/cqf/questionnaire","utils/common/scroll","experience/settings","browser/window"],function(e){function h(){function y(){function t(e){return e.category==="q"||e.category==="qe"}function n(e){return e.category==="pq"}function r(e){return e.category==="vq"||e.category==="vqe"}a.forEach(function(i){i.checked=u.observable(!1),i.comment=u.observable(),i.qid&&(e.callData.questionaryId=i.qid),t(i)&&e.audioQuestions.push(i),n(i)&&e.isPSTN&&e.audioQuestions.push(i),r(i)&&e.isVideoCall&&e.videoQuestions.push(i)})}function b(){s=c.setTimeout(e.close,l.cqf.inactivityTimeout)}function w(){s&&(c.clearTimeout(s),s=null)}function E(){var e=i.querySelector(".CallQualityFeedback-starRating .selected");if(e)return e}function S(e){e.firstElementChild.classList.remove(m),e.firstElementChild.classList.add(v)}function x(e){e.firstElementChild.classList.remove(v),e.firstElementChild.classList.add(m)}function T(e){var t=e.previousElementSibling;while(t&&t.classList.contains(p))S(t),t=t.previousElementSibling}function N(){var e=E();C(),e&&(S(e),T(e))}function C(){var e;for(e=0;e<h.length;++e)x(h[e])}function k(){w(),r.get().cancel(e.callData),e.selectedStar(0)}var e=this,t,s,h=i.querySelectorAll(".CallQualityFeedback-starRating .btn"),p="btn",d="selected",v="favouriteOn",m="favouriteOff";e.currentStep=u.observable(1),e.selectedStar=u.observable(-1),e.canBeSubmitted=u.observable(!1),e.audioQuestions=[],e.videoQuestions=[],e.activitySubscriptions=[];var g=e.selectedStar.subscribe(function(){e.canBeSubmitted(!0),w()});e.init=function(r,i){e.isVideoCall=r.callData.isVideo,e.isPSTN=r.callData.isPSTN,e.callData=r.callData,e.questionsTitle=u.computed(function(){return e.isVideoCall?o.fetch({key:"cqf_video_title"}):o.fetch({key:"cqf_audio_title"})}),t=f.build(i),t.init(),y(),b(),e.registerEvent(n.EVENTS.CQF_CANCEL,k)},e.starMouseoverHandler=function(e,t){var n=t.currentTarget;S(n),T(n)},e.starMouseoutHandler=function(){N()},e.starClickHandler=function(t,n){var r=n.currentTarget,i=E();i&&i.classList.remove(d),e.selectedStar(parseInt(r.getAttribute("data-value"))),r.classList.add(d),N()},e.close=function(){k(),e.dispatchEvent(n.EVENTS.CQF_SCREEN_CLOSE,e.DIRECTION.PARENT)},e.submit=function(){e.selectedStar()===4||e.currentStep()===2?(e.callData.score=e.selectedStar(),e.callData.tokensSelected=[],e.callData.othersSelected=[],e.audioQuestions.concat(e.videoQuestions).forEach(function(t){t.checked()&&e.callData.tokensSelected.push({token:t.token}),t.comment()&&t.comment().trim().length>1&&e.callData.othersSelected.push({token:t.token,value:t.comment()})}),r.get().submit(e.callData),e.dispatchEvent(n.EVENTS.CQF_SCREEN_CLOSE,e.DIRECTION.PARENT)):e.currentStep(2)},e.dispose=function(){t.dispose(),g.dispose()}}var t=e("lodash-compat"),n=e("constants/calling"),r=e("ui/calling/telemetry/cqfActions"),i=e("browser/document"),s=e("utils/common/eventMixin"),o=e("swx-i18n").localization,u=e("vendor/knockout"),a=e("services/cqf/questionnaire"),f=e("utils/common/scroll"),l=e("experience/settings"),c=e("browser/window");return t.assign(h.prototype,s),{build:function(){return new h}}}),define("text!views/calling/cqf.html",[],function(){return'<div class="CallQualityFeedback scrollWrapper">\r\n    <div class="scrollViewport scrollViewportV">\r\n	    <div class="CallQualityFeedback-content">\r\n\r\n	    	<!-- ko if: currentStep() === 1 -->\r\n	    	<div class="CallQualityFeedback-step1">\r\n				<h1 data-bind="l10n: {key: \'cqf_title\'}"></h1>\r\n\r\n				<div class="CallQualityFeedback-starRating">\r\n                    <button class="btn transparent" type="button" data-bind="event: {mouseover: starMouseoverHandler, mouseout: starMouseoutHandler}, click: starClickHandler" data-value="0">\r\n                        <span class="iconfont favouriteOff"></span>\r\n                    </button>\r\n                    <button class="btn transparent" type="button" data-bind="event: {mouseover: starMouseoverHandler, mouseout: starMouseoutHandler}, click: starClickHandler" data-value="1">\r\n                        <span class="iconfont favouriteOff"></span>\r\n                    </button>\r\n                    <button class="btn transparent" type="button" data-bind="event: {mouseover: starMouseoverHandler, mouseout: starMouseoutHandler}, click: starClickHandler" data-value="2">\r\n                        <span class="iconfont favouriteOff"></span>\r\n                    </button>\r\n                    <button class="btn transparent" type="button" data-bind="event: {mouseover: starMouseoverHandler, mouseout: starMouseoutHandler}, click: starClickHandler" data-value="3">\r\n                        <span class="iconfont favouriteOff"></span>\r\n                    </button>\r\n                    <button class="btn transparent" type="button" data-bind="event: {mouseover: starMouseoverHandler, mouseout: starMouseoutHandler}, click: starClickHandler" data-value="4">\r\n                        <span class="iconfont favouriteOff"></span>\r\n                    </button>\r\n				</div>\r\n\r\n				<div class="CallQualityFeedback-Actions">\r\n					<!-- ko if: !canBeSubmitted() -->\r\n					<button class="btn transparent" data-bind="click: close" type="button">\r\n						<span class="iconfont cancel"></span>\r\n					</button>\r\n					<!-- /ko -->\r\n\r\n					<!-- ko if: canBeSubmitted() -->\r\n					<button class="btn transparent" data-bind="click: submit" type="button">\r\n						<span class="iconfont ok"></span>\r\n					</button>\r\n					<!-- /ko -->\r\n				</div>\r\n			</div>\r\n			<!-- /ko -->\r\n\r\n			<!-- ko if: currentStep() === 2 -->\r\n			<div class="CallQualityFeedback-QuestionsWrapper CallQualityFeedback-step2" data-bind="css: {\'CallQualityFeedback-QuestionWrapper--withVideo\': isVideoCall}">\r\n				<h2 data-bind="text: questionsTitle"></h2>\r\n\r\n				<div class="CallQualityFeedback-Questions">\r\n					<div class="CallQualityFeedback-audioQuestions">\r\n						<h3 data-bind="l10n: {key: \'cqf_audio_tokens_title\'}"></h3>\r\n						<!-- ko foreach: audioQuestions -->\r\n						<swx-cqf-question params="question: $data"></swx-cqf-question>\r\n						<!-- /ko -->\r\n					</div>\r\n\r\n					<!-- ko if: isVideoCall -->\r\n					<div class="CallQualityFeedback-videoQuestions">\r\n						<h3 data-bind="l10n: {key: \'cqf_video_tokens_title\'}"></h3>\r\n						<!-- ko foreach: videoQuestions -->\r\n						<swx-cqf-question params="question: $data"></swx-cqf-question>\r\n						<!-- /ko -->\r\n					</div>\r\n					<!-- /ko -->\r\n				</div>\r\n\r\n				<div class="CallQualityFeedback-Actions">\r\n					<button class="btn transparent" data-bind="click: submit" type="button">\r\n						<span class="iconfont ok"></span>\r\n					</button>\r\n				</div>\r\n			</div>\r\n			<!-- /ko -->\r\n\r\n		</div>\r\n	</div>\r\n</div>'}),define("ui/components/calling/cqf",["require","exports","module","vendor/knockout","ui/viewModels/calling/cqfViewModel","constants/components","text!views/calling/cqf.html"],function(e,t){function i(e,t){var i=r.build(),s=t.element.getElementsByClassName("scrollWrapper")[0];return i.setContext(n.dataFor(t.element)),i.init(e,s),i}var n=e("vendor/knockout"),r=e("ui/viewModels/calling/cqfViewModel");t.name=e("constants/components").calling.CQF,t.template=e("text!views/calling/cqf.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/calling/cqfQuestionViewModel",[],function(){function e(e){var t=this;t.text=e.question.text,t.checked=e.question.checked,t.comment=e.question.comment,t.editlength=e.question.editlength,t.isWithTextarea=!!e.question.editlength,t.clickAction=function(){t.isWithTextarea||t.checked(!t.checked())},t.checkCommentLength=function(){t.comment().length>t.editlength&&t.comment(t.comment().substring(0,t.editlength))}}return{build:function(t){return new e(t)}}}),define("text!views/calling/cqfQuestion.html",[],function(){return'<div class="CallQualityFeedbackQuestion" data-bind="click: clickAction, css: {\'CallQualityFeedbackQuestion--withTextarea\': editlength}">\r\n	<div class="CallQualityFeedbackQuestion-text" data-bind="l10n: {key: text}"></div>\r\n\r\n	<!-- ko if: !isWithTextarea -->\r\n	<div class="CallQualityFeedbackQuestion-checkbox" data-bind="css: {\'CallQualityFeedbackQuestion-checkbox--checked\': checked()}">\r\n		<div></div>\r\n	</div>\r\n	<!-- /ko -->\r\n\r\n	<!-- ko if: isWithTextarea -->\r\n	<textarea class="CallQualityFeedbackQuestion-textarea" data-bind="textInput: comment, valueUpdate: \'afterkeydown\', event: {\'keyup\': checkCommentLength }, attr: {maxlength: editlength}"></textarea>\r\n	<!-- /ko -->\r\n</div>'}),define("ui/components/calling/cqfQuestion",["require","exports","module","ui/viewModels/calling/cqfQuestionViewModel","constants/components","text!views/calling/cqfQuestion.html"],function(e,t){function r(e){return n.build(e)}var n=e("ui/viewModels/calling/cqfQuestionViewModel");t.name=e("constants/components").calling.CQF_QUESTION,t.template=e("text!views/calling/cqfQuestion.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/calling/skypeOutViewModel",["require","exports","module","lodash-compat","constants/common","browser/dom","utils/common/scroll","utils/common/eventMixin"],function(e,t){function u(){var e=this,t,n,o="#SkypeOutBody-scrollWrapper";e.init=function(u){e.forwardEvent(r.events.skypeOut.DIAL_BUTTON_CLICKED,e.DIRECTION.CHILD),n=i.getElement(o,u),t=s.build(n),t.init()},e.dispose=function(){t.dispose()}}var n=e("lodash-compat"),r=e("constants/common"),i=e("browser/dom"),s=e("utils/common/scroll"),o=e("utils/common/eventMixin");n.assign(u.prototype,o),t.build=function(){return new u}}),define("text!views/calling/skypeOut.html",[],function(){return'<div class="SkypeOutPage themeWhite" data-swx-testId="skypeOutPage">\r\n    <swx-skype-out-header class="SkypeOutHeader"></swx-skype-out-header>\r\n\r\n    <div class="SkypeOutPage-body" id="SkypeOutBody-scrollWrapper">\r\n        <div class="scrollViewport scrollViewportV" tabindex="-1">\r\n            <div class="SkypeOutBody-scrollContent scrollViewport-inner">\r\n                <div class="SkypeOutPage-content">\r\n                    <swx-dialpad role="list" class="DialPad" data-bind="keyboardNavigation: { itemSelector: \'.DialPad-key\' }" data-swx-testId="skypeOut-dialpad"></swx-dialpad>\r\n                    <div class="SkypeOutOffers">\r\n                        <swx-credit-balance class="SkypeOutOffer SkypeOutOffer--creditBalance"></swx-credit-balance>\r\n                        <swx-subscription-entitlement class="SkypeOutOffer SkypeOutOffer--subscriptionEntitlement"></swx-subscription-entitlement>\r\n\r\n                        <div class="SkypeOutOffer SkypeOutOffer--pstnNotice">\r\n                            <div class="SkypeOutOffer-body">\r\n                                <span class="iconfont callDisabledStatus SkypeOutOffer-icon SkypeOutOffer-icon--callDisabledStatus"></span>\r\n                                <div class="SkypeOutOffer-content">\r\n                                    <p class="SkypeOutOffer-text" data-bind="l10n: { key: \'pstn_emergency_notice_text\' }">Skype for Web (Beta) is not a replacement for your telephone and can\'t be used for emergency calling.</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/calling/skypeOut",["require","exports","module","vendor/knockout","ui/viewModels/calling/skypeOutViewModel","constants/components","text!views/calling/skypeOut.html"],function(e,t){function i(e,t){var i=r.build(),s=n.dataFor(t.element);return i.setContext(s),i.init(t.element),i}var n=e("vendor/knockout"),r=e("ui/viewModels/calling/skypeOutViewModel");t.name=e("constants/components").calling.SKYPEOUT_PAGE,t.template=e("text!views/calling/skypeOut.html"),t.viewModel={createViewModel:i}}),define("utils/common/localStorage",[],function(){function e(){try{return window&&window.localStorage}catch(e){}}return{set:function(t,n){if(e())try{window.localStorage.setItem(t,n)}catch(r){}},get:function(t){if(e())try{return window.localStorage.getItem(t)}catch(n){}},remove:function(t){if(e())try{window.localStorage.removeItem(t)}catch(n){}}}}),define("ui/viewModels/calling/skypeOut/skypeOutHeaderViewModel",["require","exports","module","lodash-compat","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","cafe/applicationInstance","ui/viewModels/calling/helpers/callingFacade","constants/common","constants/people","swx-enums","utils/common/eventHelper","utils/common/eventMixin","utils/common/localStorage","constants/keys","vendor/knockout","telemetry/calling/pstn/pstn","services/serviceLocator","swx-utils-common","ui/controls/calling/sounds","constants/common"],function(e,t){function S(){function C(){e.hasFocus(!0)}function k(){e.hasFocus(!1)}function L(e){T=e}function A(e){t.selectionStart=e,t.selectionEnd=e}function O(e){e&&(T=null)}function M(t){if(t===N)return;E.test(t)?(N=t,_(t)||e.dispatchEvent(u.events.skypeOut.INPUT_CHANGED,e.skypeOutInput(),e.DIRECTION.CHILD)):(e.skypeOutInput(N),O(!0))}function _(t){var n,r;return n=t.substr(0,2),n==="00"?(r="+"+t.substr(2),e.skypeOutInput(r),e.hasFocus()?A(1):L(1),!0):!1}function D(){return T!==null}function P(){D()||C()}var e=this,t,n=m.resolve(u.serviceLocator.PUBSUB),a=m.resolve(u.serviceLocator.MODEL_UI_OBSERVER).conversationsCallStateObserver,c,S,x,T=null,N="";e.hasFocus=d.observable(!0),e.skypeOutInput=d.observable(""),e.isCallButtonDisabled=d.computed(function(){return a.activeCalls().length>0||e.skypeOutInput().length<3}),e.selectedCountry=d.observable(),e.init=function(r){t=r,e.registerEvent(u.events.skypeOut.DIAL_BUTTON_CLICKED,e.insertAtCursor),n.subscribe(u.events.navigation.FRAGMENT_LOADED,C),c=e.skypeOutInput.subscribe(M),S=e.selectedCountry.subscribe(P),x=e.hasFocus.subscribe(O)},e.insertAtCursor=function(n){var r,i,s,o,u;i=D()?T:t.selectionStart,s=D()?T:t.selectionEnd,r=i,o=e.skypeOutInput(),u=g.inject(o,n.text,i,s),L(r+n.text.length),e.skypeOutInput(u)},e.onKeyDown=function(t,n){var r=l.getKeyCode(n);if(r===p.ESCAPE){e.skypeOutInput()?(e.resetSkypeOutInput(),C()):k(),n.stopPropagation();return}if(r===p.ENTER){e.skypeOutInput()&&!e.isCallButtonDisabled()&&e.callPSTN(),n.stopPropagation();return}return!0},e.callPSTN=function(){function l(){return y.playOnce(y.KEYS.CALL_DIALING),o.placeCall(n,!1,u.telemetry.historyLoadOrigin.SKYPEOUT_PAGE,!0)}function c(e){var t=n.participants(0),r=t.person.phoneNumbers(0)?t.person.phoneNumbers(0).telUri():e;t.audio.endpoint&&t.audio.endpoint(r)}function p(){var e=m.resolve(u.serviceLocator.ACTION_TELEMETRY),t={source:i.skypeOutPage.skypeOutHeader,phoneNumberType:f.phoneType.Other};e.recordAction(r.audioVideo.pstnCall,t)}function d(){p(),v.initiatingPSTNCall(b.entryPoint.SKYPE_OUT_PAGE)}var t,n,a=e.skypeOutInput().replace(/\s+/g,"");return a.charAt(0)!=="+"?(e.dispatchEvent(u.events.selectBox.TOGGLE,e.DIRECTION.CHILD),Promise.reject()):(a="+"+a.replace(/\D+/g,""),d(),t=s.get().conversationsManager,n=t.getConversationByUri(w+a),!n.audioService.start.enabled()&&n.audioService.start.enabled.reason!==f.callingNotSupportedReasons.PluginNotInstalled?Promise.reject(Error("Audio service disabled: "+n.audioService.start.enabled.reason)):(c(a),h.set(u.storageKeys.RECENT_COUNTRY,JSON.stringify(e.selectedCountry())),l()))},e.resetSkypeOutInput=function(){e.skypeOutInput("")},e.dispose=function(){n.unsubscribe(u.events.navigation.FRAGMENT_LOADED,C),e.isCallButtonDisabled.dispose(),c.dispose(),S.dispose(),x.dispose()},e.resetSkypeOutInputViaKey=function(t,n){var r=l.getKeyCode(n);return r===p.ENTER&&(e.resetSkypeOutInput(),e.hasFocus(!0),n.stopPropagation()),!0}}var n=e("lodash-compat"),r=e("ui/telemetry/actions/actionNames"),i=e("ui/telemetry/actions/actionSources"),s=e("cafe/applicationInstance"),o=e("ui/viewModels/calling/helpers/callingFacade"),u=e("constants/common"),a=e("constants/people"),f=e("swx-enums"),l=e("utils/common/eventHelper"),c=e("utils/common/eventMixin"),h=e("utils/common/localStorage"),p=e("constants/keys"),d=e("vendor/knockout"),v=e("telemetry/calling/pstn/pstn"),m=e("services/serviceLocator"),g=e("swx-utils-common").stringUtils,y=e("ui/controls/calling/sounds"),b=e("constants/common").telemetry.pstn,w=a.contactTypes.PSTN+":",E=/^(\+?[\s\d\-]*$)/;n.assign(S.prototype,c),t.build=function(){return new S}}),define("text!views/calling/skypeOut/skypeOutHeader.html",[],function(){return'<div class="SkypeOutHeader-main" data-swx-testId="skypeOut-header">\r\n    <div class="SkypeOutHeader-inner">\r\n        <input type="text" name="skypeOutInput" class="SkypeOutHeader-input" data-bind="hasFocus: hasFocus,\r\n           event: { keydown: onKeyDown },\r\n           l10n_attr: {\'placeholder\': \'input_text_skypeOut_short\'},\r\n           textInput: skypeOutInput" />\r\n        <swx-countrypicker params="selectedCountry: selectedCountry, skypeOutInput: skypeOutInput"></swx-countrypicker>\r\n    </div>\r\n    <div class="SkypeOutHeader-clrBtn">\r\n        <button data-bind="visible: skypeOutInput().length,\r\n            event: { mousedown: resetSkypeOutInput, keypress: resetSkypeOutInputViaKey },\r\n            l10n_attr: { \'aria-label\': \'clear_phonenumber_input_label\', title: \'clear_phonenumber_input_label\' }"\r\n            type="button" class="btn primary circle small transparent">\r\n            <span class="iconfont cross"></span>\r\n        </button>\r\n    </div>\r\n</div>\r\n<div class="SkypeOutHeader-controls">\r\n    <div class="buttonRow">\r\n        <swx-button class="callButtons" params="icon: \'callStart\', cssClass: \'primary circle\', disabled: isCallButtonDisabled, action: callPSTN, titleKey: \'startCall_tooltip\', textKey: \'startCall_tooltip\',\r\n                        ariaLabelKey: \'accessibility_startCall_ariaLabel\'"></swx-button>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/calling/skypeOut/skypeOutHeader",["require","exports","module","browser/dom","vendor/knockout","ui/viewModels/calling/skypeOut/skypeOutHeaderViewModel","constants/components","text!views/calling/skypeOut/skypeOutHeader.html"],function(e,t){function s(e,t){var s=t.element,o=n.getElement(".SkypeOutHeader-input",s),u=i.build(),a=r.dataFor(s);return u.setContext(a),u.init(o),u}var n=e("browser/dom"),r=e("vendor/knockout"),i=e("ui/viewModels/calling/skypeOut/skypeOutHeaderViewModel");t.name=e("constants/components").calling.SKYPEOUT_HEADER,t.template=e("text!views/calling/skypeOut/skypeOutHeader.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/calling/skypeOut/skypeOutDialpadViewModel",["require","lodash-compat","constants/common","utils/common/eventMixin","utils/common/eventHelper","constants/keys"],function(e){function o(){function u(i,s){var u,a;return r?(a=s&&o?s-o>t:!1,a&&(u=r.attributes.getNamedItem("data-secondary")),u||(u=r.attributes.getNamedItem("data-key")),u&&e.dispatchEvent(n.events.skypeOut.DIAL_BUTTON_CLICKED,{text:u.value,inputType:i}),r=null,o=null,!1):!1}var e=this,t=600,r,o;e.onMouseDown=function(e,t){return r=t.currentTarget,o=t.timeStamp,!0},e.onTouchStart=function(e,t){return r=t.currentTarget,o=t.timeStamp,!1},e.onKeyDown=function(e,t){var n=i.getKeyCode(t);return n!==s.SPACE?!0:r?!1:(r=t.currentTarget,o=t.timeStamp,!1)},e.onKeyUp=function(e,t){return u(n.events.skypeOut.INPUT_TYPE_KEYBOARD,t.timeStamp),!0},e.onTouchEnd=function(e,t){u(n.events.skypeOut.INPUT_TYPE_TOUCH,t.timeStamp)},e.onMouseUp=function(e,t){u(n.events.skypeOut.INPUT_TYPE_MOUSE,t.timeStamp)}}var t=e("lodash-compat"),n=e("constants/common"),r=e("utils/common/eventMixin"),i=e("utils/common/eventHelper"),s=e("constants/keys");return t.assign(o.prototype,r),o}),define("text!views/calling/skypeOut/dialpad.html",[],function(){return'<div class="DialPad-row">\r\n    <div role="listitem" class="DialPad-key" data-key="1" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd,  mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">1</div>\r\n        <div class="title"></div>\r\n    </div>\r\n    <div role="listitem" class="DialPad-key" data-key="2" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">2</div>\r\n        <div class="title">ABC</div>\r\n    </div>\r\n    <div role="listitem" class="DialPad-key" data-key="3" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">3</div>\r\n        <div class="title">DEF</div>\r\n    </div>\r\n</div>\r\n<div class="DialPad-row">\r\n    <div role="listitem" class="DialPad-key" data-key="4" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">4</div>\r\n        <div class="title">GHI</div>\r\n    </div>\r\n    <div role="listitem" class="DialPad-key" data-key="5" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">5</div>\r\n        <div class="title">JKL</div>\r\n    </div>\r\n    <div role="listitem" class="DialPad-key" data-key="6" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">6</div>\r\n        <div class="title">MNO</div>\r\n    </div>\r\n</div>\r\n<div class="DialPad-row">\r\n    <div role="listitem" class="DialPad-key" data-key="7" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">7</div>\r\n        <div class="title">PQRS</div>\r\n    </div>\r\n    <div role="listitem" class="DialPad-key" data-key="8" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">8</div>\r\n        <div class="title">TUV</div>\r\n    </div>\r\n    <div role="listitem" class="DialPad-key" data-key="9" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">9</div>\r\n        <div class="title">WXYZ</div>\r\n    </div>\r\n\r\n</div>\r\n<div class="DialPad-row">\r\n    <div role="listitem" class="DialPad-key" data-key="*" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">*</div>\r\n    </div>\r\n    <div role="listitem" class="DialPad-key" data-key="0" data-secondary="+" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchcancel: onTouchEnd, touchend: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">0</div>\r\n        <div class="title">+</div>\r\n    </div>\r\n    <div role="listitem" class="DialPad-key" data-key="#" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd,touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">#</div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/calling/skypeOut/dialpad",["require","exports","module","vendor/knockout","ui/viewModels/calling/skypeOut/skypeOutDialpadViewModel","constants/components","text!views/calling/skypeOut/dialpad.html"],function(e,t){function i(e,t){var i=n.dataFor(t.element),s=new r;return s.setContext(i),s}var n=e("vendor/knockout"),r=e("ui/viewModels/calling/skypeOut/skypeOutDialpadViewModel");t.name=e("constants/components").calling.SKYPEOUT_DIALPAD,t.template=e("text!views/calling/skypeOut/dialpad.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/calling/skypeOut/countryPickerViewModel",["require","exports","module","lodash-compat","constants/common","utils/common/eventMixin","vendor/knockout","swx-i18n","utils/common/localStorage","services/serviceLocator","experience/settings","swx-utils-common","browser/window"],function(e,t){function h(e){function y(e){return!s.isObservable(e)}function b(e){var n=w(e.substring(0,d));n!==i&&(i=n,t.selectedCountry(i))}function w(e){return e.length===0?null:e in t.countriesMap?t.countriesMap[e]:w(e.substring(0,e.length-1))}function E(e){var t;e?t=e.value:t="",e!==i&&(i?h(h().replace(i.value,t)):t!==""&&h(t+" "+h())),i=e}function S(e){var n;t.selectedCountry(null);for(n=0;n<e.length;n++)if(e[n].name===m.name&&e[n].value===m.value&&e[n].description===m.description){t.selectedCountry(e[n]),m=e[n];return}}function x(e){function a(){return r.length>0&&r[r.length-1].value===s}var n=JSON.parse(e).destinations,r=[],i,s,o,u;for(u=0;u<n.length;u++){i=n[u],s="+"+i.countryPrefix;if(!i.countryPrefix||a(r,s))continue;o={value:s,name:i.name,description:l.forceLTREmbedding(s)},t.countriesMap[s]=o,r.push(o)}r.sort(function(e,t){return e.name.localeCompare(t.name,f.initParams.locale)}),t.countries(r),m&&S(r)}function T(){var e=new XMLHttpRequest,t="?language="+f.initParams.locale+"&currency=USD&expand=country-prefix&host="+c.location.hostname+"&client="+f.version;e.addEventListener("readystatechange",function(){this.readyState===4&&(this.status===200?x(this.responseText):p||(p=!0,T()))}),e.open("GET",f.assetsServiceHost+t),e.send()}function N(){m?(t.countries().push(m),t.selectedCountry(m)):t.countries().push(g)}function C(){m&&h()===""&&t.selectedCountry(m)}var t=this,n,i,h,p=!1,d=6,v=a.resolve(r.serviceLocator.PUBSUB),m,g={value:"",name:o.fetch({key:"splashScreen_text_loading"}),description:""};if(y(e.skypeOutInput)||y(e.selectedCountry))throw new Error("[CountryPicker] Passing incorrect parameter, expecting ko.obervables.");t.countriesMap={},t.countries=s.observableArray(),t.selectedCountry=e.selectedCountry,h=e.skypeOutInput,t.init=function(){m=JSON.parse(u.get(r.storageKeys.RECENT_COUNTRY)),T(),t.registerEvent(r.events.skypeOut.INPUT_CHANGED,b),t.forwardEvent(r.events.selectBox.TOGGLE,t.DIRECTION.CHILD),n=t.selectedCountry.subscribe(E),N(),v.subscribe(r.events.navigation.FRAGMENT_LOADED,C)},t.dispose=function(){n.dispose(),v.unsubscribe(r.events.navigation.FRAGMENT_LOADED,C)}}var n=e("lodash-compat"),r=e("constants/common"),i=e("utils/common/eventMixin"),s=e("vendor/knockout"),o=e("swx-i18n").localization,u=e("utils/common/localStorage"),a=e("services/serviceLocator"),f=e("experience/settings"),l=e("swx-utils-common").stringUtils,c=e("browser/window");n.assign(h.prototype,i),t.build=function(e){return new h(e)}}),define("text!views/calling/skypeOut/countryPicker.html",[],function(){return'<div class="SkypeOutHeader-countryPicker" data-swx-testId="skypeOut-countryPicker">\r\n    <swx-select-box class="SelectBox" params="selectOptions: countries, selectedOption: selectedCountry, placeholderKey: \'select_placeholder_skypeOut\'"></swx-select-box>\r\n</div>\r\n'}),define("ui/components/calling/skypeOut/countryPicker",["require","exports","module","ui/viewModels/calling/skypeOut/countryPickerViewModel","vendor/knockout","constants/components","text!views/calling/skypeOut/countryPicker.html"],function(e,t){function i(e,t){var i=n.build(e),s=t.element,o=r.dataFor(s);return i.setContext(o),i.init(),i}var n=e("ui/viewModels/calling/skypeOut/countryPickerViewModel"),r=e("vendor/knockout");t.name=e("constants/components").calling.SKYPEOUT_COUNTRY_PICKER,t.template=e("text!views/calling/skypeOut/countryPicker.html"),t.viewModel={createViewModel:i}}),define("ui/components/calling/index",["require","ui/components/calling/callScreen","ui/components/calling/participant","ui/components/calling/participantMenu","ui/components/calling/roster","ui/components/calling/callAnimation","ui/components/calling/endCall","ui/components/calling/callScreenContent","ui/components/calling/callScreenHeader","ui/components/calling/callScreenFooter","ui/components/calling/joinCallButton","ui/components/calling/startCallButton","ui/components/calling/cqf","ui/components/calling/cqfQuestion","ui/components/calling/skypeOut","ui/components/calling/skypeOut/skypeOutHeader","ui/components/calling/skypeOut/dialpad","ui/components/calling/skypeOut/countryPicker"],function(e){return[e("ui/components/calling/callScreen"),e("ui/components/calling/participant"),e("ui/components/calling/participantMenu"),e("ui/components/calling/roster"),e("ui/components/calling/callAnimation"),e("ui/components/calling/endCall"),e("ui/components/calling/callScreenContent"),e("ui/components/calling/callScreenHeader"),e("ui/components/calling/callScreenFooter"),e("ui/components/calling/joinCallButton"),e("ui/components/calling/startCallButton"),e("ui/components/calling/cqf"),e("ui/components/calling/cqfQuestion"),e("ui/components/calling/skypeOut"),e("ui/components/calling/skypeOut/skypeOutHeader"),e("ui/components/calling/skypeOut/dialpad"),e("ui/components/calling/skypeOut/countryPicker")]}),define("experience/components/calling",["require","exports","module","services/telemetry/common/telemetry","services/telemetry/common/instrumentation","services/telemetry/calling.instrumentation.eventTypes","constants/common","constants/calling","services/serviceLocator","ui/controls/calling/endCallControl","ui/controls/calling/micControl","ui/components/calling/index","ui/components/registrar"],function(e,t){function h(){var e=r.create(i);n.instrumentAllEvents(e)}var n=e("services/telemetry/common/telemetry"),r=e("services/telemetry/common/instrumentation"),i=e("services/telemetry/calling.instrumentation.eventTypes"),s=e("constants/common"),o=e("constants/calling"),u=e("services/serviceLocator"),a=e("ui/controls/calling/endCallControl"),f=e("ui/controls/calling/micControl"),l=e("ui/components/calling/index"),c=e("ui/components/registrar");t.init=function(e){var t=u.resolve(s.serviceLocator.FEATURE_FLAGS),n=u.resolve(s.serviceLocator.CONTROLS_BUILDER);n.register(a),n.register(f),c.register(l),t.isFeatureOn(o.FEATURE_FLAGS.CALLING)&&h(),e()}}),define("utils/chat/urlParser",[],function(){return{getParam:function(e,t){var n=decodeURIComponent(e),r=new RegExp("("+t+")=([^&]+)"),i=n.match(r);return i&&i[2]?i[2]:undefined},getRoute:function(e){var t=new RegExp(/index[^#]*#(.+)\//),n=e&&e.match(t);return n&&n[1]?n[1]:undefined},isHttps:function(e){return/^https:/.test(e)},isYoutubeLink:function(e){var t=/(?:youtube\.com|youtu\.be)\/watch(?:\?|\&|&amp;)v=([\w-]{11})/.exec(e);return t||(t=/(?:youtube\.com|youtu\.be)\/([\w-]{11})/.exec(e)),t?!0:!1}}}),define("utils/chat/conversationCache",["require","exports","module"],function(e,t){var n=[];t.forModel=function(e){var t=n.filter(function(t){return t.model===e})[0];return t||(t={model:e},n.push(t)),t}}),define("ui/viewModels/chat/chatLog",["require","lodash-compat","browser/document","vendor/knockout","utils/common/ko","utils/common/array","utils/common/cafeObservable","constants/common","constants/common","utils/common/eventMixin","ui/contextMenu/contextMenu","ui/contextMenu/items/all","utils/chat/conversationCache","utils/common/async","services/serviceLocator","utils/common/appVisibilityProvider","swx-i18n","ui/telemetry/actions/actionSources","utils/chat/messageSanitizer","experience/settings","cafe/applicationInstance","swx-enums","ui/modelHelpers/personHelper"],function(e){function N(e){function X(t){var n=new e;return n.init(t,f.conversation),N[n.clientmessageid]=n,n}function V(e,t){(!t.text||bt(t.text()))&&s.insertAt(f.collection(),e,X(t))}function $(e,t){var n=s.removeFrom(f.collection(),e);delete N[n.clientmessageid]}function J(){var e={},t=f.collection();t.forEach(function(t){e=C.processMessage(t,e)}),C.processMyLastMessageIfAny(t),f.collection.valueHasMutated()}function K(e){i.handleArrayChanges(f.collection(),e,V,$),J()}function Q(){D=A.activityItems.subscribe()}function G(){k=O.subscribe(K,null,"arrayChange")}function Y(){if(!O)return;F.start(),Q();var e=O(),t;e.length<x&&p.execute(rt);if(e.length===0){G(),f.dispatchEvent(u.events.conversation.MESSAGES_LOADED,e,f.DIRECTION.PARENT);return}t=e.filter(function(e){return!e.text||bt(e.text())}),t=t.map(function(e){return X(e)}),r.utils.arrayPushAll(f.collection(),t),J(),G(),f.dispatchEvent(u.events.conversation.MESSAGES_LOADED,e,f.DIRECTION.PARENT)}function Z(){H&&j.isVisible()&&v.hasFocus()&&!B&&j.isScrolledCloseToBottom()&&A.markAllAsRead()}function et(){if(!j)return;if(it())return;f._updatingMessages=!0,j.showNewMessages(),f._updatingMessages=!1,U&&U(),C.processMyBeforeLastMessageIfAny(f.collection()),Z(),!j.isScrollable()&&!M&&p.execute(rt),F.registerSync()}function tt(){F.registerSync(),M=!1,et(!0)}function nt(){F.registerError()}function rt(){A.getMoreActivityItems.enabled()&&(M=!0,A.getMoreActivityItems(T).then(tt,nt))}function it(){return f.collection&&f.collection().filter(function(e){return!e.isRendered}).length>0}function st(){it()||p.execute(et)}function ot(){j.restoreScrollPosition()}function ut(){if(j.isScrollPositionStored())return;j.storeScrollPosition()}function at(e){H=!0,j.onShow(),Z(),lt(),e&&e.messageId&&ft(e.messageId)}function ft(e){var t,n=f.collection();U=null;for(t=0;t<n.length;t++){var r=n[t];if(r.clientmessageid===e){j.scrollToMessage(r),A._messagesWithUnseenHearts.remove(e),U=null;return}}U=ft.bind(null,e),rt()}function lt(){j.isScrollable()||rt()}function ct(){Z(),H=!1,j.onHide()}function ht(){function e(e){I.publish(a.interaction.SCROLL_START,e)}return t.debounce(e,1e3,{leading:!0,trailing:!1})}function pt(e){B=e,e||Z()}function dt(){A.isHistoryDisclosed()&&rt()}function vt(){var e=n.fullScreenElement&&n.fullScreenElement!==null||n.mozFullScreen||n.webkitIsFullScreen;return e||R}function mt(){R=!0}function gt(e){R=!1,e&&ft(e)}function yt(){function n(e){j.isMessageVisible(e.id)&&A._messagesWithUnseenHearts.remove(e.id)}var e=A._messagesWithUnseenHearts();if(e.length===0)return;t.forEach(e,n)}function bt(e){var n=b.messageFilters&&b.messageFilters.chatLogMessageFilter?b.messageFilters.chatLogMessageFilter:null;return t.isFunction(n)?n(e):!0}function wt(e,t){f.conversation.historyService.removeCustomActivityItem(E.activityType.ContactRequestOutgoing),f.conversation.historyService.removeCustomActivityItem(E.activityType.ContactRequestIsNowContact),f.conversation.historyService.addCustomActivityItem(e,{sender:t})}function Et(e){var t=f.participants(0).person;e.id()===t.id()&&wt(E.activityType.ContactRequestOutgoing,t)}function St(){var e;if(!z.isFeatureOn(u.featureFlags.ENABLE_BUSINESS_CONTACT_MANAGEMENT))return;if(f.conversation.isGroupConversation()||f.participants.size()!==1)return;e=f.participants(0).person,S.isKnownPerson(e)||wt(E.activityType.ContactRequestOutgoing,e),w.get().personsAndGroupsManager.all.persons.removed(Et)}function xt(){var e,t,n;f.showIntroText=z.isFeatureOn(u.featureFlags.SHOW_CHAT_INTRO_TEXT);if(!f.showIntroText)return;f.introMessages=[],b.chatIntroText&&b.chatIntroText.key&&(e=b.chatIntroText.key);if(!e)return;b.chatIntroText&&b.chatIntroText.delimiter&&(n=b.chatIntroText.delimiter),t=m.fetch({key:e});if(!t)return;n?t.split(n).forEach(function(e){f.introMessages.push({text:e.trim()})}):f.introMessages.push({text:t.trim()})}var f=this,N={},C,k,L,A,O,M,D,P,H=!0,B,j,F,I=d.resolve(u.serviceLocator.PUBSUB),q=ht(),R,U,z=d.resolve(u.serviceLocator.FEATURE_FLAGS),W=z.isFeatureOn(u.featureFlags.HEARTS_ENABLED);this.collection=r.observableArray(),this.participants=null,this.init=function(e,t,n,r){I.subscribe(u.events.narrowMode.SIDEBAR_STATE_CHANGED,pt),I.subscribe(u.events.videoPlayer.FULLSCREEN_ON,mt),I.subscribe(u.events.videoPlayer.FULLSCREEN_OFF,gt),j=t,C=n,A=e.historyService,h.forModel(e),O=o.newObservableCollection(A.activityItems),f.conversation=e,f.participants=e.participants,j.init({onContextMenu:f.showContextMenu,onMessageVisibilityChange:f.messageVisibilityChange},e),L=v.hasFocus.subscribe(Z),P=A.isHistoryDisclosed.changed(dt),this.registerEvent(a.message.RENDERED,st),this.registerEvent(a.navigation.FRAGMENT_SHOW,at,this.DIRECTION.PARENT),this.registerEvent(a.navigation.FRAGMENT_BEFORE_HIDE,ct,this.DIRECTION.PARENT),this.forwardEvent(a.navigation.FRAGMENT_BEFORE_HIDE,this.DIRECTION.CHILD,null),this.forwardEvent(a.conversation.OPEN_PROFILE,this.DIRECTION.PARENT,null,this.DIRECTION.CHILD),this.registerEvent(a.conversation.MARK_AS_READ,Z),this.registerEvent(a.message.BEFORE_EXPANDED,ut),this.registerEvent(a.message.AFTER_EXPANDED,ot),this.registerEvent(u.events.videoPlayer.FULLSCREEN_ON,ut),this.registerEvent(u.events.videoPlayer.FULLSCREEN_OFF,ot),W&&f.conversation.historyService._messagesWithUnseenHearts&&A._messagesWithUnseenHearts.changed(yt),F=r,p.execute(Y),St(),xt()},this.onScroll=function(e,t){j&&(q(t),j.onScroll(t),j.isScrolledToTop()&&!f._updatingMessages&&!vt()&&rt(),Z())},this.dispose=function(){j.dispose(),D&&D.dispose(),k&&k.dispose(),P&&P.dispose(),L.dispose(),f.ariaForNewMessage.dispose(),F.dispose(),I.unsubscribe(u.events.narrowMode.SIDEBAR_STATE_CHANGED,pt),I.unsubscribe(u.events.videoPlayer.FULLSCREEN_ON,mt),I.unsubscribe(u.events.videoPlayer.FULLSCREEN_OFF,gt),k=null,f.collection=null,j=null,O=null,N=null,W&&A._messagesWithUnseenHearts&&A._messagesWithUnseenHearts.changed.off(yt),z.isFeatureOn(u.featureFlags.ENABLE_BUSINESS_CONTACT_MANAGEMENT)&&w.get().personsAndGroupsManager.all.persons.removed.off(Et)},this.showContextMenu=function(e,t){var n=N[e],r=n&&n.model,i=[],s={source:g.conversation.messageItem},o,u=f.conversation.chatService.sendMessage.enabled();if(!r||!u)return;o={source:g.contextMenuItem.removeMessage,parent:g.conversation.messageItem},i.push(new c.QuoteMessageMenuItem(f,r)),i.push(new c.EditMessageMenuItem(f,r)),i.push(new c.RemoveMessageMenuItem(r,o)),i.push(new c.CopyLinkMenuItem(f,n)),i.push(new c.OpenLinkMenuItem(f,n)),i.push(new c.SaveVideoMessageMenuItem(r)),l.show(i,t,s)},this.messageVisibilityChange=function(e){function n(e){var t=e.attributes["data-id"].value,n=A._messagesWithUnseenHearts(t);n&&A._messagesWithUnseenHearts.remove(t)}W&&A._messagesWithUnseenHearts&&H&&A._messagesWithUnseenHearts.size()>0&&t.forEach(e,n),f.dispatchEvent(u.events.conversation.VIEWPORT_CHANGED,e,f.DIRECTION.PARENT)},this.ariaForNewMessage=r.computed(function(){var e,t,n,r,i=f.collection();return i===undefined||i.length<=0?"":(n=i[i.length-1],n.authorName&&(e=n.authorName()),n.author&&n.author.displayName&&(e=n.author.displayName()),r=y.stripHTML(n.content()),t=m.fetch({key:"accessibility_chatLog_newMessage",params:{author:e,content:r}}),t)}),this.navigateToHeartedMessage=function(){function t(e,t){return!e||!t?0:parseInt(e.id)-parseInt(t.id)}if(!W)return;var e=A._messagesWithUnseenHearts();if(e.length===0)return;var n=e.sort(t),r=n[0];ft(r.id),n=null}}var t=e("lodash-compat"),n=e("browser/document"),r=e("vendor/knockout"),i=e("utils/common/ko"),s=e("utils/common/array"),o=e("utils/common/cafeObservable"),u=e("constants/common"),a=e("constants/common").events,f=e("utils/common/eventMixin"),l=e("ui/contextMenu/contextMenu"),c=e("ui/contextMenu/items/all"),h=e("utils/chat/conversationCache"),p=e("utils/common/async"),d=e("services/serviceLocator"),v=e("utils/common/appVisibilityProvider"),m=e("swx-i18n").localization,g=e("ui/telemetry/actions/actionSources"),y=e("utils/chat/messageSanitizer"),b=e("experience/settings"),w=e("cafe/applicationInstance"),E=e("swx-enums"),S=e("ui/modelHelpers/personHelper"),x=10,T=10;return t.assign(N.prototype,f),N}),define("jsviews/chat/chatLog",["require","browser/dom","lodash-compat","utils/chat/conversationCache","constants/common","utils/common/scroll"],function(e){function g(e,g){function A(e){var n=document.getSelection().toString().length>0,r;if(n)return;r=t.getParentWithClass(e.target,o),r&&(y.onContextMenu(r.getAttribute("data-id"),e),e.preventDefault())}function O(e){t.addClass(e,h),setTimeout(function(){e&&t.removeClass(e,h)},a)}function M(e){var n=e.length===1;Array.prototype.forEach.call(e,function(e){n&&D(e)&&O(e),t.removeClass(e,p)})}function D(e){return b.lastElementChild===e&&b.childElementCount>1}function P(){return!w||w.scrollHeight-w.scrollTop-e.clientHeight<l}function H(){return!!w&&w.scrollTop<c}function B(){if(!w)return;L=!0,x.scrollHeight=w.scrollHeight,x.scrollBottom=x.scrollHeight-w.scrollTop}function j(t){if(!w){E.scrollTop=E.scrollHeight-e.clientHeight,S.scrollTop=E.scrollHeight-e.clientHeight,L=!1;return}var n=w.scrollHeight,r=n===x.scrollHeight||t,i=r?x.scrollBottom:0;w.scrollTop=n-i,L=!1}function F(){X(),N.resize()}function q(e,t,n){if(!e||!n||!t)return;if(t.children.length<2)return e;var r=n.getBoundingClientRect(),i=t.children,s=null,o=0,u=i.length-1,a,f;while(e){s=e.getBoundingClientRect();if(s.top>r.bottom)u=Array.prototype.indexOf.call(i,e);else{if(!(s.bottom<r.top))return e;o=Array.prototype.indexOf.call(i,e)}a=R(o,u);if(f===a)break;f=a,e=i[a]}}function R(e,t){return e+(t-e>>1)}function U(e,t){var n=e.getBoundingClientRect();return n.top<=t.bottom&&n.bottom>=t.top}function z(e,t,n){function o(e){if(e&&e.nodeType===1){var t;return s<10?(t=!0,s++):(t=U(e,r),s=0),t?(i.push(e),!1):!0}}var r=n.getBoundingClientRect(),i=[];i.push(e);var s=0,u=e.nextSibling;while(u){if(o(u))break;u=u.nextSibling}u=e.previousSibling,s=0;while(u){if(o(u))break;u=u.previousSibling}return i}function W(){var e=I.slice(),n=q(b.lastElementChild,b,S);n&&(I=z(n,b,S));for(var r=0;r<e.length;r++)I.indexOf(e[r])<0&&t.setClass(e[r],u,!1);I.forEach(function(e){t.setClass(e,u,!0)}),y.onMessageVisibilityChange(I)}function X(){clearTimeout(C),C=setTimeout(W,v)}function V(e){return P()?!0:H()?!n.find(e,function(e){return e.className.indexOf(d)>-1}):!1}var y=null,b,w,E,S,x=null,T,N,C=null,k,L=!1,I=[];this.init=function(n,o){y=n,b=t.getElement(".messageHistory",e),x=r.forModel(o),b.addEventListener("contextmenu",A),E=t.getElement(".scroller",e),S=t.getElement(".scrollable",e),window.addEventListener(i.events.browser.RESIZE,F),T=s.build(e),T.init(),N=new g(e)},this.dispose=function(){b.removeEventListener("contextmenu",A),window.removeEventListener(i.events.browser.RESIZE,F),y=null,x=null,T.dispose(),N.dispose(),clearTimeout(C)},this.showNewMessages=function(){var e=b.querySelectorAll("."+o+"."+p),t=V(e),n=P();t&&B(),M(e),t&&j(!n),T.update(),X()},this.scrollToMessage=function(e){T.scrollToElement(e.elementInfo.element)},this.restoreScrollPosition=function(){j(!k),T.update()},this.storeScrollPosition=function(){k=P(),B()},this.isScrolledToTop=function(){return H()},this.isScrolledCloseToBottom=function(){return!w||w.scrollHeight-w.scrollTop-e.clientHeight<m},this.isScrollable=function(){return e.clientHeight<b.clientHeight+f},this.isScrollPositionStored=function(){return L},this.isVisible=function(){return b.offsetHeight>0},this.isMessageVisible=function(e){var t=n.find(I,function(t){return e===t.attributes["data-id"].value});return!!t},this.onShow=function(){j()},this.onHide=function(){B()},this.onScroll=function(e){w=w||e.target,X()}.bind(this),this._setScroller=function(e){w=e}}var t=e("browser/dom"),n=e("lodash-compat"),r=e("utils/chat/conversationCache"),i=e("constants/common"),s=e("utils/common/scroll"),o="message",u="swx-in-viewport",a=800,f=60,l=150,c=100,h="animate",p="loading",d="unread",v=300,m=60;return g}),define("telemetry/chat/contactInfoEvent",["require","exports","module","experience/settings","constants/common","ui/telemetry/telemetryClient","telemetry/chat/telemetryEnumerator","ui/modelHelpers/personHelper"],function(e,t){function a(e){var t=e.person;return{state:f(t),hasDisplayName:l(t),contactType:c(t),participantsCount:e.participantsCount,participantsCountGroup:o.getParticipantCountGroup(e.participantsCount),timeInStale:e.timeInStale,timeInStaleGroup:o.getMessageLifeDurationGroup(new Date-e.timeInStale),actionName:e.actionName}}function f(e){return u.isKnownPerson(e)?"EXISTING":"NEW"}function l(e){return e.displayName()!==e.id()}function c(e){return u.isPstn(e)?"PSTN":"SKYPE"}function h(e){var t=i.TYPE,r=a(e);s.get().sendEvent(n.telemetry.uiTenantToken,t,r)}var n=e("experience/settings"),r=e("constants/common"),i=r.telemetry.contactInfo,s=e("ui/telemetry/telemetryClient"),o=e("telemetry/chat/telemetryEnumerator"),u=e("ui/modelHelpers/personHelper");t.publishShowEvent=function(e){return e.actionName=i.action.SHOW,h(e)},t.publishActionEvent=function(e){return e.actionName=i.action.CLICK,h(e)}}),define("ui/contactInfoMessage/contactInfoMessage",["require","exports","module","vendor/knockout","utils/common/cafeObservable","swx-i18n","telemetry/chat/contactInfoEvent","ui/modelHelpers/personHelper"],function(e,t){var n=e("vendor/knockout"),r=e("utils/common/cafeObservable"),i=e("swx-i18n").localization,s=e("telemetry/chat/contactInfoEvent"),o=e("ui/modelHelpers/personHelper");t.render=function(t,u,a){function f(e){function s(e){return u.isMyself?i.fetch({key:"chat_contactSent_label"}):o.isKnownPerson(e)?i.fetch({key:"contact_information_already_contact"}):i.fetch({key:"contact_information_add_to_contacts"})}var t={};t.name=n.observable(e.id()),t.fullName=n.observable(e.displayName()),t.actionKey=n.observable(s(e)),t.titleKey=n.observable(i.fetch({key:"label_text_openConversation",params:{displayName:e.displayName()}})),t.avatar=r.newObservableProperty(e.avatarUrl,{keepAlive:!0}),u.contacts.push(t)}function l(e){return u.isMyself?i.fetch({key:"message_text_sentContacts"}):i.fetch({key:"message_text_receivedContacts",params:{from:e.sender.displayName()}})}u.contacts=n.observableArray([]),t.contacts().forEach(function(e){f(e),s.publishShowEvent({participantsCount:a.participantsCount(),timeInStale:u.timestamp.getTime(),person:e})}),u.content=n.observable(l(t))},t.handleContactAdded=function(t,n){n.contacts().forEach(function(e){e.name()===t&&e.actionKey(i.fetch({key:"contact_information_already_contact"}))})}}),define("constants/contentTemplates",["require","exports","module","swx-enums","constants/common"],function(e,t){var n=e("swx-enums"),r=e("constants/common"),i="MessageContentTemplate",s={};s[n.activityType.TextMessage]="text"+i,s[n.activityType.CallStarted]="calling"+i,s[n.activityType.CallEnded]="calling"+i,s[n.activityType.CallMissed]="calling"+i,s[n.activityType.PluginFreeFallbackWindowsUpdate]="pluginFree"+i,s[n.activityType.PluginFreeFallbackScreenSharing]="pluginFree"+i,s[n.activityType.PluginFreeFallbackMicrophoneAccess]="pluginFree"+i,s[n.activityType.PluginFreeFallbackOutgoingP2PCall]="pluginFree"+i,s[n.activityType.PluginFreeFallbackIncomingP2PCall]="pluginFree"+i,s[n.activityType.PluginFreeNoVideoCapability]="pluginFree"+i,s[n.activityType.NgcUpgradeMessage]="ngcUpgrade"+i,s[n.activityType.PstnInsufficientFunds]="pstn"+i,s[n.activityType.PstnInvalidNumber]="pstn"+i,s[n.activityType.PstnForbiddenNumber]="pstn"+i,s[n.activityType.VideoMessage]="video"+i,s[n.activityType.PictureMessage]="picture"+i,s[n.activityType.FileTransfer]="fileTransfer"+i,s[n.activityType.ContactRequestIncoming]="contactRequestIncoming"+i,s[n.activityType.ContactRequestIncomingInviteFree]="contactRequestIncomingInviteFree"+i,s[n.activityType.ContactRequestOutgoing]="contactRequestOutgoing"+i,s[n.activityType.ContactRequestOutgoingResend]="contactRequestOutgoingResend"+i,s[n.activityType.ContactRequestOutgoingAgent]="contactRequestOutgoingAgent"+i,s[n.activityType.SuggestedContact]="suggestedContact"+i,s[n.activityType.MojiMessage]="moji"+i,s[n.activityType.PollMessage]="poll"+i,s[n.activityType.UnblockContact]="unblockContact"+i,s[n.activityType.ContactInfoMessage]="contactInfo"+i,s[r.customActivityItemTemplates.SPACES_WELCOME_MESSAGE]="spacesWelcome"+i,t.templates=s}),define("telemetry/chat/emotionActionEvent",["require","exports","module","constants/common","experience/settings","telemetry/chat/telemetryEnumerator","ui/telemetry/telemetryClient"],function(e,t){function o(){var e=this,t="message_emotions_action";e.enums={EMOTION_TYPE:{HEARTS:"hearts"},ACTION_TYPE:{SET:"set",UNSET:"unset"}},e.publish=function(){s.get().sendEvent(r.telemetry.uiTenantToken,t,e.data),e.init()},e.init=function(){e.data={emotionType:n.telemetry.NOT_AVAILABLE,action:n.telemetry.NOT_AVAILABLE,timeDelta:n.telemetry.NOT_AVAILABLE,tts:n.telemetry.NOT_AVAILABLE,annotationsCount:n.telemetry.NOT_AVAILABLE,result:n.telemetry.NOT_AVAILABLE,participantsCount:n.telemetry.NOT_AVAILABLE,participantsCountGroup:n.telemetry.NOT_AVAILABLE,messageType:n.telemetry.NOT_AVAILABLE}},e.setDuration=function(t){e.data.tts=t,e.data.timeDelta=i.getDurationGroup(t)},e.setParticipantCount=function(t){e.data.participantsCount=t,e.data.participantsCountGroup=i.getParticipantCountGroup(t)},e.setMessageType=function(t){e.data.messageType=i.getMessageType(t)},e.init()}var n=e("constants/common"),r=e("experience/settings"),i=e("telemetry/chat/telemetryEnumerator"),s=e("ui/telemetry/telemetryClient");t.build=function(){return new o}}),define("ui/viewModels/chat/hearts",["require","exports","module","swx-enums","constants/common","ui/viewModels/people/contactBuilder","telemetry/chat/emotionActionEvent","swx-i18n","vendor/knockout","ui/modelHelpers/personHelper","services/serviceLocator","swx-utils-common"],function(e,t){function c(e,t,c){var h=this,p=f.resolve(r.serviceLocator.FEATURE_FLAGS);h.canHeart=u.observable(!1),h.heartsEnabled=u.observable(!1),h.heartsCount=u.observable(0),h.isHeartedByMe=u.observable(!1),h.usersHearts=u.observableArray(),h.heartBar=u.observableArray(),h.lovedByCount=u.computed(function(){return o.fetch({key:"hearts_list_title",params:{count:h.heartsCount()}})}),h.isSelfPopup=function(){return function(e){return e.key==="hearts"}},h._internal={heartsBarCountThreshold:2,deletedMsgSubscription:null,emotionsObserver:null,heartCountChangeSubscription:null,processUser:function(e){var t={};t.person=e.person,t.firstName=e.person.firstName(),t.displayName=e.person.displayName(),t.me=a.isMePerson(e.person),t.me&&h.isHeartedByMe(!0),t.contact=i.build(e.person),h.usersHearts.push(t)},initUserHeartBar:function(){function u(n){for(t=0;t<r.length;t++)if(e!==t&&r[t].firstName===n)return!0}var e,t,n,r=h.usersHearts(),i,s=o.fetch({key:"hearts_me_text"});for(e=0;e<r.length;e++)n=r[e],n.me&&(n.firstName=s),!n.firstName||u(n.firstName)?h.heartBar.push(n.displayName):h.heartBar.push(n.firstName);i=h.heartBar.indexOf(s),i>-1&&(h.heartBar.splice(i,1),h.heartBar.unshift(s))},initEmotions:function(){if(!e.model._emotionsArray)return;var t=e.model._emotionsArray(r.emotionTypes.HEART);if(t){var n=t.users.slice();n.sort(function(e,t){return t.time-e.time}),h.isHeartedByMe(!1),h.usersHearts.removeAll(),h.heartBar.removeAll(),n.forEach(h._internal.processUser),h._internal.initUserHeartBar(),h.heartsCount(n.length)}else h.heartsCount(0),h.isHeartedByMe(!1)},initHeart:function(){var t=p.isFeatureOn(r.featureFlags.HEARTS_ENABLED)&&e.model.type()!==n.activityType.SystemMessage,i=t&&!!e.model.emotions&&!e.model.isDeleted();h.heartsEnabled(t),h.canHeart(i)},onHeartBar:function(){return h.canHeart()&&h.heartsCount()>0},onHeartBarLoved:function(e){var t;if(e>h._internal.heartsBarCountThreshold){var n=h.heartBar().slice(0,h._internal.heartsBarCountThreshold),r=parseInt(e,10)-h._internal.heartsBarCountThreshold;t=o.fetch({key:"hearts_like_byMany",params:{participantlist:n.join(", "),count:r}})}e===1&&(h.isHeartedByMe()?t=o.fetch({key:"hearts_like_byMeOnly"}):t=o.fetch({key:"hearts_like_byOne",params:{participantName:h.heartBar()[0]}})),e===h._internal.heartsBarCountThreshold&&(t=o.fetch({key:"hearts_like_byFew",params:{participantFirst:h.heartBar()[0],list:h.heartBar().slice(1,h.heartBar().length-2).join(", "),participantLast:h.heartBar()[h.heartBar().length-1]}})),h.heartBarLoved(t)}},h.init=function(){h._internal.initHeart();if(!h.canHeart())return;h._internal.emotionsObserver=e.model.emotions.observe(function(){h._internal.initEmotions()}),e.model.isDeleted&&(h._internal.deletedMsgSubscription=e.model.isDeleted.changed(function(){h._internal.initHeart()})),h._internal.initEmotions()},h.dispose=function(){h.hasHeartBar.dispose(),h.lovedByCount.dispose(),h._internal.deletedMsgSubscription&&h._internal.deletedMsgSubscription.dispose(),h._internal.emotionsObserver&&h._internal.emotionsObserver.dispose()},h.heartMessage=function(){function a(){i.data.result=200,i.setDuration(n.duration()),i.publish()}function f(e){h.isHeartedByMe(!h.isHeartedByMe()),h.heartsCount(o),i.data.result=e.status,i.setDuration(n.duration()),i.publish()}var n=l.build(),i=s.build();i.data.emotionType=i.enums.EMOTION_TYPE.HEARTS;var o=0,u=e.model.emotions(r.emotionTypes.HEART);u&&(o=u.users.length),i.data.annotationsCount=o,i.setParticipantCount(t.participants().length),i.setMessageType(e),h.isHeartedByMe(!h.isHeartedByMe()),h.isHeartedByMe()?(i.data.action=i.enums.ACTION_TYPE.SET,e.model.emotions.add({key:r.emotionTypes.HEART}).then(a,f)):(i.data.action=i.enums.ACTION_TYPE.UNSET,e.model.emotions.remove({key:r.emotionTypes.HEART}).then(a,f))},h.hasHeartBar=u.computed(h._internal.onHeartBar),h.heartBarLoved=u.observable(),h.heartsCount.subscribe(h._internal.onHeartBarLoved),h.triggerTooltip=function(e,t){c({key:"hearts",eventPageY:t.pageY})}}var n=e("swx-enums"),r=e("constants/common"),i=e("ui/viewModels/people/contactBuilder"),s=e("telemetry/chat/emotionActionEvent"),o=e("swx-i18n").localization,u=e("vendor/knockout"),a=e("ui/modelHelpers/personHelper"),f=e("services/serviceLocator"),l=e("swx-utils-common").stopwatch;t.build=function(e,t,n){return new c(e,t,n)}}),define("telemetry/chat/videoMessagePlayback",["require","experience/settings","constants/common","ui/telemetry/telemetryClient"],function(e){function i(){function o(e){r.get().sendEvent(t.telemetry.uiTenantToken,i,e)}var e=this,i=n.chat.VIDEO_MESSAGE.TYPE,s={};e.sendLoadedEvent=function(){s.action=n.chat.VIDEO_MESSAGE.eventName.LOADED,o(s)},e.sendFirstPlayAction=function(){s.action=n.chat.VIDEO_MESSAGE.action.FIRST_PLAY,o(s)},e.sendFullscreenAction=function(){s.action=n.chat.VIDEO_MESSAGE.action.FULLSCREEN,o(s)},e.sendSeekAction=function(){s.action=n.chat.VIDEO_MESSAGE.action.SEEK,o(s)},e.sendReplayAction=function(){s.action=n.chat.VIDEO_MESSAGE.action.REPLAY,o(s)}}var t=e("experience/settings"),n=e("constants/common").telemetry,r=e("ui/telemetry/telemetryClient");return new i}),define("ui/viewModels/chat/messageMediaTypesHandlers",["require","exports","module","swx-enums","utils/common/cafeObservable","swx-i18n","vendor/knockout","services/pubSub/pubSub","services/pes/configSync","constants/common","browser/dom","telemetry/chat/videoMessagePlayback"],function(e,t){function h(){}function p(e,t){var o;t?o=i.fetch({key:"media_picturesharing_group",params:{senderName:e.model.sender.displayName()}}):o=i.fetch({key:"media_picturesharing_one"}),e.hasFailed=s.pureComputed(function(){return e.status()===n.activityStatus.Failed}),e.isPending=s.pureComputed(function(){return e.status()===n.activityStatus.Pending}),e.status=r.newObservableProperty(e.model.status),e.progress=r.newObservableProperty(e.model.progress),e.thumbnailUrl=r.newObservableProperty(e.model.thumbnailUrl),e.pictureUrl=r.newObservableProperty(e.model.pictureUrl),e.content=s.observable(o),e.isPicture=s.observable(!0),e.open=function(){return!e.isPending()&&!e.hasFailed()},e.progressIndicatorBG=s.pureComputed(function(){var t=e.progress(),n=90,r="#C4DAE3",i="#E7F1F5",s=t<=50?i:r,o=Math.floor(t*3.6)+n,u=t<=50?-n:n,a=t===0?0:50;return"linear-gradient("+u+"deg, transparent "+a+"%, "+s+" 50%),"+"linear-gradient("+o+"deg, "+r+" 50%, transparent 50%)"})}function d(e){function t(e){if(!e||e===0)return"0 Bytes";var t=1e3,n=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(t));return r>=n.length&&(r=n.length-1),Math.round(e/Math.pow(t,r)*10)/10+" "+n[r]}function o(){var r=e.progress(),s=e.status()===n.activityStatus.Pending,o=Math.round(r*e.model.fileSize/100);if(s){var u=i.fetch({key:"file_transfer_upload_state",params:{size:t(e.model.fileSize),uploaded:t(o)}});return u}return t(e.model.fileSize)}e.typeClasses={},e.typeClasses[e.model.fileType]=!0,e.fileName=e.model.fileName,e.fileType=e.model.fileType,e.fileThumbnailUri=r.newObservableProperty(e.model.fileThumbnailUri),e.fileSize=s.pureComputed(o),e.fileUri=r.newObservableProperty(e.model.fileUri),e.status=r.newObservableProperty(e.model.status),e.progress=r.newObservableProperty(e.model.progress),e.shouldAbort=r.newObservableProperty(e.model.shouldAbort),e.iconClasses={},e.iconClasses[e.fileType]=!0,e.content=s.observable(i.fetch({key:"file_transfer_file_shared"})),e.isAborted=s.pureComputed(function(){var t=e.shouldAbort(),r=e.status()===n.activityStatus.Failed;return t&&r}),e.abortUploading=function(){e.model.shouldAbort(!0)}}function v(e,t){function r(){var t=f.createElement("img");e.onBeforeExpanded(),t.addEventListener("load",function(t){e.isLoaded(!0),t.target.width>t.target.height?e.orientationClass("landscape"):e.orientationClass("portrait"),e.onAfterExpanded()}),t.addEventListener("error",function(){e.hasFailed(!0),e.onAfterExpanded()}),t.src=e.thumbnailUrl}var n;t?n=i.fetch({key:"media_videosharing_group",params:{senderName:e.model.sender.displayName()}}):n=i.fetch({key:"media_videosharing_one"}),e.thumbnailUrl=e.model.thumbnailPath(),e.mediaUrl=e.model.mediaUrl(),e.isLoaded=s.observable(!1),e.isPlaying=s.observable(!1),e.hasExpired=s.observable(!1),e.hasFailed=s.observable(!1),e.orientationClass=s.observable(),e.content=s.observable(n),e.play=function(){e.isPlaying(!0),l.sendFirstPlayAction()},e.model.isExpired.get().then(function(t){t?e.hasExpired(!0):e.isRendered?r():e.registerEvent(a.events.message.RENDERED,r)})}function m(e,t){function f(e){var t,n;e.mojiUrl().indexOf("?")!==-1?t=e.mojiUrl().replace(/\?.*$/,"?"+u.latestToken):t=e.mojiUrl()+"?"+u.latestToken,e.mojiThumbnailUrl().indexOf("?")!==-1?n=e.mojiThumbnailUrl().replace(/\?.*$/,"?"+u.latestToken):n=e.mojiThumbnailUrl()+"?"+u.latestToken,e.model.mojiUrl(t),e.model.thumbnailUrl(n)}function l(t){t.fallbackUsed&&(f(e),o.subscribe(a.events.personalExpression.CDN_TOKEN_UPDATED,function(){f(e)})),e.mojiTitle(t.description),e.mojiLinkName(t.auxiliaryText),e.mojiLinkUrl(t.auxiliaryUrl),e.mojiCopyright(t.copyright),e.typeClasses("moji keyframe")}var n;t?n=i.fetch({key:"media_mojisharing_group",params:{senderName:e.model.sender.displayName()}}):n=i.fetch({key:"media_mojisharing_one"}),e.typeClasses=s.observable("mojiloading"),e.mojiThumbnailUrl=r.newObservableProperty(e.model.thumbnailUrl),e.mojiUrl=r.newObservableProperty(e.model.mojiUrl),e.isSticker=s.observable(!0),e.isMoji=s.observable(!0),e.mojiTitle=s.observable(""),e.mojiLinkName=s.observable(""),e.mojiLinkUrl=s.observable(""),e.mojiCopyright=s.observable(""),e.isMojiPlaying=s.observable(!1),e.isMojiPlayed=s.observable(!1),e.model.mojiMetaData.get().then(l),e.stopMojiPlay=function(e,t){var n=t.target,r=n.previousElementSibling;r.pause()},e.playMoji=function(t,n){function s(){e.isMojiPlayed(!0),e.isMojiPlaying(!1),i.removeEventListener("pause",s,!1),i.removeEventListener("ended",s,!1)}var r=n.target,i=r.previousElementSibling.previousElementSibling;if(e.isMojiPlaying()){i.pause();return}e.isMojiPlaying(!0),i.play(),i.addEventListener("ended",s,!1),i.addEventListener("pause",s,!1)},e.i18n=function(e){return i.fetch({key:e})},e.content=s.observable(n)}var n=e("swx-enums"),r=e("utils/common/cafeObservable"),i=e("swx-i18n").localization,s=e("vendor/knockout"),o=e("services/pubSub/pubSub"),u=e("services/pes/configSync"),a=e("constants/common"),f=e("browser/dom"),l=e("telemetry/chat/videoMessagePlayback"),c={};c[n.activityType.VideoMessage]=v,c[n.activityType.PictureMessage]=p,c[n.activityType.MojiMessage]=m,c[n.activityType.FileTransfer]=d,t.fetch=function(e){return c[e]||h}}),define("constants/activityTypeGroups",["require","exports","module","swx-enums"],function(e,t){var n=e("swx-enums");t.CALL_MESSAGES=[n.activityType.CallStarted,n.activityType.CallEnded,n.activityType.CallMissed],t.PSTN_MESSAGES=[n.activityType.PstnInsufficientFunds,n.activityType.PstnInvalidNumber,n.activityType.PstnForbiddenNumber],t.PLUGIN_FREE_MESSAGES=[n.activityType.PluginFreeFallbackWindowsUpdate,n.activityType.PluginFreeFallbackScreenSharing,n.activityType.PluginFreeFallbackMicrophoneAccess,n.activityType.PluginFreeFallbackOutgoingP2PCall,n.activityType.PluginFreeFallbackIncomingP2PCall,n.activityType.PluginFreeNoVideoCapability],t.NGC_UPGRADE_MESSAGES=[n.activityType.NgcUpgradeMessage],t.MEDIA_MESSAGES=[n.activityType.VideoMessage,n.activityType.PictureMessage,n.activityType.MojiMessage,n.activityType.FileTransfer],t.PARTICIPANT_MESSAGES=[n.activityType.ParticipantJoined,n.activityType.ParticipantLeft,n.activityType.ParticipantJoinFailed,n.activityType.ParticipantRoleUpdate,n.activityType.ParticipantTopicUpdate,n.activityType.ParticipantPictureUpdate,n.activityType.ParticipantHistoryDisclosed,n.activityType.ParticipantJoiningEnabled,n.activityType.ParticipantLegacyMemberAdded,n.activityType.ParticipantLegacyMemberUpgraded],t.CONTACT_REQUEST_MESSAGES=[n.activityType.ContactRequestIncoming,n.activityType.ContactRequestIncomingInviteFree,n.activityType.ContactRequestOutgoing,n.activityType.ContactRequestOutgoingResend,n.activityType.ContactRequestIsNowContact,n.activityType.SuggestedContact,n.activityType.UnblockContact,n.activityType.ContactRequestOutgoingAgent],t.CONTACT_INFO_MESSAGES=[n.activityType.ContactInfoMessage],t.TRANSACTION_MESSAGES=[n.activityType.CreditTransaction],t.POLL_MESSAGES=[n.activityType.PollMessage],t.CUSTOM_MESSAGES=[n.activityType.CustomMessage]}),define("utils/chat/message",["require","swx-enums","constants/activityTypeGroups","constants/common","browser/detect","constants/calling.resources","swx-i18n","utils/chat/dateTime","services/serviceLocator","ui/viewModels/people/properties/displayNameText","ui/viewModels/people/properties/locationText","experience/settings","lodash-compat","ui/modelHelpers/personHelper"],function(e){var t=e("swx-enums"),n=e("constants/activityTypeGroups"),r=e("constants/common"),i=e("browser/detect"),s=e("constants/calling.resources").fallbackMessages,o=e("swx-i18n").localization,u=e("utils/chat/dateTime"),a=e("services/serviceLocator"),f=e("ui/viewModels/people/properties/displayNameText"),l=e("ui/viewModels/people/properties/locationText"),c=e("experience/settings"),h=e("lodash-compat"),p=e("ui/modelHelpers/personHelper");return{getMessageFromParticipantActivityItem:function(e,n,i,s,u,f){function m(){var e="";return i.forEach(function(t,n){e=n===0?e+t.displayName():e+", "+t.displayName()}),e}function g(e){var t=h.some(e,function(e){return p.isAgent(e.getPerson())});return t?"\n"+o.fetch({key:"message_text_botWasAddedToConversation"}):""}function y(){return o.fetch({key:"message_text_wasAddedToConversation",params:{participant:d(),contact:m()}})}function b(e,t){return a.resolve(r.serviceLocator.FEATURE_FLAGS).isFeatureOn(r.featureFlags.SPACES)?e()===t():!1}function w(e){var t=[];e.participants().forEach(function(e){t.push(e.displayName())});if(t.length===0)return;if(t.length===1)return o.fetch({key:"message_text_meJoinedConversation_one",params:{participant:t[0]}});var n=t.pop();return o.fetch({key:"message_text_meJoinedConversation_more",params:{participants:t.join(", "),participant:n}})}var l=a.resolve(r.serviceLocator.FEATURE_FLAGS),c=l.isFeatureOn(r.featureFlags.SINGLE_CONVERSATION_MODE),d=n.displayName,v=p.isMePerson(n);switch(e){case t.activityType.ParticipantJoined:if(i.length>0)return y()+g(i);if(c&&v&&f)return w(f);return o.fetch({key:"message_text_joinedConversation",params:{participant:d()}});case t.activityType.ParticipantJoinFailed:return o.fetch({key:"message_text_joinConversationFailed",params:{participant:d()}});case t.activityType.ParticipantLeft:if(b(d,s))return o.fetch({key:"message_text_guestRemovedBySystem",params:{participant:m()}});if(i.length>0)return o.fetch({key:"message_text_wasRemovedFromConversation",params:{participant:d(),removedParticipant:m()}});if(u&&u.subcode==="Ejected"&&u.message==="You were removed from the meeting.")return o.fetch({key:"message_text_youWereRemovedFromConversation"});return o.fetch({key:"message_text_hasLeftConversation",params:{participant:d()}});case t.activityType.ParticipantRoleUpdate:return o.fetch({key:"message_text_roleUpdated",params:{who:d(),whom:i[0]?i[0].displayName():d(),role:s()}});case t.activityType.ParticipantTopicUpdate:return o.fetch({key:"message_text_topicUpdated",params:{participant:d(),topic:s()}});case t.activityType.ParticipantPictureUpdate:return o.fetch({key:"message_text_threadPictureUpdated",params:{participant:d()}});case t.activityType.ParticipantHistoryDisclosed:return o.fetch({key:s()?"message_text_historyDisclosed":"message_text_historyClosed",params:{participant:d()}});case t.activityType.ParticipantJoiningEnabled:return o.fetch({key:s()?"message_text_joiningEnabled":"message_text_joiningDisabled",params:{participant:d()}});case t.activityType.ParticipantLegacyMemberAdded:return o.fetch({key:"message_text_legacyMemberAdded",params:{participant:d()}});case t.activityType.ParticipantLegacyMemberUpgraded:return o.fetch({key:"message_text_legacyMemberUpgraded",params:{participant:d()}})}return""},getMessageFromCallActivityItem:function(e,n){function a(){return i?o.fetch({key:"message_text_ended"+r}):o.fetch({key:"message_text_outgoing"+r+"NoAnswer"})}var r=n?"GroupCall":"Call",i=e.duration()!==0,s={callAction:"",duration:i?u.formatCallDuration(e.duration()):"",text:""};switch(e.type()){case t.activityType.CallStarted:s.callAction="callStart",s.text=o.fetch({key:"message_text_started"+r});break;case t.activityType.CallEnded:s.callAction="callEnd",s.text=a();break;case t.activityType.CallMissed:s.callAction="callMissed",s.text=o.fetch({key:"message_text_missed"+r})}return s},getMessageFromContactRequestActivityItem:function(e,n){var r;switch(e){case t.activityType.ContactRequestIncoming:return o.fetch({key:"message_text_addingContactRequest",params:{id:n.id()}});case t.activityType.ContactRequestIsNowContact:return o.fetch({key:"message_text_contactRequestIsNowContact",params:{displayName:f.format(n.id(),n.displayName())}});case t.activityType.ContactRequestIncomingInviteFree:return r=l.format(n.location),r?o.fetch({key:"invite_free_message_received_location",params:{displayName:f.format(n.id(),n.displayName()),location:r}}):o.fetch({key:"invite_free_message_received",params:{displayName:f.format(n.id(),n.displayName())}})}return""},getMessageFromNgcUpgradeActivityItem:function(e){var t=e.participantNames();return t.length===1?o.fetch({key:"message_text_ngcUpgradeMessage_one",params:{participant:t[0],link:s.ngcUpgradeLink}}):t.length>1?o.fetch({key:"message_text_ngcUpgradeMessage_many",params:{participantList:t.slice(0,t.length-1).join(", "),lastParticipant:t[t.length-1],link:s.ngcUpgradeLink}}):""},getMessageFromPluginFreeActivityItem:function(e){function n(){var e=o.fetch({key:"message_text_pluginFree_windowsUpdate_line1",params:{update_link:s.windowsUpdateLink}});return e+"\r\n"+o.fetch({key:"message_text_pluginFree_windowsUpdate_line2"})}function r(){return o.fetch({key:"message_text_pluginFree_screenSharingFallback_line1"})+"\r\n"+o.fetch({key:"message_text_pluginFree_screenSharingFallback_line2",params:{upgrade_link:s.skypeUpgradeLink}})}function u(){return o.fetch({key:i.getBrowserInfo().isEdge?"message_text_pluginFree_microphoneAccess_edge":"message_text_pluginFree_microphoneAccess_others"})}function a(){var e=o.fetch({key:"message_text_pluginFree_outgoingP2P_line1",params:{upgrade_link:s.skypeUpgradeLink}});return e+"\r\n"+o.fetch({key:"message_text_pluginFree_outgoingP2P_line2"})}function f(){var e=o.fetch({key:"message_text_pluginFree_incomingP2P_line1",params:{upgrade_link:s.skypeUpgradeLink}});return e+"\r\n"+o.fetch({key:"message_text_pluginFree_incomingP2P_line2"})}function l(){return o.fetch({key:"message_text_pluginFree_noVideoCapability"})}switch(e.type()){case t.activityType.PluginFreeFallbackWindowsUpdate:return n();case t.activityType.PluginFreeFallbackScreenSharing:return r();case t.activityType.PluginFreeFallbackMicrophoneAccess:return u();case t.activityType.PluginFreeFallbackOutgoingP2PCall:return a();case t.activityType.PluginFreeFallbackIncomingP2PCall:return f();case t.activityType.PluginFreeNoVideoCapability:return l()}return""},getMessageFromPstnActivityItem:function(e){function n(e){var t='<a href="{url}" target="_blank" class="{class}">{text}</a>',n=c.commerce.purchaseCreditUrl,i=c.commerce.purchaseSubscriptionUrl,s,u,a,f,l=r.telemetry.pstn.cssClasses.ADD_CREDIT,h=r.telemetry.pstn.cssClasses.ADD_SUBSCRIPTION;return s=o.fetch({key:"pstn_insufficient_funds_credit"}),u=o.fetch({key:"pstn_insufficient_funds_subscription"}),a=t.replace("{url}",n).replace("{text}",s).replace("{class}",l),f=t.replace("{url}",i).replace("{text}",u).replace("{class}",h),e.isGroup()?e.participantName()===e.participantEndpoint()?o.fetch({key:"pstn_insufficient_funds_group",params:{phoneNumber:e.participantEndpoint(),credit:a,subscription:f}}):o.fetch({key:"pstn_insufficient_funds_group_name",params:{displayName:e.participantName(),phoneNumber:e.participantEndpoint(),credit:a,subscription:f}}):o.fetch({key:"pstn_insufficient_funds",params:{credit:a,subscription:f}})}function i(e){return e.isGroup()?e.participantName()===e.participantEndpoint()?o.fetch({key:"pstn_invalid_number_group",params:{phoneNumber:e.participantEndpoint()}}):o.fetch({key:"pstn_invalid_number_group_name",params:{displayName:e.participantName(),phoneNumber:e.participantEndpoint()}}):o.fetch({key:"pstn_invalid_number"})}function s(e){return e.isGroup()?e.participantName()===e.participantEndpoint()?o.fetch({key:"pstn_forbidden_number_group",params:{phoneNumber:e.participantEndpoint()}}):o.fetch({key:"pstn_forbidden_number_group_name",params:{displayName:e.participantName(),phoneNumber:e.participantEndpoint()}}):o.fetch({key:"pstn_forbidden_number"})}switch(e.type()){case t.activityType.PstnInsufficientFunds:return n(e);case t.activityType.PstnInvalidNumber:return i(e);case t.activityType.PstnForbiddenNumber:return s(e)}return""},getActivityItemGroup:function(e){return n.PARTICIPANT_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.PARTICIPANT:n.CALL_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.CALL:n.NGC_UPGRADE_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.NGC_UPGRADE:n.PLUGIN_FREE_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.PLUGIN_FREE:n.MEDIA_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.MEDIA:n.CONTACT_REQUEST_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.CONTACT_REQUEST:n.POLL_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.POLL:n.CONTACT_INFO_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.CONTACT_INFO:n.TRANSACTION_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.TRANSACTION:n.PSTN_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.PSTN:n.CUSTOM_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.CUSTOM:r.activityItemGroups.TEXT}}}),define("telemetry/chat/poll",["require","experience/settings","constants/common","ui/telemetry/telemetryClient"],function(e){function i(){this.pollDesignerOpened=function(i){var s={};s[n.telemetry.poll.property.CONVERSATION_ID]=i,r.get().sendEvent(t.telemetry.uiTenantToken,n.telemetry.poll.eventName.DESIGNER_OPENED,s)},this.stickyMessageClicked=function(i){var s={};s[n.telemetry.poll.property.CONVERSATION_ID]=i.conversationId(),s[n.telemetry.poll.property.MESSAGE_ID]=i.key(),r.get().sendEvent(t.telemetry.uiTenantToken,n.telemetry.poll.eventName.STICKY_MESSAGE_CLICKED,s)},this.avatarElipsisClicked=function(i){var s={};s[n.telemetry.poll.property.CONVERSATION_ID]=i.conversationId(),s[n.telemetry.poll.property.MESSAGE_ID]=i.key(),r.get().sendEvent(t.telemetry.uiTenantToken,n.telemetry.poll.eventName.AVATAR_ELIPSIS_CLICKED,s)},this.activityVote=function(s){var o=e(s,n.telemetry.poll.activityType.VOTE);o[n.telemetry.poll.property.IS_NEW_VOTE]=!0,r.get().sendEvent(t.telemetry.uiTenantToken,n.telemetry.poll.eventName.ACTIVITY,o)};var e=function(t,r){var i={};return i[n.telemetry.poll.property.CONVERSATION_ID]=t.conversationId(),i[n.telemetry.poll.property.MESSAGE_ID]=t.key(),i[n.telemetry.poll.property.ACTIVITY_TYPE]=r,i[n.telemetry.poll.property.XMM_TYPE]=t.xmmType(),i[n.telemetry.poll.property.QUESTION_LENGTH]=t.pollQuestion().length,i[n.telemetry.poll.property.ANSWERS_COUNT]=t.pollAnswers().length,i[n.telemetry.poll.property.MULTI_VOTE]=t.multipleVotes(),i[n.telemetry.poll.property.TIME_SINCE_CREATION]=(new Date).getTime()-t.timestamp(),i}}var t=e("experience/settings"),n=e("constants/common"),r=e("ui/telemetry/telemetryClient");return new i}),define("ui/viewModels/chat/pollAvatars",["require","exports","module","vendor/knockout","swx-i18n","ui/viewModels/people/contactBuilder","telemetry/chat/poll"],function(e,t){function o(e,t){function u(e){var t=o.model.pollAnswers()[e];o.selectedEllipsis(e),o.users.removeAll(),t.users.forEach(function(e){var t={};t.person=e.person,t.displayName=e.displayName,e.person&&(t.contact=i.build(e.person)),o.users.push(t)})}var o=this;o.selectedEllipsis=n.observable(-1),o.model=e,o.users=n.observableArray(),o.isSelfPopup=function(e,t){return o.selectedEllipsis()===e&&t.key==="polls"},o.onEllipsisClick=function(e,n,r){s.avatarElipsisClicked(o.model),u(e),t({key:"polls",eventPageY:r.pageY})},o.votedByCount=function(e){return r.fetch({key:"poll_list_title",params:{count:e}})}}var n=e("vendor/knockout"),r=e("swx-i18n").localization,i=e("ui/viewModels/people/contactBuilder"),s=e("telemetry/chat/poll");t.build=function(e,t){return new o(e,t)}}),define("ui/viewModels/chat/messageParsers/skypeSwiftProcessor",["require","exports","module","lodash-compat","utils/chat/messageSanitizer"],function(e,t){function s(e){function t(e){if(!e)return null;var t=i[e];if(t)return t;if(!/^#/.test(e))return"#"+e}function s(e){e.themeColor=t(e.themeColor),e.title=e.title?r.getMessageSanitizedContent(e.title):null,e.text=e.text?r.getMessageSanitizedContent(e.text):null,e.sections=e.sections||[],e.buttons=f(e.buttons||[])}function o(e){e.carousel=!1,e.autoCarousel=!1,e.layout=null,e.title=e.title?r.getMessageSanitizedContent(e.title):null,e.subtitle=e.subtitle?r.getMessageSanitizedContent(e.subtitle):null,e.text=e.text?r.getMessageSanitizedContent(e.text):null,e.barColor=t(e.barColor),e.themeColor=t(e.themeColor),e.rating=null,e.facts=n.isArray(e.facts)?n.filter(e.facts,l).map(c):[],e.images=n.isArray(e.images)?n.filter(e.images,h):[],e.tap=null,e.buttons=f(e.buttons||[])}function u(t){switch(t.type){case"imBack":t.clickHandler=function(){return e.chatService.sendMessage(t.message)};break;default:t.isLink=!0}}function a(e){e.label=e.label?r.getMessageSanitizedContent(e.label):null}function f(e){var t=[];return n.isArray(e)?(e.forEach(function(e){if(!n.isArray(e))return;e.forEach(function(e){a(e),u(e)}),e.length>0&&t.push(e)}),t):t}function l(e){return e.key&&e.value}function c(e){return{key:r.getMessageSanitizedContent(e.key),value:r.getMessageSanitizedContent(e.value)}}function h(e){return!!e.image}return{process:function(t){var r=n.clone(t,!0);return s(r),r.sections.forEach(o),r}}}var n=e("lodash-compat"),r=e("utils/chat/messageSanitizer"),i={good:"#66CC33",warning:"#F2CB1D",bad:"#CC293D"};t.build=function(e){return new s(e)}}),define("ui/viewModels/chat/messageParsers/swiftCard",["require","exports","module","lodash-compat","vendor/knockout","ui/viewModels/chat/messageParsers/skypeSwiftProcessor"],function(e,t){var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("ui/viewModels/chat/messageParsers/skypeSwiftProcessor");t.parse=function(e,t,s){if(!/^<swiftcard/i.test(t._originalContent))return;var o=new DOMParser,u=o.parseFromString(t._originalContent,"text/xml"),a,f,l,c,h;a=n.find(u.childNodes,function(e){return e.nodeName.toLocaleLowerCase()==="swiftcard"});if(!a)return;f=n.find(a.attributes,function(e){return e.nodeName.toLocaleLowerCase()==="swift"});if(!f)return r.observable(a.textContent);try{h=decodeURIComponent(f.textContent)}catch(p){if(p.message!=="URI malformed")return r.observable(a.textContent);h=f.textContent}try{l=JSON.parse(h)}catch(p){return r.observable(a.textContent)}return c=i.build(s),e.isDisjoined=!0,e.customMessageClasses="swiftCard",e.contentTemplate="skypeSwiftCardMessageContentTemplate",e.swiftCard=c.process(l),r.observable(a.textContent)}}),define("telemetry/translator/translatorTelemetry",["require","exports","module","experience/settings","ui/telemetry/telemetryClient"],function(e,t){function i(){var e=this;e.send=function(e,t){var i=t||{};r.get().sendEvent(n.telemetry.uiTenantToken,e,i)}}var n=e("experience/settings"),r=e("ui/telemetry/telemetryClient");t.build=function(){return new i}}),define("utils/chat/translatorHelper",["require","exports","module","cafe/applicationInstance","constants/common","utils/chat/messageSanitizer","ui/modelHelpers/personHelper","telemetry/translator/translatorTelemetry","lodash-compat"],function(e,t){function f(e){var t=e&&e().length,n;return t?(n=a.filter(e(),function(e){return e.users&&e.users[0]&&s.isMePersonId(e.users[0].mri)}),n.length?n[0]:null):null}var n=e("cafe/applicationInstance"),r=e("constants/common"),i=e("utils/chat/messageSanitizer"),s=e("ui/modelHelpers/personHelper"),o=r.telemetry.translator,u=e("telemetry/translator/translatorTelemetry"),a=e("lodash-compat");t.extractLanguageKey=function(e){if(!e)return;var t=/original./,n=t.test(e),r=e.replace(t,"");return n?r.substring(0,r.lastIndexOf(".")):e},t.isMatchingMyLanguage=function(e,n){var r=n&&n.isEnabled&&n.meLanguage?n.meLanguage.code:null,i=t.extractLanguageKey(e);return i===r},t.findMatchingTranslation=function(e,n){var r=e&&e().length,i,s;return r?(a.some(e(),function(e){return t.isMatchingMyLanguage(e.key,n)&&e.users&&e.users[0]&&e.users[0].value?(i=e.users[0].value,!0):!1}),i||(s=f(e),i=s?s.users[0].value:i),i):i},t.requestTranslation=function(e,t,s,a){function b(e){typeof a=="function"&&a(e)}function w(e){var t=e&&e.statusText||"Translator service failed";h.send(d,{action:o.action.TRANSLATE,error:t,language:g}),b({message:v})}function E(t){var n=i.removeNoTranslateTags(t),r=p?y:g,s=p?i.processOutgoingTextMessage(v):n,u=p?n:v,a={message:u,translation:{key:r,users:[{value:s,mri:c}]}};h.send(d,{action:o.action.TRANSLATE,success:!0,language:g});if(e===n){b({message:v});return}b(a)}var f=n.get(),l=f.translatorService,c=f.personsAndGroupsManager.mePerson.id(),h=u.build(),p=t===r.chat.messageType.OUTGOING,d=p?o.eventType.OUTGOING:o.eventType.INCOMING,v=e,m=p?i.processOutgoingTextMessageForTranslation(e):i.processIncomingSanitizedTextMessageForTranslation(e),g,y;p?(y=s._translatorSettings.meLanguage.code,g=s._translatorSettings.participantLanguage.code):g=s._translatorSettings.meLanguage.code,l.translateMessage(y,g,m).then(E,w)}}),define("ui/viewModels/chat/translator/translationItem",["require","exports","module","services/serviceLocator","constants/common","swx-i18n","vendor/knockout","utils/chat/messageSanitizer","telemetry/translator/translatorTelemetry","ui/modelHelpers/personHelper","utils/chat/translatorHelper"],function(e,t){function c(e,t){function x(){return y&&y.isEnabled}function T(){return!g&&x()}function N(e,n){var r=l.extractLanguageKey(n);x()||c.translationText(e),l.isMatchingMyLanguage(r,t._translatorSettings)&&(c.translationText(e),c.visible(!0)),S.send(E,{action:u.action.SHOW,success:!0})}function C(e,t){var n=o.getMessageSanitizedContent(e);f.isMePersonId(t)&&(c.translationText(n),c.visible(!0),S.send(E,{action:u.action.SHOW,success:!0}))}function k(){if(!m().length){c.isRemoved(!0),c.visible(!1);return}m.each(function(e){var t=e.key,n=e.users&&e.users[0],r=n&&n.value,i=n&&n.mri,s=r===c.translationText();if(!t||!r||s)return;if(o.isMessageWithEmoticonsOnly(r)||o.isMessageWithMentionOnly(r)){c.visible(!1),c.translationText("");return}c.isRemoved(!1),g?C(r,i):N(r,t)})}function L(){return T()?c.visible()?u.action.CLICK_SEE_ORIGINAL:u.action.CLICK_SEE_TRANSLATION:c.visible()?u.action.CLICK_SEE_TRANSLATION:u.action.CLICK_SEE_ORIGINAL}function A(){m&&(w=m.observe(k)),e.model.isDeleted&&(b=e.model.isDeleted.changed(function(e){c.isRemoved(e),c.visible(!1)}))}var c=this,h=n.resolve(r.serviceLocator.FEATURE_FLAGS),p=h.isFeatureOn(r.featureFlags.TRANSLATOR_SENDING_ENABLED),d=i.fetch({key:"button_translations_see_original_message"}),v=i.fetch({key:"button_translations_see_translated_message"}),m=e.model.translations,g=e.model.direction&&e.model.direction()===r.chat.messageType.OUTGOING,y=t._translatorSettings,b,w,E=g?u.eventType.OUTGOING:u.eventType.INCOMING,S=a.build();c.init=function(){c.isRemoved=s.observable(!1),c.visible=s.observable(!1),c.translationText=s.observable(""),c.isEnabled=s.pureComputed(function(){return p&&!c.isRemoved()&&!!c.translationText()}),c.toggle=function(){var e=L();c.visible(!c.visible()),S.send(E,{action:e})},c.toggleText=s.pureComputed(function(){return T()?c.visible()?d:v:c.visible()?v:d}),p&&A()},c.dispose=function(){b&&b.dispose(),w&&w.dispose()}}var n=e("services/serviceLocator"),r=e("constants/common"),i=e("swx-i18n").localization,s=e("vendor/knockout"),o=e("utils/chat/messageSanitizer"),u=r.telemetry.translator,a=e("telemetry/translator/translatorTelemetry"),f=e("ui/modelHelpers/personHelper"),l=e("utils/chat/translatorHelper");t.build=function(e,t){return new c(e,t)}}),define("telemetry/chat/urlPreviewShow",["require","exports","module","experience/settings","constants/common","ui/telemetry/telemetryClient","telemetry/chat/telemetryEnumerator"],function(e,t){function u(e){function f(){return{urlCount:e.urlCount,hasThumbnail:!1,urlPosition:e.urlPosition,contentType:o.getUrlContentType(e.url),result:a,ttl:a,ttlGroup:a,participantCount:e.participantCount,participantCountGroup:o.getParticipantCountGroup(e.participantCount)}}function l(){t.data.ttl=c(u,h()),t.data.ttlGroup=o.getSecondsDurationGroup(t.data.ttl);var e=i.TYPE,r=t.data;s.get().sendEvent(n.telemetry.uiTenantToken,e,r)}function c(e,t){return t-e}function h(){return(new Date).getTime()}var t=this,u=h(),a=r.telemetry.NOT_AVAILABLE;t.data=f(),t.error=function(e){e&&(t.data.result=e),l()},t.succeeded=function(e,n){t.data.hasThumbnail=n,t.data.result=e,l()}}var n=e("experience/settings"),r=e("constants/common"),i=r.telemetry.urlPreviewShown,s=e("ui/telemetry/telemetryClient"),o=e("telemetry/chat/telemetryEnumerator");t.build=function(e){return new u(e)}}),define("services/telemetry/hashingService",["require","msr-crypto"],function(e){function n(){this.getHash=function(e){var n=t.utilities.stringToBytes(e),r=t.sha256.computeHash(n);return t.utilities.bytesToHexString(r)}}var t=e("msr-crypto").aes;return new n}),define("telemetry/chat/youtubeShowEvent",["require","experience/settings","services/telemetry/hashingService","ui/telemetry/telemetryClient"],function(e){function i(){var e="message_youtube_show";this.publish=function(i,s,o,u){var a={messageIdHash:n.getHash(i.contentId),videoId:i.youtubeId,participantsCount:u,meSender:i.isMyself,batchOrdinal:i.ordinal,videoLength:o,playerWidth:s.getIframe().clientWidth,playerHeight:s.getIframe().clientHeight};r.get().sendEvent(t.telemetry.uiTenantToken,e,a)}}var t=e("experience/settings"),n=e("services/telemetry/hashingService"),r=e("ui/telemetry/telemetryClient");return new i}),define("telemetry/chat/youtubeActionEvent",["require","experience/settings","services/telemetry/hashingService","ui/telemetry/telemetryClient"],function(e){function i(){var e="message_youtube_action";this.publish=function(i,s,o,u){var a={messageIdHash:n.getHash(i.contentId),videoId:i.youtubeId,meSender:i.isMyself,batchOrdinal:i.ordinal,timeInStale:(u-i.messageTimestamp)/1e3,playerWidth:s.getIframe().clientWidth,playerHeight:s.getIframe().clientHeight,playerMode:!!s.inFullScreenMode,participantsCount:o.participantsCount,playerActionType:o.type,videoLength:o.videoLength,playerActionDuration:o.duration};o.startTime&&(a.startTime=o.startTime),r.get().sendEvent(t.telemetry.uiTenantToken,e,a)}}var t=e("experience/settings"),n=e("services/telemetry/hashingService"),r=e("ui/telemetry/telemetryClient");return new i}),define("ui/players/ytPlayer",["require","constants/common","experience/settings","browser/window","browser/document","telemetry/chat/youtubeShowEvent","telemetry/chat/youtubeActionEvent","services/pubSub/pubSub"],function(e){function a(){function l(){e.testContext.removePlayer(this.playerId)}function c(t){e.testContext.players[t]&&(e.testContext.players[t].destroy(),delete e.testContext.players[t]),e.testContext.previewItems[t]&&delete e.testContext.previewItems[t]}function h(e){return e.B?e.B.currentTime:e.F?e.F.currentTime:e.getCurrentTime?e.getCurrentTime():0}function p(e){return e.H&&e.H.duration?e.H.duration:e.F&&e.F.duration?e.F.duration:e.getDuration?e.getDuration():0}function d(e,t,n,r){var i=p(n);return t/=1e3,t=t>i?i:t,{type:e,duration:t,startTime:h(n),participantsCount:v(r),videoLength:i}}function v(e){return e&&e.conversation?e.conversation.participantsCount():t.telemetry.NOT_AVAILABLE}function m(n){n.previews().forEach(function(n){if(n.type()!==t.urlPreviewType.YT||!n.playerId)return;if(e.testContext.players[n.playerId])return;e.testContext.players[n.playerId]=new r.YT.Player(n.playerId,{events:{onReady:e.testContext.onPlayerReady,onStateChange:e.testContext.onPlayerStateChange,onError:e.testContext.onPlayerError}})})}function g(t,n){var r="yt_"+t+"_"+n;return e.randomIdEnabled?r+"_"+Math.random().toString(36).substring(7):r}function y(e){return e.protocol+"//"+e.hostname+(e.port?":"+e.port:"")}function b(e,t){var i="https://www.youtube.com/embed/"+e+"?showinfo=0&enablejsapi=1&modestbranding=1&disablekb=1&rel=0&iv_load_policy=3"+"&hl="+n.initParams.locale+"&"+"&origin="+y(r.location);return t&&(i+="&autoplay=true"),i}function w(e){return e.target.id||e.target.getIframe().id}var e=this,a,f=1e4;e.testContext={players:{},previewItems:{},onPlayerReady:function(t){var n=w(t),r=e.testContext.previewItems[n],i=e.testContext.players[n];if(i.toDestroy){c(n);return}i.renderedAndReady=!0;if(!r)return;s.publish(r,t.target,p(t.target),v(r))},onPlayerStateChange:function(t){var n=(new r.Date).getTime(),i=w(t),s=e.testContext.previewItems[i],u=e.testContext.players[i];switch(t.data){case r.YT.PlayerState.BUFFERING:case r.YT.PlayerState.CUED:case r.YT.PlayerState.UNSTARTED:return;case r.YT.PlayerState.PLAYING:s.lastActionTimestamp=n,o.publish(s,u,d(e.actionType.PLAYING,0,u,s),n);break;case r.YT.PlayerState.PAUSED:s.lastActionTimestamp=s.lastActionTimestamp||n,o.publish(s,u,d(e.actionType.PAUSED,n-s.lastActionTimestamp,u,s),{type:e.actionType.PAUSED,duration:n-s.lastActionTimestamp,participantsCount:v(s),videoLength:p(u)},n),s.lastActionTimestamp=null;break;case r.YT.PlayerState.ENDED:s.lastActionTimestamp=s.lastActionTimestamp||n,o.publish(s,u,d(e.actionType.ENDED,n-s.lastActionTimestamp,u,s),n),s.lastActionTimestamp=null}},removePlayer:function(n){var i=e.testContext.players[n];if(!i)return;i.renderedAndReady?c(n):(r.setTimeout(c.bind(null,n),f),i.toDestroy=!0)},onFullscreenChangedHandler:function(n){var i,s;n.target.id&&n.target.id.substring(0,7)==="yt_msg_"?(a&&(s=e.testContext.players[a]||{},s.inFullScreenMode=!1),a=w(n),i=e.testContext.previewItems[a],s=e.testContext.players[a],s.inFullScreenMode=!0,u.publish(t.events.videoPlayer.FULLSCREEN_ON,i?i.messageId:null),o.publish(i,s,{type:e.actionType.FULLSCREEN,duration:h(s),participantsCount:v(i),videoLength:p(s)},(new r.Date).getTime())):(i=e.testContext.previewItems[a],s=e.testContext.players[a],u.publish(t.events.videoPlayer.FULLSCREEN_OFF,i?i.messageId:null),s&&(s.inFullScreenMode=!1,a=null))},onPlayerError:function(e){}},e.actionType={PLAYING:"play",PAUSED:"pause",FULLSCREEN:"fullscreen",ENDED:"end"},e.render=function(i,s,o,u){var a=i.originalRequest,f=/(?:youtube.com|youtu.be)\/(watch)?(\?v=|v\/|embed\/)?(?:.*)([\w-]{11})(?:.*)?/.exec(a);if(f){var c=f[3],h=!!u;i.originalSize(!0),i.typeClasses.youtube(!0),i.target(""),i.youtubeId=c,i.youtubeUri=b(c,h),i.playerId=g(s.contentId,c),i.messageId=s.model.key(),i.contentId=s.contentId,i.isMyself=s.isMyself,i.messageTimestamp=s.timestamp,i.lastActionTimestamp=null,i.ytPlayer(!0),i.type(t.urlPreviewType.YT),i.dispose=l.bind(i),i.conversation=o,e.testContext.previewItems[i.playerId]=i,r.setTimeout(m.bind(null,s),n.youtubeWrapDelay)}else i.target("_blank");return!!f},e.parseYTLinks=function(e){var t=e.match(/(?:https?:\/\/|\/\/)?(?:www\.|m\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+?&v=))([\w-]{11})/gi);return t?t:[]},e.isYT=function(t){return e.parseYTLinks(t).length>0},e.handleClick=function(t){var n=e.testContext.players[t.playerId];if(!n)return;n.getPlayerState()===r.YT.PlayerState.PLAYING?n.pauseVideo():n.playVideo()},e.randomIdEnabled=!0,r.onYouTubeIframeAPIReady=function(){i.addEventListener("mozfullscreenchange",e.testContext.onFullscreenChangedHandler),i.addEventListener("webkitfullscreenchange",e.testContext.onFullscreenChangedHandler),i.addEventListener("fullscreenchange",e.testContext.onFullscreenChangedHandler),i.addEventListener("MSFullscreenChange",e.testContext.onFullscreenChangedHandler)}}var t=e("constants/common"),n=e("experience/settings"),r=e("browser/window"),i=e("browser/document"),s=e("telemetry/chat/youtubeShowEvent"),o=e("telemetry/chat/youtubeActionEvent"),u=e("services/pubSub/pubSub");return new a}),define("ui/urlPreview/urlPreview",["require","exports","module","lodash-compat","cafe/applicationInstance","constants/common","browser/dom","telemetry/chat/telemetryEnumerator","utils/common/eventHelper","vendor/knockout","utils/chat/messageSanitizer","reqwest","services/serviceLocator","experience/settings","utils/common/styleModeHelper","telemetry/chat/urlPreviewShow","browser/window","ui/players/ytPlayer"],function(e,t){function E(e,t,n){function i(e){return e.status_code!=="200"?!1:!e.title&&!e.site&&!e.description?!1:e.thumbnail?!0:!1}return r.get().signInManager._skypeToken().then(function(r){function a(n){return n.urlPreviewShowTelemetryEvent=s,n.urlRequest=e,n.encodedRequest=t,i(n)?(s.succeeded(n.status_code,!!n.thumbnail),new Promise(function(e,t){var r=m.setTimeout(t,w),i=new m.Image;i.onload=function(){m.clearTimeout(r),n.width=this.width,n.height=this.height,n.oneUrlOnly=O(u.urlPosition),e(n)},i.onerror=t.bind(null,n),i.src=n.thumbnail})):(s.error(n.status_code),Promise.reject(n))}function f(){return s.error(null),{skip:!0}}var s,o={url:h.urlPServiceHost+"/v1/url/info?url="+t,method:"GET",crossOrigin:!0,dataType:"json",headers:{Authorization:"skype_token "+r}},u={url:e,urlPosition:n.urlPosition,urlCount:n.urlsCount,participantCount:n.participantsCount};return s=v.build(u),Promise.resolve(l.compat(o)).catch(function(t){throw t=t||{},t.urlRequest=e,s.error(t?t.status_code:null),t}).then(a,f)})}function S(e,t,n){var r=/<a\s+(?:[^>]*?\s+)?href="((?!mailto:)[^"]*)".*?>(.*?)<\/a>/g,i=e.match(r)||[];if(t){var s=e.replace(r,"");i=i.concat(n.parseYTLinks(s))}if(!i)return;return i=x(i),i.length===0?null:i}function x(e){return e.filter(function(e,t,n){return t===n.indexOf(e)})}function T(e){var t=/^<a\s+(?:[^>]*?\s+)?href="([^"]*)".*<\/a>$/.exec(e);return t?t[1]:e}function N(e,t,n){return{urlsCount:t.length,urlPosition:C(e,t),participantsCount:n.participantsCount()}}function C(e,t){return t.length===1&&!e.replace(t[0],"")?d.URL_ONLY:n.endsWith(e,t[t.length-1])?d.TEXT_ENDING_WITH_URL:d.TEXT_WITH_URL}function k(e,t){return t.previews.remove(function(t){var n=e.indexOf(t.originalRequest);return n>-1&&e.splice(n,1),n===-1}),e}function L(e){return e==="image/gif"}function A(e){return e?n.escape(e):e}function O(e){return e===d.URL_ONLY}function M(e){return{description:a.observable(),title:a.observable(),site:a.observable(),url:a.observable(e),target:a.observable("_blank"),favicon:a.observable(),thumbnail:a.observable(),category:a.observable(),type:a.observable(i.urlPreviewType.WWW),typeClasses:{youtube:a.observable(!1)},scaledByW:a.observable(!1),scaledByH:a.observable(!1),originalSize:a.observable(!1),tall:a.observable(!1),wide:a.observable(!1),isGif:a.observable(!1),ytPlayer:a.observable(!1),ordinal:0,originalRequest:e,encodedRequest:e}}var n=e("lodash-compat"),r=e("cafe/applicationInstance"),i=e("constants/common"),s=e("browser/dom"),o=e("telemetry/chat/telemetryEnumerator"),u=e("utils/common/eventHelper"),a=e("vendor/knockout"),f=e("utils/chat/messageSanitizer"),l=e("reqwest"),c=e("services/serviceLocator"),h=e("experience/settings"),p=e("utils/common/styleModeHelper"),d=o.enums.URL_POSITION,v=e("telemetry/chat/urlPreviewShow"),m=e("browser/window"),g=e("ui/players/ytPlayer"),y=.5,b=2,w=3e3;t.render=function(t,n,r,o,l){function w(e){var t=n.elementInfo.element;if(!e){t.onkeydown=null;return}t.onkeydown=function(e){var r=u.isActivation(e);if(!r)return;try{var i=s.getElement(".thumbnail",t);i?i.click():g.handleClick(n.previews()[0])}catch(o){}}}function x(e){function t(e){return e=e||{},e.skip=!0,e}if(o&&g.isYT(e)){var i=M(e);g.render(i,n,r)&&(i.ordinal=n.previews().length,n.previews.push(i))}else if(l)return E(e,encodeURIComponent(e),d).catch(t);return Promise.resolve({skip:!0})}function C(e){n.onBeforeExpanded();var t=0;e.forEach(function(e){e.skip||_(e,t++)}),n.onAfterExpanded(),n.copyLinkEnabled(v&&n.previews().length===1),w(n.copyLinkEnabled())}function _(e,t){function h(e){return e>=y&&e<=b&&!p.get().isIntegratedProperty()}var r=a.utils.arrayFirst(n.previews(),function(t){return t.encodedRequest===e.encodedRequest});if(r)return;var s=c.resolve(i.serviceLocator.FEATURE_FLAGS),o=g.isYT(e.url),u,f=L(e.content_type),l=e.width/e.height;u=!o||!s.isFeatureOn(i.featureFlags.URL_PREVIEW_LOAD_YOUTUBE_PLAYER)||!!e.restrictions,r=M(e.urlRequest),r.title(e.title),r.description(e.description),r.target(u?"_blank":""),r.url(e.url),r.favicon(e.favicon),r.thumbnail(e.thumbnail),r.category(e.category),r.isGif(f),r.type(f?i.urlPreviewType.GIF:i.urlPreviewType.WWW),r.site(f?"":A(e.site)),r.ytPlayer(!1),r.ordinal=t,r.typeClasses.youtube(o),r.originalRequest=e.urlRequest,r.encodedRequest=e.encodedRequest,r.restrictions=e.restrictions,o&&r.type(i.urlPreviewType.YT);if(f||h(l))r.originalSize(!r.isGif()),r.scaledByW(!1),r.scaledByH(!1);else{var d=l<y;r.scaledByW(d),r.scaledByH(!d),r.originalSize(!1)}r.tall(!f&&l<=1),r.wide(!f&&l>1),n.previews.push(r)}var h=S(t,o,g);if(!h)return n.isUrlPreview(!1),n.copyLinkEnabled(!1),n.group(i.activityItemGroups.TEXT),n.contentTemplate("textMessageContentTemplate"),Promise.resolve();var d=N(t,h,r),v=O(d.urlPosition);for(var m=0;m<h.length;m++)h[m]=f.unescapeHTML(T(h[m]));return n.previews?h=k(h,n):n.previews=a.observableArray([]),n.isUrlPreview(!0),n.group(i.activityItemGroups.MEDIA),n.contentTemplate("urlMessageContentTemplate"),n.copyUrlPreviewText=function(){var e=n.elementInfo.element,t=n.previews()[0].originalRequest;n.urlLinkToCopy=a.observable(t),n.copyActive(!0);try{var r=s.getElement(".copyArea",e);r.select(),!document.execCommand("copy")}catch(i){}n.copyActive(!1),delete n.urlLinkToCopy},Promise.all(h.map(x)).then(C)}}),define("telemetry/chat/urlPreviewAction",["require","exports","module","experience/settings","constants/common","ui/telemetry/telemetryClient","telemetry/chat/telemetryEnumerator","browser/window"],function(e,t){var n=e("experience/settings"),r=e("constants/common"),i=r.telemetry.urlPreviewClicked,s=e("ui/telemetry/telemetryClient"),o=e("telemetry/chat/telemetryEnumerator"),u=e("browser/window");t.publishActionEvent=function(e){function r(){var t=a();return{contentType:o.getUrlContentType(e.url),ttc:t,ttcGroup:o.getMessageLifeDurationGroup(t),participantCount:e.participantCount,participantCountGroup:o.getParticipantCountGroup(e.participantCount)}}function a(){return f(e.receivedTime,l())}function f(e,t){return t-e}function l(){return(new u.Date).getTime()}function c(e){var t=i.TYPE,r=e;s.get().sendEvent(n.telemetry.uiTenantToken,t,r)}var t;t=r(),c(t)}}),define("ui/viewModels/chat/message",["require","lodash-compat","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","cafe/applicationInstance","text!views/people/blockContactModal.html","ui/viewModels/people/blockContactModal","utils/common/cafeObservable","constants/components","constants/common","ui/viewModels/people/contactBuilder","telemetry/chat/contactInfoEvent","ui/contactInfoMessage/contactInfoMessage","ui/viewModels/people/contactName","constants/contentTemplates","swx-enums","utils/common/eventMixin","ui/viewModels/chat/hearts","swx-i18n","vendor/knockout","ui/viewModels/chat/messageMediaTypesHandlers","utils/chat/messageSanitizer","utils/chat/message","ui/modalDialog/modalDialog","ui/modelHelpers/personHelper","ui/viewModels/chat/pollAvatars","telemetry/chat/poll","telemetry/calling/pstn/pstn","services/pubSub/pubSub","services/serviceLocator","utils/common/styleModeHelper","ui/viewModels/chat/messageParsers/swiftCard","ui/viewModels/chat/translator/translationItem","utils/chat/translatorHelper","ui/urlPreview/urlPreview","telemetry/chat/urlPreviewAction","ui/players/ytPlayer","experience/settings"],function(e){function q(e){function G(e){return d.templates[e]||d.templates[v.activityType.TextMessage]}function Y(){var e={},n=m.isRead(),r=m.group()===f.activityItemGroups.TEXT||m.group()===f.activityItemGroups.MEDIA||m.group()===f.activityItemGroups.CONTACT_INFO||m.group()===f.activityItemGroups.POLL,i;return e.me=m.isMyself&&r,e.their=!e.me,e.first=m.isFirstMessage(),e.last=m.isLastMessage(),e.read=n,e.edited=m.isEdited,e.unread=!n,e.showTimestamp=m.showTimestamp,e.sticker=m.isSticker(),e.spacesWelcomeMessage=U,e.deliveryFailed=m.deliveryFailed,e.hearts=m.heartsVM.canHeart()||m.heartsVM.heartsEnabled(),e.urlPreview=m.isUrlPreview(),e.mojiItem=m.isMoji(),e.integrated=m.isIntegrated,e.picture=m.isPicture(),e.copyLink=m.copyLinkEnabled(),e.lastInBubble=m.isLastMessageInBubble(),t.forIn(f.activityItemGroups,function(t){i=t&&t.toLowerCase(),i&&(e[i]=!1)}),m.group()===f.activityItemGroups.PSTN?e[f.activityItemGroups.CALL]=!0:e[m.group()]=!0,m.group()===f.activityItemGroups.CONTACT_REQUEST&&Z(e),m.group()===f.activityItemGroups.CUSTOM&&(e.participant=!0),t.trim(t.reduce(e,function(e,t,n){return w.unwrap(t)?e+" "+n:e},m.customMessageClasses||""))}function Z(e){function n(){return t.includes([v.activityType.ContactRequestIncoming,v.activityType.ContactRequestOutgoing,v.activityType.ContactRequestOutgoingAgent,v.activityType.SuggestedContact,v.activityType.UnblockContact],m.model.type())}function r(){return t.includes([v.activityType.ContactRequestOutgoingResend,v.activityType.ContactRequestIsNowContact,v.activityType.ContactRequestIncomingInviteFree],m.model.type())}e.contactMessage=n(),e.their=!e.me&&!n(),e.participant=r()}function et(e){var t=e.type()===v.activityType.ParticipantJoined,n=e.persons();return!z||!t?!1:(U=n.indexOf(q.personsAndGroupsManager.mePerson)>=0,U)}function tt(e){function s(t){return e.author!==t}function o(e){return new p(e)}function a(e){return!N.isMePerson(e)}var t=u.newObservableProperty(e.context),n=e.persons().filter(s),r;e.reason&&(r=e.reason()),m.participantsWithoutAuthor=n.map(o);if(et(e)){var i=u.newObservableProperty(R.selfParticipant.role);m.participantsWithoutMyself=n.filter(a).map(o),m.contentTemplate(G(f.customActivityItemTemplates.SPACES_WELCOME_MESSAGE)),m.spaceLink=u.newObservableProperty(R.uri),m.isJoiningEnabled=u.newObservableProperty(R.isJoiningEnabled),m.conversation=R,m.showSpacesCTA=w.computed(function(){return i()===v.participantRole.Leader}),m.welcomeMessage=w.computed(function(){return b.fetch({key:m.isJoiningEnabled()?"spaces_welcomeMessage":"spaces_welcomeMessageWithoutLink"})}),m.editTopicAction=function(){m.dispatchEvent(g.conversation.OPEN_PROFILE,{editTopic:!0},m.DIRECTION.PARENT)},m.settingsAction=function(){m.dispatchEvent(g.conversation.OPEN_PROFILE,{editTopic:!1},m.DIRECTION.PARENT)},m.othersAddedMessageContent=w.computed(function(){if(m.participantsWithoutMyself.length>0)return x.getMessageFromParticipantActivityItem(e.type(),m.author,m.participantsWithoutMyself,t,r,R)})}return w.computed(function(){return x.getMessageFromParticipantActivityItem(e.type(),m.author,m.participantsWithoutAuthor,t,r,R)})}function nt(e){e.sender&&(m.author=l.build(e.sender),m.isMyself=N.isMePerson(e.sender),m.displayname=w.observable(m.isMyself?"me":m.author),m.renderAuthorInfo(!m.isMyself),m.showAuthorInfo(!m.isMyself),m.openConversationLabel=w.pureComputed(function(){return b.fetch({key:"label_text_openConversation",params:{displayName:e.sender.displayName()}})})),m.direction=e.direction&&e.direction()}function rt(e,t){if(t.translation){var n={key:t.translation.key,value:t.translation.users[0].value,mri:t.translation.users[0].mri};e.translations.add(n)}}function it(e,n){switch(m.group()){case f.activityItemGroups.PARTICIPANT:m.author=l.build(e.author),m.content=tt(e);break;case f.activityItemGroups.CALL:var r=x.getMessageFromCallActivityItem(e,n);nt(e),m.content=w.observable(r.text),m.liveSessionDuration=r.duration,m.callAction=r.callAction,m.typeClasses={liveSessionText:!0,"fontSize-h4":!0};break;case f.activityItemGroups.NGC_UPGRADE:m.content=w.observable(x.getMessageFromNgcUpgradeActivityItem(e));break;case f.activityItemGroups.PLUGIN_FREE:m.content=w.observable(x.getMessageFromPluginFreeActivityItem(e));break;case f.activityItemGroups.PSTN:m.content=w.observable(x.getMessageFromPstnActivityItem(e)),e.type()===v.activityType.PstnInvalidNumber&&!e.isGroup()?(m.linkContent=b.fetch({key:"pstn_invalid_number_return_link"}),m.linkVisible=!0):(m.linkContent="",m.linkVisible=!1),nt(e),m.callAction="callError",m.typeClasses={liveSessionText:!0,"fontSize-h4":!0};break;case f.activityItemGroups.TEXT:var i,s;nt(e),i=u.newObservableProperty(e.html),$.isFeatureOn(f.featureFlags.SWIFT_CARD_RENDERING)&&(s=_.parse(m,e,R)),typeof s!="undefined"?m.content=s:m.content=w.computed(function(){var n=i(),r=W||!n.trim().length,s=$.isFeatureOn(f.featureFlags.URL_PREVIEWS),o=s&&q.personsAndGroupsManager.mePerson.preferences(f.userSettings.preferences.URL_PREVIEWS).value(),u=$.isFeatureOn(f.featureFlags.YOUTUBE_PLAYER_ENABLED),a=u&&q.personsAndGroupsManager.mePerson.preferences(f.userSettings.preferences.YOUTUBE_PLAYER).value(),l=R._translatorSettings&&R._translatorSettings.isEnabled,c=e.direction&&e.direction()===f.chat.messageType.INCOMING,h=!V&&K&&l&&c&&!e.isDeleted();return r?(n=t.escape(e.text()),n=S.encodeLinkTextRepresentation(n),n=S.encodeEmoticonsTextRepresentation(n)):$.isFeatureOn(f.featureFlags.ENABLE_RAW_EMOTICONS_RENDERING)&&(n=S.encodeEmoticonsRawRepresentation(n)),X&&(a&&u||o&&s)&&w.ignoreDependencies(function(){H.render(n,m,R,a&&u,o&&s)}),h&&P.requestTranslation(n,e.direction(),R,rt.bind(null,e)),m.isSticker(I.test(n)),n}),m.isEdited=u.newObservableProperty(e.isEdited),m.isDeleted=u.newObservableProperty(e.isDeleted),st();break;case f.activityItemGroups.MEDIA:var o=E.fetch(e.type());nt(e),o(m,n);break;case f.activityItemGroups.CONTACT_REQUEST:m.author=l.build(e.sender),m.content=w.computed(function(){return x.getMessageFromContactRequestActivityItem(e.type(),m.author.getPerson())}),m.actionInProgress=w.observable(!1),e.type()===v.activityType.ContactRequestIncoming&&(m.greeting=u.newObservableProperty(e.greeting));break;case f.activityItemGroups.POLL:nt(e),m.pollAvatarsVM=C.build(e,function(e){m.dispatchEvent(g.userListPopup.POPUP_TOGGLE,e)}),m.isEdited=u.newObservableProperty(e.isEdited),m.isDeleted=u.newObservableProperty(e.isDeleted),m.content=w.observable(b.fetch({key:"poll_message_question_header",params:{pollQuestion:e.pollQuestion()}})),m.pollQuestion=u.newObservableProperty(e.pollQuestion),m.pollAnswers=u.newObservableCollection(e.pollAnswers),m.answerSent=u.newObservableProperty(e.meVoted),m.checkedAnswer=w.observable(),m.checkedAnswerSubscription=e.meCheckedAnswerPositions.changed(function(){m.checkedAnswer(t.isEmpty(e.meCheckedAnswerPositions())?-1:e.meCheckedAnswerPositions()[0])}),m.peopleVotedText=w.observable(),m.peopleVotedNumSubscription=e.peopleVotedNum.changed(function(e){m.peopleVotedText(b.fetch({key:"poll_message_people_voted",params:{count:e}}))}),m.onAnswerClick=function(t){return e.meVoted()?m.checkedAnswer(e.meCheckedAnswerPositions()[0]):(k.activityVote(m.model),m.model.addAnswer(t)),!0};break;case f.activityItemGroups.CONTACT_INFO:nt(e),h.render(e,m,R);break;case f.activityItemGroups.TRANSACTION:var a="Unsupported transaction message";nt(e),m.content=w.observable(a),m.group(f.activityItemGroups.TEXT);break;case f.activityItemGroups.CUSTOM:m.content=w.observable(e.text())}}function st(){Q&&Q.dispose(),Q=m.isDeleted.subscribe(function(e){if(!e)return;Q.dispose(),Q=null,m.group(f.activityItemGroups.TEXT),m.contentTemplate("textMessageContentTemplate"),m.isUrlPreview(!1),m.previews&&(vt(m.previews()),m.previews([]))})}function ot(){m.showSpacesCTA&&m.showSpacesCTA.dispose(),m.welcomeMessage&&m.welcomeMessage.dispose(),m.othersAddedMessageContent&&m.othersAddedMessageContent.dispose(),m.participantsWithoutMyself&&t.forEach(m.participantsWithoutMyself,function(e){e.dispose()})}function ut(){ot(),m.participantsWithoutAuthor&&t.forEach(m.participantsWithoutAuthor,function(e){e.dispose()})}function at(){m.messageDeliveryStatusEnabled&&m.model.status.changed.off(ft)}function ft(e){var t=m.model.type()===v.activityType.ParticipantJoinFailed,n="iconfont ";m.deliveryFailed(!1);switch(e){case v.activityStatus.Failed:m.deliveryFailed(!t),m.statusText(b.fetch({key:"message_failed_status"})),n+="warning";break;case v.activityStatus.Succeeded:m.statusText(b.fetch({key:"message_sent_status"})),n+="presenceOnlineStroke";break;case v.activityStatus.Pending:m.statusText(b.fetch({key:"message_sending_status"})),n+="presenceStroke";break;default:m.statusText("")}m.deliveryStatusIconCssClass(n)}function lt(e){var t;t=q.conversationsManager.getConversation(e),q.conversationsManager.conversations.add(t),A.publish(g.navigation.OPEN_CONVERSATION,{model:t,origin:f.telemetry.historyLoadOrigin.AUTHOR_SWITCH})}function ct(e){if(!m.contacts||m.isMyself)return;h.handleContactAdded(e.id(),m)}function ht(e){var t;return m.model.contacts().some(function(n){n.id()===e&&(t=n)}),t}function pt(e){e?m.model.status.changed(ft):at()}function dt(){m.actionInProgress(!1)}function vt(e){e.forEach(function(e){t.isFunction(e.dispose)&&(e.ytPlayer(!1),e.dispose.call(e))})}var m=this,q=i.get(),R,U=!1,z,W,X=!e||!e.noUrlPreview,V=e&&e.noTranslationItem,$=O.resolve(f.serviceLocator.FEATURE_FLAGS),J=q.translatorService,K=J&&q.translatorService.state()===f.translatorServiceState.Authenticated,Q;this.init=function(e,t){var n=O.resolve(f.serviceLocator.FEATURE_FLAGS),r=e.key();z=n.isFeatureOn(f.featureFlags.SPACES),W=n.isFeatureOn(f.featureFlags.MESSAGE_ENFORCE_TEXT_FORMAT),R=t,m.isEdited=w.observable(!1),m.messageDeliveryIndicatorEnabledSW4B=n.isFeatureOn(f.featureFlags.SHOW_MESSAGE_DELIVERY_INDICATOR_SW4B),m.messageDeliveryStatusEnabled=n.isFeatureOn(f.featureFlags.SHOW_MESSAGE_DELIVERY_STATUS)&&e.type()!==v.activityType.SystemMessage,m.isDeleted=w.observable(!1),m.isMyself=!1,m.clientmessageid=r,m.contentId=r?"msg_"+r:null,m.timestamp=e.timestamp(),m.setTimestamp=w.observable("00:00"),m.showTimestamp=w.observable(!0),m.isRead=u.newObservableProperty(e.isRead),m.isFirstMessage=w.observable(!1),m.isLastMessage=w.observable(!1),m.isLastMessageInBubble=w.observable(!1),m.model=e,m.group=w.observable(x.getActivityItemGroup(e.type())),m.isGroupConversation=R.isGroupConversation(),m.renderAuthorInfo=w.observable(!1),m.showAuthorInfo=w.observable(!1),m.liveSessionDuration=!1,m.isCallActivityItem=w.computed(function(){return m.group()===f.activityItemGroups.CALL||m.group()===f.activityItemGroups.PSTN}),m.isSticker=w.observable(),m.isMoji=w.observable(!1),m.isPicture=w.observable(!1),m.isUrlPreview=w.observable(!1),m.deliveryFailed=w.observable(!1),m.deliveryFailedMessage=b.fetch({key:"message_not_delivered_text"}),m.statusText=w.observable(),m.deliveryStatusIconCssClass=w.observable(),m.isMyLastMessageInChat=w.observable(!1),m.isIntegrated=M.get().isIntegratedProperty(),m.copyLinkEnabled=w.observable(!1),m.copyActive=w.observable(!1),m.heartsVM=y.build(m,R,function(e){m.dispatchEvent(g.userListPopup.POPUP_TOGGLE,e)}),m.heartsVM.init(),m.contentTemplate=w.observable(G(e.type())),m.typeClasses={},it(e,R.isGroupConversation()),m.cssClass=w.computed(Y,this),m.messageDeliveryIndicatorEnabledSW4B&&m.model.status.changed(ft),m.messageDeliveryStatusEnabled&&m.isMyLastMessageInChat.subscribe(pt),q.personsAndGroupsManager.all.persons.added(ct),V||(m.translationItem=D.build(m,R),m.translationItem.init()),m.forwardEvent(g.videoPlayer.FULLSCREEN_ON,m.DIRECTION.PARENT,null,m.DIRECTION.CHILD),m.forwardEvent(g.videoPlayer.FULLSCREEN_OFF,m.DIRECTION.PARENT,null,m.DIRECTION.CHILD)},this.dispose=function(){Q&&Q.dispose(),m.content&&m.content.dispose&&m.content.dispose(),m.cssClass&&m.cssClass.dispose(),m.author&&m.author.dispose(),m.isCallActivityItem&&m.isCallActivityItem.dispose(),m.checkedAnswerSubscription&&m.checkedAnswerSubscription.dispose&&m.checkedAnswerSubscription.dispose(),m.peopleVotedNumSubscription&&m.peopleVotedNumSubscription.dispose&&m.peopleVotedNumSubscription.dispose(),ut(),m.model&&(m.messageDeliveryIndicatorEnabledSW4B||m.messageDeliveryStatusEnabled)&&m.model.status.changed.off(ft),m.heartsVM&&m.heartsVM.dispose(),q.personsAndGroupsManager.all.persons.added.off(ct),m.translationItem&&m.translationItem.dispose(),m.previews&&(vt(m.previews()),m.previews([]))},this.onRendered=function(){m.isRendered=!0,m.dispatchEvent(g.message.RENDERED)},this.onBeforeExpanded=function(){m.dispatchEvent(g.message.BEFORE_EXPANDED)},this.onAfterExpanded=function(){m.dispatchEvent(g.message.AFTER_EXPANDED)},this.openConversationWithAuthor=function(){if(R.selfParticipant.isAnonymous()||N.isGuest(m.model.sender))return!1;lt(m.model.sender)},this.navigateToDialPad=function(){function e(){return{page:a.calling.SKYPEOUT_PAGE,origin:f.telemetry.historyLoadOrigin.SKYPEOUT_PAGE}}A.publish(f.events.navigation.NAVIGATE,e())},this.sendContactRequest=function(){function o(e,t,n){function i(r){r.name()===F.defaultBusinessContactsGroup&&(q.personsAndGroupsManager.all.groups.added.off(i),u(r,e,t,n))}var r;r=q.personsAndGroupsManager.createGroup(),r.name.set(F.defaultBusinessContactsGroup),q.personsAndGroupsManager.all.groups.add(r).then(function(){q.personsAndGroupsManager.all.groups.added(i)},n)}function u(e,t,n,r){e.persons.add(t.id()).then(function(){R.historyService.removeCustomActivityItem(v.activityType.ContactRequestOutgoing),R.historyService.removeCustomActivityItem(v.activityType.ContactRequestIsNowContact),R.historyService.addCustomActivityItem(v.activityType.ContactRequestIsNowContact,{sender:t}),n()},r)}function a(){r===v.activityType.ContactRequestOutgoing&&i.recordAction(n.contacts.contactRequestSent,{isResend:!1}),r===v.activityType.ContactRequestOutgoingAgent&&i.recordAction(n.contacts.contactRequestSent,{isResend:!1}),r===v.activityType.ContactRequestOutgoingResend&&i.recordAction(n.contacts.contactRequestSent,{isResend:!0}),r===v.activityType.SuggestedContact&&i.recordAction(n.contacts.contactRequestSuggestedSent)}var e,t=m.model.sender,r=m.model.type(),i=O.resolve(f.serviceLocator.ACTION_TELEMETRY),s;return m.actionInProgress(!0),q.conversationsManager.conversations.add(R),$.isFeatureOn(f.featureFlags.ENABLE_BUSINESS_CONTACT_MANAGEMENT)?e=new Promise(function(e,n){q.personsAndGroupsManager.all.groups.get().then(function(r){s=r.filter(function(e){return e.name()===F.defaultBusinessContactsGroup}),s.length>0?u(s[0],t,e,n):o(t,e,n)},n)}):e=q.personsAndGroupsManager.all.persons.add(t,t.id(),undefined,r),a(),e.then(dt,dt),e},this.acceptContactRequest=function(){var e,t=m.model.sender,r=O.resolve(f.serviceLocator.ACTION_TELEMETRY);return m.actionInProgress(!0),e=q.personsAndGroupsManager.all.persons.add(t,t.id(),undefined,v.activityType.ContactRequestIncoming),r.recordAction(n.contacts.contactRequestAccepted),e.then(dt,dt),e},this.declineContactRequest=function(){var e,t=O.resolve(f.serviceLocator.ACTION_TELEMETRY);return m.actionInProgress(!0),e=q.conversationsManager.conversations.remove(R,v.activityType.ContactRequestIncoming),t.recordAction(n.contacts.contactRequestDeclined),e.then(dt,dt),e},this.blockContactRequest=function(){var e={source:r.contactRequestIncomingActivityItem},t=new o(m.author.getPerson(),e),n=b.fetch({key:"modal_blockContact_text_aria_label"});return T.build(o.ELEMENT_ID,t,s),T.show(o.ELEMENT_ID,n),Promise.resolve()},this.unblockContact=function(){var e,t=m.model.sender,i=O.resolve(f.serviceLocator.ACTION_TELEMETRY);return m.actionInProgress(!0),i.recordAction(n.contacts.contactUnblocked,{source:r.unblockActivityItem}),t.isBlocked.set.enabled()?e=t.isBlocked.set(!1):e=Promise.resolve(),e.then(dt,dt),e},this.openUrlPreview=function(e,t){function n(){if(!$.isFeatureOn(f.featureFlags.URL_PREVIEW_LOAD_YOUTUBE_PLAYER))return!1;var n=t||w.utils.arrayFirst(m.previews(),function(t){return t.url()===e});return n&&n.type()===f.urlPreviewType.YT&&!n.restrictions?n:null}var r=n(),i={url:e,timestamp:m.timestamp,participantCount:R.participantsCount()};return B.publishActionEvent(i),r&&j.render(r,m,R,e)?!1:!0},this.isPSTNContactMessage=function(e){var t=ht(e);return N.isPstn(t)},this.contactHasFullName=function(e){var t=ht(e);return t.displayName()!==e||N.isPstn(t)},this.isMePersonContactMessage=function(e){return N.isMePersonId(e)},this.openConversationWithUser=function(e){var t=ht(e);lt(t),c.publishActionEvent({person:t,participantsCount:R.participantsCount(),timeInStale:m.timestamp.getTime()})},this.addCreditTelemetry=function(e,t){var n=f.telemetry.pstn;return t.target.className===n.cssClasses.ADD_CREDIT?L.addingCredit(n.entryPoint.NO_CREDIT_CALL_END):t.target.className===n.cssClasses.ADD_SUBSCRIPTION&&L.addingSubscription(n.entryPoint.NO_SUBSCRIPTION_CALL_END),!0},this.activateFirstLink=function(e,t){var n=e.elementInfo.element.querySelector(".content a");n&&t.target.tagName!=="A"&&(n.click(),t.preventDefault(),t.stopPropagation())}}var t=e("lodash-compat"),n=e("ui/telemetry/actions/actionNames"),r=e("ui/telemetry/actions/actionSources"),i=e("cafe/applicationInstance"),s=e("text!views/people/blockContactModal.html"),o=e("ui/viewModels/people/blockContactModal"),u=e("utils/common/cafeObservable"),a=e("constants/components"),f=e("constants/common"),l=e("ui/viewModels/people/contactBuilder"),c=e("telemetry/chat/contactInfoEvent"),h=e("ui/contactInfoMessage/contactInfoMessage"),p=e("ui/viewModels/people/contactName"),d=e("constants/contentTemplates"),v=e("swx-enums"),m=e("utils/common/eventMixin"),g=f.events,y=e("ui/viewModels/chat/hearts"),b=e("swx-i18n").localization,w=e("vendor/knockout"),E=e("ui/viewModels/chat/messageMediaTypesHandlers"),S=e("utils/chat/messageSanitizer"),x=e("utils/chat/message"),T=e("ui/modalDialog/modalDialog"),N=e("ui/modelHelpers/personHelper"),C=e("ui/viewModels/chat/pollAvatars"),k=e("telemetry/chat/poll"),L=e("telemetry/calling/pstn/pstn"),A=e("services/pubSub/pubSub"),O=e("services/serviceLocator"),M=e("utils/common/styleModeHelper"),_=e("ui/viewModels/chat/messageParsers/swiftCard"),D=e("ui/viewModels/chat/translator/translationItem"),P=e("utils/chat/translatorHelper"),H=e("ui/urlPreview/urlPreview"),B=e("telemetry/chat/urlPreviewAction"),j=e("ui/players/ytPlayer"),F=e("experience/settings"),I=/<span class="emoticon\s?\w*\s?(animated)?\s+\w*large"><span class="emoSprite">.*<\/span><\/span>/i;return t.assign(q.prototype,m),q}),define("ui/viewModels/chat/conversationProcessor",["require","utils/chat/dateTime","constants/common"],function(e){var t=e("utils/chat/dateTime"),n=e("constants/common"),r=3e5,i=function(e){return t.getMidnight(e)},s=function(e,t){return t===undefined?!0:e!==t},o=function(e,t){return i(t)!==i(e)},u=function(e,t,n){var i=e>t,s=e-n;return i&&s>=r};return function(){this.processMessage=function(e,r){var a=e.group()===n.activityItemGroups.TEXT,f=e.group()===n.activityItemGroups.MEDIA,l=e.group()===n.activityItemGroups.CONTACT_INFO,c=e.group()===n.activityItemGroups.CALL,h=e.group()===n.activityItemGroups.POLL,p=e.group()===n.activityItemGroups.PSTN,d=e.group()===n.activityItemGroups.PARTICIPANT,v=a||f||l||h,m=v||c||p,g=c||f||p,y=e.author&&e.author.id(),b=s(r.previousAuthor,y),w=r.midnight||i((new Date).getTime()),E=o(r.previousTimestamp,e.timestamp),S=e.playerId||f,x=g||b||E||S||u(e.timestamp,w,r.lastShowedTimestamp),T=!e.isMyself,N=v&&(b||!!r.suppressedLastAuthor),C=m&&(x||!!r.suppressedLastTimestamp),k=t.formatTimestamp(e.timestamp,w),L=r.previousMessage&&C&&!N&&!r.previousMessage.showTimestamp()||d;return e.isFirstMessage(e.isDisjoined||r.previousIsDisjoined||N),e.isLastMessage(!0),e.showAuthorInfo(T&&e.isFirstMessage()),e.showTimestamp(C),e.setTimestamp(k),C&&(r.lastShowedTimestamp=e.timestamp),r.previousIsLastMessage&&r.previousIsLastMessage(e.isFirstMessage()),r.previousMessage&&r.previousMessage.isLastMessageInBubble(L),r.previousAuthor=y,r.previousTimestamp=e.timestamp,r.suppressedLastAuthor=!v,r.suppressedLastTimestamp=!m||f,r.midnight=w,r.previousIsLastMessage=e.isLastMessage,r.previousIsDisjoined=e.isDisjoined,r.previousMessage=e,r},this.processMyLastMessageIfAny=function(e){var t;if(e.length<=0)return;for(t=e.length-1;t>=0;t--)if(e[t].isMyself){e[t].isMyLastMessageInChat(!0);return}},this.processMyBeforeLastMessageIfAny=function(e){var t,n=!1;if(e.length<=1)return;for(t=e.length-1;t>=0;t--){if(!e[t].isMyself||!e[t].isMyLastMessageInChat())continue;if(!!n){e[t].isMyLastMessageInChat(!1);return}n=!0}}}}),define("telemetry/utils/telemetryUtils",["require","exports","module","constants/common"],function(e,t){var n=e("constants/common"),r=n.telemetry.NOT_AVAILABLE;t.stringify=function(e){for(var t in e)e.hasOwnProperty(t)&&!(typeof e[t]=="string"||e[t]instanceof String)&&(e[t]=e[t]+"");return e},t.getOriginDescription=function(e,t){for(var n in t)if(t.hasOwnProperty(n)&&t[n]===e)return n;return r}}),define("telemetry/chat/conversationHistoryLoad",["require","constants/common","services/telemetry/skypeData","services/telemetry/common/telemetryContext","telemetry/utils/telemetryUtils","telemetry/chat/telemetryEnumerator","telemetry/chat/activityItemHelper"],function(e){function a(e){var a=this;a._context={timer:null,startTime:null,syncEndTime:null,renderEndTime:null,SYNC_TIMEOUT:1e4,conversationLoaded:e,pageNumber:0,isUnread:0,hasError:!1,isCached:t.telemetry.NOT_AVAILABLE,timeInStale:t.telemetry.NOT_AVAILABLE},function(){var n=e.historyService.activityItems(),r=n[n.length-1];a._context.isUnread=!1;if(!r)return;a._context.isUnread=!r.isRead(),a._context.timeInStale=0;if(a._context.isUnread){var i=+(new Date);a._context.timeInStale=(i-r.timestamp())/1e3}}(),a.start=function(){a._context.startTime=(new Date).getTime(),a._context.timer=setTimeout(a.publish,a._context.SYNC_TIMEOUT)},a.registerSync=function(){a._context.timer||(a._context.pageNumber++,a.start()),a._context.syncEndTime=(new Date).getTime(),a._context.renderEndTime=a._context.syncEndTime},a.registerRender=function(){a._context.renderEndTime=(new Date).getTime()},a.registerError=function(){a._context.hasError=!0,a._context.syncEndTime=(new Date).getTime(),a.publish()},a.dispose=function(){a._context.conversationLoaded=null},a.publish=function(){a._context.timer&&(clearTimeout(a._context.timer),a._context.timer=null);var f=o.processConversation(e),l=r.get(),c=u.TYPE,h,p=l.chatHistoryLoadResult[e.conversationId];return f.participantsCount=e.participants().length,f.participantsCountGroup=s.getParticipantCountGroup(e.participants().length),f.isFavorite=!!e._isFavorited&&e._isFavorited(),f.ttl=a._context.syncEndTime-a._context.startTime,f.ttlDurationGroup=s.getSecondsDurationGroupFromMs(f.ttl),f.tis=a._context.timeInStale,f.isUnread=a._context.isUnread,f.pageNumber=a._context.pageNumber,f.responseCode=p,a._context.hasError?f.ttr=t.telemetry.NOT_AVAILABLE:f.ttr=a._context.renderEndTime-a._context.startTime,f.ttrDurationGroup=s.getSecondsDurationGroupFromMs(f.ttr),f.origin=l.historyLoadOrigin,f.originDescription=i.getOriginDescription(l.historyLoadOrigin,t.telemetry.historyLoadOrigin),f.t404=l.isChatHistoryLoad404,f.isError=s.isError(p),h={type:c,data:f},n.push(h),a.dispose(),f}}var t=e("constants/common"),n=e("services/telemetry/skypeData"),r=e("services/telemetry/common/telemetryContext"),i=e("telemetry/utils/telemetryUtils"),s=e("telemetry/chat/telemetryEnumerator"),o=e("telemetry/chat/activityItemHelper"),u=t.telemetry.conversationHistoryLoadEvent;return a}),define("text!views/chat/chatLog.html",[],function(){return'<div class="conversation scrollable scrollViewport scrollViewportV" data-bind="event: { scroll: onScroll }" tabindex="-1">\r\n    <div class="history scrollViewport-inner">\r\n        <div class="scroller">\r\n            <!-- ko if: showIntroText -->\r\n            <div class="chatLogIntroText" data-bind="foreach: introMessages">\r\n                <p data-bind="text: $data.text" tabindex="-1"></p>\r\n            </div>\r\n            <!-- /ko -->\r\n            <div class="messageHistory largeAllowed" role="list" data-swx-testId="messageHistory" data-bind="foreach: collection, css: { visible: collection().length > 0 }, keyboardNavigation: { itemSelector: \'swx-message, [tabindex=\\\'-1\\\']:not([disabled])\', selectLastItem: true }">\r\n                <swx-message role="listitem" params="viewModel: $data" data-bind="css: $data.cssClass, attr: { \'data-id\': $data.clientmessageid }, enterKey: activateFirstLink" class="message showName loading" tabindex="-1" aria-relevant="all"></swx-message>\r\n            </div>\r\n            <swx-typing-indicator class="typingIndicator" params="participants: participants"></swx-typing-indicator>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div role="log" aria-live="assertive" class="offScreen" data-bind="html:ariaForNewMessage()"></div>\r\n'}),define("ui/components/chat/chatLog",["require","exports","module","vendor/knockout","ui/viewModels/chat/chatLog","jsviews/chat/chatLog","ui/viewModels/chat/message","ui/viewModels/chat/conversationProcessor","utils/common/resizeHandler","telemetry/chat/conversationHistoryLoad","constants/components","text!views/chat/chatLog.html"],function(e,t){function f(e,t){var f=new i(t.element,u),l=new r(s),c=n.dataFor(t.element),h=new o,p=new a(e.conversationModel);return l.setContext(c),l.init(e.conversationModel,f,h,p),l}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/chatLog"),i=e("jsviews/chat/chatLog"),s=e("ui/viewModels/chat/message"),o=e("ui/viewModels/chat/conversationProcessor"),u=e("utils/common/resizeHandler"),a=e("telemetry/chat/conversationHistoryLoad");t.name=e("constants/components").chat.CHAT_LOG,t.template=e("text!views/chat/chatLog.html"),t.viewModel={createViewModel:f}}),define("telemetry/chat/pes",["require","lodash-compat","constants/common","swx-utils-common","experience/settings","ui/telemetry/telemetryClient"],function(e){function o(){function e(e,r){var i=t.find(r,function(t){return t.item.id===e});return i?(r.splice(r.indexOf(i),1),i):{type:n.telemetry.pes.source.TYPED,section:n.telemetry.pes.UNKNOWN,tabName:n.telemetry.pes.UNKNOWN,tabIndex:n.telemetry.pes.UNKNOWN}}this.emoticonsSentInMessage=function(o,u){var a=r.create();o.forEach(function(t){var r=e(t,u);s.get().sendEvent(i.telemetry.uiTenantToken,n.telemetry.pes.eventName.EMO_SENT,{message_id:a+"",emo_id:t+"",emo_source:r.type+"",emo_section:r.section+"",emo_tab_name:r.tabName+"",emo_tab_index:r.tabIndex+""})})},this.mojiPlayed=function(t,r){s.get().sendEvent(i.telemetry.uiTenantToken,n.telemetry.pes.eventName.MOJI_PLAYED,{moji_id:t.id+"",moji_name:t.pickerTitle+"",cause:r+""})},this.mojiSent=function(t,r){s.get().sendEvent(i.telemetry.uiTenantToken,n.telemetry.pes.eventName.MOJI_SENT,{moji_id:t.id+"",moji_name:t.pickerTitle+"",moji_source:r.type+"",moji_section:r.section+"",moji_tab_name:r.tabName+"",moji_tab_index:r.tabIndex+""})},this.imageSent=function(t,r){s.get().sendEvent(i.telemetry.uiTenantToken,n.telemetry.pes.eventName.IMAGE_SENT,{image_id:t.id+"",image_query:r.query+"",image_picker_index:t.pickerIndex+"",image_source:r.type+"",image_section:r.section+"",image_tab_name:r.tabName+"",image_tab_index:r.tabIndex+""})}}var t=e("lodash-compat"),n=e("constants/common"),r=e("swx-utils-common").guid,i=e("experience/settings"),s=e("ui/telemetry/telemetryClient");return new o}),define("ui/modelObservers/agentAuthorizationObserver",["require","exports","module","vendor/knockout","cafe/applicationInstance","ui/modelHelpers/conversationHelper","ui/modelHelpers/personHelper"],function(e,t){function o(e){function o(){i.isOneToOneConversationWithAgent(e)&&r.get().personsAndGroupsManager.all.persons.changed(u)}function u(){var n=e.participants()[0].person,r=s.isKnownPerson(n);t.isConversationWithUnauthorizedAgent(!r)}var t=this;t.isConversationWithUnauthorizedAgent=n.observable(!1),t.dispose=function(){r.get().personsAndGroupsManager.all.persons.changed.off(u)},o()}var n=e("vendor/knockout"),r=e("cafe/applicationInstance"),i=e("ui/modelHelpers/conversationHelper"),s=e("ui/modelHelpers/personHelper");t.build=function(e){return new o(e)}}),define("ui/viewModels/chat/chatInput",["require","lodash-compat","vendor/knockout","services/pubSub/pubSub","utils/common/cafeObservable","constants/common","constants/calling","utils/common/eventMixin","constants/common","services/serviceLocator","telemetry/chat/pes","ui/modelObservers/agentAuthorizationObserver"],function(e){function h(){function d(){return!!e.conversationModel}function v(e){var n=t.find(e.sourceTab.packs,function(t){return t.items.some(function(t){return t===e.item})}),r={type:e.sourceTab.id==="mru"?a.telemetry.pes.source.RECENTS:a.telemetry.pes.source.ROSTER,tabIndex:e.sourceTab._index||e.sourceTab.index,tabName:e.sourceTab.title,section:n&&n.isFeatured?a.telemetry.pes.section.FEATURED:a.telemetry.pes.section.REGULAR};l.mojiSent(e.item,r)}function m(e){var n=t.find(e.sourceTab.packs,function(t){return t.items.some(function(t){return t.id===e.item.id})}),r=t.findIndex(n.items,{id:e.item.id}),i={type:a.telemetry.pes.source.ROSTER,section:n&&n.id,query:e.sourceTab._currentQuery,tabName:e.sourceTab.id,tabIndex:e.sourceTab._index};l.mojiSent({id:e.item.id,type:e.item.type},i),l.imageSent({id:e.item.id,pickerIndex:r},i)}function g(t){u.isFeatureOn(a.featureFlags.GIPHY)&&(/^\/giphy\b/.test(t)?x("giphy"):x(null)),e.isSendDisabled(!t||t.length===0)}function y(t){if(!d()||t.conversation!==e.conversationModel)return;switch(t.item.type){case"flik":e.conversationModel.chatService.sendMessage("/moji "+t.item.id),v(t);var n=f.resolve(a.serviceLocator.PES_MRU_SERVICE);n.addItemsToMru(t.item);break;case"image":e.conversationModel.chatService.sendMessage(t.item.url),m(t)}}function b(){if(u.isFeatureOn(a.featureFlags.SKIP_CHAT_CAPABILITY_CHECK)){e.hasChatCapability(!0);return}var t=!1,n,r=e.conversationModel.participants().length;for(var i=0;i<r&&!t;i++)t=e.conversationModel.participants()[i].person.capabilities.chat();n=r===0||t,e.hasChatCapability(n)}function w(){h&&(E(),b()),h=[],e.conversationModel.participants().forEach(function(e){var t=e.person,n=t.capabilities.chat.subscribe(),r={person:t,subscription:n};t.capabilities.chat.get(),t.capabilities.chat.changed(b),h.push(r)})}function E(){h&&(h.forEach(function(e){e.person.capabilities.chat.changed.off(b),e.subscription.dispose()}),h=undefined)}function S(){return e.isServiceEnabled()&&e.hasChatCapability()&&!p.isConversationWithUnauthorizedAgent()}function x(t){e.attribution(t)}var e=this,u=f.resolve(a.serviceLocator.FEATURE_FLAGS),h,p;this.init=function(t,u){this.sendMessage=t.sendMessage,this.chatInputEl=u,this.attribution=n.observable(null),this.conversationModel=t.conversationModel,this.alwaysHideExpressionPicker=!!t.alwaysHideExpressionPicker,this.isServiceEnabled=d()?i.newObservableProperty(this.conversationModel.chatService.sendMessage.enabled):n.observable(!0),this.hasChatCapability=n.observable(!0),d()&&this.conversationModel.participants.changed(w),p=c.build(t.conversationModel),this.isEnabled=n.computed(S),this.isSendDisabled=n.observable(!0),this.forwardEvent(s.message.QUOTE,this.DIRECTION.CHILD),this.forwardEvent(s.message.EDIT,this.DIRECTION.CHILD),this.forwardEvent(o.EVENTS.CALL_SCREEN_CLOSE,this.DIRECTION.CHILD),this.forwardEvent(s.navigation.FRAGMENT_SHOW,this.DIRECTION.CHILD),this.forwardEvent(s.emoticonPicker.EMOTICON_SELECTED,this.DIRECTION.CHILD),this.forwardEvent(s.emoticonPicker.CLOSE,this.DIRECTION.CHILD),this.registerEvent(s.textarea.CHANGED,g),this.registerEvent(s.textarea.SET_ATTRIBUTION,x),r.subscribe(s.expressionPicker.ITEM_SEND_REQUEST,y),this._parentContext&&(this.forwardEvent(s.textarea.INITIALIZATION_COMPLETE,this.DIRECTION.PARENT),this.dispatchEvent(s.chatInput.INITIALIZATION_COMPLETE,e,e.DIRECTION.PARENT))},this.sendButtonClicked=function(){e.dispatchEvent(s.textarea.SUBMIT_AND_FOCUS,null,e.DIRECTION.CHILD)},this.dispose=function(){d()&&(e.isEnabled.dispose(),e.isServiceEnabled.dispose(),E(),e.conversationModel.participants.changed.off(w)),p.dispose(),r.unsubscribe(s.expressionPicker.ITEM_SEND_REQUEST,y)},this.isExpressionPickerButtonVisible=function(){return!e.alwaysHideExpressionPicker&&!u.isFeatureOn(a.featureFlags.HIDE_EMOTICON_PICKER_BUTTON)},this.isPESEnabled=function(){return d()},this.isMediaBarEnabled=function(){return u.isFeatureOn(a.featureFlags.MEDIA_BAR_ENABLED)}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("services/pubSub/pubSub"),i=e("utils/common/cafeObservable"),s=e("constants/common").events,o=e("constants/calling"),u=e("utils/common/eventMixin"),a=e("constants/common"),f=e("services/serviceLocator"),l=e("telemetry/chat/pes"),c=e("ui/modelObservers/agentAuthorizationObserver");return t.assign(h.prototype,u),h}),define("text!views/chat/chatInput.html",[],function(){return'<div class="tc">\r\n    <div class="form-holder" data-bind="css: attribution">\r\n\r\n        <div class="form">\r\n            <form id="textarea-bindings">\r\n                <swx-textarea params="conversationModel: conversationModel, isEnabled: isEnabled, isServiceEnabled: isServiceEnabled, sendMessage: sendMessage, chatInputEl: chatInputEl, hasChatCapability: hasChatCapability"></swx-textarea>\r\n            </form>\r\n        </div>\r\n\r\n        <div class="buttonRow">\r\n            <!-- ko if: isMediaBarEnabled() -->\r\n            <swx-chat-input-action-picker params="isDisabled: !isEnabled(), conversationModel: conversationModel"></swx-chat-input-action-picker>\r\n            <!-- /ko -->\r\n            <!-- ko if: isExpressionPickerButtonVisible() -->\r\n                <swx-expression-picker params="isDisabled: !isEnabled()" class="expressionPicker"></swx-expression-picker>\r\n            <!-- /ko -->\r\n            <div class="send-button-holder">\r\n                <swx-button params="icon: \'send\', cssClass: \'circle send-button large\', disabled: isSendDisabled,\r\n                    titleKey: \'action_button_send\', textKey: \'action_button_send\', action: sendButtonClicked,\r\n                    ariaLabelKey: \'action_button_send\'"></swx-button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/chatInput",["require","exports","module","vendor/knockout","ui/viewModels/chat/chatInput","constants/components","text!views/chat/chatInput.html"],function(e,t){function i(e,t){var i=new r,s=n.dataFor(t.element);return i.init(e,t.element),i.setContext(s),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/chatInput");t.name=e("constants/components").chat.CHAT_INPUT,t.template=e("text!views/chat/chatInput.html"),t.viewModel={createViewModel:i}}),define("services/telemetry/common/analyticsInfo",["require","cafe/applicationInstance","constants/common","lodash-compat"],function(e){function o(e){return r.isString(e)&&/^19:/.test(e)}function u(){function u(e){return e&&e!==s}function a(e){return{thread1Count:e,thread30Count:e,conversation1Count:e,conversation30Count:e,unreadConversationsCount:e}}var e=function(e){var t=new Date;return e.setHours(0,0,0,0)===t.setHours(0,0,0,0)},r=function(n,r){var i=n.lastMessage,s=o(n.id);return i?(e(new Date(i.timestamp))&&(s?r.thread1Count++:r.conversation1Count++),s?r.thread30Count++:r.conversation30Count++,i.isUnread&&r.unreadConversationsCount++,r):r},i={};return i.conversationsInfo=function(){var e,n,i,o=a(0);if(t.get().conversationsManager&&t.get().conversationsManager._allConversations){i=t.get().conversationsManager._allConversations();for(e=0,n=i.length;e<n;e++)o=r(i[e],o)}else o=a(s);return o},i.contactsInfo=function(){return{totalContacts:t.get().personsAndGroupsManager.all.persons().length}},i.getPersonaId=function(){var e,t=i.contactsInfo().totalContacts,r=i.conversationsInfo(),s=u(r.thread30Count)||u(r.conversation30Count),o=t===0;return s?(e=r.thread30Count===0,e?n.telemetry.persona.CLASSIC_IM:n.telemetry.persona.POWER_IM):o?n.telemetry.persona.NEWBEE:n.telemetry.persona.RETURNING},i}var t=e("cafe/applicationInstance"),n=e("constants/common"),r=e("lodash-compat"),i,s=n.telemetry.NOT_AVAILABLE;return u.get=function(){return i||(i=new u),i},u}),define("telemetry/chat/conversationUpdateFlow",["require","constants/common","services/telemetry/common/analyticsInfo","services/telemetry/common/telemetryContext","services/telemetry/skypeData","usertiming"],function(e){function h(){function u(){e.cta=t.telemetry.NOT_AVAILABLE,e.failedParticipants=t.telemetry.NOT_AVAILABLE,e.addedParticipantsCount=0,e.ttc=t.telemetry.NOT_AVAILABLE,e.tts=t.telemetry.NOT_AVAILABLE,e.conversationType=a.UNKNOWN,e.isSuccess=!0,e.isCompleted=!1,e.isStarted=!1}function h(){for(var e in n.CONVERSATION_UPDATE)n.CONVERSATION_UPDATE.hasOwnProperty(e)&&f.clearMarks(n.CONVERSATION_UPDATE[e]);for(var t in r.CONVERSATION_UPDATE)r.CONVERSATION_UPDATE.hasOwnProperty(t)&&f.clearMeasures(r.CONVERSATION_UPDATE[t])}function p(e,n,r){f.measure(e,n,r);var i=f.getEntriesByName(e);return i&&i.length>0?i[0]:t.telemetry.NOT_AVAILABLE}function d(){e.ttc=p(r.CONVERSATION_UPDATE.TTC,n.CONVERSATION_UPDATE.UPDATE_START,n.CONVERSATION_UPDATE.UPDATE_END),e.isCompleted&&(e.tts=p(r.CONVERSATION_UPDATE.TTS,n.CONVERSATION_UPDATE.UPDATE_END,n.CONVERSATION_UPDATE.SYNC_END))}function v(){f.mark(n.CONVERSATION_UPDATE.SYNC_END);try{d(),h()}catch(t){}var r={type:l,data:{stage:e.stage,cta:e.cta,contactsCount:e.contactsCount,originalParticipantCount:e.originalParticipantCount,addedParticipantsCount:e.addedParticipantsCount,conversationType:e.conversationType,failedParticipants:e.failedParticipants,ttc:e.ttc,tts:e.tts,ttr:"n/a",isSuccess:e.isSuccess}};o.push(r),e.isStarted=!1}function m(t,r){e.stage=t,f.mark(n.CONVERSATION_UPDATE.UPDATE_END),r&&v()}var e=this;e.start=function(t,r){u(),e.isStarted=!0;var s=new i;e.originalParticipantCount=t,e.contactsCount=s.contactsInfo().totalContacts,e.conversationType=r?a.GROUP:a.DIALOG,f.mark(n.CONVERSATION_UPDATE.UPDATE_START)},e.abandoned=function(){var t;if(!e.isStarted||e.isCompleted)return;t=s.get(),e.cta=t.historyLoadOrigin,m(c.ABANDONED,!0)},e.cancelled=function(){m(c.CANCELLED,!0)},e.completed=function(t){e.addedParticipantsCount=t,e.isCompleted=!0,m(c.COMPLETED,!1)},e.performed=function(t){e.isSuccess=t>0,e.failedParticipants=t,v()},u()}var t=e("constants/common"),n=t.telemetry.performanceMarks,r=t.telemetry.measurements,i=e("services/telemetry/common/analyticsInfo"),s=e("services/telemetry/common/telemetryContext"),o=e("services/telemetry/skypeData"),u=t.telemetry.stages,a=t.telemetry.conversationType,f=e("usertiming"),l="chat_conversation_update",c=u.CONVERSATION_UPDATE;return h}),define("services/cqf/cqfSettings",["require","exports","module","services/ecs/configLoader","swx-enums","experience/settings"],function(e,t){function o(){function o(){if(!t||!s)s=n.loadConfig(r.ecsClientNames.Skype,i.ecsCqfKey);return s}function u(){return{minimumCallLength:i.cqf.minimumCallLengthSec*1e3,pstnCallPercentage:i.cqf.pstnCallPercentage,groupCallPercentage:i.cqf.groupCallPercentage,skypeCallPercentage:i.cqf.skypeCallPercentage}}function a(e){return{minimumCallLength:e.Configurations.CQF_Trigger.MinCallDurationSecs*1e3,pstnCallPercentage:e.Configurations.CQF_Trigger.PSTN_Percent,groupCallPercentage:e.Configurations.CQF_Trigger.GroupCall_Percent,skypeCallPercentage:e.Configurations.CQF_Trigger.S2S_Percent}}var e=this,t=!1,s;return e.get=function(){var e=new Promise(function(e){o().then(function(n){t=!0,e(a(n))},function(){e(u())})});return e},e}var n=e("services/ecs/configLoader"),r=e("swx-enums"),i=e("experience/settings"),s;t.build=function(){return s||(s=new o),s}}),define("services/cqf/trigger",["require","exports","module","msr-crypto","services/cqf/cqfSettings"],function(e,t){var n=e("msr-crypto").aes,r=e("services/cqf/cqfSettings");t.validateCall=function(e){var t=r.build(),i;return i=new Promise(function(r,i){t.get().then(function(t){function s(e){return e.hasPSTN?t.pstnCallPercentage:e.isGroupConversation?t.groupCallPercentage:t.skypeCallPercentage}function o(e){var t=n.utilities.stringToBytes(e),r=n.sha256.computeHash(t),i=n.utilities.bytesToInt32(r);return i>>>0}if(e.duration<t.minimumCallLength)i();else{var u=s(e),a=o(e.callId),f=a%100;f<u?r():i()}})}),i}}),define("utils/common/disposableMixin",["require","services/pubSub/pubSub","browser/window","constants/common","vendor/knockout"],function(e){function s(e){if(e._dmDisposeExtended)return;var t=e.dispose;e.dispose=function(){e._dmDisposeAll(),t&&t.call(e)},e._dmDisposeExtended=!0}var t=e("services/pubSub/pubSub"),n=e("browser/window"),r=e("constants/common").disposableGroups,i=e("vendor/knockout");return{_dmDisposeExtended:!1,_disposableItems:null,registerPubSubEvent:function(e,n){t.subscribe(e,n),this._dmRegisterDisposableItem(r.PUB_SUB,{eventName:e,callback:n})},unregisterPubSubEvent:function(e,n){t.unsubscribe(e,n),this._dmUnRegisterDisposableItem(r.PUB_SUB,function(t){return t.eventName===e&&t.callback===n})},registerComputed:function(e){var t=i.computed(e);return this.registerDisposable(t),t},observable:function(){return i.observable.apply(i,arguments)},observableArray:function(){return i.observableArray.apply(i,arguments)},registerDisposable:function(e){if(!e.dispose)throw new TypeError("Item does not implement Disposable");this._dmRegisterDisposableItem(r.GENERIC_DISPOSABLE,e)},unregisterDisposable:function(e){e.dispose(),this._dmUnRegisterDisposableItem(r.GENERIC_DISPOSABLE,function(t){return t===e})},registerInterval:function(e,t){var i=n.setInterval(e,t);return this._dmRegisterDisposableItem(r.INTERVAL,i),i},unregisterInterval:function(e){n.clearInterval(e),this._dmUnRegisterDisposableItem(r.INTERVAL,function(t){return t===e})},registerDOMEvent:function(e,t,n,i){e.addEventListener(t,n,i),this._dmRegisterDisposableItem(r.DOM_EVENT,{object:e,event:t,handler:n,useCapture:i})},unregisterDOMEvent:function(e,t,n,i){e.removeEventListener(t,n,i),this._dmUnRegisterDisposableItem(r.DOM_EVENT,function(r){return r.object===e&&r.event===t&&r.handler===n&&r.useCapture===i})},registerTimeout:function(e,t){var i=n.setTimeout(e,t);return this._dmRegisterDisposableItem(r.TIMEOUT,i),i},unregisterTimeout:function(e){n.clearTimeout(e),this._dmUnRegisterDisposableItem(r.TIMEOUT,function(t){return t===e})},_dmDisposeAll:function(){function i(e,i){switch(e){case r.PUB_SUB:i.forEach(function(e){t.unsubscribe(e.eventName,e.callback)});break;case r.GENERIC_DISPOSABLE:i.forEach(function(e){e.dispose()});break;case r.INTERVAL:i.forEach(n.clearInterval);break;case r.TIMEOUT:i.forEach(n.clearTimeout);break;case r.DOM_EVENT:i.forEach(function(e){e.object.removeEventListener(e.event,e.handler,e.useCapture)})}}if(!this._disposableItems)return;for(var e in this._disposableItems)this._disposableItems.hasOwnProperty(e)&&i(e,this._disposableItems[e]||[]);this._disposableItems=null},_dmRegisterDisposableItem:function(e,t){s(this),this._disposableItems=this._disposableItems||{},this._disposableItems[e]=this._disposableItems[e]||[],this._disposableItems[e].push(t)},_dmUnRegisterDisposableItem:function(e,t){this._disposableItems=this._disposableItems||{};var n=this._disposableItems[e]||[];for(var r=0;r<n.length;r++)if(t(n[r])){n.splice(r,1);break}}}}),define("services/cqf/CQFHandler",["require","exports","module","lodash-compat","constants/common","ui/modelHelpers/conversationHelper","services/cqf/trigger","utils/common/disposableMixin","swx-enums","services/serviceLocator","browser/window"],function(e,t){function b(){var e=a.resolve(r.serviceLocator.FEATURE_FLAGS),t=e.isFeatureOn(r.featureFlags.CQF_ENABLED);return t}function w(){h=!0,l._dmDisposeAll()}function E(e){if(e.video.channels(0)){var t=e.video.channels(0).stream.state.once(u.mediaStreamState.Started,w);l.registerDisposable(t)}}var n=e("lodash-compat"),r=e("constants/common"),i=e("ui/modelHelpers/conversationHelper"),s=e("services/cqf/trigger"),o=e("utils/common/disposableMixin"),u=e("swx-enums"),a=e("services/serviceLocator"),f=e("browser/window"),l={},c,h=!1,p,d,v,m,g,y;t.observe=function(e){if(!b())return;h=!1;var t=e.participants.added(E);l.registerDisposable(t);if(e.selfParticipant.video.channels(0)){var n=e.selfParticipant.video.channels(0).stream.state.once(u.mediaStreamState.Started,w);l.registerDisposable(n)}},t.updateCallData=function(e){if(!b())return;c=e.audioService.callId(),m=e._callData.nodeId(),g=e._callData.ngcEndpointId(),y=e._callData.ngcParticipantId(),p=e.audioService.callConnected()?f.Date.now()-e.audioService.callConnected():0,d=e.isGroupConversation(),v=i.isConversationWithPstn(e),l._dmDisposeAll()},t.setupCQF=function(){if(!b())return Promise.reject();var e=new Promise(function(e,t){var n={duration:p,callId:c,hasPSTN:v,isGroupConversation:d};s.validateCall(n).then(function(){e({isVideo:h,isPSTN:v,callId:c,nodeId:m,ngcEndpointId:g,ngcParticipantId:y})}).catch(t)});return e},n.extend(l,o)}),define("ui/calling/pstnEventsHandler",["require","exports","module","swx-enums","lodash-compat"],function(e,t){function i(e){function o(e){e===n.callConnectionState.Disconnected?(s&&s.dispose(),t.participants().forEach(f)):e===n.callConnectionState.Connecting&&(s=t.participants.observe(u),t.participants().forEach(a))}function u(e,t){r.forIn(e,function(e){a(e)}),r.forIn(t,function(e){f(e)})}function a(n){function s(r){var i=n.audio.state.reason;e.process(t,n,i,r)}if(!l(n.audio.endpoint()))return;var r=n.person.id();if(r in i)return;i[r]=s,n.audio.state.changed(s)}function f(e){var t,n;n=e.person.id(),n in i&&(t=i[n],e.audio.state.changed.off(t),delete i[n])}function l(e){return/^(\+)?\d+$/.test(e)}var t,i={},s;this.subscribeToConversation=function(e){t=e,t.selfParticipant.audio.state.changed(o)},this.dispose=function(){s&&s.dispose(),t.participants().forEach(f),i=null,t.selfParticipant.audio.state.changed.off(o)}}var n=e("swx-enums"),r=e("lodash-compat");t.build=function(e){return new i(e)}}),define("ui/calling/invalidNumberRedirector",["require","exports","module","swx-enums","constants/common","constants/components","services/serviceLocator","browser/window"],function(e,t){function u(){function a(){t&&(o.clearTimeout(t),t=null,u.unsubscribe(r.events.navigation.NAVIGATE,a))}var e=5e3,t,u=s.resolve(r.serviceLocator.PUBSUB);this.process=function(s,f,l,c){if(c!==n.callConnectionState.Disconnected||l!==n.callDisconnectionReason.InvalidNumber)return;if(s.participants.size()>1)return;t||(u.subscribe(r.events.navigation.NAVIGATE,a),t=o.setTimeout(function(){u.publish(r.events.navigation.NAVIGATE,{page:i.calling.SKYPEOUT_PAGE,origin:r.telemetry.historyLoadOrigin.SKYPEOUT_PAGE})},e))},this.dispose=function(){a()}}var n=e("swx-enums"),r=e("constants/common"),i=e("constants/components"),s=e("services/serviceLocator"),o=e("browser/window");t.build=function(){return new u}}),define("ui/viewModels/chat/conversation",["require","lodash-compat","swx-enums","utils/common/eventMixin","constants/calling","utils/common/elementQueryHelper","vendor/knockout","telemetry/chat/conversationUpdateFlow","ui/modelHelpers/conversationHelper","cafe/applicationInstance","constants/common","constants/components","browser/detect","services/serviceLocator","services/cqf/CQFHandler","ui/calling/pstnEventsHandler","ui/calling/invalidNumberRedirector","telemetry/chat/conversationJoined"],function(e){function y(e){function O(){d.setupCQF().then(function(e){t.callData=e,t.isCQFVisible(!0),t.isInCall(!1)}).catch(function(){t.isInCall(!1),_()})}function M(){t.isCQFVisible(!1),_()}function _(){window.shellApp&&t.isConversationVisible()&&!t.isInCall()&&e.selfParticipant.audio.state.reason!==n.callDisconnectionReason.CallEscalated&&(window.shellAppInfo.supportsPreloading?window.shellApp.invoke(i.SHELL_APP_METHODS.HIDE_WINDOW):window.shellApp.invoke(i.SHELL_APP_METHODS.CLOSE_WINDOW))}function D(n){t.isInCall()&&s.refresh(),t.isConversationVisible(!0),t.isInCall(a.isCallingActive(e)),t.isFullyOverlayed(t.showStartConversationOverlay()),S=e.acknowledge.enabled.when(!0,e.acknowledge),T=t.isInCall.subscribe(function(e){e&&(t.dispatchEvent(i.EVENTS.CQF_CANCEL,t.DIRECTION.CHILD),t.isCQFVisible(!1))}),n&&n.model===t.conversationModel&&n.target&&n.target.expandProfile&&(t.dispatchEvent(l.events.conversation.OPEN_PROFILE,n.telemetryContext,t.DIRECTION.CHILD),L=!0,A=n.telemetryContext)}function P(){t.isConversationVisible(!1),t.conversationUpdateFlow.abandoned(),C&&t.conversationModel.historyService._messagesWithUnseenHearts.size()>0&&t.conversationModel.historyService._messagesWithUnseenHearts.empty()}function H(e){e===c.chat.HEADER&&L&&t.dispatchEvent(l.events.conversation.OPEN_PROFILE,A,t.DIRECTION.CHILD)}function B(){t.forwardEvent(l.events.navigation.FRAGMENT_SHOW,t.DIRECTION.CHILD,D),t.forwardEvent(l.events.navigation.FRAGMENT_BEFORE_HIDE,t.DIRECTION.CHILD,P),t.forwardEvent(l.events.navigation.FRAGMENT_HIDE,t.DIRECTION.CHILD),t.forwardEvent(l.events.message.QUOTE,t.DIRECTION.CHILD),t.forwardEvent(l.events.message.EDIT,t.DIRECTION.CHILD),t.forwardEvent(i.EVENTS.CALL_SCREEN_CLOSE,t.DIRECTION.CHILD,O),t.forwardEvent(l.events.conversation.OPEN_PROFILE,t.DIRECTION.CHILD),t.forwardEvent(l.events.conversation.VIEWPORT_CHANGED,t.DIRECTION.CHILD),t.forwardEvent(l.events.conversation.MESSAGES_LOADED,t.DIRECTION.CHILD),t.registerEvent(l.events.roster.EDIT_ROSTER_MODE,I),t.registerEvent(l.events.conversation.OVERLAY_CLOSED,q),t.registerEvent(l.events.navigation.COMPONENT_RENDERED,H),t.registerEvent(i.EVENTS.CQF_SCREEN_CLOSE,M),r.subscribe(l.events.shareControl.SHARE_CONTROL_SHOW,R),r.subscribe(l.events.shareControl.SHARE_CONTROL_HIDE,U),f.get().conversationsManager.conversations.removed(j)}function j(t){if(t===e){var n={model:t,page:"swx-conversation"};r.publish(l.events.navigation.FRAGMENT_REMOVE,n)}}function F(){E=t.conversationModel.participants.subscribe()}function I(e){t.isEditRosterMode(e.isActive),t.isEditing(e.isEditMode)}function q(){t.isFullyOverlayed(!1)}function R(e){t.shareControlPayload(e),t.isSelectingContacts(!0)}function U(){t.isSelectingContacts(!1)}var t=this,r=p.resolve(l.serviceLocator.PUBSUB),y=p.resolve(l.serviceLocator.FEATURE_FLAGS),b=y.isFeatureOn(l.featureFlags.PSTN_ENABLED),w,E,S,x,T,N,C,k,L,A;t.init=function(){function n(e){return e.preventDefault(),e.stopPropagation(),h.getBrowserInfo().isIeEngine&&(e.returnValue=!1),!1}function r(e,t){var n=e.dataTransfer||e.originalEvent.dataTransfer;return Array.prototype.some.call(n.types,function(e){return e===t})}function i(e){return w&&r(e,"Files")&&t.conversationModel.fileTransferService.send.enabled()}function s(e,t){var r=e.dataTransfer||e.originalEvent.dataTransfer;return r&&(r.dropEffect=t?"copy":"none"),n(e)}w=y.isFeatureOn(l.featureFlags.FILE_DRAG_DROP_ENABLED),C=y.isFeatureOn(l.featureFlags.HEARTS_ENABLED),t.hideConversationHeader=y.isFeatureOn(l.featureFlags.HIDE_CONVERSATION_HEADER),t.isSingleConversationMode=y.isFeatureOn(l.featureFlags.SINGLE_CONVERSATION_MODE),t.conversationModel=e,t.isEditRosterMode=o.observable(!1),t.isEditing=o.observable(!1),t.isFullyOverlayed=o.observable(!1),t.isSelectingContacts=o.observable(!1),t.showCover=o.pureComputed(function(){return!e.selfParticipant.isAnonymous()&&t.isEditRosterMode()||t.isSelectingContacts()}),t.isInCall=o.observable(!1),t.isCQFVisible=o.observable(!1),t.isConversationVisible=o.observable(!0),t.conversationUpdateFlow=new u,t.newConversationV2=o.observable(y.isFeatureOn(l.featureFlags.NEW_CONVERSATION_V2)),t.shareControlPayload=o.observable({}),t.isPollsFeatureEnabled=o.observable(!1),b&&!h.getBrowserInfo().isShellApp&&(k=m.build(),N=v.build(k),N.subscribeToConversation(e)),t.onDragEnter=function(e,t){var n=i(t);return n,s(t,n)},t.onDragOver=function(e,t){return s(t,i(t))},t.onDragLeave=function(){},t.onDrop=function(e,r){var s=[];if(i(r))return Array.prototype.forEach.call(r.dataTransfer.files,function(e){s.push(e)}),s.length&&t.conversationModel.fileTransferService.send(s),n(r)},t.markAsRead=function(){return t.dispatchEvent(l.events.conversation.MARK_AS_READ),!0},t.conversationModel.sendPollMessage&&(x=t.conversationModel.sendPollMessage.enabled.changed(function(e){t.isPollsFeatureEnabled(e)})),F(),B(),g.get().onConversationJoined()},t.dispose=function(){E.dispose(),S&&S.dispose(),f.get().conversationsManager.conversations.removed.off(j),t.conversationUpdateFlow=null,x&&x.dispose(),N&&(N.dispose(),k.dispose()),T&&T.dispose(),r.unsubscribe(l.events.shareControl.SHARE_CONTROL_SHOW,R),r.unsubscribe(l.events.shareControl.SHARE_CONTROL_HIDE,U)},t.coverHeader=o.pureComputed(function(){return!e.selfParticipant.isAnonymous()&&t.isFullyOverlayed()}),t.coverChatLogAndInput=o.pureComputed(function(){return!e.selfParticipant.isAnonymous()&&(t.isFullyOverlayed()||t.isEditRosterMode())}),t.showStartConversationOverlay=o.pureComputed(function(){var e=y.isFeatureOn(l.featureFlags.INVITE_FREE);return e&&!t.conversationModel.isGroupConversation()&&t.conversationModel.historyService.activityItems().length===0})}var t=e("lodash-compat"),n=e("swx-enums"),r=e("utils/common/eventMixin"),i=e("constants/calling"),s=e("utils/common/elementQueryHelper"),o=e("vendor/knockout"),u=e("telemetry/chat/conversationUpdateFlow"),a=e("ui/modelHelpers/conversationHelper"),f=e("cafe/applicationInstance"),l=e("constants/common"),c=e("constants/components"),h=e("browser/detect"),p=e("services/serviceLocator"),d=e("services/cqf/CQFHandler"),v=e("ui/calling/pstnEventsHandler"),m=e("ui/calling/invalidNumberRedirector"),g=e("telemetry/chat/conversationJoined");return t.assign(y.prototype,r),t.assign(y.prototype,{isInShellApp:function(){return h.getBrowserInfo().isShellApp}}),y}),define("text!views/chat/conversation.html",[],function(){return'<div class="conversationControl chat themeLight allowTextSelection"\r\n     data-bind="click: markAsRead,\r\n      css: { editRosterMode: isEditRosterMode, group: conversationModel.isGroupConversation(), isInCall: isInCall() || isCQFVisible() },\r\n      event: {dragenter: onDragEnter, dragover: onDragOver, dragleave: onDragLeave, drop: onDrop }">\r\n\r\n    <!-- ko ifnot: isInShellApp() -->\r\n        <!-- ko ifnot: hideConversationHeader || isSingleConversationMode -->\r\n        <swx-header class="conversationHeader" params="conversationModel: conversationModel, conversationUpdateFlow: conversationUpdateFlow" data-bind="css: { active: isEditRosterMode, newConversationV2: newConversationV2, editMode: isEditing, showCover: coverHeader}"></swx-header>\r\n        <!-- /ko -->\r\n        <!-- ko if: isSingleConversationMode -->\r\n        <swx-header-single-conversation class="conversationHeader overrideMinHeight" params="conversationModel: conversationModel"></swx-header-single-conversation>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: isSelectingContacts -->\r\n        <swx-share-control params="payload:shareControlPayload"></swx-share-control>\r\n        <!-- /ko -->\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: isInCall -->\r\n    <swx-call-screen class="callScreen" params="conversation: conversationModel"></swx-call-screen>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: isCQFVisible -->\r\n    <swx-cqf class="cqfScreen" params="callData: callData" data-bind="css: {fullScreen: isInShellApp()}"></swx-cqf>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko ifnot: isInShellApp() -->\r\n        <!-- ko if: isPollsFeatureEnabled -->\r\n        <swx-sticky-message params="conversationModel: conversationModel"></swx-sticky-message>\r\n        <!-- /ko -->\r\n        <swx-chat-log class="conversationHistory" data-bind="css: { showCover: coverChatLogAndInput }" params="conversationModel: conversationModel"></swx-chat-log>\r\n        <swx-chat-input class="input" data-bind="css: { showCover: coverChatLogAndInput, hide: isEditing }" params="conversationModel: conversationModel"></swx-chat-input>\r\n    <!-- /ko -->\r\n</div>\r\n<!-- ko if: showStartConversationOverlay -->\r\n<swx-start-conversation-overlay class="StartConversationOverlay" data-bind="css: { hide: !isFullyOverlayed() }" params="conversationModel: conversationModel"></swx-start-conversation-overlay>\r\n<!-- /ko -->\r\n'}),define("ui/components/chat/conversation",["require","exports","module","vendor/knockout","constants/common","ui/viewModels/chat/conversation","constants/components","text!views/chat/conversation.html"],function(e,t){function s(e,t){var s=t.element,o=e.model,u=n.dataFor(s),a;if(!o)return;return a=new i(o),a.setContext(u),a.init(),a.dispatchEvent(r.navigation.COMPONENT_RENDERED),a}var n=e("vendor/knockout"),r=e("constants/common").events,i=e("ui/viewModels/chat/conversation");t.name=e("constants/components").chat.CONVERSATION,t.template=e("text!views/chat/conversation.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/chat/groupSearch",["require","vendor/knockout","utils/common/ko","utils/common/array","cafe/applicationInstance","services/pubSub/pubSub","constants/common","ui/telemetry/telemetryClient","experience/settings","constants/common"],function(e){var t=e("vendor/knockout"),n=e("utils/common/ko"),r=e("utils/common/array"),i=e("cafe/applicationInstance"),s=e("services/pubSub/pubSub"),o=e("constants/common"),u=e("ui/telemetry/telemetryClient"),a=e("experience/settings"),f=e("constants/common").events.search;return function(l,c){function y(e){if(g!==e)return;g=null,p(d.results().map(function(e){return e.result}))}function b(e){var t,n;if(!e){p([]);return}if(g)try{g.cancel("Another search triggered")}catch(r){u.get().sendEvent(a.telemetry.uiTenantToken,o.telemetry.promiseInvalidStateException.TYPE,{feature:o.telemetry.promiseInvalidStateException.feature.GROUP_SEARCH,exception:JSON.stringify(r)})}t=e.replace(/[^\w\s]/g,"").trim().toLowerCase(),d=i.get().conversationsManager.createSearchQuery(),w("group",!0),w("topic",t),n=d.getMore(),g=n,n.then(y.bind(null,n))}function w(e,t){if(d.supportedKeywords().indexOf(e)<0)return;d.keywords[e]=t}function E(e){function i(e,n){var i=new l(c);i.init(n),i.groupSearchResults=m,r.insertAt(t,e,i)}var t=h.searchResults();n.handleArrayChanges(t,e,i),h.searchResults.valueHasMutated()}var h=this,p=t.observableArray(),d,v,m,g;p.subscribe(function(e){m=e.length,s.publish(f.GROUPS_SEARCH_RESULTS,m)}),this.searchResults=t.observableArray(),this.init=function(){s.subscribe(f.QUERY_CHANGED,b),v=p.subscribe(E,null,"arrayChange")},this.dispose=function(){s.unsubscribe(f.QUERY_CHANGED,b),v&&v.dispose()}}}),define("services/telemetry/logging/perf/usertimingTracer",["require","usertiming"],function(e){function n(e){if(typeof t.getEntriesByName!="function")return!1;var n=t.getEntriesByName(e);return n!==undefined&&n.length>0}var t=e("usertiming");return function(r){this.logger=r,this.startTrace=function(e){if(n(e))return;typeof t.mark=="function"&&t.mark(e)},this.stopTrace=function(e){if(!n(e))return;typeof t.measure=="function"&&(t.measure(e+"_measure",e),t.clearMarks(e))},this.dumpMeasurements=function(){if(typeof t.getEntriesByType!="function")return{};var e=t.getEntriesByType("measure")||{};return e.length===0?e:(this.logger.perf(e),typeof t.clearMeasures=="function"&&t.clearMeasures(),e)}}}),define("services/telemetry/logging/perf/dummyTracer",[],function(){return function(){this.startTrace=function(){},this.stopTrace=function(){},this.dumpMeasurements=function(){}}}),define("services/telemetry/logging/perf/environments",["require","services/telemetry/logging/perf/usertimingTracer","services/telemetry/logging/perf/dummyTracer"],function(e){var t=e("services/telemetry/logging/perf/usertimingTracer"),n=e("services/telemetry/logging/perf/dummyTracer"),r={live:t,mock:t,dev:t};return{fetch:function(e){return r[e]||n}}}),define("services/telemetry/logging/perf/main",["require","services/telemetry/logging/perf/environments"],function(e){function r(e){var n=e?e.environment:"default";return t.fetch(n)}var t=e("services/telemetry/logging/perf/environments"),n;return{getInstance:function(){return n||this.construct(),n},construct:function(e,t){var i=r(e);n=new i(t)},destroy:function(){n=undefined}}}),define("ui/viewModels/chat/conversationTile",["require","vendor/knockout","ui/viewModels/people/contactBuilder","utils/chat/messageSanitizer","utils/common/cafeObservable","constants/common","swx-enums","swx-i18n","services/serviceLocator"],function(e){function f(e,f){function h(){var e=l.contact();return e?e.displayMessage():p(l.amInConversation(),l.participantCount())}function p(e,t){return e?(m()&&t++,u.fetch({key:"label_text_participant",count:t})):""}function d(){c&&(c.dispose(),c=null)}function v(){function t(e){setTimeout(d);var t=n.build(e.person,f.contactOptions);l.contact(t)}c=e.participants.added(t)}function m(){var e=a.resolve(s.serviceLocator.FEATURE_FLAGS);return e.isFeatureOn(s.featureFlags.INCLUDE_SELF_IN_PARTICIPANTS_COUNT)}var l=this,c;l.isGroup=i.newObservableProperty(e.isGroupConversation),l.participantCount=i.newObservableProperty(e.participantsCount),l.selfParticipantState=i.newObservableProperty(e.selfParticipant.state),l.amInConversation=t.computed(function(){return l.selfParticipantState()===o.participantState.Connected}),l.contact=t.observable(),l.isAgent=t.computed(function(){var e=l.contact();return!!e&&e.isAgent()}),l.isCertifiedAgent=t.computed(function(){var e=l.contact();return!!(l.isAgent()&&e.agentDetails()&&e.agentDetails().certification())}),l.isPstn=t.computed(function(){var e=l.contact();return!!e&&e.isPstn()}),l.id=t.computed(function(){var e=l.contact();return e?e.id():undefined}),l.statusClassName=t.computed(function(){var e=l.contact();return e?e.statusClassName():""}),l.isBlocked=t.computed(function(){var e=l.contact();return e?e.isBlocked():!1}),l.displayMessage=t.computed(h),l.displayMessageTitle=t.computed(function(){return r.stripHTML(h())}),l.dispose=function(){l.isAgent.dispose(),l.isCertifiedAgent.dispose(),l.isPstn.dispose(),l.id.dispose(),l.statusClassName.dispose(),l.isBlocked.dispose(),l.displayMessage.dispose(),l.displayMessageTitle.dispose(),l.amInConversation.dispose(),l.contact()&&l.contact().dispose(),d()},l.isGroup()||v()}var t=e("vendor/knockout"),n=e("ui/viewModels/people/contactBuilder"),r=e("utils/chat/messageSanitizer"),i=e("utils/common/cafeObservable"),s=e("constants/common"),o=e("swx-enums"),u=e("swx-i18n").localization,a=e("services/serviceLocator");return{build:function(e,t){return t=t||{},new f(e,t)}}}),define("ui/viewModels/chat/recent",["require","lodash-compat","vendor/knockout","swx-i18n","constants/common","swx-enums","services/pubSub/pubSub","services/serviceLocator","services/telemetry/common/telemetryContext","services/telemetry/logging/perf/main","utils/common/cafeObservable","utils/common/ko","ui/contextMenu/contextMenu","ui/contextMenu/items/all","ui/contextMenu/menuItemHelper","ui/telemetry/actions/actionSources","ui/viewModels/calling/helpers/textFormatter","ui/viewModels/chat/conversationActivity","ui/viewModels/chat/conversationTile","ui/viewModels/chat/conversationTopic"],function(e){var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-i18n").localization,i=e("constants/common"),s=e("swx-enums"),o=e("services/pubSub/pubSub"),u=e("services/serviceLocator"),a=e("services/telemetry/common/telemetryContext"),f=e("services/telemetry/logging/perf/main"),l=e("utils/common/cafeObservable"),c=e("utils/common/ko"),h=e("ui/contextMenu/contextMenu"),p=e("ui/contextMenu/items/all"),d=e("ui/contextMenu/menuItemHelper"),v=e("ui/telemetry/actions/actionSources"),m=e("ui/viewModels/calling/helpers/textFormatter"),g=e("ui/viewModels/chat/conversationActivity"),y=e("ui/viewModels/chat/conversationTile"),b=e("ui/viewModels/chat/conversationTopic"),w=i.events.navigation;return function(E){function I(){S.hasUnseenHearts(N.historyService._messagesWithUnseenHearts.size()>0)}function q(e,t){var n=!e;if(e&&t)return"accessibility_recentItem_group_unread";if(e)return"accessibility_recentItem_group";if(n&&t)return"accessibility_recentItem_oneToOne_unread";if(n)return"accessibility_recentItem_oneToOne"}function R(e){var t=50,n=e();return n>=t?t+"+":n===0?"":n}function U(){var e=L();return e?e.direction===s.direction.Outgoing:!1}function z(){return A.currentPlaceModel()===N}function W(){return S.unreadCount()===0&&(!S.unreadWithKeywordsCount||S.unreadWithKeywordsCount()===0)}function X(){var e=L();if(!e)return;return e.model.type()===s.activityType.ContactRequestIsNowContact?r.fetch({key:"message_text_isNowAContact",params:{id:e.model.sender.id()}}):e.content()}function V(){var e=C(),n=e[e.length-1],r;if(!n||t.isEmpty(n))return null;if(x&&n.key()===x.clientmessageid)return x;r=new E({noUrlPreview:!0,noTranslationItem:!0}),r.init(n,N),S.isLiveSession(r.group()===i.activityItemGroups.CALL),S.isInfoMessage(r.group()===i.activityItemGroups.CONTACT_REQUEST);if(S.isLiveSession.peek())S.callAction(r.callAction||""),k("live-session");else if(S.isInfoMessage.peek()){var s=r.model.type(),o=$(s);S.infoType(o),k("info")}else k("message");return x&&x.dispose(),x=r,r}function $(e){return e===s.activityType.ContactRequestIncoming?"contactAdd":e===s.activityType.ContactRequestIsNowContact?"contact":""}function J(){var e,t=S.isRead();return e={message:t,"live-session":!1,"file-transfer":!1,info:!1,unknown:!1,contact:!1,media:!1},t||(e[k()]=!0),e.read=t,e.unread=!t,e.lightNotification=!S.notificationEnabled()&&(!S.unreadWithKeywordsCount||S.unreadWithKeywordsCount()===0),e.hide=S.isOnCall()||S.isBlocked()||S.canJoinCall(),e.active=S.isActive(),e.group=S.isGroupConversation(),e.unseenHeart=S.displayUnseenHeartsIcon(),e}function K(){var e=O.callDuration();return e<0?"":m.getFormattedDuration(e)}var S=this,x,T,N,C,k,L,A,O,M,D=300,P=u.resolve(i.serviceLocator.FEATURE_FLAGS),H,B,j,F;S.init=function(t){N=t,O=g.build(t),M=b.build(t),k=n.observable("message"),T=y.build(N),A=u.resolve(i.serviceLocator.NAVIGATION_CONTEXT),H=P.isFeatureOn(i.featureFlags.HEARTS_ENABLED),B=P.isFeatureOn(i.featureFlags.HEARTS_NOTIFICATION_ENABLED),j=P.isFeatureOn(i.featureFlags.FAVORITES_CONVERSATION_ENABLED),S.displayMessage=T.displayMessage,S.isBlocked=T.isBlocked,S.topic=M.topic,S.unreadCount=l.newObservableProperty(N.historyService.unreadActivityItemsCount),C=l.newObservableCollection(N.historyService.activityItems),S.isLiveSession=n.observable(!1),S.callAction=n.observable(""),S.isOnCall=O.isOnCall,S.canJoinCall=O.canJoinCall,S.isFavorited=N._isFavorited?l.newObservableProperty(N._isFavorited):n.observable(!1),S.isInfoMessage=n.observable(!1),S.infoType=n.observable(""),S.isGroupConversation=l.newObservableProperty(N.isGroupConversation),S.avatarUrl=l.newObservableProperty(N.avatarUrl,{keepAlive:!0}),S.timestamp=l.newObservableProperty(N.lastModificationTimestamp),S.statusClassName=T.statusClassName,S.groupSearchResults=0,S.conversation=N,S.isAgent=T.isAgent,S.isCertifiedAgent=T.isCertifiedAgent,S.isPstn=T.isPstn,S.unreadActivityItemsCount=n.computed(R.bind(null,S.unreadCount)),N.historyService._unreadActivityItemsWithKeywordsCount?(S.unreadWithKeywordsCount=l.newObservableProperty(N.historyService._unreadActivityItemsWithKeywordsCount),S.unreadActivityItemsWithKeywordsCount=n.computed(R.bind(null,S.unreadWithKeywordsCount))):S.unreadActivityItemsWithKeywordsCount=n.observable(!1),S.notificationEnabled=n.observable(!0),L=n.computed(V),S.lastMessageIsOutgoing=n.computed(U),S.content=n.computed(X),S.isActive=n.computed(z),S.isRead=n.computed(W).extend({rateLimit:D}),S.hasUnseenHearts=n.observable(!1),S.displayUnseenHeartsIcon=n.computed(function(){return B&&S.hasUnseenHearts()&&!S.isActive()}),H&&B&&N.historyService._messagesWithUnseenHearts.changed(I),S.cssClass=n.computed(J),S.callDuration=n.computed(K),N._notificationsEnabled&&(F=N._notificationsEnabled.changed(function(e){S.notificationEnabled(e)}))},S.dispose=function(){S.unreadActivityItemsCount.dispose(),L.dispose(),S.lastMessageIsOutgoing.dispose(),S.content.dispose(),S.isActive.dispose(),S.isRead.dispose(),S.cssClass.dispose(),M.dispose(),T.dispose(),x&&(x.dispose(),x=null),O.dispose(),H&&B&&N.historyService._messagesWithUnseenHearts.changed.off(I),S.displayUnseenHeartsIcon.dispose(),F&&F.dispose(),S.unreadActivityItemsWithKeywordsCount&&S.unreadActivityItemsWithKeywordsCount.dispose&&S.unreadActivityItemsWithKeywordsCount.dispose()},S.showContextMenu=function(e,n){function u(){if(!j)return;S.isFavorited()?s.push(new p.RemoveFromFavoritesMenuItem(N,v.recentItem)):s.push(new p.AddToFavoritesMenuItem(N,v.recentItem))}function a(e){var t={source:v.contextMenuItem.block,parent:v.recentItem},i={source:v.contextMenuItem.deleteItem,parent:v.recentItem};s.push(d.getConversationContextMenuItemGroup(e,r,o)),s.push(new p.BlockContactMenuItem(e,t)),s.push(new p.DeleteContactMenuItem(e,r,i)),d.sortMenuItems(s),h.show(s,n,o)}var r=i.telemetry.historyLoadOrigin.TIMELINE_CLICK,s=[new p.LeaveConversationMenuItem(N),new p.RemoveConversationMenuItem(N)],o={source:v.recentItem,isGroupConversation:!1};u(),S.isGroupConversation()?(o.isGroupConversation=!0,h.show(s,n,o)):c.once(T.contact,t.isObject,a)},S.handleClick=function(t,n){var r=i.telemetry.historyLoadOrigin.TIMELINE_CLICK;f.getInstance().startTrace("navigateConversation"),n.preventDefault();if(!t.model.isActive()){var s=a.get();s.timelineInSearchMode&&(r=i.telemetry.historyLoadOrigin.GROUP_SEARCH)}o.publish(w.OPEN_CONVERSATION,{model:N,origin:r})},S.ariaLabel=n.pureComputed(function(){var e,t;return e=S.unreadCount()>0,t=q(S.isGroupConversation(),e),r.fetch({key:t,count:S.unreadCount(),params:{topic:S.topic()}})}),S.getSearchItemDetails=function(e){var t="";return S.isGroupConversation()?(S.displayMessage()?t=r.fetch({key:"accessibility_searchItem_group_displayMessage",params:{groupName:S.topic(),displayMessage:S.displayMessage(),index:e+1,totalResults:S.groupSearchResults}}):t=r.fetch({key:"accessibility_searchItem_group",params:{groupName:S.topic(),index:e+1,totalResults:S.groupSearchResults}}),t):t}}}),define("text!views/chat/groupSearch.html",[],function(){return'<!-- ko if: searchResults().length > 0 -->\r\n<ul class="groups" data-bind="foreach: { data: searchResults }, keyboardNavigation: { itemSelector: \'a.group\', persistSelection: false }">\r\n    <!-- ko if: $index() === 0 -->\r\n    <li class="separator">\r\n        <p class="strong" data-bind="l10n: {key: \'message_text_groupSearchResultsTitle\'}"></p>\r\n    </li>\r\n    <!-- /ko -->\r\n\r\n    <swx-recent-item params="model: $data, dispose: $data.dispose" class="list-selectable" data-bind="attr: { \'data-title\': $data.getSearchItemDetails($index()) }"></swx-recent-item>\r\n</ul>\r\n<!-- /ko -->\r\n'}),define("ui/components/chat/groupSearch",["require","exports","module","ui/viewModels/chat/groupSearch","ui/viewModels/chat/message","ui/viewModels/chat/recent","constants/components","text!views/chat/groupSearch.html"],function(e,t){function s(){var e=new n(i,r);return e.init(),e}var n=e("ui/viewModels/chat/groupSearch"),r=e("ui/viewModels/chat/message"),i=e("ui/viewModels/chat/recent");t.name=e("constants/components").chat.GROUP_SEARCH,t.template=e("text!views/chat/groupSearch.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/chat/messagesSearch",["require","vendor/knockout","swx-i18n","services/pubSub/pubSub","constants/common","services/serviceLocator","cafe/applicationInstance","constants/common"],function(e){var t=e("vendor/knockout"),n=e("swx-i18n").localization,r=e("services/pubSub/pubSub"),i=e("constants/common"),s=e("services/serviceLocator"),o=e("cafe/applicationInstance"),u=e("constants/common").events.search;return function(a){function m(e){var t;if(!v)return;y(),f.hasAdditionalResults(!1);if(!e||e.length<h)return;t=e.replace(/[^\w\s]/g,"").trim().toLowerCase(),l=t,o.get()._messagesSearchService.query(t,20).then(function(n){if(l!==t)return;y(),f.hasAdditionalResults(!1);var r=0;n.forEach(function(e){var t,n=g(e);if(!n)return;t=new a,t.init(e,n),r++<c?f.searchResults.push(t):(p.push(t),f.hasAdditionalResults(!0))})})}function g(e){return o.get().conversationsManager._getConversation(e.ConversationId)}function y(){p.forEach(function(e){e.dispose()}),p=[],f.searchResults().forEach(function(e){e.dispose()}),f.searchResults.removeAll()}var f=this,l,c=5,h=4,p=[],d=s.resolve(i.serviceLocator.FEATURE_FLAGS),v=d.isFeatureOn(i.featureFlags.CONTENT_SEARCH);this.searchResults=t.observableArray(),this.title=n.fetch({key:"content_search_header"}),this.displayAdditionResults=function(){p.forEach(function(e){f.searchResults.push(e)}),p=[],f.hasAdditionalResults(!1)},this.hasAdditionalResults=t.observable(!1),this.additionalResultsTitle=n.fetch({key:"content_search_additional_results"}),this.init=function(){if(!v)return;r.subscribe(u.QUERY_CHANGED,m)},this.dispose=function(){r.unsubscribe(u.QUERY_CHANGED,m),y()}}}),define("ui/viewModels/chat/messageSearchItem",["require","lodash-compat","vendor/knockout","swx-i18n","constants/common","utils/chat/messageSanitizer","utils/chat/dateTime","cafe/applicationInstance","services/pubSub/pubSub","services/telemetry/logging/perf/main","ui/viewModels/chat/conversationTile","ui/modelHelpers/personHelper","swx-enums"],function(e){var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-i18n").localization,i=e("constants/common"),s=e("utils/chat/messageSanitizer"),o=e("utils/chat/dateTime"),u=e("cafe/applicationInstance"),a=e("services/pubSub/pubSub"),f=e("services/telemetry/logging/perf/main"),l=e("ui/viewModels/chat/conversationTile"),c=e("ui/modelHelpers/personHelper"),h=e("swx-enums"),p=i.events.navigation;return function(){function g(e){function s(){return u.get().personsAndGroupsManager.mePerson.id()===i?(n=u.get().personsAndGroupsManager.mePerson,d.avatarUrl(n.avatarUrl()),d.userName(n.displayName()),!0):!1}function o(){var e=m.participants(),r=t.findIndex(e,function(e){return e.person.id()===i});return r!==-1?(n=e[r].person,d.avatarUrl(n.avatarUrl()),d.userName(n.displayName()),!0):!1}var n,r,i=c.getId(e.From);if(s()||o())return;r=u.get().personsAndGroupsManager.createPersonSearchQuery(),r.sources(h.searchScope.All),r.text("id:"+i),r.getMore().then(function(){var e=r.results();n=e[0].result,d.avatarUrl(n.avatarUrl()),d.userName(n.displayName())})}function y(e,t){var n={key:"content_search_conversation_title",params:{conversationTitle:s.escapeIncomingHTML(t)}},r=new Date(e);return o.getTimeSinceTimestamp(r,n)}var d=this,v,m;d.init=function(t,r){m=r,v=l.build(m),d.displayMessage=t.Content,d.messageId=t.ClientMessageId,d.isGroupConversation=!1,d.conversation=y(t.CreationDate,m.topic()),d.userName=n.observable(""),d.avatarUrl=n.observable(""),g(t),d.statusClassName=v.statusClassName,d.isAgent=v.isAgent,d.isActive=!1},d.dispose=function(){v.dispose()},d.handleClick=function(t,n){var r=i.telemetry.historyLoadOrigin.TIMELINE_CLICK;f.getInstance().startTrace("navigateConversation"),n.preventDefault(),a.publish(p.OPEN_CONVERSATION,{model:m,messageId:t.messageId+"",origin:r})},d.ariaLabel=n.pureComputed(function(){var e="content_search_aria";return r.fetch({key:e,count:0,params:{topic:m.topic()}})})}}),define("text!views/chat/messagesList.html",[],function(){return'<!-- ko if: searchResults().length > 0 -->\r\n<ul class="groups" data-bind="foreach: { data: searchResults }">\r\n    <!-- ko if: $index() === 0 -->\r\n    <li class="separator">\r\n        <p class="strong" data-bind="html: $parent.title" />\r\n    </li>\r\n    <!-- /ko -->\r\n\r\n    <li class="list-selectable">\r\n        <a role="button" data-bind="event: { click: handleClick }, attr: {\'aria-label\':ariaLabel }" class="recent unread">\r\n\r\n            <swx-avatar-deprecated params="isGroupAvatar: isGroupConversation, isAgent: isAgent, avatar: avatarUrl" class="avatar"></swx-avatar-deprecated>\r\n\r\n            <div class="text">\r\n                <span class="arrow"></span>\r\n                <span class="tile">\r\n                    <span class="tileName">\r\n                        <h4>\r\n                            <span class="topic" data-bind="text: userName, attr: {title: userName}"></span>\r\n                        </h4>\r\n                    </span>\r\n                </span>\r\n\r\n                <div class="message">\r\n                    <p data-bind="html: displayMessage" class="small"></p>\r\n                </div>\r\n                <div class="message">\r\n                    <p class="small"><span data-bind="html: conversation" /></p>\r\n                </div>\r\n            </div>\r\n        </a>\r\n    </li>\r\n</ul>\r\n<!-- ko if: hasAdditionalResults --> \r\n<div class="additionalResults fontSize-p">\r\n    <span>\r\n        <a role="button" data-bind="event: {click: displayAdditionResults}, attr: {\'aria-label\':additionalResultsTitle}"><span data-bind="text: additionalResultsTitle"></span></a>\r\n    </span>\r\n</div>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n'}),define("ui/components/chat/messagesSearch",["require","exports","module","ui/viewModels/chat/messagesSearch","ui/viewModels/chat/messageSearchItem","constants/components","text!views/chat/messagesList.html"],function(e,t){function i(){var e=new n(r);return e.init(),e}var n=e("ui/viewModels/chat/messagesSearch"),r=e("ui/viewModels/chat/messageSearchItem");t.name=e("constants/components").chat.MESSAGES_SEARCH,t.template=e("text!views/chat/messagesList.html"),t.viewModel={createViewModel:i}}),define("utils/chat/spaceMail",["require","exports","module","swx-i18n"],function(e,t){function r(){return encodeURI(n.fetch({key:"spaces_email_subject"}))}function i(e,t){var r=n.fetch({key:"spaces_email_greeting"}),i=n.fetch({key:"spaces_email_joinMe",params:{spaceName:e}}),s=n.fetch({key:"spaces_email_link"});return encodeURI(r+"\r\n\r\n"+i+"\r\n"+s+" "+t)}var n=e("swx-i18n").localization;t.createMailtoLink=function(e,t){return"mailto:?subject="+r()+"&body="+i(e,t)}}),define("utils/common/location",[],function(){return{setHref:function(e){window.location.href=e}}}),define("ui/viewModels/chat/inviteLink",["require","exports","module","lodash-compat","vendor/knockout","browser/dom","browser/window","utils/chat/spaceMail","constants/common","utils/common/eventMixin","utils/common/cafeObservable","utils/common/location","constants/common","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","services/serviceLocator","swx-i18n"],function(e,t){function g(e,t){function E(){return n._parentContext.constructor.name}function S(t){var n=e.telemetryContext?e.telemetryContext:{source:p.invitesShareButtons.groupInformationPanel};w.recordAction(t,n)}function x(e){var t=document.createRange();t.selectNodeContents(e);var n=s.getSelection();n.removeAllRanges(),n.addRange(t)}var n=this,a=e.topic,g=e.uri,y=i.getElement(".copyArea",t.element),b=i.getElement("p.link",t.element),w=d.resolve(c.serviceLocator.ACTION_TELEMETRY);n.init=function(){var t,i=function(){n.showCopiedIndicator(!1)};n.copyActive=r.observable(!1),n.topic=f.newObservableProperty(a),n.uri=f.newObservableProperty(g),n.showCopiedIndicator=r.observable(!1),n.copiedIndicatorText="",n.tabIndex=e.isMessageContent?-1:0,n.copy=function(){n.copyActive(!0),y.select(),S(h.invites.copyButton);try{var e=document.execCommand("copy");n.copyActive(!1),n.copiedIndicatorText=e?v.fetch({key:"header_text_copied"}):v.fetch({key:"header_text_cant_copy"}),n.showCopiedIndicator(!0),t&&s.clearTimeout(t),t=s.setTimeout(i,m),e||x(b)}catch(r){}n.dispatchEvent(u.conversation.COPY_LINK,{parent:E()},n.DIRECTION.PARENT)},n.send=function(){n.dispatchEvent(u.conversation.EMAIL_LINK,{parent:E()},n.DIRECTION.PARENT),S(h.invites.mailButton),l.setHref(n.mailtoLink())},n.cancel=function(){n.copyActive(!1)},n.mailtoLink=r.computed(function(){return o.createMailtoLink(n.topic(),n.uri())})},n.dispose=function(){n.mailtoLink.dispose()}}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("browser/dom"),s=e("browser/window"),o=e("utils/chat/spaceMail"),u=e("constants/common").events,a=e("utils/common/eventMixin"),f=e("utils/common/cafeObservable"),l=e("utils/common/location"),c=e("constants/common"),h=e("ui/telemetry/actions/actionNames"),p=e("ui/telemetry/actions/actionSources"),d=e("services/serviceLocator"),v=e("swx-i18n").localization,m=3e3;n.assign(g.prototype,a),t.classFunction=g,t.build=function(e,t){return new g(e,t)}}),define("text!views/chat/inviteLink.html",[],function(){return'<div class="inviteLink" data-bind="css: { active: copyActive }">\r\n    <!-- ko ifnot: uri -->\r\n    <swx-loading-animation class="spinner small blue"></swx-loading-animation>\r\n    <!-- /ko -->\r\n    <!-- ko if: uri -->\r\n    <p class="link fontSize-p"><span data-bind="text: uri"></span></p>\r\n    <!-- /ko -->\r\n    <input class="copyArea fontSize-p" data-bind="value: uri" readonly />\r\n    <div class="menu fontSize-p small">\r\n        <div class="copyWrapper">\r\n            <a href="#" role="button" class="copy" data-bind="css: {copyHidden: showCopiedIndicator}, click: copy, attr: { tabindex: tabIndex }">\r\n                <span class="iconfont link" data-bind="l10n: {key: \'header_text_copyLink\'}"></span>\r\n            </a>\r\n            <!-- ko if: showCopiedIndicator -->\r\n            <div class="copiedIndicator" data-bind="css: {copiedIndicatorFadeIn: showCopiedIndicator}"><span class="iconfont link" data-bind="l10n: {key: \'header_text_copied\'}"></span></div>\r\n            <!-- /ko -->\r\n        </div>\r\n        <a href="#" role="button" class="email" data-bind="click: send, attr: { tabindex: tabIndex }">\r\n            <span class="iconfont email" data-bind="l10n: {key: \'header_text_inviteViaEmail\'}"></span>\r\n        </a>\r\n        <a role="button" class="cancel" data-bind="click: cancel, l10n: {key: \'action_button_cancel\'}"></a>\r\n    </div>\r\n </div>\r\n'}),define("ui/components/chat/inviteLink",["require","exports","module","vendor/knockout","ui/viewModels/chat/inviteLink","constants/components","text!views/chat/inviteLink.html"],function(e,t){function i(e,t){var i=r.build(e,t),s=n.dataFor(t.element);return i.setContext(s),i.init(),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/inviteLink");t.name=e("constants/components").chat.INVITE_LINK,t.template=e("text!views/chat/inviteLink.html"),t.viewModel={createViewModel:i}}),define("telemetry/chat/newConversationFlow",["require","constants/common","services/telemetry/skypeData","services/telemetry/common/telemetryContext","services/telemetry/common/analyticsInfo","usertiming"],function(e){function f(){function c(){for(var e in n.NEW_CONVERSATION)n.NEW_CONVERSATION.hasOwnProperty(e)&&a.clearMarks(n.NEW_CONVERSATION[e]);for(var t in i.NEW_CONVERSATION)i.NEW_CONVERSATION.hasOwnProperty(t)&&a.clearMeasures(i.NEW_CONVERSATION[t])}function h(){try{var e=a.getEntriesByName(n.NEW_CONVERSATION.CREATION_END_OK).length>0;if(e){l=!0,a.measure(i.NEW_CONVERSATION.TTS,n.NEW_CONVERSATION.CREATION_START,n.NEW_CONVERSATION.CREATION_END_OK);return}l=!1,a.measure(i.NEW_CONVERSATION.TTS,n.NEW_CONVERSATION.CREATION_START,n.NEW_CONVERSATION.CREATION_END_ERROR)}catch(t){}}var e=r.STARTED,f=0,l=t.telemetry.NOT_AVAILABLE;this.participantsCountUpdated=function(e){f=e},this.publish=function(){function S(){try{a.mark(n.NEW_CONVERSATION.RENDER_END),a.measure(i.NEW_CONVERSATION.TTC,n.NEW_CONVERSATION.FLOW_START,n.NEW_CONVERSATION.RENDER_END),a.measure(i.NEW_CONVERSATION.TTR,n.NEW_CONVERSATION.CREATION_START,n.NEW_CONVERSATION.RENDER_END);var e=a.getEntriesByName(i.NEW_CONVERSATION.TTC),t=a.getEntriesByName(i.NEW_CONVERSATION.TTR);e&&e.length>0&&(m=e[0].duration),t&&t.length>0&&(y=t[0].duration)}catch(r){}}var p=o.get(),d=u.get(),v=d.contactsInfo(),m=t.telemetry.NOT_AVAILABLE,g=t.telemetry.NOT_AVAILABLE,y=t.telemetry.NOT_AVAILABLE,b=[t.telemetry.historyLoadOrigin.NEW_CHAT_OPEN_EXISTING,t.telemetry.historyLoadOrigin.CALLING],w=b.indexOf(p.historyLoadOrigin)>-1,E=p.historyLoadOrigin===t.telemetry.historyLoadOrigin.NEW_CHAT_CREATION;if(w)e=r.REDIRECTED,S();else if(E){e=r.CREATED,S(),h(),g=t.telemetry.NOT_AVAILABLE;var x=a.getEntriesByName(i.NEW_CONVERSATION.TTS);x&&x.length&&(g=x[0].duration)}else e=r.ABANDONED;var T={type:"chat_conversation_new",data:{stage:e,contactsCount:v.totalContacts,participantsCount:f,CTA:p.historyLoadOrigin,TTC:m,TTS:g,TTR:y,success:l}};c(),s.push(T)}}var t=e("constants/common"),n=t.telemetry.performanceMarks,r=t.telemetry.stages.NEW_CONVERSATION,i=t.telemetry.measurements,s=e("services/telemetry/skypeData"),o=e("services/telemetry/common/telemetryContext"),u=e("services/telemetry/common/analyticsInfo"),a=e("usertiming");return f}),define("ui/viewModels/chat/headerNewConversation",["require","lodash-compat","vendor/knockout","utils/common/eventMixin","swx-i18n","ui/modelHelpers/conversationHelper","services/serviceLocator","constants/common","constants/keys","utils/common/eventHelper","ui/telemetry/actions/actionSources"],function(e){function h(e,t){function g(){d(r.selectedContacts().length),t.participantsCountUpdated(d())}var r=e.participantsProvider,h,p=this,d=n.observable(0),v=o.resolve(u.serviceLocator.FEATURE_FLAGS),m;e.conversationModel?p.conversationModel=e.conversationModel:p.conversationModel={isGroupConversation:n.observable(!0),topic:n.observable("DEFAULT_TOPIC"),participants:n.observableArray(),participantsCount:n.observable(0)},p.spacesEnabled=v.isFeatureOn(u.featureFlags.SPACES),p.telemetryContext={source:l.invitesShareButtons.newConversation},p.newConversationV2=n.observable(v.isFeatureOn(u.featureFlags.NEW_CONVERSATION_V2)),p.showMoreActions=function(){return v.isFeatureOn(u.featureFlags.SCHEDULE_CALL_FROM_CONVERSATION)&&!s.isOneToOneConversationWithAgent(p.conversationModel)&&!s.isOneToOneConversationWithEcho(p.conversationModel)},m=n.observable(p.spacesEnabled),p.participantCount=n.pureComputed(function(){var e=d();return v.isFeatureOn(u.featureFlags.INCLUDE_SELF_IN_PARTICIPANTS_COUNT)&&(e+=1),i.fetch({key:"label_text_participant",count:e})}),p.confirmButtonDisabled=n.pureComputed(function(){return d()===0&&!m()}),p.topic=n.pureComputed(function(){return p.newConversationV2()?i.fetch({key:"conversation_header_topic_untitled_conversation"}):m()?s.createSpaceTopic():i.fetch({key:"conversation_header_topic_untitled_conversation"})}),p.setParticipantProvider=function(t){e.setParticipantProvider(t),r=t,h=r.selectedContacts.subscribe(g)},p.confirm=function(){p.dispatchEvent(c.newConversation.CONFIRMED,m()),m(p.spacesEnabled),t.publish()},p.cancel=function(){p.dispatchEvent(c.newConversation.CANCELLED),m(p.spacesEnabled)},p.forwardEvent(c.roster.ROSTER_QUERY_CHANGED),p.forwardEvent(c.roster.ROSTER_QUERY_EXECUTED),p.forwardEvent(c.roster.ROSTER_SELECTION_REMOVED),p.forwardEvent(c.roster.PICKER_CONTACT_SELECTED),p.forwardEvent(c.roster.PICKER_CONTACT_DESELECTED),p.forwardEvent(c.conversation.SHARED),p.registerEvent(c.conversation.JOINING_ENABLED,m),p.dispose=function(){h&&h.dispose()},p.handleKeyDown=function(e,t){var n=f.getKeyCode(t);return n===a.ESCAPE&&(e.cancel(),t.stopPropagation()),!0}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/eventMixin"),i=e("swx-i18n").localization,s=e("ui/modelHelpers/conversationHelper"),o=e("services/serviceLocator"),u=e("constants/common"),a=e("constants/keys"),f=e("utils/common/eventHelper"),l=e("ui/telemetry/actions/actionSources"),c=u.events;return t.assign(h.prototype,r),h}),define("text!views/chat/headerNewConversation.html",[],function(){return'<div class="headerMain">\r\n    <div class="roster">\r\n        <div class="grid">\r\n            <span class="tile conversationTopic">\r\n                <span class="tileText">\r\n                    <span class="tileName square">\r\n                        <h3 data-bind="html: topic"></h3>\r\n                    </span>\r\n                    <span class="tileMessage">\r\n                        <div class="message">\r\n                            <a class="participantCount">\r\n                                 <p data-bind="text: participantCount"></p>\r\n                            </a>\r\n                        </div>\r\n                    </span>\r\n                </span>\r\n            </span>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<div class="contactPickerWrapper" data-bind="event: { keydown: handleKeyDown }">\r\n    <div class="headerAdd">\r\n        <swx-contact-picker-input params="setParticipantProvider: setParticipantProvider"></swx-contact-picker-input>\r\n    </div>\r\n\r\n    <swx-contact-picker params="conversation: conversationModel, className: \'headerPicker\', showJumpToConversation: true"></swx-contact-picker>\r\n    <!-- ko if: !newConversationV2() -->\r\n        <!-- ko if: spacesEnabled -->\r\n            <swx-space-settings params="conversationModel: conversationModel, defaultVal: true"></swx-space-settings>\r\n        <!-- /ko -->\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: newConversationV2 -->\r\n    <div class="actions">\r\n        <div class="conversationButtons">\r\n            <div class="submitConversation">\r\n                <swx-button params="cssClass: \'secondary circle\', disabled: false, textKey: \'action_button_cancel\', titleKey: \'action_button_cancel\', ariaLabelKey: \'action_button_cancel\', action: cancel"></swx-button>\r\n                <swx-button params="cssClass: \'primary circle\', disabled: confirmButtonDisabled, textKey: \'action_button_confirm\', titleKey: \'action_button_confirm\', ariaLabelKey: \'action_button_confirm\', action: confirm"></swx-button>\r\n            </div>\r\n\r\n            <!-- ko if: spacesEnabled -->\r\n            <swx-conversation-share-link class="conversation-share-link-actions" params="conversationModel: conversationModel, telemetryContext: telemetryContext"></swx-conversation-share-link>\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n\r\n<div class="headerControls" data-bind="css: { newConversationV2: newConversationV2 }">\r\n    <!-- ko if: !newConversationV2() -->\r\n    <div class="buttonRow">\r\n        <swx-button params="icon: \'tick\', cssClass: \'primary circle\', disabled: confirmButtonDisabled, textKey: \'action_button_confirm\', titleKey: \'action_button_confirm\', ariaLabelKey: \'action_button_confirm\', action: confirm"></swx-button>\r\n        <swx-button params="icon: \'cross\', cssClass: \'primary circle\', disabled: false, textKey: \'action_button_cancel\', titleKey: \'action_button_cancel\', ariaLabelKey: \'action_button_cancel\', action: cancel"></swx-button>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- ko if: newConversationV2 -->\r\n    <div class="buttonRow newConversationV2">\r\n        <swx-button class="callButtons" params="icon: \'videoOn\', cssClass: \'primary circle\', disabled: \'true\', textKey: \'button_text_videoCall\'"></swx-button>\r\n        <swx-button class="callButtons" params="icon: \'callStart\', cssClass: \'primary circle\', disabled: \'true\', textKey: \'button_text_audioCall\'"></swx-button>\r\n\r\n        <!-- ko if: !showMoreActions() -->\r\n        <swx-button params="icon: \'contactAdd\', cssClass: \'primary circle\', disabled: \'true\', textKey: \'button_text_addParticipants\'"></swx-button>\r\n        <!-- /ko -->\r\n        <!-- ko if: showMoreActions() -->\r\n        <swx-button params="icon: \'more\', cssClass: \'secondary circle stroke\', disabled: \'true\', textKey: \'button_text_moreActions\'"></swx-button>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/chat/headerNewConversation",["require","exports","module","vendor/knockout","telemetry/chat/newConversationFlow","ui/viewModels/chat/headerNewConversation","constants/components","text!views/chat/headerNewConversation.html"],function(e,t){function s(e,t){var s=new r,o=new i(e,s);return o.setContext(n.dataFor(t.element)),o}var n=e("vendor/knockout"),r=e("telemetry/chat/newConversationFlow"),i=e("ui/viewModels/chat/headerNewConversation");t.name=e("constants/components").chat.HEADER_NEW_CONVERSATION,t.template=e("text!views/chat/headerNewConversation.html"),t.viewModel={createViewModel:s}}),define("text!views/chat/message.html",[],function(){return'<!-- ko if: showAuthorInfo -->\r\n<!-- ko if: isGroupConversation -->\r\n<a data-bind="click: openConversationWithAuthor, attr: {\'aria-label\': openConversationLabel, title: openConversationLabel}" role="button">\r\n    <swx-avatar-deprecated params="isGroupAvatar: false, avatar: author.avatar, isAgent: author.isAgent" class="avatar clickable"></swx-avatar-deprecated>\r\n</a>\r\n<!-- /ko -->\r\n<!-- ko ifnot: isGroupConversation -->\r\n<swx-avatar-deprecated params="isGroupAvatar: false, avatar: author.avatar, isAgent: author.isAgent" class="avatar"></swx-avatar-deprecated>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n\r\n<!-- ko if: isCallActivityItem -->\r\n<div class="callAction">\r\n    <div class="iconfont" data-bind="css: callAction"></div>\r\n</div>\r\n<!-- /ko -->\r\n\r\n<div class="bubble">\r\n    <!-- ko if: renderAuthorInfo -->\r\n    <div class="offScreen" data-bind="l10n: { \'key\': \'label_text_from\' }"> </div>\r\n    <!-- ko if: isGroupConversation -->\r\n    <a data-bind="css: { offScreen: !showAuthorInfo() }, attr: {\'aria-label\': openConversationLabel}, click: openConversationWithAuthor" role="button">\r\n        <swx-name params="person: author"></swx-name>\r\n    </a>\r\n    <!-- /ko -->\r\n    <!-- ko ifnot: isGroupConversation -->\r\n    <swx-name params="person: author" data-bind="css: { offScreen: !showAuthorInfo() }"></swx-name>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n\r\n    <div class="arrow"></div>\r\n\r\n    <div class="content" data-bind="template: { name: contentTemplate, data: $data }, attr: { id: $data.contentId }"></div>\r\n\r\n    <div class="timestamp" data-bind="css: { offScreen: !showTimestamp() }">\r\n        <div class="offScreen" data-bind="l10n: { \'key\': \'message_text_timeStampMessage\' }"></div>\r\n        <p data-bind="text: setTimestamp, attr: {id: \'time_\' + $data.clientmessageid}" class="smaller"></p>\r\n    </div>\r\n\r\n    <!-- ko if: heartsVM.canHeart -->\r\n    <swx-heart params="heartsVM:heartsVM"></swx-heart>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: isEdited -->\r\n    <div class="messageIcon">\r\n        <span class="iconfont edit"></span>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: messageDeliveryIndicatorEnabledSW4B -->\r\n    <div class="messageIcon" data-bind="css:{hide:!deliveryFailed()}, attr:{title:deliveryFailedMessage, \'aria-label\':deliveryFailedMessage}">\r\n        <span class="iconfont warning"></span>\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n\r\n<!-- ko if: messageDeliveryStatusEnabled && !heartsVM.hasHeartBar()-->\r\n<div class="DeliveryStatus" data-bind="css:{hide: (!isMyLastMessageInChat() && !deliveryFailed())}">\r\n    <span data-bind="css: deliveryStatusIconCssClass"></span>\r\n    <span class="DeliveryStatus-status fontSize-p smaller" data-bind="text: statusText"></span>\r\n</div>\r\n<!-- /ko -->\r\n\r\n<!-- ko if: heartsVM.canHeart -->\r\n    <!-- ko if: heartsVM.hasHeartBar -->\r\n        <div class="heartBar">\r\n            <span class="namesWrapper">\r\n                <p data-bind="html: heartsVM.heartBarLoved, click: heartsVM.triggerTooltip" class="namesList clickable fontSize-p smaller" role="button"></p>\r\n                <swx-user-list-popup params="\r\n                    eventContext: $data,\r\n                    isSelfPopup: heartsVM.isSelfPopup,\r\n                    title: heartsVM.lovedByCount(),\r\n                    users: heartsVM.usersHearts"></swx-user-list-popup>\r\n            </span>\r\n        </div>\r\n    <!-- /ko -->\r\n<!-- /ko -->\r\n'}),define("ui/components/chat/message",["require","exports","module","vendor/knockout","constants/components","text!views/chat/message.html"],function(e,t){function r(e,t){var r=e.viewModel,i=n.contextFor(t.element).$parent;return r.setContext(i),r.onRendered(),r.elementInfo=t,r}var n=e("vendor/knockout");t.name=e("constants/components").chat.MESSAGE,t.template=e("text!views/chat/message.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/fragment",["require","lodash-compat","vendor/knockout","constants/common","utils/common/eventMixin"],function(e){function s(e){function i(){t.dispatchEvent(r.COMPONENT_RENDERED,{fragment:t},t.DIRECTION.PARENT)}var t=this;this.name=e.page,this.options=e,this.hidden=n.observable(!0),this.setVisible=function(e){this.dispatchEvent(e?r.FRAGMENT_BEFORE_SHOW:r.FRAGMENT_BEFORE_HIDE,this.options,this.DIRECTION.CHILD),this.hidden(!e),this.dispatchEvent(e?r.FRAGMENT_SHOW:r.FRAGMENT_HIDE,this.options,this.DIRECTION.CHILD)},this.registerEvent(r.COMPONENT_RENDERED,i)}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("constants/common").events.navigation,i=e("utils/common/eventMixin");return t.assign(s.prototype,i),s}),define("ui/viewModels/chat/navigation",["require","lodash-compat","vendor/knockout","cafe/applicationInstance","swx-enums","constants/common","constants/components","services/pubSub/pubSub","services/serviceLocator","services/telemetry/common/telemetryContext","ui/viewModels/chat/navigationHelper","utils/common/eventMixin","ui/viewModels/chat/fragment"],function(e){function y(e){return g.indexOf(e)!==-1}function b(e){return e===o.chat.NEW_CONVERSATION||e===o.userSettings.USER_SETTINGS_PAGE}function w(e){function x(e){return t.fragments().filter(e)[0]}function T(){clearTimeout(t._cacheLimitOverflowCheckTimer),t._cacheLimitOverflowCheckTimer=setTimeout(L,m)}function N(e){var t=e.options.model;return!t||t.selfParticipant&&t.selfParticipant.audio.state()===i.callConnectionState.Disconnected}function C(){return x(function(e){return e.hidden()&&N(e)})}function k(e){t.fragments.remove(e),e.dispose()}function L(){if(t.fragments().length<=v)return;var e=C();e&&k(e),T()}function A(){return x(function(e){return!e.hidden()})}function O(e){var t=A();t&&t!==e&&(t.setVisible(!1),b(t.name)&&k(t)),e.setVisible(!0),P(e)}function M(e){O(e.fragment)}function _(e){var n=new h(e);return n.setContext(t),t.fragments.push(n),n}function D(e){var t=A(),n=B(e);n&&k(n);if(E===e||E&&E.model&&e&&e.model&&E.model===e.model)E=null;t&&t===n&&q()}function P(e){E=w?w.options:null,w=e,S.currentPlaceModel(e.options.model),S.currentPlaceName(e.name),g.historyLoadOrigin=e.options.origin,u.publish(p.FRAGMENT_LOADED,e.name)}function H(e,t){return t&&t.name===e.page&&t.options.model===e.model}function B(e){return x(function(t){return H(e,t)})}function j(e){var t=B(e);t?(t.options=e,O(t)):(t=_(e),y(e.page)&&O(t)),T()}function F(e){var t=B(e);t.options=e,t.setVisible(!0)}function I(t){if(!t||!t.page)throw new TypeError("You need to specify where you navigate !");if(!t.contentElementId||t.contentElementId===e){if(H(t,w)){F(t);return}j(t)}}function q(){var e=c.conversationsManager.conversations().length,t=c.signInManager.state()===i.loginState.SignedIn,n;if(!t)return;E&&e?u.publish(p.NAVIGATE,E):e?(n={page:o.chat.CONVERSATION,model:c.conversationsManager.conversations()[0]},u.publish(p.NAVIGATE,n)):l.navigateToContactsPage()}function R(t){if(!t.contentElementId||t.contentElementId===e)t.page=o.chat.CONVERSATION,u.publish(p.NAVIGATE,t)}function U(){t.shrinkContent(!1),t.expandContent(!0)}function z(){t.expandContent(!1),t.shrinkContent(!0)}function W(){[].concat(t.fragments()).forEach(function(e){e.hidden()&&N(e)&&k(e)})}var t=this,c=r.get(),g,w,E,S;this.expandContent=n.observable(!1),this.shrinkContent=n.observable(!0),this.fragments=n.observableArray(),this.isInBackground=n.observable(!1),this.dispose=function(){u.unsubscribe(p.OPEN_CONVERSATION,R),u.unsubscribe(p.NAVIGATE,I),u.unsubscribe(d.SIDEBAR_STATE_CHANGED,this.isInBackground),u.unsubscribe(p.NAVIGATE_TO_PREVIOUS_PAGE,q),u.unsubscribe(d.SHOW_SIDEBAR,z),u.unsubscribe(d.HIDE_SIDEBAR,U),u.unsubscribe(p.FRAGMENT_REMOVE,D),u.unsubscribe(p.FRAGMENT_REMOVE_ALL_HIDDEN,W)},this.handleUserAction=function(){return c.isEndpointActive&&c.isEndpointActive.set(!0),!0},this.init=function(){u.subscribe(p.OPEN_CONVERSATION,R),u.subscribe(p.NAVIGATE,I),u.subscribe(d.SIDEBAR_STATE_CHANGED,this.isInBackground),u.subscribe(p.NAVIGATE_TO_PREVIOUS_PAGE,q),u.subscribe(d.SHOW_SIDEBAR,z),u.subscribe(d.HIDE_SIDEBAR,U),u.subscribe(p.FRAGMENT_REMOVE,D),u.subscribe(p.FRAGMENT_REMOVE_ALL_HIDDEN,W),this.registerEvent(p.COMPONENT_RENDERED,M),g=f.get(),S=a.resolve(s.serviceLocator.NAVIGATION_CONTEXT),u.publish(s.apiUIEvents.SWX_CONTENT_LOADED,{contentElementId:e}),c.signInManager.state.when(i.loginState.SignedOut,function(){t.fragments.removeAll(),S.reset(),w=undefined,E=undefined})}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("cafe/applicationInstance"),i=e("swx-enums"),s=e("constants/common"),o=e("constants/components"),u=e("services/pubSub/pubSub"),a=e("services/serviceLocator"),f=e("services/telemetry/common/telemetryContext"),l=e("ui/viewModels/chat/navigationHelper"),c=e("utils/common/eventMixin"),h=e("ui/viewModels/chat/fragment"),p=s.events.navigation,d=s.events.narrowMode,v=1,m=2e4,g=[o.people.CONTACTS_PAGE,o.people.DISCOVER_AGENTS_PAGE,o.calling.SKYPEOUT_PAGE,o.userSettings.USER_SETTINGS_PAGE];return t.assign(w.prototype,c),{build:function(e){return new w(e)}}}),define("text!views/chat/navigation.html",[],function(){return'<div class="fragmentsContainer" data-bind="foreach: fragments, css: { showContent: expandContent, hideContent: shrinkContent }, event: { mousemove: handleUserAction, click: handleUserAction, mousewheel: handleUserAction, keydown: handleUserAction }">\r\n    <div class="fragment hide" aria-hidden="true" data-bind="component: { name: $data.name, params: $data.options },css: { hide: hidden },attr: { \'aria-hidden\': hidden }"></div>\r\n</div>\r\n'}),define("ui/components/chat/navigation",["require","exports","module","ui/viewModels/chat/navigation","constants/components","text!views/chat/navigation.html"],function(e,t){function r(e,t){var r=i(t.element),s=n.build(r);return s.init(),s}function i(e){var t=e;while(t&&!t.classList.contains("swxContent"))t=t.parentNode;return t?t.getAttribute("id"):null}var n=e("ui/viewModels/chat/navigation");t.name=e("constants/components").chat.NAVIGATION,t.template=e("text!views/chat/navigation.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/newConversation",["require","lodash-compat","constants/common","utils/common/eventMixin","ui/modelHelpers/conversationHelper","utils/common/async","cafe/applicationInstance","services/pubSub/pubSub","services/serviceLocator","usertiming"],function(e){function c(){function c(){l.mark(u.NEW_CONVERSATION.FLOW_START)}function h(r){var f;e.conversation||(e.conversation=i.createConversation(t.selectedContacts(),r)),e.conversation.isJoiningEnabled.set.enabled.once(!0,function(){e.conversation.isJoiningEnabled.set(r)}),e.newConversationV2&&i.addPersonsToConversation(t.selectedContacts(),e.conversation),f=e.conversation.isGroupConversation()?n.telemetry.historyLoadOrigin.NEW_CHAT_CREATION:n.telemetry.historyLoadOrigin.NEW_CHAT_OPEN_EXISTING,e.conversation.isGroupConversation()||o.get().conversationsManager.conversations.add(e.conversation),s.execute(function(){l.mark(u.NEW_CONVERSATION.RENDER_END),a.publish(n.events.navigation.OPEN_CONVERSATION,{model:e.conversation,origin:f})})}function p(){l.mark(u.NEW_CONVERSATION.RENDER_END),a.publish(n.events.navigation.NAVIGATE_TO_PREVIOUS_PAGE)}function d(s){if(!e.conversation){var o=r.isFeatureOn(n.featureFlags.SPACES);e.conversation=i.createConversation(t.selectedContacts(),o),e.conversation.isJoiningEnabled.set.enabled.once(!0,function(){e.conversation.isJoiningEnabled.set(o)})}s(e.conversation)}var e=this,t,r=f.resolve(n.serviceLocator.FEATURE_FLAGS);e.registerEvent(n.events.newConversation.CONFIRMED,h),e.registerEvent(n.events.newConversation.CANCELLED,p),e.registerEvent(n.events.conversation.SHARED,d),e.forwardEvent(n.events.navigation.FRAGMENT_SHOW,e.DIRECTION.CHILD,c),e.newConversationV2=r.isFeatureOn(n.featureFlags.NEW_CONVERSATION_V2),e.conversation=null,e.setParticipantProvider=function(e){t=e}}var t=e("lodash-compat"),n=e("constants/common"),r=e("utils/common/eventMixin"),i=e("ui/modelHelpers/conversationHelper"),s=e("utils/common/async"),o=e("cafe/applicationInstance"),u=n.telemetry.performanceMarks,a=e("services/pubSub/pubSub"),f=e("services/serviceLocator"),l=e("usertiming");return t.assign(c.prototype,r),c}),define("text!views/chat/newConversation.html",[],function(){return'<div class="conversationControl chat themeLight editRosterMode newConversation">\r\n    <swx-header-new-conversation class="conversationHeader active editMode" params="setParticipantProvider: setParticipantProvider, conversationModel: conversation" data-bind="css: { newConversationV2: newConversationV2 }"></swx-header-new-conversation>\r\n</div>\r\n\r\n'}),define("ui/components/chat/newConversation",["require","exports","module","vendor/knockout","constants/common","ui/viewModels/chat/newConversation","constants/components","text!views/chat/newConversation.html"],function(e,t){function s(e,t){var s=t.element,o=n.dataFor(s),u=new i;return u.setContext(o),u.dispatchEvent(r.navigation.COMPONENT_RENDERED),u}var n=e("vendor/knockout"),r=e("constants/common").events,i=e("ui/viewModels/chat/newConversation");t.name=e("constants/components").chat.NEW_CONVERSATION,t.template=e("text!views/chat/newConversation.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/chat/contactPickerInput",["require","lodash-compat","vendor/knockout","utils/common/eventMixin","swx-i18n","constants/common","services/serviceLocator","constants/keys","utils/common/eventHelper","utils/common/async","browser/dom","utils/common/scroll"],function(e){function m(){function g(t){var r=n.utils.arrayFirst(e.selectedContacts(),function(e){return t.id()===e.id()});r||(e.selectedContacts.push(t),x(),S())}function y(t){e.selectedContacts.remove(function(e){return t.id()===e.id()})}function b(t){e.inputValue()&&t&&e.showMoreResultsAvailableMessage(v&&t.moreResultsAvailable)}function w(t){t.length||e.showMoreResultsAvailableMessage(!1);var n={query:t,selectedContacts:e.selectedContacts().slice()};e.dispatchEvent(h.roster.ROSTER_QUERY_CHANGED,n)}function E(){if(e.selectedContacts().length===0)return;e.dispatchEvent(h.roster.ROSTER_SELECTION_REMOVED,{person:e.selectedContacts.pop()})}function S(){t.focus(),f.execute(m.scrollToBottom)}function x(){e.inputValue(d),e.showMoreResultsAvailableMessage(!1)}var e=this,t=null,r=null,m;e.selectedContacts=n.observableArray(),e.placeholder=n.computed(function(){return e.selectedContacts().length>0?i.fetch({key:"input_placeholder_addAnotherContact"}):i.fetch({key:"input_placeholder_typeContactName"})}),e.inputValue=n.observable(d).extend({rateLimit:{timeout:p,method:"notifyWhenChangesStop"}}),e.init=function(i){r=i,v=o.resolve(s.serviceLocator.FEATURE_FLAGS).isFeatureOn(s.featureFlags.SHOW_SEARCH_QUERY_MORE_RESULTS_AVAILABLE),e.showMoreResultsAvailableMessage=n.observable(!1),t=r.querySelector("input"),r.addEventListener(h.browser.CLICK,S),e.inputSubscription=e.inputValue.subscribe(w),e.registerEvent(h.roster.PICKER_CONTACT_SELECTED,g),e.registerEvent(h.roster.PICKER_CONTACT_DESELECTED,y),e.registerEvent(h.roster.ROSTER_QUERY_EXECUTED,b),m=c.build(l.getElement("div.scrollinWrapper",r)),m.init(),S()},e.dispose=function(){r.removeEventListener(h.browser.CLICK,S),e.inputSubscription&&e.inputSubscription.dispose(),e.placeholder.dispose(),e.selectedContacts=null,m.dispose()},e.handleKeyDown=function(e,t){var n=a.getKeyCode(t);return n===u.BACKSPACE&&e.inputValue()===d?(E(),e.showMoreResultsAvailableMessage(!1)):n===u.ESCAPE&&e.inputValue()!==d&&(x(),t.stopPropagation()),!0}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/eventMixin"),i=e("swx-i18n").localization,s=e("constants/common"),o=e("services/serviceLocator"),u=e("constants/keys"),a=e("utils/common/eventHelper"),f=e("utils/common/async"),l=e("browser/dom"),c=e("utils/common/scroll"),h=s.events,p=500,d="",v;return t.assign(m.prototype,r),m}),define("text!views/chat/contactPickerInput.html",[],function(){return'<div class="contactPickerInput scrollinWrapper">\r\n    <div class="scrollViewport scrollViewportV" tabindex="-1">\r\n        <div class="contacts">\r\n            <!-- ko foreach: selectedContacts -->\r\n            <swx-contact-pill params="person: $data" class="contact-pill"></swx-contact-pill>\r\n            <!-- /ko -->\r\n\r\n            <input type="text" class="fontSize-p" data-bind="attr: { placeholder: placeholder }, textInput: inputValue, valueUpdate: \'afterkeydown\', event: { keydown: handleKeyDown },\r\n            l10n_attr: {\'placeholder\': \'input_placeholder_typeContactName\'} ">\r\n        </div>\r\n    </div>\r\n    <!-- ko if: showMoreResultsAvailableMessage() -->\r\n    <div class="moreSearchResults">\r\n        <p class="strong" data-bind="l10n: {key: \'message_more_search_results_available\'}"></p>\r\n    </div>\r\n    <!-- /ko-->\r\n</div>\r\n'}),define("ui/components/chat/contactPickerInput",["require","exports","module","vendor/knockout","ui/viewModels/chat/contactPickerInput","constants/components","text!views/chat/contactPickerInput.html"],function(e,t){function i(e,t){var i=new r;return i.setContext(n.dataFor(t.element)),i.init(t.element),e.setParticipantProvider(i),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/contactPickerInput");t.name=e("constants/components").chat.CONTACT_PICKER_INPUT,t.template=e("text!views/chat/contactPickerInput.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/spaceSettings",["require","lodash-compat","vendor/knockout","utils/common/eventMixin","swx-i18n","swx-enums","utils/chat/spaceMail","utils/common/cafeObservable","constants/common","utils/common/eventHelper"],function(e){function l(e,t){function l(){r.joiningEnabled(!!t)}function c(){r.role=u.newObservableProperty(e.selfParticipant.role),r.spaceLink=u.newObservableProperty(e.uri),r.joiningEnabled(e.isJoiningEnabled()),e.isJoiningEnabled.get(function(e){r.joiningEnabled(e),r.dispatchEvent(a.conversation.JOINING_ENABLED,e,r.DIRECTION.PARENT)})}var r=this;r.role=n.observable(s.participantRole.Leader),r.spaceLink=n.observable(),r.joiningEnabled=n.observable(!!t),r.registerEvent(a.newConversation.CANCELLED,l),r.registerEvent(a.newConversation.CONFIRMED,l),e.selfParticipant&&c(),r.label=n.pureComputed(function(){return r.isAdmin()?i.fetch({key:"header_text_allowOthersToJoin"}):i.fetch({key:"header_text_othersCanJoin"})}),r.isAdmin=n.pureComputed(function(){return r.role()===s.participantRole.Leader||!e.isGroupConversation()}),r.mailtoLink=n.pureComputed(function(){return o.createMailtoLink(e.topic(),r.spaceLink())}),r.linkShown=n.pureComputed(function(){return!!r.spaceLink()&&!!r.joiningEnabled()}),r.hideSettings=n.pureComputed(function(){return!r.isAdmin()&&!r.linkShown()}),r.joiningEnabledHandler=function(){var e=r.joiningEnabled();r.joiningEnabled(!e),r.dispatchEvent(a.conversation.JOINING_ENABLED,!e,r.DIRECTION.PARENT)},r.onJoinEnablerKeydown=function(e,t){var n=f.isActivation(t);return n&&r.joiningEnabledHandler(),!n}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/eventMixin"),i=e("swx-i18n").localization,s=e("swx-enums"),o=e("utils/chat/spaceMail"),u=e("utils/common/cafeObservable"),a=e("constants/common").events,f=e("utils/common/eventHelper");return t.assign(l.prototype,r),l}),define("text!views/chat/spaceSettings.html",[],function(){return'<div class="hide spaceSettings" data-bind="css: { hide: hideSettings, admin: isAdmin, linkShown: linkShown } ">\r\n    <div class="spaces">\r\n        <span class="label fontSize-p" data-bind="text: label"></span>\r\n        <a href="#" class="fontSize-p link" data-bind="text: spaceLink, attr: { href: spaceLink }"></a>\r\n        <a href="#" class="fontSize-p smaller copySpaceLink" data-bind="l10n: {key: \'header_text_copyLink\'}"></a>\r\n        <a href="#" class="fontSize-p smaller sendSpaceLink" data-bind="attr: { href: mailtoLink }, l10n: {key: \'header_text_inviteViaEmail\'}"></a>\r\n    </div>\r\n    <button class="toggler" data-bind="click: joiningEnabledHandler, css: { checked: joiningEnabled }, event: { keydown: onJoinEnablerKeydown }, attr: { \'aria-checked\': joiningEnabled ? \'true\' : \'false\' }" type="button"><span class="on"></span><span class="off"></span></button>\r\n</div>\r\n'}),define("ui/components/chat/spaceSettings",["require","exports","module","vendor/knockout","ui/viewModels/chat/spaceSettings","constants/components","text!views/chat/spaceSettings.html"],function(e,t){function i(e,t){var i=new r(e.conversationModel,e.defaultVal);return i.setContext(n.dataFor(t.element)),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/spaceSettings");t.name=e("constants/components").chat.SPACE_SETTINGS,t.template=e("text!views/chat/spaceSettings.html"),t.viewModel={createViewModel:i}}),define("utils/common/feedback",["require","exports","module","experience/settings","browser/detect","ui/session/localSession","cafe/applicationInstance","swx-i18n"],function(e,t){var n=e("experience/settings"),r=e("browser/detect"),i=e("ui/session/localSession"),s=e("cafe/applicationInstance"),o=e("swx-i18n").localization;t.getFeedbackPageUrl=function(){var e=n.platformId,t=n.version,u=n.initParams.locale,a=s.get().personsAndGroupsManager.mePerson.id(),f=n.biAppName,l=n.initParams.correlationIds.hostProperty,c,h,p,d,v,m;return n.feedbackPageUrl.indexOf("mailto:")===0?(v=r.getBrowserInfo(),d=String.fromCharCode(10),h=o.fetch({key:"giveFeedback_subject"}),p=o.fetch({key:"giveFeedback_body"}),p+=d+d,p+=d+"-------------------------------",p+=d+"Skype Version: "+t,p+=d+"Browser Name: "+v.browserName,p+=d+"Browser Version: "+v.browserMajorVersion,p+=d+"Language: "+u,p+=d+"Property: "+f,p+=d+"Session Id: "+(i.getSessionId()||""),p+=d+"Tab Session Id: "+(i.getTabSessionId()||""),p+=d+"Host Property: "+l,p+=d+"Host User Id: "+n.initParams.correlationIds.userId,p+=d+"Host Session Id: "+n.initParams.correlationIds.sessionId,m=n.feedbackPageUrl+"?subject="+encodeURIComponent(h)+"&body="+encodeURIComponent(p)):(c={userId:n.initParams.correlationIds.userId,sessionId:n.initParams.correlationIds.sessionId},m=n.feedbackPageUrl+"?p="+encodeURIComponent(e)+"&v="+encodeURIComponent(t)+"&lang="+encodeURIComponent(u)+"&e="+encodeURIComponent(f),a&&(m+="&u="+encodeURIComponent(a)),l&&(m+="&tag="+encodeURIComponent(l)),m+="&tcg="+encodeURIComponent(JSON.stringify(c))),m},t.getFeedbackPageTarget=function(){return n.feedbackPageUrl.indexOf("mailto:")===0?"_self":"_blank"}}),define("ui/viewModels/chat/recentList",["require","lodash-compat","vendor/knockout","services/serviceLocator","utils/common/cafeObservable","swx-enums","constants/common","cafe/applicationInstance","utils/common/async","services/pubSub/pubSub","utils/chat/dateTime","utils/common/ko","utils/common/array","usertiming","swx-i18n","browser/window","ui/viewModels/chat/navigationHelper","utils/common/scroll","utils/common/feedback","experience/settings","utils/common/styleModeHelper"],function(e){var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("services/serviceLocator"),i=e("utils/common/cafeObservable"),s=e("swx-enums"),o=e("constants/common"),u=o.events.navigation,a=e("cafe/applicationInstance"),f=e("utils/common/async"),l=e("services/pubSub/pubSub"),c=e("utils/chat/dateTime"),h=e("utils/common/ko"),p=e("utils/common/array"),d=o.telemetry.performanceMarks,v=e("usertiming"),m=e("swx-i18n").localization,g=e("browser/window"),y=e("ui/viewModels/chat/navigationHelper"),b=e("utils/common/scroll"),w=e("utils/common/feedback"),E=e("experience/settings"),S=o.styleMode,x=e("utils/common/styleModeHelper");return function(T,N,C,k){function J(){R(c.getDate().toDateString())}function K(){M().forEach(function(e,t){mt(t,e)}),H.valueHasMutated()}function Q(e,t){l.publish(o.events.interaction.SCROLL_START,t)}function G(e){return e.isOnCall()}function Y(e){return e.canJoinCall()}function Z(){function e(e){var t=G(e),n=Y(e);return F!==t&&(F=t),t||n}return H().filter(e)}function et(e){return!G(e)&&!Y(e)}function tt(e,t){return e.timestamp()===null&&e.conversation.lastModificationTimestamp._set(new Date),e.isFavorited()===t.isFavorited()?t.timestamp()-e.timestamp():e.isFavorited()?-1:1}function nt(e){return!e.isBlocked()}function rt(e){return e.isFavorited()}function it(){var e;return e=H().filter(nt).filter(et).sort(tt),st(e[0]),e}function st(e){if(!e)return;f.execute(function(){bt(I,e),St(e),q.update(),I=e})}function ot(){v.mark(d.TIMELINE.SYNC_START),B.mePerson.displayName.get(),pt(),g.addEventListener("resize",pt)}function ut(){g.removeEventListener("resize",pt),P=!0,X=!1}function at(){if(X)return;var e=O.conversations().length>0;e?vt():y.navigateToContactsPage(vt)}function ft(e){U=e}function lt(){ft(!1),pt()}function ct(){return z.clientHeight<W.scrollHeight}function ht(){return z.scrollTop+z.clientHeight+100>W.scrollHeight}function pt(){!ct()&&O.getMoreConversations.enabled()?(ft(!0),O.getMoreConversations(5).then(lt,at)):at()}function dt(){if(U||!O.getMoreConversations.enabled())return;ht()&&(ft(!0),O.getMoreConversations(5).then(function(){ft(!1)}))}function vt(){v.mark(d.TIMELINE.SYNC_END_OK);var e=new k;e.publish(),l.publish(o.apiUIEvents.SWX_TIMELINE_LOADED,{}),X=!0}function mt(e,t){t._isFavorited&&t._isFavorited.changed(yt);var n=new N(C);n.init(t),xt(n),p.insertAt(H(),e,n),q.update()}function gt(e){var t=H()[e];t.separator.dispose(),t.separator=null,t.conversation._isFavorited&&t.conversation._isFavorited.changed.off(yt),t.dispose(),p.removeFrom(H(),e),q.update()}function yt(e){h.handleArrayChanges(H(),e,mt,gt),H.valueHasMutated(),q.update()}function bt(e,t){t&&t!==e&&t.isActive()&&t.lastMessageIsOutgoing()&&wt()}function wt(){document.querySelector(A).scrollTop=0}function Et(){return!j.currentPlaceName()}function St(e){if(!P||!e)return;P=!1,Et()&&l.publish(u.OPEN_CONVERSATION,{model:e.conversation,origin:o.telemetry.historyLoadOrigin.TIMELINE_INIT})}function xt(e){e.separator=n.computed(function(){return e.isFavorited()?m.fetch({key:"favorites_recents_category_name"}):(R(),c.getDateGroup(e.timestamp()))})}var L=this,A=".timeline .history",O,M,D,P=!0,H,B,j,F,I=null,q,R=n.observable(),U=!1,z,W,X=!1,V=t.debounce(Q,1e3,{leading:!0,trailing:!1}),$=r.resolve(o.serviceLocator.FEATURE_FLAGS);L.init=function(){J(),q=b.build(document.querySelector(".swx .side .timeline .scrollingWrapper")),q.init(),z=document.querySelector(".swx .side .timeline .scrollingWrapper .scrollable"),W=document.querySelector(".swx .side .timeline .scrollingWrapper .scrollable div"),O=a.get().conversationsManager,B=a.get().personsAndGroupsManager,H=n.observableArray(),L.recentConversations=n.computed(it),L.currentCalls=n.pureComputed(Z),L.hasCurrentCall=function(){return L.currentCalls().length>0},j=r.resolve(o.serviceLocator.NAVIGATION_CONTEXT),L.buttonsDisabled=T.buttonsDisabled,L.hasNotificationsToggle=$.isFeatureOn(o.featureFlags.HAS_TIMELINE_BADGE)&&!$.isFeatureOn(o.featureFlags.SINGLE_CONVERSATION_MODE),L.hasBetaLabel=$.isFeatureOn(o.featureFlags.HAS_BETA_LABEL),L.hasFeedbackLink=$.isFeatureOn(o.featureFlags.HAS_FEEDBACK_LINK),L.hasFeedbackIcon=$.isFeatureOn(o.featureFlags.HAS_FEEDBACK_ICON),L.feedbackIconURL=E.appBaseUrl+"/assets/images/components/common/feedback.svg",F=!1,M=i.newObservableCollection(O.conversations),D=M.subscribe(yt,null,"arrayChange"),L.mePersonId=i.newObservableProperty(B.mePerson.id),K(),a.get().signInManager.state.when(s.loginState.SignedIn,ot),a.get().signInManager.state.when(s.loginState.SignedOut,ut),l.subscribe(o.events.system.DATE_CHANGED,J)},L.dispose=function(){D.dispose(),q.dispose(),L.recentConversations.dispose(),L.mePersonId.dispose(),l.unsubscribe(o.events.system.DATE_CHANGED,J),g.removeEventListener("resize",pt)},L.showSeparatorIcon=function(t){var n=L.recentConversations(),r=L.recentConversations().filter(rt),i=x.get().currentMode()===S.NARROW,s=r.length>0,o=t===0||n[t-1]&&n[t-1].isFavorited()&&!n[t].isFavorited();return i&&s&&L.showSeparator(t)&&o},L.separatorIconClass=function(t){var n={},r=L.recentConversations()[t].isFavorited();return n.favourite=r,n.clock=!r,n},L.showSeparator=function(t){var n=L.recentConversations();return t===0||n[t-1].separator()!==n[t].separator()},L.onScroll=function(e,t){dt(),V(e,t)},L.feedbackLabelTitle=function(){return m.fetch({key:"giveFeedback_tooltip"})},L.feedbackPageUrl=n.pureComputed(function(){return w.getFeedbackPageUrl()}),L.feedbackPageTarget=function(){return w.getFeedbackPageTarget()},L.stopSidebarExpanding=function(e,t){t.stopPropagation()}}}),define("telemetry/chat/timelineLoad",["require","usertiming","browser/detect","constants/common","experience/settings","services/telemetry/common/analyticsInfo","services/telemetry/common/telemetryContext","telemetry/chat/telemetryEnumerator","telemetry/utils/telemetryUtils","ui/telemetry/telemetryClient"],function(e){function p(){var e=r.telemetry.NOT_AVAILABLE,p=r.telemetry.NOT_AVAILABLE,d=r.telemetry.NOT_AVAILABLE,v=function(){t.mark(c.TIMELINE.RENDER_END);var r=t.getEntriesByName(c.TIMELINE.SYNC_END_OK);if(r.length>0){t.measure(h.TIMELINE.TTL,c.TIMELINE.SYNC_START,c.TIMELINE.SYNC_END_OK);var i=t.getEntriesByName(h.TIMELINE.TTL);i&&i.length>0&&(e=i[0].duration)}else{t.measure(h.TIMELINE.TTL,c.TIMELINE.SYNC_START,c.TIMELINE.SYNC_END_ERROR);var s=t.getEntriesByName(h.TIMELINE.TTL);s&&s.length>0&&(e=s[0].duration)}var o=t.getEntriesByName(c.TIMELINE.SYNC_END_404),u=o.length>0;if(u){t.measure(h.TIMELINE.TTL404,c.TIMELINE.SYNC_START,c.TIMELINE.SYNC_END_404);var a=t.getEntriesByName(h.TIMELINE.TTR);a&&a.length&&(d=a[0].duration)}t.measure(h.TIMELINE.TTR,c.TIMELINE.SYNC_START,c.TIMELINE.RENDER_END);var f=t.getEntriesByName(h.TIMELINE.TTR);f&&f.length>0&&(p=f[0].duration)};this.publish=function(){var c=o.get(),h=s.get(),m=h.conversationsInfo(),g=h.contactsInfo();try{v()}catch(y){}var b=l.TYPE,w=a.stringify({contactsCount:g.totalContacts,conv1Count:m.conversation1Count,conv30Count:m.conversation30Count,thread1Count:m.thread1Count,threads30Count:m.thread30Count,unreadCount:m.unreadConversationsCount,origin:c.historyLoadOrigin,activeEndpoints:c.activeEndpoints,isPinned:n.getBrowserInfo().isPinnedSite,ttl:e,ttr:p,t404:d,responseCode:c.timelineLoadStatusCode,contactsCountGroup:u.getContactsGroup(g.totalContacts),conv1CountGroup:u.getConversationCountGroup(m.conversation1Count),conv30CountGroup:u.getConversationCountGroup(m.conversation30Count),thread1CountGroup:u.getConversationCountGroup(m.thread1Count),thread30CountGroup:u.getConversationCountGroup(m.thread30Count),unreadCountGroup:u.getMessageCountGroup(m.unreadConversationsCount),ttlDurationGroup:u.getSecondsDurationGroupFromMs(e),ttrDurationGroup:u.getSecondsDurationGroupFromMs(p),t404DurationGroup:u.getSecondsDurationGroupFromMs(d),originDescription:a.getOriginDescription(c.historyLoadOrigin,r.telemetry.timelineLoadOrigin),isError:u.isError(c.timelineLoadStatusCode)});f.get().sendEvent(i.telemetry.uiTenantToken,b,w)}}var t=e("usertiming"),n=e("browser/detect"),r=e("constants/common"),i=e("experience/settings"),s=e("services/telemetry/common/analyticsInfo"),o=e("services/telemetry/common/telemetryContext"),u=e("telemetry/chat/telemetryEnumerator"),a=e("telemetry/utils/telemetryUtils"),f=e("ui/telemetry/telemetryClient"),l=r.telemetry.timelineLoadEvent,c=r.telemetry.performanceMarks,h=r.telemetry.measurements;return p}),define("text!views/chat/recents.html",[],function(){return'<div data-bind="css:{ hide:hasCurrentCall()==false }">\r\n    <div class="current">\r\n        <div class="separator">\r\n            <p class="strong" data-bind="l10n: { key: \'label_text_currentCallHeading\'}"></p>\r\n        </div>\r\n    </div>\r\n    <!-- ko foreach: currentCalls -->\r\n    <div class="current">\r\n        <swx-current-call params="model: $data"></swx-current-call>\r\n    </div>\r\n    <!--/ko -->\r\n</div>\r\n\r\n<div class="scrollingWrapper" data-bind="keyboardNavigation: { itemSelector: \'a\' }">\r\n    <div class="history scrollable scrollViewport scrollViewportV fixSmall" data-bind="event: { scroll: onScroll }" tabindex="-1">\r\n\r\n        <div class="recents scrollViewport-inner" role="list" data-bind="template: { name: \'recent-template\', foreach: recentConversations, as: \'recent\' }"></div>\r\n\r\n        <!-- ko if: recentConversations().length == 0 -->\r\n        <div role="listitem" class="RecentsMessage">\r\n            <p class="RecentsMessage-emptyConversation" data-bind="l10n: { key:  \'label_text_conversationsLoadNone\'}"></p>\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n</div>\r\n\r\n<!-- ko if: hasNotificationsToggle || hasBetaLabel || hasFeedbackIcon -->\r\n<div class="recents-badge">\r\n    <!-- ko if: hasNotificationsToggle -->\r\n    <swx-notifications-toggle-button params="isDisabled: buttonsDisabled" data-bind=" event: { mouseover: stopSidebarExpanding }"></swx-notifications-toggle-button>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: hasFeedbackIcon -->\r\n    <a data-bind="attr: { title: feedbackLabelTitle(), href: feedbackPageUrl(), target: feedbackPageTarget()}, event: { mouseover: stopSidebarExpanding }">\r\n        <p>\r\n            <img data-bind="attr: {src: feedbackIconURL, alt: feedbackLabelTitle()}" />\r\n        </p>\r\n    </a>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: hasBetaLabel -->\r\n    <!-- ko if: hasFeedbackLink -->\r\n    <a data-bind="attr: { title: feedbackLabelTitle(), href: feedbackPageUrl(), target: feedbackPageTarget()}, event: { mouseover: stopSidebarExpanding }">\r\n        <p class="smaller badge">♥ BETA</p>\r\n    </a>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko ifnot: hasFeedbackLink -->\r\n    <p class="smaller badge">♥ BETA</p>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n</div>\r\n<!-- /ko -->\r\n\r\n<script type="text/html" id="recent-template">\r\n    <!-- ko if: $parent.showSeparatorIcon($index()) -->\r\n    <div class="splitter">\r\n        <span class="icon iconfont favourite" data-bind="css:$parent.separatorIconClass($index())"></span>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: $parent.showSeparator($index())-->\r\n    <div role="heading" class="separator">\r\n        <p data-bind="text: recent.separator()" class="strong"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <swx-recent-item role="listitem" params="model: recent" class="list-selectable"></swx-recent-item>\r\n</script>\r\n'}),define("ui/components/chat/recents",["require","exports","module","ui/viewModels/chat/recentList","ui/viewModels/chat/recent","ui/viewModels/chat/message","telemetry/chat/timelineLoad","constants/components","text!views/chat/recents.html"],function(e,t){function o(e){var t=new n(e,r,i,s);return t.init(),t}var n=e("ui/viewModels/chat/recentList"),r=e("ui/viewModels/chat/recent"),i=e("ui/viewModels/chat/message"),s=e("telemetry/chat/timelineLoad");t.name=e("constants/components").chat.RECENTS,t.template=e("text!views/chat/recents.html"),t.viewModel={createViewModel:o}}),define("ui/viewModels/chat/textarea",["require","services/telemetry/logging/perf/main","cafe/applicationInstance","lodash-compat","utils/common/eventMixin","constants/common","experience/settings","constants/keys","constants/calling","utils/common/encoder","utils/chat/dateTime","browser/detect","utils/common/async","utils/chat/messageSanitizer","vendor/knockout","services/serviceLocator","utils/chat/conversationCache","utils/common/cafeObservable","swx-i18n","services/pubSub/pubSub","services/pes/constants","ui/modelHelpers/personHelper","swx-utils-common","ui/viewModels/chat/conversationTopic","ui/telemetry/actions/actionNames","browser/window","ui/telemetry/telemetryClient","telemetry/chat/pes","telemetry/chat/telemetryEnumerator","utils/common/applicationFocusManager","swx-enums","utils/chat/translatorHelper"],function(e){function H(e,i){function nt(){return!!i.conversationModel}function rt(){if(!nt())return;if(!Y.isFeatureOn("showWhenIamTyping"))return;var e=i.conversationModel.chatService;if(!e.sendIsTyping.enabled())return;z=!0,W=k.setTimeout(function(){z=!1},m.THROTTLE),e.sendIsTyping()}function it(){R=H.messageBody().length,p.execute(e.updateSizing)}function st(){return!!H.messageBody().trim()}function ot(){U&&(U=null,e.editing(!1),mt())}function ut(t,n){var r=n.stopImmediatePropagation;return n._stopImmediatePropagationCalled=!1,n.stopImmediatePropagation=function(){n._stopImmediatePropagationCalled=!0,r.apply(n,arguments)},H.dispatchEvent(t,{event:n,viewModel:H,view:e},H.DIRECTION.CHILD),n._stopImmediatePropagationCalled}function at(){return!!F}function ft(e){var t=e.isEdited?s.telemetry.chat.UI_EDIT_MESSAGE:s.telemetry.chat.UI_SEND_MESSAGE,n={emoticonsCount:e.emoticonsCount||0,messageLength:e.messageLength,participantsCount:J()};nt()&&J()===1&&(n.user_to=[i.conversationModel.participants()[0].person.id(),k.skypeTelemetryManager.PIIType.Identity]),e.isEdited&&(n.timedelta=e.timedelta),L.get().sendEvent(o.telemetry.uiTenantToken,t,n)}function lt(){var e=B._translatorSettings&&B._translatorSettings.isEnabled;return e&&(et=B._translatorSettings.meLanguage.code,tt=B._translatorSettings.participantLanguage.code),q&&e&&et&&tt&&et!==tt}function ct(e){e.translation?F(e.message,null,e):F(e.message)}function ht(){var e=d.processOutgoingTextMessage(d.stripHTML(H.messageBody()));return d.isMessageWithEmoticonsOnly(e)}function pt(){t.getInstance().startTrace("messagePostSuccess"),t.getInstance().startTrace("messagePost"),t.getInstance().startTrace("messageAdd");if(at()){if(lt()&&!ht())D.requestTranslation(H.messageBody(),s.chat.messageType.OUTGOING,B,ct);else{var e=o.messageFilters&&o.messageFilters.outgoingMessageFilter?o.messageFilters.outgoingMessageFilter:null,n=r.isFunction(e)?e(H.messageBody()):H.messageBody();F(n)}var i=d.getEmoticonNamesFromMessage(d.processOutgoingTextMessage(H.messageBody())),u=g.resolve(s.serviceLocator.PES_MRU_SERVICE);u.addItemsToMru(r.map(i,function(e){return{id:e,type:S.itemTypes.emoticon.id}})),A.emoticonsSentInMessage(i,G),G=[],ft({messageLength:H.messageBody().length,emoticonsCount:i.length})}}function dt(e,t){var n=t.translation,i=r.filter(e.translations(),function(e){return e.users&&e.users[0]&&x.isMePersonId(e.users[0].mri)}).length;n&&(!e.translations||!e.translations().length||!i?e._translationsArray.add(n):e.translations().forEach(function(e){x.isMePersonId(e.users[0].mri)&&(e.users[0].value=n.users[0].value)})),e.html(t.message)}function vt(){var e=d.getEmoticonNamesFromMessage(d.processOutgoingTextMessage(H.messageBody())),t=H.messageBody(),n=t.length,r=U.timestamp(),i=D.findMatchingTranslation(U.translations,B._translatorSettings),o=lt()&&(i&&i!==t||!i&&U.html()!==t),u={messageLength:n,emoticonsCount:e.length,isEdited:!0,timedelta:O.getMessageLifeDurationGroup(new Date-r)};o?(D.requestTranslation(t,s.chat.messageType.OUTGOING,B,dt.bind(null,U)),ft(u)):U.html()!==t&&(U.translations&&U.translations().length&&U.translations.empty(),U.html(t),ft(u)),ot()}function mt(){H.messageBody("").length&&H.messageBody(""),R=-1,it(),E.publish(a.textarea.HAS_INPUT,!1),H.dispatchEvent(a.textarea.INPUT,{viewModel:H,view:e},H.DIRECTION.CHILD)}function gt(e){if(e.type==="button")return e.isEditedMessage?C.chat.editMessageButton:C.chat.sendMessageButton;if(e.type==="enter")return e.isEditedMessage?C.chat.editMessageEnter:C.chat.sendMessageEnter}function yt(e){var t=g.resolve(s.serviceLocator.ACTION_TELEMETRY),n=gt(e);t.recordAction(n)}function bt(){yt({type:"button",isEditedMessage:U}),Et()}function wt(){yt({type:"enter",isEditedMessage:U}),Et()}function Et(){if(!st())return;if(!U&&!at())return;U?vt():pt(),U=null,mt()}function St(){bt(),Ct(!0)}function xt(e){if(U||at())e.preventDefault(),wt()}function Tt(){var e=i.conversationModel.historyService.activityItems().reverse(),t=I.personsAndGroupsManager.mePerson.id();return e.filter(function(e){return e.sender&&e.sender.id()===t})[0]}function Nt(e){X.chatInput=e,H.dispatchEvent(a.textarea.CHANGED,e,H.DIRECTION.PARENT),E.publish(a.textarea.HAS_INPUT,!0)}function Ct(){H.chatInputFocus(!0)}function kt(){if(!H.hasChatCapability())return;H.handleBlur(),Ct()}function Lt(){k.setTimeout(H.handleFocus,5e3)}function At(e){return!T.isCarriageReturn(e)&&!T.isNewLine(e)&&!T.isWhiteSpace(e)}function Ot(){var e=H.hasChatCapability()?"area_text_insertText":"area_text_agent_insertText";return Mt()&&(e="invite_free_respond_request"),w.fetch({key:e})}function Mt(){function e(){return r.find(K(),function(e){return e.type()===_.activityType.ContactRequestIncomingInviteFree})}return e()&&g.resolve(s.serviceLocator.FEATURE_FLAGS).isFeatureOn(s.featureFlags.INVITE_FREE_IMPLICIT_INCOMING_CONTACT_REQUEST)}function _t(e){var t=r.find(e.sourceTab.packs,function(t){return t.items.some(function(t){return t===e.item})});G.push({item:e.item,type:e.sourceTab.id==="mru"?s.telemetry.pes.source.RECENTS:s.telemetry.pes.source.ROSTER,tabIndex:e.sourceTab.index,tabName:e.sourceTab.title,section:t&&t.isFeatured?s.telemetry.pes.section.FEATURED:s.telemetry.pes.section.REGULAR})}function Dt(e){return e.preventDefault(),e.stopPropagation(),h.getBrowserInfo().isIeEngine&&(e.returnValue=!1),!1}function Pt(e){var t=d.unwebify(e);return t=l.build(n).getNodeTextContent(t),t=d.unboxHrefContent(t),t}var H=this,B=i.conversationModel,j=B&&B.chatService.sendMessage,F=i.sendMessage||j,I=n.get(),q=I.translatorService,R=-1,U=null,z=!1,W,X,V,$,J=nt()?b.newObservableProperty(i.conversationModel.participantsCount):v.observable(1),K=nt()?b.newObservableCollection(i.conversationModel.historyService.activityItems):v.observableArray(),Q="active",G=[],Y=g.resolve(s.serviceLocator.FEATURE_FLAGS),Z=Y.isFeatureOn(s.featureFlags.TRANSLATOR_SENDING_ENABLED),et,tt;H.init=function(){nt()?X=y.forModel(i.conversationModel):X={chatInput:null},H.conversationModel=i.conversationModel,H.isEnabled=i.isEnabled,H.isServiceEnabled=i.isServiceEnabled,H.hasChatCapability=i.hasChatCapability,H.getSelectionStart=e.getSelectionStart,H.setBlurAndFocus=kt,H.messageMaxLength=s.textarea.MAX_LENGTH,H.topicViewModel=N.build(i.conversationModel),$=H.isEnabled.subscribe(function(e){e&&p.execute(kt)}),H.messageBody=v.observable(X.chatInput||""),H.label=v.pureComputed(function(){return J()<2?w.fetch({key:"label_text_insertText_oneToOne",params:{displayName:H.topicViewModel.topic()}}):w.fetch({key:"label_text_insertText_group",params:{displayName:H.topicViewModel.topic(),participantsCount:J()}})}),H.placeholder=v.computed(Ot),it(),V=H.messageBody.subscribe(Nt),H.registerEvent(a.textarea.SUBMIT_AND_FOCUS,St),H.registerEvent(a.emoticonPicker.EMOTICON_SELECTED,H.insertAtCursor),H.registerEvent(f.EVENTS.CALL_SCREEN_CLOSE,Ct),H.registerEvent(a.message.QUOTE,H.quoteMessageText),H.registerEvent(a.message.EDIT,H.requestEditMessageText),H.registerEvent(a.expressionPicker.CLOSE_REQUEST,kt),H.registerEvent(a.shareControl.SHARE_CONTROL_HIDE,Ct),E.subscribe(s.apiUIEvents.SWX_TIMELINE_LOADED,Lt),E.subscribe(a.newConversation.CANCELLED,Ct),E.subscribe(a.navigation.FRAGMENT_LOADED,kt),E.subscribe(a.navigation.LEAVE_EDIT_MODE,Ct),E.subscribe(a.expressionPicker.ITEM_SEND_REQUEST,H.insertAtCursor),H.dispatchEvent(a.textarea.INITIALIZATION_COMPLETE,H,H.DIRECTION.PARENT),kt()},H.dispose=function(){k.clearTimeout(W),E.unsubscribe(s.apiUIEvents.SWX_TIMELINE_LOADED,Lt),E.unsubscribe(a.newConversation.CANCELLED,Ct),E.unsubscribe(a.navigation.LEAVE_EDIT_MODE,Ct),E.unsubscribe(a.navigation.FRAGMENT_LOADED,kt),E.unsubscribe(a.expressionPicker.ITEM_SEND_REQUEST,H.insertAtCursor),$.dispose(),V.dispose(),H.placeholder.dispose(),H.topicViewModel.dispose()},H.insertAtCursor=function(t,n){var r,s,o,u,a=t.item;if(a.type!=="emoticon"||t.conversation!==i.conversationModel)return;_t(t),r=n||e.getSelectionStart(),s=H.messageBody(),o=a.shortcut+" ",u=T.inject(s,o,r),H.messageBody(u),e.setCursorAt(r+o.length),kt()},H.handleKeyDown=function(e,t){if(ut(a.textarea.KEY_DOWN,t))return!1;var n=t.keyCode||t.which;return n===u.UP&&e.messageBody()===""&&e.requestEditMessageText(),n===u.ESCAPE&&e.messageBody()!==""&&(ot(),mt(),t.stopPropagation()),!0},H.handleInput=function(){H.messageBody().length!==R&&it(),H.messageBody().length===0&&(E.publish(a.textarea.HAS_INPUT,!1),ot()),H.dispatchEvent(a.textarea.INPUT,{viewModel:H,view:e},H.DIRECTION.CHILD)},H.handleKeyPress=function(e,t){if(ut(a.textarea.KEY_PRESS,t))return!1;var n=t.keyCode||t.which;return n===u.ENTER&&!t.shiftKey?xt(t):z||rt(),!0},H.onFocus=function(){i.chatInputEl.addClass(Q)},H.onBlur=function(){i.chatInputEl.removeClass(Q),e.updateSizing()},H.onBeforePaste=function(e,t){return Dt(t)},H.onPaste=function(t,r){function w(e){e.name=P,o.push(e)}function E(e){d?At(e)&&(m+=e,v--,d=!1):(m+=e,v--,T.isNewLine(e)&&(d=!0))}var i=r.clipboardData||k.clipboardData,o=[],u=!!k.clipboardData,a=Y.isFeatureOn(s.featureFlags.FILE_PASTE_ENABLED),f=H.conversationModel.fileTransferService.send.enabled(),l=a&&n.get().personsAndGroupsManager.mePerson.preferences(s.userSettings.preferences.FILE_PASTE).value(),c=a&&f&&l,h,d,v,m,g,y,b;r.originalEvent&&(i=i||r.originalEvent.clipboardData),h=i.getData("Text");if(!h&&c){u?Array.prototype.forEach.call(i.files,function(e){w(e)}):Array.prototype.some.call(i.types,function(e){return e==="Files"})&&Array.prototype.forEach.call(i.items,function(e){var t=e.getAsFile();t&&w(t)});if(o.length)return H.conversationModel.fileTransferService.send(o),Dt(r)}h=i.getData("Text"),d=!0,m="",g=H.messageBody(),y=e.getSelectionStart(),b=e.getSelectionEnd(),v=H.messageMaxLength-g.length+b-y;for(var S=0;S<h.length&&v>0;S++)E(h[S]);return H.messageBody(T.inject(g,m,y,b)),p.execute(function(){e.setCursorAt(y+m.length)}),it(),Dt(r)},H.chatInputFocus=v.observable(!1),H.handleFocus=function(){return M.isAnyElementFocused()||p.execute(function(){H.chatInputFocus(!0)}),!0},H.handleBlur=function(){H.chatInputFocus(!1)},H.quoteMessageText=function(t){var n=t.sender.displayName(),r=c.formatTimestamp(t.timestamp()),i=d.unboxHrefContent(t.text()),s=D.findMatchingTranslation(t.translations,B._translatorSettings),o=Z&&s?Pt(s):i,u="["+r+"] "+n+": "+o+" \n \n <<< ";ot(),H.messageBody(u),it(),p.execute(e.setCaretToEnd)},H.requestEditMessageText=function(t){if(!nt())return;var n=i.conversationModel.historyService.activityItems();if(!n.length)return;t=t||Tt();if(!t||t.type()===_.activityType.SystemMessage)return;if(t.html&&t.html.set.enabled()&&t.text){var r=d.compactHtml(t.html()),s=D.findMatchingTranslation(t.translations,B._translatorSettings),o=Z&&s?s:r;o=Pt(o),H.messageBody(o),U=t,it(),p.execute(e.setCaretToEnd),e.editing(!0)}}}var t=e("services/telemetry/logging/perf/main"),n=e("cafe/applicationInstance"),r=e("lodash-compat"),i=e("utils/common/eventMixin"),s=e("constants/common"),o=e("experience/settings"),u=e("constants/keys"),a=s.events,f=e("constants/calling"),l=e("utils/common/encoder"),c=e("utils/chat/dateTime"),h=e("browser/detect"),p=e("utils/common/async"),d=e("utils/chat/messageSanitizer"),v=e("vendor/knockout"),m=s.isTyping,g=e("services/serviceLocator"),y=e("utils/chat/conversationCache"),b=e("utils/common/cafeObservable"),w=e("swx-i18n").localization,E=e("services/pubSub/pubSub"),S=e("services/pes/constants"),x=e("ui/modelHelpers/personHelper"),T=e("swx-utils-common").stringUtils,N=e("ui/viewModels/chat/conversationTopic"),C=e("ui/telemetry/actions/actionNames"),k=e("browser/window"),L=e("ui/telemetry/telemetryClient"),A=e("telemetry/chat/pes"),O=e("telemetry/chat/telemetryEnumerator"),M=e("utils/common/applicationFocusManager"),_=e("swx-enums"),D=e("utils/chat/translatorHelper"),P="fileFromClipboard";return r.assign(H.prototype,i),H}),define("jsviews/chat/textarea",["require","browser/dom"],function(e){function s(e,s){function a(){try{var e=u.placeholder,t=window.getComputedStyle(u),n=document.createElement("canvas").getContext("2d");return n.font=t.fontSize+" "+t.fontFamily,n.measureText(e).width>parseInt(t.width)?2*parseInt(t.lineHeight):parseInt(t.lineHeight)}catch(r){return 0}}var o=this,u=t.getElement("textarea",e);s=t.getElement(s),o.updateSizing=function(){var e;u.style.height="30px",e=u.value===""?a():u.scrollHeight,e=Math.max(r,Math.min(e,i)),u.style.height=e+"px"},o.setCaretToEnd=function(){u.focus();if(typeof u.selectionStart=="number"){u.selectionStart=u.selectionEnd=u.value.length;return}if(typeof u.createTextRange!="undefined"){var e=u.createTextRange();e.collapse(!1),e.select()}},o.getSelectionStart=function(){return u.selectionStart},o.getSelectionEnd=function(){return u.selectionEnd},o.setCursorAt=function(e){u.selectionStart=e,u.selectionEnd=e},o.editing=function(e){e?s.addClass(n):s.removeClass(n)}}var t=e("browser/dom"),n="EDITING",r=30,i=180;return s}),define("text!views/chat/textarea.html",[],function(){return"<swx-suggestion-list></swx-suggestion-list>\r\n\r\n<textarea data-bind=\"value: messageBody, enable: isEnabled, css: {hide: !isServiceEnabled()},\r\n    valueUpdate: ['afterkeydown','propertychange','input'],\r\n    event: {\r\n        keypress: handleKeyPress,\r\n        keydown: handleKeyDown,\r\n        input: handleInput,\r\n        focus: onFocus,\r\n        blur: onBlur,\r\n        paste: onPaste,\r\n        beforepaste: onBeforePaste },\r\n    hasFocus: chatInputFocus,\r\n    l10n_attr: {'placeholder': placeholder},\r\n    attr: { 'aria-label': label, 'maxlength': messageMaxLength}\" name=\"messageInput\" class=\"inputField fontSize-p\"></textarea>\r\n"}),define("ui/components/chat/textarea",["require","exports","module","vendor/knockout","ui/viewModels/chat/textarea","jsviews/chat/textarea","constants/components","text!views/chat/textarea.html"],function(e,t){function s(e,t){var s=t.element,o=new i(s,e.chatInputEl),u=new r(o,e),a=n.dataFor(s);return u.setContext(a),u.init(),u}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/textarea"),i=e("jsviews/chat/textarea");t.name=e("constants/components").chat.TEXTAREA,t.template=e("text!views/chat/textarea.html"),t.viewModel={createViewModel:s}}),define("telemetry/chat/menuItemTelemetry",["require","exports","module","constants/common","experience/settings","utils/common/styleModeHelper","services/serviceLocator","ui/telemetry/telemetryClient"],function(e,t){function f(){function l(){e.data={narrow:t,button:t,ordinal:t,navigationMenuIconsEnabled:t}}function c(e){for(var t in e)e.hasOwnProperty(t)&&!(typeof e[t]=="string"||e[t]instanceof String)&&(e[t]=e[t]+"");return e}var e=this,t=n.telemetry.NOT_AVAILABLE,f=u.resolve(n.serviceLocator.FEATURE_FLAGS);e.publish=function(u){e.data.narrow=o.get().currentMode()===s.NARROW,e.data.button=u.id||t,e.data.ordinal=u.ordinal||t,e.data.navigationMenuIconsEnabled=f.isFeatureOn(n.featureFlags.NAVIGATION_MENU_ICONS_ENABLED);var h=i.TYPE,p=c(e.data);a.get().sendEvent(r.telemetry.uiTenantToken,h,p),l()},l()}var n=e("constants/common"),r=e("experience/settings"),i=n.telemetry.menuItemClicked,s=n.styleMode,o=e("utils/common/styleModeHelper"),u=e("services/serviceLocator"),a=e("ui/telemetry/telemetryClient");t.build=function(){return new f}}),define("ui/viewModels/chat/menuItem",["require","exports","module","lodash-compat","vendor/knockout","usertiming","utils/common/eventHelper","constants/common","services/serviceLocator","experience/settings","ui/telemetry/telemetryClient","telemetry/chat/menuItemTelemetry"],function(e,t){function c(e){var t=this,n=h(e),c=l.build(),p=u.resolve(o.serviceLocator.FEATURE_FLAGS);t.id=n.id?"menuItem-"+n.id:n.id,t.icon=n.icon,t.text=n.text,t.page=n.navigation.page,t.isActive=r.observable(!1),t.isDisabled=n.isDisabled?n.isDisabled:r.observable(!1),t.isNavigationMenuIconsEnabled=p.isFeatureOn(o.featureFlags.NAVIGATION_MENU_ICONS_ENABLED),t.onKeyDown=function(e,n){var r=s.isActivation(n);return r&&t.onClick(),!r},t.onClick=function(){var r=n.telemetry,s=u.resolve(o.serviceLocator.PUBSUB),l=u.resolve(o.serviceLocator.ACTION_TELEMETRY);r.uiAction&&l.recordAction(r.uiAction),r.perfMarker&&i.mark(r.perfMarker),r.event&&f.get().sendEvent(a.uiTenantToken,r.event.name,r.event.data),e.ordinal=t.ordinal,c.publish(e),t.isActive(!0),s.publish(o.events.navigation.NAVIGATE,e.navigation)},t.getTitleText=function(){if(t.isNavigationMenuIconsEnabled)return t.text}}function h(e){var t="";return n.merge({id:t,icon:t,text:t,navigation:{page:t,origin:t},telemetry:{uiAction:t,perfMarker:t,event:t}},e)}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("usertiming"),s=e("utils/common/eventHelper"),o=e("constants/common"),u=e("services/serviceLocator"),a=e("experience/settings").telemetry,f=e("ui/telemetry/telemetryClient"),l=e("telemetry/chat/menuItemTelemetry");t.build=function(e){return new c(e)}}),define("ui/viewModels/chat/sidebar",["require","vendor/knockout","swx-i18n","constants/components","constants/common","cafe/applicationInstance","ui/telemetry/actions/actionNames","services/serviceLocator","ui/viewModels/chat/menuItem","ui/telemetry/actions/actionSources"],function(e){function h(){function g(){e.itemsDisabled(!1)}function y(){e.itemsDisabled(!0)}function b(t){e.isNotificationsCenterActive(t),t&&e.isSearchActive(!1)}function w(t){var n={source:f.search.reset.content},r=e.userSettingsMenuItem();e.items.forEach(function(e){e.isActive(e.page===t.page),v.publish(c.search.RESET,n)}),r.page!==t.page&&r.isActive(!1)}function E(){e.isSearchActive(!1)}function S(t){t!==""&&e.isSearchActive(!0)}function x(){var t=[];return e.isNavigationMenuIconsEnabled?(t.push(a.build(N())),d&&t.push(a.build(C())),p&&t.push(a.build(k())),e.isUserSettingsEnabled&&t.push(a.build(L())),t.push(a.build(T()))):e.isSidebarInAlternativeLayout?(t=[a.build(T()),a.build(N())],d&&t.push(a.build(C())),p&&t.push(a.build(k()))):(t=[a.build(N())],d&&t.push(a.build(C())),t.push(a.build(T())),p&&t.push(a.build(k()))),t.forEach(function(e,t){e.ordinal=t+1}),t}function T(){return{navigation:{page:r.chat.NEW_CONVERSATION,origin:l.NEW_CHAT_DUMMY},id:"newChat",icon:"add",text:n.fetch({key:"button_text_new"}),isDisabled:e.itemsDisabled}}function N(){return{navigation:{page:r.people.CONTACTS_PAGE,origin:l.CONTACTS_PAGE},telemetry:{uiAction:o.contacts.openPage,perfMarker:i.telemetry.performanceMarks.CONTACTS.PAGE.OPENED},id:"contacts",icon:"skypeAddressBook",text:n.fetch({key:"contactPage_text_menuLink"}),isDisabled:e.itemsDisabled}}function C(){return{navigation:{page:r.people.DISCOVER_AGENTS_PAGE,origin:l.DISCOVER_AGENTS_PAGE},telemetry:{uiAction:o.discoverAgents.openPage,perfMarker:i.telemetry.performanceMarks.DISCOVER_AGENTS.PAGE.OPENED},id:"discoverAgents",icon:"botAdd",text:n.fetch({key:"button_text_discover_agents"}),isDisabled:e.itemsDisabled}}function k(){return{navigation:{page:r.calling.SKYPEOUT_PAGE,origin:l.SKYPEOUT_PAGE},telemetry:{uiAction:o.skypeOut.openPage,perfMarker:i.telemetry.performanceMarks.SKYPEOUT.PAGE.OPENED,event:{name:i.telemetry.pstn.eventName.PSTN_BUTTON_CLICKED,data:{}}},id:"dialpad",icon:"dialpad",text:n.fetch({key:"button_text_dialpad"}),isDisabled:e.itemsDisabled}}function L(){return{navigation:{page:r.userSettings.USER_SETTINGS_PAGE,origin:l.SKYPEOUT_PAGE},telemetry:{uiAction:o.userSettings.openPage,perfMarker:i.telemetry.performanceMarks.USER_SETTINGS.PAGE.OPENED},id:"userSettings",icon:"settings",text:n.fetch({key:"settings_page_text_header"}),isDisabled:e.itemsDisabled}}var e=this,h=u.resolve(i.serviceLocator.FEATURE_FLAGS),p=h.isFeatureOn(i.featureFlags.PSTN_ENABLED),d=h.isFeatureOn(i.featureFlags.AGENTS_DISCOVERABLE),v=u.resolve(i.serviceLocator.PUBSUB),m=s.get().personsAndGroupsManager.mePerson.preferences();e.items=[],e.itemsDisabled=t.observable(!0),e.userSettingsMenuItem=t.observable(),e.isSearchActive=t.observable(!1),e.isNotificationsCenterActive=t.observable(!1),e.isNavigationMenuIconsEnabled=h.isFeatureOn(i.featureFlags.NAVIGATION_MENU_ICONS_ENABLED),e.isNotificationsCenterEnabled=h.isFeatureOn(i.featureFlags.NOTIFICATIONS_CENTER),e.isSidebarInAlternativeLayout=h.isFeatureOn(i.featureFlags.ALTERNATIVE_SIDEBAR_LAYOUT_ENABLED),e.isUserSettingsEnabled=h.isFeatureOn(i.featureFlags.USER_SETTINGS_ENABLED)&&!!m.length,e.hideRecents=t.computed(function(){return e.isSearchActive()||e.isNotificationsCenterActive()}),e.init=function(){v.subscribe(c.search.RESET,E),v.subscribe(c.search.QUERY_CHANGED,S),v.subscribe(c.navigation.NAVIGATE,w),v.subscribe(c.navigation.NOTIFICATIONS_CENTER,b),v.subscribe(i.apiUIEvents.SWX_TIMELINE_LOADED,g),v.subscribe(i.apiUIEvents.SWX_ON_SIGN_OUT,y),Array.prototype.push.apply(e.items,x()),e.userSettingsMenuItem(a.build(L()))},e.dispose=function(){v.unsubscribe(c.search.RESET,E),v.unsubscribe(c.search.QUERY_CHANGED,S),v.unsubscribe(c.navigation.NAVIGATE,w),v.unsubscribe(c.navigation.NOTIFICATIONS_CENTER,b),v.unsubscribe(i.apiUIEvents.SWX_TIMELINE_LOADED,g),v.unsubscribe(i.apiUIEvents.SWX_ON_SIGN_OUT,y),e.hideRecents.dispose()}}var t=e("vendor/knockout"),n=e("swx-i18n").localization,r=e("constants/components"),i=e("constants/common"),s=e("cafe/applicationInstance"),o=e("ui/telemetry/actions/actionNames"),u=e("services/serviceLocator"),a=e("ui/viewModels/chat/menuItem"),f=e("ui/telemetry/actions/actionSources"),l=i.telemetry.historyLoadOrigin,c=i.events;return h}),define("text!views/chat/sidebar.html",[],function(){return'<!-- ko if: isSidebarInAlternativeLayout  -->\r\n    <div class="navigation beforeSearch">\r\n        <div role="menubar" data-bind="foreach: items">\r\n            <swx-menu-item params="viewModel: $data"></swx-menu-item>\r\n        </div>\r\n        <!-- ko if: isNotificationsCenterEnabled -->\r\n        <swx-notifications-menu-item params="isDisabled: itemsDisabled"></swx-notifications-menu-item>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- ko ifnot: isNotificationsCenterActive -->\r\n    <div class="search afterMenuItems" data-bind="css: {active: isSearchActive}">\r\n        <div class="splitter"></div>\r\n        <swx-search-input></swx-search-input>\r\n        <swx-search-results></swx-search-results>\r\n    </div>\r\n    <!-- /ko -->\r\n<!-- /ko -->\r\n\r\n<!-- ko ifnot: isSidebarInAlternativeLayout  -->\r\n<div class="search beforeMenuItems" data-bind="css: {active: isSearchActive}">\r\n    <swx-search-input></swx-search-input>\r\n    <div class="splitter"></div>\r\n    <swx-search-results></swx-search-results>\r\n</div>\r\n<div class="navigation afterSearch" data-bind="css: {hide: isSearchActive}">\r\n    <div role="menubar" data-bind="foreach: items, keyboardNavigation: { itemSelector: \'a\' }, css: { navigationMenuIcons: isNavigationMenuIconsEnabled }">\r\n        <swx-menu-item params="viewModel: $data"></swx-menu-item>\r\n    </div>\r\n    <!-- ko if: isNotificationsCenterEnabled -->\r\n    <swx-notifications-menu-item params="isDisabled: itemsDisabled"></swx-notifications-menu-item>\r\n    <!-- /ko -->\r\n</div>\r\n<!-- /ko -->\r\n\r\n<swx-recents params="buttonsDisabled: itemsDisabled" class="timeline" data-bind="css: {hide: hideRecents}"></swx-recents>\r\n<!-- ko if: isUserSettingsEnabled && !isNavigationMenuIconsEnabled -->\r\n<div class="navigation afterTimeline" data-bind="keyboardNavigation: { itemSelector: \'a\' }">\r\n    <swx-menu-item params="viewModel: userSettingsMenuItem"></swx-menu-item>\r\n</div>\r\n<!-- /ko -->\r\n\r\n<!-- ko if: isNotificationsCenterEnabled && isNotificationsCenterActive -->\r\n<swx-notifications></swx-notifications>\r\n<!-- /ko -->\r\n\r\n'}),define("ui/components/chat/sidebar",["require","exports","module","ui/viewModels/chat/sidebar","constants/components","text!views/chat/sidebar.html"],function(e,t){function r(){var e=new n;return e.init(),e}var n=e("ui/viewModels/chat/sidebar");t.name=e("constants/components").chat.SIDEBAR,t.template=e("text!views/chat/sidebar.html"),t.viewModel={createViewModel:r}}),define("text!views/chat/contactPill.html",[],function(){return'<span class="tile" data-bind="css: statusClassName">\r\n    <span class="tileName presence square">\r\n        <h4 data-bind="text: displayName"></h4>\r\n    </span>\r\n</span>\r\n'}),define("ui/components/chat/contactPill",["require","exports","module","ui/viewModels/people/contact","ui/viewModels/people/contactBuilder","constants/components","text!views/chat/contactPill.html"],function(e,t){function i(e){if(e&&typeof e.person=="object")return e.person instanceof n?e.person:r.build(e.person);throw new Error('missing parameter: "person"')}var n=e("ui/viewModels/people/contact"),r=e("ui/viewModels/people/contactBuilder");t.name=e("constants/components").chat.CONTACT_PILL,t.template=e("text!views/chat/contactPill.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/contactCard",["require","lodash-compat","vendor/knockout","swx-i18n","ui/telemetry/actions/actionSources","utils/common/cafeObservable","swx-enums","constants/common","utils/common/eventHelper","utils/common/eventMixin","ui/contextMenu/contextMenu","services/serviceLocator","ui/contextMenu/items/all","ui/modelHelpers/personHelper","ui/viewModels/people/contactBuilder"],function(e){function m(e){function N(e){var t=document.createEvent("MouseEvents"),n=e.target.getBoundingClientRect();return t.initMouseEvent("contextmenu",!0,!1,window,0,0,0,n.right,n.top,!1,!1,!0,!1,2,null),e.target.dispatchEvent(t),a.swallow(e),e.stopPropagation(),t}var f=e.participant,m=s.newObservableProperty(e.model.participants.remove.enabled),b=d.build(f.person),w=this,E=s.newObservableProperty(f.role),S=c.resolve(u.serviceLocator.FEATURE_FLAGS),x=S.isFeatureOn(u.featureFlags.HIDE_USER_ROLE),T=n.computed(function(){return f.isAnonymous()?v.GUEST:E()===o.participantRole.Leader?v.ADMIN:v.ATTENDEE});t.merge(w,b),w.role=n.computed(function(){var e;return x?"":T()===v.ATTENDEE?"":(e="header_text_"+T(),T()===v.ADMIN&&g()&&(e=y(e)),r.fetch({key:e}))}),w.chevronAriaLabel=n.computed(function(){return r.fetch({key:"accessibility_groupProfile_"+T()+"Menu",params:{participantName:w.displayName()}})}),w.isMenuDisabled=n.computed(function(){return e.model.selfParticipant.isAnonymous()||f.isAnonymous()&&!m()}),w.dispose=function(){b.dispose(),T.dispose(),w.role.dispose(),w.chevronAriaLabel.dispose(),w.isMenuDisabled.dispose()},w.onMenuHandlerKeydown=function(e,t){var n,r=a.isActivation(t);return r&&(n=N(t),w.menuHandler(e,n)),!r},w.menuHandler=function(t,n){var r=[],s={source:i.conversation.groupRoster};f.isAnonymous()||((S.isFeatureOn(u.featureFlags.PSTN_ENABLED)||!p.isPstn(f.person))&&r.push(new h.OpenConversationWithPersonMenuItem(f.person)),r.push(new h.ViewPersonProfileMenuItem(f.person,u.telemetry.historyLoadOrigin.ROSTER,s))),m()&&r.push(new h.RemoveParticipantMenuItem(e.model,e.participant)),l.show(r,n)}}function g(){return c.resolve(u.serviceLocator.FEATURE_FLAGS).isFeatureOn(u.featureFlags.USE_BUSINESS_WORDING)}function y(e){return e+"_4b"}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-i18n").localization,i=e("ui/telemetry/actions/actionSources"),s=e("utils/common/cafeObservable"),o=e("swx-enums"),u=e("constants/common"),a=e("utils/common/eventHelper"),f=e("utils/common/eventMixin"),l=e("ui/contextMenu/contextMenu"),c=e("services/serviceLocator"),h=e("ui/contextMenu/items/all"),p=e("ui/modelHelpers/personHelper"),d=e("ui/viewModels/people/contactBuilder"),v={GUEST:"guest",ADMIN:"admin",ATTENDEE:"attendee"};return t.assign(m.prototype,f),m}),define("text!views/chat/contactCard.html",[],function(){return'<swx-avatar-deprecated params="avatar: avatar, status: statusClassName" class="avatar"></swx-avatar-deprecated>\r\n<div class="text">\r\n    <span class="role fontSize-p smaller" data-bind="text: role"></span>\r\n    <span class="tile swxTileName">\r\n        <span class="tileName">\r\n            <span role="button" class="navigation-item">\r\n                <h4 data-bind="text: displayName"></h4>\r\n                <a role="listitem" class="menu iconfont chevronDown btnOutline" data-bind="event: {keydown: onMenuHandlerKeydown, click: menuHandler }, css: { hide: isMenuDisabled }, attr: {\'aria-label\': chevronAriaLabel}"></a>\r\n            </span>\r\n        </span>\r\n    </span>\r\n    <span class="tile">\r\n        <span class="tileMessage circle">\r\n            <div class="message">\r\n                <p data-bind="html: displayMessage"></p>\r\n            </div>\r\n        </span>\r\n    </span>\r\n</div>\r\n\r\n'}),define("ui/components/chat/contactCard",["require","exports","module","vendor/knockout","ui/viewModels/chat/contactCard","constants/components","text!views/chat/contactCard.html"],function(e,t){function i(e,t){var i=new r(e);return i.setContext(n.dataFor(t.element)),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/contactCard");t.name=e("constants/components").chat.CONTACT_CARD,t.template=e("text!views/chat/contactCard.html"),t.viewModel={createViewModel:i}}),define("text!views/chat/timeline/menuItem.html",[],function(){return'<a href="#" role="menuitem" class="navItem"\r\n   data-bind="css: {active: isActive, icon: isNavigationMenuIconsEnabled}, visible: !isDisabled(), event: {click: onClick, keydown: onKeyDown}, attr: { id: id }">\r\n        <span class="icon">\r\n            <span class="iconfont" data-bind="css: icon, attr: { title: getTitleText() }"></span>\r\n        </span>\r\n        <span class="text">\r\n            <h4 data-bind="text: text"></h4>\r\n        </span>\r\n</a>\r\n'}),define("ui/components/chat/menuItem",["require","exports","module","text!views/chat/timeline/menuItem.html","constants/components"],function(e,t){function r(e){return e.viewModel}var n=e("text!views/chat/timeline/menuItem.html");t.name=e("constants/components").chat.MENU_ITEM,t.viewModel={createViewModel:r},t.template=n}),define("utils/common/outsideClickHandler",["require","exports","module","lodash-compat","browser/dom","browser/document","constants/common","constants/cssClasses","constants/keys"],function(e,t){function f(e){function t(t){var n=!!r.getParentWithClass(e.target,t.name);n||t.callback()}if(!a)return;a.forEach(t)}function l(){return!!r.getElement("."+o.contextMenu.CONTEXT_MENU)}function c(e){var t=e.which||e.keyCode;if(!a||t!==u.ESCAPE||l())return;a.forEach(function(e){e.callback()}),e.stopPropagation()}function h(e){n.remove(a,function(t){return t.name===e})}var n=e("lodash-compat"),r=e("browser/dom"),i=e("browser/document"),s=e("constants/common"),o=e("constants/cssClasses"),u=e("constants/keys"),a=null;t.add=function(e,t){if(!e)throw new Error("className is mandatory");if(!t)throw new Error("handler is not provided");a=a||[],h(e),a.length===0&&(i.body.addEventListener(s.events.browser.CLICK,f,!0),i.body.addEventListener(s.events.browser.KEYDOWN,c,!0)),a.push({name:e,callback:t})},t.remove=function(e){if(!e)throw new Error("className is mandatory");h(e);if(a===null||a.length>0)return;a=null,i.body.removeEventListener(s.events.browser.CLICK,f,!0),i.body.removeEventListener(s.events.browser.KEYDOWN,c,!0)},t._getListenters=function(){return a},t._dispose=function(){a=null,i.body.removeEventListener(s.events.browser.CLICK,f,!0),i.body.removeEventListener(s.events.browser.KEYDOWN,c,!0)}}),define("ui/telemetry/chat/guestActionsInHeader",["require","exports","module","constants/common","experience/settings","cafe/applicationInstance","usertiming","ui/telemetry/telemetryClient","ui/modelHelpers/personHelper"],function(e,t){function h(){function t(e){if(!n())return;var t={ttp:c(),participantsNumber:e.participantsCount,totalMessagesCount:e.totalMessagesCount,userMessagesCount:e.userMessagesCount,cta:e.cta};o.get().sendEvent(r.telemetry.uiTenantToken,"chat_guest_headerActions",t)}function n(){return u.isGuest(i.get().personsAndGroupsManager.mePerson)}function c(){s.mark(f.CONVERSATION.TTP),s.measure(l.EXPERIENCE.TTL,f.EXPERIENCE.TTL_START,f.CONVERSATION.TTP);var e=s.getEntriesByName(l.EXPERIENCE.TTL),t=e&&e.length?e[0].duration:"undefined";return s.clearMeasures(l.EXPERIENCE.TTL),s.clearMarks(f.CONVERSATION.TTP),t}var e=this;return e.onProfileToggled=function(e){e.cta=a.cta.PROFILE_TOGGLED,e.telemetryItem===a.telemetryItem.AVATAR?e.cta=1:e.telemetryItem===a.telemetryItem.TOPIC?e.cta=e.groupProfileExpanded?3:2:e.telemetryItem===a.telemetryItem.CHEVRON_DOWN?e.cta=4:e.telemetryItem===a.telemetryItem.CHEVRON_UP&&(e.cta=5),t(e)},e.onCopyLinkClicked=function(e){e.cta=a.cta.COPY_LINK,e.parent===a.parent.GROUP_PROFILE_VIEW_MODEL?e.cta=6:e.parent===a.parent.HEADER_VIEW_MODEL&&(e.cta=7),t(e)},e.onEmailLinkClicked=function(e){e.cta=a.cta.EMAIL_LINK,e.parent===a.parent.GROUP_PROFILE_VIEW_MODEL?e.cta=8:e.parent===a.parent.HEADER_VIEW_MODEL&&(e.cta=9),t(e)},e.onMediaButtonClicked=function(e){e.cta=10,t(e)},e}var n=e("constants/common"),r=e("experience/settings"),i=e("cafe/applicationInstance"),s=e("usertiming"),o=e("ui/telemetry/telemetryClient"),u=e("ui/modelHelpers/personHelper"),a=n.telemetry.guestActionsInHeader,f=n.telemetry.performanceMarks,l=n.telemetry.measurements,c;t.get=function(){return c||(c=new h),c}}),define("ui/viewModels/chat/conversation/callButtonViewModel",["require","exports","module","vendor/knockout","swx-enums","cafe/applicationInstance","swx-i18n","constants/common","constants/calling","ui/modelHelpers/personHelper","services/serviceLocator","utils/common/cafeObservable","ui/modelHelpers/conversationHelper","ui/viewModels/calling/helpers/callingFacade","ui/controls/calling/sounds","ui/telemetry/actions/actionNames","ui/telemetry/chat/guestActionsInHeader","ui/viewModels/chat/conversationActivity","ui/modelObservers/agentAuthorizationObserver"],function(e,t){var n=e("vendor/knockout"),r=e("swx-enums"),i=e("cafe/applicationInstance"),s=e("swx-i18n").localization,o=e("constants/common"),u=e("constants/calling"),a=e("ui/modelHelpers/personHelper"),f=e("services/serviceLocator"),l=e("utils/common/cafeObservable"),c=e("ui/modelHelpers/conversationHelper"),h=e("ui/viewModels/calling/helpers/callingFacade"),p=e("ui/controls/calling/sounds"),d=e("ui/telemetry/actions/actionNames"),v=e("ui/telemetry/chat/guestActionsInHeader"),m=e("ui/viewModels/chat/conversationActivity"),g=e("ui/modelObservers/agentAuthorizationObserver"),y=function(e){function A(t){O(),i.get().conversationsManager.conversations.add(e),h.placeCall(e,t,"startCallButton"),p.playOnce(p.KEYS.CALL_DIALING)}function O(){if(!e.isGroupConversation()&&y.isFeatureOn(o.featureFlags.PSTN_ENABLED)){var t=e.participants(0);t.audio.endpoint(t.person.id())}}function M(){return{participantsCount:t.conversationModel.participants.size(),userMessagesCount:t.conversationModel.historyService.activityItems().filter(function(e){return e.type()===r.activityType.TextMessage&&a.isMePerson(e.sender)}).length,totalMessagesCount:t.conversationModel.historyService.activityItems().length}}function _(){var e=!1,n=t.conversationModel.participants().length,r;for(var i=0;i<n&&!e;i++)r=t.conversationModel.participants()[i].person,r.capabilities.audio.get(),e=!r.isBlocked()&&r.capabilities.audio();t.hasAudioCapability(n===0||e)}function D(){var e=!1,n=t.conversationModel.participants().length,r;for(var i=0;i<n&&!e;i++)r=t.conversationModel.participants()[i].person,r.capabilities.video.get(),e=!r.isBlocked()&&r.capabilities.video();t.hasVideoCapability(n===0||e)}function P(){t.isOneToOneConversation()?(C=t.participantPerson(),C.capabilities.audio.changed(_)):_()}function H(){t.isOneToOneConversation()?(k=t.participantPerson(),k.capabilities.video.changed(D)):D()}function B(){t.isOneToOneConversation()&&(N=t.participantPerson(),N.isBlocked.changed(_),N.isBlocked.changed(D))}function j(){C&&C.capabilities.audio.changed.off(_),k&&k.capabilities.video.changed.off(D)}function F(){N&&(N.isBlocked.changed.off(_),N.isBlocked.changed.off(D))}function I(){j(),F(),P(),H(),B()}function q(){var e=f.resolve(o.serviceLocator.FEATURE_FLAGS);return e.isFeatureOn(u.FEATURE_FLAGS.CALLING)}function R(){return t.callingDisabled()?!0:!t.hasAudioCapability()}function U(){return t.videoCallingDisabled()?!0:!t.hasVideoCapability()}function z(){b(c.isPstnOnlyConversation(e))}var t=this,y=f.resolve(o.serviceLocator.FEATURE_FLAGS),b=n.observable(c.isPstnOnlyConversation(e)),w=y.isFeatureOn(o.featureFlags.CALLING),E=m.build(e),S=n.observable(!e.videoService.start.enabled()),x=g.build(e),T,N,C,k,L;t.conversationModel=e,t.participants=l.newObservableCollection(e.participants),t.isOneToOneConversation=n.computed(function(){return t.participants().length===1}),t.participantPerson=n.computed(function(){if(t.isOneToOneConversation())return t.participants()[0].person}),t.callingDisabled=n.computed(function(){return!w||E.isCallingDisabled()||x.isConversationWithUnauthorizedAgent()}),t.videoCallingDisabled=n.computed(function(){return!w||E.isVideoCallingDisabled()||x.isConversationWithUnauthorizedAgent()}),t.hasAudioCapability=n.observable(!0),t.hasVideoCapability=n.observable(!0),t.conversationModel.participants.changed(I),t.isAudioDisabled=n.computed(R),t.isVideoDisabled=n.computed(U),T=e.participants.observe(z),L=e.videoService.start.enabled.changed(function(){S(!e.videoService.start.enabled())}),t.callingDisabledTooltip=n.computed(function(){var e=i.get().personsAndGroupsManager.mePerson.capabilities.audio;return e()?"":q()?e.reason===r.callingNotSupportedReasons.BrowserNotSupported?s.fetch({key:"message_text_callingNotSupportedBrowser"}):e.reason===r.callingNotSupportedReasons.OSNotSupported?s.fetch({key:"message_text_callingNotSupportedOS"}):"":s.fetch({key:"message_text_callingIsDisabled"})}),t.buttonVideoTitle=n.pureComputed(function(){if(!t.hasVideoCapability())return s.fetch({key:"videoCallDisabled_tooltip",params:{agentName:t.getDisabledConversationName()}});var e=t.callingDisabledTooltip();return e===""&&(e=s.fetch({key:"startVideoCall_tooltip"})),e}),t.buttonVideoAriaLabel=n.pureComputed(function(){var e=t.callingDisabledTooltip();return e===""&&(e=s.fetch({key:"accessibility_startVideoCall_ariaLabel"})),e}),t.buttonCallTitle=n.pureComputed(function(){if(!t.hasAudioCapability())return s.fetch({key:"callDisabled_tooltip",params:{agentName:t.getDisabledConversationName()}});var e=t.callingDisabledTooltip();return e===""&&(t.conversationModel.isGroupConversation()?e=s.fetch({key:"startGroupCall_tooltip"}):e=s.fetch({key:"startCall_tooltip"})),e}),t.buttonCallAriaLabel=n.pureComputed(function(){var e=t.callingDisabledTooltip();return e===""&&(t.conversationModel.isGroupConversation()?e=s.fetch({key:"accessibility_startGroupCall_ariaLabel"}):e=s.fetch({key:"accessibility_startCall_ariaLabel"})),e}),t.startCallWithAudio=function(){var e=f.resolve(o.serviceLocator.ACTION_TELEMETRY);e.recordAction(d.audioVideo.audioCall),v.get().onMediaButtonClicked(M()),A(!1)},t.startCallWithVideo=function(){var e=f.resolve(o.serviceLocator.ACTION_TELEMETRY);e.recordAction(d.audioVideo.videoCall),v.get().onMediaButtonClicked(M()),A(!0)},t.joinCall=function(){var e=f.resolve(o.serviceLocator.ACTION_TELEMETRY);e.recordAction(d.audioVideo.joinCall),v.get().onMediaButtonClicked(M()),A(!1)},t.getDisabledConversationName=function(){var e=t.participantPerson();return e?e.displayName():t.conversationModel.topic()},t.dispose=function(){t.participants.dispose(),t.participantPerson.dispose(),t.callingDisabledTooltip.dispose(),t.buttonVideoTitle.dispose(),t.buttonVideoAriaLabel.dispose(),t.buttonCallTitle.dispose(),t.buttonCallAriaLabel.dispose(),t.isOneToOneConversation.dispose(),t.callingDisabled.dispose(),t.videoCallingDisabled.dispose(),E.dispose(),T&&T.dispose(),j(),F(),t.conversationModel.participants.changed.off(I),L.dispose(),x.dispose()}};t.build=function(e){return new y(e)}}),define("telemetry/chat/profileCards",["require","experience/settings","ui/telemetry/telemetryClient","constants/common"],function(e){function i(){function e(e,i){var s={Entry_Point:(i?i:r.NOT_AVAILABLE).toString()};n.get().sendEvent(t.telemetry.uiTenantToken,e,s)}this.profileOpened=function(t){e(r.contacts.name.PROFILE_OPENED,t)}}var t=e("experience/settings"),n=e("ui/telemetry/telemetryClient"),r=e("constants/common").telemetry;return new i}),define("ui/viewModels/chat/header",["require","exports","module","lodash-compat","vendor/knockout","browser/detect","utils/calling/callingStack","utils/common/eventMixin","utils/common/outsideClickHandler","swx-i18n","cafe/applicationInstance","services/serviceLocator","constants/common","ui/modelHelpers/conversationHelper","services/pubSub/pubSub","utils/common/cafeObservable","ui/viewModels/chat/conversation/callButtonViewModel","ui/viewModels/calling/startCallButtonViewModel","constants/common","utils/common/eventHelper","ui/telemetry/actions/actionSources","ui/telemetry/chat/guestActionsInHeader","swx-enums","utils/chat/messageSanitizer","constants/keys","ui/viewModels/chat/conversationActivity","ui/viewModels/chat/conversationTopic","ui/modelHelpers/personHelper","ui/viewModels/chat/conversationTile","ui/educationBubbles/educationBubble","ui/educationBubbles/educationBubbleInfo","utils/common/styleModeHelper","telemetry/chat/profileCards","ui/telemetry/actions/actionNames"],function(e,t){function P(e,t){function tt(e){return!!e&&e.participants().length===1}function nt(e){return tt(e)?e.participants(0).person.capabilities.groupAdd?e.participants(0).person.capabilities.groupAdd():!p.isOneToOneConversationWithAgent(e):!0}function rt(e){var t=0;e.forEach(function(e){(!e.response||e.response.status!==200)&&t++}),I.performed(t)}function it(){o.hasNoSelectedParticipants(H?H.selectedContacts().length===0:!0)}function st(){var e=o.editModeActive()||o.profileExpanded();o.dispatchEvent(y.roster.EDIT_ROSTER_MODE,{isActive:e,isEditMode:o.editModeActive()},o.DIRECTION.PARENT)}function ot(){U(!1),H=null,it(),o.toggleEditMode(),d.publish(h.LEAVE_EDIT_MODE)}function ut(e){var t=e().slice(0),r=U()?!q():q(),i;t.push(n.participants(0).person),i=p.createConversation(t,!0),i.isJoiningEnabled.set.enabled.once(!0,function(){i.isJoiningEnabled.set(r)}),r&&o.spacesEnabled&&i.topic.set.enabled.once(!0,function(){i.topic(p.createSpaceTopic())}),d.publish(h.OPEN_CONVERSATION,{model:i,origin:c.telemetry.historyLoadOrigin.CONVERSATION_TO_THREAD})}function at(){return o.editModeActive()}function ft(){var e="secondary circle stroke";return o.editModeActive()?e+" active":e}function lt(){return et()?!0:Q()?!o.canAddParticipants():!0}function ct(){U(!U())}function ht(e){e&&pt()}function pt(){var e=o.editModeActive(),t=o.profileExpanded();if(!e&&!t)return;e?o.canAddParticipants()?o.undoSelectedParticipants():o.toggleEditMode():o.toggleProfile()}function dt(){var t=l.resolve(c.serviceLocator.ACTION_TELEMETRY);t.recordAction(D.conversation.addParticipantsButton),o.profileExpanded(!1),I=e.conversationUpdateFlow,I.start(n.participants().length,n.isGroupConversation())}function vt(e){o.profileExpanded()||o.toggleProfile(undefined,e),e.editTopic&&!o.topicEditorExpanded()&&o.openTopicEditor()}function mt(){o.profileExpanded()&&o.toggleProfile()}function gt(){return R.isFeatureOn(c.featureFlags.CONTACT_PROFILE)}function yt(){return gt()&&!o.isGroupConversation()}function bt(){return o.isGroupConversation()&&o.headerControlsEnabled||!o.isGroupConversation()&&gt()}function wt(){return bt()?0:-1}function Et(e){var t=xt();t.parent=e.parent,E.get().onCopyLinkClicked(t)}function St(e){var t=xt();t.parent=e.parent,E.get().onEmailLinkClicked(t)}function xt(){return{participantsCount:o.conversationModel.participants.length,userMessagesCount:o.conversationModel.historyService.activityItems().filter(function(e){return e.type()===S.activityType.TextMessage&&k.isMePerson(e.sender)}).length,totalMessagesCount:o.conversationModel.historyService.activityItems().length}}function Tt(e){o.participantCount(e),R.isFeatureOn(c.featureFlags.INCLUDE_SELF_IN_PARTICIPANTS_COUNT)&&o.participantCount(e+1)}function Nt(e){o._internal.isModelTopicEditable(e)}function Ct(){var e=p.isOneToOneConversationWithBlockedPerson(o.conversationModel);Q(!e&&nt(o.conversationModel))}function kt(){tt(o.conversationModel)&&o.conversationModel.participants()[0].person.capabilities.groupAdd?(G=o.conversationModel.participants()[0].person,G.capabilities.groupAdd.changed(Ct)):Ct()}function Lt(){tt(o.conversationModel)?(G=o.conversationModel.participants()[0].person,G.isBlocked.changed(Ct)):Ct()}function At(){Ot(),Mt(),kt(),Lt()}function Ot(){G&&G.capabilities.groupAdd&&G.capabilities.groupAdd.changed.off(Ct)}function Mt(){G&&G.isBlocked.changed.off(Ct)}function _t(){et(!0)}function Dt(){et(!1)}function Pt(){R.isFeatureOn(c.featureFlags.CALL_EDUCATION_BUBBLE)&&f.get().personsAndGroupsManager.all.persons.get().then(function(){!o.isCallingDisabled()&&!o.callButtonViewModel.isVideoDisabled()&&jt()&&Bt(O.CALL_EDUCATION_BUBBLE)})}function Ht(){var e;o.showMoreActions()&&R.isFeatureOn(c.featureFlags.SCHEDULE_CALL_EDUCATION_BUBBLE_1)&&(o.isGroupConversation()?e=O.SCHEDULE_CALL_EDUCATION_BUBBLE_1_GROUP:(e=O.SCHEDULE_CALL_EDUCATION_BUBBLE_1,e.options.i18nParams={name:o.topic()}),Bt(e))}function Bt(e){var t=A.build(e.id,e.anchorElementQuery,e.i18nKey,e.iconUrlPath,e.options);t.show()}function jt(){var e=n.participants().filter(function(e){return e.person.status()===S.onlineStatus.Online});return e.length>0}function Ft(){return R.isFeatureOn(c.featureFlags.CALLING)?i.getSystemInfo().osName===i.OPERATING_SYSTEMS.LINUX&&!s.get().isPluginlessCallingSupported()?!1:!0:!1}function It(){return R.isFeatureOn(c.featureFlags.CALLING)?i.getSystemInfo().osName===i.OPERATING_SYSTEMS.LINUX?!1:!0:!1}var n=e.conversationModel,o=this,P,H=null,B,j,F,I=e.conversationUpdateFlow,q=v.newObservableProperty(n.isJoiningEnabled),R=l.resolve(c.serviceLocator.FEATURE_FLAGS),U=r.observable(!1),z,W=N.build(n),X=C.build(n),V=f.get().translatorService,$=p.isPstnOnlyConversation(n),J=p.isOneToOneConversationWithAgent(n),K=p.isOneToOneConversationWithEcho(n),Q=r.observable(!1),G,Y,Z,et=r.observable(!1);o._internal={isModelTopicEditable:r.observable(!1)},o.conversation=L.build(n,{contactOptions:{moodMessageFirst:!0}}),o.callButtonViewModel=m.build(n),o.startCallButtonViewModel=g.build({callButtonViewModel:o.callButtonViewModel,historyOrigin:c.telemetry.historyLoadOrigin.CONVERSATION_HEADER_BUTTON,telemetryContext:{source:w.conversation.header.button}}),o.conversationModel=n,o.conversationModel.participants.changed(At),o.spacesEnabled=R.isFeatureOn(c.featureFlags.SPACES),o.telemetryContext={source:w.invitesShareButtons.header},o.callingDisabled=!Ft(),o.videoCallingDisabled=!It(),o.newConversationV2=R.isFeatureOn(c.featureFlags.NEW_CONVERSATION_V2),o.headerControlsEnabled=!R.isFeatureOn(c.featureFlags.HEADER_CONTROLS_DISABLED),o.joinCallAriaLabel=a.fetch({key:"button_text_joinCall"}),o.joinCallTitle=a.fetch({key:"button_text_joinCall"}),o.addParticipantsTitle=a.fetch({key:"button_text_addParticipants"}),o.cancelAddParticipantsTitle=a.fetch({key:"button_text_cancelAddParticipants"}),o.spaceLink=v.newObservableProperty(n.uri),V&&(o.translatorServiceStateObservable=v.newObservableProperty(V.state)),o.role=v.newObservableProperty(n.selfParticipant.role),o.isAdmin=r.computed(function(){return o.role()===S.participantRole.Leader}),o.buttonAddPeopleToConversationTitle=r.pureComputed(function(){var e="";return o.addParticipantsBtnDisabled()===!1&&(e=a.fetch({key:"addPeopleToConversation_tooltip"})),e}),o.buttonAddPeopleToConversationAriaLabel=r.pureComputed(function(){var e="";return o.addParticipantsBtnDisabled()===!1&&(e=a.fetch({key:"accessibility_addPeopleToConversation_ariaLabel"})),e}),o.editModeActive=r.observable(!1),o.canJoinCall=W.canJoinCall,o.initializeParticipants=r.observable(!1),o.hasNoSelectedParticipants=r.observable(!0),o.profileExpanded=r.observable(!1),o.isGroupConversation=v.newObservableProperty(n.isGroupConversation),o.canShowContactProfile=r.computed(yt),o.canExpandProfile=r.computed(bt),o.tabIndex=r.computed(wt),o.avatar=v.newObservableProperty(n.avatarUrl),o.topic=X.topic,o.canAddParticipants=r.observable(!1),o.contact=null,o.isAgent=o.conversation.isAgent,o.isPstn=o.conversation.isPstn,o.confirmButtonsVisible=r.computed(at),o.addParticipantsBtnClasses=r.computed(ft),o.addParticipantsBtnDisabled=r.computed(lt),o.isCallingDisabled=W.isCallingDisabled,o.spaceLink=r.observable(),o.isTooltipVisible=r.observable(!1),Z=n.participants.add.enabled.changed(function(e){o.canAddParticipants(e)}),Y=n.topic.set.enabled.changed(Nt),o.spaceTopicEditorEnabled=R.isFeatureOn(c.featureFlags.SPACE_TOPIC_EDITOR),o.isServiceEnabled=v.newObservableProperty(o.conversationModel.chatService.sendMessage.enabled),o.topicEditable=r.computed(function(){return o.isServiceEnabled()&&o.isGroupConversation()&&o._internal.isModelTopicEditable()&&o.spaceTopicEditorEnabled}),o.canEditTopic=r.computed(function(){return o.topicEditable()&&o.profileExpanded()}),o.editTopicTitle=a.fetch({key:"spaces_welcomeRenameBtnTitle"}),o.editTopicConfirmAria=a.fetch({key:"action_button_confirm"}),o.editTopicCancelAria=a.fetch({key:"action_button_cancel"}),o.editTopic=r.observable(""),o.topicEditorExpanded=r.observable(!1),o.topicHasFocus=r.observable(!1),o.participantCount=r.observable(n.participantsCount()),n.participantsCount.changed(Tt),o.isIntegratedProperty=r.observable(M.get().isIntegratedProperty()),o.showMoreActions=function(){return R.isFeatureOn(c.featureFlags.SCHEDULE_CALL_FROM_CONVERSATION)&&!J&&!K},o.closeTopicEditor=function(){o.topicEditorExpanded(!1),o.editTopic("")},o.openTopicEditor=function(){o.editTopic(x.getSanitizedTopic(n.topic())),o.topicEditorExpanded(!0),o.topicHasFocus(!1),P.onTopicEdit()},o.onTopicEditKeyDown=function(e,t){return t.keyCode===T.ENTER?(o.updateTopic(),o.topicHasFocus(!0),!1):t.keyCode===T.ESCAPE?(o.closeTopicEditor(),t.stopPropagation(),o.topicHasFocus(!0),!1):!0},o.updateTopic=function(){var e=x.processOutgoingTextMessage(o.editTopic());e.length&&(n.topic(e),o.topicEditorExpanded(!1),o.editTopic(""))},o.onUpdateTopicKeyDown=function(e,t){var n=b.isActivation(t);return n&&o.updateTopic(),!n},o.onCloseTopicEditorKeyDown=function(e,t){var n=b.isActivation(t);return n&&o.closeTopicEditor(),!n},o.linkShown=r.pureComputed(function(){return o.spacesEnabled&&(q()||o.isAdmin())}),o.showTranslatorSettings=r.pureComputed(function(){return!!V&&!$&&!J&&!K&&!o.isGroupConversation()&&!o.profileExpanded()&&o.translatorServiceStateObservable()===c.translatorServiceState.Authenticated}),o.headerAriaLabel=r.pureComputed(function(){var e;return o.isGroupConversation()?e=o.profileExpanded()?"accessibility_groupProfile_headingWithOpenedProfile":"accessibility_groupProfile_headingWithClosedProfile":e=o.profileExpanded()?"accessibility_contactProfile_headingWithOpenedProfile":"accessibility_contactProfile_headingWithClosedProfile",a.fetch({key:e,params:{topic:o.topic()}})}),B=o.editModeActive.subscribe(st),j=o.profileExpanded.subscribe(st),o.focusRestrict=function(){o.profileExpanded()&&t.restrict()},o.init=function(e){P=e,P.init({toggleProfile:o.toggleProfile,abandonEditMode:pt}),F=o.addParticipantsBtnDisabled.subscribe(ht),n.isGroupConversation()&&(o.spaceLink=v.newObservableProperty(n.uri)),o.forwardEvent(y.roster.ROSTER_QUERY_CHANGED),o.forwardEvent(y.roster.ROSTER_QUERY_EXECUTED),o.forwardEvent(y.roster.ROSTER_SELECTION_REMOVED),o.forwardEvent(y.roster.PICKER_CONTACT_SELECTED),o.forwardEvent(y.roster.PICKER_CONTACT_DESELECTED),o.registerEvent(y.conversation.JOINING_ENABLED,ct),o.registerEvent(y.conversation.OPEN_PROFILE,vt),o.registerEvent(y.conversation.CLOSE_PROFILE,mt),o.registerEvent(y.conversation.COPY_LINK,Et),o.registerEvent(y.conversation.EMAIL_LINK,St),o.registerEvent(y.conversation.MESSAGES_LOADED,o.focusRestrict),d.subscribe(c.events.shareControl.SHARE_CONTROL_SHOW,_t),d.subscribe(c.events.shareControl.SHARE_CONTROL_HIDE,Dt),Pt(),Ht()},o.dispose=function(){B.dispose(),j.dispose(),F.dispose(),o.selectedContactsSubscription&&o.selectedContactsSubscription.dispose(),o.confirmButtonsVisible.dispose(),o.addParticipantsBtnDisabled.dispose(),o.addParticipantsBtnClasses.dispose(),o.topicEditable.dispose(),o.canEditTopic.dispose(),o.isAdmin.dispose(),o.canShowContactProfile.dispose(),o.canExpandProfile.dispose(),o.tabIndex.dispose(),P&&P.dispose(),P=null,o.conversation.dispose(),W.dispose(),X.dispose(),o.callButtonViewModel.dispose(),o.startCallButtonViewModel.dispose(),Y&&Y.dispose(),Z&&Z.dispose(),o.translatorServiceStateObservable&&o.translatorServiceStateObservable.dispose(),n.participantsCount.changed.off(Tt),Ot(),Mt(),o.conversationModel.participants.changed.off(At),d.unsubscribe(c.events.shareControl.SHARE_CONTROL_SHOW,_t),d.unsubscribe(c.events.shareControl.SHARE_CONTROL_HIDE,Dt),u.remove("conversationHeader")},o.submitButtonDisabled=r.pureComputed(function(){return o.hasNoSelectedParticipants()&&!U()}),o.toggleProfile=function(e,r){if(!bt())return;var i=o.profileExpanded();o.profileExpanded(!i),o.profileExpanded()?(u.add("conversationHeader",o.toggleProfile),t.restrict()):(u.remove("conversationHeader"),t.restore());if(n.isGroupConversation()){var s=xt();s.telemetryItem=e,s.profileExpanded=i,E.get().onProfileToggled(s),o.initializeParticipants(!0),o.profileExpanded()&&o.editModeActive()&&ot(),o.profileExpanded()||o.closeTopicEditor(),P.onEditModeToggled(o.profileExpanded())}else if(o.profileExpanded()){var a=r&&r.source?r.source:w.conversation.header.button;_.profileOpened(a)}},o.setParticipantProvider=function(e){o.selectedContactsSubscription&&o.selectedContactsSubscription.dispose(),H=e,o.selectedContactsSubscription=H.selectedContacts.subscribe(it),it()},o.toggleEditMode=function(){var e=!o.editModeActive();o.editModeActive(e),e&&dt(),P.onEditModeToggled(e)},o.showTooltip=function(){z&&window.clearTimeout(z),o.isTooltipVisible(!0)},o.hideTooltip=function(){z=window.setTimeout(function(){o.isTooltipVisible(!1)},500)},o.undoSelectedParticipants=function(){ot(),I.cancelled(),I=null},o.submitSelectedParticipants=function(){var e=H.selectedContacts,t=e().length;I.completed(t),n.isGroupConversation()?(U()&&n.isJoiningEnabled.set(!q()),p.addPersonsToConversation(e(),n).then(rt)):ut(e),ot()},o.onToggleProfileKeyDown=function(e,t){var n=b.isActivation(t);return n&&o.toggleProfile(),!n}}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("browser/detect"),s=e("utils/calling/callingStack"),o=e("utils/common/eventMixin"),u=e("utils/common/outsideClickHandler"),a=e("swx-i18n").localization,f=e("cafe/applicationInstance"),l=e("services/serviceLocator"),c=e("constants/common"),h=c.events.navigation,p=e("ui/modelHelpers/conversationHelper"),d=e("services/pubSub/pubSub"),v=e("utils/common/cafeObservable"),m=e("ui/viewModels/chat/conversation/callButtonViewModel"),g=e("ui/viewModels/calling/startCallButtonViewModel"),y=e("constants/common").events,b=e("utils/common/eventHelper"),w=e("ui/telemetry/actions/actionSources"),E=e("ui/telemetry/chat/guestActionsInHeader"),S=e("swx-enums"),x=e("utils/chat/messageSanitizer"),T=e("constants/keys"),N=e("ui/viewModels/chat/conversationActivity"),C=e("ui/viewModels/chat/conversationTopic"),k=e("ui/modelHelpers/personHelper"),L=e("ui/viewModels/chat/conversationTile"),A=e("ui/educationBubbles/educationBubble"),O=e("ui/educationBubbles/educationBubbleInfo"),M=e("utils/common/styleModeHelper"),_=e("telemetry/chat/profileCards"),D=e("ui/telemetry/actions/actionNames");n.assign(P.prototype,o),t.build=function(e,t){return new P(e,t)}}),define("jsviews/chat/header",["require","browser/dom","constants/keys","constants/common"],function(e){function o(e){function u(e){e.keyCode===n.ESCAPE&&(e.stopPropagation(),o.abandonEditMode())}function a(){e.removeEventListener("keydown",u),document.removeEventListener(r.events.browser.CLICK,f,!0)}function f(e){var n=!t.getParentWithClass(e.target,i)&&t.getParentWithClass(e.target,s);n&&o.abandonEditMode()}var o;this.init=function(e){o=e},this.dispose=function(){a()},this.onEditModeToggled=function(t){t?(e.addEventListener("keydown",u),document.addEventListener(r.events.browser.CLICK,f,!0)):a()},this.onTopicEdit=function(){t.getElement(".editTopic input.edit",e).select()}}var t=e("browser/dom"),n=e("constants/keys"),r=e("constants/common"),i="conversationHeader",s="swx-container";return o}),define("utils/common/focusRestrictor",["require","exports","module","lodash-compat"],function(e,t){function r(e,t){var r=this,i={};r.restrict=function(){var s,o=[],u='[tabindex="0"], a, button, input, select, textarea';s=Array.prototype.slice.call(document.querySelectorAll(u)),t&&t.forEach(function(e){var t=document.querySelector(e);t&&(o=Array.prototype.concat.call(o,Array.prototype.slice.call(t.querySelectorAll(u))))}),n.difference(s,o).forEach(function(t){e.contains(t)||(i[Object.keys(i).length]={element:t,tabIndex:t.getAttribute("tabindex")},t.setAttribute("tabindex",-100))})},r.restore=function(){Object.keys(i).forEach(function(e){var t=i[e];t.tabIndex?t.element.setAttribute("tabindex",t.tabIndex):t.element.removeAttribute("tabindex")}),i={}}}var n=e("lodash-compat");t.build=function(t,n){return new r(t,n)}}),define("text!views/chat/header.html",[],function(){return'<div class="headerMain" data-bind="css: { canJoinCall: canJoinCall }">\r\n    <div class="roster">\r\n        <div class="grid" data-bind="css: { group: isGroupConversation, staticHeader: !canExpandProfile() }">\r\n            <swx-avatar-deprecated data-bind="click: toggleProfile.bind(this, \'telemetryItemAvatar\', null), css: { hide: profileExpanded }" params="isGroupAvatar: isGroupConversation, avatar: avatar, isAgent: isAgent, status: conversation.statusClassName, isPstn: isPstn" class="avatar"></swx-avatar-deprecated>\r\n\r\n            <swx-button data-bind="css: { hide: !profileExpanded()}" params="icon: \'chevronUp\', cssClass: \'primary circle\', textKey: \'header_text_close\', titleKey: \'header_text_close\', action: toggleProfile.bind(this, \'telemetryItemChevronUp\', true), tabindex:-1" class="hideProfile"></swx-button>\r\n\r\n            <span class="tile conversationTopic" data-bind="css: conversation.statusClassName">\r\n                <span class="tileText">\r\n                    <span class="tileName square">\r\n                        <h3 data-bind="css: { editable: topicEditable() }">\r\n                            <span class="iconfont button chevronUp" data-bind="css: { hide: !profileExpanded() }, click: toggleProfile.bind(this, \'telemetryItemChevronUp\')"></span>\r\n                            <span class="hoverWrap" data-bind="css: { \'Header-Title--agent\': conversation.isCertifiedAgent() }">\r\n                                <a href="#" role="button" data-swx-testId="conversationTopic" data-bind="text: topic, click: toggleProfile.bind(this, \'telemetryItemTopic\'), attr: {\'aria-label\': headerAriaLabel, \'title\': topic, \'aria-expanded\': profileExpanded, \'tabindex\': tabIndex}, hasFocus: topicHasFocus"></a>\r\n                                <!-- ko if: conversation.isCertifiedAgent() -->\r\n                                <span class="iconfont avatarBotCertified"></span>\r\n                                <!-- /ko -->\r\n                                <!-- ko if: canExpandProfile -->\r\n                                <span class="iconfont chevronDown" data-bind="css: { hide: profileExpanded }, click: toggleProfile.bind(this, \'telemetryItemChevronDown\')"></span>\r\n                                <!-- /ko -->\r\n                            </span>\r\n                            <button class="iconfont edit" data-bind="css: { hide: !canEditTopic() }, attr: {\'aria-label\': editTopicTitle, \'title\': editTopicTitle}, click: openTopicEditor" type="button"></button>\r\n                        </h3>\r\n                        <!-- ko if: isGroupConversation -->\r\n                        <div class="editTopic" data-bind="css: { hide: !topicEditorExpanded(), integratedProperty : isIntegratedProperty}">\r\n                            <input class="edit" data-bind="textInput: editTopic, event: {keydown: onTopicEditKeyDown }, hasFocus: topicEditorExpanded(), selected: topicEditorExpanded()" maxlength="200" />\r\n                            <a href="#" class="iconfont ok" role="button" data-bind="event: {click: updateTopic, keydown: onUpdateTopicKeyDown}, attr: {\'aria-label\': editTopicConfirmAria}"></a>\r\n                            <a href="#" class="iconfont cancel" role="button" data-bind="event: {click: closeTopicEditor, keydown: onCloseTopicEditorKeyDown}, attr: {\'aria-label\': editTopicCancelAria}"></a>\r\n                        </div>\r\n                        <!-- /ko -->\r\n                    </span>\r\n                    <span class="tileMessage" data-bind="css: { empty: !conversation.displayMessage(), presence: !profileExpanded(), circle: !profileExpanded()}">\r\n                        <div class="message fixSmall">\r\n                            <div class="displayMessage">\r\n                                <span data-bind="html: conversation.displayMessage, attr: {title: conversation.displayMessageTitle}" class="iconfont groupParticipantsLabel fontSize-p"></span>\r\n                                <!--ko if: conversation.displayMessage() && linkShown() -->\r\n                                <span class="fontSize-p divider">|</span>\r\n                                <!-- /ko -->\r\n                                <!-- ko if: linkShown -->\r\n                                <swx-conversation-share-link class="conversation-share-link conversation-share-link-header" params="conversationModel: conversationModel, telemetryContext: telemetryContext"></swx-conversation-share-link>\r\n                                <!-- /ko -->\r\n                            </div>\r\n                        </div>\r\n                    </span>\r\n                </span>\r\n            </span>\r\n\r\n            <!-- ko if: headerControlsEnabled -->\r\n            <div class="headerControls" data-bind="css: { newConversationV2: newConversationV2, hide: confirmButtonsVisible }">\r\n                <div class="buttonRow">\r\n                    <swx-joincall-button params="cssClass: \'primary circle joinCall\', conversationModel: conversationModel, showIcon: true"></swx-joincall-button>\r\n                    <swx-button data-bind="css: { hide: callingDisabled || videoCallingDisabled}" class="callButtons" params="icon: \'videoOn\', cssClass: \'primary circle\', disabled: callButtonViewModel.isVideoDisabled, textKey: \'button_text_videoCall\', i18nTitle: callButtonViewModel.buttonVideoTitle, action: callButtonViewModel.startCallWithVideo, ariaLabel: callButtonViewModel.buttonVideoAriaLabel"></swx-button>\r\n                    <swx-button data-bind="css: { hide: callingDisabled }" class="callButtons" params="icon: \'callStart\', cssClass: \'primary circle\', disabled: callButtonViewModel.isAudioDisabled, textKey: \'button_text_audioCall\', i18nTitle: callButtonViewModel.buttonCallTitle, action: callButtonViewModel.startCallWithAudio, ariaLabel: callButtonViewModel.buttonCallAriaLabel, hasMenuOptions: startCallButtonViewModel.hasMenuOptions, menuOptions: startCallButtonViewModel.getMenuOptions"></swx-button>\r\n\r\n                    <!-- ko if: !showMoreActions() -->\r\n                    <swx-button params="conversation: conversationModel, icon: \'contactAdd\', disabled: addParticipantsBtnDisabled, cssClass: addParticipantsBtnClasses, textKey: \'button_text_addParticipants\', i18nTitle: buttonAddPeopleToConversationTitle, action: toggleEditMode, ariaLabel: buttonAddPeopleToConversationAriaLabel"></swx-button>\r\n                    <!-- /ko -->\r\n                    <!-- ko if: showMoreActions() -->\r\n                    <swx-more-actions-button class="moreActions" params="conversation: conversationModel, cssClass: \'secondary circle stroke\', addParticipantsDisabled: addParticipantsBtnDisabled, addParticipantsAction: toggleEditMode"></swx-more-actions-button>\r\n                    <!-- /ko -->\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: showTranslatorSettings -->\r\n                <swx-translator-settings params="conversationModel: conversationModel"></swx-translator-settings>\r\n            <!-- /ko -->\r\n            <!-- ko if: initializeParticipants -->\r\n                <swx-group-profile params="conversationModel: conversationModel" data-bind="css: { hide: !profileExpanded() }" class="themeWhite groupProfileContainer"></swx-group-profile>\r\n            <!-- /ko -->\r\n            <!-- ko if: canShowContactProfile -->\r\n                <swx-contact-profile params="conversationModel: conversationModel, conversationTile: conversation" data-bind="css: { hide: !profileExpanded() }" class="themeWhite groupProfileContainer"></swx-contact-profile>\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<!-- ko if: editModeActive -->  <!-- TODO: make sure this is not unnecessary disposed -->\r\n<div class="contactPickerWrapper" css="modal" >\r\n    <div class="headerAdd">\r\n        <swx-contact-picker-input params="setParticipantProvider: setParticipantProvider"></swx-contact-picker-input>\r\n    </div>\r\n    <swx-contact-picker params="conversation: conversationModel, className: \'headerPicker\'"></swx-contact-picker>\r\n\r\n    <!-- ko if: !newConversationV2 -->\r\n        <!-- ko if: spacesEnabled -->\r\n            <swx-space-settings params="conversationModel: conversationModel"></swx-space-settings>\r\n        <!-- /ko -->\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: newConversationV2 -->\r\n        <div class="actions">\r\n             <div class="submitConversation">\r\n                <swx-button params="cssClass: \'secondary circle\', textKey: \'button_text_cancelAddParticipants\', i18nTitle: cancelAddParticipantsTitle, ariaLabelKey: cancelAddParticipantsTitle, action: undoSelectedParticipants"></swx-button>\r\n                <swx-button params="cssClass: \'primary circle\', textKey: \'button_text_addParticipants\', i18nTitle: addParticipantsTitle, ariaLabelKey: addParticipantsTitle, action: submitSelectedParticipants"></swx-button>\r\n            </div>\r\n            <!-- ko if: linkShown -->\r\n            <swx-conversation-share-link class="conversation-share-link-actions" params="conversationModel: conversationModel"></swx-conversation-share-link>\r\n            <!-- /ko -->\r\n        </div>\r\n    <!-- /ko -->\r\n</div>\r\n<!-- /ko -->\r\n\r\n<div class="headerControls" data-bind="css: { newConversationV2: newConversationV2, hide: !confirmButtonsVisible() }">\r\n    <!-- ko if: !newConversationV2 -->\r\n    <div class="buttonRow">\r\n        <swx-button params="conversation: conversationModel, icon: \'tick\', disabled: submitButtonDisabled, cssClass: \'secondary circle\', textKey: \'button_text_addParticipants\', ariaLabelKey: \'button_text_addParticipants\', titleKey: \'action_button_confirm\', action: submitSelectedParticipants"></swx-button>\r\n        <swx-button params="conversation: conversationModel, icon: \'cross\', cssClass: \'secondary circle\', textKey: \'button_text_cancelAddParticipants\', ariaLabelKey: \'button_text_cancelAddParticipants\', titleKey: \'action_button_cancel\', action: undoSelectedParticipants"></swx-button>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: newConversationV2 -->\r\n    <div class="buttonRow newConversationV2">\r\n        <swx-button data-bind="css: { hide: callingDisabled }" class="callButtons" params="icon: \'videoOn\', cssClass: \'primary circle\', disabled: \'true\', textKey: \'button_text_videoCall\', i18nTitle: callButtonViewModel.buttonVideoTitle"></swx-button>\r\n        <swx-button data-bind="css: { hide: callingDisabled }" class="callButtons" params="icon: \'callStart\', cssClass: \'primary circle\', disabled: \'true\', textKey: \'button_text_audioCall\', i18nTitle: callButtonViewModel.buttonCallTitle"></swx-button>\r\n\r\n        <!-- ko if: !showMoreActions() -->\r\n        <swx-button params="icon: \'contactAdd\', disabled: \'true\', cssClass: addParticipantsBtnClasses, textKey: \'button_text_addParticipants\', i18nTitle: buttonAddPeopleToConversationTitle"></swx-button>\r\n        <!-- /ko -->\r\n        <!-- ko if: showMoreActions() -->\r\n        <swx-more-actions-button class="moreActions" params="icon: \'more\', disabled: \'true\', cssClass: \'secondary circle stroke\', textKey: \'button_text_moreActions\'"></swx-more-actions-button>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/chat/header",["require","exports","module","vendor/knockout","constants/common","ui/viewModels/chat/header","jsviews/chat/header","utils/common/focusRestrictor","constants/components","text!views/chat/header.html"],function(e,t){function u(e,u){var a=u.element,f=new s(a),l=[".Me",".toasts",".footer",".notifications","swx-sidebar"],c=o.build(a,l),h=i.build(e,c);return h.setContext(n.dataFor(a)),h.init(f),h.dispatchEvent(r.navigation.COMPONENT_RENDERED,t.name,h.DIRECTION.PARENT),h}var n=e("vendor/knockout"),r=e("constants/common").events,i=e("ui/viewModels/chat/header"),s=e("jsviews/chat/header"),o=e("utils/common/focusRestrictor");t.name=e("constants/components").chat.HEADER,t.template=e("text!views/chat/header.html"),t.viewModel={createViewModel:u}}),define("ui/viewModels/chat/headerSingleConversation",["require","lodash-compat","vendor/knockout","utils/common/cafeObservable","utils/common/eventMixin","swx-i18n","services/serviceLocator","constants/common","swx-enums","ui/telemetry/chat/guestActionsInHeader","ui/modelHelpers/personHelper","utils/common/outsideClickHandler"],function(e){function h(e,i){function g(e){p.participantsCount(e+(m?1:0))}function y(){return s.fetch({key:"conversation_header_topic_people_chatting",count:p.participantsCount()})}function b(){return{participantsCount:h.participants.length,userMessagesCount:h.historyService.activityItems().filter(function(e){return e.type()===a.activityType.TextMessage&&l.isMePerson(e.sender)}).length,totalMessagesCount:h.historyService.activityItems().length}}function w(e,t){v.publish(u.events.interaction.SCROLL_START,t)}var h=e.conversationModel,p=this,d=o.resolve(u.serviceLocator.FEATURE_FLAGS),v=o.resolve(u.serviceLocator.PUBSUB),m=d.isFeatureOn(u.featureFlags.INCLUDE_SELF_IN_PARTICIPANTS_COUNT);p.initializeParticipants=n.observable(!1),p.profileExpanded=n.observable(!1),p.participantsCount=n.observable(h.participantsCount()),h.participantsCount.changed(g),p.selfParticipant=h.selfParticipant,p.participants=r.newObservableCollection(h.participants),p.topic=n.computed(y),p.init=function(){i.init()},p.dispose=function(){h.participantsCount.changed.off(g),i.dispose(),p.topic.dispose(),c.remove("conversationHeader")},p.getParticipantName=function(e){return e.person.displayName()},p.onScroll=t.debounce(w,1e3,{leading:!0,trailing:!1}),p.toggleProfile=function(e){var t,n=p.profileExpanded();p.profileExpanded(!n),p.profileExpanded()?c.add("conversationHeader",p.toggleProfile):c.remove("conversationHeader"),t=b(),t.telemetryItem=e,t.profileExpanded=n,f.get().onProfileToggled(t),p.initializeParticipants(!0)},p.toggleProfileChevron=function(){p.toggleProfile(u.telemetry.guestActionsInHeader.telemetryItem[p.profileExpanded()?"CHEVRON_UP":"CHEVRON_DOWN"])}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/cafeObservable"),i=e("utils/common/eventMixin"),s=e("swx-i18n").localization,o=e("services/serviceLocator"),u=e("constants/common"),a=e("swx-enums"),f=e("ui/telemetry/chat/guestActionsInHeader"),l=e("ui/modelHelpers/personHelper"),c=e("utils/common/outsideClickHandler");return t.assign(h.prototype,i),h}),define("text!views/chat/headerSingleConversation.html",[],function(){return'<div class="headerWac squeeze">\r\n    <div class="roster squeeze">\r\n        <span class="tileName square">\r\n            <h3>\r\n                <span class="hoverWrap">\r\n                    <a role="button" data-swx-testId="conversationTopic" data-bind="text: topic, click: toggleProfile.bind(this, \'telemetryItemTopic\'), attr: {\'tabindex\': -1,\'title\': topic}"></a>\r\n                    <span class="iconfont" data-bind="css: {chevronUp: profileExpanded, chevronDown: !profileExpanded()}, click: toggleProfileChevron"></span>\r\n                </span>\r\n            </h3>\r\n        </span>\r\n    </div>\r\n    <div class="notificationsBell">\r\n        <swx-notifications-toggle-button></swx-notifications-toggle-button>\r\n    </div>\r\n</div>\r\n<!-- ko if: initializeParticipants -->\r\n<div class="chat-participants" data-bind="css: {show: profileExpanded}">\r\n    <div class="scrollingContainer">\r\n        <ul class="participants-list scrollViewport scrollViewportV" data-bind="event: {scroll: onScroll}">\r\n            <li>\r\n                <span data-bind="text: getParticipantName(selfParticipant)">\r\n                </span>\r\n            </li>\r\n            <!-- ko foreach: participants -->\r\n            <li>\r\n                <span data-bind="text: $parent.getParticipantName($data)">\r\n                </span>\r\n            </li>\r\n            <!-- /ko -->\r\n        </ul>\r\n    </div>\r\n</div>\r\n<!-- /ko -->\r\n'}),define("ui/components/chat/headerSingleConversation",["require","exports","module","vendor/knockout","browser/dom","utils/common/scroll","ui/viewModels/chat/headerSingleConversation","constants/components","text!views/chat/headerSingleConversation.html"],function(e,t){function o(e,t){var o=r.getElement(".scrollingContainer",t.element),u=i.build(o),a=new s(e,u);return a.setContext(n.dataFor(t.element)),a.init(),a}var n=e("vendor/knockout"),r=e("browser/dom"),i=e("utils/common/scroll"),s=e("ui/viewModels/chat/headerSingleConversation");t.name=e("constants/components").chat.HEADER_SINGLE_CONVERSATION,t.template=e("text!views/chat/headerSingleConversation.html"),t.viewModel={createViewModel:o}}),define("ui/viewModels/chat/groupProfile",["require","lodash-compat","vendor/knockout","utils/common/eventMixin","constants/common","swx-i18n","swx-enums","services/serviceLocator","constants/common","ui/contextMenu/contextMenu","utils/common/cafeObservable","utils/chat/spaceMail","ui/contextMenu/menuItem","utils/common/eventHelper","services/pubSub/pubSub","utils/common/location","ui/modalDialog/leaveConversationDialog","ui/modalDialog/removeConversationHistoryDialog","ui/modelHelpers/personHelper","cafe/applicationInstance"],function(e){function w(e,r){function k(e,t){d.publish(a.events.interaction.SCROLL_START,t)}function L(e){S.lessParticipants(e<=4),S.participantCount(e),x.isFeatureOn(a.featureFlags.INCLUDE_SELF_IN_PARTICIPANTS_COUNT)&&S.participantCount(e+1)}function O(){return x.isFeatureOn(a.featureFlags.USE_BUSINESS_WORDING)}function M(e){return e+"_4b"}var E=e.conversationModel,S=this,x=u.resolve(a.serviceLocator.FEATURE_FLAGS),T=x.isFeatureOn(a.featureFlags.SPACES),N=x.isFeatureOn(a.featureFlags.REMOVE_CONVERSATION_HISTORY),C=!x.isFeatureOn(a.featureFlags.DISABLE_LEAVE_CONVERSATION),A=l.newObservableProperty(E.isJoiningEnabled.set.enabled);S.model=E,S.closeLabel=s.fetch({key:"header_text_close"}),S.avatar=l.newObservableProperty(E.avatarUrl),S.spaceLink=l.newObservableProperty(E.uri),S.participants=l.newObservableCollection(E.participants),S.canLeaveConversation=C?l.newObservableProperty(E.leave.enabled):n.observable(!1),S.canRemoveConversation=!y.isGuest(b.get().personsAndGroupsManager.mePerson)&&N&&E.historyService.removeAll?l.newObservableProperty(E.historyService.removeAll.enabled):n.observable(!1),S.mailtoLink=n.computed(function(){return c.createMailtoLink(E.topic(),S.spaceLink())}),S.role=l.newObservableProperty(E.selfParticipant.role),S.isAdmin=n.computed(function(){return S.role()===o.participantRole.Leader}),S.groupProfileHeading=n.computed(function(){return S.isAdmin()?s.fetch({key:"header_text_adminSettings"}):s.fetch({key:"header_text_groupSettings"})}),S.spacesLinkAriaLabel=n.computed(function(){return s.fetch({key:"groupProfile_spacesLink_ariaLabel",params:{spacesUrl:S.spaceLink()}})}),S.participantCount=n.observable(E.participantsCount()),S.lessParticipants=n.observable(!0),E.participantsCount.changed(L),S.joiningEnabled=n.observable(E.isJoiningEnabled()),E.isJoiningEnabled.changed(S.joiningEnabled),S.historyDisclosed=n.observable(E.historyService.isHistoryDisclosed()),E.historyService.isHistoryDisclosed.changed(S.historyDisclosed),S.historyToggleAriaLabel=n.computed(function(){var e=S.historyDisclosed()?"accessibility_groupProfile_historyToggle_on":"accessibility_groupProfile_historyToggle_off";return s.fetch({key:e})}),S.joiningToggleAriaLabel=n.computed(function(){var e=S.joiningEnabled()?"accessibility_groupProfile_joiningToggle_on":"accessibility_groupProfile_joiningToggle_off";return s.fetch({key:e})}),S.joiningEnabledVisible=n.computed(function(){return T&&S.isAdmin()&&A()}),S.spaceLinkVisible=n.computed(function(){return T&&S.joiningEnabled()&&S.spaceLink()}),S.historyDisclosedVisible=n.observable(!1),E.historyService.isHistoryDisclosed.set.enabled.changed(S.historyDisclosedVisible),S.showSettings=n.computed(function(){return Boolean(S.historyDisclosedVisible()&&S.isAdmin()||S.joiningEnabledVisible()||S.spaceLinkVisible())}),S.dispose=function(){E.isJoiningEnabled.changed.off(S.joiningEnabled),E.historyService.isHistoryDisclosed.changed.off(S.historyDisclosed),E.isJoiningEnabled.set.enabled.changed.off(S.joiningEnabledVisible),E.historyService.isHistoryDisclosed.set.enabled.changed.off(S.historyDisclosedVisible),E.participantsCount.changed.off(L),r.dispose(),S.mailtoLink.dispose(),S.isAdmin.dispose(),S.groupProfileHeading.dispose(),S.spacesLinkAriaLabel.dispose(),S.joiningEnabledVisible.dispose(),S.spaceLinkVisible.dispose(),S.showSettings.dispose(),S.historyToggleAriaLabel.dispose(),S.joiningToggleAriaLabel.dispose()},S.leaveConversation=function(){m.start(S.model,a.telemetry.leaveConversation.cta.PROFILE)},S.handleLeaveConversationKeyUp=function(e,t){var n=p.isActivation(t);n&&S.leaveConversation()},S.removeConversationText=function(){var e="recentItemMenuItem_text_remove";return O()?s.fetch({key:M(e)}):s.fetch({key:e})},S.removeConversation=function(){g.start(S.model,a.telemetry.removeConversationHistory.cta.PROFILE)},S.handleRemoveConversationKeyUp=function(e,t){var n=p.isActivation(t);n&&S.removeConversation()},S.onHistoryDisclosedKeydown=function(e,t){var n=p.isActivation(t);return n&&S.historyDisclosedHandler(),!n},S.historyDisclosedHandler=function(){var e=S.historyDisclosed();E.historyService.isHistoryDisclosed.set(!e).catch(function(){})},S.onJoiningEnabledKeydown=function(e,t){var n=p.isActivation(t);return n&&S.joiningEnabledHandler(),!n},S.joiningEnabledHandler=function(){var e=S.joiningEnabled();E.isJoiningEnabled.set(!e).catch(function(){})},S.spaceMenuHandler=function(e,t){function o(){v.setHref(S.mailtoLink())}var n,r,i=[];n=new h(w.CopyLinkMenuItemType,s.fetch({key:"header_text_copyLink"})),i.push(n),r=new h(w.SendViaEmailMenuItemType,s.fetch({key:"header_text_inviteViaEmail"}),o),i.push(r),f.show(i,t)},S.onScroll=t.debounce(k,1e3,{leading:!0,trailing:!1}),S.init=function(){r.init(),S.forwardEvent(i.conversation.COPY_LINK,S.DIRECTION.PARENT),S.forwardEvent(i.conversation.EMAIL_LINK,S.DIRECTION.PARENT)}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/eventMixin"),i=e("constants/common").events,s=e("swx-i18n").localization,o=e("swx-enums"),u=e("services/serviceLocator"),a=e("constants/common"),f=e("ui/contextMenu/contextMenu"),l=e("utils/common/cafeObservable"),c=e("utils/chat/spaceMail"),h=e("ui/contextMenu/menuItem"),p=e("utils/common/eventHelper"),d=e("services/pubSub/pubSub"),v=e("utils/common/location"),m=e("ui/modalDialog/leaveConversationDialog"),g=e("ui/modalDialog/removeConversationHistoryDialog"),y=e("ui/modelHelpers/personHelper"),b=e("cafe/applicationInstance");return t.assign(w.prototype,r),w.CopyLinkMenuItemType="CopyLinkMenuItem",w.SendViaEmailMenuItemType="SendViaEmailMenuItemType",w}),define("text!views/chat/groupProfile.html",[],function(){return'<div class="groupProfile fixSmall">\r\n    <swx-avatar params="isGroupAvatar: true, size: 220, avatar: avatar"></swx-avatar>\r\n    <div class="settings" data-bind=\'css: { lessParticipants: lessParticipants }\'>\r\n        <!-- ko if: showSettings -->\r\n        <h4 data-bind="text: groupProfileHeading" class="fontSize-p">Manage group</h4>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: canLeaveConversation -->\r\n        <div class="settingItem fontSize-p">\r\n            <span>\r\n                <a href="#" role="button" data-bind="click: leaveConversation, l10n: {key: \'recentItemMenuItem_text_leave\'}"></a>\r\n            </span>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: canRemoveConversation -->\r\n        <div class="settingItem fontSize-p">\r\n            <span>\r\n                <a href="#" role="button" data-bind="click: removeConversation, l10n: {key: removeConversationText()}"></a>\r\n            </span>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: historyDisclosedVisible() && isAdmin() -->\r\n        <div class="settingItem">\r\n            <span id="makeHistoryAvailable" class="fontSize-h4" data-bind="l10n: {key: \'header_text_makeHistoryAvailable\'}"></span>\r\n            <button role="checkbox" aria-labelledby="makeHistoryAvailable" class="toggler" data-bind="event: { keydown: onHistoryDisclosedKeydown }, click: historyDisclosedHandler, css: { checked: historyDisclosed }, attr: { \'aria-checked\': historyDisclosed() ? \'true\' : \'false\', \'aria-label\': historyToggleAriaLabel }" type="button"><span class="on"></span><span class="off"></span></button>\r\n        </div>\r\n        <!-- /ko -->\r\n        <!-- ko if: joiningEnabledVisible -->\r\n        <div class="settingItem">\r\n            <span id="joinViaLink" class="fontSize-h4" data-bind="l10n: {key: \'header_text_joinViaLink\'}"></span>\r\n            <button role="checkbox" aria-labelledby="joinViaLink" class="toggler" data-bind="event: { keydown: onJoiningEnabledKeydown }, click: joiningEnabledHandler, css: { checked: joiningEnabled }, attr: { \'aria-checked\': joiningEnabled() ? \'true\' : \'false\', \'aria-label\': joiningToggleAriaLabel }" type="button"><span class="on"></span><span class="off"></span></button>\r\n        </div>\r\n        <!-- /ko -->\r\n        <!-- ko if: spaceLinkVisible -->\r\n        <div class="space settingItem">\r\n            <swx-invite-link class="invite-link" params="topic: model.topic, uri: model.uri">\r\n            </swx-invite-link>\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n    <!-- ko if: participantCount -->\r\n    <div class="scrollingContainer participants" style="width:auto; overflow: hidden !important;" data-bind="keyboardNavigation: { itemSelector: \'a\' }">\r\n        <div role="list" id="groupParticipantsList" class="scrollViewport scrollViewportV" style="position: relative !important; max-height: 11em;" data-bind="event: { scroll: onScroll }, css: { lessParticipants: lessParticipants }, foreach: participants" tabindex="-1">\r\n            <swx-contact-card params="participant: $data, model: $parent.model" class="participant"></swx-contact-card>\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/chat/groupProfile",["require","exports","module","browser/dom","utils/common/scroll","ui/viewModels/chat/groupProfile","vendor/knockout","constants/components","text!views/chat/groupProfile.html"],function(e,t){function o(e,t){var o=n.getElement(".scrollingContainer",t.element),u=r.build(o),a=s.dataFor(t.element),f=new i(e,u);return f.setContext(a),f.init(),f}var n=e("browser/dom"),r=e("utils/common/scroll"),i=e("ui/viewModels/chat/groupProfile"),s=e("vendor/knockout");t.name=e("constants/components").chat.GROUP_PROFILE,t.template=e("text!views/chat/groupProfile.html"),t.viewModel={createViewModel:o}}),define("utils/people/personPropertyFormatter",["require","exports","module","lodash-compat"],function(e,t){var n=e("lodash-compat"),r=15;t.getId=function(e){if(n.isString(e))return e.replace(/^((\d+):)+/,"")},t.truncateDisplayName=function(e,t){t||(t=r);if(!e)return e;if(e.length<=t)return e.trim();var n=e.substring(0,t).lastIndexOf(" ");return n===-1&&(n=t),e.substring(0,n).trim()}}),define("ui/viewModels/chat/isTypingIndicator",["require","vendor/knockout","constants/common","utils/common/array","lodash-compat","swx-i18n","services/serviceLocator","utils/people/personPropertyFormatter"],function(e){var t=e("vendor/knockout"),n=e("constants/common"),r=e("utils/common/array"),i=e("lodash-compat"),s=n.isTyping,o=e("swx-i18n").localization,u=e("services/serviceLocator"),a=e("utils/people/personPropertyFormatter");return function(f){function m(){function r(n){e.length<s.DETAILED_PARTICIPANTS_MAX_COUNT?e.push(n.person):t++}function i(e){return a.truncateDisplayName(e.displayName())}var e=[],t=0,n;h.forEach(r),n=e.length+t,l.typingParticipantsCount(n);switch(n){case 0:return"";case 1:return l.avatar(null),l.avatar(e[0].avatarUrl()),o.fetch({key:"typingIndicator_label_oneParticipant",params:{firstParticipantName:i(e[0])}});case 2:return l.avatar(null),o.fetch({key:"typingIndicator_label_twoParticipants",params:{firstParticipantName:i(e[0]),secondParticipantName:i(e[1])}});default:return l.avatar(null),o.fetch({key:"typingIndicator_label_multipleParticipants",params:{firstParticipantName:i(e[0]),secondParticipantName:i(e[1])},count:t})}}function g(e,t){t?h.push(e):h=i.without(h,e),l.isTypingLabel(m())}function y(e){e.__isTypingSubscription=e.chat.isTyping.changed(g.bind(null,e))}function b(e){var t=i.indexOf(h,e);t>-1&&(r.removeFrom(h,t),l.isTypingLabel(m())),w(e)}function w(e){e.__isTypingSubscription&&(e.__isTypingSubscription.dispose(),delete e.__isTypingSubscription)}var l=this,c=f.participants,h=[],p=u.resolve(n.serviceLocator.FEATURE_FLAGS),d,v;this.avatar=t.observable(""),this.typingParticipantsCount=t.observable(0),this.isTypingLabel=t.observable(""),this.isFeatureOn=p.isFeatureOn(n.featureFlags.IS_TYPING_INDICATOR),d=c.added(y),v=c.removed(b),this.dispose=function(){d.dispose(),v.dispose(),c.each(w)}}}),define("text!views/chat/isTypingIndicator.html",[],function(){return'<div class="typing" data-bind="css: { active: typingParticipantsCount() > 0 }">\r\n    <!-- ko if: isFeatureOn -->\r\n        <div class="grid margin">\r\n            <div class="indicator">\r\n                <swx-avatar-deprecated params="avatar: avatar" class="avatar"></swx-avatar-deprecated>\r\n                <span class="text">\r\n                    <p class="small" data-bind="html: isTypingLabel"></p>\r\n                </span>\r\n            </div>\r\n        </div>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/chat/isTypingIndicator",["require","exports","module","constants/components","ui/viewModels/chat/isTypingIndicator","text!views/chat/isTypingIndicator.html"],function(e,t){t.name=e("constants/components").chat.TYPING_INDICATOR,t.viewModel=e("ui/viewModels/chat/isTypingIndicator"),t.template=e("text!views/chat/isTypingIndicator.html")}),define("text!views/chat/timeline/currentCall.html",[],function(){return'<a data-bind="event: { click: model.handleClick }, css: {read: model.isRead(), unread: !model.isRead(), \'active themeBlue\': model.isActive(), group: model.isGroupConversation, joinCall: model.canJoinCall}" class="recent">\r\n\r\n    <swx-avatar-deprecated params="isCalling: true, isGroupAvatar: model.isGroupConversation, avatar: model.avatarUrl, status: model.statusClassName" class="avatar"></swx-avatar-deprecated>\r\n\r\n    <div class="text">\r\n        <span class="tile">\r\n            <span class="tileName">\r\n                <h4 data-bind="text: model.topic"></h4>\r\n            </span>\r\n        </span>\r\n\r\n        <div class="message callduration">\r\n            <p data-bind="text: model.callDuration, css:{\'iconfont callStart\': model.callDuration() === \'\'}">00:00</p>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- ko ifnot: model.isRead -->\r\n    <swx-unread-message-counter params="model:model"></swx-unread-message-counter>\r\n    <!-- /ko -->\r\n\r\n    <span class="controls">\r\n        <swx-current-call-actions params="conversationModel:model.conversation"></swx-current-call-actions>\r\n    </span>\r\n</a>\r\n'}),define("ui/components/chat/currentCall",["require","exports","module","constants/components","text!views/chat/timeline/currentCall.html"],function(e,t){t.name=e("constants/components").chat.CURRENT_CALL,t.template=e("text!views/chat/timeline/currentCall.html")}),define("text!views/chat/unreadMessageCounter.html",[],function(){return'<span class="counter"  data-bind="css: {complexNotification: model.unreadActivityItemsWithKeywordsCount() && model.unreadActivityItemsCount()}">\r\n    <!-- ko if: model.unreadActivityItemsCount()-->\r\n    <span class="circle" data-bind="css: {lightNotification: !model.notificationEnabled()}">\r\n        <p class="fontSize-h4" data-bind="text: model.unreadActivityItemsCount(), css: {light: !model.notificationEnabled()}">1</p>\r\n    </span>\r\n    <!-- /ko -->\r\n    <!-- ko if: model.unreadActivityItemsWithKeywordsCount()-->\r\n    <span class="circle with-keywords">\r\n        <p class="fontSize-h4" data-bind="text: model.unreadActivityItemsWithKeywordsCount">1</p>\r\n    </span>\r\n    <!-- /ko -->\r\n</span>\r\n'}),define("ui/components/chat/unreadMessageCounter",["require","exports","module","constants/components","text!views/chat/unreadMessageCounter.html"],function(e,t){t.name=e("constants/components").chat.UNREAD_MESSAGE_COUNTER,t.template=e("text!views/chat/unreadMessageCounter.html")}),define("ui/viewModels/chat/currentCallActions",["require","lodash-compat","utils/common/eventMixin","ui/viewModels/chat/conversationActivity"],function(e){function i(e){var t=this,n=e.conversationModel,i;i=r.build(n),t.conversation=n,t.isOnCall=i.isOnCall,t.canJoinCall=i.canJoinCall,t.dispose=function(){i.dispose()}}var t=e("lodash-compat"),n=e("utils/common/eventMixin"),r=e("ui/viewModels/chat/conversationActivity");return t.assign(i.prototype,n),i}),define("text!views/chat/timeline/currentCallActions.html",[],function(){return"<!-- ko if: canJoinCall -->\r\n    <swx-joincall-button params=\"cssClass:'btn small primary green circle', conversationModel:conversation, showIcon:true\"></swx-joincall-button>\r\n<!-- /ko -->\r\n\r\n<!-- ko if: isOnCall -->\r\n    <!-- ko control: { name: 'muteControl', model: { conversation: conversation, isInCallScreen: false } } --> <!-- /ko -->\r\n    <!-- ko control: { name: 'endCallControl', model: { conversation: conversation, isInCallScreen: false } } --> <!-- /ko -->\r\n<!-- /ko -->\r\n"}),define("ui/components/chat/currentCallActions",["require","exports","module","vendor/knockout","ui/viewModels/chat/currentCallActions","constants/components","text!views/chat/timeline/currentCallActions.html"],function(e,t){function i(e,t){var i=new r(e);return i.setContext(n.dataFor(t.element)),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/currentCallActions");t.name=e("constants/components").chat.CURRENT_CALL_ACTIONS,t.template=e("text!views/chat/timeline/currentCallActions.html"),t.viewModel={createViewModel:i}}),define("text!views/chat/timeline/recentItem.html",[],function(){return'<a href="#" role="listitem" data-bind="event: { click: model.handleClick, contextmenu: model.showContextMenu }, attr: {\'aria-label\':model.ariaLabel }, css: model.cssClass" class="recent unread" tabindex="-1">\r\n    <swx-avatar-deprecated params="isGroupAvatar: model.isGroupConversation, isAgent: model.isAgent, avatar: model.avatarUrl, status: model.statusClassName, isPstn: model.isPstn" class="avatar"></swx-avatar-deprecated>\r\n    <div class="text">\r\n        <span class="arrow"></span>\r\n        <span class="tile">\r\n            <span class="tileName">\r\n                <h4>\r\n                    <span class="topic" data-bind="text: model.topic, attr: {title: model.topic}"></span>\r\n                    <!-- ko if: model.isCertifiedAgent -->\r\n                    <span class="iconfont avatarBotCertified"></span>\r\n                    <!-- /ko -->\r\n                </h4>\r\n            </span>\r\n        </span>\r\n\r\n        <!-- ko if: model.isRead -->\r\n        <span class="tile">\r\n            <span class="tileMessage circle">\r\n                <!-- ko if: model.displayMessage() -->\r\n                <div class="message">\r\n                    <p data-bind="html: model.displayMessage" tabindex="-1"></p>\r\n                </div>\r\n                <!-- /ko -->\r\n            </span>\r\n        </span>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: model.displayUnseenHeartsIcon() || !model.isRead() -->\r\n        <div class="unseenNotifications">\r\n            <!-- ko if: model.displayUnseenHeartsIcon -->\r\n            <span class="circleHeart">\r\n                <span class="iconfont heart"></span>\r\n            </span>\r\n            <!-- /ko -->\r\n            <!-- ko ifnot: model.isRead -->\r\n            <swx-unread-message-counter params="model:model"></swx-unread-message-counter>\r\n            <!-- /ko -->\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko ifnot: model.isRead -->\r\n        <div class="message">\r\n            <p data-bind="html: model.content" class="small" tabindex="-1"></p>\r\n\r\n            <!-- ko if: model.isLiveSession -->\r\n            <div class="callAction">\r\n                <div class="iconfont" data-bind="css: model.callAction"></div>\r\n            </div>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: model.isInfoMessage -->\r\n            <div class="infoMessage">\r\n                <div class="iconfont" data-bind="css: model.infoType"></div>\r\n            </div>\r\n            <!-- /ko -->\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n</a>\r\n'}),define("ui/components/chat/recentItem",["require","exports","module","constants/components","text!views/chat/timeline/recentItem.html"],function(e,t){t.name=e("constants/components").chat.RECENT_ITEM,t.template=e("text!views/chat/timeline/recentItem.html")}),define("ui/viewModels/chat/pes/expressionPicker",["require","lodash-compat","vendor/knockout","browser/dom","utils/common/async","constants/common","utils/common/eventMixin","utils/common/eventHelper","constants/keys","services/pubSub/pubSub","browser/document","services/serviceLocator","swx-i18n"],function(e){function d(e,u,d){function w(){i.execute(function(){v.isOpened(!1)}),c.body.removeEventListener("click",C,!0),v.dispatchEvent(o.expressionPicker.CLOSE_REQUEST,{},v.DIRECTION.CHILD)}function E(e){return{tabs:[],isSelected:n.observable(e)}}function S(e){if(e.length<7){var t=E(!0);return t.tabs=e,[t]}var n=e.reduce(function(e,t,n){var r=e[e.length-1];return r.tabs.length>=4&&n!==4&&(r=E(!1),e.push(r)),r.tabs.push(t),e},[E(!0)]),r=n[n.length-1];return r.tabs.length===1&&(n[n.length-2].tabs.push(r.tabs[0]),n.pop()),n}function x(){var e=v.pagedTabs().length,t=v.selectedPageIndex();if(e===1)return"singlePage";var n="page"+t;return t===e-1?n+" last":n}function T(){var e=v.selectedPageIndex()+1;e<v.pagedTabs().length&&k(e)}function N(){var e=v.selectedPageIndex()-1;e>=0&&k(e)}function C(e){var t=!r.getParentWithClass(e.target,"expressionPicker");t&&w()}function k(e){v.selectedPageIndex(e);var t=v.pagedTabs();t.forEach(function(t,n){t.isSelected(n===e)})}function L(e){u.forEach(function(e){e.active&&e.active(!1)}),e.active&&e.active(!0),v.selectedTab(e)}function A(){v.switchTab(u.length>1?u[1]:u[0])}function O(){v.forwardEvent(o.expressionPicker.ITEM_PREVIEW_REQUEST,v.DIRECTION.CHILD),v.forwardEvent(o.expressionPicker.ITEM_SELECT_REQUEST,v.DIRECTION.CHILD),v.forwardEvent(o.expressionPicker.ITEM_CANCEL_REQUEST,v.DIRECTION.CHILD),v.forwardEvent(o.expressionPicker.CLOSE_REQUEST,v.DIRECTION.CHILD,w),v.registerEvent(o.expressionPicker.ITEM_SEND_REQUEST,function(t){l.publish(o.expressionPicker.ITEM_SEND_REQUEST,{item:t,conversation:g,sourceTab:v.selectedTab()})}),l.subscribe(o.expressionPicker.MRUITEM_ADD_REQUEST,P),l.subscribe(o.expressionPicker.MRUITEM_ADD_EMOTICON_REQUEST,D),l.subscribe(o.personalExpression.CONFIG_PROCESSED,M)}function M(e){var t=u?u.indexOf(v.selectedTab()):0;if(t<0||t>=e.tabs.length)t=0;u=e.tabs,v.pagedTabs(S(u)),v.switchTab(e.tabs[t])}function D(e){e.forEach(function(e){m.addItemToMru(e)})}function P(e){m.addItemToMru(e.id)}function H(){return c.querySelector(b)}function B(){var e=H();e&&e.focus()}function j(){return c.querySelector(y)}function F(){var e=j();e&&e.focus()}var v=this,m=h.resolve(s.serviceLocator.PES_CONFIG_SERVICE),g=d,y=".swx .chat .inputField",b=".emoticon-picker-button";v.isDisabled=n.isObservable(e)?e:n.observable(e),v.isOpened=n.observable(!1),v.isSelected=n.observable(!1),v.pagedTabs=n.observableArray(S(u)),v.selectedPageIndex=n.observable(0),v.selectedTab=n.observable(u[0]),v.tabsCss=n.computed(x),v.prevPageTitle=p.fetch({key:"expressionPicker_prevPage"}),v.nextPageTitle=p.fetch({key:"expressionPicker_nextPage"}),v.init=function(){O(),A()},v.nextPage=function(){T(!1)},v.openBubble=function(){v.isOpened()||(A(),v.isOpened(!0),c.body.addEventListener("click",C,!0),v.dispatchEvent(o.expressionPicker.OPEN_REQUEST,{},v.DIRECTION.CHILD))},v.onTabKeyDown=function(e,t){var n,r,i=a.getKeyCode(t);if(i===f.ESCAPE)return!0;if(!a.isActivation(t))return!0;if(v.selectedTab().title===e.title)return v.dispatchEvent(o.expressionPicker.TAB_SELECT_REQUEST,{},v.DIRECTION.CHILD),a.swallow(t),!1;for(n=0;n<u.length;n++){r=u[n];if(r.title===e.title)return v.switchTab(r),!1}return!0},v.onNextKeyDown=function(t,n){var r=a.getKeyCode(n);return r===f.ESCAPE?!0:a.isActivation(n)?(T(!0),a.swallow(n),!1):!0},v.onPrevKeyDown=function(t,n){var r=a.getKeyCode(n);return r===f.ESCAPE?!0:a.isActivation(n)?(N(!0),a.swallow(n),!1):!0},v.prevPage=function(){N(!1)},v.switchTab=function(n){if(n){v.dispatchEvent(o.expressionPicker.ITEM_CANCEL_REQUEST,{},v.DIRECTION.CHILD),L(n);var r=t.findIndex(v.pagedTabs(),function(e){return e.tabs.indexOf(n)!==-1});k(r)}},v.handleKeyDown=function(e,t){var n=a.getKeyCode(t),r;if(n===f.ESCAPE&&v.isOpened()){t.stopPropagation(),w(),B();return}r=H();if(n===f.ESCAPE&&c.activeElement===r){t.stopPropagation(),F();return}return!0},v.dispose=function(){l.unsubscribe(o.expressionPicker.MRUITEM_ADD_REQUEST,P),l.unsubscribe(o.expressionPicker.MRUITEM_ADD_EMOTICON_REQUEST,D),l.unsubscribe(o.personalExpression.CONFIG_PROCESSED,M)}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("browser/dom"),i=e("utils/common/async"),s=e("constants/common"),o=s.events,u=e("utils/common/eventMixin"),a=e("utils/common/eventHelper"),f=e("constants/keys"),l=e("services/pubSub/pubSub"),c=e("browser/document"),h=e("services/serviceLocator"),p=e("swx-i18n").localization;return t.assign(d.prototype,u),d.build=function(e,t,n){return new d(e,t,n)},d}),define("text!views/chat/pes/expressionPicker.html",[],function(){return'<div class="wrapper swx-expression-picker" data-bind="event: {keydown: handleKeyDown}">\r\n    <swx-button params="icon: \'emoticonStroke\', cssClass: \'transparent circle emoticon-picker-button large\', disabled: isDisabled,\r\n                        titleKey: \'button_title_emoticons\', textKey: \'button_text_emoticons\', action: openBubble,\r\n                        ariaLabelKey: \'emoticonPicker_heading_label\'"></swx-button>\r\n    <div class="bubble popup arrow down" data-bind="css: { active: isOpened }">\r\n\r\n        <swx-expressionitem-roster></swx-expressionitem-roster>\r\n        <div class="infoLine"></div>\r\n\r\n        <swx-expressionitems-picker params="context:selectedTab"></swx-expressionitems-picker>\r\n\r\n        <div class="infoLine"></div>\r\n        <div class="tabs" data-bind="css: tabsCss">\r\n            <span class="prev" data-bind="event: { click: prevPage, keydown: onPrevKeyDown },\r\n                                          attr: {\r\n                                              \'title\': prevPageTitle,\r\n                                              \'aria-label\': prevPageTitle\r\n                                          }">\r\n                <span class="tab"></span>\r\n            </span>\r\n            <span class="tabsWrapper">\r\n                <span class="container" data-bind="template: { name: \'tabs-page-template\', foreach: pagedTabs, as: \'page\' }, keyboardNavigation: { itemSelector: \'.tab-item\' }"></span>\r\n            </span>\r\n            <span class="next" data-bind="event: { click: nextPage, keydown: onNextKeyDown },\r\n                                          attr: {\r\n                                              \'title\': nextPageTitle,\r\n                                              \'aria-label\': nextPageTitle\r\n                                          }">\r\n                <span class="tab"></span>\r\n            </span>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<script type="text/html" id="tabs-page-template">\r\n    <span class="tabPage" data-bind="template: { name: \'tab-template\', foreach: page.tabs, as: \'tab\' }, css: { selected: page.isSelected}"></span>\r\n</script>\r\n\r\n<script type="text/html" id="tab-template">\r\n    <span data-bind="attr: {\r\n                    \'data-name\': tab.id,\r\n                    \'title\': tab.title,\r\n                    \'aria-label\': tab.ariaLabel\r\n                   },\r\n                   event: {\r\n                    click: $parents[1].switchTab,\r\n                    keydown: $parents[1].onTabKeyDown,\r\n                    mouseover: onMouseOver,\r\n                    mouseout: onMouseOut\r\n                   }"\r\n        aria-live="polite" role="listitem" class="tab-item">\r\n        <span data-bind="css: tab.htmlClass"></span>\r\n    </span>\r\n</script>\r\n'}),define("ui/components/chat/pes/expressionPicker",["require","exports","module","vendor/knockout","constants/common","ui/viewModels/chat/pes/expressionPicker","services/pes/configProcessor","services/pubSub/pubSub","services/serviceLocator","browser/window","constants/components","text!views/chat/pes/expressionPicker.html"],function(e,t){function h(){return f}function p(e){f=e}function d(e){var t=s.prefetch(e);s.prefetchImages(t)}function v(e){l?a.setTimeout(d.bind(null,e),5e3):o.subscribe(r.apiUIEvents.SWX_TIMELINE_LOADED,function t(){l=!0,o.unsubscribe(r.apiUIEvents.SWX_TIMELINE_LOADED,t),a.setTimeout(d.bind(null,e),5e3)})}function m(){var e=t._getCachedModel(),n=u.resolve(r.serviceLocator.PES_CONFIG_SERVICE);return e||(e=n.getConfiguration(),s.process(e),t._setCachedModel(e),v(e),o.publish(c.personalExpression.CONFIG_PROCESSED,e)),e}function g(e,r){var s=r.element,o=n.dataFor(s),u=t._cachedViewModel().tabs,a=i.build(e.isDisabled,u,o.conversationModel);return a.setContext(o),a.init(),a}function y(){var e=u.resolve(r.serviceLocator.PES_CONFIG_SERVICE),n=e.getConfiguration();s.process(n),t._setCachedModel(n),v(n),o.publish(c.personalExpression.CONFIG_PROCESSED,n)}var n=e("vendor/knockout"),r=e("constants/common"),i=e("ui/viewModels/chat/pes/expressionPicker"),s=e("services/pes/configProcessor"),o=e("services/pubSub/pubSub"),u=e("services/serviceLocator"),a=e("browser/window"),f,l=!1,c=r.events;o.subscribe(c.personalExpression.CONFIG_INITIALIZED,y),t.name=e("constants/components").chat.EXPRESSION_PICKER,t.template=e("text!views/chat/pes/expressionPicker.html"),t.viewModel={createViewModel:g},t._cachedViewModel=m,t._getCachedModel=h,t._setCachedModel=p}),define("services/pes/utils",[],function(){function e(){this.getConfigItem=function(e,t){function o(t){for(i=0;i<t.items.length;i++){s=t.items[i];if(s.id===e)return s}}function u(e){for(r=0;r<e.packs.length;r++){s=o(e.packs[r]);if(s)return s}}var n,r,i,s;for(n=0;n<t.tabs.length;n++){s=u(t.tabs[n]);if(s)return s}}}return new e}),define("ui/viewModels/chat/pes/itemsPicker",["require","lodash-compat","utils/common/async","utils/common/eventMixin","constants/common","vendor/knockout","services/pes/constants","services/pes/utils"],function(e){function a(e,r){function h(){var e=a.tab(),n={packs:[]};return e.packs.forEach(function(e){var r=t.find(e.items,function(e){return a.isItemVisible(e)});if(!e.isHidden&&r){var i={title:e.title,id:e.id,ariaLabel:e.ariaLabel,items:[]};n.packs.push(i),e.items.forEach(function(e){a.isItemVisible(e)&&i.items.push(e)})}}),n}function p(){return a.tab().id===o.mru.TAB_ID&&a.tabVM().packs.length===0}function d(e,t){var n;if(!t||!t.type)n=e.target.getAttribute("data-id"),t=u.getConfigItem(n,{tabs:[a.tab()]});switch(t.type){case"emoticon":case"flik":t.isLocked()?(a.dispatchEvent(i.expressionPicker.ITEM_SEND_REQUEST,t,a.DIRECTION.PARENT),a.dispatchEvent(i.expressionPicker.CLOSE_REQUEST,t,a.DIRECTION.PARENT)):a.dispatchEvent(i.expressionPicker.ITEM_SELECT_REQUEST,t,a.DIRECTION.PARENT);break;case"sticker":throw new Error("Not implemented support for stickers, yet");default:throw new Error("Not supported item type:"+t.type)}}function v(e,t){return e=s.dataFor(t.target),t.relatedTarget&&e===s.dataFor(t.relatedTarget)?null:!e||!e.isLocked?null:e}function m(e){return e.stopPropagation(),!1}var a=this,f={onOver:function(t,n){if(t.isLocked())return;return n.target.focus(),m(n)},onOut:function(t,n){if(!t.isLocked())return;return a.dispatchEvent(i.expressionPicker.ITEM_CANCEL_REQUEST,t,a.DIRECTION.PARENT),m(n)},onClick:function(t,n){return d(n,t),m(n)}},l={onOver:function(){},onOut:function(){},onClick:function(t,n){return t.isLocked()?d(n,t):n.target.focus(),c=f,m(n)}},c=f;a.isItemVisible=function(e){return e.visible||a.tab().showHiddenItems},a.tab=e.context,a.tabVM=s.computed(h),a.showEmptyMruTabMessage=s.computed(p),a.navigateContext={},a.tab.subscribe(function(){n.execute(function(){a.navigateContext.startup=!0})}),a.init=function(){r.init(),a.registerEvent(i.expressionPicker.OPEN_REQUEST,function(){r.adjustToRTLLayout()})},a.onMouseOver=function(e,t){var n=v(e,t);if(!n)return;return c.onOver(n,t)},a.onMouseOut=function(e,t){var n=v(e,t);if(!n)return;return c.onOut(n,t)},a.onMouseClick=function(e,t){var n=v(e,t);if(!n)return;return c.onClick(n,t)},a.onEnterKey=function(e,t){var n=v(e,t);if(!n)return;return t.stopPropagation(),t.preventDefault(),c.onClick(n,t)},a.onTouchEnd=function(t,n){var r=v(t,n);if(!r)return;return l.onClick(r,n)},a.onPointerOver=function(t,n){n.pointerType==="touch"&&(c=l)},a.dispose=function(){r.dispose(),a.showEmptyMruTabMessage.dispose()}}var t=e("lodash-compat"),n=e("utils/common/async"),r=e("utils/common/eventMixin"),i=e("constants/common").events,s=e("vendor/knockout"),o=e("services/pes/constants"),u=e("services/pes/utils");return t.assign(a.prototype,r),a}),define("text!views/chat/pes/itemsPicker.html",[],function(){return'<div class="picker"\r\n     data-bind="event: {\r\n      focus: onMouseOver,\r\n      blur: onMouseOut,\r\n      touchend: onTouchEnd,\r\n      pointerover: onPointerOver,\r\n      click: onMouseClick\r\n     }, enterKey: onEnterKey">\r\n    <span class="mrutext"\r\n          data-bind="l10n: {key: \'expressionPicker_mruTab_emptyText\'}, css:{hide:!showEmptyMruTabMessage()}"></span>\r\n    <ul class="picker-list scrollViewport scrollViewportV"\r\n        data-bind="template: {name: \'pack-template\', foreach: tabVM().packs, as: \'pack\'}">\r\n    </ul>\r\n</div>\r\n\r\n<script type="text/html" id="pack-template">\r\n    <span class="tile">\r\n        <span class="tileName"><h4 data-bind="text:pack.title"></h4></span>\r\n    </span>\r\n\r\n    <li data-bind="attr: { \'data-name\': pack.id, \'aria-label\': pack.ariaLabel }"\r\n        role="listitem" class="picker-pack">\r\n        <ul class="picker-pack-items" data-bind="template: { name: \'item-template\', foreach: pack.items, as: \'item\' }, keyboardNavigation: { itemSelector: \'.picker-item\' }"></ul>\r\n    </li>\r\n</script>\r\n\r\n<script type="text/html" id="item-template">\r\n    <li data-bind="attr: { \'data-id\': item.id, \'aria-label\': item.ariaLabel }, css: item.type"\r\n        role="listitem" class="picker-item">\r\n\r\n        <!-- ko if: item.type === \'emoticon\' -->\r\n        <span\r\n            data-bind="css: item.staticHtmlClass"\r\n            class="emoticon">\r\n            <span class="emoSprite"></span></span>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: item.type === \'flik\' -->\r\n        <span data-bind="css: item.thumbnailClass" class="moji">\r\n            <span class="mojimask small"></span><span class="mojiThumbnail"></span>\r\n            <a class="actionButtons iconfont send mojisend" data-bind="visible: item.isLocked"></a>\r\n        </span>\r\n        <!-- /ko -->\r\n\r\n    </li>\r\n</script>\r\n\r\n'}),define("ui/components/chat/pes/itemsPicker",["require","exports","module","vendor/knockout","ui/viewModels/chat/pes/itemsPicker","utils/common/scroll","browser/dom","constants/components","text!views/chat/pes/itemsPicker.html"],function(e,t){function o(e,t){var o=t.element,u=i.build(s.getElement(".picker",o)),a=n.dataFor(o),f=new r(e,u);return f.setContext(a),f.init(),f}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/pes/itemsPicker"),i=e("utils/common/scroll"),s=e("browser/dom");t.name=e("constants/components").chat.EXPRESSION_ITEMS_PICKER,t.template=e("text!views/chat/pes/itemsPicker.html"),t.viewModel={createViewModel:o}}),define("ui/viewModels/chat/pes/itemRoster",["require","lodash-compat","vendor/knockout","swx-i18n","constants/common","utils/common/eventMixin","services/pes/constants"],function(e){function u(){function s(t){e.item(t)}function u(t){if(t===e.item()&&t.isPlaying&&t.isPlaying())return;e.lockedItem&&e.lockedItem.isLocked(!1),e.item(t),t.isLocked(!0),e.lockedItem=t,e.play()}function a(){e.registerEvent(i.expressionPicker.ITEM_PREVIEW_REQUEST,s),e.registerEvent(i.expressionPicker.ITEM_SELECT_REQUEST,u),e.registerEvent(i.expressionPicker.ITEM_CANCEL_REQUEST,e._pauseVideo),e.registerEvent(i.expressionPicker.CLOSE_REQUEST,e._reset)}var e=this,t=r.fetch({key:"emoticonPicker_heading_label"});e.item=n.observable(),e.lockedItem=null,e._pauseVideo=function(){var t=document.querySelector("video.moji.preview");t&&t.pause&&t.pause(),e.lockedItem&&e.lockedItem.isLocked(!1),e.lockedItem=null},e._reset=function(){e._pauseVideo(),e.item({type:"",description:t,copyright:"",isLocked:function(){return!1},isPlaying:function(){return!1}})},e.init=function(){a(),e._reset()},e.dispose=function(){e._reset()},e.play=function(){function r(){t.isPlaying(!1),t.isPlayed(!0),t.onPlayed(),n.removeEventListener("ended",r),n.removeEventListener("pause",i)}function i(){t.isPlaying(!1),t.isPlayed(!0),t.onPlayed(),n.removeEventListener("ended",r),n.removeEventListener("pause",i)}var t=e.item(),n=document.querySelector("video.moji.preview");if(t.type!==o.itemTypes.moji.id)return;t.isPlaying(!0),n.play(),n.addEventListener("ended",r,!1),n.addEventListener("pause",i,!1)}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-i18n").localization,i=e("constants/common").events,s=e("utils/common/eventMixin"),o=e("services/pes/constants");return t.assign(u.prototype,s),u}),define("text!views/chat/pes/itemRoster.html",[],function(){return'<div class="wrapper roster">\r\n    <!-- ko if: item().type ===\'emoticon\' -->\r\n    <div class="largeAllowed large wrapper">\r\n        <span data-bind="css: item().animatedExtraLargeHtmlClass" class="emoticon"><span\r\n            class="emoSprite"></span></span>\r\n    </div>\r\n    <div class="info">\r\n        <p data-bind="text: item().description" class="smaller name"></p>\r\n\r\n        <p data-bind="text: item().shortcut" class="smaller text"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: item().type===\'flik\' -->\r\n    <div class="large wrapper">\r\n        <span data-bind="css: item().keyframeClass" class="moji preview">\r\n            <span class="keyframe" data-bind="css: {hide: item().isPlaying()}"></span>\r\n            <video class="moji preview" data-bind="css: {hide: !item().isPlaying()}, attr: { src:item().contentUrl }"\r\n                   tabindex="-1"></video>\r\n            <span class="mojimask preview"></span>\r\n        </span>\r\n    </div>\r\n    <div class="info">\r\n        <p data-bind="text: item().pickerTitle" class="smaller name"></p>\r\n\r\n        <p data-bind="text: item().copyright" class="smaller text"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: item().type===\'\' -->\r\n    <div class="info">\r\n        <p data-bind="text: item().description" class="smaller name"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n\r\n</div>\r\n'}),define("ui/components/chat/pes/itemRoster",["require","exports","module","vendor/knockout","ui/viewModels/chat/pes/itemRoster","constants/components","text!views/chat/pes/itemRoster.html"],function(e,t){function i(e,t){var i=t.element,s=n.dataFor(i),o=new r(e);return o.setContext(s),o.init(),o}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/pes/itemRoster");t.name=e("constants/components").chat.EXPRESSION_ITEM_ROSTER,t.template=e("text!views/chat/pes/itemRoster.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/conversationShareLink",["require","lodash-compat","utils/common/eventMixin","vendor/knockout","constants/common","services/serviceLocator","utils/common/cafeObservable","swx-i18n","ui/telemetry/actions/actionNames","utils/common/outsideClickHandler"],function(e){function c(e){function p(){t.isTooltipOpened(!0),f.add("conversationShareLink",d),h.recordAction(a.invites.shareButton,e.telemetryContext)}function d(){t.isTooltipOpened(!1),f.remove("conversationShareLink")}function v(){return t.conversationModel.uri}var t=this,n=s.resolve(i.serviceLocator.FEATURE_FLAGS),c=n.isFeatureOn(i.featureFlags.SPACES),h=s.resolve(i.serviceLocator.ACTION_TELEMETRY);t.isTooltipOpened=r.observable(!1),t.conversationModel=e.conversationModel,t.isJoiningEnabled=t.conversationModel.isJoiningEnabled?o.newObservableProperty(t.conversationModel.isJoiningEnabled):r.observable(!0),t.telemetryContext=e.telemetryContext,t.share=function(){t.isJoiningEnabled()&&!v()&&t.dispatchEvent(l.conversation.SHARED,function(e){t.conversationModel=e,t.isJoiningEnabled(c),t.conversationModel.uri.get()}),p()},t.joiningDisabledTextStart=function(){return u.fetch({key:"spaces_joining_disabled_message_start"})},t.joiningDisabledAnchorText=function(){return u.fetch({key:"spaces_joining_disabled_anchor_text"})},t.joiningDisabledTextEnd=function(){return u.fetch({key:"spaces_joining_disabled_message_end"})},t.showSettings=function(){t.dispatchEvent(l.conversation.OPEN_PROFILE,{editTopic:!1},t.DIRECTION.PARENT),d()},t.dispose=function(){t.isTooltipOpened()&&d()}}var t=e("lodash-compat"),n=e("utils/common/eventMixin"),r=e("vendor/knockout"),i=e("constants/common"),s=e("services/serviceLocator"),o=e("utils/common/cafeObservable"),u=e("swx-i18n").localization,a=e("ui/telemetry/actions/actionNames"),f=e("utils/common/outsideClickHandler"),l=i.events;return t.assign(c.prototype,n),c}),define("text!views/chat/conversationShareLink.html",[],function(){return'<div class="conversationShareLink">\r\n    <swx-button params="cssClass:\'shareButton circle classicShare\', disabled:false, action: share, textKey: \'action_button_share_conversation\', icon: \'share\'"></swx-button>\r\n\r\n    <swx-button params="cssClass:\'shareButton circle narrowShare\', disabled:false, action: share, textKey: \'share_on_skype_share_button\', icon: \'share\'"></swx-button>\r\n    <!-- ko if: isTooltipOpened -->\r\n    <div class="tooltip popup arrow down">\r\n        <!-- <span class="arrow"></span> -->\r\n        <!-- ko if: isJoiningEnabled -->\r\n        <span class="tooltipLabel fontSize-p" data-bind="l10n: { key: \'spaces_tooltip_text\'}"></span>\r\n        <swx-invite-link class="invite-link invite-link-narrow" params="topic: conversationModel.topic, uri: conversationModel.uri, telemetryContext: telemetryContext"></swx-invite-link>\r\n        <!-- /ko -->\r\n        <!-- ko ifnot: isJoiningEnabled -->\r\n        <div class="tooltipLabel fontSize-p">\r\n            <span data-bind="html:joiningDisabledTextStart()">\r\n            </span>\r\n\r\n            <a href="#" data-bind="click:showSettings, text:joiningDisabledAnchorText()"></a>\r\n\r\n            <span data-bind="html:joiningDisabledTextEnd()">\r\n            </span>\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/chat/conversationShareLink",["require","exports","module","vendor/knockout","ui/viewModels/chat/conversationShareLink","constants/components","text!views/chat/conversationShareLink.html"],function(e,t){function i(e,t){var i=new r(e);return i.setContext(n.dataFor(t.element)),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/conversationShareLink");t.name=e("constants/components").chat.CONVERSATION_SHARE_LINK,t.template=e("text!views/chat/conversationShareLink.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/selectedParticipantsConversation",["require","vendor/knockout","cafe/applicationInstance","services/pubSub/pubSub","constants/common","ui/telemetry/telemetryClient","experience/settings","constants/common"],function(e){function a(){function l(t){if(a)try{a.cancel("Another search triggered")}catch(n){s.get().sendEvent(o.telemetry.uiTenantToken,i.telemetry.promiseInvalidStateException.TYPE,{feature:i.telemetry.promiseInvalidStateException.feature.GROUP_SEARCH,exception:JSON.stringify(n)})}e.matchingConversations([]);if(t.length===0)return;t.length===1?c(t[0]):h(t)}function c(t){var r=t.getPerson(),i=n.get().conversationsManager.getConversation(r);e.matchingConversations([i])}function h(t){function o(e){return e.id()}function u(e,t){if(r.supportedKeywords().indexOf(e)<0)return;r.keywords[e]=t}function f(){if(a!==s)return;a=null,e.matchingConversations(r.results().map(function(e){return e.result}))}var r,i,s;i=t.map(o).join(" "),r=n.get().conversationsManager.createSearchQuery(),u("participantsByIds",i),s=r.getMore().then(f),a=s}var e=this,a,f;e.init=function(n){f=n.contacts.subscribe(l),e.matchingConversations=t.observableArray(),e.hasMatchingConversations=t.computed(function(){return e.matchingConversations().length>0})},e.dispose=function(){e.hasMatchingConversations.dispose(),f.dispose()},e.navigateToConversation=function(e){r.publish(u.navigation.OPEN_CONVERSATION,{model:e})}}var t=e("vendor/knockout"),n=e("cafe/applicationInstance"),r=e("services/pubSub/pubSub"),i=e("constants/common"),s=e("ui/telemetry/telemetryClient"),o=e("experience/settings"),u=e("constants/common").events;return a}),define("text!views/chat/selectedParticipantsConversation.html",[],function(){return'<div class="jumpToConversation" data-bind="css:{hide:!hasMatchingConversations()}">\r\n    <div class="topic">\r\n        <p data-bind="l10n: {key: \'label_jumpToConversation\'}">Jump to conversation</p>\r\n    </div>\r\n    <div data-bind="foreach: matchingConversations">\r\n        <swx-conversation-card params="conversationModel:$data, action:$parent.navigateToConversation"></swx-conversation-card>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/selectedParticipantsConversation",["require","exports","module","ui/viewModels/chat/selectedParticipantsConversation","constants/components","text!views/chat/selectedParticipantsConversation.html"],function(e,t){function r(e){var t=new n;return t.init(e),t}var n=e("ui/viewModels/chat/selectedParticipantsConversation");t.name=e("constants/components").chat.SELECTED_PARTICIPANTS_CONVERSATION,t.template=e("text!views/chat/selectedParticipantsConversation.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/conversationCard",["require","utils/common/cafeObservable"],function(e){function n(e){var n=this,r=e.conversationModel;n.topic=t.newObservableProperty(r.topic),n.isGroupConversation=t.newObservableProperty(r.isGroupConversation),n.avatarUrl=t.newObservableProperty(r.avatarUrl),n.statusClassName=null,n.action=function(){e.action&&e.action(r)}}var t=e("utils/common/cafeObservable");return n}),define("text!views/chat/conversationCard.html",[],function(){return'<div class="participant" role="button" data-bind="click: action">\r\n    <swx-avatar-deprecated params="isGroupAvatar: isGroupConversation, avatar: avatarUrl, status: statusClassName" class="avatar"></swx-avatar-deprecated>\r\n    <div class="text">\r\n        <span class="tile">\r\n            <span class="tileName">\r\n                <h4 data-bind="text: topic"></h4>\r\n            </span>\r\n        </span>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/conversationCard",["require","exports","module","ui/viewModels/chat/conversationCard","constants/components","text!views/chat/conversationCard.html"],function(e,t){function r(e){return new n(e)}var n=e("ui/viewModels/chat/conversationCard");t.name=e("constants/components").chat.CONVERSATION_CARD,t.template=e("text!views/chat/conversationCard.html"),t.viewModel={createViewModel:r}}),define("telemetry/chat/mediaPickerTelemetry",["require","exports","module","constants/common","experience/settings","ui/telemetry/telemetryClient"],function(e,t){function o(){function o(){e.data={paperclipButtonClicked:t,filePickerClicked:t}}function u(e){for(var t in e)e.hasOwnProperty(t)&&!(typeof e[t]=="string"||e[t]instanceof String)&&(e[t]=e[t]+"");return e}var e=this,t=n.telemetry.NOT_AVAILABLE;e.publish=function(){var t=i.TYPE,n=u(e.data);s.get().sendEvent(r.telemetry.uiTenantToken,t,n),o()},o()}var n=e("constants/common"),r=e("experience/settings"),i=n.telemetry.mediaBarEvent,s=e("ui/telemetry/telemetryClient");t.build=function(){return new o}}),define("ui/viewModels/chat/filePicker",["require","vendor/knockout","swx-i18n","constants/common","services/serviceLocator","telemetry/chat/mediaPickerTelemetry","utils/common/eventMixin","lodash-compat","browser/dom","browser/detect"],function(e){function l(e,o){function h(){var t={};return e.icon&&(t.iconfont=!0,t[e.icon]=!0),t}function p(){var e=a.getElement(".fileInput",o.element);f.getBrowserInfo().browserName===f.BROWSERS.FIREFOX?e.focus():e.click()}var u=this,l=i.resolve(r.serviceLocator.FEATURE_FLAGS),c=l.isFeatureOn(r.featureFlags.FILE_TRANSFER_ENABLED);u.conversationModel=e.conversationModel,e.text&&(u.text=n.fetch({key:e.text})),u.isDisabled=e.isDisabled,u.iconCssClass=t.computed(h,this),u.isFocused=t.observable(!1),u.supportedFileTypes=c?"":r.fileTransfer.SUPPORTED_PICTURE_TYPES,u.mediaPickerTelemetryEvent=e.mediaPickerTelemetryEvent||s.build(),u.init=function(){u.registerEvent(r.events.mediaPicker.FILE_PICKER_SELECTED,p)},u.onOpenDialog=function(){return u.mediaPickerTelemetryEvent.data.filePickerClicked=!0,u.mediaPickerTelemetryEvent.publish(),u.dispatchEvent(r.events.mediaPicker.CLOSE_PICKER,u.DIRECTION.PARENT),u.isFocused(!1),!0},u.processFiles=function(e,t){u.conversationModel.fileTransferService.send(t.target.files),t.target.value=null},u.dispose=function(){u.iconCssClass.dispose()}}var t=e("vendor/knockout"),n=e("swx-i18n").localization,r=e("constants/common"),i=e("services/serviceLocator"),s=e("telemetry/chat/mediaPickerTelemetry"),o=e("utils/common/eventMixin"),u=e("lodash-compat"),a=e("browser/dom"),f=e("browser/detect");return u.assign(l.prototype,o),{build:function(e,t){return new l(e,t)}}}),define("text!views/chat/filePicker.html",[],function(){return'<div class="filePicker" data-bind="css: {disabled: isDisabled, focused: isFocused}">\r\n    <label data-bind="attr: {\'title\': text}">\r\n        <span class="icon" data-bind="css: iconCssClass"></span>\r\n        <span class="text" data-bind="l10n: {key: text}"></span>\r\n        <input type="file" class="fileInput"\r\n               multiple="multiple"\r\n               data-bind="event: {change: processFiles}, attr: {\'title\': text, accept:supportedFileTypes},\r\n        	hasFocus: isFocused,\r\n                click: onOpenDialog,\r\n                disable: isDisabled"/>\r\n    </label>\r\n</div>\r\n'}),define("ui/components/chat/filePicker",["require","exports","module","ui/viewModels/chat/filePicker","vendor/knockout","constants/components","text!views/chat/filePicker.html"],function(e,t){function i(e,t){var i=n.build(e,t);return i.setContext(r.dataFor(t.element)),i.init(),i}var n=e("ui/viewModels/chat/filePicker"),r=e("vendor/knockout");t.name=e("constants/components").chat.FILE_PICKER,t.template=e("text!views/chat/filePicker.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/notificationsCenter",[],function(){function e(){}return e}),define("text!views/chat/notificationsCenter.html",[],function(){return"<div>\r\n    List of Notifications\r\n</div>\r\n"}),define("ui/components/chat/notificationsCenter",["require","exports","module","ui/viewModels/chat/notificationsCenter","constants/components","text!views/chat/notificationsCenter.html"],function(e,t){function r(e){return new n(e)}var n=e("ui/viewModels/chat/notificationsCenter");t.name=e("constants/components").chat.NOTIFICATIONS_CENTER,t.template=e("text!views/chat/notificationsCenter.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/notificationsMenuItem",["require","services/pubSub/pubSub","constants/common","swx-i18n"],function(e){function i(e){var i=this,s=!1;i.id="menuItem-notifications",i.text=r.fetch({key:"notificationsPage_text_menuLink"}),i.isDisabled=e.isDisabled?e.isDisabled:!1,i.onClick=function(){s=!s,t.publish(n.navigation.NOTIFICATIONS_CENTER,s)}}var t=e("services/pubSub/pubSub"),n=e("constants/common").events,r=e("swx-i18n").localization;return i}),define("text!views/chat/notificationsMenuItem.html",[],function(){return'<a role="button" class="navItem"\r\n   data-bind="event: {mousedown: onClick}, attr: { id: id }, visible: !isDisabled()">\r\n        <span class="icon">\r\n            <span class="iconfont messageUnread"></span>\r\n        </span>\r\n        <span class="text">\r\n            <h4 data-bind="text: text"></h4>\r\n        </span>\r\n</a>\r\n'}),define("ui/components/chat/notificationsMenuItem",["require","exports","module","ui/viewModels/chat/notificationsMenuItem","constants/components","text!views/chat/notificationsMenuItem.html"],function(e,t){function r(e){return new n(e)}var n=e("ui/viewModels/chat/notificationsMenuItem");t.name=e("constants/components").chat.NOTIFICATIONS_MENU_ITEM,t.template=e("text!views/chat/notificationsMenuItem.html"),t.viewModel={createViewModel:r}}),define("notifications/settings",["require","exports","module","vendor/knockout","utils/common/localStorage"],function(e,t){var n=e("vendor/knockout"),r=e("utils/common/localStorage"),i=n.observable(),s="chatNotificationsMuted",o;t.init=function(){i(r.get(s)==="true"),o=i.subscribe(function(e){r.set(s,e)})},t.dispose=function(){o&&o.dispose()},t.chatNotificationsMuted=i}),define("ui/viewModels/chat/notificationsToggleButton",["require","exports","module","vendor/knockout","notifications/settings","swx-i18n"],function(e,t){function s(e){var t=this;t.notificationsMuted=r.chatNotificationsMuted,t.toggleNotificationsTitle=n.computed(function(){return i.fetch({key:t.notificationsMuted()?"turnOnChatNotifications_tooltip":"turnOffChatNotifications_tooltip"})}),t.isDisabled=e.isDisabled?e.isDisabled:n.observable(!1),t.toggleNotifications=function(){r.chatNotificationsMuted(!r.chatNotificationsMuted())},t.dispose=function(){t.toggleNotificationsTitle.dispose()}}var n=e("vendor/knockout"),r=e("notifications/settings"),i=e("swx-i18n").localization;t.build=function(e){return new s(e)}}),define("text!views/chat/notificationsToggleButton.html",[],function(){return'<button data-bind="visible: !isDisabled(), click: toggleNotifications, attr: { title: toggleNotificationsTitle }" class="NotificationsSwitcher btn primary circle" type="button" data-preventdefault="false">\r\n    <span class="iconfont" data-bind="css: { notificationsMuted: notificationsMuted }, text: toggleNotificationsTitle"></span>\r\n</button>\r\n'}),define("ui/components/chat/notificationsToggleButton",["require","exports","module","ui/viewModels/chat/notificationsToggleButton","constants/components","text!views/chat/notificationsToggleButton.html"],function(e,t){function r(e){return n.build(e)}var n=e("ui/viewModels/chat/notificationsToggleButton");t.name=e("constants/components").chat.NOTIFICATIONS_TOGGLE_BUTTON,t.template=e("text!views/chat/notificationsToggleButton.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/uploadManager",["require","vendor/knockout","utils/common/cafeObservable"],function(e){function r(e){function i(){return r.files().length>0}function s(){return r.files().length>1?"Sending "+r.files().length+" files":r.files().length===1?"Sending "+r.files()[0].name():""}var r=this;r.conversation=e.conversationModel,r.files=n.newObservableCollection(r.conversation.fileTransferService.files),r.isUploading=t.computed(i),r.statusText=t.computed(s),r.dispose=function(){r.isUploading.dispose(),r.statusText.dispose()}}var t=e("vendor/knockout"),n=e("utils/common/cafeObservable");return r}),define("text!views/chat/uploadManager.html",[],function(){return'<div data-bind="visible: isUploading">\r\n    <p class="status-text" data-bind="text: statusText"></p>\r\n</div>'}),define("ui/components/chat/uploadManager",["require","exports","module","ui/viewModels/chat/uploadManager","constants/components","text!views/chat/uploadManager.html"],function(e,t){function r(e){return new n(e)}var n=e("ui/viewModels/chat/uploadManager");t.name=e("constants/components").chat.UPLOAD_MANAGER,t.template=e("text!views/chat/uploadManager.html"),t.viewModel={createViewModel:r}}),define("text!views/chat/downloadFileConfirmationDialog.html",[],function(){return'<div class="downloadFileConfirmationDialogContent">\r\n    <p class="description" data-bind="text:text"></p>\r\n    <!-- ko if:isSafetype -->\r\n    <p class="donotshowagain">\r\n        <input type="checkbox" data-bind="checked:stopShowingAgain"/>\r\n        <span data-bind="l10n:{key:\'file_transfer_download_dialog_do_not_ask_checkbox\'}"></span>\r\n    </p>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/modalDialog/downloadFileConfirmationDialog",["require","exports","module","vendor/knockout","constants/common","experience/settings","swx-i18n","ui/modalDialog/confirmationDialog","text!views/chat/downloadFileConfirmationDialog.html","swx-flags-service-api","cafe/applicationInstance"],function(e,t){function l(e,t,r){var i=r?"file_transfer_download_safe_file_dialog_text":"file_transfer_download_unsafe_file_dialog_text";this.isSafetype=r,this.text=s.fetch({key:i,params:{filename:e,author:t}}),this.stopShowingAgain=n.observable(!1)}var n=e("vendor/knockout"),r=e("constants/common"),i=e("experience/settings"),s=e("swx-i18n").localization,o=e("ui/modalDialog/confirmationDialog"),u=e("text!views/chat/downloadFileConfirmationDialog.html"),a=e("swx-flags-service-api"),f=e("cafe/applicationInstance");t.start=function(e,t,n,c){function v(){n&&n();if(p.stopShowingAgain())return f.get().signInManager._skypeToken().then(m)}function m(e){a.build(i.flagsApiUrl).update(r.fileTransfer.FILE_DOWNLOAD_WARNING_FLAG_API_ID,!0,e)}var h,p=new l(e,t,c),d=c?"file_transfer_download_safe_file_dialog_title":"file_transfer_download_unsafe_file_dialog_title";h=o.build({title:s.fetch({key:d}),content:u,contentViewModel:p,onConfirm:v,confirmButtonTitle:s.fetch({key:"file_transfer_download_dialog_confirm_button_title"})}),h.show()}}),define("ui/viewModels/chat/fileTransferActivityActions",["require","exports","module","lodash-compat","swx-enums","constants/common","swx-i18n","vendor/knockout","experience/settings","browser/dom","cafe/applicationInstance","swx-flags-service-api","browser/detect","ui/modalDialog/downloadFileConfirmationDialog"],function(e,t){function p(e){if(!e.message)throw new Error("Message is not provided");if(!e.onabort)throw new Error("Abort handler is not provided");var t=this,p=e.message,d=e.onabort;t.fileUri=p.fileUri,t.fileName=p.fileName,t.isPending=o.computed(function(){return p.status()===r.activityStatus.Pending}),t.errorMessage=o.observable(),t.isFailed=o.computed(function(){var e=p.status()===r.activityStatus.Failed,n=p.shouldAbort();return t.errorMessage(s.fetch({key:"file_transfer_upload_failed"})),p.model.fileSize>i.fileTransfer.MAX_FILE_SIZE&&t.errorMessage(s.fetch({key:"file_transfer_upload_too_large_warning"})),e&&!n}),t.downloadButtonTitle=s.fetch({key:"file_transfer_download_button_title",params:{filename:p.model.fileName}}),t.abort=function(){d()},t.downloadFile=function(){function s(e){if(e&&r){v();return}h.start(p.fileName,p.author.displayName(),d,r)}function o(e){return e=e.trim().toLowerCase(),e===p.fileType||e==="."+p.fileType}function d(){v()}function v(){var e=a.createElement("a");e.download=t.fileName,e.href=t.fileUri();if(c.getBrowserInfo().isIeEngine){e.click();return}var n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});return e.dispatchEvent(n)}var e=u.cloudFileSharing.unsafeFileTypes.split(","),r=!n.any(e,o);return f.get().signInManager._skypeToken().then(function(e){l.build(u.flagsApiUrl).read(i.fileTransfer.FILE_DOWNLOAD_WARNING_FLAG_API_ID,e).then(s)})},t.progressIndicatorBG=o.computed(function(){var e=p.progress(),t=90,n="#FFF",r="#333",i=e<=50?r:n,s=Math.floor(e*3.6)+t,o=e<=50?-t:t,u=e===0?0:50,a="linear-gradient("+o+"deg, transparent "+u+"%, "+i+" 50%),"+"linear-gradient("+s+"deg, "+n+" 50%, transparent 50%)";return a}),t.dispose=function(){t.progressIndicatorBG.dispose(),t.isPending.dispose(),t.isFailed.dispose()}}var n=e("lodash-compat"),r=e("swx-enums"),i=e("constants/common"),s=e("swx-i18n").localization,o=e("vendor/knockout"),u=e("experience/settings"),a=e("browser/dom"),f=e("cafe/applicationInstance"),l=e("swx-flags-service-api"),c=e("browser/detect"),h=e("ui/modalDialog/downloadFileConfirmationDialog");t.build=function(e){return new p(e)}}),define("text!views/chat/fileTransferActivityActions.html",[],function(){return'<!-- ko if: isPending -->\r\n    <span class="progressIndicator" data-bind="style:{backgroundImage:progressIndicatorBG}"></span>\r\n    <a data-bind="click:abort, l10n_attr:{\'aria-label\':\'file_transfer_upload_cancel\', \'title\':\'file_transfer_upload_cancel\'}" role="button" tabindex="-2">\r\n        <span class="abort iconfont cancel" ></span>\r\n    </a>\r\n<!-- /ko -->\r\n<!-- ko ifnot: isPending -->\r\n    <!-- ko ifnot:isFailed -->\r\n    <a data-bind="click:downloadFile, attr:{title: downloadButtonTitle, \'aria-label\': downloadButtonTitle}" role="button" tabindex="-2">\r\n        <span class="download iconfont down"></span>\r\n    </a>\r\n    <!-- /ko -->\r\n    <!-- ko if: isFailed -->\r\n    <span class="failedIcon iconfont errorSad" data-bind="l10n_attr:{\'title\':\'file_transfer_upload_failed\'}"></span>\r\n    <span class="errorMessage" data-bind="html:errorMessage, attr:{\'title\':errorMessage}"></span>\r\n    <!-- /ko -->\r\n<!-- /ko -->\r\n'}),define("ui/components/chat/fileTransferActivityActions",["require","exports","module","ui/viewModels/chat/fileTransferActivityActions","constants/components","text!views/chat/fileTransferActivityActions.html"],function(e,t){function r(e){return n.build(e)}var n=e("ui/viewModels/chat/fileTransferActivityActions");t.name=e("constants/components").chat.FILE_TRANSFER_ACTIVITY_ACTIONS,t.template=e("text!views/chat/fileTransferActivityActions.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/chatInputActionPicker",["require","lodash-compat","cafe/applicationInstance","ui/modelHelpers/personHelper","utils/common/eventMixin","vendor/knockout","services/serviceLocator","constants/common","telemetry/chat/mediaPickerTelemetry","services/pubSub/pubSub","utils/common/styleModeHelper","utils/common/outsideClickHandler"],function(e){function p(e){function b(){h.remove("chatInputActionPicker")}function w(){h.add("chatInputActionPicker",E)}function E(){t.isActionPickerOpened(!1)}function S(e){t.isActionPickerCollapsed(!!e),t.isActionPickerCollapsed()&&E()}function x(){v||(f.subscribe(u.events.textarea.HAS_INPUT,S),v=!v)}function T(){v&&(f.unsubscribe(u.events.textarea.HAS_INPUT,S),v=!v)}var t=this,i=o.resolve(u.serviceLocator.FEATURE_FLAGS),p=i.isFeatureOn(u.featureFlags.PHOTO_SHARING_ENABLED),d=i.isFeatureOn(u.featureFlags.FILE_TRANSFER_ENABLED),v=!1,m,g,y;t.__internal={isGuestUser:r.isGuest.bind(null,n.get().personsAndGroupsManager.mePerson)},t.isActionPickerOpened=s.observable(!1),t.isActionPickerCollapsed=s.observable(!1),t.conversationModel=e.conversationModel,t.isDisabled=e.isDisabled,t.mediaPickerTelemetryEvent=a.build(),t.isPollsFeatureEnabled=s.observable(!1),t.init=function(){t.registerEvent(u.events.mediaPicker.CLOSE_PICKER,E),t.forwardEvent(u.events.mediaPicker.POLL_BUTTON_SELECTED,t.DIRECTION.CHILD),l.get().currentMode()===c.WIDE&&x(),m=l.get().currentMode.subscribe(function(e){e===c.WIDE?x():T()}),y=t.isActionPickerOpened.subscribe(function(){if(l.get().currentMode()===c.WIDE)return;t.isActionPickerOpened()?w():b()}),t.conversationModel.sendPollMessage&&(g=t.conversationModel.sendPollMessage.enabled.changed(function(e){t.isPollsFeatureEnabled(e)}))},t.triggerActionMenu=function(){t.isActionPickerOpened(!t.isActionPickerOpened()),t.isActionPickerOpened()&&(t.isActionPickerCollapsed(!1),t.mediaPickerTelemetryEvent.data.paperclipButtonClicked=!0)},t.isPhotoSharingOrFileTransferEnabled=function(){return p||d},t.filePickerIcon=function(){if(p&&d)return"media";if(p)return"picture";if(d)return"file"},t.filePickerText=function(){if(p&&d)return"file_transfer_send_photos_and_files";if(p)return"button_text_filePicker";if(d)return"file_transfer_share_file"},t.canSendContactCard=function(){return i.isFeatureOn(u.featureFlags.SEND_CONTACT_CARD_ENABLED)&&!t.__internal.isGuestUser()},t.dispose=function(){b(),T(),m.dispose(),y.dispose(),g&&g.dispose()}}var t=e("lodash-compat"),n=e("cafe/applicationInstance"),r=e("ui/modelHelpers/personHelper"),i=e("utils/common/eventMixin"),s=e("vendor/knockout"),o=e("services/serviceLocator"),u=e("constants/common"),a=e("telemetry/chat/mediaPickerTelemetry"),f=e("services/pubSub/pubSub"),l=e("utils/common/styleModeHelper"),c=u.styleMode,h=e("utils/common/outsideClickHandler");return t.assign(p.prototype,i),{build:function(e){return new p(e)}}}),define("text!views/chat/chatInputActionPicker.html",[],function(){return'<div class="chatInputActionPicker" data-bind="css: {collapsed: isActionPickerCollapsed()}">\r\n    <swx-button params="icon: \'paperclip\', cssClass: \'transparent circle actionButton\',\r\n                textKey: \'button_text_chatInputActionPicker\', titleKey: \'button_text_chatInputActionPicker\', ariaLabelKey: \'button_text_chatInputActionPicker\', action: triggerActionMenu,\r\n                disabled: isDisabled"></swx-button>\r\n\r\n    <!-- ko if: isPollsFeatureEnabled -->\r\n    <swx-poll-designer class="chatInputPollButton" params="isDisabled: isDisabled"></swx-poll-designer>\r\n    <!-- /ko -->\r\n\r\n    <div class="wrapper">\r\n        <div class="menuContainer popup arrow down" data-bind="css: {inline: !isActionPickerOpened()}">\r\n            <ul class="menu fontSize-p">\r\n                <!-- ko if: isPhotoSharingOrFileTransferEnabled() -->\r\n                <li class="action btnOutline" data-bind="attr: {\'media-item\': \'file-picker\', \'data-preventdefault\': \'false\'}">\r\n                    <swx-file-picker params="isDisabled: isDisabled, conversationModel: conversationModel, icon:filePickerIcon(), text:filePickerText(), mediaPickerTelemetryEvent: mediaPickerTelemetryEvent"></swx-file-picker>\r\n                </li>\r\n                <!-- /ko -->\r\n                <!-- ko if: canSendContactCard() -->\r\n                <li class="action btnOutline" data-bind="attr:{\'media-item\':\'send-contactCard\', \'data-preventdefault\': \'false\'}">\r\n                    <swx-chat-input-send-contact-card params="isDisabled: isDisabled, conversationModel: conversationModel, mediaPickerTelemetryEvent: mediaPickerTelemetryEvent"></swx-chat-input-send-contact-card>\r\n                </li>\r\n                <!-- /ko -->\r\n                <!-- ko if: isPollsFeatureEnabled -->\r\n                <li class="action btnOutline" data-bind="attr:{\'media-item\':\'poll-button\', \'data-preventdefault\': \'false\'}">\r\n                    <swx-chat-input-poll-button params="isDisabled: isDisabled, conversationModel: conversationModel"></swx-chat-input-poll-button>\r\n                </li>\r\n                <!-- /ko -->\r\n            </ul>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/chatInputActionPicker",["require","exports","module","vendor/knockout","ui/viewModels/chat/chatInputActionPicker","constants/components","text!views/chat/chatInputActionPicker.html"],function(e,t){function i(e,t){var i=r.build(e);return i.setContext(n.dataFor(t.element)),i.init(),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/chatInputActionPicker");t.name=e("constants/components").chat.CHAT_INPUT_ACTION_PICKER,t.template=e("text!views/chat/chatInputActionPicker.html"),t.viewModel={createViewModel:i}}),define("telemetry/chat/sendContactsTelemetry",["require","exports","module","constants/common","ui/telemetry/telemetryClient","telemetry/utils/telemetryUtils","experience/settings","utils/chat/dateTime"],function(e,t){function a(e){function c(){t.data={cta:l||f,action:f,participantsCount:e.participantsCount()||f,statusCodestatusCode:f,timeBeforeActionTaken:f,numberOfContacts:f}}function h(){t.data.timeBeforeActionTaken=p(a,u.getDate());var e=s.stringify(t.data);i.get().sendEvent(o.telemetry.uiTenantToken,r.TYPE,e),c()}function p(e,t){return t-e}var t=this,a=u.getDate(),f=n.telemetry.NOT_AVAILABLE,l=r.cta.MEDIABAR;t.canceled=function(){t.data.action=r.action.CANCELED,h()},t.confirmed=function(){t.data.action=r.action.CONFIRMED,h()},c()}var n=e("constants/common"),r=n.telemetry.sendContacts,i=e("ui/telemetry/telemetryClient"),s=e("telemetry/utils/telemetryUtils"),o=e("experience/settings"),u=e("utils/chat/dateTime");t.build=function(e){return new a(e)}}),define("ui/viewModels/chat/chatInputSendContactCard",["require","exports","module","constants/common","utils/common/eventMixin","lodash-compat","swx-i18n","services/pubSub/pubSub","telemetry/chat/sendContactsTelemetry"],function(e,t){function a(e){var t=this;t.conversationModel=e.conversationModel,t.isDisabled=e.isDisabled,t.openShareControl=function(){var e=u.build(t.conversationModel),r=function(n){n.length>0&&(t.conversationModel.sendContactInfo(n),e.numberOfContacts=n.length,e.confirmed())},i={conversationModel:t.conversationModel,title:s.fetch({key:"send_contacts_action_title"}),description:s.fetch({key:"send_contacts_action_text"}),confirmButtonTitleKey:"action_button_send",onConfirm:r,onCancel:function(){e.canceled()}};t.dispatchEvent(n.events.mediaPicker.CLOSE_PICKER,t.DIRECTION.PARENT),o.publish(n.events.shareControl.SHARE_CONTROL_SHOW,i)},t.registerEvent(n.events.mediaPicker.SEND_CONTACTS_SELECTED,t.openShareControl)}var n=e("constants/common"),r=e("utils/common/eventMixin"),i=e("lodash-compat"),s=e("swx-i18n").localization,o=e("services/pubSub/pubSub"),u=e("telemetry/chat/sendContactsTelemetry");t.build=function(e){return new a(e)},i.assign(a.prototype,r)}),define("text!views/chat/chatInputSendContactCard.html",[],function(){return'<button class="sendContactCard" data-bind="click:openShareControl, l10n_attr:{\'title\':\'contactPicker_sendContacts_title\'}, css:{disabled: isDisabled}, attr:{disabled : isDisabled}">\r\n    <span class="icon iconfont contactCard"></span>\r\n    <span class="text" data-bind="l10n:{\'key\':\'contactPicker_sendContacts_title\'}"></span>\r\n</button>\r\n'}),define("ui/components/chat/chatInputSendContactCard",["require","exports","module","vendor/knockout","ui/viewModels/chat/chatInputSendContactCard","constants/components","text!views/chat/chatInputSendContactCard.html"],function(e,t){function i(e,t){var i=r.build(e,t),s=n.dataFor(t.element);return i.setContext(s),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/chatInputSendContactCard");t.name=e("constants/components").chat.CHAT_INPUT_SEND_CONTACT_CARD,t.template=e("text!views/chat/chatInputSendContactCard.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/shareControl",["require","exports","module","vendor/knockout","utils/common/eventMixin","constants/common","lodash-compat","constants/keys","services/serviceLocator","utils/common/eventHelper"],function(e,t){function l(e){function h(){var e=r?r.selectedContacts().length:0;t.isSendButtonDisabled(e===0)}if(!e.conversationModel)throw new Error("Conversation is not provided");var t=this,r=null,o=e.onConfirm,l=e.onCancel,c=a.resolve(i.serviceLocator.PUBSUB);t.conversationModel=e.conversationModel,t.title=e.title,t.description=e.description,t.confirmButtonTitleKey=e.confirmButtonTitleKey,t.isSendButtonDisabled=n.observable(!0),t.setParticipantProvider=function(e){t.selectedContactsSubscription&&t.selectedContactsSubscription.dispose(),r=e,t.selectedContactsSubscription=r.selectedContacts.subscribe(h),h()},t.cancel=function(){l&&l(),c.publish(s.shareControl.SHARE_CONTROL_HIDE)},t.confirm=function(){var e=[];r&&r!==null&&(e=r.selectedContacts()),o&&o(e),c.publish(s.shareControl.SHARE_CONTROL_HIDE)},t.handleKeyDown=function(e,t){var n=f.getKeyCode(t);return n===u.ESCAPE&&(e.cancel(),t.stopPropagation()),!0},t.forwardEvent(s.roster.PICKER_CONTACT_SELECTED),t.forwardEvent(s.roster.PICKER_CONTACT_DESELECTED),t.forwardEvent(s.roster.ROSTER_QUERY_CHANGED),t.forwardEvent(s.roster.ROSTER_QUERY_EXECUTED),t.forwardEvent(s.roster.ROSTER_SELECTION_REMOVED)}var n=e("vendor/knockout"),r=e("utils/common/eventMixin"),i=e("constants/common"),s=i.events,o=e("lodash-compat"),u=e("constants/keys"),a=e("services/serviceLocator"),f=e("utils/common/eventHelper");t.build=function(e){return new l(e)},o.assign(l.prototype,r)}),define("text!views/chat/shareControl.html",[],function(){return'<div class="shareControlWrapper" data-bind="event: { keydown: handleKeyDown }">\r\n    <div class="title" data-bind="text:title"></div>\r\n\r\n    <div class="description" data-bind="text:description"></div>\r\n\r\n    <div class="headerAdd">\r\n        <swx-contact-picker-input params="setParticipantProvider: setParticipantProvider"></swx-contact-picker-input>\r\n    </div>\r\n\r\n    <swx-contact-picker params="conversation: conversationModel, className: \'headerPicker\', showJumpToConversation: false"></swx-contact-picker>\r\n\r\n    <div class="actions">\r\n       <div class="conversationButtons">\r\n            <swx-button params="cssClass: \'secondary circle\', disabled: false, textKey: \'action_button_cancel\', titleKey: \'action_button_cancel\', ariaLabelKey: \'action_button_cancel\', action: cancel"></swx-button>\r\n            <swx-button params="cssClass: \'primary circle\', disabled: isSendButtonDisabled, textKey: confirmButtonTitleKey, titleKey: confirmButtonTitleKey, ariaLabelKey: confirmButtonTitleKey, action: confirm"></swx-button>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/shareControl",["require","exports","module","vendor/knockout","ui/viewModels/chat/shareControl","constants/components","text!views/chat/shareControl.html"],function(e,t){function i(e,t){var i=e.payload()||{},s=r.build(i),o=n.dataFor(t.element);return s.setContext(o),s}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/shareControl");t.name=e("constants/components").chat.SHARE_CONTROL,t.template=e("text!views/chat/shareControl.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/chatInputPollButton",["require","exports","module","constants/common","lodash-compat","utils/common/eventMixin","constants/keys","utils/common/eventHelper"],function(e,t){function u(e){var t=this;t.isDisabled=e.isDisabled,t.conversationModel=e.conversationModel,t.openPollDesigner=function(e){o.getKeyCode(e)===s.ENTER&&e.preventDefault(),t.dispatchEvent(n.events.mediaPicker.POLL_BUTTON_SELECTED,null,t.DIRECTION.PARENT),t.dispatchEvent(n.events.mediaPicker.CLOSE_PICKER,null,t.DIRECTION.PARENT)}}var n=e("constants/common"),r=e("lodash-compat"),i=e("utils/common/eventMixin"),s=e("constants/keys"),o=e("utils/common/eventHelper");t.build=function(e){return new u(e)},r.assign(u.prototype,i)}),define("text!views/chat/chatInputPollButton.html",[],function(){return'<div class="chatInputPollButton">\r\n    <button class="pollButton" data-bind="click:openPollDesigner, l10n_attr:{\'title\':\'button_text_poll\'}, css:{disabled: isDisabled}, attr:{disabled : isDisabled}">\r\n        <span class="icon iconfont poll"></span>\r\n        <span class="text" data-bind="l10n:{\'key\':\'button_text_poll\'}"></span>\r\n    </button>\r\n    <swx-poll-designer params="isDisabled: isDisabled"></swx-poll-designer>\r\n</div>\r\n'}),define("ui/components/chat/chatInputPollButton",["require","exports","module","vendor/knockout","ui/viewModels/chat/chatInputPollButton","constants/components","text!views/chat/chatInputPollButton.html"],function(e,t){function i(e,t){var i=r.build(e,t),s=n.dataFor(t.element);return i.setContext(s),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/chatInputPollButton");t.name=e("constants/components").chat.CHAT_INPUT_POLL_BUTTON,t.template=e("text!views/chat/chatInputPollButton.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/pollDesigner",["require","lodash-compat","vendor/knockout","utils/common/async","utils/common/eventMixin","utils/common/eventHelper","swx-utils-common","telemetry/chat/poll","constants/keys","constants/common","browser/document","utils/common/outsideClickHandler"],function(e){function v(e,i,v){function w(){c.remove("chatInputPollButton")}function E(){c.add("chatInputPollButton",S)}function S(){r.execute(function(){m.isOpened(!1)}),w()}function x(e){return!o.isCarriageReturn(e)&&!o.isNewLine(e)&&!o.isWhiteSpace(e)}function T(){b&&b.focus()}function N(){m.isOpened()?(m.isOpened(!1),w()):(u.pollDesignerOpened(i.conversationId),E(),m.isOpened(!0),v.focusPollQuestion())}var m=this,g,y,b=l.querySelector(".swx .chat .inputField");m.isDisabled=e,m.isOpened=n.observable(!1),m.questionText=n.observable(""),m.answers=n.observableArray(),m.isMultipleChoice=n.observable(!1),m.isSendButtonEnabled=n.computed(function(){var e=!0,n=m.answers();return g=t.filter(n,function(e){return t.trim(e.value()).length>0}),y=t.trim(m.questionText()),y.length===0&&(e=!1),g.length<2&&(e=!1),e}),m.init=function(){m.initPollBubble(),m.registerEvent(f.events.mediaPicker.POLL_BUTTON_SELECTED,N)},m.initPollBubble=function(){m.questionText(""),v.initPollQuestion(),m.isMultipleChoice(!1),m.answers.removeAll(),m.addNewAnswer("",!0,!1),m.addNewAnswer("",!1,!1)},m.removeCurrentAnswer=function(e){var t=m.answers(),n=t.indexOf(e);m.answers.remove(e),t.length===2&&(t[0].allowRemove(!1),t[1].allowRemove(!1));var r=n>=1?n-1:0;t[r].focused(!0)},m.addNewAnswer=function(e,t,r){var i={value:n.observable(""),focused:n.observable(t),allowRemove:n.observable(r)};m.answers.push(i)},m.onPaste=function(e,t,n){function c(e){s?x(e)&&(u+=e,s=!1):(u+=e,o.isNewLine(e)&&(s=!0))}var r=t.clipboardData||window.clipboardData;t.originalEvent&&(r=r||t.originalEvent.clipboardData);var i=r.getData("Text"),s=!0,u="",a=d(t.target),f=h(t.target),l=p(t.target);for(var v=0;v<i.length;v++)c(i[v]);n(o.inject(a,u,f,l))},m.onPasteQuestion=function(e,t){m.onPaste(e,t,function(e){m.questionText(e)}),m.questionChanged(e,t)},m.onPasteAnswer=function(e,t){m.onPaste(e,t,function(t){var n=m.answers().indexOf(e);m.answers()[n].value(t)}),m.onAnswerKeypress(e,t)},m.submitPoll=function(){if(!m.isSendButtonEnabled())return;var e={};e.question=y,e.answers=t.map(g,function(e){return e.value()}),e.multipleChoice=m.isMultipleChoice(),i.sendPollMessage(JSON.stringify(e)),m.initPollBubble(),S()},m.removeAnswer=function(e){m.removeCurrentAnswer(e)},m.onAnswerKeydown=function(e,n){var r=m.answers(),i=s.getKeyCode(n);return i!==a.BACKSPACE?!0:e.value().length>0?!0:e===t.last(r)?(e.focused(!1),r[r.length-2].focused(!0),!1):e.allowRemove()?(m.removeCurrentAnswer(e),!1):!0},m.onAnswerKeypress=function(e,n){var r=m.answers(),i=r.indexOf(e),o=s.getKeyCode(n);return o!==a.TAB&&e===t.last(r)&&(m.addNewAnswer("",!1,!1),e.allowRemove(!0)),i>=1&&r[0].allowRemove(!0),o===a.ENTER&&r[i+1].focused(!0),v.scrollToBottom(),!0},m.questionChanged=function(){return v.updatePollQuestion(),!0},m.handleKeyDown=function(e,t){var n=s.getKeyCode(t);if(n===a.ESCAPE&&m.isOpened()){t.stopPropagation(),S(),T();return}return!0},m.dispose=function(){m.isSendButtonEnabled.dispose(),w()}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/async"),i=e("utils/common/eventMixin"),s=e("utils/common/eventHelper"),o=e("swx-utils-common").stringUtils,u=e("telemetry/chat/poll"),a=e("constants/keys"),f=e("constants/common"),l=e("browser/document"),c=e("utils/common/outsideClickHandler"),h=function(e){return e.selectionStart},p=function(e){return e.selectionEnd},d=function(e){return e.value};return t.assign(v.prototype,i),v}),define("jsviews/chat/pollDesigner",["require","browser/dom"],function(e){function i(e){var i=t.getElement(".poll-designer-content",e),s=t.getElement("textarea",e);this.scrollToBottom=function(){i.scrollTop=i.scrollHeight-i.clientHeight},this.focusPollQuestion=function(){s.focus()},this.initPollQuestion=function(){s.style.height=r+"px"},this.updatePollQuestion=function(){var e;s.style.height="auto",e=Math.max(r,Math.min(s.scrollHeight,n)),s.style.height=e+"px"}}var t=e("browser/dom"),n=150,r=19;return i}),define("text!views/chat/pollDesigner.html",[],function(){return'<div class="bubble popup arrow down" data-bind="css: { active: isOpened }, event: { keydown: handleKeyDown }">\r\n\r\n    <textarea rows="1" data-bind="l10n_attr: { \'placeholder\': \'poll_designer_question_placeholder\' }, textInput: questionText, event: { input: questionChanged, paste: onPasteQuestion }"></textarea>\r\n\r\n    <fieldset class="poll-designer-content" data-bind="template: { name: \'answer-template\', foreach: answers, as: \'a\' }"></fieldset>\r\n\r\n    <div class="send-poll-button">\r\n        <swx-button params="icon: \'send\', cssClass: \'circle send-button large\', disabled: !isSendButtonEnabled(),\r\n            titleKey: \'action_button_send\', textKey: \'action_button_send\', action: submitPoll,\r\n            ariaLabelKey: \'action_button_send\'"></swx-button>\r\n    </div>\r\n</div>\r\n\r\n<script type="text/html" id="answer-template">\r\n    <div class="answer-box">\r\n        <input type="text" data-bind="l10n_attr: { \'placeholder\': \'poll_designer_answer_placeholder\' }, textInput: a.value, event: { keypress: $parent.onAnswerKeypress, keydown: $parent.onAnswerKeydown, paste: $parent.onPasteAnswer}, hasfocus: a.focused" />\r\n        <button tabindex="-1" data-bind="visible: a.allowRemove, event: { click: $parent.removeAnswer }" type="button" class="btn primary circle small transparent delete-answer">\r\n            <span class="iconfont cross" tabindex="0"></span>\r\n        </button>\r\n    </div>\r\n</script>\r\n'}),define("ui/components/chat/pollDesigner",["require","exports","module","vendor/knockout","ui/viewModels/chat/pollDesigner","jsviews/chat/pollDesigner","constants/components","text!views/chat/pollDesigner.html"],function(e,t){function s(e,t){var s=t.element,o=n.dataFor(s),u=new i(s),a=new r(e.isDisabled,o.conversationModel,u);return a.setContext(o),a.init(),a}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/pollDesigner"),i=e("jsviews/chat/pollDesigner");t.name=e("constants/components").chat.POLL_DESIGNER,t.template=e("text!views/chat/pollDesigner.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/chat/stickyMessage",["require","lodash-compat","vendor/knockout","utils/common/eventMixin","constants/common","swx-enums","telemetry/chat/poll","swx-i18n"],function(e){function p(e,r){var a=this,f=r.conversationModel,p,d,v,m,g=[],y=function(){var e=h(g),t=!0;a.latestPoll()!==e&&(a.latestPoll(e),a.latestPoll()?a.showStickyMessageData({isActive:!0,isVisible:t}):a.showStickyMessageData(null))};a.latestPoll=n.observable(null),a.pollQuestion=n.observable(),a.pollAuthor=n.observable(),a.statsMessageText=n.observable(),a.ongoingPoll=n.pureComputed(function(){return u.fetch({key:"poll_sticky_message_new_poll",params:{author:a.pollAuthor()}})}),a.showStickyMessageData=n.observable({isVisible:!1,isActive:!1}),a.showStickyMessage=n.observable(!1),a.showStickyMessageData.subscribe(function(e){a.showStickyMessage(e!==null&&e.isActive&&!e.isVisible)}),v=a.latestPoll.subscribe(function(e){if(!e)return;m&&m.dispose(),a.pollQuestion(e.pollQuestion()),a.pollAuthor(e.sender.firstName()),a.statsMessageText(l(e)),m=e.poll.changed(function(){a.statsMessageText(l(e))})}),p=f.historyService.activityItems.added(function(e){e.type()===s.activityType.PollMessage&&(g.push(e),y())}),d=f.historyService.activityItems.removed(function(e){e.type()===s.activityType.PollMessage&&(g=t.reject(g,function(t){return t.key()===e.key()}),y())}),a.scrollToPoll=function(){o.stickyMessageClicked(a.latestPoll()),e.scrollToLastPollElement()},a.dispose=function(){v.dispose(),p.dispose(),d.dispose(),a.ongoingPoll.dispose(),m&&m.dispose()},a.init=function(){a.registerEvent(i.events.conversation.VIEWPORT_CHANGED,function(t){var n,r;a.latestPoll()&&(n=c(a.latestPoll()),r=e.checkPollIsVisible(a.latestPoll(),t),a.showStickyMessageData({isActive:n,isVisible:r}))})}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/eventMixin"),i=e("constants/common"),s=e("swx-enums"),o=e("telemetry/chat/poll"),u=e("swx-i18n").localization,a=1800,f=86400,l=function(e){var n=e.meCheckedAnswerPositions(),r=t.isEmpty(n)?-1:n[0],i=e.pollAnswers(),s;return i&&r>=0&&r<i.length?s=u.fetch({key:"poll_sticky_message_me_voted",params:{answerText:i[r].answerText}}):s=u.fetch({key:"poll_sticky_message_me_not_voted"}),s+" · "+u.fetch({key:"poll_message_people_voted",params:{count:e.peopleVotedNum()}})},c=function(e){if(!e)return!1;var n=a;return t.isEmpty(e.meCheckedAnswerPositions())&&(n=f),t.now()-e.timestamp().getTime()<n*1e3},h=function(e){var n=t.filter(e,function(e){return c(e)});return n.length===0?null:n.sort(function(e,t){return t.timestamp()-e.timestamp()})[0]};return t.assign(p.prototype,r),p}),define("jsviews/chat/stickyMessage",["require","browser/dom","lodash-compat","vendor/knockout","browser/window","browser/document"],function(e){function u(e){function a(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(i.innerHeight||s.documentElement.clientHeight)&&t.right<=(i.innerWidth||s.documentElement.clientWidth)}function f(e,t,n,r){if(n<=0)return;var i=t-e.scrollTop,s=i<0,o=i/n*10;setTimeout(function(){e.scrollTop=e.scrollTop+o;if(s&&e.scrollTop<=t){r();return}if(!s&&e.scrollTop>=t){r();return}f(e,t,n-10,r)},10)}var u=this;u.lastPollElement=r.observable(null),u.scrollToLastPollElement=function(){var n=u.lastPollElement(),r=t.getElement(".conversation.scrollable",e.parentElement),i=Math.min(n.offsetTop-25,r.scrollHeight-r.offsetHeight);t.removeClass(n,"highlight"),f(r,i,o,function(){t.addClass(n,"highlight")})},u.checkPollIsVisible=function(e,t){var r=!1,i=e.key();return n.some(t,function(e){if(e.getAttribute("data-id")===i)return u.lastPollElement(e),r=a(e),!0}),r}}var t=e("browser/dom"),n=e("lodash-compat"),r=e("vendor/knockout"),i=e("browser/window"),s=e("browser/document"),o=200;return u}),define("text!views/chat/stickyMessage.html",[],function(){return'<div class="stickyMessage" data-bind="event: { click: scrollToPoll }">\r\n    <div class="stickyMessageWrapper" data-bind="css: { \'visible\': showStickyMessage }">\r\n        <div class="stickyMessageContent">\r\n            <span class="stickyMessageAuthor" data-bind="\'text\': ongoingPoll()"></span>\r\n            <span class="stickyMessageQuestion" data-bind="text: pollQuestion()"></span>\r\n        </div>\r\n        <span class="stickyMessageStats" data-bind="text: statsMessageText()"></span>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/stickyMessage",["require","exports","module","vendor/knockout","ui/viewModels/chat/stickyMessage","jsviews/chat/stickyMessage","constants/components","text!views/chat/stickyMessage.html"],function(e,t){function s(e,t){var s=t.element,o=new i(s),u=new r(o,e,t),a=n.dataFor(s);return u.setContext(a),u.init(),u}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/stickyMessage"),i=e("jsviews/chat/stickyMessage");t.name=e("constants/components").chat.STICKY_MESSAGE,t.template=e("text!views/chat/stickyMessage.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/chat/startConversationOverlay",["require","lodash-compat","vendor/knockout","constants/common","utils/common/eventMixin","ui/viewModels/people/contactBuilder","ui/viewModels/chat/conversation/callButtonViewModel"],function(e){function u(e){function l(){return a.displayMessage()===a.locationText()?"":a.displayMessage()}var t=this,i=e.conversationModel,u=i.participants()[0].person,a=s.build(u),f=o.build(i);t.avatar=a.avatar,t.statusClassName=a.statusClassName,t.displayName=a.displayName,t.displayMessage=n.computed(l),t.locationText=a.locationText,t.isAudioDisabled=f.isAudioDisabled,t.isVideoDisabled=f.isVideoDisabled,t.buttonVideoTitle=f.buttonVideoTitle,t.buttonVideoAriaLabel=f.buttonVideoAriaLabel,t.buttonCallTitle=f.buttonCallTitle,t.buttonCallAriaLabel=f.buttonCallAriaLabel,t.forwardEvent(r.events.conversation.OVERLAY_CLOSED),t.startCallWithAudio=function(){f.startCallWithAudio(),t.dispatchEvent(r.events.conversation.OVERLAY_CLOSED,t.DIRECTION.PARENT)},t.startCallWithVideo=function(){f.startCallWithVideo(),t.dispatchEvent(r.events.conversation.OVERLAY_CLOSED,t.DIRECTION.PARENT)},t.startChat=function(){t.dispatchEvent(r.events.conversation.OVERLAY_CLOSED,t.DIRECTION.PARENT)},t.dispose=function(){a.dispose(),f.dispose()}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("constants/common"),i=e("utils/common/eventMixin"),s=e("ui/viewModels/people/contactBuilder"),o=e("ui/viewModels/chat/conversation/callButtonViewModel");return t.assign(u.prototype,i),{build:function(e){return new u(e)}}}),define("text!views/chat/startConversationOverlay.html",[],function(){return'<div class="StartConversationOverlay-container themeWhite">\r\n    <div class="StartConversationOverlay-content">\r\n        <div class="StartConversationOverlay-col1">\r\n            <swx-avatar-deprecated params="isGroupAvatar: false, avatar: avatar, status: statusClassName" class="AvatarDeprecated AvatarDeprecated--XL"></swx-avatar-deprecated>\r\n        </div>\r\n        <div class="StartConversationOverlay-col2">\r\n            <div class="StartConversationOverlay-greeting" data-bind="l10n: { key: \'invite_free_overlay_greeting\' }"></div>\r\n\r\n            <swx-avatar-deprecated params="isGroupAvatar: false, avatar: avatar, status: statusClassName" class="AvatarDeprecated AvatarDeprecated--L"></swx-avatar-deprecated>\r\n\r\n            <div data-bind="text: displayName, attr: {title: displayName}" class="StartConversationOverlay-displayName"></div>\r\n            <!-- ko if: displayMessage -->\r\n            <div data-bind="text: displayMessage, attr: {title: displayMessage}" class="StartConversationOverlay-statusMessage"></div>\r\n            <!--  /ko -->\r\n            <!-- ko if: locationText -->\r\n            <div class="StartConversationOverlay-location">\r\n                <span class="iconfont location"></span>\r\n                <span data-bind="text: locationText, attr: {title: locationText}" class="StartConversationOverlay-locationText"></span>\r\n            </div>\r\n            <!-- /ko -->\r\n\r\n            <div class="StartConversationOverlay-buttonContainer">\r\n                <label class="StartConversationOverlay-button">\r\n                    <swx-button params="icon: \'videoOn\', cssClass: \'primary circle\', disabled: isVideoDisabled, textKey: \'button_text_videoCall\', i18nTitle: buttonVideoTitle, action: startCallWithVideo, ariaLabel: buttonVideoAriaLabel"></swx-button>\r\n                    <span class="StartConversationOverlay-buttonText" data-bind="l10n: { key: \'label_text_call_skype_video\' }"></span>\r\n                </label>\r\n                <label class="StartConversationOverlay-button">\r\n                    <swx-button params="icon: \'callStart\', cssClass: \'primary circle\', disabled: isAudioDisabled, textKey: \'button_text_audioCall\', i18nTitle: buttonCallTitle, action: startCallWithAudio, ariaLabel: buttonCallAriaLabel"></swx-button>\r\n                    <span class="StartConversationOverlay-buttonText" data-bind="l10n: { key: \'label_text_call\' }"></span>\r\n                </label>\r\n                <label class="StartConversationOverlay-button">\r\n                    <swx-button params="icon: \'message\', cssClass: \'primary circle\', textKey: \'label_text_send_message\', titleKey: \'label_text_send_message\', action: startChat,  ariaLabelKey: \'label_text_send_message\'"></swx-button>\r\n                    <span class="StartConversationOverlay-buttonText" data-bind="l10n: { key: \'label_text_send_message\' }"></span>\r\n                </label>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/startConversationOverlay",["require","exports","module","vendor/knockout","ui/viewModels/chat/startConversationOverlay","constants/components","text!views/chat/startConversationOverlay.html"],function(e,t){function i(e,t){var i=r.build(e);return i.setContext(n.dataFor(t.element)),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/startConversationOverlay");t.name=e("constants/components").chat.START_CONVERSATION_OVERLAY,t.template=e("text!views/chat/startConversationOverlay.html"),t.viewModel={createViewModel:i}}),define("ui/components/chat/suggestions/simpleWordSuggestion",["require","swx-utils-common"],function(e){function n(){}var t=e("swx-utils-common").stringUtils;return n.prototype.applySuggestion=function(n){var r=this.textarea.viewModel.messageBody(),i=t.wordBoundariesAt(r,this.searchPosition),s=this.getReplacer(n),o=r.slice(i.end);o===""&&(s+=" "),r=r.slice(0,i.start)+s+o,this.textarea.viewModel.messageBody(r),this.textarea.view.setCursorAt(i.start+s.length),n.data.criteriaLength=i.end-i.start,n.data.suggestionType=this.suggestionType},n}),define("ui/components/chat/suggestions/emoticonSuggestion",["require","lodash-compat","ui/components/chat/suggestions/simpleWordSuggestion"],function(e){function s(e,t,n,r,i){this.emoticon=r,this.textarea={view:t,viewModel:e},this.searchPosition=n,this.shortcut=i}var t=e("lodash-compat"),n=e("ui/components/chat/suggestions/simpleWordSuggestion"),r="EMOTICONS",i="swx-suggestion-emoticon";return s.prototype.templateId=i,s.prototype.suggestionType=r,s.prototype.getReplacer=function(){return this.shortcut},s.build=function(t,n,r,i,o){return new s(t,n,r,i,o)},t.assign(s.prototype,n.prototype),s}),define("ui/components/chat/suggestions/emoticonSuggestionEngine",["require","lodash-compat","constants/common","ui/components/chat/suggestions/emoticonSuggestion","services/pes/constants","services/serviceLocator","swx-utils-common"],function(e){function a(){var e=s.resolve(n.serviceLocator.FEATURE_FLAGS);this.isEnabled=e.isFeatureOn(n.featureFlags.EMOTICON_SUGGESTION_ENABLED),this.isImplicitEnabled=!e.isFeatureOn(n.featureFlags.EMOTICON_IMPLICIT_SUGGESTION_DISABLED),this.suggestHidden=e.isFeatureOn(n.featureFlags.SUGGEST_HIDDEN_EMOTICONS)}function f(e,n){return t.any(n.shortcuts,function(t){return t===e})}var t=e("lodash-compat"),n=e("constants/common"),r=e("ui/components/chat/suggestions/emoticonSuggestion"),i=e("services/pes/constants"),s=e("services/serviceLocator"),o=e("swx-utils-common").stringUtils,u=4;return a.prototype.priority=2,a.prototype.filterEmoticons=function(r){var u=s.resolve(n.serviceLocator.PES_CONFIG_SERVICE),a=u.getConfiguration().items,f=this.suggestHidden;return a.reduce(function(e,n){if(n.type!==i.itemTypes.emoticon.id||!n.visible&&!f)return e;var s=t.any(n.keywords.concat(n.description),function(e){return o.anyWordStartsWith(e,r)});if(s)return e.push({emoticon:n,shortcut:n.shortcuts[0]}),e;var u=t.find(n.shortcuts,function(e){return o.anyWordStartsWith(e,r)});return u&&e.push({emoticon:n,shortcut:u}),e},[])},a.prototype.getSuggestions=function(t,n){if(!this.isEnabled)return{isExplicit:!1,suggestions:[]};var i=t.getSelectionStart(),s=o.wordAt(t.messageBody(),i),a=s.indexOf("(")===0;a&&(s=s.substring(1));if(!a&&(s.length<u||!this.isImplicitEnabled))return{isExplicit:a,suggestions:[]};var l=this.filterEmoticons(s);return l.length===1&&a&&f("("+s,l[0].emoticon)&&(l=[]),{isExplicit:a,suggestions:l.map(function(e){return r.build(t,n,i,e.emoticon,e.shortcut)})}},a}),define("telemetry/chat/suggestionSelectedEvent",["require","constants/common","experience/settings","constants/keys","ui/telemetry/telemetryClient"],function(e){function s(){var e=this,s="message_suggestion_action";e.enums={TRIGGER:{EXPLICIT:"explicit",IMPLICIT:"implicit",QUOTE:"quote"},RESOLUTION:{ENTER:"enter",TAB:"tab",ESC:"escape",CLICKIN:"click-in",CLICKOUT:"click-out",MISSMATCH:"missmatch"},getResolution:function(n){switch(n){case r.TAB:return e.enums.RESOLUTION.TAB;case r.ENTER:return e.enums.RESOLUTION.ENTER;case r.ESC:return e.enums.RESOLUTION.ESC;default:return t.telemetry.NOT_AVAILABLE}}},e.data={},e.publish=function(){e.data.selectedIndex!==t.telemetry.NOT_AVAILABLE&&i.get().sendEvent(n.telemetry.uiTenantToken,s,e.data),e.reset()},e.reset=function(){e.data={criteriaLength:t.telemetry.NOT_AVAILABLE,resolution:t.telemetry.NOT_AVAILABLE,selectedIndex:t.telemetry.NOT_AVAILABLE,suggestionType:t.telemetry.NOT_AVAILABLE,totalMatchCount:t.telemetry.NOT_AVAILABLE,trigger:t.telemetry.NOT_AVAILABLE,visibleMatchCount:t.telemetry.NOT_AVAILABLE}},e.reset()}var t=e("constants/common"),n=e("experience/settings"),r=e("constants/keys"),i=e("ui/telemetry/telemetryClient");return s}),define("ui/components/chat/suggestions/mentionSuggestion",["require","lodash-compat","ui/components/chat/suggestions/simpleWordSuggestion"],function(e){function s(e,t,n,r){this.participant=r,this.textarea={view:t,viewModel:e},this.searchPosition=n}var t=e("lodash-compat"),n=e("ui/components/chat/suggestions/simpleWordSuggestion"),r="MENTIONS",i="swx-suggestion-mention";return s.prototype.templateId=i,s.prototype.suggestionType=r,s.prototype.getReplacer=function(t){return t.data.participantsCount=this.textarea.viewModel.conversationModel.participants().length,"@"+this.participant.person.id()},s.build=function(t,n,r,i){return new s(t,n,r,i)},t.assign(s.prototype,n.prototype),s}),define("ui/components/chat/suggestions/mentionSuggestionEngine",["require","lodash-compat","constants/common","ui/components/chat/suggestions/mentionSuggestion","ui/modelHelpers/personHelper","services/serviceLocator","swx-utils-common"],function(e){function a(){var e=s.resolve(n.serviceLocator.FEATURE_FLAGS);this.isEnabled=e.isFeatureOn(n.featureFlags.MENTIONS_ENABLED),this.matchImplicitByContains=e.isFeatureOn(n.featureFlags.AGGRESSIVE_IMPLICT_MENTIONS_MATCHING)}function f(e,n){if(!e)return!1;var r=new RegExp(t.escapeRegExp(n),"i");return o.normalize(e).search(r)!==-1}var t=e("lodash-compat"),n=e("constants/common"),r=e("ui/components/chat/suggestions/mentionSuggestion"),i=e("ui/modelHelpers/personHelper"),s=e("services/serviceLocator"),o=e("swx-utils-common").stringUtils,u=4;return a.prototype.priority=1,a.prototype.filterParticipants=function(t,n,r){function u(e){return!i.isPstn(e.person)&&(o.anyWordStartsWith(e.person.displayName(),r)||o.anyWordStartsWith(e.person.id(),r))}function a(e){return!i.isPstn(e.person)&&(f(e.person.displayName(),r)||f(e.person.id(),r))}var s=n||this.matchImplicitByContains?a:u;return t.filter(s)},a.prototype.getSuggestions=function(t,n){if(!t.conversationModel.isGroupConversation()||!this.isEnabled)return{isExplicit:!1,suggestions:[]};var i=t.getSelectionStart(),s=t.conversationModel.participants(),a=o.wordAt(t.messageBody(),i),f=a[0]==="@";f&&(a=a.substring(1));if(!f&&a.length<u)return{isExplicit:f,suggestions:[]};var l=this.filterParticipants(s,f,a);return l.length===1&&f&&a===l[0].person.id()&&(l=[]),{isExplicit:f,suggestions:l.map(function(e){return r.build(t,n,i,e)})}},a}),define("ui/viewModels/chat/suggestions/suggestionList",["require","exports","module","lodash-compat","constants/common","ui/components/chat/suggestions/emoticonSuggestionEngine","utils/common/eventMixin","constants/keys","vendor/knockout","telemetry/chat/suggestionSelectedEvent","ui/components/chat/suggestions/mentionSuggestionEngine","utils/common/outsideClickHandler"],function(e,t){function p(){function p(n,r){var i=e.suggestions()[e.selectedIndex()];i.applySuggestion(t),t.data.selectedIndex=e.selectedIndex(),t.data.resolution=t.enums.getResolution(n),t.publish(),e.isVisible(!1),r.setBlurAndFocus()}function d(){t.data.resolution=t.enums.RESOLUTION.ESC,t.data.selectedIndex=e.selectedIndex(),t.publish(),e.isVisible(!1)}function v(t){var n=e.selectedIndex()+t;e.selectedIndex()===-1&&(n=t===-1?e.suggestions().length-1:0),0<=n&&n<e.suggestions().length&&e.selectedIndex(n)}function m(){e.isVisible()&&(t.data.resolution=t.enums.RESOLUTION.CLICKOUT,t.data.selectedIndex=e.selectedIndex(),t.publish(),e.isVisible(!1))}function g(i){s=i.viewModel;var o=r.map(function(e){return e.getSuggestions(i.viewModel,i.view)}),u=n.some(o,function(e){return e.isExplicit});t.data.trigger=u?t.enums.TRIGGER.EXPLICIT:t.enums.TRIGGER.IMPLICIT,o=o.reduce(function(e,t){return t.isExplicit===u?e.concat(t.suggestions):e},[]),t.data.totalMatchCount=o.length,o=n.take(o,h),t.data.visibleMatchCount=o.length;var a=e.isVisible();e.suggestions(o),e.isVisible(o.length!==0),e.selectedIndex()>=o.length?e.selectedIndex(o.length-1):(!a||e.selectedIndex()===-1)&&e.selectedIndex(u?0:-1),a&&!e.isVisible()&&(t.data.resolution=t.enums.RESOLUTION.MISSMATCH,t.data.selectedIndex=e.selectedIndex(),t.publish())}function y(t){var n=t.event.keyCode||t.event.which;if(!e.isVisible())return;var r=!0;switch(n){case u.ESCAPE:d();break;case u.UP:case u.DOWN:v(n===u.UP?-1:1);break;case u.ENTER:case u.TAB:e.selectedIndex()!==-1?p(n,t.viewModel):r=!1;break;default:r=!1}r&&t.event.stopImmediatePropagation()}var e=this,t,r,s;e.isVisible=a.observable(!1),e.selectedIndex=a.observable(0),e.suggestions=a.observableArray([]),e.dispose=function(){c.remove("suggestionList")},e.init=function(u){t=u.suggestionSelectedTelemetryEvent||new f,r=u.suggestionEngines||[],r.length===0&&(r.push(new l),r.push(new i)),r=n.sortBy(r,"priority"),e.registerEvent(o.textarea.KEY_DOWN,y),e.registerEvent(o.textarea.INPUT,g),e.isVisible.subscribe(function(e){e?c.add("suggestionList",m):c.remove("suggestionList")})},e.onSuggestionClick=function(r){r.applySuggestion(t);var i=e.suggestions().indexOf(r);t.data.selectedIndex=i,t.data.resolution=t.enums.RESOLUTION.CLICKIN,t.publish(),e.selectedIndex(i),e.isVisible(!1),s&&s.setBlurAndFocus()},e.onSuggestionMouseOver=function(n){var r=e.suggestions().indexOf(n);e.selectedIndex(r)}}var n=e("lodash-compat"),r=e("constants/common"),i=e("ui/components/chat/suggestions/emoticonSuggestionEngine"),s=e("utils/common/eventMixin"),o=r.events,u=e("constants/keys"),a=e("vendor/knockout"),f=e("telemetry/chat/suggestionSelectedEvent"),l=e("ui/components/chat/suggestions/mentionSuggestionEngine"),c=e("utils/common/outsideClickHandler"),h=8;n.assign(p.prototype,s),t.build=function(){return new p}}),define("text!views/chat/suggestions/suggestionList.html",[],function(){return'<div class="suggestionList" data-bind="visible: isVisible">\r\n    <ul class="list" data-bind="foreach: { data: suggestions, as: \'suggestion\' }">\r\n        <li class="item" data-bind="event: { mouseover: $parent.onSuggestionMouseOver, click: $parent.onSuggestionClick },\r\n                                    css: { selected: $index() === $parent.selectedIndex() },\r\n                                    template: { name: suggestion.templateId, data: { isSelected: $index() === $parent.selectedIndex(), data: suggestion } }"></li>\r\n    </ul>\r\n</div>\r\n\r\n<script type="text/html" id="swx-suggestion-mention">\r\n    <span class="mention" data-type="mention">\r\n        <swx-avatar-deprecated params="avatar: data.participant.person.avatarUrl()"></swx-avatar-deprecated>\r\n        <span class="participantName" data-bind="html: \'@\' + data.participant.person.displayName()"></span>\r\n    </span>\r\n</script>\r\n\r\n<script type="text/html" id="swx-suggestion-emoticon">\r\n    <span class="emoticonSuggestion largeAllowed" data-type="emoticon">\r\n        <span class="emoticon large" data-bind="css: data.emoticon.id + (isSelected ? \' animated\' : \'\')"><span class="emoSprite" data-bind="text: data.emoticon.shortcuts[0]"></span></span>\r\n        <span class="description" data-bind="html: data.emoticon.description"></span>\r\n    </span>\r\n</script>\r\n'}),define("ui/components/chat/suggestions/suggestionList",["require","vendor/knockout","constants/components","ui/viewModels/chat/suggestions/suggestionList","text!views/chat/suggestions/suggestionList.html"],function(e){var t=e("vendor/knockout"),n=e("constants/components").chat.SUGGESTION_LIST,r=e("ui/viewModels/chat/suggestions/suggestionList"),i=e("text!views/chat/suggestions/suggestionList.html");return{name:n,template:i,viewModel:{createViewModel:function(n,i){var s=r.build();return s.init(n),s.setContext(t.dataFor(i.element)),s}}}}),define("ui/viewModels/chat/videoPlayer",["require","exports","module","lodash-compat","browser/dom","browser/document","utils/common/eventMixin","constants/common","vendor/knockout","swx-i18n","telemetry/chat/videoMessagePlayback"],function(e,t){function l(e,t){function y(e){function r(e){return e.toString().length===1?"0"+e:e}var t=Math.round(e),n=0;return t>=g&&(n=parseInt(t/g),t-=n*g),r(n)+":"+r(t)}function b(e){n.currentProgress("width: "+e+"%")}function w(e){var t=c.offsetWidth,n=c.getBoundingClientRect().left,r=e.pageX-n;l.currentTime=l.duration*(r/t),b(r/t*100)}function E(){n.isInFullscreen(i.fullscreenElement||i.mozFullscreenElement||i.webkitFullscreenElement),n.isInFullscreen()||n.dispatchEvent(o.events.videoPlayer.FULLSCREEN_OFF,null,n.DIRECTION.PARENT)}function S(){s.requestFullscreen?s.requestFullscreen():s.mozRequestFullScreen?s.mozRequestFullScreen():s.webkitRequestFullScreen?s.webkitRequestFullScreen():s.msRequestFullScreen&&s.msRequestFullScreen()}function x(){i.exitFullscreen?i.exitFullscreen():i.mozCancelFullScreen?i.mozCancelFullScreen():i.webkitExitFullscreen?i.webkitExitFullscreen():i.msExitFullscreen&&i.msExitFullscreen()}function T(){p||(p=!0,f.sendSeekAction())}function N(){d||(d=!0,f.sendFullscreenAction())}var n=this,s=r.getElement(".VideoPlayer",e),l=r.getElement(".VideoPlayer-player",e),c=r.getElement(".VideoPlayer-timeline",e),h=!1,p=!1,d=!1,v=u.observable(0),m=u.observable(0),g=60;n.media=t.media,n.poster=t.poster,n.autoplay=t.autoplay||!1,n.isPlaying=u.observable(!1),n.isInFullscreen=u.observable(!1),n.isFullscreenSupported=s.requestFullscreen||s.mozRequestFullScreen||s.webkitRequestFullScreen||s.msRequestFullScreen,n.currentProgress=u.observable("0"),n.currentTime=u.pureComputed(function(){return y(v())}),n.totalTime=u.pureComputed(function(){return y(m())}),n.playButtonText=u.pureComputed(function(){return n.isPlaying()?a.fetch({key:"videoPlayer_pause"}):a.fetch({key:"videoPlayer_play"})}),n.fullscreenButtonText=u.pureComputed(function(){return n.isInFullscreen()?a.fetch({key:"videoPlayer_exitFullscreen"}):a.fetch({key:"videoPlayer_fullscreen"})}),n.onMetadataLoaded=function(){h=!0,v(l.currentTime),m(l.duration),f.sendLoadedEvent()},n.onTimeUpdated=function(){v(l.currentTime),b(v()/m()*100)},n.onVideoEnded=function(){n.isPlaying(!1)},n.togglePlay=function(){h&&(l.ended&&f.sendReplayAction(),l.paused||l.ended?(l.play(),n.isPlaying(!0)):(l.pause(),n.isPlaying(!1)))},n.toggleFullscreen=function(){n.isInFullscreen()?x():(n.dispatchEvent(o.events.videoPlayer.FULLSCREEN_ON,null,n.DIRECTION.PARENT),S(),N())},n.onTimelineClick=function(e,t){w(t),T()},n.onHandleStartDrag=function(e,t){function n(){i.removeEventListener("mousemove",w),i.removeEventListener("mouseup",n)}w(t),i.addEventListener("mousemove",w),i.addEventListener("mouseup",n),T()},n.init=function(){n.autoplay&&n.isPlaying(!0),i.addEventListener("webkitfullscreenchange",E),i.addEventListener("mozfullscreenchange",E),i.addEventListener("MSFullscreenChange",E),i.addEventListener("fullscreenchange",E)},n.dispose=function(){n.currentTime.dispose(),n.totalTime.dispose(),n.playButtonText.dispose(),n.fullscreenButtonText.dispose(),i.removeEventListener("webkitfullscreenchange",E),i.removeEventListener("mozfullscreenchange",E),i.removeEventListener("MSFullscreenChange",E),i.removeEventListener("fullscreenchange",E)}}var n=e("lodash-compat"),r=e("browser/dom"),i=e("browser/document"),s=e("utils/common/eventMixin"),o=e("constants/common"),u=e("vendor/knockout"),a=e("swx-i18n").localization,f=e("telemetry/chat/videoMessagePlayback");t.build=function(e,t){return new l(e,t)},n.assign(l.prototype,s)}),define("text!views/chat/videoPlayer.html",[],function(){return'<div class="VideoPlayer">\r\n\r\n    <div class="VideoPlayer-controlsOverlay" data-bind="click: togglePlay"></div>\r\n\r\n    <video class="VideoPlayer-player" data-bind="attr: { src: media, poster: poster, autoplay: autoplay }, click: togglePlay,\r\n            event: {loadedmetadata: onMetadataLoaded, timeupdate: onTimeUpdated, ended: onVideoEnded}">\r\n    </video>\r\n\r\n    <div class="VideoPlayer-controls">\r\n\r\n        <button data-bind="click: togglePlay, attr: {title: playButtonText }"\r\n                class="VideoPlayer-button VideoPlayer-togglePlay btn circle" type="button">\r\n            <span class="iconfont play" data-bind="css: { pause: isPlaying() }, text: playButtonText"></span>\r\n        </button>\r\n\r\n        <div class="VideoPlayer-currentTime" data-bind="text: currentTime"></div>\r\n\r\n        <div class="VideoPlayer-timeline" data-bind="click: onTimelineClick">\r\n\r\n            <div class="VideoPlayer-totalProgress"></div>\r\n\r\n            <div class="VideoPlayer-progress" data-bind="attr: {style: currentProgress}">\r\n                <div class="VideoPlayer-handle" data-bind="event: {mousedown: onHandleStartDrag}"></div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="VideoPlayer-totalTime" data-bind="text: totalTime"></div>\r\n\r\n        <!-- ko if: isFullscreenSupported -->\r\n        <button data-bind="click: toggleFullscreen, attr: {title: fullscreenButtonText }"\r\n                class="VideoPlayer-button VideoPlayer-toggleFullscreen btn circle" type="button">\r\n            <span class="iconfont fullscreen" data-bind="css: { fullscreenOff: isInFullscreen() }, text: fullscreenButtonText"></span>\r\n        </button>\r\n        <!-- /ko -->\r\n\r\n    </div>\r\n</div>'}),define("ui/components/chat/videoPlayer",["require","exports","module","vendor/knockout","ui/viewModels/chat/videoPlayer","constants/components","text!views/chat/videoPlayer.html"],function(e,t){function i(e,t){var i=t.element,s=r.build(i,e),o=n.dataFor(i);return s.init(),s.setContext(o),s}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/videoPlayer");t.name=e("constants/components").chat.VIDEO_PLAYER,t.template=e("text!views/chat/videoPlayer.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/userListPopup",["require","exports","module","utils/common/eventMixin","constants/common","utils/common/async","browser/document","browser/dom","vendor/knockout","lodash-compat","utils/common/scroll","utils/common/outsideClickHandler"],function(e,t){function c(e,t){function d(e){n.hidden()&&a(e)&&(e.eventPageY/s.body.clientHeight>.5?p(!0):p(!1),v())}function v(){n.hidden(!1),i.execute(function(){l.add("UserListPopup",m)})}function m(){n.hidden(!0),l.remove("UserListPopup")}var n=this,a=e.isSelfPopup()||function(){return!0},c=o.getElement(".UserListPopup-scrollingContainer",t),h,p;n.title=e.title,n.users=e.users,n.hidden=u.observable(!0),p=u.observable(),n.userListPopupCss=u.computed(function(){var e={UserListPopup:!0,popup:!0,arrow:!0,down:p(),up:!p(),"fontSize-p":!0};return e}),n.init=function(){t.addEventListener("contextmenu",function(e){e.stopPropagation()}),n.registerEvent(r.events.userListPopup.POPUP_TOGGLE,d),h=f.build(c),h.init()},n.dispose=function(){h.dispose(),n.userListPopupCss.dispose()}}var n=e("utils/common/eventMixin"),r=e("constants/common"),i=e("utils/common/async"),s=e("browser/document"),o=e("browser/dom"),u=e("vendor/knockout"),a=e("lodash-compat"),f=e("utils/common/scroll"),l=e("utils/common/outsideClickHandler");t.build=function(e,t){return new c(e,t)},a.assign(c.prototype,n)}),define("text!views/chat/userListPopup.html",[],function(){return'<div data-bind="css: userListPopupCss, visible: !hidden()">\r\n    <h3 class="UserListPopup-title" data-bind="text: title"></h3>\r\n    <div class="UserListPopup-scrollingContainer">\r\n        <ul class="UserListPopup-usersContainer scrollViewport scrollViewportV" data-bind="foreach: users" tabindex="-1">\r\n            <li class="UserListPopup-user list-selectable">\r\n                <!-- ko if: person -->\r\n                <swx-avatar-deprecated params="avatar: person.avatarUrl(), status: contact.statusClassName"></swx-avatar-deprecated>\r\n                <!-- /ko -->\r\n                <!-- ko ifnot: person -->\r\n                <swx-avatar-deprecated params="isGroupAvatar: false"></swx-avatar-deprecated>\r\n                <!-- /ko -->\r\n                <div class="UserListPopup-info">\r\n                    <span class="UserListPopup-displayName" data-bind="text: displayName"></span>\r\n                    <!-- ko if: (person && contact.displayMessage) -->\r\n                    <span class="UserListPopup-status" data-bind="text: contact.displayMessage"></span>\r\n                    <!-- /ko -->\r\n                    <!-- ko ifnot: (person && contact.displayMessage) -->\r\n                    <span class="UserListPopup-status" data-bind="l10n: { key: \'message_text_presenceUnknown\' }"></span>\r\n                    <!-- /ko -->\r\n                </div>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/userListPopup",["require","exports","module","ui/viewModels/chat/userListPopup","constants/components","text!views/chat/userListPopup.html"],function(e,t){function r(e,t){var r=n.build(e,t.element);return r.setContext(e.eventContext),r.init(),r}var n=e("ui/viewModels/chat/userListPopup");t.name=e("constants/components").chat.USER_LIST_POPUP,t.template=e("text!views/chat/userListPopup.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/translator/translatorSettings",["require","exports","module","cafe/applicationInstance","browser/dom","browser/document","swx-i18n","vendor/knockout","utils/common/eventHelper","utils/common/cafeObservable","experience/settings","constants/common","telemetry/translator/translatorTelemetry","utils/common/outsideClickHandler"],function(e,t){function d(e){function N(){t.dialogOpened(!0),p.add(w,C),i.body.addEventListener("focus",k,!0),i.body.addEventListener("keydown",L,!0)}function C(){t.dialogOpened(!1),p.remove(w),i.body.removeEventListener("focus",k,!0),i.body.removeEventListener("keydown",L,!0)}function k(e){var t=!!r.getParentWithClass(e.target,w)||!!r.getParentWithClass(e.relatedTarget,w)||!!r.getParentWithClass(e.explicitOriginalTarget,w);t||C()}function L(e){u.isDeactivation(e)&&(C(),T.send(c.eventType.SETTINGS_HIDE,{initiator:c.initiator.ESCAPE_KEY}))}function A(){return l._translatorSettings&&l._translatorSettings.meLanguage||y||b}function O(){return l._translatorSettings&&l._translatorSettings.participantLanguage||b}function M(e){t.translatorEnabled(!0),l._translatorSettings.meLanguage=e,T.send(c.eventType.ME_LANGUAGE_CHANGED,{language:e.code,settingsInitParamsLocale:f.initParams.locale})}function _(e){t.translatorEnabled(!0),l._translatorSettings.participantLanguage=e,T.send(c.eventType.PARTICIPANT_LANGUAGE_CHANGED,{selectedLanguage:e.code})}function D(){l._translatorSettings.meLanguage=null,l._translatorSettings.participantLanguage=null}function P(){l._translatorSettings.meLanguage=t.meLanguage(),l._translatorSettings.participantLanguage=t.participantLanguage()}function H(e){l._translatorSettings&&(l._translatorSettings.isEnabled=e,e?P():D())}function B(){return f.initParams.locale.replace(/-\w+/,"").toLowerCase()}function j(){n.get().translatorService.supportedLanguages().forEach(function(e){var n={name:e.name(),code:e.code()};n.code===g&&(y=n),n.code==="en"&&(b=n),t.availableLanguages.push(n)})}var t=this,l=e.conversationModel,d=n.get().personsAndGroupsManager.mePerson,v=s.fetch({key:"label_translator_translatorOn"}),m=s.fetch({key:"label_translator_translatorOff"}),g,y,b={name:"English",code:"en"},w="TranslatorSettings",E,S,x,T=h.build();t.init=function(){t.availableLanguages=o.observableArray(),g=B(),j(),t.translatorEnabled=o.observable(!1),t.participantAvatar=a.newObservableProperty(l.participants()[0].person.avatarUrl),t.participantDisplayName=a.newObservableProperty(l.participants()[0].person.displayName),t.participantLanguage=o.observable(O()),t.meAvatar=a.newObservableProperty(d.avatarUrl),t.meDisplayName=a.newObservableProperty(d.displayName),t.meLanguage=o.observable(A()),t.dialogOpened=o.observable(!1),t.settingsButtonLabel=s.fetch({key:"button_translator_translatorSettings"}),t.settingsButtonAriaLabel=o.computed(function(){return t.translatorEnabled()?t.settingsButtonLabel+". "+s.fetch({key:"button_translator_translatorSettingsOn"}):t.settingsButtonLabel+". "+s.fetch({key:"button_translator_translatorSettingsOff"})}),t.settingsDialogLabel=s.fetch({key:"label_translator_translatorSettings"}),t.meLanguagePickerLabel=o.computed(function(){return s.fetch({key:"label_translator_selected_myLanguage",params:{language:t.meLanguage().name}})}),t.theirLanguagePickerLabel=o.computed(function(){return s.fetch({key:"label_translator_selected_theirLanguage",params:{name:t.participantDisplayName(),language:t.participantLanguage().name}})}),E=t.translatorEnabled.subscribe(H),S=t.participantLanguage.subscribe(_),x=t.meLanguage.subscribe(M),t.translatorToggleText=o.computed(function(){return t.translatorEnabled()?v:m}),t.translatorEnabledHandler=function(){var e=t.translatorEnabled();t.translatorEnabled(!t.translatorEnabled()),e||T.send(c.eventType.SETTINGS_BUTTON_ENABLED,{meLanguage:t.meLanguage().code,participantLanguage:t.participantLanguage().code})},t.onTranslatorEnabledKeyDown=function(e,n){var r=u.isActivation(n);return r&&t.translatorEnabledHandler(),!r},t.settingsButtonHandler=function(){t.dialogOpened()?(C(),T.send(c.eventType.SETTINGS_HIDE,{initiator:c.initiator.CLICK_GLOBE_BUTTON})):(N(),T.send(c.eventType.SETTINGS_SHOW))},l._translatorSettings?t.translatorEnabled(l._translatorSettings.isEnabled):l._translatorSettings={meLanguage:t.meLanguage(),participantLanguage:t.participantLanguage(),isEnabled:t.translatorEnabled()}},t.dispose=function(){t.dialogOpened()&&C(),t.participantAvatar.dispose(),t.participantDisplayName.dispose(),t.meAvatar.dispose(),t.meDisplayName.dispose(),t.translatorToggleText.dispose(),t.meLanguagePickerLabel.dispose(),t.theirLanguagePickerLabel.dispose(),t.settingsButtonAriaLabel.dispose(),S.dispose(),x.dispose(),E.dispose()}}var n=e("cafe/applicationInstance"),r=e("browser/dom"),i=e("browser/document"),s=e("swx-i18n").localization,o=e("vendor/knockout"),u=e("utils/common/eventHelper"),a=e("utils/common/cafeObservable"),f=e("experience/settings"),l=e("constants/common"),c=l.telemetry.translator,h=e("telemetry/translator/translatorTelemetry"),p=e("utils/common/outsideClickHandler");t.build=function(e){return new d(e)}}),define("text!views/chat/translator/translatorSettings.html",[],function(){return'<div class="TranslatorSettings">\r\n    <button class="settingsButton btn transparent circle" data-bind="click: settingsButtonHandler, attr: {\'aria-label\': settingsButtonAriaLabel, title: settingsButtonLabel}, css: {off: !translatorEnabled()}" type="button">\r\n        <span id="settingsButtonLabelId" class="iconfont globe" data-bind="text: settingsButtonLabel"></span>\r\n    </button>\r\n    <!-- ko if: dialogOpened -->\r\n    <div class="SettingsDialog popup arrow up">\r\n        <h4 class="header" data-bind="text: settingsDialogLabel"></h4>\r\n\r\n        <div class="Splitter"></div>\r\n\r\n        <div class="SettingsDialog-toggle">\r\n            <span id="enableTranslator" class="fontSize-p" data-bind="text: translatorToggleText"></span>\r\n            <button aria-labelledby="settingsButtonLabelId" class="toggler" type="button" role="checkbox" aria-relevant="all"\r\n                    data-bind="click: translatorEnabledHandler, event: { keydown: onTranslatorEnabledKeyDown }, css: { checked: translatorEnabled }, attr: { \'aria-checked\': translatorEnabled() ? \'true\' : \'false\', \'aria-label\': settingsButtonLabel}">\r\n                <span class="on"></span>\r\n                <span class="off"></span>\r\n            </button>\r\n        </div>\r\n\r\n        <div class="Splitter"></div>\r\n\r\n        <div class="SettingsDialog-lang">\r\n            <swx-avatar-deprecated params="avatar: meAvatar"></swx-avatar-deprecated>\r\n            <div class="text" >\r\n                <p data-bind="text: meDisplayName" class="displayName"></p>\r\n                <swx-translator-language-picker params="language: meLanguage, supportedLanguages: availableLanguages, class: \'LanguagePicker-mine\', ariaLabel: meLanguagePickerLabel"></swx-translator-language-picker>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="SettingsDialog-icons">\r\n            <div class="Splitter lang"></div>\r\n            <div class="iconsGroup">\r\n                <div class="chat"><span class="iconfont message"></span></div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="SettingsDialog-lang bottom">\r\n            <swx-avatar-deprecated params="avatar: participantAvatar"></swx-avatar-deprecated>\r\n            <div class="text">\r\n                <p data-bind="text: participantDisplayName" class="displayName"></p>\r\n                <swx-translator-language-picker params="language: participantLanguage, supportedLanguages: availableLanguages, class: \'LanguagePicker-their\', ariaLabel: theirLanguagePickerLabel"></swx-translator-language-picker>\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/chat/translatorSettings",["require","exports","module","ui/viewModels/chat/translator/translatorSettings","constants/components","text!views/chat/translator/translatorSettings.html"],function(e,t){function r(e){var t=n.build(e);return t.init(),t}var n=e("ui/viewModels/chat/translator/translatorSettings");t.name=e("constants/components").chat.TRANSLATOR_SETTINGS,t.template=e("text!views/chat/translator/translatorSettings.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/translator/translatorLanguagePicker",["require","exports","module","browser/dom","vendor/knockout","utils/common/eventHelper","utils/common/scroll","utils/common/outsideClickHandler"],function(e,t){function u(e,t){function h(e,t){return e.name.localeCompare(t.name)}function p(){u.menuOpened(!0),o.add(c,d),v()}function d(){u.menuOpened(!1),o.remove(c),m()}function v(){var e=n.getElement(".LanguagePicker-item.selected",t);e&&e.scrollIntoView()}function m(){var e=n.getElement(".LanguagePicker-button",t);e&&e.focus()}var u=this,a=e.language,f=e.supportedLanguages.sort(h),l,c=e.class;u.init=function(){u.language=a,u.menuOpened=r.observable(!1),u.supportedLanguages=f,l=s.build(n.getElement("div.LanguagePicker-content",t)),l.init(),u.pickerClass={},u.pickerClass[e.class]=!0,u.languageButtonLabel=e.ariaLabel,u.languageButtonHandler=function(){u.menuOpened()?d():p()},u.onLanguageButtonKeyDown=function(e,t){var n=i.isActivation(t);return n&&u.languageButtonHandler(),!n},u.languageSelectionHandler=function(e){a(e),d()}},u.dispose=function(){u.menuOpened()&&d(),l.dispose()}}var n=e("browser/dom"),r=e("vendor/knockout"),i=e("utils/common/eventHelper"),s=e("utils/common/scroll"),o=e("utils/common/outsideClickHandler");t.build=function(e,t){return new u(e,t)}}),define("text!views/chat/translator/translatorLanguagePicker.html",[],function(){return'<div class="LanguagePicker" data-bind="css:pickerClass">\r\n    <div class="fontSize-p">\r\n        <a href="#" role="button" class="LanguagePicker-button" data-bind="text: language().name, click: languageButtonHandler, event: { keydown: onLanguageButtonKeyDown }, attr:{\'aria-label\' : languageButtonLabel}"></a>\r\n        <span class="iconfont chevronDown" data-bind="click: languageButtonHandler"></span>\r\n    </div>\r\n\r\n    <div class="LanguagePicker-menu popup arrow up" data-bind="css: {hide: !menuOpened()}">\r\n        <div class="LanguagePicker-content" data-bind="keyboardNavigation: { itemSelector: \'.LanguagePicker-item\' }">\r\n            <div class="scrollViewport scrollViewportV" tabindex="-1">\r\n                <ul role="menu">\r\n                    <li><div class="icons"><span class="iconfont message"></span></div></li>\r\n                    <!-- ko foreach: { data: supportedLanguages, as: \'item\' } -->\r\n                    <li role="menuitem"><span class="LanguagePicker-item fontSize-p" data-bind="text: item.name, click: $parent.languageSelectionHandler, enterKey: $parent.languageSelectionHandler, css:{selected: $parent.language().name === item.name}, attr:{\'aria-label\' : item.name}"></span></li>\r\n                    <!-- /ko -->\r\n                </ul>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/translatorLanguagePicker",["require","exports","module","ui/viewModels/chat/translator/translatorLanguagePicker","constants/components","text!views/chat/translator/translatorLanguagePicker.html"],function(e,t){function r(e,t){var r=t.element,i=n.build(e,r);return i.init(),i}var n=e("ui/viewModels/chat/translator/translatorLanguagePicker");t.name=e("constants/components").chat.TRANSLATOR_LANGUAGE_PICKER,t.template=e("text!views/chat/translator/translatorLanguagePicker.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/moreActionsButton",["require","exports","module","lodash-compat","vendor/knockout","constants/common","utils/common/eventMixin","swx-i18n","ui/contextMenu/items/all","services/serviceLocator","ui/telemetry/actions/actionNames"],function(e,t){function l(e){function n(){var e=a.resolve(i.serviceLocator.ACTION_TELEMETRY);e.recordAction(f.conversation.moreActionsButton)}var t=this;t.cssClass=e.cssClass,t.tabIndex=e.tabIndex,t.title=o.fetch({key:"button_text_moreActions"}),t.showMenuOptions=r.observable(!1),t.hasMenuOptions=function(){return!0},t.getMenuOptions=function(){var t=[];return n(),t.push(u.AddParticipantsMenuItem.build(e.addParticipantsDisabled,e.addParticipantsAction)),t.push(u.ScheduleCallMenuItem.build(e.conversation)),t}}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("constants/common"),s=e("utils/common/eventMixin"),o=e("swx-i18n").localization,u=e("ui/contextMenu/items/all"),a=e("services/serviceLocator"),f=e("ui/telemetry/actions/actionNames");n.assign(l.prototype,s),t.build=function(e){return new l(e)}}),define("text!views/chat/moreActionsButton.html",[],function(){return"<swx-button params=\"icon: 'more',\r\n    cssClass: cssClass,\r\n    titleKey: 'button_text_moreActions',\r\n    textKey: 'button_text_moreActions',\r\n    i18nTitle: title,\r\n    ariaLabelKey: 'button_text_moreActions',\r\n    showMenuOptions: showMenuOptions,\r\n    hasMenuOptions: hasMenuOptions,\r\n    menuOptions: getMenuOptions\"></swx-button>\r\n"}),define("ui/components/chat/moreActionsButton",["require","exports","module","vendor/knockout","ui/viewModels/chat/moreActionsButton","constants/components","text!views/chat/moreActionsButton.html"],function(e,t){function i(e,t){var i=r.build(e),s=n.dataFor(t.element);return i.setContext(s),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/moreActionsButton");t.name=e("constants/components").chat.MORE_ACTIONS_BUTTON,t.template=e("text!views/chat/moreActionsButton.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/heart",["require","exports","module","vendor/knockout","swx-i18n"],function(e,t){function i(e,t){function a(){u.forEach(function(e){t.element.addEventListener(e,c,!1)})}function f(){u.forEach(function(e){t.element.removeEventListener(e,c,!1)})}function l(){s.dispose(),h(!0),a()}function c(){h(!1),s=i.heartsCount.subscribe(l),f()}function h(e){var t={hasLikes:!!i.heartsCount(),hasMyLike:i.isHeartedByMe(),anim:!!e};i.heartCss(t)}var i=this,s,o=e.heartsVM,u=["webkitAnimationEnd","animationend","oanimationend"];i.onClickHandler=o.heartMessage,i.heartsCount=o.heartsCount,i.isHeartedByMe=o.isHeartedByMe,i.heartCss=n.observable({}),i.heartButtonLabel=n.computed(function(){return i.isHeartedByMe()?r.fetch({key:"hearts_accessibility_unlike"}):r.fetch({key:"hearts_accessibility_like"})}),i.dispose=function(){i.heartButtonLabel.dispose(),f(),s.dispose()},h(!1),s=o.heartsCount.subscribe(l)}var n=e("vendor/knockout"),r=e("swx-i18n").localization;t.build=function(e,t){return new i(e,t)}}),define("text!views/chat/heart.html",[],function(){return'<div class="Heart" data-bind="css: heartCss">\r\n    <span class="iconfont clickable" data-bind="click: onClickHandler, attr: {\'aria-label\': heartButtonLabel}" role="button"></span>\r\n    <!-- ko if: (heartsCount && heartsCount() > 1) -->\r\n    <span class="counter" data-bind="text: heartsCount"></span>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/chat/heart",["require","exports","module","ui/viewModels/chat/heart","constants/components","text!views/chat/heart.html"],function(e,t){function r(e,t){return n.build(e,t)}var n=e("ui/viewModels/chat/heart");t.name=e("constants/components").chat.HEART,t.template=e("text!views/chat/heart.html"),t.viewModel={createViewModel:r}}),define("text!views/chat/pes.v2/store/browseTabs.html",[],function(){return'<div class="overlayControls">\r\n    <h1  class="storeTitle" data-bind="l10n: { \'key\': \'expressionPicker_store_title\' }"></h1>\r\n    <input type="text" data-bind="\r\n        textInput: searchQuery,\r\n        event: {keydown: onSearchBoxKeyDown},\r\n        l10n_attr: {\r\n            \'placeholder\':  \'input_placeholder_searchPESStore\',\r\n            \'aria-label\':   \'input_placeholder_searchPESStore\'\r\n            }" value="" name="query" class="inputField fontSize-h4 store-search" placeholder="Search for items..." aria-label="Search items. Type keyword" data-focusmanager="3" style="">\r\n    <div class="storeSearchIcon"></div>\r\n    <div class="right">\r\n        <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n            <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'pluginInstall_main_text_close\' }"></span>\r\n        </button>\r\n    </div>\r\n</div>\r\n<div class="wrapper swx-pes-store">\r\n    <swx-loading-animation data-bind="visible: showSpinner()" class="spinner blue loading-data"></swx-loading-animation>\r\n    <p class="error" data-bind="visible: showErrorText()">Error Loading Tabs</p>\r\n    <div data-bind="visible: showTabList()" class="tabs-list">\r\n        <ul data-bind="template: { name: \'tab-item-template\', foreach: tabs, as: \'tab\'  }" class="scrollViewport scrollViewportV" tabindex="-1"></ul>\r\n    </div>\r\n    <div  class="tabs-details-wrapper" data-bind="visible: showTabDetails()">\r\n        <div  data-bind="template: { name: \'tab-details-template\', if: selectedTab(), data: selectedTab  }" class="scrollViewport scrollViewportV">\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<script type="text/html" id="tab-item-template">\r\n    <li class="store-tab-item" data-bind="attr: { \'data-name\': tab.id, \'title\': tab.name}, event: {click: $parent.tabSelected}, css: tab.isSelectedCSS, visible: tab.showInList()"\r\n        aria-live="polite" role="listitem">\r\n        <div class="tab-thumbnail" data-bind="style: {backgroundImage:\'url(\'+tab.thumbnail+\')\'}"></div>\r\n        <div class="buy-or-download" data-bind="template: { name: \'buy-download-tab-template\', data: tab }, event: {click: $parent.buyOrDownloadTab}"></div>\r\n        <p class="title"><span class="tab-name" data-bind="text: tab.name"></span></p>\r\n    </li>\r\n</script>\r\n\r\n<script type="text/html" id="tab-details-template">\r\n    <div class="store-tab-item-details">\r\n        <div class="buy-or-download" data-bind="template: { name: \'buy-download-tab-detailSection-template\'}, event: {click: $parent.buyOrDownloadTab}"></div>\r\n        <div class="tab-desc">\r\n            <div class="tab-title">\r\n                <h2 class="title" data-bind="text:name"></h2>\r\n                <p class="description" data-bind="text:description"></p>\r\n                <p class="description" data-bind="text:copyright"></p>\r\n            </div>\r\n        </div>\r\n        <div class="pack-items-list">\r\n           <div class="content" data-bind="template: { name: \'pack-items-listing-template\', data: {packs: configData().tabs[0].packs, token: cdnToken()}}"></div>\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n\r\n<script type="text/html" id="pack-items-listing-template">\r\n    <ul data-bind="foreach: { data: packs, as: \'pack\' }">\r\n        <li aria-live="polite" role="listitem">\r\n            <h4 class="pack-title" data-bind="text: pack.title"></h4>\r\n            <div class="pack-items" data-bind="visible: pack.items && pack.items.length, css: \'pack-\'+pack.id">\r\n                <ul data-bind="foreach: { data: pack.items, as: \'item\' }">\r\n                    <li class="item" data-bind="attr: {\'title\': item.pickerTitle}">\r\n                        <!-- ko if: item.type === \'emoticon\' -->\r\n                            <img class="item-thumbnail" data-bind="attr: {src: item.thumbnail}">\r\n                        <!-- /ko -->\r\n                        <!-- ko if: item.type === \'flik\' -->\r\n                            <div  class="moji-item" data-bind="template: { name: \'moji-item-template\', data:{item: item, token: $parents[1].token}}"></div>\r\n                        <!-- /ko -->\r\n                            <p class="item-title" data-bind="text: (item.pickerTitle) ? item.pickerTitle : item.title"></p>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n        </li>\r\n    </ul>\r\n</script>\r\n\r\n\r\n<script type="text/html" id="buy-download-tab-template">\r\n   <div class="buy-download-text" data-bind="visible: !showDownloadSpinner(), style: {cursor: isDownloaded() ? \'default\':\'pointer\'}">\r\n        <span data-bind="css: { tick: isDownloaded(), arrowDown: !isDownloaded() }, style: {backgroundColor: isDownloaded() ? \'#7FBA00\':\'#0078CA\'}" class="iconfont">\r\n        </span>\r\n    </div>\r\n    <div class="download-spinner" data-bind="visible: showDownloadSpinner()">\r\n        <swx-loading-animation class="spinner blue"></swx-loading-animation>\r\n    </div>\r\n    <p data-bind="visible: !isDownloaded(), l10n: { key: \'expressionPicker_store_free\' }"></p>\r\n</script>\r\n\r\n<script type="text/html" id="buy-download-tab-detailSection-template">\r\n   <div class="buy-download-text" data-bind="visible: !showDownloadSpinner()">\r\n        <span data-bind="css: { cross: isDownloaded(), arrowDown: !isDownloaded() }" class="iconfont">\r\n            <span data-bind="visible: !isDownloaded(), l10n: { key: \'expressionPicker_store_free\' }"></span>\r\n            <span data-bind="visible: isDownloaded(), l10n: { key: \'expressionPicker_store_removeTab\' }"></span>\r\n        </span>\r\n    </div>\r\n    <div class="download-spinner-wrapper" data-bind="visible: showDownloadSpinner()">\r\n        <div class="download-spinner">\r\n            <swx-loading-animation class="spinner white"></swx-loading-animation>\r\n        </div>\r\n        <p data-bind="l10n: { key: \'expressionPicker_store_Downloading\'}"></p>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="moji-item-template">\r\n    <img class="moji-item-thumbnail" data-bind="attr: {src: (token)?item.thumbnail+\'?\'+token : item.thumbnail}">\r\n    <span class="mojimask"></span>\r\n</script>'}),define("utils/common/interactor",["require","exports","module","lodash-compat"],function(e,t){function r(e){return e.hasOwnProperty("success")||Object.defineProperties(e,{failure:{value:!1,writable:!0,enumerable:!1},success:{value:!0,writable:!0,enumerable:!1},error:{value:null,writable:!0,enumerable:!1},fail:{value:function(e){this.failure=!0,this.success=!1,this.error=e},writable:!0,enumerable:!1}}),e}function i(){this.definition={before:[],after:[],around:[],run:null,rollback:null}}function s(e){this._definition=e}function o(e){return e instanceof s?function(){Function.prototype.apply.call(e.run,e,arguments)}:e}function u(e){return e instanceof s?e:t.defineSimpleInteractor(e)}function a(){}function f(e){if(!e.success)throw new a}function l(e,t){n.forEach(e.before,function(e){Function.prototype.apply.call(e,t,[t.context].concat(t.arguments)),f(t.context)})}function c(e,t){e.rollback&&Function.prototype.apply.call(e.rollback,t,[t.context].concat(t.arguments))}function h(e,t){(function n(r){f(t.context),r<e.around.length?Function.prototype.apply.call(e.around[r],t,[t.context,n.bind(null,r+1)].concat(t.arguments)):Function.prototype.apply.call(e.run,t,[t.context].concat(t.arguments)),f(t.context)})(0)}function p(e,t){n.forEachRight(e.after,function(e){Function.prototype.apply.call(e,t,[t.context].concat(t.arguments)),f(t.context)})}function d(e,t){l(e,t),h(e,t),p(e,t)}function v(e){var t=n.map(e,u),r={before:[],after:[],around:[],run:function(){var e=this,n=0,r;try{while(n<t.length)r=t[n]._definition,d(r,e),n++}catch(i){i instanceof a||e.context.fail(i),n--;while(n>=0)r=t[n]._definition,c(r,e),n--;throw i}},rollback:function(){var e=this,n=0,r;n=t.length-1;while(n>=0)r=t[n]._definition,c(r,e),n--}};s.call(this,r)}function m(e){var t;if(!e)return;e.run&&this.run(e.run),e.before&&(t=n.isArray(e.before)?e.before:[e.before],n.forEach(t,function(e){this.before(e)},this)),e.after&&(t=n.isArray(e.after)?e.after:[e.after],n.forEach(t,function(e){this.after(e)},this)),e.onlyIf&&(t=n.isArray(e.onlyIf)?e.onlyIf:[e.onlyIf],n.forEach(t,function(e){this.onlyIf(e)},this)),e.around&&(t=n.isArray(e.around)?e.around:[e.around],n.forEach(t,function(e){this.around(e)},this)),e.rollback&&this.rollback(e.rollback)}var n=e("lodash-compat");i.prototype={run:function(e){this.definition.run=o(e)},before:function(e){this.definition.before.push(o(e))},after:function(e){this.definition.after.push(o(e))},around:function(e){this.definition.around.push(o(e))},onlyIf:function(e){var t=e;n.isFunction(e)||(t=function(){return e}),this.around(function(e,n){t()&&n()})},rollback:function(e){this.definition.rollback=o(e)}},s.prototype.run=function(){var e=Array.prototype.slice.call(arguments),t={context:r(e[0]||{}),arguments:e.slice(1)},n=this,i=n._definition;try{d(i,t)}catch(s){!s instanceof a&&t.context.fail(s)}return t.context},v.prototype=Object.create(s.prototype),t.defineInteractor=function(t){var r=new i,o=t;return n.isFunction(t)||(o=function(){m.call(this,t)}),o.call(r,r.run.bind(r),r.before.bind(r),r.after.bind(r),r.around.bind(r),r.rollback.bind(r)),new s(r.definition)},t.defineSimpleInteractor=function(n){return t.defineInteractor({run:n})},t.defineComposer=function(t){return new v(t)}}),define("services/pes.v2/interactors/store",["require","exports","module","lodash-compat","utils/common/interactor","ui/modalDialog/modalDialog","constants/common","services/serviceLocator"],function(e,t){var n=e("lodash-compat"),r=e("utils/common/interactor"),i=e("ui/modalDialog/modalDialog"),s=e("constants/common"),o=e("services/serviceLocator");t.setStoreTabProperties=r.defineSimpleInteractor(function(e){e.pickerState.storeEnabled||(e.pickerState.storeEnabled=!0,e.storeDialog=i,e.pickerState.purchasedTabs=[],e.pickerState.purchasedTabIds=[],i.build("pes-store",e,'<div id="pes-store" class="swx-hide"><swx-expressionstore-v2-browsepacks id="pes-store-comp" params="pickerState: pickerState, pickerVM: pickerVM, storeModalDialog: storeDialog"></swx-expressionstore-browsepacks></div>'))}),t.disposeStore=r.defineSimpleInteractor(function(){}),t.showStore=r.defineSimpleInteractor(function(e){e.showStore&&e.showStore()}),t.downloadPreviouslyPurchasedTabs=r.defineSimpleInteractor(function(e,t){var n=o.resolve(s.serviceLocator.PES_STORE_SERVICE),r=0,i,u;i=e.purchasedTabs=e.purchasedTabs||[],u=e.purchasedTabIds=e.purchasedTabIds||{},n.downloadPurchasedTabsFromEntitlement().then(function(n){n.forEach(function(s){s.pesConfig.then(function(o){i[s.id]=o.tabs[0],e._configuredItems=e._configuredItems.concat(o.items),r++,r===n.length&&typeof t=="function"&&t()}),u.push(s.id)})})}),t.putPurchasedTabs=r.defineSimpleInteractor(function(e){if(!e.purchasedTabs)return;var t=e.purchasedTabIds,r=e.purchasedTabs;t.forEach(function(t){n.remove(e.tabs,{id:t}),e.tabs.splice(4,0,r[t])})}),t.putNewPurchasedTab=r.defineSimpleInteractor(function(e,t,n){var r=e.purchasedTabIds,i=e.purchasedTabs;r.push(t),i[t]=n.tabs[0],e._configuredItems=e._configuredItems.concat(n.items),e.tabs.splice(4,0,i[t])})}),define("services/pes.v2/interactors/bing",["require","exports","module","lodash-compat","swx-i18n","utils/common/interactor","experience/settings","services/pes/constants"],function(e,t){var n=e("lodash-compat"),r=e("swx-i18n").localization,i=e("utils/common/interactor"),s=e("experience/settings"),o=e("services/pes/constants");t.computeAspectRatios=i.defineSimpleInteractor(function(e){var t=e.items||[];n.forEach(t,function(e){e.aspectRatio=e.width/e.height})}),t.computeGridLayoutSizes=i.defineInteractor(function(e){function t(e,t){var n=[],r,i;for(r=0;r<e;r+=1){var s=[];for(i=0;i<t;i+=1)s.push(0);n.push(s)}return n}function r(e,r){var i,s,o,u,a,f,l,c,h;a=e.length;if(r<=0)return[];if(r>a)return e.map(function(e){return[e]});l=t(a,r),f=t(a-1,r-1);for(s=0;s<a;s+=1)l[s][0]=e[s]+(s?l[s-1][0]:0);for(o=0;o<r;o+=1)l[0][o]=e[0];for(s=1;s<a;s+=1)for(o=1;o<r;o+=1){h=[];for(c=0;c<s;c+=1)h.push([n.max([l[c][o-1],l[s][0]-l[c][0]]),c]);u=n.min(h,function(e){return e[0]}),l[s][o]=u[0],f[s-1][o-1]=u[1]}a-=1,r-=2,i=[];while(r>=0)i=[function(){var t,n,i,o;o=[];for(s=t=n=f[a-1][r]+1,i=a+1;n<=i?t<i:t>i;s=n<=i?++t:--t)o.push(e[s]);return o}()].concat(i),a=f[a-1][r],r-=1;return[function(){var t,n,r;r=[];for(s=t=0,n=a+1;0<=n?t<n:t>n;s=0<=n?++t:--t)r.push(e[s]);return r}()].concat(i)}e(function(e,t,i,s,o){t=t||6,i=i||100,s=s||100,o=o||0;var u=e.items||[],a=s/t,f=u.reduce(function(e,t){return e+t.aspectRatio*a},0),l=Math.round(f/i)||1,c=u.map(function(e){return e.aspectRatio*100}),h=r(c,l),p=0;n.forEach(h,function(e){var t=[],r=i-o*e.length;n.forEach(e,function(){t.push(u[p]),p+=1});var s=t.reduce(function(e,t){return e+t.aspectRatio},0);n.forEach(t,function(e){e.scaledWidth=parseInt(r/s*e.aspectRatio),e.scaledHeight=parseInt(r/s)})})})}),t.collectItemsToPack=i.defineSimpleInteractor(function(e){var t=e.items||[],n={ariaLabel:r.fetch({key:e.packAriaLabelKey}),title:r.fetch({key:e.packTitleKey}),id:e.packID,isHidden:!1,items:[]};n.items=n.items.concat(t),e.pack=n}),t.assignImageItemProperties=i.defineSimpleInteractor(function(e){var t=e.items||[],r=e.sizingUnit||"em";n.forEach(t,function(e){e.thumbnail=e.thumbnail.replace("http:","https:"),e.staticThumbnail=e.thumbnail,e.type="image",e.thumbnailStyle="width: "+e.scaledWidth+r+"; height: "+e.scaledHeight+r+";",["aspectRatio","height","scaledHeight","scaledWidth","width"].forEach(function(t){e.hasOwnProperty(t)&&delete e[t]})})}),t.createBingPacks=i.defineSimpleInteractor(function(e){var r,s,u=i.defineComposer([t.computeAspectRatios,function(e){t.computeGridLayoutSizes.run(e,6,99,200)},t.assignImageItemProperties,t.collectItemsToPack]),a,f;e.packs=[],e.items=[],e.featureGifsFirst?(r=e.gifResults,s=e.memeResults):(r=e.memeResults,s=e.gifResults),e.featureCombine?(a=n.compact(n.flatten(n.flatten(n.zip(r,s)))),f=u.run(n.assign({items:a,packTitleKey:"expressionPicker_bingPack_title",packAriaLabelKey:"expressionPicker_bingPack_ariaLabel",packID:o.bingSearch.PACK_PREFIX+"items"},n.pick(e,["desiredRows","idealWidth","availableHeight","lossToPadding"]))),f.pack&&(e.packs.push(f.pack),e.items=e.items.concat(f.items))):(f=u.run(n.assign({items:r,packTitleKey:e.featureGifsFirst?"expressionPicker_bingGifsPack_title":"expressionPicker_bingMemePack_title",packAriaLabelKey:e.featureGifsFirst?"expressionPicker_bingGifsPack_ariaLabel":"expressionPicker_bingMemePack_ariaLabel",packID:o.bingSearch.PACK_PREFIX+(e.featureGifsFirst?"gifs":"memes")},n.pick(e,["desiredRows","idealWidth","availableHeight","lossToPadding"]))),f.pack&&(e.packs.push(f.pack),e.items=e.items.concat(f.items)),f=u.run(n.assign({items:s,packTitleKey:e.featureGifsFirst?"expressionPicker_bingMemePack_title":"expressionPicker_bingGifsPack_title",packAriaLabelKey:e.featureGifsFirst?"expressionPicker_bingMemePack_ariaLabel":"expressionPicker_bingGifsPack_ariaLabel",packID:o.bingSearch.PACK_PREFIX+(e.featureGifsFirst?"memes":"gifs")},n.pick(e,["desiredRows","idealWidth","availableHeight","lossToPadding"]))),f.pack&&(e.packs.push(f.pack),e.items=e.items.concat(f.items)))}),t.putBingTab=i.defineSimpleInteractor(function(e){var t={id:o.bingSearch.TAB_ID,type:o.itemTypes.tab.id,title:r.fetch({key:"expressionPicker_bingTab_title"}),ariaLabel:r.fetch({key:"expressionPicker_bingTab_ariaLabel"}),emptyTabMessageKey:"expressionPicker_bingTab_emptyText",thumbnailUrl:s.appBaseUrl+"/assets/images/components/chat/pes/tab_bing.png",styleOverride:"large-tab",packs:[]};n.remove(e.tabs,{id:o.bingSearch.TAB_ID}),e.tabs.push(t)}),t.setBingTabProperties=i.defineSimpleInteractor(function(e){e.selectedTab&&e.selectedTab.id===o.bingSearch.TAB_ID&&(e.pickerMaximized=!0,e.searchCapabilityEnabled=!0)})}),define("services/pes.v2/interactors/giphy",["require","exports","module","lodash-compat","swx-i18n","utils/common/interactor","services/pes.v2/interactors/bing","experience/settings","services/pes/constants"],function(e,t){var n=e("lodash-compat"),r=e("swx-i18n").localization,i=e("utils/common/interactor"),s=e("services/pes.v2/interactors/bing"),o=e("experience/settings"),u=e("services/pes/constants");t.putGiphyTab=i.defineSimpleInteractor(function(e){var t={id:u.giphyImageSearch.TAB_ID,type:u.itemTypes.tab.id,title:r.fetch({key:"expressionPicker_giphyImgTab_title"}),ariaLabel:r.fetch({key:"expressionPicker_giphyImgTab_ariaLabel"}),emptyTabMessageKey:"expressionPicker_giphyImgTab_emptyText",thumbnailUrl:o.appBaseUrl+"/assets/images/components/chat/pes/tab_giphy.png",styleOverride:"large-tab",packs:[]};n.remove(e.tabs,{id:u.giphyImageSearch.TAB_ID}),e.tabs.push(t)}),t.setGiphyTabProperties=i.defineSimpleInteractor(function(e){e.selectedTab&&e.selectedTab.id===u.giphyImageSearch.TAB_ID&&(e.pickerMaximized=!0,e.searchCapabilityEnabled=!0)}),t.mapGiphyAPIResults=i.defineSimpleInteractor(function(e){e.items=n.map(e.data,function(e){return{width:e.images.downsized.width,height:e.images.downsized.height,thumbnail:e.images.downsized.url,id:e.id,url:e.images.original.url}})}),t.createGiphyPacks=i.defineSimpleInteractor(function(e){var r=i.defineComposer([t.mapGiphyAPIResults,s.computeAspectRatios,function(e){s.computeGridLayoutSizes.run(e,6,99,200)},s.assignImageItemProperties,s.collectItemsToPack]);e.packs=[],e.items=[];var o=r.run(n.assign({data:e.data,packTitleKey:"expressionPicker_giphyImgPack_title",packAriaLabelKey:"expressionPicker_giphyImgPack_ariaLabel",packID:u.giphyImageSearch.PACK_PREFIX+"items"},n.pick(e,["desiredRows","idealWidth","availableHeight","lossToPadding"])));o.pack&&(e.packs.push(o.pack),e.items=e.items.concat(o.items))})}),define("services/pes.v2/interactors/cloud",["require","exports","module","lodash-compat","constants/common","utils/common/interactor","services/pes/constants","utils/chat/pesUtils","services/serviceLocator","experience/settings"],function(e,t){var n=e("lodash-compat"),r=e("constants/common"),i=e("utils/common/interactor"),s=e("services/pes/constants"),o=e("utils/chat/pesUtils"),u=e("services/serviceLocator"),a=e("experience/settings");t.pesGetConfig=i.defineSimpleInteractor(function(t){var i=u.resolve(r.serviceLocator.PES_2_CONFIG_SERVICE);n.assign(t,n.cloneDeep(i.getConfiguration()))}),t.pesDecorateTabs=i.defineSimpleInteractor(function(t){var r={emptyTabMessageKey:"expressionPicker_tab_emptyText"};t.tabs.forEach(function(e){n.defaults(e,r)})}),t.pesRemoveHiddenItems=i.defineSimpleInteractor(function(t){n(t.tabs).map("packs").flatten().forEach(function(e){e.items=n.reject(e.items,{visible:!1})}).value()}),t.pesDecorateEmoticons=i.defineSimpleInteractor(function(e){e.items.forEach(function(e){e.type===s.itemTypes.emoticon.id&&(e.staticHtmlClass=e.id,e.staticExtraLargeHtmlClass=e.staticHtmlClass+" extraLarge",e.animatedExtraLargeHtmlClass=e.staticExtraLargeHtmlClass+" animated",e.shortcut=n.first(e.shortcuts)||"",["etag","facebook","keywords","media","shortcuts","useInSms","visible"].forEach(function(t){e.hasOwnProperty(t)&&delete e[t]}))})}),t.pesDecorateMojis=i.defineSimpleInteractor(function(e){e.items.forEach(function(t){t.type===s.itemTypes.moji.id&&(t.thumbnailClass="id_"+t.id+" thumbnail",t.keyframeClass="id_"+t.id+" keyframe",t.contentUrl=e.itemsRoot+"/"+t.id+"/views/"+s.profiles.moji.content,e._requiresCDNUrlAuthentication&&(t.contentUrl+="?"+e._cdnToken),["etag","auxiliaryUrl","isSponsored","keywords"].forEach(function(e){t.hasOwnProperty(e)&&delete t[e]}))})}),t.pesRewriteMojiPaths=i.defineSimpleInteractor(function(e){var t=u.resolve(r.serviceLocator.FEATURE_FLAGS);t.isFeatureOn(r.featureFlags.PES_CDN_AUTH_ENABLED)&&e.items.forEach(function(e){e.type===s.itemTypes.moji.id&&(e.contentUrl=o.rewriteUrls(e.contentUrl,a.pesCDNAuthentication.rewriteRules))})}),t.pesConfigPipeline=i.defineComposer([t.pesGetConfig,t.pesRemoveHiddenItems,t.pesDecorateTabs,t.pesDecorateEmoticons,t.pesDecorateMojis,t.pesRewriteMojiPaths]),t.putPesTabs=i.defineSimpleInteractor(function(e){var n=t.pesConfigPipeline.run({});e.tabs=e.tabs.concat(n.tabs),e._configuredItems=e._configuredItems.concat(n.items)})}),define("services/pes.v2/interactors/mru",["require","exports","module","lodash-compat","constants/common","swx-i18n","utils/common/interactor","services/pes/constants","services/serviceLocator","experience/settings"],function(e,t){var n=e("lodash-compat"),r=e("constants/common"),i=e("swx-i18n").localization,s=e("utils/common/interactor"),o=e("services/pes/constants"),u=e("services/serviceLocator"),a=e("experience/settings");t.createMRUTab=s.defineInteractor(function(e){function t(){return{id:o.mru.TAB_ID,type:o.itemTypes.tab.id,title:i.fetch({key:o.itemTypes.tab.titleLocKey}),ariaLabel:i.fetch({key:o.itemTypes.tab.ariaLabelLocKey}),emptyTabMessageKey:"expressionPicker_mruTab_emptyText",thumbnailUrl:a.appBaseUrl+"/assets/images/components/chat/pes/tab_mru.png",packs:[]}}function s(e){return o.mru.PACK_PREFIX+e}function f(e){return{ariaLabel:i.fetch({key:o.itemTypes[e].ariaLabelLocKey}),title:i.fetch({key:o.itemTypes[e].titleLocKey}),id:s(e),isHidden:!1,items:[]}}function l(){return[f(o.itemTypes.emoticon.id),f(o.itemTypes.moji.id)]}e(function(e){var i=u.resolve(r.serviceLocator.PES_2_MRU_SERVICE),o=i.getMRUItems(),a=t(),f=l();n.forEach(o,function(t){var r=n.find(f,{id:s(t.type)}),i=n.find(e._configuredItems,{id:t.id});i&&r.items.push(i)}),a.packs=n.reject(f,function(e){return e.items.length===0}),e.mruTab=a})}),t.putMRUTab=s.defineSimpleInteractor(function(e){var r=t.createMRUTab.run(n.pick(e,"_configuredItems"));n.remove(e.tabs,{id:o.mru.TAB_ID}),e.tabs.unshift(r.mruTab)})}),define("services/pes.v2/interactors/localSearch",["require","exports","module","lodash-compat","swx-i18n","utils/common/interactor","experience/settings","services/pes/constants"],function(e,t){var n=e("lodash-compat"),r=e("swx-i18n").localization,i=e("utils/common/interactor"),s=e("experience/settings"),o=e("services/pes/constants");t.putLocalSearchTab=i.defineSimpleInteractor(function(e){var t={id:o.localSearch.TAB_ID,type:o.itemTypes.tab.id,title:r.fetch({key:"expressionPicker_localSearchTab_title"}),ariaLabel:r.fetch({key:"expressionPicker_localSearchTab_ariaLabel"}),emptyTabMessageKey:"expressionPicker_localSearchTab_emptyText",thumbnailUrl:s.appBaseUrl+"/assets/images/components/chat/pes/tab_search.png",styleOverride:"",packs:[]};e.tabs=e.tabs||[],n.remove(e.tabs,{id:o.localSearch.TAB_ID}),e.tabs.push(t)}),t.setLocalSearchTabProperties=i.defineSimpleInteractor(function(e){e.selectedTab&&e.selectedTab.id===o.localSearch.TAB_ID&&(e.searchCapabilityEnabled=!0)}),t.groupByType=i.defineSimpleInteractor(function(e){var t=n(["emoticon","flik"]).reduce(function(e,t){return e[t]={ariaLabel:r.fetch({key:o.itemTypes[t].ariaLabelLocKey}),title:r.fetch({key:o.itemTypes[t].titleLocKey}),id:o.localSearch.PACK_PREFIX+o.itemTypes[t].id,items:[]},e},{});n(e.packs).pluck("items").flatten().reduce(function(e,t){return t.type in e&&e[t.type].items.push(t),e},t),e.packs=n(t).map(function(e){return e}).value(),n.forEach(e.packs,function(e){e.items.length===0&&e.items.push({id:"",type:o.itemTypes.message.id,htmlClass:"",text:r.fetch({key:"message_text_emptySearchResults"})})})})}),define("services/pes.v2/interactors/picker",["require","exports","module","lodash-compat","services/pes.v2/interactors/bing","services/pes.v2/interactors/giphy","services/pes.v2/interactors/cloud","constants/common","experience/settings","utils/common/interactor","services/pes.v2/interactors/mru","services/pes.v2/interactors/localSearch","services/pes/constants","services/serviceLocator"],function(e,t){var n=e("lodash-compat"),r=e("services/pes.v2/interactors/bing"),i=e("services/pes.v2/interactors/giphy"),s=e("services/pes.v2/interactors/cloud"),o=e("constants/common"),u=e("experience/settings"),a=e("utils/common/interactor"),f=e("services/pes.v2/interactors/mru"),l=e("services/pes.v2/interactors/localSearch"),c=e("services/pes/constants"),h=e("services/serviceLocator");t.clearContext=a.defineSimpleInteractor(function(t){t.tabs=[],t.selectedTab=null,t.selectedItem=null,t.selectedTabId=null,t.selectedItemId=null,t._configuredItems=[]}),t.fillTabProperties=a.defineSimpleInteractor(function(e){n.forEach(e.tabs,function(e){n.defaults(e,{ariaLabel:e.title,htmlClass:"tab_id_"+e.id,styleOverride:"",emptyTabMessageKey:"expressionPicker_tab_emptyText"})})}),t.fillPackProperties=a.defineSimpleInteractor(function(e){n(e.tabs).pluck("packs").flatten().forEach(function(e){e.items["@Meta"]=n.assign(e.items["@Meta"]||{},{typeKey:c.itemTypes.typeKeyName})}).value()}),t.paginateTabs=a.defineInteractor(function(e){function t(){return{tabs:[]}}function r(e){if(e.length<7){var r=t(!0);return r.tabs=n.map(e,function(e){return n.pick(e,["id","title","ariaLabel","htmlClass","type"])}),[r]}var i=e.reduce(function(e,r,i){var s=e[e.length-1];return s.tabs.length>=4&&i!==4&&(s=t(),e.push(s)),s.tabs.push(n.pick(r,["id","title","ariaLabel","htmlClass","type"])),e},[t()]),s=i[i.length-1];return s.tabs.length===1&&(i[i.length-2].tabs.push(s.tabs[0]),i.pop()),i}e(function(e){e.pagedTabs=r(e.tabs)})}),t.setSelectedTab=a.defineSimpleInteractor(function(e){e.selectedTab=n.find(e.tabs,{id:e.currentTabId})||n.first(n.dropWhile(e.tabs,{id:c.mru.TAB_ID}))||n.first(e.tabs)}),t.scrollToSelectedTab=a.defineSimpleInteractor(function(e){e.selectedPageIndex=n.findIndex(e.pagedTabs,function(t){return n.any(t.tabs,{id:e.selectedTab.id})})}),t.setNormalTabProperties=a.defineSimpleInteractor(function(e){e.pickerMaximized=!1,e.searchCapabilityEnabled=!1}),t.selectItemAction=a.defineSimpleInteractor(function(e){e.selectedItem=n.find(e._configuredItems,{id:e.selectedItemId})||null}),t.setSelectionState=a.defineComposer([t.setSelectedTab,t.setNormalTabProperties,r.setBingTabProperties,i.setGiphyTabProperties,l.setLocalSearchTabProperties,t.fillPackProperties]),t.numberTabs=a.defineSimpleInteractor(function(t){n.forEach(t.tabs,function(e,t){e._index=t})}),t.placeTab=a.defineSimpleInteractor(function(t,r,i){var s=n.remove(t.tabs,{id:r});s.length&&(i===-1?t.tabs.push(s[0]):t.tabs.splice(i,0,s[0]))}),t.applyTabPlacementOverrides=a.defineSimpleInteractor(function(r){var i=r.pesTabPlacementOverrides||u.pesPicker.tabPlacementOverrides;n.forOwn(i,function(e,n){t.placeTab.run(r,n,e)})}),t.pickerStateConstructor=function(){var e=h.resolve(o.serviceLocator.FEATURE_FLAGS),n=[t.clearContext,s.putPesTabs];return e.isFeatureOn(o.featureFlags.PES_BING_IMAGE_SEARCH_ENABLED)&&n.push(r.putBingTab),e.isFeatureOn(o.featureFlags.PES_GIPHY_IMAGE_SEARCH_ENABLED)&&n.push(i.putGiphyTab),e.isFeatureOn(o.featureFlags.PES_LOCAL_SEARCH_ENABLED)&&n.push(l.putLocalSearchTab),n=n.concat([f.putMRUTab,t.fillTabProperties,t.fillPackProperties,t.applyTabPlacementOverrides,t.paginateTabs,t.numberTabs,t.setSelectionState]),a.defineComposer(n)},t.mruStateUpdater=a.defineComposer([f.putMRUTab,t.fillTabProperties,t.fillPackProperties,t.paginateTabs,t.numberTabs,t.setSelectionState])}),define("services/pes.v2/tabs/stylesFactory",[],function(){function e(){function t(e){var t="\n.swx .tab_id_"+e.id+"\n";return t+="{\n",t+=" -ms-high-contrast-adjust: none;\n",t+=" background-image: url('"+e.thumbnailUrl+"'); \n",t+="} \n",t}var e=this;e.create=function(e){return t(e)}}return new e}),define("services/pes.v2/tabs/fetcher",["require","services/pes.v2/tabs/stylesFactory","services/pes/constants"],function(e){function r(){var e=this;e.process=function(){return null},e.getResources=function(e){return e.type!==n.itemTypes.tab.id?null:{styleDef:t.create(e),prefetchUrls:[e.thumbnailUrl],encoderMaps:[]}}}var t=e("services/pes.v2/tabs/stylesFactory"),n=e("services/pes/constants");return new r}),define("services/pes.v2/emoticons/styleKeyFrameFactory",[],function(){function e(e,t,n,i,s){var o="@"+(i||"")+"keyframes "+e+" { ";return o+=r(t,n,i,s),o+="} \n",o}function t(e){return" top: "+e+"; "}function n(e){return" transform: translateY("+e+"); "}function r(e,n,r,i){i=i||t;var s="";return s+="from { ",s+=i(e),s+="} ",s+="to { ",s+=i(n),s+="} ",s}function i(t,n,r){var i="0",s=-n+"px";return e(t,i,s,"",r)+e(t,i,s,"-moz-",r)+e(t,i,s,"-webkit-",r)}function s(){}return s.prototype.create=function(e){var r=i(e.id,e.styleDef.smallHeight,n);return r+=i(e.id+"_large",e.styleDef.largeHeight,n),r+=i(e.id+"_extraLarge",e.styleDef.extraLargeHeight,t),r},new s}),define("services/pes.v2/emoticons/styleDefinitionFactory",["require","services/pes/constants"],function(e){function n(){function n(e){var n=e.largeUrl,r=t.frameHeights.emoticons.LARGE,i=e.styleDef.largeHeight,s=e.styleDef.largeOffset;return o(e,n,r,i,s,"large")}function r(e){return" top: "+e+";\n"+" -webkit-transform: initial;\n"+"transform: initial;\n"+" transform: translateZ(0);"}function i(e){return" -webkit-transform: translateY("+e+");\n"+" transform: translateY("+e+");"}function s(e){var n=e.extraLargeUrl,i=t.frameHeights.emoticons.EXTRA_LARGE,s=e.styleDef.extraLargeHeight,u=e.styleDef.extraLargeOffset;return o(e,n,i,s,u,"extraLarge",r)}function o(e,t,n,r,s,o,u){var a=e.id,f=e.id,l=e.styleDef.duration,c=e.styleDef.frameCount;u=u||i,o&&(f+="_"+o);var h="\n .swx .largeAllowed span.emoticon."+a+".animated";return o&&(h+="."+o),h+=" span.emoSprite \n",h+="{ \n",h+=" -ms-high-contrast-adjust: none;\n",h+=" background-image: url('"+t+"');\n",h+=" background-size: "+n+"px "+r+"px; \n",h+=" height: "+r+"px; \n",h+=u(s)+"\n",h+=" -moz-animation: "+f+" "+l+" steps("+c+") infinite; \n",h+=" -webkit-animation: "+f+" "+l+" steps("+c+") infinite; \n",h+=" animation: "+f+" "+l+" steps("+c+") infinite; \n",h+="} ",h}function u(e){var n=e.id,r=e.styleDef.duration,s=e.styleDef.frameCount,o=e.smallUrl,u=t.frameHeights.emoticons.SMALL,a=e.styleDef.smallOffset,f=e.styleDef.smallHeight,l="\n.swx span.emoticon."+e.id+".animated span.emoSprite, \n";return l+=".swx span.emoticon."+e.id+".large.animated span.emoSprite, \n",l+=".swx span.emoticon."+e.id+".extraLarge.animated span.emoSprite, \n",l+=".swx .largeAllowed span.emoticon."+e.id+".animated span.emoSprite",l+="{ \n",l+=" -ms-high-contrast-adjust: none;\n",l+=" background-image: url('"+o+"'); \n",l+=" background-size: "+u+"px "+f+"px; \n",l+=" height: "+f+"px; \n",l+=i(a),l+=" -webkit-animation: "+n+" "+r+" steps("+s+") infinite; \n",l+=" -moz-animation: "+n+" "+r+" steps("+s+") infinite; \n",l+=" animation: "+n+" "+r+" steps("+s+") infinite; \n",l+="} ",l}function a(e,t,n,r,s,o){var u="\n.swx span.emoticon."+e.id+t+" span.emoSprite \n";return u+="{\n",u+=" -ms-high-contrast-adjust: none;\n",u+=" background-image: url('"+n+"'); \n",u+=" background-size: "+r+"px "+s+"px; \n",u+=" height: "+s+"px; \n",u+=i(o),u+=" -moz-animation: none; \n",u+=" -webkit-animation: none; \n",u+=" animation: none \n",u+="}",u}function f(e){return a(e,"",e.smallStaticUrl,t.frameHeights.emoticons.SMALL,t.frameHeights.emoticons.SMALL,0)+a(e,".large",e.largeStaticUrl,t.frameHeights.emoticons.LARGE,t.frameHeights.emoticons.LARGE,0)+a(e,".extraLarge",e.extraLargeStaticUrl,t.frameHeights.emoticons.EXTRA_LARGE,t.frameHeights.emoticons.EXTRA_LARGE,0)}var e=this;e.create=function(e){var t=f(e);return t+=u(e),t+=n(e),t+=s(e),t}}var t=e("services/pes/constants");return new n}),define("services/pes.v2/emoticons/stylesFactory",["require","services/pes/constants","services/pes.v2/emoticons/styleKeyFrameFactory","services/pes.v2/emoticons/styleDefinitionFactory"],function(e){function s(){function s(e){var n=e.media.default,r=(n.firstFrame<n.framesCount?n.firstFrame:n.framesCount-1)||0;e.styleDef={frameCount:n.framesCount,firstFrame:r,duration:n.framesCount/i+"s",smallHeight:t.frameHeights.emoticons.SMALL*n.framesCount,smallOffset:-r*t.frameHeights.emoticons.SMALL,largeHeight:t.frameHeights.emoticons.LARGE*n.framesCount,largeOffset:-r*t.frameHeights.emoticons.LARGE,extraLargeHeight:t.frameHeights.emoticons.EXTRA_LARGE*n.framesCount,extraLargeOffset:-r*t.frameHeights.emoticons.EXTRA_LARGE},e.styleDef.smallOffset!==0&&(e.styleDef.smallOffset+="px"),e.styleDef.largeOffset!==0&&(e.styleDef.largeOffset+="px"),e.styleDef.extraLargeOffset!==0&&(e.styleDef.extraLargeOffset+="px")}var e=this;e.create=function(e){s(e);var t=n.create(e),i=r.create(e);return t+i}}var t=e("services/pes/constants"),n=e("services/pes.v2/emoticons/styleKeyFrameFactory"),r=e("services/pes.v2/emoticons/styleDefinitionFactory"),i=24;return new s}),define("services/pes.v2/emoticons/fetcher",["require","lodash-compat","services/pes.v2/emoticons/stylesFactory","services/pes/constants","utils/chat/pesUtils","services/serviceLocator","utils/common/url","constants/common","experience/settings"],function(e){function f(){function f(e,t){return o.buildUrl(e,{etag:t})}function l(e,t){var n=s.resolve(u.serviceLocator.FEATURE_FLAGS);return n.isFeatureOn(u.featureFlags.PES_CDN_AUTH_ENABLED)&&(e=i.rewriteUrls(e,a.pesCDNAuthentication.rewriteRules)),{smallStaticUrl:f(e+r.profiles.emoticons.getSmall(),t),largeStaticUrl:f(e+r.profiles.emoticons.getLarge(),t),extraLargeStaticUrl:f(e+r.profiles.emoticons.getExtraLarge(),t),smallUrl:f(e+r.profiles.emoticons.getSmallAnimated(),t),largeUrl:f(e+r.profiles.emoticons.getLargeAnimated(),t),extraLargeUrl:f(e+r.profiles.emoticons.getExtraLargeAnimated(),t)}}var e=this;e.process=function(){return null},e.getResources=function(e,i){var o,a,f=[],c=s.resolve(u.serviceLocator.FEATURE_FLAGS),h;return e.type!==r.itemTypes.emoticon.id?null:(a=[],h=i.emoticonsRoot+"/"+e.id+"/views/",e.shortcuts.forEach(function(t){a.push({shortcut:t,id:e.id,type:r.itemTypes.emoticon.id})}),o=l(h,e.etag),t.extend(e,o),c.isFeatureOn(u.featureFlags.PES_FETCH_SMALL_ASSETS_ON_DEMAND)||(f.push(e.smallUrl),f.push(e.smallStaticUrl)),c.isFeatureOn(u.featureFlags.PES_FETCH_MEDIUM_ASSETS_ON_DEMAND)||(f.push(e.largeUrl),f.push(e.largeStaticUrl)),c.isFeatureOn(u.featureFlags.PES_FETCH_LARGE_ASSETS_ON_DEMAND)||(f.push(e.extraLargeUrl),f.push(e.extraLargeStaticUrl)),{styleDef:n.create(e),prefetchUrls:f,encoderMaps:a})}}var t=e("lodash-compat"),n=e("services/pes.v2/emoticons/stylesFactory"),r=e("services/pes/constants"),i=e("utils/chat/pesUtils"),s=e("services/serviceLocator"),o=e("utils/common/url"),u=e("constants/common"),a=e("experience/settings");return new f}),define("services/pes.v2/mojis/stylesFactory",["require","services/pes/constants"],function(e){function n(){function n(e){var n=e.thumbnailUrl,r=t.frameHeights.moji.THUMBNAIL,i="\n.swx span.moji.id_"+e.id+" span.mojiThumbnail \n";return i+="{\n",i+=" -ms-high-contrast-adjust: none;\n",i+=" background-image: url('"+n+"'); \n",i+=" height: "+r+"px; \n",i+=" background-size: 100%; \n",i+="}",i}function r(e){var t=e.thumbnailUrl,n="\n.swx span.moji.id_"+e.id+" span.keyframe \n";return n+="{\n",n+=" -ms-high-contrast-adjust: none;\n",n+=" background-image: url('"+t+"'); \n",n+=" height: 100%; \n",n+=" background-size: 100%; \n",n+=" border-radius: 8px; \n",n+=" display: block; \n",n+="}",n}var e=this;e.create=function(e){var t=n(e);return t+=r(e),t}}var t=e("services/pes/constants");return new n}),define("services/pes.v2/mojis/fetcher",["require","services/pes/constants","services/pes.v2/mojis/stylesFactory","utils/chat/pesUtils","services/serviceLocator","constants/common","experience/settings"],function(e){function u(){var e=this;e.process=function(){return null},e.getResources=function(e,u){var a=[];if(e.type!==t.itemTypes.moji.id)return null;var f=u.itemsRoot+"/"+e.id+"/views/",l=i.resolve(s.serviceLocator.FEATURE_FLAGS);return l.isFeatureOn(s.featureFlags.PES_CDN_AUTH_ENABLED)&&(f=r.rewriteUrls(f,o.pesCDNAuthentication.rewriteRules)),e.thumbnailUrl=f+t.profiles.moji.thumbnail,u._requiresCDNUrlAuthentication&&(e.thumbnailUrl=e.thumbnailUrl+"?"+u._cdnToken),l.isFeatureOn(s.featureFlags.PES_FETCH_MOJI_ASSETS_ON_DEMAND)||a.push(e.thumbnailUrl),{styleDef:n.create(e),prefetchUrls:a,encoderMaps:[]}}}var t=e("services/pes/constants"),n=e("services/pes.v2/mojis/stylesFactory"),r=e("utils/chat/pesUtils"),i=e("services/serviceLocator"),s=e("constants/common"),o=e("experience/settings");return new u}),define("services/pes.v2/configProcessor",["require","services/pes/emoticons/encoder","lodash-compat","services/pes.v2/tabs/fetcher","services/pes.v2/emoticons/fetcher","services/pes.v2/mojis/fetcher","services/pes/constants","utils/common/prefetcher"],function(e){function a(){function a(e){var t,n,r;return r=document.getElementById("pesStyles"),r||(n=document.head,r=document.createElement("style"),r.id="pesStyles",r.type="text/css"),r.styleSheet?r.styleSheet.cssText=e:(t=document.createTextNode(e),r.firstChild&&r.removeChild(r.firstChild),r.appendChild(t)),n&&n.appendChild(r),e}var e=this;e.process=function(n){n.tabs.forEach(function(t,i){r.process(t,i),t.packs.forEach(function(t){t.items.forEach(function(t){e._processItem(t,n,"process")})})})},e._processItem=function(e,t,n){n=n||"process";if(!e)throw new Error("Ad hoc fetching is not implemented, yet!");switch(e.type){case o.itemTypes.emoticon.id:return i[n](e,t);case o.itemTypes.moji.id:return s[n](e,t);case o.itemTypes.sticker.id:throw new Error("Stickers are not implemented, yet!");default:throw new Error(e.type+" is not supported, yet!")}},e.prefetch=function(i){var s=[],o=[],u=[],a=n.cloneDeep(i,function(e){return e&&n.isFunction(e.then)?{}:undefined});return a.tabs.forEach(function(t){var n=r.getResources(t);s.push(n.styleDef),o.splice(0,0,n.prefetchUrls[0]),t.packs.forEach(function(t){t.items.forEach(function(t){var n=e._processItem(t,i,"getResources");s.push(n.styleDef),n.encoderMaps.forEach(function(e){u.push(e)}),n.prefetchUrls.forEach(function(e){o.push(e)})})})}),{pesStyles:s,prefetchUrls:o,encodingMaps:u}},e.register=function(n){var r="";t.map={},n.encodingMaps.forEach(function(e){switch(e.type){case o.itemTypes.emoticon.id:t.map[e.shortcut]=e.id;break;case o.itemTypes.tab.id:case o.itemTypes.moji.id:case o.itemTypes.sticker.id:throw new Error("mapping.type not implemented yet:"+e.type);default:throw new Error("mapping.type not supported yet:"+e.type)}}),n.pesStyles.forEach(function(e){r+=e}),a(r)},e.prefetchImages=function(t){u.prefetchImages(t.prefetchUrls||[])}}var t=e("services/pes/emoticons/encoder"),n=e("lodash-compat"),r=e("services/pes.v2/tabs/fetcher"),i=e("services/pes.v2/emoticons/fetcher"),s=e("services/pes.v2/mojis/fetcher"),o=e("services/pes/constants"),u=e("utils/common/prefetcher");return new a}),define("services/pes.v2/configSync",["require","lodash-compat","cafe/applicationInstance","services/ecs/configLoader","services/pes.v2/configProcessor","constants/common","services/i18n/cultureInfo","swx-enums","services/pes/constants","utils/chat/pesUtils","services/pubSub/pubSub","services/pes/configSync","reqwest","services/serviceLocator","experience/settings","browser/window"],function(e){function m(){function y(){function t(){return(new Promise(function(e){m=v.setTimeout(e,d.pesCDNAuthentication.cdnTokenTtlMs)})).then(function(){return Promise.resolve(n.get().signInManager._skypeToken())}).then(b).then(E).then(t)}g.isFeatureOn(s.featureFlags.PES_CDN_AUTH_ENABLED)&&d.pesCDNAuthentication.cdnTokenTtlMs>0&&(t().catch(function(e){}).then(t),n.get().signInManager.state.when(u.loginState.SignedOut,function(){e.dispose()}))}function b(t){var n="https://"+d.pesCDNAuthentication.skypeServiceHost+d.pesCDNAuthentication.tokenSourceEndpoint,r={headers:{Authorization:"skype_token "+t},url:n,dataType:"json",crossOrigin:!0};return Promise.resolve(h.compat(r)).catch(function(){return{token:"dummy_token"}}).then(function(t){var n=p.resolve(s.serviceLocator.PES_2_CONFIG_SERVICE);return e.latestToken=t.token,c.latestToken=t.token,n.cdnTokenUpdated(t.token),l.publish(s.events.personalExpression.CDN_TOKEN_UPDATED,t.token),t.token})}function w(e){var t;return t="https://"+d.pesCDNAuthentication.cdnServiceHost+d.pesCDNAuthentication.cookieSourceEndpoint+"?vdms_skype_token="+e,{url:t,dataType:"json",crossOrigin:!0,withCredentials:!0}}function E(e){var t=w(e);return Promise.resolve(h.compat(t)).catch(function(){}).then(function(){return!0})}var e=this,m=0,g;e.latestToken="",e.init=function(){function v(){var e,t;return d.pesConfigUrl?t=Promise.resolve({pes_config:d.pesConfigUrl}):(e=n.get().personsAndGroupsManager.mePerson,t=e.id.get().then(function(e){return r.loadConfig(u.ecsClientNames.Skype,d.ecsPesKey,e)})),t}function m(n){if(g.isFeatureOn(s.featureFlags.PES_CDN_AUTH_ENABLED)&&g.isFeatureOn(s.featureFlags.PES_CDN_AUTH_URL_FALLBACK_ENABLED)){var r,o,u=t.find(n.items,function(e){return e.type===a.itemTypes.moji.id});if(u)return o=n.itemsRoot+"/"+u.id+"/views/meta.default",r={dataType:"json",withCredentials:!0,url:f.rewriteUrls(o,d.pesCDNAuthentication.rewriteRules),crossOrigin:!0},Promise.resolve(h.compat(r)).then(function(){l.init(n);var e=i.prefetch(l.getConfiguration());i.register(e)}).catch(function(){e._requiresCDNUrlAuthentication=!0,n._requiresCDNUrlAuthentication=!0,n._cdnToken=e.latestToken,l.init(n);var t=i.prefetch(l.getConfiguration());i.register(t)})}else{l.init(n);var c=i.prefetch(l.getConfiguration());i.register(c)}}function b(e){throw new Error("Error while retrieving the pes configuration data")}function w(t){var r=(new Promise(function(t){n.get().signInManager.state.once(u.loginState.SignedIn,t)})).then(e.fetchConfiguration.bind(null,t.pes_config)).then(m).then(y).catch(b);return{configurationLoaded:r}}var l;return g=p.resolve(s.serviceLocator.FEATURE_FLAGS),g.isFeatureOn(s.featureFlags.PES_V2_ENABLED)?(d.locale=d.locale||{},d.initParams=d.initParams||{},d.locale.pes=o.getPesLocale(d.initParams.locale),l=p.resolve(s.serviceLocator.PES_2_CONFIG_SERVICE),v().then(w).catch(b)):c.init()},e.fetchConfiguration=function(r){function i(){var e,t=Promise.resolve();return g.isFeatureOn(s.featureFlags.PES_CDN_AUTH_ENABLED)&&(e=n.get().signInManager._skypeToken(),t=Promise.resolve(e).then(b).then(E)),t}function o(n,r){var i,o=t.extend(r||{},{dataType:"json",crossOrigin:!0});return g.isFeatureOn(s.featureFlags.PES_CDN_AUTH_ENABLED)&&(n=f.rewriteUrls(n,d.pesCDNAuthentication.rewriteRules),o.withCredentials=!0),o.url=n,i=Promise.resolve(h.compat(o)),g.isFeatureOn(s.featureFlags.PES_CDN_AUTH_ENABLED)&&(i=i.catch(function(){var i=t.extend(r||{},{dataType:"json",crossOrigin:!0});return i.url=n+"?"+e.latestToken,Promise.resolve(h.compat(i))})),i}function u(){throw new Error("no pes configuration service endpoint")}function a(){return r.replace("/default","/"+d.locale.pes)}return i().then(function(){return o(a())}).catch(function(){return o(r)}).catch(u)},e.dispose=function(){m&&v.clearTimeout(m)}}var t=e("lodash-compat"),n=e("cafe/applicationInstance"),r=e("services/ecs/configLoader"),i=e("services/pes.v2/configProcessor"),s=e("constants/common"),o=e("services/i18n/cultureInfo"),u=e("swx-enums"),a=e("services/pes/constants"),f=e("utils/chat/pesUtils"),l=e("services/pubSub/pubSub"),c=e("services/pes/configSync"),h=e("reqwest"),p=e("services/serviceLocator"),d=e("experience/settings"),v=e("browser/window");return new m}),define("services/store/pes/catalogItemProcessor",["require","exports","module","services/pes/constants","services/pes/tabs/stylesFactory","services/pes/mojis/stylesFactory","services/pes/emoticons/stylesFactory","utils/chat/pesUtils","services/pes/configProcessor","experience/settings"],function(e,t){function f(e,t){var n,r,i=t.packs;for(n=0;n<i.length;n++){r=i[n];if(r.id===e)return r.itemIds=r.items,r.isHidden=!1,r.items=[],l(r,t),r}}function l(e,t){var r,i,s=t.items;for(r=0;r<s.length;r++)i=s[r],e.itemIds.indexOf(i.id)>-1&&(i.thumbnail=i.type===n.itemTypes.moji.id?t.itemsRoot+"/"+i.id+"/views/thumbnail":t.emoticonsRoot+"/"+i.id+"/views/default_40",e.items.push(i))}function c(e,t,n){if(!e)return;var i,s,o=r.create(e.tabs[0]),u,a=e.tabs[0].packs,f;for(f=0;f<a.length;f++)u=a[f].items,o=h(o,u,t,n),i=document.createElement("style"),s=document.createTextNode(o),i.appendChild(s),document.head.appendChild(i)}function h(e,t,r,o){var u,a;for(u=0;u<t.length;u++)a=t[u],a.type===n.itemTypes.moji.id?(a.thumbnailUrl=o?a.thumbnail+"?"+r:a.thumbnail,e+=i.create(a)):e+=s.create(a);return e}var n=e("services/pes/constants"),r=e("services/pes/tabs/stylesFactory"),i=e("services/pes/mojis/stylesFactory"),s=e("services/pes/emoticons/stylesFactory"),o=e("utils/chat/pesUtils"),u=e("services/pes/configProcessor"),a=e("experience/settings");t.processTabConfig=function(e){var t=e.tabs,r,i,s,l;e.itemsRoot=o.rewriteUrls(e.itemsRoot,a.pesCDNAuthentication.rewriteRules);for(r=0;r<t.length;r++){s=t[r],s.packs=[],s.type||(s.type=n.itemTypes.tab.id),s.thumbnailUrl||(s.thumbnailUrl=e.tabsRoot+"/"+s.id+"/views/thumbnail");for(i=0;s.sections&&i<s.sections.length;i++)l=f(s.sections[i].pack,e),l.parentTab=s,s.packs.push(l)}u.process(e)},t.processSKUs=function(e){e.forEach(function(e){var t=e.attributes;t&&(e.bgColor="#"+t.glyphBgColor.substring(0,6),e.opacity=parseInt(t.glyphBgColor.substring(6,8),16)/255,e.items=t.items.__metadata.links.self,e.copyright=t.copyright,e.expiry=t.expiry)})},t.loadStyles=function(e,t,n){c(e,t,n)}}),define("ui/viewModels/chat/pes.v2/store/browseTabs",["require","lodash-compat","vendor/knockout","constants/keys","browser/dom","utils/common/scroll","services/serviceLocator","constants/common","utils/common/eventHelper","services/pes.v2/interactors/store","services/pes.v2/interactors/picker","services/pes.v2/configSync","services/store/pes/catalogItemProcessor"],function(e){function p(e,p){function E(){d.showSpinner(!1),d.showErrorText(!1),d.showTabList(!0),d.showTabDetails(!0)}function S(t){d.showSpinner(!1),d.showErrorText(!1),d.showTabDetails(!0),d.showTabList(!0),d.selectedTab(t),g.scrollToElement(i.getElement(".store-tab-item-details",e))}function x(){d.showSpinner(!0),d.showErrorText(!1),d.showTabDetails(!1),d.showTabList(!1)}function T(e){e.isDownloaded=n.observable(!1),e.showDownloadSpinner=n.observable(!1),e.thumbnailUrl=e.thumbnail,e.configData=n.observable(!1),e.showInList=n.observable(!0),e.cdnToken=n.observable(!1),e.isSelectedCSS=n.pureComputed(function(){return this.selectedTab().id===e.id?"selected":""},d),w.indexOf(e.id)!==-1&&e.isDownloaded(!0)}function N(){d.tabs().length||x(),w=d.pickerState&&d.pickerState.purchasedTabIds?d.pickerState.purchasedTabIds:[],y.loadCatalog().then(function(e){var t,n;E();for(t=0;e&&t<e.length;t++)n=e[t],v.indexOf(n.id)===-1&&(T(n),d.tabs.push(n),v.push(n.id));!d.selectedTab()&&d.tabs()[0]&&d.tabSelected(d.tabs()[0])},function(){d.showSpinner(!1),d.tabs().length||d.showErrorText(!0)})}function C(e){return Promise.resolve(y.getItems(e.items)).then(function(t){return e.configData(t),t}).catch(function(){return[]})}function k(e){var t=e.configData();h.loadStyles(t,c.latestToken,c._requiresCDNUrlAuthentication),f.putNewPurchasedTab.run(d.pickerState,e.id,t),l.mruStateUpdater.run(d.pickerState),d.pickerVM.applyState(d.pickerState),e.showDownloadSpinner(!1),e.isDownloaded(!0)}function L(e,t){var n=[e.name,e.description].concat(e.keywords),r;for(r=0;r<n.length;r++)if(n[r]&&n[r].toLowerCase().indexOf(t.toLowerCase())>-1)return!0;return!1}function A(e){t.remove(d.pickerState.tabs,{id:e.id}),l.mruStateUpdater.run(d.pickerState)}var d=this,v=[],m=s.build(i.getElement(".tabs-list",e)),g=s.build(i.getElement(".tabs-details-wrapper",e)),y=o.resolve(u.serviceLocator.PES_STORE_SERVICE),b=o.resolve(u.serviceLocator.FEATURE_FLAGS),w=[];m.init(),g.init(),d.showSpinner=n.observable(!1),d.showErrorText=n.observable(!1),d.showTabList=n.observable(!1),d.showTabDetails=n.observable(!1),d.tabs=n.observableArray(),d.selectedTab=n.observable(!1),d.searchQuery=n.observable(""),p&&(d.modalDialog=p.storeModalDialog||!1,d.pickerVM=p.pickerVM||!1,d.pickerState=p.pickerState||!1),d.showStore=function(){d.modalDialog&&(d.modalDialog.show("pes-store-comp"),m.adjustToRTLLayout(),g.adjustToRTLLayout(),N())},d.pickerState&&(d.pickerState.showStore=d.showStore),d.tabSelected=function(e){if(e.id===d.selectedTab().id)return;b.isFeatureOn(u.featureFlags.PES_CDN_AUTH_ENABLED)&&b.isFeatureOn(u.featureFlags.PES_CDN_AUTH_URL_FALLBACK_ENABLED)&&e.cdnToken(c.latestToken);if(e.itemsLoaded){S(e);return}C(e).then(function(){S(e),e.itemsLoaded=!0}).catch(function(){d.showErrorText(!0),d.showTabDetails(!1),d.selectedTab(e)})},d.goToTabList=function(){d.selectedTab(!1),E()},d.buyOrDownloadTab=function(e){if(e.isDownloaded())return e.isDownloaded(!1),A(e),!1;e.showDownloadSpinner(!0);if(w.indexOf(e.id)!==-1&&e.itemsLoaded)return e.isDownloaded(!0),k(e),!1;y.buyTab(e).then(function(){e.itemsLoaded?k(e):C(e).then(function(){k(e)})})},d.doLocalSearch=t.debounce(function(){d.tabs().length&&d.tabs().forEach(function(e){if(!d.searchQuery()){e.showInList(!0);return}e.showInList(L(e,d.searchQuery()))})},400),d.onSearchBoxKeyDown=function(e,t){var n=a.getKeyCode(t);if(n===r.ESCAPE){if(d.searchQuery()){t.stopPropagation();return}return}if(n===r.BACKSPACE&&!d.searchQuery()){a.swallow(t);return}return n===r.ENTER?!1:(d.doLocalSearch(),!0)},d.close=function(){d.modalDialog.hide("pes-store-comp")},d.dispose=function(){m.dispose(),g.dispose()}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("constants/keys"),i=e("browser/dom"),s=e("utils/common/scroll"),o=e("services/serviceLocator"),u=e("constants/common"),a=e("utils/common/eventHelper"),f=e("services/pes.v2/interactors/store"),l=e("services/pes.v2/interactors/picker"),c=e("services/pes.v2/configSync"),h=e("services/store/pes/catalogItemProcessor");return p.build=function(e,t){return new p(e,t)},p}),define("ui/components/chat/pes.v2/store/browseTabs",["require","text!views/chat/pes.v2/store/browseTabs.html","ui/viewModels/chat/pes.v2/store/browseTabs","constants/components"],function(e){function r(){function r(e,t){var r=t.element,i=n.build(r,e);return i}return{viewModel:{createViewModel:r},template:t,name:e("constants/components").chat.EXPRESSION_STORE_V2_BROWSE_PACKS}}var t=e("text!views/chat/pes.v2/store/browseTabs.html"),n=e("ui/viewModels/chat/pes.v2/store/browseTabs");return new r}),define("ui/components/chat/index",["require","ui/components/chat/chatLog","ui/components/chat/chatInput","ui/components/chat/conversation","ui/components/chat/groupSearch","ui/components/chat/messagesSearch","ui/components/chat/inviteLink","ui/components/chat/headerNewConversation","ui/components/chat/message","ui/components/chat/navigation","ui/components/chat/newConversation","ui/components/chat/contactPickerInput","ui/components/chat/spaceSettings","ui/components/chat/recents","ui/components/chat/textarea","ui/components/chat/sidebar","ui/components/chat/contactPill","ui/components/chat/contactCard","ui/components/chat/menuItem","ui/components/chat/header","ui/components/chat/headerSingleConversation","ui/components/chat/groupProfile","ui/components/chat/isTypingIndicator","ui/components/chat/currentCall","ui/components/chat/unreadMessageCounter","ui/components/chat/currentCallActions","ui/components/chat/recentItem","ui/components/chat/pes/expressionPicker","ui/components/chat/pes/itemsPicker","ui/components/chat/pes/itemRoster","ui/components/chat/conversationShareLink","ui/components/chat/selectedParticipantsConversation","ui/components/chat/conversationCard","ui/components/chat/filePicker","ui/components/chat/notificationsCenter","ui/components/chat/notificationsMenuItem","ui/components/chat/notificationsToggleButton","ui/components/chat/uploadManager","ui/components/chat/fileTransferActivityActions","ui/components/chat/chatInputActionPicker","ui/components/chat/chatInputSendContactCard","ui/components/chat/shareControl","ui/components/chat/chatInputPollButton","ui/components/chat/pollDesigner","ui/components/chat/stickyMessage","ui/components/chat/startConversationOverlay","ui/components/chat/suggestions/suggestionList","ui/components/chat/videoPlayer","ui/components/chat/userListPopup","ui/components/chat/translatorSettings","ui/components/chat/translatorLanguagePicker","ui/components/chat/moreActionsButton","ui/components/chat/heart","ui/components/chat/pes.v2/store/browseTabs"],function(e){return[e("ui/components/chat/chatLog"),e("ui/components/chat/chatInput"),e("ui/components/chat/conversation"),e("ui/components/chat/groupSearch"),e("ui/components/chat/messagesSearch"),e("ui/components/chat/inviteLink"),e("ui/components/chat/headerNewConversation"),e("ui/components/chat/message"),e("ui/components/chat/navigation"),e("ui/components/chat/newConversation"),e("ui/components/chat/contactPickerInput"),e("ui/components/chat/spaceSettings"),e("ui/components/chat/recents"),e("ui/components/chat/textarea"),e("ui/components/chat/sidebar"),e("ui/components/chat/contactPill"),e("ui/components/chat/contactCard"),e("ui/components/chat/menuItem"),e("ui/components/chat/header"),e("ui/components/chat/headerSingleConversation"),e("ui/components/chat/groupProfile"),e("ui/components/chat/isTypingIndicator"),e("ui/components/chat/currentCall"),e("ui/components/chat/unreadMessageCounter"),e("ui/components/chat/currentCallActions"),e("ui/components/chat/recentItem"),e("ui/components/chat/pes/expressionPicker"),e("ui/components/chat/pes/itemsPicker"),e("ui/components/chat/pes/itemRoster"),e("ui/components/chat/conversationShareLink"),e("ui/components/chat/selectedParticipantsConversation"),e("ui/components/chat/conversationCard"),e("ui/components/chat/filePicker"),e("ui/components/chat/notificationsCenter"),e("ui/components/chat/notificationsMenuItem"),e("ui/components/chat/notificationsToggleButton"),e("ui/components/chat/uploadManager"),e("ui/components/chat/fileTransferActivityActions"),e("ui/components/chat/chatInputActionPicker"),e("ui/components/chat/chatInputSendContactCard"),e("ui/components/chat/shareControl"),e("ui/components/chat/chatInputPollButton"),e("ui/components/chat/pollDesigner"),e("ui/components/chat/stickyMessage"),e("ui/components/chat/startConversationOverlay"),e("ui/components/chat/suggestions/suggestionList"),e("ui/components/chat/videoPlayer"),e("ui/components/chat/userListPopup"),e("ui/components/chat/translatorSettings"),e("ui/components/chat/translatorLanguagePicker"),e("ui/components/chat/moreActionsButton"),e("ui/components/chat/heart"),e("ui/components/chat/pes.v2/store/browseTabs")]}),define("utils/common/cancelation",["require","exports","module","lodash-compat"],function(e,t){function r(){}function i(){Error.call(this,"Operation canceled")}var n=e("lodash-compat");i.prototype=Error.prototype,r.prototype.getToken=function(){var t=this,n=function(){var n=new Promise(function(e,n){t.rejectTokenFn=n});return Object.defineProperty(n,"isCanceled",{get:function(){return t.isCanceled}}),n.throwIfCanceled=function(){if(t.isCanceled)throw new i},t.isCanceled=!1,n};return this.token=this.token||n(),this.token},r.prototype.cancel=function(t){t=t||new i,this.isCanceled=!0,this.rejectTokenFn(t)},t.makeCancelablePromise=function(t,n){return Promise.race([Promise.resolve(t),n])},t.makeCancelable=function(r,i){if(!i||!r||!n.isObject(r))return Promise.resolve(r);if(n.isFunction(r.makeCancelable))return r.makeCancelable(i);if(n.isFunction(r.then))return t.makeCancelablePromise(r,i)},t.adaptAbortable=function(t){return!t||!n.isObject(t)||!n.isFunction(t.abort)?t:(t.makeCancelable=function(e){var t=this,n;return e.catch(function(e){n=e,t.abort()}),Promise.resolve(this).catch(function(t){throw e.isCanceled?(n.innerException=t,n):t})},t)},t.cancelableOperation=function(){return new r},t.OperationCanceledError=i}),define("ui/components/chat/pes.v2/bingTab/bingSearchTab",["require","lodash-compat","cafe/applicationInstance","utils/common/cancelation","constants/common","services/pes/constants","services/serviceLocator","services/pes.v2/interactors/bing","services/pes.v2/interactors/picker","experience/settings"],function(e){function l(e,t){var n=o.resolve(i.serviceLocator.PES_BING_SEARCH_SERVICE);return Promise.all([n.search(e+" meme",{cancelationToken:t}),n.search(e+" gif",{cancelationToken:t})])}function c(e,r,s){return n.get().signInManager._skypeToken?n.get().signInManager._skypeToken().then(function(n){var u=o.resolve(i.serviceLocator.URL_PREVIEW_SERVICE),a=t.map(e,function(e){if(e.contentType==="image/animatedgif"){var t=u.getPreviewFor(e.url,{cancelationToken:r,skypeToken:n}),i=function(t){s&&s(e,t)};return t.then(i).catch(function(){})}return Promise.resolve()});return Promise.all(a)}):Promise.resolve([])}function h(e,n,r,i){function g(n,r){if(r.thumbnail&&r.content_type==="image/gif"){var i=t.find(e._configuredItems,{id:n.id});i&&(i.thumbnail=r.thumbnail,d())}}var o=n[0],a=n[1],l=f.pesSearchServices.bingPickFirst==="gif",h=!!f.pesSearchServices.bingMergeItems,p=u.createBingPacks.run({featureGifsFirst:l,featureCombine:h,gifResults:a,memeResults:o}),d=t.throttle(function(){i.isCanceled||r(e)},400),v;i.throwIfCanceled(),t.remove(e._configuredItems,function(e){return e.type===s.itemTypes.image.id&&t.find(p.items,{id:e.id})}),e._configuredItems=e._configuredItems.concat(p.items),v=t.find(e.tabs,{id:s.bingSearch.TAB_ID});var m=t.every(p.packs,function(e){return e.items.length===0});return m?v.emptyTabMessageKey="message_text_emptySearchResults":(v.packs=p.packs,v.emptyTabMessageKey="expressionPicker_bingTab_emptyText"),r(e),c(p.items,i,g)}function p(e,n,i){var o,u;u=t.find(n.tabs,{id:s.bingSearch.TAB_ID}),u&&(u.emptyTabMessageKey="expressionPicker_bingTab_loadingText"),v(n),o=r.cancelableOperation(),n._currentOperation=o,u._currentQuery=e,u.packs=[],i(n),l(e,o.getToken()).then(function(e){h(n,e,i,o.getToken())}).catch(function(e){if(e instanceof r.OperationCanceledError)return;var o=t.find(n.tabs,{id:s.bingSearch.TAB_ID});o.emptyTabMessageKey="expressionPicker_bingTab_errorText",i(n)})}function d(e,n,r){var i=t.map(f.pesSearchServices.bingTriggerWords,function(e){return e.toLowerCase()}),o=(e||"").toLowerCase().split(/\s/),u=t.remove(o,t.includes.bind(t,i)),l,c;t.any(u)&&(l=t.compact(o).join(" "),c=t.find(n.tabs,{id:s.bingSearch.TAB_ID}),c._currentQuery=l,n.currentTabId=s.bingSearch.TAB_ID,n=a.setSelectionState.run(n),r(n))}function v(e){var n;e._currentOperation&&(n=t.find(e.tabs,{id:s.bingSearch.TAB_ID}),n&&(n._currentQuery=""),e._currentOperation.cancel())}var t=e("lodash-compat"),n=e("cafe/applicationInstance"),r=e("utils/common/cancelation"),i=e("constants/common"),s=e("services/pes/constants"),o=e("services/serviceLocator"),u=e("services/pes.v2/interactors/bing"),a=e("services/pes.v2/interactors/picker"),f=e("experience/settings");return{highlightTabOnBingKeywords:d,doBingSearch:p,cancelBingSearch:v,getResultsFromBing:l,getImagesFromURLPService:c,processResultsFromBing:h}}),define("ui/components/chat/pes.v2/giphyTab/giphySearchTab",["require","lodash-compat","utils/common/cancelation","constants/common","services/pes/constants","services/serviceLocator","experience/settings","services/pes.v2/interactors/giphy"],function(e){function c(e){return t.isArray(e.data)?e:(e.data=[e.data],e)}function h(e){return t.isArray(e.data)?e:(e.data.images={downsized:{width:e.data.fixed_height_downsampled_width,height:e.data.fixed_height_downsampled_height,url:e.data.fixed_height_downsampled_url},original:{url:e.data.image_url}},e)}function p(e,t,n){var i=s.resolve(r.serviceLocator.PES_GIPHY_SEARCH_SERVICE);return Promise.all(t.map(function(t){var r=i[t];return r?(t in f?r=r.bind(i):r=r.bind(i,e),r({cancelationToken:n,limit:a}).then(l[t])):Promise.resolve([{data:[]}])}))}function d(e,n){var r=e?o.pesSearchServices.giphy.withQuerySources:o.pesSearchServices.giphy.withoutQuerySources,i=p(e,r,n);return i.then(function(e){var n=t(e).map(function(e){return e.data}).flatten().reduce(function(e,n){return t.find(e,{id:n.id})||e.push(n),e},[]);return{data:t.take(n,a)}})}function v(e,n,r,s){var o=u.createGiphyPacks.run(n),a;s.throwIfCanceled(),t.remove(e._configuredItems,function(e){return e.type===i.itemTypes.image.id&&t.find(o.items,{id:e.id})}),e._configuredItems=e._configuredItems.concat(o.items),a=t.find(e.tabs,{id:i.giphyImageSearch.TAB_ID});var f=t.every(o.packs,function(e){return e.items.length===0});f?a.emptyTabMessageKey="message_text_emptySearchResults":(a.packs=o.packs,a.emptyTabMessageKey="expressionPicker_giphyImgTab_emptyText"),r(e)}function m(e,r,s){var o,u;u=t.find(r.tabs,{id:i.giphyImageSearch.TAB_ID}),u&&(u.emptyTabMessageKey="expressionPicker_giphyImgTab_loadingText"),g(r),o=n.cancelableOperation(),r._currentOperation=o,u._currentQuery=e,u.packs=[],s(r),d(e,o.getToken()).then(function(e){v(r,e,s,o.getToken())}).catch(function(e){if(e instanceof n.OperationCanceledError)return;var o=t.find(r.tabs,{id:i.giphyImageSearch.TAB_ID});o.emptyTabMessageKey="expressionPicker_giphyImgTab_errorText",s(r)})}function g(e){var n;e._currentOperation&&(n=t.find(e.tabs,{id:i.giphyImageSearch.TAB_ID}),n&&(n._currentQuery=""),e._currentOperation.cancel())}var t=e("lodash-compat"),n=e("utils/common/cancelation"),r=e("constants/common"),i=e("services/pes/constants"),s=e("services/serviceLocator"),o=e("experience/settings"),u=e("services/pes.v2/interactors/giphy"),a=20,f={trending:!0},l={translate:c,random:h,search:t.identity,trending:t.identity};return{doGiphySearch:m,cancelGiphySearch:g,getResultsFromGiphy:d,processResultsFromGiphy:v}}),define("ui/components/chat/pes.v2/localSearchTab/localSearchTab",["require","lodash-compat","constants/common","swx-i18n","services/pes/constants","services/serviceLocator","experience/settings","services/pes.v2/interactors/picker","services/pes.v2/interactors/localSearch"],function(e){function f(e,n){var r=t([e.keywords||[],e.shortcut||[],e.description.split(/\s/),(e.copyright||"").split(/\s/),(e.pickerTitle||"").split(/\s/),(e.transcript||"").split(/\s/)]).flatten().compact().map(function(e){return e.toLowerCase()}).value(),i=t(n.split(/\s/)).compact().map(function(t){return t.toLowerCase()}).value();return t.any(i,function(e){return t.any(r,function(t){return t.search(e)===0})})}function l(e,n,r,i){i.packs=[];var s={};t.forEach(e.tabs,function(e){t.forEach(e.packs,function(e){var o=t.filter(e.items,t.bind(f,null,t,n)),u;o=t.filter(o,function(e){var t=e.id in s;return t||(s[e.id]=!0),!t}),o.length&&(u=t.cloneDeep(e),u.items=t.map(o,function(e){return t.find(r._configuredItems,{id:e.id})}),i.packs.push(u))})}),o.pesSearchServices.localSearchGroupByType&&a.groupByType.run(i)}function c(e,n){n.packs=[{ariaLabel:r.fetch({key:i.localSearch.ariaLabelLocKey}),title:r.fetch({key:i.localSearch.titleLocKey}),id:i.localSearch.PACK_PREFIX+"categories"}],n.packs[0].items=t(o.pesSearchServices.localSearchCategories).map(function(e){return{id:e,type:i.itemTypes.message.id,htmlClass:"clickable",text:e}}).value()}function h(e,r,o){var a=t.find(r.tabs,{id:i.localSearch.TAB_ID}),f=s.resolve(n.serviceLocator.PES_2_CONFIG_SERVICE),h=f.getConfiguration();e=(e||"").toLowerCase(),a._currentQuery=e,e?l(h,e,r,a):c(r,a),u.setSelectionState.run(r),o(r,["selectedTab","selectedItem"])}var t=e("lodash-compat"),n=e("constants/common"),r=e("swx-i18n").localization,i=e("services/pes/constants"),s=e("services/serviceLocator"),o=e("experience/settings"),u=e("services/pes.v2/interactors/picker"),a=e("services/pes.v2/interactors/localSearch");return{doLocalSearch:h}}),define("ui/components/chat/pes.v2/expressionPickerController",["require","lodash-compat","ui/components/chat/pes.v2/bingTab/bingSearchTab","ui/components/chat/pes.v2/giphyTab/giphySearchTab","ui/components/chat/pes.v2/localSearchTab/localSearchTab","utils/common/builderMixin","constants/common","utils/common/eventMixin","services/pes/constants","services/pes.v2/interactors/picker","services/pes.v2/interactors/store","services/pubSub/pubSub","experience/settings","services/serviceLocator","vendor/knockout"],function(e){function m(){this.model={itemStartPlayRequest:0,_currentOperation:null,_conversationModel:null,_startPlaybackAction:t.debounce(t.bind(this.startPlaybackAction,this),600)},this.subscriptions=[],this.viewModel=null}function g(e){var r=t.find(e.model.tabs,{id:f.bingSearch.TAB_ID});r._currentQuery||(r._currentQuery=p.pesSearchServices.bingDefaultSearchTerm||""),r._currentQuery&&e.model.query!==r._currentQuery&&(e.model.query=r._currentQuery,n.doBingSearch(r._currentQuery,e.model,e.viewModel.applyState.bind(e.viewModel))),e.model.hasFocus=!0,e.viewModel.applyState(e.model)}function y(e){var n=t.find(e.model.tabs,{id:f.giphyImageSearch.TAB_ID});e.model.query||(e.model.query=""),e.model.query!==n._currentQuery&&(e.model.query=n._currentQuery,r.doGiphySearch(n._currentQuery,e.model,e.viewModel.applyState.bind(e.viewModel))),e.model.hasFocus=!0,e.viewModel.applyState(e.model)}function b(e){var n=t.find(e.model.tabs,{id:f.localSearch.TAB_ID});e.model.query=n._currentQuery,i.doLocalSearch(e.model.query,e.model,e.viewModel.applyState.bind(e.viewModel)),e.model.hasFocus=!0,e.viewModel.applyState(e.model,["hasFocus","query"])}var t=e("lodash-compat"),n=e("ui/components/chat/pes.v2/bingTab/bingSearchTab"),r=e("ui/components/chat/pes.v2/giphyTab/giphySearchTab"),i=e("ui/components/chat/pes.v2/localSearchTab/localSearchTab"),s=e("utils/common/builderMixin"),o=e("constants/common"),u=o.events,a=e("utils/common/eventMixin"),f=e("services/pes/constants"),l=e("services/pes.v2/interactors/picker"),c=e("services/pes.v2/interactors/store"),h=e("services/pubSub/pubSub"),p=e("experience/settings"),d=e("services/serviceLocator"),v=e("vendor/knockout");return m.prototype.init=function(e,s){var a=d.resolve(o.serviceLocator.PES_2_CONFIG_SERVICE),f=d.resolve(o.serviceLocator.PES_2_MRU_SERVICE),l=d.resolve(o.serviceLocator.FEATURE_FLAGS),h;this.setContext(s),this.viewModel=e,this.model._conversationModel=s.conversationModel,this.subscriptions.push(a.on(u.personalExpression.CONFIG_INITIALIZED,this.emit.bind(this,"handlePesConfig"))),this.subscriptions.push(f.on(u.personalExpression.CONFIG_INITIALIZED,this.emit.bind(this,"handleMruConfig"))),l.isFeatureOn(o.featureFlags.PES_BING_IMAGE_SEARCH_ENABLED)&&(this.subscriptions.push(s.registerEvent(u.textarea.CHANGED,this.emit.bind(this,"handleChatInput"))),this.highlightTabOnBingKeywords=t.debounce(n.highlightTabOnBingKeywords,400),this.doBingSearch=t.debounce(n.doBingSearch,400)),l.isFeatureOn(o.featureFlags.PES_GIPHY_IMAGE_SEARCH_ENABLED)&&(this.doGiphySearch=t.debounce(r.doGiphySearch,400)),l.isFeatureOn(o.featureFlags.PES_LOCAL_SEARCH_ENABLED)&&(this.doLocalSearch=t.debounce(i.doLocalSearch,400)),this.handlePesConfigEvent(),l.isFeatureOn(o.featureFlags.PES_STORE_ENABLED)&&(h=c.setStoreTabProperties.run({pickerState:this.model,pickerVM:this.viewModel}),this.subscriptions.push({dispose:function(){c.disposeStore.run(h)}}),this.viewModel.applyState(this.model),c.downloadPreviouslyPurchasedTabs.run(this.model,this.emit.bind(this,"handleDownloadPurchasedTabs")))},m.prototype.dispose=function(){},m.prototype.done=function(){t.forEach(this.subscriptions,function(e){e.cancel?e.cancel():e.dispose&&e.dispose()}),this.dispose(),this.model=null,this.viewModel=null},m.prototype.handlePesConfigEvent=function(){var n=v.utils.unwrapObservable(this.viewModel.state.selectedTab)&&v.utils.unwrapObservable(this.viewModel.state.selectedTab).id,r=l.pickerStateConstructor(),i=r.run({currentTabId:n});t.assign(this.model,i),this.viewModel.applyState(this.model)},m.prototype.handleMruConfigEvent=function(){this.model=l.mruStateUpdater.run(this.model),this.viewModel.applyState(this.model)},m.prototype.handleChatInputEvent=function(t){this.model._chatInputText=t,t?this.highlightTabOnBingKeywords(t,this.model,this.viewModel.applyState.bind(this.viewModel)):(this.highlightTabOnBingKeywords.cancel(),n.cancelBingSearch(this.model))},m.prototype.handleQueryChangedEvent=function(t,n){this.model.query!==t&&(this.model.query=t,this.viewModel.applyState(this.model));switch(this.model.selectedTab.id){case f.bingSearch.TAB_ID:this.doBingSearch(t,this.model,this.viewModel.applyState.bind(this.viewModel));break;case f.giphyImageSearch.TAB_ID:this.doGiphySearch(t,this.model,this.viewModel.applyState.bind(this.viewModel));break;case f.localSearch.TAB_ID:n?i.doLocalSearch(t,this.model,this.viewModel.applyState.bind(this.viewModel)):this.doLocalSearch(t,this.model,this.viewModel.applyState.bind(this.viewModel))}},m.prototype.handleResetQueryEvent=function(){this.handleQueryChangedEvent("",!0)},m.prototype.startPlaybackAction=function(){this.model.isOpened&&(this.model.itemStartPlayRequest=this.model.itemStartPlayRequest>=0?this.model.itemStartPlayRequest+1:1,this.viewModel.applyState(this.model))},m.prototype.stopPlaybackAction=function(){this.model.itemStartPlayRequest=this.model.itemStartPlayRequest>0?0:this.model.itemStartPlayRequest-1,this.viewModel.applyState(this.model),this.model._startPlaybackAction.cancel()},m.prototype.handleMouseoverEvent=function(t,n){switch(t){case f.itemTypes.moji.id:case f.itemTypes.emoticon.id:case f.itemTypes.image.id:this.model.selectedItemId=n,this.model=l.selectItemAction.run(this.model),this.stopPlaybackAction(),this.model._startPlaybackAction(),this.viewModel.applyState(this.model);break;default:}},m.prototype.handleTouchendEvent=function(t,n,r){switch(t){case f.itemTypes.tab.id:break;case f.itemTypes.moji.id:case f.itemTypes.emoticon.id:case f.itemTypes.image.id:this.model.selectedItemId!==n&&(this.model.selectedItemId=n,this.model=l.selectItemAction.run(this.model),this.viewModel.applyState(this.model),this.startPlaybackAction(),r.preventDefault())}},m.prototype.handleHighlightEvent=function(t,n){switch(t){case f.itemTypes.moji.id:case f.itemTypes.emoticon.id:case f.itemTypes.image.id:this.model.selectedItemId=n,this.model=l.selectItemAction.run(this.model),this.stopPlaybackAction(),this.model._startPlaybackAction(),this.viewModel.applyState(this.model);break;default:}},m.prototype.handleMouseoutEvent=function(t){switch(t){case f.itemTypes.moji.id:case f.itemTypes.emoticon.id:this.stopPlaybackAction();break;default:}},m.prototype.activateTab=function(t){t!==this.model.selectedTab.id&&(this.model.currentTabId=t,l.setSelectionState.run(this.model),this.viewModel.applyState(this.model)),this.model.selectedTab.id===f.bingSearch.TAB_ID&&(n.highlightTabOnBingKeywords(this.model._chatInputText,this.model,this.viewModel.applyState.bind(this.viewModel)),g(this)),this.model.selectedTab.id===f.localSearch.TAB_ID&&b(this),this.model.selectedTab.id===f.giphyImageSearch.TAB_ID?(y(this),this.dispatchEvent(u.textarea.SET_ATTRIBUTION,"giphy")):this.dispatchEvent(u.textarea.SET_ATTRIBUTION,null)},m.prototype.handleClickEvent=function(t,n){switch(t){case f.itemTypes.tab.id:this.activateTab(n);break;case f.itemTypes.moji.id:case f.itemTypes.emoticon.id:case f.itemTypes.image.id:this.model.selectedItemId=n,this.model=l.selectItemAction.run(this.model),h.publish(o.events.expressionPicker.ITEM_SEND_REQUEST,{item:this.model.selectedItem,conversation:this.model._conversationModel,sourceTab:this.model.selectedTab}),this.handleCloseBubbleEvent();break;case f.itemTypes.message.id:this.model.selectedTab.id===f.localSearch.TAB_ID&&this.handleQueryChangedEvent(n,!0);break;default:}},m.prototype.handleKeydownEvent=function(t,n){this.handleMouseoverEvent(t,n),this.handleClickEvent(t,n)},m.prototype.handleActivationEvent=function(t,n){switch(t){case f.itemTypes.moji.id:case f.itemTypes.emoticon.id:case f.itemTypes.image.id:h.publish(o.events.expressionPicker.ITEM_SEND_REQUEST,{item:this.model.selectedItem,conversation:this.model._conversationModel,sourceTab:this.model.selectedTab}),this.handleCloseBubbleEvent();break;case f.itemTypes.message.id:this.model.selectedTab.id===f.localSearch.TAB_ID&&this.handleQueryChangedEvent(n,!0);break;default:}},m.prototype.handlePlaybackPausedEvent=function(){this.stopPlaybackAction()},m.prototype.handleResetQueryEvent=function(){this.model.query="",this.viewModel.applyState(this.model)},m.prototype.handleOpenBubbleEvent=function(){this.model.isOpened?(this.stopPlaybackAction(),this.model.isOpened=!1):(this.model.isOpened=!0,this.model.wasOpenedBefore=!0,this.activateTab(this.model.selectedTab.id)),this.viewModel.applyState(this.model)},m.prototype.handleCloseBubbleEvent=function(){this.stopPlaybackAction(),this.model.isOpened=!1;if(this.model.selectedTab.id===f.bingSearch.TAB_ID){var n=t.find(this.model.tabs,{id:f.bingSearch.TAB_ID});n._currentQuery=""}this.viewModel.applyState(this.model),this.dispatchEvent(u.textarea.SET_ATTRIBUTION,null)},m.prototype.handleShowStoreEvent=function(){c.showStore.run(this.model)},m.prototype.handleDownloadPurchasedTabsEvent=function(){c.putPurchasedTabs.run(this.model),this.model=l.mruStateUpdater.run(this.model),this.viewModel.applyState(this.model)},m.prototype.emit=function(){var t=Array.prototype.slice.call(arguments),n=this[t[0]+"Event"];n&&n.apply(this,t.slice(1))},t.assign(m,s),t.assign(m.prototype,a),m}),define("utils/common/stateMixin",["require","lodash-compat","vendor/knockout","browser/window"],function(e){function i(){}function s(){this.storage=[],this.lastFreeSlot=-1}function u(){}function a(){}function f(){}function p(e,t){return n.isObservable(e[t])?e[t].push?h:c:l}function v(e){if(typeof e=="string"||typeof e=="number")e=[e];this.key=e}function g(e){return typeof e in m||e===null||e instanceof Date||t.isElement(e)||Promise&&e instanceof Promise}function y(){}function b(){this.preserveReferences=!1}function E(e,n,r,i,s){var o=i.resolve(e),u=s.resolve(e),a,f=undefined,l;o!==d&&(l=t.findIndex(r,w.bind(null,i,o)),l!==-1&&l!==n&&(f=r[l],r[l]=undefined)),f||(f=r[n]);if(f&&u!==d){a=s.resolve(f);if(a===d||a!==u&&!t.isEqual(a,u))f=undefined}return f}function S(){this._scheduledTaskHandler&&(r.requestAnimationFrame?r.cancelAnimationFrame(this._scheduledTaskHandler):n.tasks.cancel(this._scheduledTaskHandler))}function x(){var e=this._taskQueue;return this._taskQueue=[],e}function T(e,n){var r=t.reduce(e,function(e,r){var i=r.newState;return t.isFunction(i)?i=i(this.state,this.props):r.limitKeys&&(i=t.pick(i,r.limitKeys)),r.callback&&n.push(r.callback),t.assign(e,i)},{},this);return r}function N(e){return this.beforeStateApplied&&(e=this.beforeStateApplied(e)||e),e}function C(e){var t=new b;(new y).execute(this.state,e,t)}function k(e){this.afterStateApplied&&this.afterStateApplied(),t.forEach(e,function(e){e&&t.isFunction(e)&&e.call(this)})}function L(e,r){return t.isFunction(r)?r:t.isArray(r)?n.observableArray(r):t.isPlainObject(r)||t.isBoolean(r)||t.isString(r)||t.isNumber(r)||t.isNull(r)||t.isUndefined(r)||t.isDate(r)||t.isElement(r)?n.observable(r):r}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("browser/window");s.prototype.get=function(e){var n=t.find(this.storage,{key:e});return n&&n.value},s.prototype.set=function(e,n){var r=this.lastFreeSlot;if(r===-1){r=t.findIndex(this.storage,null);if(r===-1){this.storage.push({key:e,value:n});return}}this.storage[r]={key:e,value:n},this.lastFreeSlot=-1},s.prototype.delete=function(e){var n=t.findIndex(this.storage,{key:e});if(n===-1)return;this.storage[n]=null,this.lastFreeSlot=n};var o=s;typeof WeakMap=="function"&&(o=WeakMap),u.prototype.EMPTY_VALUE=null,u.prototype.isBound=function(e,t){return t===null?!0:e&&e.hasOwnProperty(t)},u.prototype.resolve=function(e,t){return t===null?e:e&&e[t]},u.prototype.assign=function(e,t,n){if(t===null)throw new Error("References are immutable");e[t]=n},u.prototype.delete=function(e,t){if(t===null)throw new Error("References are immutable");e.hasOwnProperty(t)?delete e[t]:e[t]=undefined},a.prototype=Object.create(u.prototype),a.prototype.resolve=function(e,t){return t===null?e&&e():e&&e[t]&&e[t]()},a.prototype.assign=function(e,t,r){t!==null?e[t]?e[t](r):e[t]=n.observable(r):e(r)},a.prototype.delete=function(e){this.assign(e,undefined)},f.prototype=Object.create(a.prototype),f.prototype.assign=function(e,t,r){t!==null?e[t]?e[t](r):e[t]=n.observableArray(r):e(r)},f.prototype.EMPTY_VALUE=[];var l=new u,c=new a,h=new f,d=[NaN];v.prototype=Object.create(u.prototype),v.prototype.resolve=function(e){return this.key?typeof this.key=="function"?this.key(e)||d:this.key.map(function(t){return p(e,t).resolve(e,t)}):d};var m={"undefined":1,"boolean":1,number:1,string:1,"function":1};b.prototype.valueAssign=function(e,t,n){var r;typeof t!="string"&&typeof t!="number"||!!e.hasOwnProperty(t)?r=p(e,t):r=typeof n=="function"?l:c,r.assign(e,t,n)};var w=function(n,r,i){return t.isEqual(n.resolve(i),r)};return b.prototype.deepArrayAssign=function(e,r,i){var s,o,u;(typeof r=="string"||typeof r=="number")&&!e.hasOwnProperty(r)&&(e[r]=n.observableArray());var a=p(e,r),f=a.resolve(e,r)||[],l=[],c;o=new v(this.typeKeyFor(i)),s=new v(this.keyFor(i));for(c=0;c<i.length;++c){var h=p(i,c).resolve(i,c);g(h)?p(l,c).assign(l,c,h):t.isArray(h)?this.deepArrayAssign(l,c,h):(u=E(h,c,f,s,o)||{},p(l,c).assign(l,c,u),this.deepObjectAssign(l,c,h))}Array.prototype.splice.apply(f,[0,f.length].concat(l)),a.assign(e,r,f)},b.prototype.deepObjectAssign=function(e,n,r){var i,s,o=p(e,n),u=new v(this.typeKeyFor(r)),a,f,l=!1;if(!r){o.assign(e,n,i);return}i=this.getFromStack(r);if(i){this.breakCycles&&(i=null),o.assign(e,n,i);return}if(this.preserveReferences){i=this.getKnownObject(r);if(i){o.assign(e,n,i);return}}s=null,o.isBound(e,n)&&(s=o.resolve(e,n)),a=u.resolve(r);if(s&&a!==d){f=u.resolve(s),l=!0;if(f===d||f!==a&&!t.isEqual(f,a))l=!1}s===null&&(s={}),this.pushContextUpdate(r,s),y.prototype.execute(s,r,this),this.popContext(r),l||o.assign(e,n,s)},b.prototype.getFromStack=function(e){var t=this.contextStack&&this.contextStack.get(e);return t&&t.target},b.prototype.getKnownObject=function(e){return this.knownObjects&&this.knownObjects.get(e)},b.prototype.pushContextUpdate=function(e,t){var n=this.contextStack||new o,r;this.contextStack=n,this.preserveReferences&&(r=this.knownObjects||new o,this.knownObjects=r,r.set(e,t)),n.set(e,{target:t,breakCycles:this.breakCycles,removeExtra:this.removeExtra}),this.breakCycles=!0,this.removeExtra=!1},b.prototype.popContext=function(e){var t=this.contextStack&&this.contextStack.get(e);if(!t)return;this.breakCycles=t.breakCycles,this.removeExtra=t.removeExtra,this.contextStack.delete(e)},b.prototype.ignoreProperty=function(e){return e&&(e[0]==="_"||e[0]==="@")},b.prototype.keyFor=function(){return null},b.prototype.typeKeyFor=function(e){return e["@Meta"]&&e["@Meta"].typeKey},y.prototype.execute=function(e,n,r){var i,s,o=[],u,a,f,l;r.removeExtra&&t.forOwn(e,function(t,r){n.hasOwnProperty(r)||p(e,r).delete(e,r)});for(u in n)n.hasOwnProperty(u)&&!r.ignoreProperty(u)&&(s=p(n,u),i=s.resolve(n,u),l=g(i)?1:t.isArray(i)?2:3,o.push({name:u,value:i,semantics:l}));a=o.length;switch(a){case 4:f=o[3];switch(f.semantics){case 1:r.valueAssign(e,f.name,f.value);break;case 2:r.deepArrayAssign(e,f.name,f.value);break;case 3:r.deepObjectAssign(e,f.name,f.value)};case 3:f=o[2];switch(f.semantics){case 1:r.valueAssign(e,f.name,f.value);break;case 2:r.deepArrayAssign(e,f.name,f.value);break;case 3:r.deepObjectAssign(e,f.name,f.value)};case 2:f=o[1];switch(f.semantics){case 1:r.valueAssign(e,f.name,f.value);break;case 2:r.deepArrayAssign(e,f.name,f.value);break;case 3:r.deepObjectAssign(e,f.name,f.value)};case 1:f=o[0];switch(f.semantics){case 1:r.valueAssign(e,f.name,f.value);break;case 2:r.deepArrayAssign(e,f.name,f.value);break;case 3:r.deepObjectAssign(e,f.name,f.value)};case 0:break;default:t.forEach(o,function(t){switch(t.semantics){case 1:r.valueAssign(e,t.name,t.value);break;case 2:r.deepArrayAssign(e,t.name,t.value);break;case 3:r.deepObjectAssign(e,t.name,t.value)}})}},i.prototype.baseApplyState=function(e,n,r){var s=this.scheduleStateMerge||i.prototype.scheduleStateMerge;this.state=this.state||{};if(t.isString(n)||t.isArray(n))r=n,n=null;t.isString(r)&&(r=[r]),this._taskQueue=this._taskQueue||[],this._taskQueue.push({newState:e,callback:n,limitKeys:r}),s.call(this)},i.prototype.applyState=i.prototype.baseApplyState,i.prototype.scheduleStateMerge=function(){var e=this.processTaskQueue||i.prototype.processTaskQueue;if(this._scheduledTaskHandler)return;r.requestAnimationFrame?this._scheduledTaskHandler=r.requestAnimationFrame(e.bind(this)):this._scheduledTaskHandler=n.tasks.schedule(e.bind(this))},i.prototype.processTaskQueue=function(){var e,t=[],n,r=this.scheduleStateMerge||i.prototype.scheduleStateMerge;S.call(this);if(!this._taskQueue||this._taskQueue.length===0){this._scheduledTaskHandler=null;return}n=x.call(this),e=T.call(this,n,t),e=N.call(this,e),C.call(this,e),this._scheduledTaskHandler=null,this._taskQueue.length&&r.call(this),k.call(this,t)},i.overrideDefaults=function(){var e=Array.prototype.slice.call(arguments);return e.push(L),t.assign.apply(t,e),e[0]},t.assign(i,i.prototype),i}),define("ui/viewModels/chat/pes.v2/expressionPicker",["require","lodash-compat","constants/keys","utils/common/builderMixin","browser/document","browser/dom","utils/common/eventHelper","utils/common/interactor","vendor/knockout","experience/settings","utils/common/stateMixin","utils/common/outsideClickHandler"],function(e){function w(e,r){function g(e){var t=null;u.applyState({selectedPageIndex:e},t)}function y(){u.params.eventEmitter.emit("handleCloseBubble")}function w(){return s.getElement(v,r)}function E(){var e=w();e&&e.focus()}function S(){return s.getElement(h,s.getParentMatching(r,p))}function x(){var e=S();e&&e.focus()}function T(){c.remove(d)}var u=this,f,m;u.state=l.overrideDefaults({},u.getInitialState()),u.params=l.overrideDefaults({},u.getDefaultParams(),e),f=u.state.query.subscribe(function(e){u.params.eventEmitter.emit("handleQueryChanged",e)}),m=u.state.isOpened.subscribe(function(e){e?c.add(d,y):T()}),u.afterStateApplied=function(){b.run(this.state)},u.onSearchBoxKeyDown=function(e,t){var r=o.getKeyCode(t);if(r===n.ESCAPE){if(u.state.query()){u.resetQuery(),t.stopPropagation();return}return}if(r===n.BACKSPACE&&!u.state.query()){o.swallow(t);return}return r!==n.ENTER},u.resetQuery=function(){u.params.eventEmitter.emit("handleResetQuery")},u.nextPage=function(){var t=u.state.selectedPageIndex()+1;t<u.state.pagedTabs().length&&g(t)},u.prevPage=function(){var t=u.state.selectedPageIndex()-1;t>=0&&g(t)},u.init=function(){b.run(this.state)},u.openBubble=function(){u.params.eventEmitter.emit("handleOpenBubble")},u.handleEnter=function(e,t){function n(){return t.target.tagName!=="BUTTON"}n()&&t.target.tagName!=="INPUT"&&t.preventDefault(),u.handleMouseEvent(e,t)},u.handleMouseEvent=function(e,n){var r=a.dataFor(n.target);if(r&&r.type&&r.id){var i="handle"+t.capitalize(n.type);u.params.eventEmitter.emit(i,r.type(),r.id(),n)}return!0},u.handleKeyDown=function(e,t){var r=o.getKeyCode(t);if(r===n.ESCAPE&&u.state.isOpened()){t.stopPropagation(),y(),E();return}if(r===n.ESCAPE&&i.activeElement===w()){t.stopPropagation(),x();return}return!0},u.dispose=function(){T(),f.dispose(),m.dispose(),u.params.eventEmitter.done()},u.showStore=function(){u.params.eventEmitter.emit("handleShowStore")}}var t=e("lodash-compat"),n=e("constants/keys"),r=e("utils/common/builderMixin"),i=e("browser/document"),s=e("browser/dom"),o=e("utils/common/eventHelper"),u=e("utils/common/interactor"),a=e("vendor/knockout"),f=e("experience/settings"),l=e("utils/common/stateMixin"),c=e("utils/common/outsideClickHandler"),h=".swx .chat .inputField",p=".swx .chat",d="expressionPicker",v=".emoticon-picker-button",m=u.defineSimpleInteractor(function(t){t.pickerButtonClass("transparent circle emoticon-picker-button large"),t.pickerButtonIcon("emoticonStroke")}),g=u.defineInteractor(function(){this.onlyIf(function(){return f.pesPicker.useSelectedTabIconForPicker}),this.run(function(t){var n=t.selectedTab();n&&(t.pickerButtonClass("transparent tab-icon emoticon-picker-button large"),t.pickerButtonIcon("tab enabled "+n.htmlClass()))})}),y=u.defineSimpleInteractor(function(e){var t=e.pagedTabs().length,n=e.selectedPageIndex(),r="page"+n,i;t<=1?i="singlePage":i=n===t-1?r+" last":r,e.storeEnabled()&&(i="storeEnabled "+i),e.tabsCss(i)}),b=u.defineComposer([m,g,y]);return w.prototype.getInitialState=function(){return{isOpened:!1,wasOpenedBefore:!1,pickerButtonIcon:"",pickerButtonClass:"",pagedTabs:[],tabsCss:"",selectedPageIndex:0,selectedTab:null,selectedItem:null,itemStartPlayRequest:0,pickerMaximized:!1,searchCapabilityEnabled:!1,hasFocus:!1,query:"",storeEnabled:!1}},w.prototype.getDefaultParams=function(){return{isDisabled:!0,eventEmitter:o.emptyEmitter}},t.assign(w.prototype,l),t.assign(w,r),w}),define("text!views/chat/pes.v2/expressionPicker.html",[],function(){return'<div class="wrapper swx-expression-picker"\r\n     data-bind="event: {\r\n        keydown:        handleKeyDown,\r\n        mouseover:      handleMouseEvent,\r\n        mouseout:       handleMouseEvent,\r\n        touchend:       handleMouseEvent,\r\n        pointerover:    handleMouseEvent,\r\n        click:          handleMouseEvent\r\n        }, enterKey: handleEnter">\r\n    <swx-button params="cssClass: state.pickerButtonClass,\r\n                        icon: state.pickerButtonIcon,\r\n                        disabled: params.isDisabled, titleKey: \'button_title_emoticons\',\r\n                        textKey: \'button_text_emoticons\', action: openBubble,\r\n                        ariaLabelKey: \'emoticonPicker_heading_label\'"></swx-button>\r\n    <!-- ko if: state.wasOpenedBefore -->\r\n    <div class="bubble popup arrow down" data-bind="css: { active:state.isOpened }">\r\n\r\n        <!-- ko ifnot: state.pickerMaximized -->\r\n        <swx-expressionitem-roster params="item: state.selectedItem, itemStartPlayRequest: state.itemStartPlayRequest, eventEmitter: params.eventEmitter"></swx-expressionitem-roster>\r\n        <div class="infoLine"></div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: state.searchCapabilityEnabled -->\r\n        <div class="searchContainer">\r\n            <input type="text" data-bind="\r\n                hasFocus:       state.hasFocus,\r\n                textInput:      state.query,\r\n                event: {\r\n                    keydown:    onSearchBoxKeyDown\r\n                    },\r\n                l10n_attr: {\r\n                    \'placeholder\':  \'input_placeholder_searchPESItems\',\r\n                    \'aria-label\':   \'input_searchPESItems_ariaLabel\'\r\n                    }"\r\n                value="" name="query" class="inputField fontSize-h4"/>\r\n            <button tabindex="-1" data-bind="visible: state.query, event: { mousedown: resetQuery }, enterKey: resetQuery" type="button" class="btn primary circle small transparent searchReset">\r\n                <span class="iconfont cross"></span>\r\n            </button>\r\n            <div class="offScreen" role="status" aria-live="polite" data-bind="text: state.searchStatus"></div>\r\n        </div>\r\n        <div class="infoLine"></div>\r\n        <!-- /ko -->\r\n\r\n\r\n        <swx-expressionitems-picker params="tab: state.selectedTab, item: state.selectedItem, isVisible: state.isOpened, eventEmitter: params.eventEmitter"></swx-expressionitems-picker>\r\n\r\n        <div class="infoLine"></div>\r\n\r\n        <div class="navigationTabs">\r\n            <div class="tabs" data-bind="css: state.tabsCss, keyboardNavigation: { itemSelector: \'.tab-item\' }, enterKey: handleMouseEvent">\r\n                <span class="prev" data-bind="event: { click: prevPage },\r\n                                              l10n_attr: {\r\n                                                  \'title\': \'expressionPicker_prevPage\',\r\n                                                  \'aria-label\': \'expressionPicker_prevPage\'\r\n                                              }">\r\n                    <span class="tab"></span>\r\n                </span>\r\n                <span class="tabsWrapper">\r\n                    <span class="container" role="menu"\r\n                          data-bind="template: { name: \'tabs-page-template\', foreach: state.pagedTabs, as: \'page\'  }"></span>\r\n                </span>\r\n                <span class="next" data-bind="event: { click: nextPage },\r\n                                              l10n_attr: {\r\n                                                  \'title\': \'expressionPicker_nextPage\',\r\n                                                  \'aria-label\': \'expressionPicker_nextPage\'\r\n                                              }">\r\n                    <span class="tab"></span>\r\n                </span>\r\n            </div>\r\n\r\n            <!-- ko if: state.storeEnabled -->\r\n            <div class="store iconfont add" data-bind="event: {click: showStore}, enterKey: showStore,\r\n                                          l10n_attr: {\r\n                                              \'title\': \'expressionPicker_storeTab_title\',\r\n                                              \'aria-label\': \'expressionPicker_storeTab_title\'\r\n                                          }" tabindex="0"></div>\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n\r\n<script type="text/html" id="tabs-page-template">\r\n    <span class="tabPage"\r\n          data-bind="template: { name: \'tab-template\', foreach: page.tabs, as: \'tab\' }"></span>\r\n</script>\r\n\r\n<script type="text/html" id="tab-template">\r\n    <span data-bind="attr: {\r\n            \'data-name\': tab.id,\r\n            \'title\': tab.title,\r\n            \'aria-label\': tab.ariaLabel\r\n           }"\r\n          aria-live="polite" role="menuitem" class="tab-item">\r\n        <span data-bind="css: \'tab \'+tab.htmlClass() + ($parents[1].state.selectedTab().id() === tab.id() ? \' active\' : \'\')"></span>\r\n    </span>\r\n</script>\r\n'}),define("ui/components/chat/pes.v2/expressionPicker",["require","exports","module","ui/components/chat/pes.v2/expressionPickerController","ui/viewModels/chat/pes.v2/expressionPicker","vendor/knockout","constants/components","text!views/chat/pes.v2/expressionPicker.html"],function(e,t){function s(e,t){var s=t.element,o=i.dataFor(s),u=n.build(),a=r.build({isDisabled:e.isDisabled,eventEmitter:u},s);return a.init(),u.init(a,o),a}var n=e("ui/components/chat/pes.v2/expressionPickerController"),r=e("ui/viewModels/chat/pes.v2/expressionPicker"),i=e("vendor/knockout");t.name=e("constants/components").chat.EXPRESSION_PICKER,t.template=e("text!views/chat/pes.v2/expressionPicker.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/chat/pes.v2/itemsPicker",["require","lodash-compat","utils/common/async","utils/common/builderMixin","vendor/knockout","browser/document","utils/common/eventHelper","utils/common/stateMixin"],function(e){function a(e,t){function f(){n.execute(function(){t.adjustToRTLLayout()},null,!0)}var r=this,o,a;r.params=u.overrideDefaults({},r.getDefaultParams(),e),a=r.params.item.subscribe(function(t){var n;if(!t)return;n=s.activeElement,n&&n.focus()}),r.params.isVisible()?f():o=r.params.isVisible.subscribe(function(t){t&&(o.dispose(),f())}),r.showEmptyTabMessage=i.computed(function(){return r.params.tab().packs().length===0}),r.tabStyleOverride=i.computed(function(){return r.params.tab().styleOverride?r.params.tab().styleOverride():""}),r.emptyTabMessageKey=i.computed(function(){return i.utils.unwrapObservable(r.params.tab().emptyTabMessageKey)}),r.init=function(){t.init()},r.dispose=function(){o&&o.dispose(),a.dispose(),r.showEmptyTabMessage.dispose(),r.tabStyleOverride.dispose(),r.emptyTabMessageKey.dispose(),t.dispose()}}var t=e("lodash-compat"),n=e("utils/common/async"),r=e("utils/common/builderMixin"),i=e("vendor/knockout"),s=e("browser/document"),o=e("utils/common/eventHelper"),u=e("utils/common/stateMixin");return a.prototype.getDefaultParams=function(){return{tab:{packs:i.observableArray(),emptyTabMessageKey:"no_key"},item:null,isVisible:!0,eventEmitter:o.emptyEmitter}},t.assign(a.prototype,u),t.assign(a,r),a}),define("text!views/chat/pes.v2/itemsPicker.html",[],function(){return'<div class="picker"\r\n     data-bind="css: tabStyleOverride, keyboardNavigation: { itemSelector: \'li.picker-item\', persistSelection: false }">\r\n\r\n    <!-- ko if: showEmptyTabMessage -->\r\n    <span class="mrutext"\r\n          data-bind="l10n: {key: params.tab().emptyTabMessageKey() }"></span>\r\n    <!-- /ko -->\r\n\r\n    <ul class="picker-list scrollViewport scrollViewportV"\r\n        data-bind="template: {name: \'pack-template\', foreach: params.tab().packs, as: \'pack\'}" tabindex="-1">\r\n    </ul>\r\n</div>\r\n\r\n<script type="text/html" id="pack-template">\r\n    <!-- ko if: pack.title -->\r\n    <span class="tile">\r\n        <span class="tileName"><h4 data-bind="text:pack.title"></h4></span>\r\n    </span>\r\n    <!-- /ko -->\r\n\r\n    <li data-bind="attr: { \'data-name\': pack.id, \'aria-label\': pack.ariaLabel }"\r\n        role="listitem" class="picker-pack">\r\n        <ul class="picker-pack-items"\r\n            data-bind="template: { name: \'item-template\', foreach: pack.items, as: \'item\' }"></ul>\r\n    </li>\r\n</script>\r\n\r\n<script type="text/html" id="item-template">\r\n    <li data-bind="attr: { \'data-id\': item.id, \'aria-label\': item.description, style: item.thumbnailStyle}, css: item.type() + \' \' + (item.htmlClass && item.htmlClass() || \'\') "\r\n        role="listitem" class="picker-item">\r\n\r\n        <!-- ko if: item.type() === \'emoticon\' -->\r\n        <span\r\n            data-bind="css: item.staticHtmlClass"\r\n            class="emoticon">\r\n            <span class="emoSprite"></span>\r\n        </span>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: item.type() === \'flik\' -->\r\n        <span data-bind="css: item.thumbnailClass" class="moji">\r\n            <span class="mojimask small"></span><span class="mojiThumbnail"></span>\r\n            <a class="actionButtons iconfont send mojisend"\r\n               data-bind="\r\n                visible: $parents[1].params.item() && (item.id() === $parents[1].params.item().id() )"\r\n               tabindex="-1"></a>\r\n        </span>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: item.type() ===\'image\' -->\r\n        <div>\r\n            <img data-bind="attr: {src: item.thumbnail}"/>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: item.type() ===\'message\' -->\r\n        <span class="message" data-bind="text: item.text"></span>\r\n        <!-- /ko -->\r\n    </li>\r\n</script>\r\n\r\n'}),define("ui/components/chat/pes.v2/itemsPicker",["require","exports","module","ui/viewModels/chat/pes.v2/itemsPicker","utils/common/scroll","browser/dom","constants/components","text!views/chat/pes.v2/itemsPicker.html"],function(e,t){function s(e,t){var s=t.element,o=r.build(i.getElement(".picker",s)),u=new n(e,o,s);return u.init(),u}var n=e("ui/viewModels/chat/pes.v2/itemsPicker"),r=e("utils/common/scroll"),i=e("browser/dom");t.name=e("constants/components").chat.EXPRESSION_ITEMS_PICKER,t.template=e("text!views/chat/pes.v2/itemsPicker.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/chat/pes.v2/itemRoster",["require","lodash-compat","browser/dom","utils/common/async","utils/common/stateMixin","utils/common/eventHelper","services/pes/constants","vendor/knockout"],function(e){function a(e,t){function f(){var e=n.getElement("video.moji.preview",t);e&&e.pause&&e.pause()}function l(){function r(e){s.params.eventEmitter.emit(e)}function i(){e.removeEventListener("ended",i),e.removeEventListener("pause",u),r("handlePlaybackPaused")}function u(){e.removeEventListener("ended",i),e.removeEventListener("pause",u),r("handlePlaybackPaused")}var e=n.getElement("video.moji.preview",t);if(!e||s.params.item()&&s.params.item().type()!==o.itemTypes.moji.id)return;e.play(),e.addEventListener("ended",i,!1),e.addEventListener("pause",u,!1)}var s=this,a;s.params=i.overrideDefaults({},s.getDefaultParams(),e),s.playState=u.computed(function(){return s.params.itemStartPlayRequest()>0}),a=s.params.itemStartPlayRequest.subscribe(function(e){r.execute(function(){e>0?l():f()},null,!0)}),s.init=function(){},s.dispose=function(){a.dispose(),s.playState.dispose()}}var t=e("lodash-compat"),n=e("browser/dom"),r=e("utils/common/async"),i=e("utils/common/stateMixin"),s=e("utils/common/eventHelper"),o=e("services/pes/constants"),u=e("vendor/knockout");return a.prototype.getDefaultParams=function(){return{item:{},itemStartPlayRequest:0,eventEmitter:s.emptyEmitter}},t.assign(a.prototype,i),a}),define("text!views/chat/pes.v2/itemRoster.html",[],function(){return'<div class="wrapper roster">\r\n    <!-- ko if: params.item() && params.item().type() === \'emoticon\' -->\r\n    <div class="largeAllowed large wrapper">\r\n        <span data-bind="css: playState() ? params.item().animatedExtraLargeHtmlClass : params.item().staticExtraLargeHtmlClass" class="emoticon"><span\r\n            class="emoSprite"></span></span>\r\n    </div>\r\n    <div class="info">\r\n        <p data-bind="text: params.item().description" class="smaller name"></p>\r\n\r\n        <p data-bind="text: params.item().shortcut" class="smaller text"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: params.item() && params.item().type() === \'flik\' -->\r\n    <div class="large wrapper">\r\n        <span data-bind="css: params.item().keyframeClass" class="moji preview">\r\n            <span class="keyframe" data-bind="css: {hide: playState}"></span>\r\n            <video class="moji preview" data-bind="css: {hide: !playState()}, attr: { src: params.item().contentUrl }"\r\n                   tabindex="-1"></video>\r\n            <span class="mojimask preview"></span>\r\n        </span>\r\n    </div>\r\n    <div class="info">\r\n        <p data-bind="text: params.item().pickerTitle" class="smaller name"></p>\r\n\r\n        <p data-bind="text: params.item().copyright" class="smaller text"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: !(params.item() && params.item().type) || ([\'emoticon\', \'flik\'].indexOf(params.item().type()) === -1) -->\r\n    <div class="large wrapper">\r\n        <p data-bind="l10n: {\'key\': \'emoticonPicker_heading_label\'}" class="smaller name"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n\r\n</div>\r\n'}),define("ui/components/chat/pes.v2/itemRoster",["require","exports","module","ui/viewModels/chat/pes.v2/itemRoster","constants/components","text!views/chat/pes.v2/itemRoster.html"],function(e,t){function r(e,t){var r=t.element,i=new n(e,r);return i.init(),i}var n=e("ui/viewModels/chat/pes.v2/itemRoster");t.name=e("constants/components").chat.EXPRESSION_ITEM_ROSTER,t.template=e("text!views/chat/pes.v2/itemRoster.html"),t.viewModel={createViewModel:r}}),define("experience/components/chat",["require","exports","module","lodash-compat","experience/settings","constants/common","services/serviceLocator","swx-utils-common","utils/chat/urlParser","utils/chat/dateTime","ui/components/chat/index","ui/components/registrar","constants/components","ui/components/chat/pes.v2/expressionPicker","ui/components/chat/pes.v2/itemsPicker","ui/components/chat/pes.v2/itemRoster"],function(e,t){var n=e("lodash-compat"),r=e("experience/settings"),i=e("constants/common"),s=e("services/serviceLocator"),o=e("swx-utils-common").loader,u=e("utils/chat/urlParser"),a=e("utils/chat/dateTime"),f=e("ui/components/chat/index"),l=e("ui/components/registrar"),c=e("constants/components").chat,h=e("ui/components/chat/pes.v2/expressionPicker"),p=e("ui/components/chat/pes.v2/itemsPicker"),d=e("ui/components/chat/pes.v2/itemRoster");t.init=function(e){var t=s.resolve(i.serviceLocator.FEATURE_FLAGS);t.isFeatureOn(i.featureFlags.LOCATION_MESSAGE_SUPPORT)&&o.loadScript(r.mapsApiUrl+(u.isHttps(location.href)?"&s=1":"")),t.isFeatureOn(i.featureFlags.PES_V2_ENABLED)&&(f=n.map(f,function(e){switch(e.name){case c.EXPRESSION_PICKER:return h;case c.EXPRESSION_ITEMS_PICKER:return p;case c.EXPRESSION_ITEM_ROSTER:return d;default:return e}})),a.notifyOnDayChange(),l.register(f),e()}}),define("ui/viewModels/commerce/creditBalance",["require","exports","module","utils/common/cafeObservable","cafe/applicationInstance","experience/settings","telemetry/calling/pstn/pstn","constants/common"],function(e,t){function u(){var e=this,t=r.get().personsAndGroupsManager.mePerson.account;e.displayBalance=n.newObservableProperty(t.displayBalance,{keepAlive:!0}),e.purchaseCreditUrl=i.commerce.purchaseCreditUrl,e.addCreditTelemetry=function(){return s.addingCredit(o.entryPoint.SKYPE_OUT_PAGE),!0}}var n=e("utils/common/cafeObservable"),r=e("cafe/applicationInstance"),i=e("experience/settings"),s=e("telemetry/calling/pstn/pstn"),o=e("constants/common").telemetry.pstn;u.prototype.dispose=function(){this.displayBalance.dispose()},t.classFunction=u,t.build=function(){return new u}}),define("text!views/commerce/creditBalance.html",[],function(){return'<p class="SkypeOutOffer-title fontSize-h4" data-bind="l10n: { key: \'credit_balance_text\' }"></p>\r\n<div class="SkypeOutOffer-body" data-swx-testId="skypeOut-credit">\r\n    <span class="iconfont skypeCreditFill SkypeOutOffer-icon SkypeOutOffer-icon--skypeCreditFill"></span>\r\n    <div class="SkypeOutOffer-content">\r\n        <p class="SkypeOutOffer-message" data-bind="html: displayBalance"></p>\r\n        <p class="SkypeOutOffer-buyCredit">\r\n            <a data-bind="attr: {href: purchaseCreditUrl}, l10n: {key: \'credit_purchase_link_text\'}, click: addCreditTelemetry" target="_blank"></a>\r\n        </p>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/commerce/creditBalance",["require","exports","module","ui/viewModels/commerce/creditBalance","constants/components","text!views/commerce/creditBalance.html"],function(e,t){function r(){return n.build()}var n=e("ui/viewModels/commerce/creditBalance");t.name=e("constants/components").commerce.CREDIT_BALANCE,t.template=e("text!views/commerce/creditBalance.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/commerce/subscriptionEntitlement",["require","exports","module","lodash-compat","vendor/knockout","swx-i18n","swx-enums","experience/settings","cafe/applicationInstance","telemetry/calling/pstn/pstn","utils/common/cafeObservable","constants/common"],function(e,t){function c(){function h(){var e=n.filter(c(),p).length,t,r={count:e};switch(e){case 0:t="no_subscriptions_text";break;case 1:t="subscriptions_text_one";break;default:t="subscriptions_text_many"}return i.fetch({key:t,params:r})}function p(e){return e.active()&&(e.type()===s.subscriptionType.Package||e.type()===s.subscriptionType.Plan)}var e=this,t=u.get().personsAndGroupsManager.mePerson.account,c=f.newObservableCollection(t.entitlements);e.showSubscriptionsText=r.observable(!1),e.subscriptionsText=r.computed(h),e.purchaseSubscriptionUrl=o.commerce.purchaseSubscriptionUrl,t.entitlements.get().then(function(){e.showSubscriptionsText(!0)}),e.addSubscriptionTelemetry=function(){return a.addingSubscription(l.entryPoint.SKYPE_OUT_PAGE),!0}}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("swx-i18n").localization,s=e("swx-enums"),o=e("experience/settings"),u=e("cafe/applicationInstance"),a=e("telemetry/calling/pstn/pstn"),f=e("utils/common/cafeObservable"),l=e("constants/common").telemetry.pstn;c.prototype.dispose=function(){this.subscriptionsText.dispose()},t.classFunction=c,t.build=function(){return new c}}),define("text!views/commerce/subscriptionEntitlement.html",[],function(){return'<p class="SkypeOutOffer-title fontSize-h4" data-bind="l10n: { key: \'subscription_entitlement_text\' }"></p>\r\n<div class="SkypeOutOffer-body" data-swx-testId="skypeOutPage-subscrptions">\r\n    <span class="iconfont calendarDay SkypeOutOffer-icon SkypeOutOffer-icon--skypeSubscriptionFill"></span>\r\n    <div class="SkypeOutOffer-content">\r\n\r\n        <p class="SkypeOutOffer-message">\r\n            <!-- ko if: showSubscriptionsText -->\r\n            <span data-bind="text: subscriptionsText"></span>\r\n            <!-- /ko -->\r\n        </p>\r\n        <p class="SkypeOutOffer-buySubscription">\r\n            <a data-bind="attr: {href: purchaseSubscriptionUrl}, l10n: {key: \'subscription_purchase_link_text\'}, click: addSubscriptionTelemetry" target="_blank"></a>\r\n        </p>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/commerce/subscriptionEntitlement",["require","exports","module","ui/viewModels/commerce/subscriptionEntitlement","constants/components","text!views/commerce/subscriptionEntitlement.html"],function(e,t){function r(){return n.build()}var n=e("ui/viewModels/commerce/subscriptionEntitlement");t.name=e("constants/components").commerce.SUBSCRIPTION_ENTITLEMENT,t.template=e("text!views/commerce/subscriptionEntitlement.html"),t.viewModel={createViewModel:r}}),define("ui/components/commerce/index",["require","ui/components/commerce/creditBalance","ui/components/commerce/subscriptionEntitlement"],function(e){return[e("ui/components/commerce/creditBalance"),e("ui/components/commerce/subscriptionEntitlement")]}),define("experience/components/commerce",["require","exports","module","constants/common","services/serviceLocator","ui/components/commerce/index","ui/components/registrar"],function(e,t){function o(){var e=r.resolve(n.serviceLocator.FEATURE_FLAGS);e.isFeatureOn(n.featureFlags.PSTN_ENABLED)&&s.register(i)}var n=e("constants/common"),r=e("services/serviceLocator"),i=e("ui/components/commerce/index"),s=e("ui/components/registrar");t.init=function(e){o(),e()}}),define("ui/viewModels/userSettings/preferenceMapping",["require","exports","module","constants/common","browser/detect"],function(e,t){var n=e("constants/common").userSettings,r=e("browser/detect").BROWSERS;t.groups={CONTACTS:{id:n.categories.CONTACTS,titleI18NKey:"settings_contacts_category_title"},MESSAGING:{id:n.categories.MESSAGING,titleI18NKey:"settings_messaging_category_title"},PRIVACY:{id:n.categories.PRIVACY,titleI18NKey:"settings_privacy_category_title"},UNLISTED:{id:n.categories.UNLISTED,titleI18NKey:"settings_unlisted_category_title"}},t.templates={TOGGLE:"pref-template-boolean",SELECT:"pref-template-select",AUTO_BUDDY:"pref-template-autoBuddy",AUTO_BUDDY_DISCOVERY:"pref-template-autoBuddyDiscovery"},t.mapping={},t.mapping[n.preferences.DYNAMIC_DISCOVERY]={category:t.groups.CONTACTS.id},t.mapping[n.preferences.MENTIONS]={category:t.groups.MESSAGING.id,titleKey:"settings_mentionsEnabled_title",altTextKey:"settings_mentionsEnabled_alt_text"},t.mapping[n.preferences.FILE_PASTE]={category:t.groups.MESSAGING.id,titleKey:"settings_filePaste_title",altTextKey:"settings_filePaste_alt_text",supportedBrowsers:[r.CHROME,r.EDGE]},t.mapping[n.preferences.SKYPE_CALL_POLICY_SUPPORT]={category:t.groups.PRIVACY.id,titleKey:"settings_skypeCallPolicy_title",altTextKey:""},t.mapping[n.preferences.SKYPE_VIDEO_CALLING_POLICY_SUPPORT]={category:t.groups.PRIVACY.id,titleKey:"settings_skypeVideoPolicy_title",altTextKey:""},t.mapping[n.preferences.READ_RECEIPT]={category:t.groups.PRIVACY.id,titleKey:"settings_sendReadReceipts_title",altTextKey:"settings_sendReadReceipts_alt_text"},t.mapping[n.preferences.URL_PREVIEWS]={category:t.groups.MESSAGING.id,titleKey:"settings_urlPreview_title",altTextKey:"settings_urlPreview_alt_text"},t.mapping[n.preferences.YOUTUBE_PLAYER]={category:t.groups.MESSAGING.id,titleKey:"settings_youtube_player_title",altTextKey:"settings_youtube_player_alt_text"},t.mapping[n.preferences.AUTO_BUDDY]={category:t.groups.CONTACTS.id,titleKey:"settings_short_circuit_title",template:t.templates.AUTO_BUDDY},t.mapping[n.preferences.AUTO_BUDDY_DISCOVERY]={category:t.groups.CONTACTS.id,template:t.templates.AUTO_BUDDY_DISCOVERY}}),define("ui/viewModels/userSettings/utils",["require","exports","module","lodash-compat","swx-enums","constants/common","swx-i18n","browser/detect","ui/viewModels/userSettings/preferenceMapping"],function(e,t){var n=e("lodash-compat"),r=e("swx-enums"),i=e("constants/common"),s=e("swx-i18n").localization,o=e("browser/detect"),u=e("ui/viewModels/userSettings/preferenceMapping").templates,a=i.userSettings.preferences;t.getPrefCategory=function(e,t,r){var i=r;return e in t?(i=t[e].category,i):(n.keys(t).some(function(n){if(!!e.match(n))return i=t[n].category,!0}),i)},t.getPrefTemplate=function(e,t){var n=t[e.id];if(n&&n.template)return n.template;switch(e.type){case r.preferenceType.Boolean:return u.TOGGLE;case r.preferenceType.CallPolicy:case r.preferenceType.VideoPolicy:return u.SELECT;default:return null}},t.getPrefTitle=function(e,t){var n=t[e];return n&&n.titleKey?s.fetch({key:n.titleKey}):e.match(a.DYNAMIC_DISCOVERY)?e.replace(a.DYNAMIC_DISCOVERY+"-",""):s.fetch({key:"settings_unknownOption_title",params:{id:e}})},t.getPrefSecondaryText=function(e,t){var n=t[e];return n&&typeof n.altTextKey!="undefined"?n.altTextKey===""?null:s.fetch({key:n.altTextKey}):s.fetch({key:"settings_unknownOption_alt_text",params:{id:e}})},t.isPrefSupported=function(e,t){function r(){return!!t[e]}function i(){return t[e].hasOwnProperty("supportedBrowsers")}function s(){return n.indexOf(t[e].supportedBrowsers,o.getBrowserInfo().browserName)!==-1}return r()&&(!i()||s())},t.isUnlistedCategory=function(e,t,n,r){function i(){return n.indexOf(t)!==-1}function s(){return r.indexOf(e)!==-1}return i()||s()}}),define("telemetry/settings/settingsPageTelemetry",["require","lodash-compat","utils/common/builderMixin","constants/common","experience/settings","ui/telemetry/telemetryClient"],function(e){function o(){}function u(e){var t={};return t[r.telemetry.userSettings.property.ITEM_NAME]=(e?e:r.telemetry.userSettings.UNKNOWN).toString(),t[r.telemetry.userSettings.property.ITEM_VALUE]=r.telemetry.userSettings.UNKNOWN,t[r.telemetry.userSettings.property.OPERATION_OUTCOME]=r.telemetry.userSettings.outcomeNames.SUCCESS,t}var t=e("lodash-compat"),n=e("utils/common/builderMixin"),r=e("constants/common"),i=e("experience/settings"),s=e("ui/telemetry/telemetryClient");return o.prototype.sendShowPanelEvent=function(t){var n=u(t);s.get().sendEvent(i.telemetry.uiTenantToken,r.telemetry.userSettings.eventName.PANEL_SHOWN,n)},o.prototype.sendDismissPageEvent=function(t){var n=u("");n[r.telemetry.userSettings.property.OPERATION_DURATION]=isNaN(parseInt(t))?r.telemetry.userSettings.UNKNOWN:parseInt(t),s.get().sendEvent(i.telemetry.uiTenantToken,r.telemetry.userSettings.eventName.PAGE_DISMISSED,n)},t.assign(o,n),o}),define("ui/viewModels/userSettings/preferenceViewModel",["require","exports","module","lodash-compat","swx-enums","constants/common","swx-i18n","vendor/knockout","browser/dom","ui/viewModels/userSettings/utils","ui/shortCircuit/shortCircuit","services/serviceLocator","ui/telemetry/actions/actionNames","ui/viewModels/userSettings/preferenceMapping"],function(e,t){function p(e,t,h){function v(e){l.resolve(i.serviceLocator.ACTION_TELEMETRY).recordAction(e)}function m(t){t=t||n.noop,p.toggleValue=function(){e.value.set(!e.value()),t()},p.activate=function(){p.toggleValue()}}function g(){var t=".pref-select-element > select",n=["settings_privacy_opt_1_title","settings_privacy_opt_2_title","settings_privacy_opt_3_title"];p.uiValue=function(t){return t=o.unwrap(t),t>=0&&t<n.length?s.fetch({key:n[t]}):null},p.activate=function(e){var n=u.getElement(t,e.target);n&&n.focus()},p.optionChanged=function(n){e.value.set(n.value())},p.preventPropagation=function(e,t){return t.stopPropagation(),!0}}function y(t){return function(){var n=l.resolve(i.serviceLocator.ACTION_TELEMETRY);switch(t){case i.shortCircuit.scenarios.MANAGE_ADDRESSBOOKS:n.recordAction(c.shortCircuit.manageAddressBooks);break;case i.shortCircuit.scenarios.ADD_VERIFIED_PHONE:n.recordAction(c.shortCircuit.addNewNumber)}f.build().open(t).then(function(){e.value.get()})}}var p=this,d=e.description.type;p.id=e.description.id,p.uiState=r.preferenceValueState.Unknown,p.value=null,p.ariaId="userSettings-"+p.id,p.template=a.getPrefTemplate(e.description,t),p.title=a.getPrefTitle(p.id,t),p.secondaryText=a.getPrefSecondaryText(p.id,t);switch(d){case r.preferenceType.Boolean:m();break;case r.preferenceType.CallPolicy:p.uiOptions=[r.privacyPolicyValues.Anyone,r.privacyPolicyValues.ContactsOnly],g();break;case r.preferenceType.VideoPolicy:p.uiOptions=[r.privacyPolicyValues.Anyone,r.privacyPolicyValues.ContactsOnly,r.privacyPolicyValues.NoOne],g();break;case r.preferenceType.AutoBuddy:p.launchShortCircuit=y(i.shortCircuit.scenarios.MANAGE_ADDRESSBOOKS),m(v.bind(p,c.shortCircuit.toggleAutoBuddy));break;case r.preferenceType.AutoBuddyDiscovery:p.launchPNV=y(i.shortCircuit.scenarios.ADD_VERIFIED_PHONE);break;case r.preferenceType.AutoBuddyDiscoveryEmail:p.showToggle=!1,p.showRemoveLink=!1;break;case r.preferenceType.AutoBuddyDiscoveryPhone:p.showToggle=!0,p.showRemoveLink=!0,p.remove=function(){l.resolve(i.serviceLocator.ACTION_TELEMETRY).recordAction(c.shortCircuit.deleteNumber),e.value.set(null).then(function(){h.value.get()})},m(v.bind(p,c.shortCircuit.togglePhoneProof));break;default:}}var n=e("lodash-compat"),r=e("swx-enums"),i=e("constants/common"),s=e("swx-i18n").localization,o=e("vendor/knockout"),u=e("browser/dom"),a=e("ui/viewModels/userSettings/utils"),f=e("ui/shortCircuit/shortCircuit"),l=e("services/serviceLocator"),c=e("ui/telemetry/actions/actionNames"),h=e("ui/viewModels/userSettings/preferenceMapping").mapping;t.Preference=p,t.build=function(e,t){return new p(e,h,t)}}),define("ui/viewModels/userSettings/userSettingsPageViewModel",["require","lodash-compat","cafe/applicationInstance","utils/common/async","utils/common/builderMixin","constants/common","browser/dom","swx-utils-common","swx-enums","utils/common/eventHelper","utils/common/eventMixin","swx-i18n","vendor/knockout","utils/common/scroll","services/serviceLocator","utils/common/disposableMixin","utils/common/stateMixin","ui/viewModels/userSettings/utils","experience/settings","experience/settings","telemetry/settings/settingsPageTelemetry","ui/viewModels/userSettings/preferenceViewModel","ui/viewModels/userSettings/preferenceMapping","ui/viewModels/userSettings/preferenceMapping"],function(e){function N(e){var t={id:e.id,title:c.fetch({key:e.titleI18NKey}),"@Meta":{typeKey:"id"},preferenceItems:[]};return t.preferenceItems["@Meta"]={typeKey:"template"},t}function C(e){function r(e){return g.isPrefSupported(e.description.id,S)}var n=[N(x.CONTACTS),N(x.MESSAGING),N(x.PRIVACY),N(x.UNLISTED)];return t.filter(e,r).forEach(function(e){var r=e.description.id,i=g.getPrefCategory(r,S,x.UNLISTED.id),s=t.find(n,{id:i});g.isUnlistedCategory(r,i,y,b)&&(s=t.find(n,{id:x.UNLISTED.id})),s.preferenceItems.push(E.build(e))}),n}function k(e){var n=t(this.model.categories).pluck("preferenceItems").flatten().find({id:e});if(!n&&!!e.match(s.userSettings.preferences.DYNAMIC_DISCOVERY)){var r=t.find(this.model.categories,{id:"contacts"});n=t(t.map(r.preferenceItems,"value").filter(t.isArray)[0]).find({id:e})}return n}function L(e){return e.categories=t.reject(e.categories,function(e){return e.preferenceItems.length===0}),e}function A(e){return e.categories=t.reject(e.categories,function(e){return e.id===x.UNLISTED.id}),e}function O(e,n){var r,i=e.description.id,s=e.description.type,o=k.call(this,i);if(s===T.AutoBuddyDiscovery&&t.isArray(n)){r=t.map(n,function(t){return E.build(t,e)}),o.value=r,_.call(this,n),this.applyState(this.model);return}o.value=n,this.applyState(this.model)}function M(e,t){var n=k.call(this,e);n.uiState===a.preferenceValueState.Unknown&&(n.uiState=t);switch(t){case a.preferenceValueState.Saving:case a.preferenceValueState.Defined:n.uiState=t}this.applyState(this.model)}function _(e){t.forEach(e,function(e){this.registerDisposable(e.value.changed(O.bind(this,e))),this.registerDisposable(e.value.state.changed(M.bind(this,e.description.id))),e.value.get()},this)}function D(e){e.selectedCategory=t.head(e.categories)||{},F(e.selectedCategory.id)}function P(e,n){var r=e.selectedCategory.id;e.selectedCategory=t.find(e.categories,{id:n})||{},r!==e.selectedCategory.id&&F(e.selectedCategory.id)}function H(){if(this.fragmentVisibility){d.resolve(s.serviceLocator.PUBSUB).publish(s.events.navigation.NAVIGATE_TO_PREVIOUS_PAGE);return}this.fragmentVisibility=!0,this.pageOpenTimeMark=u.build()}function B(){this.fragmentVisibility=!1,j(this.pageOpenTimeMark),this.pageOpenTimeMark=null,this.pageOpenTimeMark=null}function j(e){w.build().sendDismissPageEvent(e&&e.durationInSeconds())}function F(e){w.build().sendShowPanelEvent(e)}function I(e){this.secondaryScroll&&this.unregisterDisposable(this.secondaryScroll),this.secondaryScroll=p.build(o.getElement(".UserSettingsPage-scroll-area",e)),this.registerDisposable(this.secondaryScroll),this.secondaryScroll.init()}function q(e,n){var i=d.resolve(s.serviceLocator.FEATURE_FLAGS),o,u=this;this.pageOpenTimeMark=null,this.state=m.overrideDefaults({},this.getInitialState()),this.params=m.overrideDefaults({},this.getDefaultParams(),e),this.secondaryScroll=null,this.isAboutPageEnabled=i.isFeatureOn(s.featureFlags.ABOUT_PAGE_ENABLED),this.isAboutPageVisible=h.observable(!1),this.registerDisposable(this.state.selectedCategory.subscribe(function(){r.execute(function(){I.call(this,n.element)},u,!0)})),this.model={categories:C(this.params.preferences())},L(this.model),i.isFeatureOn(s.featureFlags.SHOW_UNLISTED_SETTINGS)||A(this.model),D(this.model),o=t(this.model.categories).map(function(e){return e.preferenceItems}).flatten().map(function(e){return e.id}).sort().value(),_.call(this,t.filter(this.params.preferences(),function(e){return t.indexOf(o,e.description.id)>=0})),this.applyState(this.model),H.call(this),this.setContext(h.dataFor(n.element)),this.registerEvent(s.events.navigation.FRAGMENT_SHOW,H,l.DIRECTION.ANY,this),this.registerEvent(s.events.navigation.FRAGMENT_HIDE,B,l.DIRECTION.ANY,this),d.resolve(s.serviceLocator.PUBSUB).publish(s.events.navigation.FRAGMENT_REMOVE_ALL_HIDDEN)}var t=e("lodash-compat"),n=e("cafe/applicationInstance"),r=e("utils/common/async"),i=e("utils/common/builderMixin"),s=e("constants/common"),o=e("browser/dom"),u=e("swx-utils-common").stopwatch,a=e("swx-enums"),f=e("utils/common/eventHelper"),l=e("utils/common/eventMixin"),c=e("swx-i18n").localization,h=e("vendor/knockout"),p=e("utils/common/scroll"),d=e("services/serviceLocator"),v=e("utils/common/disposableMixin"),m=e("utils/common/stateMixin"),g=e("ui/viewModels/userSettings/utils"),y=e("experience/settings").userSettings.hiddenCategories,b=e("experience/settings").userSettings.hiddenPreferences,w=e("telemetry/settings/settingsPageTelemetry"),E=e("ui/viewModels/userSettings/preferenceViewModel"),S=e("ui/viewModels/userSettings/preferenceMapping").mapping,x=e("ui/viewModels/userSettings/preferenceMapping").groups,T=a.preferenceType;return q.prototype.switchCategory=function(t,n){var r=h.dataFor(n.target);r&&r.id?(P(this.model,r.id()),this.isAboutPageVisible(!1),this.applyState(this.model)):(this.isAboutPageVisible(!0),this.state.selectedCategory().id("about"))},q.prototype.getInitialState=function(){return{categories:[],selectedCategory:null}},q.prototype.getDefaultParams=function(){function t(){return e.preferences&&e.preferences()}var e=n.get().personsAndGroupsManager.mePerson;return{preferences:t()||[],eventEmitter:f.emptyEmitter}},t.assign(q.prototype,v),t.assign(q.prototype,m),t.assign(q.prototype,l),t.assign(q,i),q}),define("text!views/userSettings/userSettingsPage.html",[],function(){return'<section class="UserSettingsPage themeWhite" role="region">\r\n    <div class="UserSettingsPage-master">\r\n        <h1 class="UserSettingsPage-heading" data-bind="l10n: { key: \'settings_page_text_header\' }"></h1>\r\n        <ul class="UserSettingsPage-list"\r\n            data-bind="click: switchCategory, keyboardNavigation: { itemSelector: \'.UserSettingsPage-category\' }">\r\n            <!-- ko foreach: { data: state.categories, as: \'category\' } -->\r\n            <li>\r\n                <a href="#" role="listitem" class="UserSettingsPage-category"\r\n                   data-bind="css: { active: $parent.state.selectedCategory() && $parent.state.selectedCategory().id() === category.id() }">\r\n                    <h2 class="UserSettingsPage-label" data-bind="css: category.id, text: category.title"></h2>\r\n                </a>\r\n            </li>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: isAboutPageEnabled -->\r\n            <li>\r\n                <a href="#" role="listitem" class="UserSettingsPage-category" data-bind="css: {active: isAboutPageVisible}">\r\n                    <h2 class="UserSettingsPage-label about" data-bind="l10n: { key: \'settings_about_category_title\' }"></h2>\r\n                </a>\r\n            </li>\r\n            <!-- /ko -->\r\n        </ul>\r\n    </div>\r\n\r\n    <div class="UserSettingsPage-detail UserSettingsPage-detail--white">\r\n        <!-- ko if: !isAboutPageVisible() -->\r\n            <!-- ko with: state.selectedCategory -->\r\n            <h1 class="UserSettingsPage-heading" data-bind="text: title"></h1>\r\n            <div class="UserSettingsPage-scroll-area">\r\n                <div class="scrollViewport scrollViewportV" tabindex="-1">\r\n                    <ul class="UserSettingsPage-list" data-bind="foreach: { data: preferenceItems, as: \'param\' }">\r\n                        <li class="UserSettingsPage-option"\r\n                            data-bind="css: param.template, template: { name: param.template, data: param, as: param }">\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: isAboutPageVisible() -->\r\n        <swx-about></swx-about>\r\n        <!-- /ko -->\r\n    </div>\r\n</section>\r\n\r\n<script type="text/html" id="pref-template-boolean">\r\n    <div data-bind="css: { \'pref-toggle--saving\': param.uiState() === \'Saving\'}">\r\n        <!-- ko if: param.uiState() !== \'Unknown\' -->\r\n        <swx-toggle-button class="pref-toggle-btn"\r\n                           params="checked: param.value, click: param.toggleValue, ariaLabel: title, labelledById: param.ariaId"></swx-toggle-button>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: param.uiState() === \'Unknown\' -->\r\n        <swx-loading-animation class="spinner small blue"></swx-loading-animation>\r\n        <!-- /ko -->\r\n    </div>\r\n    <div class="pref-toggle-col">\r\n        <h2 class="pref-toggle-heading UserSettingsPage-featureLabel" data-bind="html: param.title, attr: {id: param.ariaId}"></h2>\r\n        <p class="pref-toggle-sec-text UserSettingsPage-secondaryText" data-bind="html: param.secondaryText"></p>\r\n    </div>\r\n</script>\r\n\r\n\r\n<script type="text/html" id="pref-template-select">\r\n    <h2 class="pref-toggle-heading UserSettingsPage-featureLabel" data-bind="html: param.title"></h2>\r\n    <div>\r\n        <!-- ko if: param.uiState() !== \'Unknown\' -->\r\n        <div class=\'pref-select-element\'>\r\n            <select data-bind=" options: param.uiOptions,\r\n                            optionsText: param.uiValue,\r\n                            value: param.value,\r\n                            event: {\r\n                                mousedown: param.preventPropagation,\r\n                                keydown: param.preventPropagation,\r\n                                change: param.optionChanged } "></select>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: param.uiState() === \'Unknown\' -->\r\n        <swx-loading-animation class="spinner small blue"></swx-loading-animation>\r\n        <!-- /ko -->\r\n    </div>\r\n    <p class="pref-toggle-sec-text UserSettingsPage-secondaryText" data-bind="html: param.secondaryText"></p>\r\n</script>\r\n\r\n<script type="text/html" id="pref-template-autoBuddy">\r\n    <div data-bind="css: { \'pref-toggle--saving\': param.uiState() === \'Saving\'}">\r\n        <!-- ko if: param.uiState() !== \'Unknown\' -->\r\n        <swx-toggle-button class="pref-toggle-btn"\r\n                           params="checked: param.value, click: param.toggleValue, ariaLabel: title, labelledById: param.ariaId"></swx-toggle-button>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: param.uiState() === \'Unknown\' -->\r\n        <swx-loading-animation class="spinner small blue"></swx-loading-animation>\r\n        <!-- /ko -->\r\n    </div>\r\n    <div class="pref-toggle-col">\r\n        <h2 class="pref-toggle-heading UserSettingsPage-featureLabel" data-bind="l10n: { key: \'settings_short_circuit_title\' }, attr: {id: param.ariaId}"></h2>\r\n        <p class="pref-toggle-sec-text UserSettingsPage-secondaryText" data-bind="l10n: { key: \'settings_short_circuit_description\' }"></p>\r\n        <a href="#" class="UserSettingsPage-actionSecondary clickable" data-actionItem="true" data-bind="click: param.launchShortCircuit, l10n: { key: \'settings_short_circuit_manage_contacts\' }"></a>\r\n        <div class="UserSettingsPage-images">\r\n            <span class="UserSettingsPage-image UserSettingsPage-googleImage"></span>\r\n            <span class="UserSettingsPage-image UserSettingsPage-linkedInImage"></span>\r\n            <span class="UserSettingsPage-image UserSettingsPage-yahooImage"></span>\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="pref-template-autoBuddyDiscovery">\r\n    <div>\r\n        <!-- ko if: param.uiState() === \'Unknown\' -->\r\n        <swx-loading-animation class="spinner small blue"></swx-loading-animation>\r\n        <!-- /ko -->\r\n    </div>\r\n    <div class="pref-toggle-col">\r\n        <h2 class="pref-toggle-heading UserSettingsPage-featureLabel" data-bind="l10n: { key: \'settings_short_circuit_auto_buddy_discovery_title\' }, attr: {id: param.ariaId}"></h2>\r\n        <p class="pref-toggle-sec-text UserSettingsPage-secondaryText" data-bind="l10n: { key: \'settings_short_circuit_auto_buddy_discovery_description\' }"></p>\r\n    </div>\r\n\r\n    <ul class="UserSettingsPage-list">\r\n        <!-- ko foreach: { data: param.value, as: \'proof\' }-->\r\n        <li class="UserSettingsPage-option pref-template-boolean">\r\n            <!-- ko if: proof.showToggle -->\r\n            <div data-bind="css: { \'pref-toggle--saving\': proof.uiState() === \'Saving\'}">\r\n                <!-- ko if: proof.uiState() !== \'Unknown\' -->\r\n                <swx-toggle-button class="pref-toggle-btn"\r\n                                   params="checked: proof.value, click: proof.toggleValue, ariaLabel: title, labelledById: param.ariaId"></swx-toggle-button>\r\n                <!-- /ko -->\r\n\r\n                <!-- ko if: proof.uiState() === \'Unknown\' -->\r\n                <swx-loading-animation class="spinner small blue"></swx-loading-animation>\r\n                <!-- /ko -->\r\n            </div>\r\n            <!-- /ko -->\r\n            <div class="pref-toggle-col" data-bind="css: { \'pref--indented\': !proof.showToggle() }">\r\n                <h2 class="pref-toggle-heading UserSettingsPage-featureLabel UserSettingsPage-featureLabel--marginless" data-bind="text: proof.title, attr: {id: param.ariaId}"></h2>\r\n                <a href="#" class="UserSettingsPage-actionSecondary clickable" data-actionItem="true" data-bind="click: proof.remove, l10n: { key: \'settings_short_circuit_remove\' }, visible: proof.showRemoveLink"></a>\r\n            </div>\r\n        </li>\r\n        <!-- /ko -->\r\n        <li class="UserSettingsPage-option pref-template-boolean">\r\n            <div class="pref-toggle-col pref--indented">\r\n                <a href="#" class="UserSettingsPage-actionPrimary clickable" data-actionItem="true" data-bind="click: param.launchPNV, l10n: { key: \'settings_short_circuit_add_number\' }"></a>\r\n            </div>\r\n        </li>\r\n    </ul>\r\n</script>\r\n'}),define("ui/components/userSettings/userSettingsPage",["require","exports","module","ui/viewModels/userSettings/userSettingsPageViewModel","constants/components","text!views/userSettings/userSettingsPage.html"],function(e,t){var n=e("ui/viewModels/userSettings/userSettingsPageViewModel");t.name=e("constants/components").userSettings.USER_SETTINGS_PAGE,t.template=e("text!views/userSettings/userSettingsPage.html"),t.viewModel={createViewModel:n.build.bind(n)}}),define("ui/viewModels/userSettings/shortCircuitViewModel",["require","vendor/knockout"],function(e){function n(){var e=this,n;e.shortCircuitSetting=t.observable("allow"),n=e.shortCircuitSetting.subscribe(function(e){e==="allow"}),e.openShortCircuitFlow=function(){},e.dispose=function(){n.dispose()}}var t=e("vendor/knockout");return n}),define("text!views/userSettings/shortCircuit.html",[],function(){return'<div class="ShortCircuit">\r\n    <div class="ShortCircuit-header">\r\n        <p class="ShortCircuit-heading fontSize-h3">\r\n            <span class="iconfont contact"></span>\r\n            <span data-bind="l10n: { key: \'contactPage_text_header\' }"></span>\r\n        </p>\r\n    </div>\r\n    <div class="ShortCircuit-body">\r\n        <div class="ShortCircuit-settingsTitle">\r\n            <p data-bind="l10n: { key: \'settings_short_circuit_my_contact_list\' }"></p>\r\n        </div>\r\n        <div class="ShortCircuit-settings">\r\n            <div>\r\n                <swx-radio-button params="name: \'shortCircuit-setting\', id: \'shortCircuit-allow\', value: \'allow\', checked: shortCircuitSetting, labelKey:\'settings_short_circuit_allow\'"></swx-radio-button>\r\n                <p class="ShortCircuit-settingsDescription" data-bind="l10n: { key: \'settings_short_circuit_allow_title\' }"></p>\r\n                <swx-button class="ShortCircuit-openFlowButton" params="cssClass: \'actionButton\', action: openShortCircuitFlow,\r\n                            textKey:\'settings_short_circuit_manage_contacts\', titleKey: \'settings_short_circuit_manage_contacts\',\r\n                            ariaLabelKey: \'settings_short_circuit_manage_contacts\'"></swx-button>\r\n            </div>\r\n            <div>\r\n                <swx-radio-button params="name: \'shortCircuit-setting\', id: \'shortCircuit-deny\', value: \'deny\', checked: shortCircuitSetting, labelKey: \'settings_short_circuit_deny\'"></swx-radio-button>\r\n                <p class="ShortCircuit-settingsDescription" data-bind="l10n: { key: \'settings_short_circuit_deny_title\' }"></p>\r\n            </div>\r\n        </div>\r\n        <div class="ShortCircut-logos">\r\n\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/userSettings/shortCircuit",["require","exports","module","ui/viewModels/userSettings/shortCircuitViewModel","constants/components","text!views/userSettings/shortCircuit.html"],function(e,t){function r(){var e=new n;return e}var n=e("ui/viewModels/userSettings/shortCircuitViewModel");t.name=e("constants/components").userSettings.SHORT_CIRCUIT,t.template=e("text!views/userSettings/shortCircuit.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/userSettings/aboutViewModel",["require","experience/settings"],function(e){function n(){function n(){var e=t.assetsBaseUrl.match(/\d+.\d+.\d+/);if(e)return e[0]}var e=this;e.appVersion=t.version,e.assetsVersion=n(),e.faqLink=t.faqPageUrl}var t=e("experience/settings");return n}),define("text!views/userSettings/about.html",[],function(){return'<h1 class="UserSettingsPage-heading" data-bind="l10n: { key: \'settings_about_category_title\' }"></h1>\r\n<div class="UserSettingsPage-option">\r\n    <p class="pref-toggle-heading UserSettingsPage-featureLabel">\r\n        <strong data-bind="l10n: { key: \'about_app_version\' }"></strong>: <span data-bind="text: appVersion"></span>\r\n    </p>\r\n    <p class="pref-toggle-heading UserSettingsPage-featureLabel">\r\n        <strong data-bind="l10n: { key: \'about_assets_version\' }"></strong>: <span data-bind="text: assetsVersion"></span>\r\n    </p>\r\n    <p class="pref-toggle-heading UserSettingsPage-featureLabel">\r\n        <a target="_blank" data-bind="attr: {href: faqLink}, l10n: { key: \'about_faq\' }"></a>\r\n    </p>\r\n</div>'}),define("ui/components/userSettings/about",["require","exports","module","ui/viewModels/userSettings/aboutViewModel","constants/components","text!views/userSettings/about.html"],function(e,t){function r(){return new n}var n=e("ui/viewModels/userSettings/aboutViewModel");t.name=e("constants/components").userSettings.ABOUT,t.template=e("text!views/userSettings/about.html"),t.viewModel={createViewModel:r}}),define("ui/components/userSettings/index",["require","ui/components/userSettings/userSettingsPage","ui/components/userSettings/shortCircuit","ui/components/userSettings/about"],function(e){return[e("ui/components/userSettings/userSettingsPage"),e("ui/components/userSettings/shortCircuit"),e("ui/components/userSettings/about")]}),define("experience/components/userSettings",["require","exports","module","ui/components/userSettings/index","ui/components/registrar"],function(e,t){var n=e("ui/components/userSettings/index"),r=e("ui/components/registrar");t.init=function(e){r.register(n),e()}}),define("text!views/me/me.html",[],function(){return"<swx-me-area></swx-me-area>\r\n"}),define("ui/controls/me/me",["require","exports","module","vendor/knockout","browser/document","text!views/me/me.html"],function(e,t){var n=e("vendor/knockout"),r=e("browser/document"),i=e("text!views/me/me.html");t.name="me",t.render=function(e,t){var s=r.createElement("div");s.className="swxMe",s.innerHTML=i,n.applyBindings(null,s),t(s)}}),define("ui/viewModels/me/area",["require","exports","module","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","cafe/applicationInstance","utils/common/cafeObservable","swx-enums","services/serviceLocator","utils/common/statusMapper","constants/common","swx-i18n","vendor/knockout","experience/settings","experience/api/calling","browser/window","browser/document","experience/api/authentication","utils/common/eventHelper","utils/common/eventMixin","lodash-compat","browser/dom","experience/api/me","ui/contextMenu/contextMenu"],function(e,t){function T(e,t,y){var T=this,N=i.get().personsAndGroupsManager.mePerson,C=u.resolve(f.serviceLocator.FEATURE_FLAGS),k=p.buildApi(),L={source:r.me.area},A=b.now(),O=u.resolve(f.serviceLocator.ACTION_TELEMETRY),M=w.getElement(".Me-displayName",t),D=b.once(function(e,t){var i;e&&(i=b.now()-A),O.recordAction(n.me.presenceLoaded,{source:r.me.area,mePresenceLoadTime:i,meStatus:t,meStatusLoaded:e})}),P=function(){if(i.get().signInManager.state()!==o.loginState.SignedIn)return;var e=N.status(),t=e===o.onlineStatus.Online;D(!0,e),T.notificationAvailabilityText(l.fetch({key:t?"me_notificationsOn":"me_notificationsOff"})),T.availabilityToggleAriaLabel(l.fetch({key:t?"accessibility_me_availabilityOnAriaLabel":"accessibility_me_availabilityOffAriaLabel"})),T.online(t),T.availability(a.getAvailabilityText(e)),T.avatarStatusClassName(a.getStatusIconClass(e))},H=function(){i.get().signInManager.state()===o.loginState.SignedIn&&T.displayName(N.displayName())},B=function(e){g.isDeactivation(e)&&T.collapse(null,e)},j=function(e){return e.type==="click"||e.type==="keypress"&&g.isActivation(e)};setTimeout(function(){D(!1)},x),T.displayName=c.observable(N.displayName()),T.avatarUrl=s.newObservableProperty(N.avatarUrl),T.isExpanded=E.isExpanded,T.linkTabIndex=c.computed(function(){return E.isExpanded()?-1:0}),T.accountLinkValue=h.meProfileUrl,T.notificationAvailabilityText=c.observable(l.fetch({key:"me_notificationsOff"})),T.availabilityToggleAriaLabel=c.observable(l.fetch({key:"accessibility_me_availabilityOffAriaLabel"})),T.online=c.observable(!1),T.isFocused=c.observable(!1),T.availability=c.observable(l.fetch({key:"me_pendingPresence"})),T.avatarStatusClassName=c.observable(o.onlineStatus.Unknown.toLowerCase()),N.status.changed(P),N.displayName.changed(H),T.threeStatePresenceControlEnabled=C.isFeatureOn(f.featureFlags.NEW_SELF_PRESENCE),T.toggleStatus=function(){var e=N.status(),t=T.online()?o.onlineStatus.Hidden:o.onlineStatus.Online;N.status(t),O.recordAction(n.me.presenceChanged,{source:r.me.area,pickerVersion:"twoState",oldStatus:e,newStatus:t,meExpanded:!1})},T.triggerPresencePopup=function(e,t,n){return j(n)&&(S.hide(n),n.preventDefault(),T.dispatchEvent(f.events.me.PRESENCE_POPUP_SHOW,e,T.DIRECTION.CHILD)),!0},T.isPluginInstalled=k.isPluginInstalled,T.collapse=function(e,t){y.restore(),T.isExpanded(!1),O.recordAction(n.me.collapsed,L),M.focus(),t.stopPropagation(),v.removeEventListener("keydown",B)},T.expand=function(){y.restrict(),T.isExpanded(!0),T.isFocused(!0),v.addEventListener("keydown",B),O.recordAction(n.me.expanded,L)},T.toggleMeSize=function(e,t){if(j(t)){if(T.isExpanded()&&t.target===t.currentTarget)return T.collapse(e,t),!0;T.isExpanded()||T.expand()}return!0},T.installPlugin=function(){k.startPluginInstall(),O.recordAction(n.me.installPluginLinkClicked,L)},T.meAccountLinkClicked=function(e,t,r){d.open(e,"_blank"),O.recordAction(n.me.accountLinkClicked,L),r.preventDefault()},T.meSignOut=function(){m.signOut(),O.recordAction(n.me.signOutClicked,L)},T.dispose=function(){T.avatarUrl.dispose(),T.linkTabIndex.dispose(),N.status.changed.off(P),N.displayName.changed.off(H)}}var n=e("ui/telemetry/actions/actionNames"),r=e("ui/telemetry/actions/actionSources"),i=e("cafe/applicationInstance"),s=e("utils/common/cafeObservable"),o=e("swx-enums"),u=e("services/serviceLocator"),a=e("utils/common/statusMapper"),f=e("constants/common"),l=e("swx-i18n").localization,c=e("vendor/knockout"),h=e("experience/settings"),p=e("experience/api/calling"),d=e("browser/window"),v=e("browser/document"),m=e("experience/api/authentication"),g=e("utils/common/eventHelper"),y=e("utils/common/eventMixin"),b=e("lodash-compat"),w=e("browser/dom"),E=e("experience/api/me"),S=e("ui/contextMenu/contextMenu"),x=6e4;b.assign(T.prototype,y),t.build=function(e,t,n){return new T(e,t,n)}}),define("text!views/me/area.html",[],function(){return'<div class="Me" data-bind="css: { \'Me--expanded\': isExpanded() }, click: toggleMeSize">\r\n    <div class="Me-small">\r\n        <!-- ko if: threeStatePresenceControlEnabled -->\r\n        <div class="Me-presenceStatus" data-bind="event: { keypress: triggerPresencePopup.bind(null, \'Me-collapsed\'), click: triggerPresencePopup.bind(null, \'Me-collapsed\') }, clickBubble: false">\r\n            <button class="btn secondary circle Me-openPresencePopup" type="button">\r\n                <span class="iconfont chevronDown"></span>\r\n            </button>\r\n        </div>\r\n        <swx-me-presence-popup params="key: \'Me-collapsed\'" class="Me-presencePopup"></swx-me-presence-popup>\r\n        <!-- /ko -->\r\n        <div id="expandMeProfileLabel" class="offScreen">\r\n            <span data-bind="text: displayName"></span>\r\n            <span data-bind="l10n: {\'key\': \'accessibility_me_expandProfile\'}"></span>\r\n        </div>\r\n        <div class="Me-skyContainer">\r\n            <div class="Me-sky"></div>\r\n            <swx-avatar-deprecated class="Me-avatar" params="avatar: avatarUrl, status: avatarStatusClassName"></swx-avatar-deprecated>\r\n            <div class="Me-info">\r\n                <p class="Me-displayName fontSize-h3 strong" aria-labelledby="expandMeProfileLabel" role="button" data-bind="text: displayName, event: {keypress: toggleMeSize}, attr: {tabindex: linkTabIndex}"></p>\r\n                <p class="Me-availability" data-bind="text: availability"></p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <!-- ko if: isExpanded ()-->\r\n    <div class="Me-large" data-bind="css: { \'Me-large--visible\': isExpanded() }">\r\n        <div class="Me-info">\r\n            <button class="btn secondary circle Me-collapseBtn" type="button" data-bind="click: collapse, hasFocus: isFocused, l10n_attr: {\'aria-label\': \'accessibility_me_collapseProfile\'}">\r\n                <span class="iconfont chevronUp" data-bind="l10n: { \'key\': \'accessibility_me_collapseProfile\' }"></span>\r\n            </button>\r\n            <p class="Me-displayName fontSize-h3 strong" data-bind="text: displayName"></p>\r\n            <p class="Me-availability" data-bind="text: availability"></p>\r\n        </div>\r\n        <div class="Me-content">\r\n            <div class="Me-avatarContainer">\r\n                <swx-avatar-deprecated class="Me-avatar--large" params="avatar: avatarUrl, status: avatarStatusClassName"></swx-avatar-deprecated>\r\n                <swx-me-avatar-file-picker class="Me-avatarFilePicker"></swx-me-avatar-file-picker>\r\n            </div>\r\n            <div class="Me-availabilityWrapper">\r\n                <!-- ko ifnot: threeStatePresenceControlEnabled -->\r\n                    <swx-toggle-button params="checked: online, click: toggleStatus, ariaLabel: availabilityToggleAriaLabel"></swx-toggle-button>\r\n                    <div class="Me-availabilityText Me-availabilityText--disabled" data-bind="text: availability"></div>\r\n                <!-- /ko -->\r\n                <!-- ko if: threeStatePresenceControlEnabled -->\r\n                    <button aria-haspopup="true" class="Me-availabilityText Me-availabilityTextAnchor" data-bind="event: { keypress: triggerPresencePopup.bind(null, \'Me-expanded\'), click: triggerPresencePopup.bind(null, \'Me-expanded\'), mousedown: function (data, e) { e.preventDefault(); } }, l10n_attr: {\'aria-label\': \'accessibility_me_changePresenceStatusAriaLabel\'}">\r\n                        <span data-bind="text: availability, attr: {\'aria-label\': availability}"></span>\r\n                        <span class="iconfont chevronDown Me-availabilityChevron"></span>\r\n                        <swx-me-presence-popup params="key: \'Me-expanded\'"></swx-me-presence-popup>\r\n                    </button>\r\n                <!-- /ko -->\r\n                <div class="Me-notificationsText" data-bind="text: notificationAvailabilityText, attr: {\'aria-label\': notificationAvailabilityText}"></div>\r\n            </div>\r\n            <a class="Me-link" data-bind="visible: !isPluginInstalled(), event: { click: installPlugin }, l10n_attr: {\'aria-label\': \'me_pluginLinkText\'}" href="javascript:void(0);">\r\n                <span class="iconfont arrowDown Me-linkIcon"></span>\r\n                <span class="fontSize-h3 Me-linkText" data-bind="l10n: {\'key\': \'me_pluginLinkText\'}"></span>\r\n            </a>\r\n            <a class="Me-link" data-bind="attr: { href: accountLinkValue }, l10n_attr: {\'aria-label\': \'me_accountLinkText\'}, event: { click: meAccountLinkClicked.bind(null, accountLinkValue) }" target="_blank">\r\n                <span class="iconfont settings Me-linkIcon"></span>\r\n                <span class="fontSize-h3 Me-linkText" data-bind="l10n: {\'key\': \'me_accountLinkText\'}"></span>\r\n            </a>\r\n            <a class="Me-link" data-bind="event: { click: meSignOut }, l10n_attr: {\'aria-label\': \'me_accountSignOutLinkText\' }" href="javascript:void(0);">\r\n                <span class="iconfont signOut Me-linkIcon"></span>\r\n                <span class="fontSize-h3 Me-linkText" data-bind="l10n: {\'key\': \'me_accountSignOutLinkText\' }"></span>\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/me/area",["require","exports","module","ui/viewModels/me/area","utils/common/focusRestrictor","constants/components","text!views/me/area.html"],function(e,t){function i(e,t){var i=[".toasts",".footer",".notifications"],s=r.build(t.element,i),o=n.build(e,t.element,s);return o}var n=e("ui/viewModels/me/area"),r=e("utils/common/focusRestrictor");t.name=e("constants/components").me.AREA,t.template=e("text!views/me/area.html"),t.viewModel={createViewModel:i}}),define("telemetry/notifications/notificationActions",["require","exports","module","ui/telemetry/telemetryClient","experience/settings","constants/common"],function(e,t){function s(){function e(e){var t=i.telemetry.notificationActionsEvent.TYPE,s={};s.type=e.type,s.action=e.action,n.get().sendEvent(r.telemetry.uiTenantToken,t,s)}return{send:e}}var n=e("ui/telemetry/telemetryClient"),r=e("experience/settings"),i=e("constants/common");t.build=function(){return new s}}),define("notifications/common/notification",["require","vendor/knockout","ui/controls/calling/sounds","constants/common","telemetry/notifications/notificationActions"],function(e){var t=e("vendor/knockout"),n=e("ui/controls/calling/sounds"),r=e("constants/common"),i=r.telemetry.notificationActionsEvent,s=e("telemetry/notifications/notificationActions");return function(e,r,o,u){function d(){c=a.active.subscribe(function(e){c.dispose(),e||a.sound.stop()})}function v(e){return e&&e.key}var a=this,f=v(u)?u.key:n.KEYS.MESSAGE_RECEIVED_1,l=v(u)?u.loop:!1,c,h=s.build(),p={type:e};this.type=e,this.sender=r||{},o=o||{},this.title=t.observable(""),this.description=t.observable(""),this.active=t.observable(!1),this.accept=function(){p.action=i.action.accept,a.active()&&o.accept&&(o.accept.apply(null,arguments),h.send(p)),a.active(!1)},this.decline=function(){p.action=i.action.decline,a.active()&&o.decline&&(o.decline(),h.send(p)),a.active(!1)},this.open=function(){p.action=i.action.open,a.active()&&o.open&&(o.open(),h.send(p)),a.active(!1)},this.sound={play:function(){a.active()&&(l?n.playLoop(f):n.playOnce(f),d())},stop:function(){n.stop(f)}}}}),define("notifications/common/sender",["require","exports","module","utils/chat/messageSanitizer","utils/common/cafeObservable","vendor/knockout","swx-utils-common","swx-enums","swx-i18n","experience/settings","constants/common","services/serviceLocator"],function(e,t){function c(e){var t,r=u.fetch({key:"notification_text_group_conversation_from"});return e.topic()?t=n.getSanitizedTopic(e.topic()):t=r+" "+e.participants(0).person.displayName(),i.observable(t)}function h(e){return e.isGroupConversation()?{uri:i.observable("local:"+s.create()),status:i.observable(o.Unknown),displayName:c(e),avatar:d(e.avatarUrl,a.assetsBaseUrl+"/images/avatars/default-avatar-group.png")}:p(e.participants(0).person)}function p(e){return{uri:r.newObservableProperty(e.id),status:r.newObservableProperty(e.status),displayName:r.newObservableProperty(e.displayName),avatar:d(e.avatarUrl,a.assetsBaseUrl+"/images/avatars/default-avatar-contact.png")}}function d(e,t){var n=l.resolve(f.serviceLocator.FEATURE_FLAGS);return!e()||n.isFeatureOn(f.featureFlags.SHOW_DEFAULT_AVATAR_IN_NOTIFICATIONS)?i.observable(t):r.newObservableProperty(e)}var n=e("utils/chat/messageSanitizer"),r=e("utils/common/cafeObservable"),i=e("vendor/knockout"),s=e("swx-utils-common").guid,o=e("swx-enums").onlineStatus,u=e("swx-i18n").localization,a=e("experience/settings"),f=e("constants/common"),l=e("services/serviceLocator");t.fromConversation=h,t.fromPerson=p}),define("notifications/types/incomingCall",["require","constants/common","notifications/common/notification","services/pubSub/pubSub","notifications/common/sender","ui/controls/calling/sounds","ui/viewModels/calling/helpers/callingFacade","ui/telemetry/actions/actionNames","services/serviceLocator"],function(e){function f(e,f){function d(n,r){var i=r?u.audioVideo.acceptWithVideo:u.audioVideo.acceptWithAudio,s=a.resolve(t.serviceLocator.ACTION_TELEMETRY);s.recordAction(i),n?o.acceptCall(e,r):o.installPlugin(c,e,!1,r)}function v(){var n=a.resolve(t.serviceLocator.ACTION_TELEMETRY);n.recordAction(u.audioVideo.reject),o.rejectCall(e)}var l=t.notifications.AUDIO,c="incoming",h={key:s.KEYS.CALL_INCOMING,loop:!0},p={accept:function(n){n===t.modalityType.AUDIO||!n?d(f,!1):n===t.modalityType.VIDEO?d(f,!0):n===t.modalityType.CHAT&&(v(),r.publish(t.events.navigation.OPEN_CONVERSATION,{model:e}))},decline:v};return new n(l,i.fromConversation(e),p,h)}var t=e("constants/common"),n=e("notifications/common/notification"),r=e("services/pubSub/pubSub"),i=e("notifications/common/sender"),s=e("ui/controls/calling/sounds"),o=e("ui/viewModels/calling/helpers/callingFacade"),u=e("ui/telemetry/actions/actionNames"),a=e("services/serviceLocator");return{build:f}}),define("notifications/types/hardware",["require","notifications/common/notification"],function(e){function n(e,n){var r=new t(e);return r.title(n),r}var t=e("notifications/common/notification");return{build:n}}),define("notifications/types/avatar",["require","notifications/common/notification"],function(e){function n(e,n){var r=new t(e);return r.title(n),r}var t=e("notifications/common/notification");return{build:n}}),define("notifications/types/callingNotSupported",["require","notifications/common/notification","constants/common","utils/people/userDataProcessor","constants/calling.resources","swx-i18n"],function(e){function o(e,t){var n=i.linkTemplate,o=s.fetch({key:"notification_text_learnMore"}),u=r.stripAnchors(t),a=r.sanitizeXml(u);return e.replace("{callerName}",a)+" "+n.replace("{notification_text_learnMore}",o)}function u(e,r){var i,u;e?i=s.fetch({key:"notification_text_osNotSupported"}):i=s.fetch({key:"notification_text_browserNotSupported"}),u=o(i,r.topic());var a=new t(n.notifications.WARNING);return a.title(u),a}var t=e("notifications/common/notification"),n=e("constants/common"),r=e("utils/people/userDataProcessor"),i=e("constants/calling.resources").notifications.incomingCall,s=e("swx-i18n").localization;return{build:u}}),define("notifications/types/unreadMessage",["require","notifications/common/notification","notifications/common/sender","services/pubSub/pubSub","constants/common","swx-i18n","cafe/applicationInstance","services/serviceLocator"],function(e){function a(e){function a(t){return e.likeAdded?t?n.fromConversation(h):n.fromPerson(c.person):n.fromPerson(c.sender)}function f(t){return e.likeAdded?t?s.fetch({key:"hearts_notification_messageGroup",params:{participantName:c.person.displayName(),messageText:c.text()}}):s.fetch({key:"hearts_notification_messageConv",params:{messageText:c.text()}}):c.text()}var l,c=e.message,h=e.conversation,p=i.notifications.UNREAD_MESSAGE,d=h.isGroupConversation(),v=a(d),m=u.resolve(i.serviceLocator.FEATURE_FLAGS),g=m.isFeatureOn(i.featureFlags.MENTIONS_ENABLED),y=e.likeAdded?!1:i.mentions.meIdentifier.test(c.html()),b=g&&o.get().personsAndGroupsManager.mePerson.preferences(i.userSettings.preferences.MENTIONS).value(),w={open:function(){l={model:h,origin:i.telemetry.historyLoadOrigin.NOTIFICATION_CONV},g&&y&&(l.origin=i.telemetry.historyLoadOrigin.MENTION_ME),e.likeAdded&&(l.messageId=c.id),r.publish(i.events.navigation.OPEN_CONVERSATION,l)}},E=new t(p,v,w);return E.description(f(d)),y&&g&&b&&E.title(s.fetch({key:"mention_notification_title",params:{participant:v.displayName(),chat:h.topic()}})),E}var t=e("notifications/common/notification"),n=e("notifications/common/sender"),r=e("services/pubSub/pubSub"),i=e("constants/common"),s=e("swx-i18n").localization,o=e("cafe/applicationInstance"),u=e("services/serviceLocator");return{build:a}}),define("notifications/types/contactRequest",["require","cafe/applicationInstance","notifications/common/notification","services/pubSub/pubSub","constants/common","swx-enums"],function(e){function o(e){function h(){r.publish(i.events.navigation.OPEN_CONVERSATION,{model:o,origin:i.telemetry.historyLoadOrigin.NOTIFICATION_CONV})}function p(){var e=u.sender;t.get().personsAndGroupsManager.all.persons.add(e,e.id(),undefined,s.activityType.ContactRequestIncoming),h()}function d(){t.get().conversationsManager.conversations.remove(o,s.activityType.ContactRequestIncoming)}var o=e.conversation,u=e.activityItem,a,f=i.notifications.CONTACT_REQUEST,l,c;return l={uri:u.sender.id,status:u.sender.status,displayName:u.sender.displayName,avatar:u.sender.avatarUrl,capabilities:u.sender.capabilities},c={accept:p,decline:d,open:h},a=new n(f,l,c),a.description(u.greeting()),a.title(u.sender.title()),a}var t=e("cafe/applicationInstance"),n=e("notifications/common/notification"),r=e("services/pubSub/pubSub"),i=e("constants/common"),s=e("swx-enums");return{build:o}}),define("notifications/types/chatRequest",["require","cafe/applicationInstance","constants/common","services/pubSub/pubSub","notifications/common/notification","notifications/common/sender","swx-enums"],function(e){function u(e){var u=e.conversation,a,f={accept:function(){u.chatService.accept.enabled()&&u.chatService.accept(),r.publish(n.events.navigation.OPEN_CONVERSATION,{model:u})},decline:function(){u.chatService.reject.enabled()&&u.chatService.reject(),u.isGroupConversation()&&t.get().conversationsManager.conversations.remove(u)}};return a=new i(n.notifications.CHAT,s.fromConversation(u),f),u.historyService.activityItems.filter(function(e){e.type()===o.activityType.TextMessage&&(a.description(e.text()),a.title(e.sender.title()))}),a}var t=e("cafe/applicationInstance"),n=e("constants/common"),r=e("services/pubSub/pubSub"),i=e("notifications/common/notification"),s=e("notifications/common/sender"),o=e("swx-enums");return{build:u}}),define("notifications/factory",["require","constants/common","swx-i18n","notifications/types/incomingCall","notifications/types/hardware","notifications/types/avatar","notifications/types/callingNotSupported","notifications/types/unreadMessage","notifications/types/contactRequest","notifications/types/chatRequest"],function(e){function l(e,l){var c=t.notifications;switch(e){case c.INCOMING_CALL:return r.build(l.conversation,!0);case c.INCOMING_CALL_WITH_NO_PLUGIN:return r.build(l.conversation,!1);case c.DEVICE_MISSING_CAMERA:return i.build(c.WARNING,n.fetch({key:"notification_text_hardware_camera"}));case c.DEVICE_MISSING_MICROPHONE:return i.build(c.WARNING,n.fetch({key:"notification_text_hardware_mic"}));case c.DEVICE_MISSING_SPEAKER:return i.build(c.ERROR,n.fetch({key:"notification_text_hardware_speaker"}));case c.INCOMING_CALL_BROWSER_NOT_SUPPORTED:return o.build(!1,l.conversation);case c.INCOMING_CALL_OS_NOT_SUPPORTED:return o.build(!0,l.conversation);case c.UNREAD_MESSAGE:return u.build(l);case c.CONTACT_REQUEST:return a.build(l);case c.CHAT:return f.build(l);case c.AVATAR_NOT_SUPPORTED_IMAGE_TYPE:return s.build(c.ERROR,n.fetch({key:"notification_text_avatar_not_supported_image_type"}));case c.AVATAR_UPLOAD_ERROR:return s.build(c.ERROR,n.fetch({key:"notification_text_avatar_upload_error"}))}}var t=e("constants/common"),n=e("swx-i18n").localization,r=e("notifications/types/incomingCall"),i=e("notifications/types/hardware"),s=e("notifications/types/avatar"),o=e("notifications/types/callingNotSupported"),u=e("notifications/types/unreadMessage"),a=e("notifications/types/contactRequest"),f=e("notifications/types/chatRequest");return{build:l}}),define("ui/viewModels/me/avatarFilePicker",["require","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","vendor/knockout","constants/common","cafe/applicationInstance","swx-i18n","notifications/factory","notifications/common/notificationHub","services/serviceLocator","browser/dom"],function(e){function c(e,c){function g(e){var t,n=new window.FileReader,r=["image/gif","image/png","image/jpeg"];if(e===null)return;t=e.type;if(r.indexOf(t)===-1){a.notify(u.build(i.notifications.AVATAR_NOT_SUPPORTED_IMAGE_TYPE));return}n.onload=function(){var e=n.result;y(e,function(e){b(e)})},n.readAsDataURL(e)}function y(e,t){var n=new window.Image;n.addEventListener("load",function(){var e=document.createElement("canvas"),r=e.getContext("2d"),i=n.height,s=n.width,o=256,u;e.width=o,e.height=o,s===i?r.drawImage(n,0,0,o,o):s>i?(s=Math.floor(o*s/i),i=o,u=Math.floor((s-o)/2),r.drawImage(n,-u,0,s,i)):s<i&&(i=Math.floor(o*i/s),s=o,u=Math.floor((i-o)/2),r.drawImage(n,0,-u,s,i)),e.toBlob(t,"image/jpeg",1)},!1),n.setAttribute("src",e)}function b(e){var t=new window.FileReader,n=e.type;t.onload=function(t){var r=t.target.result;h.avatarUploadDisabled(!0),p.updateAvatar(r,n).then(function(){var t=new window.FileReader;t.onload=function(e){p.updateAvatarUrl(e.target.result)},t.readAsDataURL(e),h.avatarUploadDisabled(!1)},function(){a.notify(u.build(i.notifications.AVATAR_UPLOAD_ERROR)),h.avatarUploadDisabled(!1)})},t.readAsArrayBuffer(e)}var h=this,p=s.get().personsAndGroupsManager.mePerson,d={source:n.me.avatar},v=f.resolve(i.serviceLocator.ACTION_TELEMETRY),m=l.getElement(".Me-avatarFilePickerInput",c);h.avatarUploadSupported=!!window.FormData&&!!window.FileReader,h.avatarUploadDisabled=r.observable(!h.avatarUploadSupported),h.uploadProfilePictureText=o.fetch({key:"me_avatar_uploadProfilePictureText"}),h.uploadProfilePictureAriaLabel=o.fetch({key:"me_avatar_uploadProfilePictureAriaLabel"}),h.openFilePickerInput=function(){m.click()},h.checkUploadEnabled=function(e,n){return v.recordAction(t.me.avatarFilePickerClicked,d),n.stopPropagation(),!h.avatarUploadDisabled()},h.processFiles=function(e,t){g(t.target.files[0]),t.target.value=null}}var t=e("ui/telemetry/actions/actionNames"),n=e("ui/telemetry/actions/actionSources"),r=e("vendor/knockout"),i=e("constants/common"),s=e("cafe/applicationInstance"),o=e("swx-i18n").localization,u=e("notifications/factory"),a=e("notifications/common/notificationHub"),f=e("services/serviceLocator"),l=e("browser/dom");return c.build=function(e,t){return new c(e,t)},c}),define("text!views/me/avatarFilePicker.html",[],function(){return'<div data-bind="visible: avatarUploadSupported">\r\n    <input type="file" accept="image/*" class="Me-avatarFilePickerInput"\r\n        data-bind="event: {click: checkUploadEnabled,\r\n                change: processFiles}"/>\r\n    <button class="Me-avatarOpenFilePickerInput" data-bind="click: openFilePickerInput,\r\n            attr: {\r\n                title: uploadProfilePictureText,\r\n                \'aria-label\': uploadProfilePictureAriaLabel\r\n            }"></button>\r\n    <span class="Me-avatarFilePickerButton">\r\n        <span class="btn primary circle protected picturePickerBtn">\r\n            <span class="iconfont picturePicker picture"></span>\r\n        </span>\r\n    </span>\r\n</div>\r\n'}),define("ui/components/me/avatarFilePicker",["require","exports","module","ui/viewModels/me/avatarFilePicker","constants/components","text!views/me/avatarFilePicker.html"],function(e,t){function r(e,t){var r=n.build(e,t.element);return r}var n=e("ui/viewModels/me/avatarFilePicker");t.name=e("constants/components").me.AVATAR_FILE_PICKER,t.template=e("text!views/me/avatarFilePicker.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/me/presencePopup",["require","vendor/knockout","utils/common/async","constants/common","cafe/applicationInstance","swx-enums","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","services/serviceLocator","utils/common/eventMixin","lodash-compat","utils/common/outsideClickHandler"],function(e){function h(e){function p(){n.execute(function(){f.isOpened(!1)}),c.remove("PresencePopup")}function d(t){!f.isOpened()&&e.key===t&&(c.add("PresencePopup",p),f.isOpened(!0))}function v(){f.currentStatus(l.status())}var f=this,l=i.get().personsAndGroupsManager.mePerson,h=a.resolve(r.serviceLocator.ACTION_TELEMETRY);f.isOpened=t.observable(!1),f.currentStatus=t.observable(l.status()),f.presenceStatuses=[{status:s.onlineStatus.Online,l10nKey:"message_text_presenceAvailable",cssClass:"PresencePopup-status--available"},{status:s.onlineStatus.Busy,l10nKey:"message_text_presenceBusy",cssClass:"PresencePopup-status--busy"},{status:s.onlineStatus.Hidden,l10nKey:"message_text_presenceNotAvailable",cssClass:"PresencePopup-status--hidden"}],f.updateStatus=function(t){var n=f.presenceStatuses[t].status,r=l.status();return n!==r&&(l.status(n),h.recordAction(o.me.presenceChanged,{source:u.me.area,pickerVersion:"threeState",oldStatus:r,newStatus:n,meExpanded:e.key==="Me-expanded"}),p()),!0},f.getPresenceStatusCssClasses=function(e){var t="PresencePopup-status "+f.presenceStatuses[e].cssClass;return f.currentStatus()===f.presenceStatuses[e].status&&(t+=" PresencePopup-status--selected"),t},f.init=function(){l.status.changed(v),f.registerEvent(r.events.me.PRESENCE_POPUP_SHOW,d)},f.dispose=function(){l.status.changed.off(v)}}var t=e("vendor/knockout"),n=e("utils/common/async"),r=e("constants/common"),i=e("cafe/applicationInstance"),s=e("swx-enums"),o=e("ui/telemetry/actions/actionNames"),u=e("ui/telemetry/actions/actionSources"),a=e("services/serviceLocator"),f=e("utils/common/eventMixin"),l=e("lodash-compat"),c=e("utils/common/outsideClickHandler");return h.build=function(e,t){return new h(e,t)},l.assign(h.prototype,f),h}),define("text!views/me/presencePopup.html",[],function(){return'<div class="PresencePopup popup arrow up" data-bind= "visible: isOpened, clickBubble: false">\r\n    <ul class="PresencePopup-statusContainer" data-bind="foreach: presenceStatuses, keyboardNavigation: { itemSelector: \'li:not(.PresencePopup-status--selected)\' }">\r\n        <li data-bind="css: $parent.getPresenceStatusCssClasses($index()), click: $parent.updateStatus.bind(null, $index()), enterKey: $parent.updateStatus.bind(null, $index()), l10n: { key: l10nKey }, clickBubble: false">\r\n        </li>\r\n    </ul>\r\n</div>\r\n'}),define("ui/components/me/presencePopup",["require","exports","module","vendor/knockout","ui/viewModels/me/presencePopup","constants/components","text!views/me/presencePopup.html"],function(e,t){function i(e,t){var i=t.element,s=n.dataFor(i),o=r.build(e,i);return o.setContext(s),o.init(),o}var n=e("vendor/knockout"),r=e("ui/viewModels/me/presencePopup");t.name=e("constants/components").me.PRESENCE_POPUP,t.template=e("text!views/me/presencePopup.html"),t.viewModel={createViewModel:i}}),define("ui/components/me/index",["require","ui/components/me/area","ui/components/me/avatarFilePicker","ui/components/me/presencePopup"],function(e){return[e("ui/components/me/area"),e("ui/components/me/avatarFilePicker"),e("ui/components/me/presencePopup")]}),define("experience/components/me",["require","exports","module","constants/common","services/serviceLocator","ui/components/registrar","ui/controls/me/me","ui/components/me/index"],function(e,t){var n=e("constants/common"),r=e("services/serviceLocator"),i=e("ui/components/registrar"),s=e("ui/controls/me/me"),o=e("ui/components/me/index");t.init=function(e){var t=r.resolve(n.serviceLocator.CONTROLS_BUILDER);t.register(s),i.register(o),e()}}),define("componentsToLoad",["experience/components/experience","experience/components/people","experience/components/calling","experience/components/chat","experience/components/commerce","experience/components/userSettings","experience/components/me"],function(){return Array.prototype.slice.apply(arguments)}),define("experience/componentsLoader",["require","experience/componentsInitializer","componentsToLoad"],function(e){function r(){return new Promise(function(e,r){t.init(n,e,r)})}var t=e("experience/componentsInitializer"),n=e("componentsToLoad");return{init:r}}),define("services/telemetry/experience.instrumentation",["require","constants/common","swx-utils-common"],function(e){function i(e,t){if(e==="webapi-requestEndpointCreation"&&t===403)return n.get("chat-4171")}var t=e("constants/common"),n=e("swx-utils-common").sessionStorage,r={};return r[t.events.errors.SERVICE_FAILURE]=function(e){return{type:"ServiceFault",data:{serviceName:e.serviceName,faultCode:e.faultCode,faultContext:i(e.serviceName,e.faultCode)||t.telemetry.NOT_AVAILABLE,errorCode:e.errorCode||t.telemetry.NOT_AVAILABLE,errorMessage:e.errorMessage||t.telemetry.NOT_AVAILABLE,verb:e.verb||t.telemetry.NOT_AVAILABLE,host:e.host||t.telemetry.NOT_AVAILABLE}}},r[t.events.system.EXPERIENCE_INITIALIZED]=function(e){return{type:"session",data:{subType:"init",configLoadDuration:e.configLoadDuration,packageLoadDuration:e.packageLoadDuration,experienceInitializeDuration:e.experienceInitializeDuration}}},r}),define("services/telemetry/people/performance/performanceAnalyser",["require","constants/common","usertiming","ui/telemetry/telemetryClient","experience/settings"],function(e){function a(){function a(e){Object.keys(e).forEach(function(t){n.clearMarks(e[t])})}function c(e){Object.keys(e).forEach(function(t){n.clearMeasures(e[t])})}var e=this;e.contactsLoaded=function(e){if(e&&f(s.CONTACTS.LIST_LOAD.START)){n.mark(s.CONTACTS.LIST_LOAD.END),n.measure(o.CONTACTS.LIST_LOAD.TTC,s.CONTACTS.LIST_LOAD.START,s.CONTACTS.LIST_LOAD.END);var h={name:u.LOAD_CONTACTS,contactsCount:e.contactsCount?e.contactsCount:0,renderDuration:l(o.CONTACTS.LIST_LOAD.TTC)};r.get().sendEvent(i.telemetry.uiTenantToken,t.telemetry.contacts.type.CONTACTS,h)}a(s.CONTACTS.LIST_LOAD),c(o.CONTACTS.LIST_LOAD)}}function f(e){return n.getEntriesByName(e).length>0}function l(e){var t,r=n.getEntriesByName(e);return r&&r.length&&(t=r[0].duration),t===undefined||t===null?"undefined":t}var t=e("constants/common"),n=e("usertiming"),r=e("ui/telemetry/telemetryClient"),i=e("experience/settings"),s=t.telemetry.performanceMarks,o=t.telemetry.measurements,u=t.telemetry.subCategories;return{build:function(){return new a}}}),define("services/telemetry/people/performance/performanceTelemetry",["require","usertiming","constants/common","services/telemetry/eventBus","services/telemetry/people/performance/performanceAnalyser"],function(e){function s(){var e=i.build();r.get().subscribe(n.events.contacts.CONTACTS_LOADED,e.contactsLoaded)}function o(){var e=n.telemetry.performanceMarks;t.mark(e.CONTACTS.LIST_LOAD.START)}var t=e("usertiming"),n=e("constants/common"),r=e("services/telemetry/eventBus"),i=e("services/telemetry/people/performance/performanceAnalyser");return{init:function(){s(),o()}}}),define("experience/telemetryFactory",["require","exports","module","services/telemetry/common/telemetry","services/telemetry/experience.instrumentation","services/telemetry/people/performance/performanceTelemetry"],function(e,t){function s(){function t(e){n.instrumentAllEvents(e)}var e={experience:function(){t(r)},people:function(){i.init()}};this.init=function(t){e[t]&&e[t]()}}var n=e("services/telemetry/common/telemetry"),r=e("services/telemetry/experience.instrumentation"),i=e("services/telemetry/people/performance/performanceTelemetry");t.build=function(){return new s}}),define("bindings/ko.keyboardNavigation",["require","lodash-compat","vendor/knockout","constants/keys","browser/window","browser/document","utils/common/eventHelper","constants/common"],function(e){function a(){var e="tabindex";n.bindingHandlers.keyboardNavigation={init:function(a,f){function h(){var e=p();e.forEach(E)}function p(){var e=a.querySelectorAll(c.itemSelector);return d(e)}function d(e){return Array.prototype.slice.call(e)}function v(){a.addEventListener(u.events.browser.FOCUS,m,!0),a.addEventListener(u.events.browser.BLUR,g,!0),a.addEventListener(u.events.browser.KEYDOWN,y),n.utils.domNodeDisposal.addDisposeCallback(a,function(){a.removeEventListener(u.events.browser.FOCUS,m,!0),a.removeEventListener(u.events.browser.BLUR,g,!0),a.removeEventListener(u.events.browser.KEYDOWN,y)})}function m(e){var t;if(!S(e.target))return;t=p();if(!t.length)return;E(a),h(),t.indexOf(l)!==-1?b(l):c.selectLastItem?b(t[t.length-1]):t.length&&b(t[0])}function g(e){var t=e.target;i.setTimeout(function(){function n(){return S(t)||e.indexOf(s.activeElement)!==-1}var e=p();n()||w(a)},1)}function y(e){function i(n){var r=t[t.indexOf(e.target)];do{r=t[t.indexOf(r)+n];if(!r)break;b(r)}while(s.activeElement!==r)}function u(){b(t[0])}function a(){b(t[t.length-1])}var t,n=o.getKeyCode(e);if(T(e)){N(e);return}if(!x(n))return;return t=p(),e.preventDefault(),e.stopPropagation(),n===r.LEFT||n===r.UP?i(-1):n===r.RIGHT||n===r.DOWN?i(1):n===r.HOME?u():n===r.END&&a(),!1}function b(e){e.focus(),c.persistSelection&&(l=e)}function w(t){t.setAttribute(e,0)}function E(t){t.setAttribute(e,-1)}function S(e){return e===a}function x(e){var t=[r.LEFT,r.UP,r.RIGHT,r.DOWN,r.HOME,r.END];return t.indexOf(e)>-1}function T(e){var t=o.getKeyCode(e);return e.shiftKey&&t===r.F10}function N(e){var t=s.createEvent("MouseEvents"),n=e.target.getBoundingClientRect();e.preventDefault(),e.stopPropagation(),t.initMouseEvent("contextmenu",!0,!1,window,0,0,0,n.right,n.top,!1,!1,!0,!1,2,null),e.target.dispatchEvent(t)}var l,c=t.defaults(f(),{persistSelection:!0,selectLastItem:!1});w(a),h(),v()}}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("constants/keys"),i=e("browser/window"),s=e("browser/document"),o=e("utils/common/eventHelper"),u=e("constants/common");return{register:a}}),define("bindings/ko.enterKey",["require","vendor/knockout","utils/common/eventHelper","constants/common","constants/keys"],function(e){function s(){t.bindingHandlers.enterKey={init:function(e,t,s,o){e.addEventListener(r.events.browser.KEYDOWN,function(e){var r=n.getKeyCode(e);if(r===i.ENTER||r===i.SPACE)t().call(o,o,e),e.stopPropagation()})}}}var t=e("vendor/knockout"),n=e("utils/common/eventHelper"),r=e("constants/common"),i=e("constants/keys");return{register:s}}),define("bindings/ko.getElement",["require","vendor/knockout"],function(e){function n(){t.bindingHandlers.getElement={init:function(e,t,n,r){t().call(r,e)}}}var t=e("vendor/knockout");return{register:n}}),define("bindings/ko.overflowClass",["require","vendor/knockout","browser/dom","browser/window"],function(e){function i(){t.bindingHandlers.overflowClass={init:function(e,n){function u(){var t=e.children,n,r,u;for(u=0;u<t.length;++u)n=t[u],r=s(n),o(n,r.isOverflowingToLeft,i.left),o(n,r.isOverflowingToRight,i.right)}function a(){r.removeEventListener("resize",u),e.removeEventListener("scroll",u),e.removeEventListener("DOMSubtreeModified",u)}var i=n();t.utils.domNodeDisposal.addDisposeCallback(e,a),e.addEventListener("DOMSubtreeModified",u),e.addEventListener("scroll",u),r.addEventListener("resize",u),u()}}}function s(e){var t=u(e,e.parentElement),n=t<e.parentElement.scrollLeft,r=t+e.clientWidth>e.parentElement.clientWidth+e.parentElement.scrollLeft;return{isOverflowingToLeft:n,isOverflowingToRight:r}}function o(e,t,r){if(!r)return;t?n.addClass(e,r):n.removeClass(e,r)}function u(e,t){var n=e.offsetLeft;while(t!==e.offsetParent)n-=t.offsetLeft,t=t.offsetParent;return n}var t=e("vendor/knockout"),n=e("browser/dom"),r=e("browser/window");return{register:i}}),define("bindings/ko.getVisibility",["require","vendor/knockout"],function(e){function n(){t.bindingHandlers.getVisibility={init:function(e,n,r,i){function a(){var t=e.offsetHeight>0&&e.offsetWidth>0;u!==t&&(u=t,o.call(i,t))}var s=window.setInterval(a,50),o=n(),u;t.utils.domNodeDisposal.addDisposeCallback(e,function(){window.clearInterval(s)})}}}var t=e("vendor/knockout");return{register:n}}),define("ui/viewModels/calling/helpers/resizer",["require","lodash-compat"],function(e){var t=e("lodash-compat"),n,r,i,s={ACTIVE:"resizeActive",MIN:"resizeMin",MAX:"resizeMax"},o={MOUSE_UP:"mouseup",MOUSE_MOVE:"mousemove"},u=function(){};return r=function(e,n,r){function l(){a=!0,document.addEventListener(o.MOUSE_MOVE,h),document.addEventListener(o.MOUSE_UP,c)}function c(e){function f(){return t<u.top||t>=u.bottom}var t=e.pageY,u=n.getBoundingClientRect();a=!1,f()&&v(s.ACTIVE,{remove:!0}),document.removeEventListener(o.MOUSE_MOVE,h),document.removeEventListener(o.MOUSE_UP,c),v([s.MAX,s.MIN],{remove:!0}),r.onResizeEnd(i)}function h(t){function u(){return o<=0}function a(){return o>=n-r.minHeight}var n=e.parentNode.offsetHeight,o=n-t.pageY;t.preventDefault();if(u()){v(s.MAX);return}if(a()){v(s.MIN);return}v([s.MAX,s.MIN],{remove:!0}),i=n-o,r.onResize(o)}function p(){Object.keys(f).forEach(function(e){var t=f[e];n.addEventListener(e,t)})}function d(){Object.keys(f).forEach(function(e){var t=f[e];n.removeEventListener(e,t)})}function v(e,r){var i="add";t.isArray(e)||(e=[e]),r&&r.remove&&(i="remove"),e.forEach(function(e){document.body.classList[i](e),e===s.ACTIVE&&n.classList[i](e)})}var a=!1,f={mouseenter:function(){v(s.ACTIVE)},mouseleave:function(){a||v(s.ACTIVE,{remove:!0})},mousedown:function(e){e.preventDefault(),l()}};return t.merge({minHeight:0,onResize:u,onResizeEnd:u},r||{}),p(),{dispose:function(){d()}}},n={build:function(e,t,n){return new r(e,t,n)}},n}),define("bindings/ko.resizer",["require","ui/viewModels/calling/helpers/resizer","vendor/knockout"],function(e){function r(){n.bindingHandlers.resizer={init:function(e,r){var i,s=r(),o=function(){},u=s.onResize||o,a=s.onResizeEnd||o,f=s.targetElement,l=s.minHeight||0,c=e;i=t.build(f,c,{minHeight:l,onResize:function(e){u(e)},onResizeEnd:function(e){a(e)}}),n.utils.domNodeDisposal.addDisposeCallback(e,function(){i.dispose()})}}}var t=e("ui/viewModels/calling/helpers/resizer"),n=e("vendor/knockout");return{register:r}}),define("bindings/ko.fallBackOnDefaultAvatarOnError",["require","vendor/knockout","experience/settings"],function(e){function r(){t.bindingHandlers.fallBackOnDefaultAvatarOnError={update:function(e,n,r){e.onerror=function(){e.src=i(r)},e.src=t.unwrap(n())||i(r)}}}function i(e){var t=e.get("isPstn"),r=e.get("isGroupAvatar");return t&&t()?n.appBaseUrl+n.images.relativeToAppBase.defaultPstnAvatarSvg:r&&r()?n.appBaseUrl+n.images.relativeToAppBase.defaultGroupAvatarSvg:n.appBaseUrl+n.images.relativeToAppBase.defaultProfileAvatarSvg}var t=e("vendor/knockout"),n=e("experience/settings");return{register:r}}),define("experience/koBindingsRegistrar",["require","exports","module","bindings/ko.keyboardNavigation","bindings/ko.enterKey","bindings/ko.getElement","bindings/ko.overflowClass","bindings/ko.getVisibility","bindings/ko.resizer","bindings/ko.fallBackOnDefaultAvatarOnError"],function(e,t){var n=e("bindings/ko.keyboardNavigation"),r=e("bindings/ko.enterKey"),i=e("bindings/ko.getElement"),s=e("bindings/ko.overflowClass"),o=e("bindings/ko.getVisibility"),u=e("bindings/ko.resizer"),a=e("bindings/ko.fallBackOnDefaultAvatarOnError");t.registerBindings=function(){n.register(),r.register(),u.register(),o.register(),i.register(),s.register(),a.register()}}),define("notifications/init",["require","exports","module","cafe/applicationInstance","constants/common","swx-enums","services/serviceLocator","notifications/settings"],function(e,t){var n=e("cafe/applicationInstance"),r=e("constants/common"),i=e("swx-enums"),s=e("services/serviceLocator"),o=e("notifications/settings");t.init=function(){var e=s.resolve(r.serviceLocator.MODEL_UI_OBSERVER);o.init(),n.get().signInManager.state.once(i.loginState.SignedIn,function(){e.observe(n.get())})}}),define("services/calling/autoCalling",["require","exports","module","cafe/applicationInstance","ui/viewModels/calling/helpers/callingFacade","constants/common","services/serviceLocator","ui/controls/calling/sounds","swx-utils-common","experience/api/helpers/conversationsSynchronizer"],function(e,t){function f(e){var t=n.get().conversationsManager,f=s.resolve(i.serviceLocator.FEATURE_FLAGS);if(!f.isFeatureOn(i.featureFlags.CALLING))return;if(!f.isFeatureOn(i.featureFlags.AUTO_CALLING))return;u.set(i.autoCallingThreadId,e),n.get().personsAndGroupsManager.mePerson.id.get().then(function(){a.sync().then(function(){var n=t.getConversationByUri(e);n&&n.autoCall&&n.autoCall.once(!0,function(){r.placeCall(n,!0,"autoCalling"),o.playOnce(o.KEYS.CALL_DIALING)})})})}var n=e("cafe/applicationInstance"),r=e("ui/viewModels/calling/helpers/callingFacade"),i=e("constants/common"),s=e("services/serviceLocator"),o=e("ui/controls/calling/sounds"),u=e("swx-utils-common").sessionStorage,a=e("experience/api/helpers/conversationsSynchronizer");t.init=function(){var e=u.get("userSession");if(!e){u.remove(i.autoCallingThreadId);return}try{var t=JSON.parse(e).threadId;t?new f(t):u.remove(i.autoCallingThreadId)}catch(n){u.remove(i.autoCallingThreadId)}}}),define("services/g11n/init",["require","swx-utils-common","constants/common","services/g11n/globalization","services/i18n/cultureInfo"],function(e){function s(e,t){e.locale=e.locale||{},e.locale.g11n=t}function o(e,o,u){function c(){var e=l[a];if(e.lang===n.i18n.EMBEDDED_LOCALE){s(u,e.lang);return}return(new Promise(function(n,r){t.loadScript(e.url,n,r)})).then(function(){s(u,e.lang)}).catch(function(){a++;if(a>=l.length)throw new Error("All attempts failed to load g11n settings for:"+o);return c()})}var a=0,f=i.getLocale(o),l=[{lang:o,url:e+"/"+o+"/settings.js"}];return f!==o&&l.push({lang:f,url:e+"/"+f+"/settings.js"}),l.push({lang:n.i18n.EMBEDDED_LOCALE,url:e+"/en-us/settings.js"}),Skype.WebExperience=Skype.WebExperience||{},Skype.WebExperience.setGlobalization=function(e){r.init(e)},c()}function u(e){var t=e.initParams.locale;if(t!==n.i18n.EMBEDDED_LOCALE){var r=e.appBaseUrl+"/resources/g11n";return o(r,t,e)}s(e,t)}var t=e("swx-utils-common").loader,n=e("constants/common"),r=e("services/g11n/globalization"),i=e("services/i18n/cultureInfo");return{init:u}}),define("services/i18n/swx/default",[],function(){return{splashScreen_text_logo_4b:"Skype for Business",splashScreen_text_loading:"Loading...",splashScreen_text_signingIn:"Signing in...",splashScreen_text_signingIn_wac:"Joining the chat...",splashScreen_signedOut_title:"Please sign in to get started.",splashScreen_signedOut_title_wac:"Please join the chat to get started.",splashScreen_disconnected_title:"You have been disconnected.",splashScreen_disconnected_description:"Please try to sign in again or refresh the page.",splashScreen_disconnected_description_wac:"Please try to join the chat again or refresh the page.",splashScreen_signInFailed_title:"We couldn't sign you in.",splashScreen_signInFailed_title_wac:"We couldn't join you to the chat.",splashScreen_signInFailed_title_security_validation:"Make video and voice calls with Skype for Web.",splashScreen_signInFailed_description:"Please try to sign in again or refresh the page.",splashScreen_signInFailed_description_wac:"Please try to join the chat again or refresh the page.",splashScreen_signInFailed_description_exceeded_endpoints:"Skype has exceeded number of endpoints allowed.",splashScreen_signInFailed_description_age_restriction:"Sorry, you can't use Skype due to age restrictions.",splashScreen_signInFailed_aad_description:"Please try to sign in again or refresh the page.",splashScreen_learn_more:"Learn more",splashScreen_signIn_button:"Sign in",splashScreen_signIn_button_wac:"Join the chat",splashScreen_signInExternal_button:"Sign in with a Microsoft account",unsupportedBrowser_title:"Please update your browser to start using Skype.",skypeUnavailable_title:"We're currently experiencing server issues. Skype is working on the issues and will be available again shortly.",aggressiveLinking_intro_title:"Say hello on Outlook",aggressiveLinking_intro_description:"You can now call and chat with Outlook contacts right from your inbox and best of all, it's free.",aggressiveLinking_intro_continue:"Continue",aggressiveLinking_intro_signin:"Already using Skype? {link_start}Sign in{link_end}",aggressiveLinking_intro_legal:"By continuing, you agree to {link_tou_start}Skype's Terms of Use{link_tou_end} and {link_privacy_start}Privacy Policy{link_privacy_end}.",input_placeholder_searchSkype:"Search Skype",input_searchSkype_ariaLabel:"Search conversation. Type contact or group name.",input_searchSkype_ariaLabel_4b:"Search conversation. Type contact name.",input_searchSkypeDirectory_ariaLabel:"Search Skype Directory",clear_search_input_label:"Clear search",button_text_newChat:"New Chat",button_text_new:"New",button_text_dialpad:"Call phones",input_text_skypeOut:"Enter name or number",input_text_skypeOut_short:"Enter number",clear_phonenumber_input_label:"Clear phone number",select_placeholder_skypeOut:"Choose country/region",label_text_participant:"{count} participant",label_text_participant_few:"{count} participants",label_text_participant_many:"{count} participants",area_text_insertText:"Type a message here",area_text_insertTextWithCommands:"Type a message here or {helpCommand} for the list of commands",area_text_agent_insertText:"Sorry, you can't reply right now",area_text_insertTextNonMember:"You have left this group.",label_text_insertText_oneToOne:"Chat input, conversation with {displayName}",label_text_insertText_group:"Chat input, conversation with {displayName}, {participantsCount} participants",label_text_conversationsLoading:"Loading recent conversations...",label_text_conversationsLoadNone:"No recent conversations",label_text_currentCallHeading:"Current call",label_text_openConversation:"Open conversation with {displayName}",label_text_from:"From: ",today:"today",yesterday:"yesterday",olderThanAWeek:"older than a week",duration_days:"{count} day",duration_days_few:"{count} days",duration_days_many:"{count} days",duration_hours:"{count} hour",duration_hours_few:"{count} hours",duration_hours_many:"{count} hours",duration_minutes:"{count} minute",duration_minutes_few:"{count} minutes",duration_minutes_many:"{count} minutes",duration_moment:"moment",content_search_conversation_title_days:"{count} day ago in <b>{conversationTitle}</b>",content_search_conversation_title_days_few:"{count} days ago in <b>{conversationTitle}</b>",content_search_conversation_title_days_many:"{count} days ago in <b>{conversationTitle}</b>",content_search_conversation_title_hours:"{count} hour ago in <b>{conversationTitle}</b>",content_search_conversation_title_hours_few:"{count} hours ago in <b>{conversationTitle}</b>",content_search_conversation_title_hours_many:"{count} hours ago in <b>{conversationTitle}</b>",content_search_conversation_title_minutes:"{count} minute ago in <b>{conversationTitle}</b>",content_search_conversation_title_minutes_few:"{count} minutes ago in <b>{conversationTitle}</b>",content_search_conversation_title_minutes_many:"{count} minutes ago in <b>{conversationTitle}</b>",content_search_conversation_title_moment:"moment ago in <b>{conversationTitle}</b>",content_search_header:"Messages",content_search_aria:"Conversation with {topic}.",content_search_additional_results:"Show more messages",contact_isSelected:"Selected",label_text_headerMenuRemoveGroup:"Remove from the group",label_text_headerMenuChat:"Chat",label_text_headerMenuInstantMessage:"Instant message",button_text_discover_agents:"Discover Bots",label_text_discover_agents_page_header:"Bots",label_text_discover_agents_page_hint:"Hint: Interact with Bots by clicking on them and adding them to your contacts.",label_text_discover_agents_page_zero_results_text_part_1:"It looks like you've already connected with all of the Bots. You can interact with them from the Contacts page or by searching for them.",label_text_discover_agents_page_zero_results_text_part_2:"We're always adding new Bots, so check back here soon.",label_text_contact_profile_details:"Contact Details",label_text_contact_profile_skype_name:"Skype",label_text_contact_profile_skype_for_business_name:"Skype for Business",label_text_contact_profile_information:"Information",label_text_contact_profile_location:"Location",label_text_contact_profile_birthday:"Birthday",label_text_contact_profile_gender:"Gender",label_text_contact_profile_language:"Language",label_text_contact_profile_agent_description:"Description",label_text_contact_profile_agent_author:"Author",label_text_contact_profile_agent_certification:"Certification",label_text_contact_profile_agent_rating:"Average Rating",label_text_view_profile_menu_item:"View Profile",label_text_agent_profile_label_agentid:"Bot",label_text_agent_profile_label_skype_certified:"Skype Certified",label_text_agent_profile_label_author:"Created by",label_text_agent_profile_label_description:"About",label_text_agent_profile_label_website:"Website",label_text_agent_profile_label_capabilities:"Capabilities",label_text_agent_profile_value_capabilities:"This bot is capable of sharing chat messages and photos.",label_text_agent_profile_label_privacy:"Privacy",label_text_agent_profile_value_privacy:"This bot will have access to your Display Name, Skype Name and any chat messages or content that you or other group participants share with it.",label_text_agent_profile_link_text_terms_of_service:"Terms of Service",label_text_agent_profile_link_text_privacy_statement:"Privacy Statement",label_text_agent_profile_label_rating:"Rating",label_text_blockContact:"Block contact",label_text_blockContact_with_name:"Block {name}",label_text_unblockContact:"Unblock contact",label_text_unblockContact_with_name:"Unblock {name}",label_text_deleteContact:"Delete contact",label_text_call_skype_audio:"Call Skype",label_text_call_skype_video:"Video call",label_text_send_message:"Send a message",label_text_call:"Call",label_text_call_phone_number:"Call ({phoneNumber})",label_text_call_phone_number_home:"Call Home ({phoneNumber})",label_text_call_phone_number_work:"Call Office ({phoneNumber})",label_text_call_phone_number_cell:"Call Mobile ({phoneNumber})",label_text_call_phone_number_type:"Call {phoneNumberType} ({phoneNumber})",label_text_phone_number_type_home:"Home",label_text_phone_number_type_work:"Office",label_text_phone_number_type_cell:"Mobile",label_text_phone_number_type_other:"Other",modal_blockContact_text_aria_label:"Block Contact",modal_blockContact_text_title:"Are you sure you want to block {displayName}?",modal_blockContact_text_message:"{displayName} will be blocked from your contacts and won't be able to contact you.",modal_blockContact_text_reportAbuse:"Report abuse from this person",modal_deleteContact_text_aria_label:"Delete Contact",modal_deleteContact_text_title:"Are you sure you want to delete {displayName}?",modal_deleteContact_text_message:"{displayName} will be removed from your contact list.",header_text_close:"Close",header_text_participantsOthersCanJoin:"{count} participant, others can join",header_text_participantsOthersCanJoin_few:"{count} participants, others can join",header_text_participantsOthersCanJoin_many:"{count} participants, others can join",header_text_shareThisGroup:"Share this group",header_text_groupSettings:"Group Settings",header_text_copyLink:"Copy link",header_text_copied:"Copied",header_text_inviteViaEmail:"Invite via email",header_text_adminSettings:"Manage group",header_text_makeHistoryAvailable:"Make chat history available to new joiners",header_text_joinViaLink:"Make a link for anyone to join",header_text_allowOthersToJoin:"Allow others to join with a link",header_text_othersCanJoin:"Others can join with a link",header_text_admin:"Admin",header_text_admin_4b:"Presenter",header_text_guest:"Guest",spaces_default_name:"Untitled conversation",spaces_tooltip_text:"Invite other people by sending them this link, even if they're not on Skype.",spaces_email_subject:"I'm ready to chat on Skype",spaces_joining_disabled_message_start:'Turn on <i>"Make a link for anyone to join"</i> from the ',spaces_joining_disabled_anchor_text:"profile ",spaces_joining_disabled_message_end:"to get a link you can share.",spaces_email_greeting:"Hello,",spaces_email_joinMe:"I've made a group on Skype for us to chat, share and collaborate.",spaces_email_link:"Join by click the link",spaces_welcomeTitle:"Your conversation is all set up",spaces_welcomeMessage:"Share photos, messages and much more with everyone here or invite even more people by sharing this link with them",spaces_welcomeMessageWithoutLink:"Share photos, messages and much more with everyone here",spaces_welcomeRenameBtnTitle:"Rename conversation",spaces_welcomeRenameBtnMessage:"Make your conversation unique",spaces_welcomeSettingsBtnTitle:"Settings",spaces_welcomeSettingsBtnMessage:"Manage your conversation",spaces_anyoneElse:"Anyone else? Send them a link",input_placeholder_addAnotherContact:"Add another contact",input_placeholder_typeContactName:"Type contact name",message_text_hasLeftConversation:"{participant} has left this conversation",message_text_wasRemovedFromConversation:"{participant} has removed {removedParticipant} from this conversation",message_text_youWereRemovedFromConversation:"You have been removed from this conversation",message_text_joinedConversation:"{participant} joined this conversation",message_text_joinConversationFailed:"{participant} could not join this conversation",message_text_meJoinedConversation_one:"{participant} is already chatting",message_text_meJoinedConversation_more:"{participants} and {participant} are already chatting",message_text_wasAddedToConversation:"{participant} added {contact} to this conversation",message_text_botWasAddedToConversation:"Bots added to this group have access to each participant's Skype Name, Display Name and any new chat messages or new content shared in the group.",message_text_roleUpdated:"{who} updated {whom}'s role to {role}",message_text_topicUpdated:"{participant} has changed the conversation topic to '{topic}'",message_text_threadPictureUpdated:"{participant} has changed the conversation picture",message_text_historyClosed:"Conversation history was closed by {participant}",message_text_historyDisclosed:"Conversation history was disclosed by {participant}",message_text_sentContacts:"Contacts sent to the conversation",message_text_receivedContacts:"Contacts received from {from}",message_text_contactItem:"<li>{fullName} ({name})</li>",message_text_joiningEnabled:"{participant} enabled joining this conversation",message_text_joiningDisabled:"{participant} disabled joining this conversation",message_text_legacyMemberAdded:"{participant} needs to update Skype to participate in this conversation. Help by sending them to http://www.skype.com/en/download-skype/skype-for-computer/",message_text_legacyMemberUpgraded:"{participant} can now participate in this conversation.",message_text_emptyConversation:"No history available for this conversation",message_text_startedCall:"Call",message_text_startedGroupCall:"Group call",message_text_endedCall:"Call ended",message_text_endedGroupCall:"Group call ended",message_text_outgoingCallNoAnswer:"Call, no answer",message_text_outgoingGroupCallNoAnswer:"Group call, no answer",message_text_missedCall:"Missed call",message_text_missedGroupCall:"Missed group call",message_text_unknownMessageType:"Unknown message type '{mesageType}'",message_text_fileTransferNotSupported:"Receiving files over P2P network is not supported on Skype for Web",message_text_parsing_error:"There was error during message parsing !",message_text_unsupportedVideoMessageYet:"Receiving video messages is not supported on Skype for Web",message_text_guestRemovedBySystem:"The guest account for {participant} has expired",message_text_pollsFeatureDisabled:"Sorry, Polls are not available at this moment. Please try again later. ",message_text_ngcUpgradeMessage_one:"<strong>{participant}</strong> was unable to join this call. They may need to come online, update Skype, or they're using an unsupported device. Find out more at {link}",message_text_ngcUpgradeMessage_many:"<strong>{participantList}</strong> and <strong>{lastParticipant}</strong> were unable to join this call. They may need to come online, update Skype, or they're using an unsupported device. Find out more at {link}",message_text_pluginFree_windowsUpdate_line1:"Update to the latest version of Windows 10 to enjoy instant calling in Microsoft Edge {update_link}.",message_text_pluginFree_windowsUpdate_line2:"Alternatively, you can install the Skype for Web plugin if you have not done so already.",message_text_pluginFree_screenSharingFallback_line1:"Screen sharing will be available shortly.",message_text_pluginFree_screenSharingFallback_line2:"Alternatively, switch to the Skype app for your device to receive screen sharing {upgrade_link}.",message_text_pluginFree_microphoneAccess_edge:"No microphone detected. Connect a microphone or check your microphone privacy settings in Settings -> Privacy -> Microphone.",message_text_pluginFree_microphoneAccess_others:"No microphone detected. Connect a microphone or check your microphone privacy settings for your device and browser.",message_text_pluginFree_outgoingP2P_line1:"The contact you are trying to call is using an out of date version of Skype. Send them this link to update Skype {upgrade_link}.",message_text_pluginFree_outgoingP2P_line2:"Alternatively, you can still contact them by first installing the Skype for Web plugin.",message_text_pluginFree_incomingP2P_line1:"A contact is trying to reach you using an out of date version of Skype. Send them this link to update Skype {upgrade_link}.",message_text_pluginFree_incomingP2P_line2:"Alternatively, you can receive their call by first installing the Skype for Web plugin.",message_text_pluginFree_noVideoCapability:"Sorry, video support is not yet available for this platform.",message_text_suggestedContactGreeting:"<strong>{displayName}</strong> is an address book contact, but needs you to connect first before chatting",message_text_suggestedContactConnectAction:"Connect on Skype",message_text_contactBlockedMessage:"You have blocked <strong>{displayName}</strong>",message_text_contactAccepted:"Contact accepted",message_text_addingContactRequest:"<strong>{id}</strong> wants to add you as a contact",message_text_isNowAContact:"<strong>{id}</strong> is now a contact",message_text_contactRequestGreeting:"Hi, {displayName}, I'd like to add you as a contact.",message_text_contactRequestIsNowContact:"<strong>{displayName}</strong> is now a contact",message_text_contactRequestOutgoingMessage:"<strong>{displayName}</strong> is not in your contacts",message_text_contactRequestOutgoingResendMessage:"Contact request sent",message_text_contactRequestOutgoingResendAction:"Resend contact request",message_text_contactRequestIncomingMessage:"<strong>{displayName}</strong> wants to add you as a contact",message_text_contactRequestSendAction:"add to contacts",message_text_contactRequestAcceptAction:"accept",message_text_contactRequestDeclineAction:"decline",message_text_unblockContact:"unblock",message_text_timeStampMessage:"Sent on: ",message_text_removed:"Removed on {date} at {time}",message_text_presenceAvailable:"Available",message_text_presenceNotAvailable:"Not available",message_text_contactTitleLocal:"People",message_text_contactTitleDirectory:"Directory",message_text_contactBlocked:"Blocked",button_translations_see_original_message:"See original",button_translations_see_translated_message:"See translation",button_translator_translatorSettings:"Skype Translator",label_translator_translatorSettings:"Translator preview",button_translator_translatorSettingsOn:"Switched on",button_translator_translatorSettingsOff:"Switched off",label_translator_translatorOn:"On",label_translator_translatorOff:"Off",label_translator_selected_theirLanguage:"Selected {language} for {name}",label_translator_selected_myLanguage:"Selected {language} for yourself",button_text_searchDirectory:"Search Skype Directory",message_text_emptySearchResults:"No results found",message_text_groupSearchResultsTitle:"Groups",message_title_allContacts:"All contacts",message_bucketName_other:"#",message_not_delivered_text:"This message has not been delivered",message_more_search_results_available:"Too many results; try refining your search",label_text_newConv:"New",newbee_text_header:"Get the conversation started",newbee_text_cta:"Find your friends by entering their name or email in the Search Skype field.",newbee_text_cta_4b:"Find your co-workers by entering their name in the Search field.",contactPage_text_menuLink:"Contacts",contactPage_text_header:"Contacts",contactPage_text_tab_allContacts:"All contacts",contactPage_text_tab_available:"Available",contactPage_text_tab_work:"Work",contactPage_text_tab_agents:"Bots",contactPage_text_hint_search:"Hint: you can add new contacts by searching",contactPage_text_manage_contacts_button:"Manage Contacts",contactPage_text_informational_message:"Get the full meeting experience with the Skype for Business app.",settings_page_text_header:"Settings",settings_messaging_category_title:"Messaging",settings_privacy_category_title:"Privacy",settings_unlisted_category_title:"Unlisted",settings_contacts_category_title:"Contacts",settings_about_category_title:"About",settings_unknownOption_title:"Unknown option: {id}",settings_unknownOption_alt_text:"Unknown option: {id}",settings_mentionsEnabled_title:"@mention notifications",settings_mentionsEnabled_alt_text:"Always notify me when someone mentions me on Skype. (@&lt;username&gt;)",settings_youtube_player_title:"YouTube player",settings_youtube_player_alt_text:"Use YouTube player directly to preview videos I send or receive.",settings_urlPreview_title:"Web link previews",settings_urlPreview_alt_text:"Show me a preview of websites I send or receive on Skype.",settings_filePaste_title:"Enable image paste",settings_filePaste_alt_text:"Enable pasting of images from clipboard directly into the chat",settings_skypeCallPolicy_title:"Allow calls from:",settings_skypeVideoPolicy_title:"Allow video and screen sharing from:",settings_typingIndicator_title:"Typing indicator",settings_typingIndicator_alt_text:"Show when I am typing",settings_translator_title:"Translator",settings_translator_title_alt_text:"Enable Skype Translator",settings_notifications_title:"Chat notifications",settings_notifications_alt_text:"Turn on or off chat notifications",settings_sendReadReceipts_title:"Send read receipts",settings_sendReadReceipts_alt_text:"Show when other people have read your messages. When turned off, you also won't see their read receipts either.",settings_privacy_opt_1_title:"Anyone",settings_privacy_opt_2_title:"Contacts only",settings_privacy_opt_3_title:"Nobody",settings_short_circuit_my_contact_list:"My contact list",settings_short_circuit_title:"Automatically add friends",settings_short_circuit_description:"Skype will check your address books and automatically add people you know to your Skype Contact list.",settings_short_circuit_deny:"Don't automatically add friends",settings_short_circuit_deny_title:"You'll need to manually find and add new contacts.",settings_short_circuit_manage_contacts:"Manage address books",settings_short_circuit_auto_buddy_discovery_title:"How people find me:",settings_short_circuit_auto_buddy_discovery_description:"These contact details can be used to find you on Skype",settings_short_circuit_remove:"Remove",settings_short_circuit_add_number:"Add new number",short_circuit_contacts_page_message:"Quickly add people from your address book",short_circuit_contacts_page_cta:"Add friends",about_app_version:"App version",about_assets_version:"Assets version",about_plugin_version:"Plugin version",about_faq:"Frequently asked questions",message_text_callingNotSupportedBrowser:"Audio and video calls are not supported on your browser",message_text_callingNotSupportedOS:"Audio and video calls are not supported on your OS",message_text_callingIsDisabled:"Calling is currently disabled.",chatLogmenuItem_text_quote:"Quote Message",chatLogmenuItem_text_edit:"Edit Message",chatLogmenuItem_text_remove:"Remove Message",chatLogmenuItem_text_like:"Like Message",chatLogmenuItem_text_save:"Save",chatLogmenuItem_copy_link:"Copy link",chatLogmenuItem_open_link:"Open",chatLogIntroText_text:"Chat with people editing this file in Office Online. | This chat won't be saved when you close the file.",recentItemMenuItem_text_leave:"Leave conversation",recentItemMenuItem_text_remove:"Delete conversation",recentItemMenuItem_text_remove_4b:"Close conversation",actionsMenuItem_text_addParticipants:"Add participants",actionsMenuItem_text_scheduleCall:"Schedule a call",typingIndicator_label_oneParticipant:"{firstParticipantName} is typing...",typingIndicator_label_twoParticipants:"{firstParticipantName} and {secondParticipantName} are typing...",typingIndicator_label_multipleParticipants:"{firstParticipantName}, {secondParticipantName} and {count} other are typing...",typingIndicator_label_multipleParticipants_few:"{firstParticipantName}, {secondParticipantName} and {count} others are typing...",typingIndicator_label_multipleParticipants_many:"{firstParticipantName}, {secondParticipantName} and {count} others are typing...",button_text_emoticons:"Emoticons",button_title_emoticons:"Emoticons",button_text_videoCall:"Video Call",button_text_audioCall:"Audio Call",button_text_joinCall:"Join Call",button_text_addParticipants:"Add",button_text_cancelAddParticipants:"Cancel",button_text_createConversation:"Create",button_title_more:"More",button_text_filePicker:"Share a photo",button_text_chatInputActionPicker:"Send Files and Media",button_text_poll:"Send a poll",button_text_moreActions:"More actions",callScreen_text_terminationPrompt:"You're currently in a call, are you sure you want to hang up and close Skype?",callscreen_text_terminationMessage:"Call ended",callscreen_text_autoCallConnectingMessage:"Waiting for others to join...",callscreen_text_autoCallTimeoutMessage:"Looks like you're the only one here, try joining the call again later",callscreen_text_autoCallFailedMessage:"Unable to set up call, please try again later",callscreen_text_statusMessageConnecting:"Connecting...",callscreen_text_statusMessageScreenReaderConnecting:"Connecting to {contactName}",callscreen_text_statusMessageScreenReaderEnding_less_than_minute:"Call has ended, duration less than a minute",callscreen_text_statusMessageScreenReaderEnding_minutes:"Call has ended, duration {count} minute",callscreen_text_statusMessageScreenReaderEnding_minutes_few:"Call has ended, duration {count} minutes",callscreen_text_statusMessageScreenReaderEnding_minutes_many:"Call has ended, duration {count} minutes",callscreen_text_participant_joined_notification:"{name} joined",callscreen_text_participant_left_notification:"{name} left",callscreen_text_participant_screen_shared_notification:"{name} has started sharing their screen",callscreen_text_participant_screen_unshared_notification:"{name} has stopped sharing their screen",callscreen_text_statusMessageCalling:"Calling...",callscreen_text_enterFullscreen:"Enter fullscreen mode",callscreen_text_exitFullscreen:"Exit fullscreen mode",callscreen_text_videoOn:"Turn video on",callscreen_text_videoOff:"Turn video off",callscreen_text_plusButton:"Add participants, share screens and more",callscreen_text_shareScreens:"Share screens...",callscreen_text_shareScreen:"Share screen",callscreen_text_stopSharingScreen:"Stop sharing screen",callscreen_text_addParticipants:"Add people to this call",callscreen_text_microphoneOn:"Turn microphone on",callscreen_text_microphoneOff:"Turn microphone off",callscreen_text_endCall:"End call",callscreen_text_participants:"{count} in the call",callscreen_text_showChat:"Show IM",callscreen_text_showContacts:"Show contacts",callscreen_text_hangUp:"Hang up",callscreen_text_addParticipantsToCall:"Add people to this call",callScreen_text_andMore:"and more",callscreen_text_dialpadOn:"Turn dialpad on",callscreen_text_dialpadOff:"Turn dialpad off",callscreen_title_zoom:"Double-click to zoom",toast_incoming_text_title:"Incoming call",toast_incoming_text_acceptWithVideo:"Accept with video",toast_incoming_text_acceptWithAudio:"Accept with audio",toast_incoming_text_reject:"Reject call",toast_install_text_title:"is trying to call you",toast_install_text_installButton:"Install plugin",toast_install_text_message:"You'll need a plugin to make Skype calls",pluginInstall_main_close_screen_title:"Are you sure you want to leave?",pluginInstall_main_close_screen_subtitle:"You're almost done setting up Skype calling.",pluginInstall_main_close_screen_finish_text:"Finish setup",pluginInstall_main_close_screen_leave_text:"Leave",pluginInstall_extension_main_text_title:"Enable Skype calls in a few simple steps...",pluginInstall_extension_main_text_subtitle:"Start by adding Skype Calling extension to Chrome",pluginInstall_extension_main_text_add_extension:"Add extension",pluginInstall_extension_main_installed_text_title:"Great!",pluginInstall_extension_main_installed_text_subtitle:"Now install Skype for Web plugin and you're all set",pluginInstall_extension_main_installed_get_plugin_text:"Get plugin",pluginInstall_extension_main_install_failed_text_title:"Oops, something went wrong",pluginInstall_extension_main_install_failed_text_subtitle:"Let's try again...",pluginInstall_extension_main_install_failed_go_to_chrome_webstore_text:"Go to the Chrome web store",pluginInstall_main_text_close:"Close",pluginInstall_main_text_title:"Want to make a call?",pluginInstall_main_text_subtitle:"You need to install the plugin to make Skype calls",pluginInstall_main_text_install:"Install plugin",pluginInstall_steps_text_restart:"Restart",pluginInstall_steps_text_title:"Let's install the plugin.",pluginInstall_steps_text_subtitle:"Simply follow these three steps to set up Skype calls",pluginInstall_steps_text_termsAndPrivacy:"By installing the Skype Plugin, you agree that you have read and accepted Skype's {terms_link} and {privacy_link}.",pluginInstall_steps_text_termsLink:"Terms of Use",pluginInstall_steps_text_privacyLink:"Skype's privacy policy",pluginInstall_mac_chrome_text_download:"Click on the plugin file.",pluginInstall_mac_chrome_text_install:"Follow the instructions.",pluginInstall_mac_chrome_text_enjoy:"Enjoy free Skype calls.",pluginInstall_mac_safari_text_download:"Go to downloads, then double-click on the plugin file.",pluginInstall_mac_safari_text_install:"Follow the instructions to install the plugin.",pluginInstall_mac_safari_text_enjoy:"Enjoy making free Skype calls from the web.",pluginInstall_mac_firefox_text_download:"Open the plugin file.",pluginInstall_mac_firefox_text_install:"Follow the instructions.",pluginInstall_mac_firefox_text_enjoy:"Enjoy free Skype calls.",pluginInstall_mac_unknown_download:"Go to downloads, then double-click on the plugin file.",pluginInstall_mac_unknown_install:"Follow the instructions to install the plugin.",pluginInstall_mac_unknown_enjoy:"Enjoy making free Skype calls from the web.",pluginInstall_windows_chrome_text_download:"Click on the plugin file.",pluginInstall_windows_chrome_text_install:"Wait for the plugin to install.",pluginInstall_windows_chrome_text_enjoy:"Enjoy free Skype calls.",pluginInstall_windows_msie_text_download:'Click on "Run" to get started.',pluginInstall_windows_msie_text_install:"Wait for the plugin to install.",pluginInstall_windows_msie_text_enjoy:"Enjoy free Skype calls.",pluginInstall_windows_firefox_text_download:'Click "Save File" to get started.',pluginInstall_windows_firefox_text_install:"Click on the plugin file.",pluginInstall_windows_firefox_text_enjoy:"Enjoy free Skype calls.",pluginInstall_windows_unknown_text_download:'Click on "Run" to get started.',pluginInstall_windows_unknown_text_install:"Wait for the plugin to install.",pluginInstall_windows_unknown_text_enjoy:"Enjoy free Skype calls.",pluginInstall_unblock_text_title:"Enable Skype Plugin",pluginInstall_unblock_text_chrome_subtitle:'Please click on the plugin icon in the address bar and select "Always allow plug-ins on web.skype.com" to continue with this call.',pluginInstall_unblock_text_firefox_subtitle:'Please click on the plugin icon in the address bar and select "Allow and Remember" to continue with this call.',pluginInstall_callback_text_title:"Call {displayName}",pluginInstall_callback_text_subtitle:"Your plugin is now installed, so you're good to start calling now",pluginInstall_callback_text_call:"Call",pluginInstall_callback_text_notNow:"Not now",pluginInstall_label_text_start:"Plugin Install - Start",pluginInstall_label_text_download:"Plugin Install - Download",pluginInstall_label_text_unblock:"Plugin Install - Unblock Skype Plugin",pluginInstall_label_text_continue:"Plugin Install - Continue Call",pluginInstall_label_text_autoUpdateDisclaimer:"This plugin will automatically update to give you the best experience. If you don't want the updates, please do not install the plugin.",notification_text_osNotSupported:"Missed call from {callerName}. Audio and video calls are not supported on this operating system.",notification_text_browserNotSupported:"Missed call from {callerName}. You are currently using an unsupported browser.",notification_text_learnMore:"Learn more",notification_text_hardware_camera:"Camera not found",notification_text_hardware_mic:"Microphone not found",notification_text_hardware_speaker:"Speaker not found",notification_text_group_conversation_from:"Group conversation from",notification_text_avatar_not_supported_image_type:"The image type you tried to upload is not supported",notification_text_avatar_upload_error:"Unable to change your profile picture, please try again.",media_clicktoplay:"Click to play",media_picturesharing_one:"shared a photo",media_picturesharing_group:"{senderName} shared a photo",media_picturesharing_label:"Open photo in a new window",media_videosharing_one:"shared a video",media_videosharing_group:"{senderName} shared a video",media_videomessage_expired:"Video message has expired",videoPlayer_play:"Play",videoPlayer_pause:"Pause",videoPlayer_fullscreen:"Fullscreen",videoPlayer_exitFullscreen:"Exit fullscreen",action_button_confirm:"Confirm",action_button_cancel:"Cancel",action_button_save:"Save",action_button_block:"Block",action_button_delete:"Delete",action_button_delete_4b:"Close",action_button_send:"Send",action_button_share_conversation:"Share conversation",action_button_leave:"Leave",media_mojisharing_one:"shared a Moji",media_mojisharing_group:"{senderName} shared a Moji",emoticonPicker_heading_label:"Choose an emoticon",accessibility_recentItem_oneToOne:"Conversation with {topic}. Press Shift + F ten for more options.",accessibility_recentItem_oneToOne_many:"Conversation with {topic}. Press Shift + F ten for more options.",accessibility_recentItem_oneToOne_unread:"Conversation with {topic}, {count} unread message. Press Shift + F ten for more options.",accessibility_recentItem_oneToOne_unread_many:"Conversation with {topic}, {count} unread messages. Press Shift + F ten for more options.",accessibility_recentItem_group_unread:"Group conversation with {count} unread message {topic}. Press Shift + F ten for more options.",accessibility_recentItem_group_unread_many:"Group conversation with {count} unread messages {topic}. Press Shift + F ten for more options.",accessibility_recentItem_group:"Group conversation {topic}. Press Shift + F ten for more options.",accessibility_recentItem_group_many:"Group conversation {topic}. Press Shift + F ten for more options.",accessibility_chatLog_newMessage:"New message from {author}, {content}",accessibility_searching:"Searching",accessibility_searchItem_oneToOne:"{contactName}, {id}, {status}, {index} of {totalResults} in People.",accessibility_searchItem_group:"Group {groupName}, {index} of {totalResults} in Groups.",accessibility_searchItem_group_displayMessage:"Group {groupName}, {displayMessage}, {index} of {totalResults} in Groups.",accessibility_searchItem_directoryList:"{contactName}, {id}, {status}, {index} of {totalResults} in the Skype Directory.",accessibility_localSearchUpdated:"Search updated and {totalSearchResults} result found in your contacts and groups. {peopleSearchResults} in people and {groupsSearchResults} in Groups.",accessibility_localSearchUpdated_few:"Search updated and {totalSearchResults} results found in your contacts and groups. {peopleSearchResults} in people and {groupsSearchResults} in Groups.",accessibility_localSearchUpdated_many:"Search updated and {totalSearchResults} results found in your contacts and groups. {peopleSearchResults} in people and {groupsSearchResults} in Groups.",accessibility_localSearchUpdated_4b:"Search updated and {totalSearchResults} result found in your contacts.",accessibility_localSearchUpdated_4b_few:"Search updated and {totalSearchResults} results found in your contacts.",accessibility_localSearchUpdated_4b_many:"Search updated and {totalSearchResults} results found in your contacts.",accessibility_localSearchNoResults:"Search updated and no results found in your contacts and groups.",accessibility_localSearchNoResults_4b:"Search updated and no results found in your contacts.",accessibility_searchSkypeDirectory:"Press enter to search the Skype Directory.",accessibility_clearSearchField_ariaLabel:"Clear search input field.",accessibility_skypeDirectorySearchUpdated:"Search updated and {totalSearchResults} result found in the Skype Directory.",accessibility_skypeDirectorySearchUpdated_few:"Search updated and {totalSearchResults} results found in the Skype Directory.",accessibility_skypeDirectorySearchUpdated_many:"Search updated and {totalSearchResults} results found in the Skype Directory.",accessibility_totalSearchUpdated:"Search updated and {totalSearchResults} result found. {peopleSearchResults} in people, {groupsSearchResults} in groups and {SkypeDirectorySearchResults} in the Skype Directory.",accessibility_totalSearchUpdated_few:"Search updated and {totalSearchResults} results found. {peopleSearchResults} in people, {groupsSearchResults} in groups and {SkypeDirectorySearchResults} in the Skype Directory.",accessibility_totalSearchUpdated_many:"Search updated and {totalSearchResults} results found. {peopleSearchResults} in people, {groupsSearchResults} in groups and {SkypeDirectorySearchResults} in the Skype Directory.",accessibility_totalSearchNoResults:"Search updated and no results found in your contacts, groups and the Skype Directory.",accessibility_contactProfile_headingWithClosedProfile:"Conversation with {topic}. Open {topic}'s profile.",accessibility_contactProfile_headingWithOpenedProfile:"Conversation with {topic}. Close {topic}'s profile.",accessibility_groupProfile_headingWithClosedProfile:"Group chat:{topic}. Open group profile.",accessibility_groupProfile_headingWithOpenedProfile:"Group chat:{topic}. Close group profile.",accessibility_groupProfile_attendeeMenu:"{participantName}. More options.",accessibility_groupProfile_adminMenu:"{participantName}, admin. More options.",accessibility_groupProfile_guestMenu:"{participantName}, guest. More options.",accessibility_groupProfile_historyToggle_on:"Make chat history available to new joiner. On.",accessibility_groupProfile_historyToggle_off:"Make chat history available to new joiner. Off.",accessibility_groupProfile_joiningToggle_on:"Allow people to join this group via link. On.",accessibility_groupProfile_joiningToggle_off:"Allow people to join this group via link. Off.",accessibility_me_expandProfile:"Expand profile",accessibility_me_collapseProfile:"Collapse profile",accessibility_me_availabilityOnAriaLabel:"Online presence set to available (notifications on)",accessibility_me_availabilityOffAriaLabel:"Online presence set to not available (notifications off)",accessibility_addPeopleToConversation_ariaLabel:"Add people to this conversation",addPeopleToConversation_tooltip:"Add people",accessibility_startVideoCall_ariaLabel:"Video call",startVideoCall_tooltip:"Video call",accessibility_startCall_ariaLabel:"Call",videoCallDisabled_tooltip:"You can't make video calls to {agentName}",startCall_tooltip:"Call",accessibility_startGroupCall_ariaLabel:"Call group",callDisabled_tooltip:"You can't make calls to {agentName}",startGroupCall_tooltip:"Call group",turnOffChatNotifications_tooltip:"Turn off chat notifications",turnOnChatNotifications_tooltip:"Turn on chat notifications",giveFeedback_tooltip:"Give feedback",giveFeedback_subject:"Feedback for Skype on the web",giveFeedback_body:"If you're experiencing a problem or have feedback to share with the Skype team, please let us know below.",giveFeedback_button_label:"Feedback",conversationHeader_heading_ariaLabel:"Conversation with {topic}.",groupProfile_spacesLink_ariaLabel:"Link to this group chat: {spacesUrl}",conversation_header_topic_default:"Untitled",conversation_header_topic_untitled_conversation:"Untitled conversation",conversation_header_topic_people_chatting:"{count} person is available",conversation_header_topic_people_chatting_few:"{count} people are available",conversation_header_topic_people_chatting_many:"{count} people are available",message_text_presenceActive:"Active",message_text_presenceActiveMobile:"Active on mobile",message_text_presenceAway:"Away",message_text_presenceBusy:"Busy",message_text_presenceDoNotDisturb:"Do not disturb",message_text_presenceUnknown:"Presence unknown",message_text_activity_inAMeeting:"In a meeting",message_text_activity_urgentInterruptionsOnly:"Urgent interruptions only",message_text_activity_onThePhone:"On the phone",message_text_activity_inAConference:"In a conference",message_text_activity_offWork:"Off work",message_text_activity_outOfOffice:"Out of office",message_text_activity_presenting:"Presenting",expressionPicker_prevPage:"Previous tabs",expressionPicker_nextPage:"Next tabs",expressionPicker_mruTab_title:"Most Recently Used",expressionPicker_mruTab_ariaLabel:"Most Recently Used",expressionPicker_mruTab_emptyText:"Recently used items will appear here.",expressionPicker_tab_emptyText:"This tab is empty",expressionPicker_bingTab_title:"Bing",expressionPicker_bingTab_ariaLabel:"Search with Bing for images",expressionPicker_bingTab_emptyText:"Bing results appear here",expressionPicker_bingTab_loadingText:"Loading...",expressionPicker_bingTab_errorText:"An error has occurred! Please try again later",expressionPicker_bingPack_title:"Bing search results",expressionPicker_bingPack_ariaLabel:"Bing search results",expressionPicker_bingGifsPack_title:"Popular Gifs from Bing",expressionPicker_bingMemePack_title:"Popular Memes from Bing",expressionPicker_bingGifsPack_ariaLabel:"Popular Gifs from Bing",expressionPicker_bingMemePack_ariaLabel:"Popular Memes from Bing",expressionPicker_giphyImgTab_title:"Search Giphy",expressionPicker_giphyImgTab_ariaLabel:"Search for animated GIFs. Powered by Giphy",expressionPicker_giphyImgTab_emptyText:"Giphy results appear here",expressionPicker_giphyImgTab_loadingText:"Loading...",expressionPicker_giphyImgTab_errorText:"An error has occurred! Please try again later",expressionPicker_giphyImgPack_title:"Giphy search results",expressionPicker_giphyImgPack_ariaLabel:"Giphy search results",input_placeholder_searchPESItems:"Search for items...",input_searchPESItems_ariaLabel:"Search items. Type keyword",expressionPicker_localSearchTab_title:"Search",expressionPicker_localSearchTab_emptyText:"Find emoticons and mojis",expressionPicker_localSearchPack_title:"Quick suggestions",expressionPicker_localSearchPack_ariaLabel:"Quick suggestions",expressionPicker_mruEmoticonPack_title:"Emoticons",expressionPicker_mruEmoticonPack_ariaLabel:"Emoticons",expressionPicker_mruMojiPack_title:"Mojis",expressionPicker_mruMojiPack_ariaLabel:"Mojis",expressionPicker_store_title:"Skype Expression Store",expressionPicker_store_free:"Free",expressionPicker_storeTab_title:"Store",expressionPicker_store_Downloaded:"Downloaded",expressionPicker_store_Downloading:"Downloading...",expressionPicker_store_removeTab:"Remove",input_placeholder_searchPESStore:"Search",poll_designer_question_placeholder:"Ask a question...",poll_designer_answer_placeholder:"Add option...",poll_message_question_header:"Poll: {pollQuestion}",poll_message_goto_text:"Go to {fallbackLink} to vote.",poll_message_people_voted:"{count} people voted",poll_sticky_message_new_poll:"Ongoing poll by {author}: ",poll_sticky_message_me_voted:"My vote: {answerText}",poll_sticky_message_me_not_voted:"Click to vote",poll_fallback_link_text:"Skype for Web",poll_list_title:"Voted by ({count})",presence_lastseen_moments:"Last seen moments ago",presence_lastseen_minutes:"Last seen {number}m ago",presence_lastseen_hours:"Last seen {number}h ago",presence_lastseen_days:"Last seen {number}d ago",presence_lastseen_date_short:"Last seen {shortdate}",presence_lastseen_date_full:"Last seen {fulldate}",guest_user_displayname:"{displayName} (Guest)",pes_featured_title:"Featured",pes_moji_playbutton_label:"Click to play",label_jumpToConversation:"Jump to conversation",share_on_skype_dialog_title:"Share on Skype",share_on_skype_share_button:"Share",share_on_skype_alt_text_button:"Share on Skype",share_on_skype_message_prompt:"Include a message about this...",share_on_skype_picker_prompt:"Search or select...",share_on_skype_status_sending:"Sending...",share_on_skype_status_sent:"Sent",share_on_skype_signed_in_as:"Signed in as {displayName}",share_on_skype_my_account:"My Account",share_on_skype_sign_out:"Sign out",file_transfer_file_shared:"shared a file",file_transfer_share_file:"Share a File",file_transfer_send_photos_and_files:"Send Photos and Files",file_transfer_download_button_title:"Download file {filename}",file_transfer_download_dialog_confirm_button_title:"Accept",file_transfer_download_unsafe_file_dialog_title:"Warning - this file may be unsafe for your computer/device.",file_transfer_download_unsafe_file_dialog_text:"Do you want to accept the file {filename} from {author}?",file_transfer_download_safe_file_dialog_title:"Only accept files from people you trust.",file_transfer_download_safe_file_dialog_text:"Do you want to accept the file {filename} from {author}?",file_transfer_download_dialog_do_not_ask_checkbox:"Do not ask me again",file_transfer_upload_state:"{uploaded} of {size}",file_transfer_upload_completed:"File {filename} has been uploaded",file_transfer_upload_failed:"Cannot upload file",file_transfer_upload_canceled:"Upload canceled",file_transfer_upload_cancel:"Cancel uploading",file_transfer_upload_too_large_warning:"Not sent - File is larger than 100MB. <a href='http://go.skype.com/Cloud.File.Upload' target='_blank'>Learn more</a>",file_transfer_upload_starting:"Starting upload",file_transfer_upload_not_supported:"Sharing files is not supported on Skype for Web",notificationsPage_text_menuLink:"Notifications",remove_conversation_confirmation_text:"All the messages in this conversation will be deleted and it will be removed from both the sidebar and your history.",remove_conversation_confirmation_text_4b:"You will be leaving this conversation and it will be removed from the sidebar.",remove_conversation_confirmation_title:"Are you sure you want to delete this conversation?",remove_conversation_confirmation_title_4b:"Are you sure you want to close this conversation?",leave_conversation_confirmation_text:"This action cannot be undone.",leave_conversation_confirmation_text_4b:"You won't receive any more notifications from this conversation. You can later rejoin by sending a new message.",leave_conversation_confirmation_title:'Are you sure you want to leave "{topic}"?',leave_conversation_confirmation_title_4b:"Are you sure you want to leave the conversation?",contact_information_already_contact:"Already a contact",contact_information_add_to_contacts:"Add to contacts",mediaBar_sendContacts_label:"Send contacts...",contactPicker_sendContacts_title:"Send contacts",contactPicker_sendContacts_OKBUtton:"Send",chat_contactSent_label:"Contact sent",chat_contactSent_iconLabel:"Sent",mention_notification_title:"{participant} mentioned you in {chat}",contextMenu_picture_viewAction:"View",contextMenu_picture_commentAction:"Comment",contextMenu_picture_downloadAction:"Download",contextMenu_text_discussAction:"Discuss",send_contacts_action_title:"Send Contacts",send_contacts_action_text:"Add contacts you would like to send",invite_free_overlay_greeting:"Say hello to",invite_free_bubble_contact:"Type a message here",invite_free_bubble_non_contact:"Type a message here, then wait for a reply.",invite_free_textarea_waiting_for_reply:"Waiting for a reply...",invite_free_message_received:"<strong>{displayName}</strong> sent you a message",invite_free_message_received_location:"<strong>{displayName}</strong> sent you a message from {location}",invite_free_block_person:"Block this person",invite_free_respond_request:"Type any message to accept this contact",me_pluginLinkText:"Download Skype plugin",me_accountLinkText:"Account",me_accountSignOutLinkText:"Sign out",me_pendingPresence:"Getting status...",me_avatar_uploadProfilePictureText:"Upload a profile picture",me_avatar_uploadProfilePictureAriaLabel:"Upload avatar",accessibility_me_changePresenceStatusAriaLabel:"Change your online status",message_sent_status:"Sent",message_sending_status:"Sending",message_delivered_status:"Delivered",message_read_status:"Read",message_failed_status:"Failed",credit_balance_text:"Your Skype Credit",credit_purchase_link_text:"Add Skype Credit",subscription_entitlement_text:"Subscriptions",subscription_purchase_link_text:"Get a subscription",no_subscriptions_text:"You have no subscriptions",subscriptions_text_one:"You have {count} subscription",subscriptions_text_many:"You have {count} subscriptions",pstn_emergency_notice_text:"Skype for Web (Beta) is not a replacement for your telephone and can't be used for emergency calling.",pstn_insufficient_funds:"Call failed - you need {credit} or {subscription} to call landlines and mobiles from Skype.",pstn_insufficient_funds_credit:"Skype Credit",pstn_insufficient_funds_subscription:"a subscription",pstn_invalid_number:"The number you have dialed is invalid.",pstn_invalid_number_return_link:"Return to Call phones and try again.",pstn_forbidden_number:"The number you have dialed cannot be reached using Skype.",pstn_insufficient_funds_group:"A participant {phoneNumber} was unable to join the call - you need {credit} or {subscription} to add them to the call.",pstn_insufficient_funds_group_name:"A participant {displayName} ({phoneNumber}) was unable to join the call - you need {credit} or {subscription} to add them to the call.",pstn_invalid_number_group:"A participant {phoneNumber} was unable to join the call - the number is invalid.",pstn_invalid_number_group_name:"A participant {displayName} ({phoneNumber}) was unable to join the call - the number is invalid.",pstn_forbidden_number_group:"A participant {phoneNumber} was unable to join the call - the number cannot be reached using Skype.",pstn_forbidden_number_group_name:"A participant {displayName} ({phoneNumber}) was unable to join the call - the number cannot be reached using Skype.",hearts_bubble_title:"Who liked this",hearts_bubble_meliked:"You",hearts_loved_by:"{list}",hearts_loved_by_count:"Loved by {count}",hearts_loved_by_others:"Loved by {list} and <span>{count}&nbsp;others</span>",hearts_list_title:"Liked by ({count})",hearts_me_text:"You",hearts_like_byMeOnly:"You like this",hearts_like_byOne:"{participantName} likes this",hearts_like_byFew:"{participantFirst}{list} and {participantLast} like this",hearts_like_byMany:"{participantlist} and <span>{count}&nbsp;others</span> like this",hearts_notification_messageGroup:"{participantName} likes your message {messageText}",hearts_notification_messageConv:"likes your message {messageText}",hearts_notification_photoGroup:"{participantName} likes your photo",hearts_notification_photoConv:"likes your photo",hearts_notification_fileGroup:"{participantName} likes your file",hearts_notification_fileConv:"likes your file",hearts_notification_documentGroup:"{participantName} likes your document",hearts_notification_documentConv:"likes your document",hearts_notification_videoMessageGroup:"{participantName} likes your video message",hearts_notification_videoMessageConv:"likes your video message",hearts_notification_urlGroup:"{participantName} likes your url",hearts_notification_urlConv:"likes your url",hearts_notification_youTubeGroup:"{participantName} likes your YouTube video",hearts_notification_youTubeConv:"likes your YouTube video",hearts_accessibility_like:"Like message",hearts_accessibility_unlike:"Unlike message",hearts_toast_message:"new",hearts_toast_title:"click to navigate to the liked message",me_notificationsOn:"Notifications on",me_notificationsOff:"Notifications off",education_bubble_search:"Find people to call or chat with - search by email or Skype Name.",education_bubble_search_4b:"Find people to call or chat with - search by email or name.",education_bubble_call:"Select the camera button to start a video call.",education_bubble_chat:"Choose a contact to start a chat or call.",education_bubble_chat_4b:"Choose a contact to start a chat.",education_bubble_schedule_call_1:"Schedule your next call with {name} here.",education_bubble_schedule_call_1_group:"Stay in touch, schedule your next call here.",schedule_call_new_conversation_topic:"Skype call",schedule_call_subject_text:"Skype call with {topic}",welcomeDialog_header:"Welcome to Skype for Web (Beta)",welcomeDialog_getInTouch:"Get in touch with your friends and family directly from your browser",welcomeDialog_sendIM:"Send instant messages",welcomeDialog_makeCalls:"Make Skype calls",welcomeDialog_makeVideoCalls:"Make video calls",welcomeDialog_getStarted_button:"Get started",welcomeDialog_notForEmergencyCalls:"Skype for Web (Beta) is not a replacement for your telephone and can't be used for emergency calling.",welcomeDialog_cookiesConsent:"By using this site you agree to the use of cookies for analytics, personalised content and ads.",welcomeDialog_readMore:"Read more about cookies",modal_scheduleCall_getting_ready_label:"Getting your call ready...",modal_scheduleCall_ready_label:"Your call is ready to be scheduled.",modal_scheduleCall_create_event_button:"Create event",modal_scheduleCall_close_button:"Close",cqf_title:"How would you rate the quality of this call?",cqf_audio_title:"Tell us about any audio issues you experienced. We'll use the feedback to improve Skype.",cqf_video_title:"Tell us about any audio or video issues you experienced. We'll use the feedback to improve Skype.",cqf_audio_tokens_title:"Audio",cqf_video_tokens_title:"Video",cqf_audio_nolocal:"I could not hear any sound",cqf_audio_noremote:"The other side could not hear any sound",cqf_audio_quality_echo:"I heard echo in the call",cqf_audio_quality_noise:"I heard noise in the call",cqf_audio_quality_volume:"Volume was low",cqf_audio_dropped:"The call ended unexpectedly",cqf_audio_quality_distorted:"Speech was not natural or sounded distorted",cqf_audio_quality_delay:"We kept interrupting each other",cqf_audio_other:"Other, please specify",cqf_audio_quality_dialpad:"Dial pad tones did not work",cqf_video_nolocal:"I could not see any video",cqf_video_noremote:"The other side could not see my video",cqf_video_quality_poor:"Image quality was poor",cqf_video_quality_freezing:"Video kept freezing",cqf_video_dropped:"Video stopped unexpectedly",cqf_video_quality_dark:"The other side was too dark",cqf_video_quality_sync:"Video was ahead or behind audio",cqf_video_other:"Other, please specify",favorites_recents_category_name:"Favorites",favorites_add_to_favorite:"Add to Favorites",favorites_remove_from_favorite:"Remove from Favorites"}}),define("bindings/ko.businessAwareL10n",["require","vendor/knockout","constants/common","services/serviceLocator"],function(e){function i(){t.bindingHandlers.businessAwareL10n={update:function(e,n,r,i,o){var u=t.utils.unwrapObservable(n());if(s()){var a=u.key;u.key=a+"_4b"}t.bindingHandlers.l10n.update(e,function(){return u},r,i,o)}}}function s(){return r.resolve(n.serviceLocator.FEATURE_FLAGS).isFeatureOn(n.featureFlags.USE_BUSINESS_WORDING)}var t=e("vendor/knockout"),n=e("constants/common"),r=e("services/serviceLocator");return{register:i}}),define("services/i18n/pluralizer",["require","swx-i18n","bindings/ko.businessAwareL10n","swx-i18n","vendor/knockout"],function(e){function s(){var e=this;e.init=function(e){var s,o=e.replace("-","_").toLowerCase(),u=r.pluralizationLocale[o];if(u)o=u;else{s=o.split("_");if(s.length===1)throw new Error("Unsupported language:"+e);o=s[0]}r.setLocale(o),t.init(i),n.register()}}var t=e("swx-i18n").knockoutBindingExtensions,n=e("bindings/ko.businessAwareL10n"),r=e("swx-i18n").plurals,i=e("vendor/knockout");return new s}),define("services/i18n/loader",["require","swx-utils-common","experience/settings","swx-i18n","services/i18n/pluralizer","services/i18n/cultureInfo","constants/common","services/i18n/swx/default"],function(e){function a(){function c(e){n.locale=n.locale||{},n.locale.i18n=e}var e=this,a="/",f="Strings.js",l="strings.js";e.load=function(e,n,h){function d(e){return new Promise(function(n,r){t.loadScript(e,n,r)})}function v(){return r.set(u),o.i18n.EMBEDDED_LOCALE}function m(){var t=s.getLocale(h),r=e+a+n+a+t+a+f;return d(r).then(function(){return h})}function g(){var t=e+a+n+a+h+a+l;return d(t).then(function(){return h})}var p=e+a+n+a+h+a+f;return Skype.WebExperience=Skype.WebExperience||{},Skype.WebExperience.setTranslations=function(e){r.merge(e)},i.init(h),d(p).then(function(){return h}).catch(g).catch(m).catch(v).then(c.bind(null))}}var t=e("swx-utils-common").loader,n=e("experience/settings"),r=e("swx-i18n").resources,i=e("services/i18n/pluralizer"),s=e("services/i18n/cultureInfo"),o=e("constants/common"),u=e("services/i18n/swx/default");return new a}),define("services/i18n/init",["require","swx-i18n","services/i18n/swx/default","services/i18n/pluralizer","constants/common","services/i18n/loader"],function(e){function a(){var e=this;e.init=function(e,t){var n,r=e.initParams.locale,i=e.initParams.variant;return t.lang||(t.lang=r),r===o&&i===u?(e.locale=e.locale||{},e.locale.i18n=r,Promise.resolve()):(n=e.appBaseUrl+"/resources/i18n",s.load(n,i,r))},t.set(n),r.init(o)}var t=e("swx-i18n").resources,n=e("services/i18n/swx/default"),r=e("services/i18n/pluralizer"),i=e("constants/common"),s=e("services/i18n/loader"),o=i.i18n.EMBEDDED_LOCALE,u="swx";return new a}),define("experience/featureFlags/api",[],function(){function e(e){var t=e.featureFlags?e.featureFlags:{};this.isFeatureOn=function(n){return Boolean(t[n])}}return e}),define("services/controls/controlsBuilder",["require","vendor/knockout","experience/settings","browser/dom","services/serviceLocator","constants/common","utils/common/accessibility","utils/common/applicationFocusManager","services/g11n/globalization"],function(e){function c(){function p(){t.virtualElements.allowedBindings.control=!0,t.bindingHandlers.control={init:function(e,n){var r=n(),i;r=t.unwrap(r),i=c[r.name],i.render(r.model,function(n){var r=e.parentNode,s=e.nextSibling;r.insertBefore(n,e),r.removeChild(e),r.removeChild(s),i.onDispose&&t.utils.domNodeDisposal.addDisposeCallback(n,i.onDispose.bind(i))})}}}function d(e){if(!b(e))throw'Invalid control. Make sure "name" and "render" attributes are present.';if(c[e.name])throw"The control you are trying to register (name: "+e.name+") has already been registered";c[e.name]=e}function v(e,t,n){c[e].render(n,function(e){g(t),m(e,t);var n=e.querySelectorAll("["+f+"]");for(var r=n.length-1;r>=0;r--){var i=n[r],s=i.getAttribute(f),o=w(i)||{};v(s,i,o)}})}function m(e,t){t.appendChild(e)}function g(e){var n;if(!e||!e.childNodes)return;n=e.childNodes;for(var r=n.length-1;r>=0;r--)y(n[r])||t.removeNode(n[r])}function y(e){for(var t=0;t<h.length;t++)if(h[t](e))return!0;return!1}function b(e){return e.name&&e.render&&typeof e.render=="function"}function w(e){var t;if(e.dataset)t=e.dataset[l];else if(e.attributes){var n=e.attributes["data-"+l];n&&(t=n.value)}if(!t)return{};try{return JSON.parse(t)}catch(r){return{}}}var e=this,c={},h=[];p(),this.registeredElements=[],this.build=function(t,f,l){var c=r.getElement(f),h=i.resolve(s.serviceLocator.FEATURE_FLAGS),p=h.isFeatureOn(s.featureFlags.SHOW_SPLASH_SCREEN),d;e.registeredElements.push({name:t,element:f}),t===n.controls.content.toLowerCase()&&p&&(d=i.resolve(s.serviceLocator.SPLASH_SCREEN),d.init(c.parentNode)),l=l||{},c.addClass(s.experience.RENDERER_CLASS),a.initLocaleDirection(c),o.initFocusRing(c),u.registerContainer(c),n.mode&&(l.mode=n.mode,c.addClass(n.mode)),v(t,c,l)},this.register=function(e){e instanceof Array?e.forEach(function(e){d(e)}):d(e)},this.get=function(e){if(!c[e])throw"Control not found";return c[e]},this.available=function(){return Object.keys(c)},this.registerNodePersistenceInspector=function(e){h.push(e)}}var t=e("vendor/knockout"),n=e("experience/settings"),r=e("browser/dom"),i=e("services/serviceLocator"),s=e("constants/common"),o=e("utils/common/accessibility"),u=e("utils/common/applicationFocusManager"),a=e("services/g11n/globalization"),f="data-control",l="model";return c}),define("services/navigation/navigationContext",["require","vendor/knockout"],function(e){function n(){this.currentPlaceName=t.observable(""),this.currentPlaceModel=t.observable(null),this.reset=function(){this.currentPlaceName(""),this.currentPlaceModel(null)}}var t=e("vendor/knockout");return n}),define("notifications/modelObservers/incomingCallObserver",["require","notifications/factory","swx-enums","constants/common","browser/window","notifications/common/notificationHub","browser/detect","ui/telemetry/telemetryClient","experience/settings"],function(e){function f(){function c(e){var t=y(e);t.audioStateChangeSubscription=e.selfParticipant.audio.state.changed(function(t,n,r){p(e,t,n,r)})}function h(e){l.sendEvent(a.telemetry.uiTenantToken,r.telemetry.calling.MASTER_EVENT,e)}function p(e,t,n,r){var i={newValue:t,oldValue:r};if(o.getBrowserInfo().isShellApp)return;if(w(i)&&!d()){h({name:"LocalUserOffline"}),e.audioService.reject();return}w(i)&&v(e),b(i)&&g(e)}function d(){return f.mePerson.status()===n.onlineStatus.Online}function v(e){E(e).then(function(e){m(e)||x(e)})}function m(e){return e&&e.active()}function g(e){var t=y(e),n=t.notification;n&&!n._keepActive&&(n.active(!1),t.notification=null)}function y(t){var n;for(var r=0;r<e.length;r++){n=e[r];if(n.conversation===t)return n}return n={conversation:t},e.push(n),n}function b(e){return e.oldValue!==undefined&&e.newValue===n.callConnectionState.Disconnected}function w(e){return e.newValue===n.callConnectionState.Notified}function E(e){var t=y(e);return t.notification&&t.notification.active()?Promise.resolve(t.notification):S(e).then(function(e){return t.notification=e,t.notification})}function S(e){var i,s=r.notifications.INCOMING_CALL,o=!1;return e.audioService.accept.enabled.get().then(function(u){var a=e.audioService.accept.enabled.reason;if(!u)switch(a){case n.callingNotSupportedReasons.PluginNotInstalled:s=r.notifications.INCOMING_CALL_WITH_NO_PLUGIN;break;case n.callingNotSupportedReasons.BrowserNotSupported:s=r.notifications.INCOMING_CALL_BROWSER_NOT_SUPPORTED,o=!0;break;case n.callingNotSupportedReasons.OSNotSupported:s=r.notifications.INCOMING_CALL_OS_NOT_SUPPORTED,o=!0;break;default:s=r.notifications.INCOMING_CALL_OS_NOT_SUPPORTED}return i=t.build(s,{conversation:e}),i._keepActive=o,i})}function x(e){function u(){e.active()&&(n.dispose(),e.decline())}var t,n,o=i.setTimeout(u,a.incomingCalls.notificationTimeout);n=e.active.subscribe(function(e){e||(clearTimeout(o),n.dispose())}),e.type===r.notifications.AUDIO?e.sender.uri()?s.notify(e):t=e.sender.uri.subscribe(function(n){n&&(s.notify(e),t.dispose())}):s.notify(e)}var e=[],f,l=u.get();this.observe=function(e){e.conversationsManager.conversations.added(c),f=e.personsAndGroupsManager}}var t=e("notifications/factory"),n=e("swx-enums"),r=e("constants/common"),i=e("browser/window"),s=e("notifications/common/notificationHub"),o=e("browser/detect"),u=e("ui/telemetry/telemetryClient"),a=e("experience/settings");return{build:function(){return new f}}}),define("notifications/modelObservers/unreadMessageObserver",["require","cafe/applicationInstance","constants/common","services/serviceLocator","swx-enums","notifications/factory","notifications/common/notificationHub","notifications/settings"],function(e){function a(){function c(e,r,s){function o(){return f?n.mentions.meIdentifier.test(r.html()):!1}function l(){return!e.chatService.shouldNotify||e.chatService.shouldNotify(r.text())||o()}function c(){var e=r.sender.id()===t.get().personsAndGroupsManager.mePerson.id();return s?!e:e}function h(){return r.isDeleted()}function p(){return r.sender.isBlocked()}function d(e){return/^sip:.+@anonymous\.invalid$/.test(e.id())}function v(){if(a)return!0;var e=t.get().personsAndGroupsManager.mePerson;return d(e)?!0:e.status()===i.onlineStatus.Online}return r.type()!==i.activityType.TextMessage?!1:!u.chatNotificationsMuted()&&!c()&&!p()&&!h()&&l()&&v()}function h(e){e.historyService.activityItems.added(function(t){p(e,t)}),l&&e.historyService._messagesWithUnseenHearts.added(function(t){d(e,t)})}function p(e,t){c(e,t)&&t.isRead.once(!1,function(){v(e,t)})}function d(e,t){var r,i={conversation:e,message:t,likeAdded:!0};if(!c(e,t,!0))return;r=s.build(n.notifications.UNREAD_MESSAGE,i),m(r)}function v(e,t){function u(){r.active(!1),o.dispose()}var r,i={conversation:e,message:t},o;r=s.build(n.notifications.UNREAD_MESSAGE,i),m(r),o=t.html.changed(function(){r.description(t.text())}),t.isDeleted.once(!0,u),t.isRead.once(!0,u)}function m(e){function n(){t.dispose()}var t;e.sender.uri()?o.notify(e):t=e.sender.uri.subscribe(function(t){t&&(o.notify(e),n())})}var e=r.resolve(n.serviceLocator.FEATURE_FLAGS),a=e.isFeatureOn(n.featureFlags.NOTIFY_HOST_EVEN_WHEN_ME_NOTAVAILABLE),f=e.isFeatureOn(n.featureFlags.ENABLE_AGGRESSIVE_MENTIONS_TOAST),l=e.isFeatureOn(n.featureFlags.HEARTS_ENABLED);this.observe=function(e){e.conversationsManager.conversations.added(h)}}var t=e("cafe/applicationInstance"),n=e("constants/common"),r=e("services/serviceLocator"),i=e("swx-enums"),s=e("notifications/factory"),o=e("notifications/common/notificationHub"),u=e("notifications/settings");return{build:function(){return new a}}}),define("notifications/modelObservers/contactRequestObserver",["require","constants/common","swx-enums","notifications/factory","notifications/common/notificationHub"],function(e){function s(){function e(e){e.historyService.activityItems.added(function(t){s(e,t)})}function s(e,t){t.type()===n.activityType.ContactRequestIncoming&&t.isRead.once(!1,function(){o(e,t)})}function o(e,n){var i,s={conversation:e,activityItem:n};i=r.build(t.notifications.CONTACT_REQUEST,s),u(i),n.isRead.once(!0,function(){i.active(!1)})}function u(e){function n(){t.dispose()}var t;e.sender.uri()?i.notify(e):t=e.sender.uri.subscribe(function(t){t&&(i.notify(e),n())})}this.observe=function(t){t.conversationsManager.conversations.added(e)}}var t=e("constants/common"),n=e("swx-enums"),r=e("notifications/factory"),i=e("notifications/common/notificationHub");return{build:function(){return new s}}}),define("notifications/modelObservers/chatRequestObserver",["require","notifications/factory","swx-enums","constants/common","notifications/settings","notifications/common/notificationHub"],function(e){function o(){function e(e){e.selfParticipant.chat.state.changed(function(t){u(e,t)})}function o(){return!i.chatNotificationsMuted()}function u(e,t){o()&&t===n.callConnectionState.Notified&&a(e)}function a(e){function o(){i&&i.dispose()}var n=t.build(r.notifications.CHAT,{conversation:e}),i;n.sender.uri()?s.notify(n):i=n.sender.uri.subscribe(function(e){e&&(s.notify(n),o())}),e.chatService.accept.enabled.once(!1,function(){e.isGroupConversation()&&e.meeting.state()==="Disconnected"?n.decline():n.active(!1)})}this.observe=function(t){t.conversationsManager.conversations.added(e)}}var t=e("notifications/factory"),n=e("swx-enums"),r=e("constants/common"),i=e("notifications/settings"),s=e("notifications/common/notificationHub");return{build:function(){return new o}}}),define("notifications/notificationObserversFactory",["require","exports","module","notifications/modelObservers/incomingCallObserver","notifications/modelObservers/unreadMessageObserver","notifications/modelObservers/contactRequestObserver","notifications/modelObservers/chatRequestObserver"],function(e,t){function o(){var e=[];return e.push(n.build()),e.push(r.build()),e.push(i.build()),e.push(s.build()),e}var n=e("notifications/modelObservers/incomingCallObserver"),r=e("notifications/modelObservers/unreadMessageObserver"),i=e("notifications/modelObservers/contactRequestObserver"),s=e("notifications/modelObservers/chatRequestObserver");t.getObservers=o}),define("ui/calling/telemetry/callSession",["require","exports","module","utils/calling/callingStack","constants/common","ui/modelHelpers/conversationHelper","swx-enums","swx-utils-common","swx-utils-common","experience/settings","ui/telemetry/telemetryClient"],function(e,t){function l(e,t){function w(e){function n(e){return e===s.mediaStreamState.Active}function r(e){return!n(e)}var t=u.build();return t.pause(),h.push(e.state.when(n,t.resume.bind(t))),h.push(e.state.when(r,t.pause.bind(t))),t}function E(){e.selfParticipant.video.channels(0)&&(n.outboundVideo=w(e.selfParticipant.video.channels(0).stream)),n.outboundScreenshare=w(e.selfParticipant.screenSharing.stream)}function S(){var t=e.participants.added(function(e){var t=w(e.video.channels(0).stream);n.inboundVideoCollection.push(t);var r=w(e.screenSharing.stream);n.inboundScreenshareCollection.push(r)});h.push(t)}function x(e){if(e.length===0)return"0";var t=e.map(function(e){return e.durationInSeconds()});return Math.max.apply(null,t).toString()}function T(e){return e?e.durationInSeconds().toString():"0"}function N(t){var n=r.telemetry.calling.NA;return e.isGroupConversation()&&e.conversationId&&(n=e.conversationId),{name:t,mediaConnectionType:b,callSessionId:d,isGroupCall:e.isGroupConversation(),conversation_id:n,call_leg_direction:A(),call_type:O(),conversation_members:e.participantsCount()+1,wasEscalated:c}}function C(e){p.sendEvent(a.telemetry.uiTenantToken,r.telemetry.calling.MASTER_EVENT,e)}function k(n){if(t)return n?s.callDisconnectionReason.Terminated:L(e.selfParticipant);var r=e.selfParticipant.audio.state.reason===s.callDisconnectionReason.OutOfBrowserCall,i=!e.isGroupConversation();return n?s.callDisconnectionReason.Terminated:r?s.callDisconnectionReason.OutOfBrowserCall:i?L(e.participants(0)):L(e.selfParticipant)}function L(e){return e&&e.audio.state.reason||s.callDisconnectionReason.Terminated}function A(){return t?r.telemetry.calling.direction.INCOMING:r.telemetry.calling.direction.OUTGOING}function O(){return e.isGroupConversation()?r.telemetry.calling.callType.S2S:i.isConversationWithPstn(e)?t?r.telemetry.calling.callType.SkypeIn:r.telemetry.calling.callType.SkypeOut:r.telemetry.calling.callType.S2S}function M(e){e!==s.mediaConnectionType.Unknown&&(b=e)}function _(){e.mediaConnectionType&&h.push(e.mediaConnectionType.changed(M))}function D(){h.forEach(function(e){e.dispose&&e.dispose()})}var n={callStarted:u.build(),callDuration:null,outboundVideo:null,outboundScreenshare:null,inboundVideoCollection:[],inboundScreenshareCollection:[]},l={NotStarted:0,Started:1,Ringing:2,Connected:3,Ended:4},c=!1,h=[],p=f.get(),d=o.create(),v,m,g,y=l.NotStarted,b=s.mediaConnectionType.Unknown;this.isChildOf=function(t){return e===t},this.start=function(){if(y>=l.Started)return;g=(new Date).getTime(),y=l.Started,_(),e.selfParticipant.audio.state.reason===s.callDisconnectionReason.CallEscalated&&(c=!0);var t=N(r.telemetry.calling.START_CALL);t.audioAvailability=e.audioService.start.enabled.reason||r.telemetry.calling.AVAILABLE,C(t)},this.setRinging=function(){if(y===l.Ringing)return;if(y===l.Connected)return;y=l.Ringing;var e=N(r.telemetry.calling.RINGING_CALL);m=T(n.callStarted),C(e)},this.setConnected=function(){if(y===l.Connected)return;if(y===l.NotStarted)return;if(y===l.Ended)return;E(),S(),y=l.Connected,n.callDuration=u.build(),v=T(n.callStarted),C(N(r.telemetry.calling.CONNECTED_CALL))},this.end=function(){var t,s,o,u=r.telemetry.calling.UNAVAILABLE;if(y===l.NotStarted){D();return}if(y===l.Ended){D();return}e.audioService.callId&&e.audioService.callId()&&(u=e.audioService.callId()),t=y===l.Connected,s=t||y===l.Ringing,y=l.Ended,o=N(r.telemetry.calling.END_CALL),o.wasConnected=t,o.timeToCancelCall=t?"0":T(n.callStarted),o.timeToConnect=t?v:"0",o.wasAtLeastOnceParticipantOnline=i.isAtLeastOnceParticipantOnline(e),o.timeToRing=m||"0",o.call_id=u,o.call_end_reason=k(t),o.start_timestamp=g||"undefined",o.end_timestamp=(new Date).getTime(),o.call_leg_duration_sec=T(n.callDuration),o.call_leg_successful=s,o.inbound_video_duration_sec=x(n.inboundVideoCollection),o.outbound_video_duration_sec=T(n.outboundVideo),o.screenshare_duration_sec=T(n.outboundScreenshare),o.screenshare_inbound_duration_sec=x(n.inboundScreenshareCollection),C(o),D()}}function c(){var e=function(){};this.start=e,this.setRinging=e,this.setConnected=e,this.end=e,this.escalate=e}function h(e){return e.selfParticipant.audio.state.reason===s.callDisconnectionReason.OutOfBrowserCall}function p(e,t,r){return!n.get().isInBrowserCallingSupported()||h(e)?new c:new l(e,t,r)}var n=e("utils/calling/callingStack"),r=e("constants/common"),i=e("ui/modelHelpers/conversationHelper"),s=e("swx-enums"),o=e("swx-utils-common").guid,u=e("swx-utils-common").stopwatch,a=e("experience/settings"),f=e("ui/telemetry/telemetryClient");t.buildOutgoingCallSession=function(e){return p(e,!1)},t.buildIncomingCallSession=function(e){return p(e,!0)}}),define("telemetry/calling/pstn/creditBalanceTracker",["require","exports","module","cafe/applicationInstance","ui/modelHelpers/conversationHelper","telemetry/calling/pstn/pstn","browser/detect"],function(e,t){function o(){function u(){var e=(new Date).getTime();if(o){var t=e-o;i.updatingCreditBalance(t/1e3),o=null}}var e=this,t,o;e.init=function(){var e=n.get().personsAndGroupsManager.mePerson.account;e&&e.displayBalance&&e.displayBalance.changed(u)},e.callConnected=function(e){!s.getBrowserInfo().isShellApp&&r.isConversationWithPstn(e)&&(t=!0)},e.callEnded=function(e){t===!0&&r.isConversationWithPstn(e)&&(o=(new Date).getTime(),t=!1)}}var n=e("cafe/applicationInstance"),r=e("ui/modelHelpers/conversationHelper"),i=e("telemetry/calling/pstn/pstn"),s=e("browser/detect");t.build=function(){return new o}}),define("ui/modelObservers/calling/callStateObserver",["require","exports","module","services/pubSub/pubSub","vendor/knockout","swx-enums","constants/common","ui/calling/telemetry/callSession","utils/calling/callingStack","notifications/factory","notifications/common/notificationHub","ui/viewModels/calling/helpers/conversationTracker","telemetry/calling/pstn/creditBalanceTracker","services/cqf/CQFHandler"],function(e,t){function p(){function v(t){var r=E(t);r.audioHandler=function(n,r,o){if(r===i.callDisconnectionReason.MissingSpeaker){var u=a.build(s.notifications.DEVICE_MISSING_SPEAKER);f.notify(u)}o&&(g(t,n),y(t,n)),r===i.callDisconnectionReason.OutOfBrowserCall&&l.addP2PConversation(t),n===i.callConnectionState.Disconnected&&(l.init(),e.activeCalls.remove(t))},r.videoHandler=function(e){y(t,e)},r.participantsSubs=[],r.participantAddedHandler=function(n){var s=n.audio.state.when(i.callConnectionState.Ringing,g.bind(null,t,i.callConnectionState.Ringing)),o=n.screenSharing.state.when(i.callConnectionState.Notified,b.bind(null,t,n));s.participant=n,o.participant=n,r.participantsSubs.push(s,o)},r.participantRemovedHandler=function(t){r.participantsSubs=r.participantsSubs.filter(function(e){return e.participant===t?(e.dispose(),!1):!0})},r.getCallSession=function(n){return r.callSession?r.callSession:(n===i.callConnectionState.Notified||t.activeModalities.audio()?r.callSession=m(t,!0):r.callSession=m(t,!1),r.callSession)},r.clearCallSession=function(){delete r.callSession},r.spawnedConversationStateChanged=function(t){t&&n.publish(s.events.navigation.OPEN_CONVERSATION,{model:t,origin:s.telemetry.historyLoadOrigin.CALLING})},t.participants.added(r.participantAddedHandler),t.participants.removed(r.participantRemovedHandler),t.selfParticipant.audio.state.changed(r.audioHandler),t.selfParticipant.video.state.changed(r.videoHandler),t.spawnedConversation&&t.spawnedConversation.changed(r.spawnedConversationStateChanged)}function m(e,t){return t?o.buildIncomingCallSession(e):o.buildOutgoingCallSession(e)}function g(e,t){var n=E(e),r=n.getCallSession(t);switch(t){case i.callConnectionState.Notified:r.start(),r.setRinging();break;case i.callConnectionState.Connecting:r.start(),h.observe(e);break;case i.callConnectionState.Connected:r.setConnected(),d.callConnected(e);break;case i.callConnectionState.Ringing:r.setRinging();break;case i.callConnectionState.Disconnected:r.end(),n.clearCallSession(),d.callEnded(e),h.updateCallData(e)}}function y(t,r){if(r!==i.callConnectionState.Connecting)return;u.get().isInBrowserCallingSupported()&&n.publish(s.events.navigation.OPEN_CONVERSATION,{model:t,origin:s.telemetry.historyLoadOrigin.CALLING}),e.activeCalls.indexOf(t)===-1&&e.activeCalls.push(t)}function b(e,t){e.screenSharingService.sharer(t),e.screenSharingService.accept.enabled()&&e.screenSharingService.accept()}function w(t){var n=E(t);n&&(n.conversation.selfParticipant.audio.state.changed.off(n.audioHandler),n.conversation.selfParticipant.video.state.changed.off(n.videoHandler),n.conversation.participants.added.off(n.participantAddedHandler),n.conversation.participants.removed.off(n.participantRemovedHandler),n.participantsSubs.forEach(function(e){e.dispose()}),n.participantsSubs.length=0,e.activeCalls.remove(t))}function E(e){var t;for(var n=0;n<p.length;n++){t=p[n];if(t.conversation===e)return t}return t={conversation:e},p.push(t),t}var e=this,t,p=[],d=c.build();e.activeCalls=r.observableArray(),e.observe=function(e){t=e.conversationsManager.conversations,t.added(v),t.removed(w),d.init()}}var n=e("services/pubSub/pubSub"),r=e("vendor/knockout"),i=e("swx-enums"),s=e("constants/common"),o=e("ui/calling/telemetry/callSession"),u=e("utils/calling/callingStack"),a=e("notifications/factory"),f=e("notifications/common/notificationHub"),l=e("ui/viewModels/calling/helpers/conversationTracker"),c=e("telemetry/calling/pstn/creditBalanceTracker"),h=e("services/cqf/CQFHandler");t.build=function(){return new p}}),define("ui/modelObservers/modelObserver",["require","exports","module","notifications/notificationObserversFactory","ui/modelObservers/calling/callStateObserver"],function(e,t){function i(){function t(){var t=[];return n.getObservers().forEach(function(e){t.push(e)}),t.push(e.conversationsCallStateObserver),t}var e=this;e.conversationsCallStateObserver=r.build(),e.observe=function(e){t().forEach(function(t){t.observe(e)})}}var n=e("notifications/notificationObserversFactory"),r=e("ui/modelObservers/calling/callStateObserver");t.build=function(){return new i}}),define("services/pes/mruService",["require","lodash-compat","constants/common","services/serviceLocator","utils/common/builderMixin"],function(e){function s(){var e=this;e.addItemsToMru=function(e){t.isArray(e)||(e=[e]);var i=r.resolve(n.serviceLocator.PES_CONFIG_SERVICE);t.forEach(e,function(e){i.addItemToMru(e.id)})}}var t=e("lodash-compat"),n=e("constants/common"),r=e("services/serviceLocator"),i=e("utils/common/builderMixin");return t.extend(s,i),s}),define("services/pes.v2/mruService",["require","lodash-compat","constants/common","utils/common/cache/instance","utils/common/builderMixin","services/pes/constants","services/serviceLocator"],function(e){function f(e,n){var r=5;return o.itemTypes[n]&&t.isNumber(o.itemTypes[n].mruLimit)&&(r=o.itemTypes[n].mruLimit),t.take(e,r)}function l(e,n){t.forEach(e,function(e){var r,i,s;i=e.id,s=e.type,n.configuration[s]=n.configuration[s]||[],r=t.findIndex(n.configuration[s],function(e){return e===i}),r>=0&&n.configuration[s].splice(r,1),n.configuration[s].unshift(i),n.configuration[s]=f(n.configuration[s],s)})}function c(e){e.registeredEvents.hasOwnProperty(r.personalExpression.CONFIG_INITIALIZED)&&t.forEach(e.registeredEvents[r.personalExpression.CONFIG_INITIALIZED],function(t){t(e.getMRUItems())})}function h(){return i.get().getItem(a)}function p(){return h().then(function(e){return e&&e.mruItems&&t.isObject(e.mruItems)&&!t.isArray(e.mruItems)&&e.version===o.SAVED_DATA_VERSION?e.mruItems:{}})}function d(e){return i.get().setItem(a,{mruItems:e,version:o.SAVED_DATA_VERSION},0)}function v(){var e=this,t;this.configuration={},this.registeredEvents={},p().then(function(t){var n=e.getMRUItems();e.configuration=t,l(n,e),c(e)}),u.resolve(n.serviceLocator.FEATURE_FLAGS).isFeatureOn(n.featureFlags.PES_V2_ENABLED)&&(t=u.resolve(n.serviceLocator.PES_MRU_SERVICE),t.addItemsToMru=this.addItemsToMru.bind(this))}var t=e("lodash-compat"),n=e("constants/common"),r=n.events,i=e("utils/common/cache/instance"),s=e("utils/common/builderMixin"),o=e("services/pes/constants"),u=e("services/serviceLocator"),a="pes2";return v.prototype.addItemsToMru=function(e){var n=this;return e?(t.isArray(e)||(e=[e]),e.length===0?Promise.resolve():(l(e,n),c(n),d(this.configuration))):Promise.resolve()},v.prototype.getMRUItems=function(){return t(this.configuration).map(function(e,n){return t.map(e,function(e){return{id:e,type:n}})}).flatten().value()},v.prototype.on=function(n,r){if(!n||!r)return;return this.registeredEvents.hasOwnProperty(n)||(this.registeredEvents[n]=[]),t.any(this.registeredEvents[n],function(e){return e===r})||this.registeredEvents[n].push(r),{cancel:this.off.bind(this,n,r)}},v.prototype.off=function(n,r){return this.registeredEvents.hasOwnProperty(n)?t.first(t.remove(this.registeredEvents[n],function(e){return e===r})):null},t.extend(v,s),v}),define("services/pes.v2/bingSearch/bingSearchService",["require","lodash-compat","utils/common/builderMixin","reqwest","utils/common/cancelation","utils/common/url","experience/settings"],function(e){function u(e,t,n){this.apiKey=e,this.authMethod=t,this.serviceUrl=n}var t=e("lodash-compat"),n=e("utils/common/builderMixin"),r=e("reqwest"),i=e("utils/common/cancelation"),s=e("utils/common/url"),o=e("experience/settings");return u.prototype.search=function(n,u){var a,f;return u=t.defaults({},u,{authMethod:this.authMethod,apiKey:this.apiKey,serviceUrl:this.serviceUrl},{authMethod:o.pesSearchServices.bingAuthMethod,apiKey:o.pesSearchServices.bingApiKey,serviceUrl:o.pesSearchServices.bingServiceURL},{fetch:20}),n?(a={headers:{Authorization:u.authMethod+" "+u.apiKey},url:s.buildUrl(u.serviceUrl,{Query:"'"+n+"'",$top:u.fetch}),dataType:"json",crossOrigin:!0},f=i.adaptAbortable(r.compat(a)),i.makeCancelable(f,u.cancelationToken).then(function(e){return e.d.results.map(function(e){return{id:e.ID,url:e.MediaUrl,contentType:e.ContentType,thumbnail:e.Thumbnail.MediaUrl,title:e.Title,width:e.Width,height:e.Height}})})):Promise.resolve()},t.extend(u,n),u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-giphy-service/lib/giphy",["require","exports","lodash-compat","swx-utils-common","reqwest"],e)}(function(e,t){function f(e,t){var n=r.cancelation.adaptAbortable(i.compat(e));return r.cancelation.makeCancelable(n,t)}function c(e){return new l(e)}var n=e("lodash-compat"),r=e("swx-utils-common"),i=e("reqwest"),s={endpoint:"v1/gifs/search",rating:"g",limit:20,offset:0},o={endpoint:"v1/gifs/translate",rating:"g"},u={endpoint:"v1/gifs/random",rating:"g"},a={endpoint:"v1/gifs/trending",rating:"g",limit:20},l=function(){function e(e){this.options=e}return e.prototype.search=function(e,t){if(!e)return Promise.resolve();t=n.defaults({},t,this.options,s);var i={url:r.url.buildUrl(t.serviceUrl,t.endpoint,{api_key:t.apiKey,rating:t.rating,limit:t.limit,offset:t.offset,q:e}),method:"get",dataType:"json",crossOrigin:!0};return f(i,t.cancelationToken)},e.prototype.translate=function(e,t){if(!e)return Promise.resolve();t=n.defaults({},t,this.options,o);var i={url:r.url.buildUrl(t.serviceUrl,t.endpoint,{api_key:t.apiKey,rating:t.rating,s:e}),method:"get",dataType:"json",crossOrigin:!0};return f(i,t.cancelationToken)},e.prototype.random=function(e,t){t=n.defaults({},t,this.options,u);var i={url:r.url.buildUrl(t.serviceUrl,t.endpoint,e?{api_key:t.apiKey,rating:t.rating,tag:e}:{api_key:t.apiKey,rating:t.rating}),method:"get",dataType:"json",crossOrigin:!0};return f(i,t.cancelationToken)},e.prototype.trending=function(e){e=n.defaults({},e,this.options,a);var t={url:r.url.buildUrl(e.serviceUrl,e.endpoint,{api_key:e.apiKey,rating:e.rating,limit:e.limit}),method:"get",dataType:"json",crossOrigin:!0};return f(t,e.cancelationToken)},e}();t.build=c}),define("swx-giphy-service",["swx-giphy-service/lib/giphy"],function(e){return e}),define("services/pes/config",["require","lodash-compat","utils/common/cache/instance","constants/common","constants/common","swx-i18n","services/pes/constants","utils/chat/pesUtils","services/pubSub/pubSub","services/serviceLocator","experience/settings","utils/common/builderMixin"],function(e){function p(){function h(e,t){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}function p(){return{itemsRoot:"",emoticonsRoot:"",packsRoot:"",items:[],packs:[],tabs:[]}}function d(){return{id:u.mru.TAB_ID,type:u.itemTypes.tab.id,title:o.fetch({key:u.itemTypes.tab.titleLocKey}),ariaLabel:o.fetch({key:u.itemTypes.tab.ariaLabelLocKey}),thumbnailUrl:(c.appBaseUrl||"#")+"/assets/images/components/chat/pes/tab_mru.png",showHiddenItems:!0,packs:[]}}function v(e){return{ariaLabel:o.fetch({key:u.itemTypes[e].ariaLabelLocKey}),title:o.fetch({key:u.itemTypes[e].titleLocKey}),id:b(e),isHidden:!1,items:[]}}function m(){return[v(u.itemTypes.emoticon.id),v(u.itemTypes.moji.id)]}function g(e,t){var n=(t||"#")+"/"+e.id+"/views/thumbnail",r=l.resolve(i.serviceLocator.FEATURE_FLAGS);return r.isFeatureOn(i.featureFlags.PES_CDN_AUTH_ENABLED)&&(n=a.rewriteUrls(n,c.pesCDNAuthentication.rewriteRules)),{id:e.id,type:u.itemTypes.tab.id,title:e.title,thumbnailUrl:n,packs:[e]}}function y(e,t){return n.find(e,function(e){return e.id===t})}function b(e){return u.mru.PACK_PREFIX+e}function w(e){return(e.title||"").indexOf(u.FEATURED_IN_PREFIX)===0}function E(e,t){return e.items.slice(0,u.itemTypes[t].mruLimit)}function S(){return r.get().getSensitiveItem(t)}function x(e){return S().then(function(t){var n=e.tabs[0].packs;t&&t.mruItems&&t.mruItems.forEach(function(t){var r=y(e.items,t);if(r){var i=y(n,b(r.type));i&&i.items.push(r)}})})}function T(e,t){var r=[d()];return e&&(e.forEach(function(e){w(e)||(e.parentTab=g(e,t),r.push(e.parentTab))}),e.forEach(function(e){if(w(e)){var i=e.title.replace(u.FEATURED_IN_PREFIX,"");e.isFeatured=!0;var s=n.find(r,function(e){return e.title===i});s?(e.title=o.fetch({key:"pes_featured_title"}),e.isHidden=!1,e.parentTab=s,s.packs.splice(0,0,e)):e.isHidden===!1&&(e.title=i,e.parentTab=g(e,t),r.push(e.parentTab))}})),r}function N(e){e.packs.forEach(function(t){var n=[];t.items.forEach(function(t){n.push(y(e.items,t))}),t.items=n})}function C(e){var i=n.flatten(e.tabs[0].packs.map(function(e){return e.items.map(function(e){return e.id})}));return r.get().setSensitiveItem(t,{mruItems:i,version:u.SAVED_DATA_VERSION},0)}function k(e){e.tabs.forEach(function(t){var n=[];t.sections.forEach(function(t){var r=y(e.packs,t.pack);r.isHidden=!1,n.push(r)}),t.packs=n,t.type=u.itemTypes.tab.id,t.thumbnailUrl=g(t,e.tabsRoot).thumbnailUrl})}var e;this.addItemToMru=function(t){var n=y(e.items,t);if(!n)return Promise.resolve();var r=y(e.packs,b(n.type));if(r){var i=r.items.indexOf(n);return i>=0?r.items.splice(0,0,r.items.splice(i,1)[0]):r.items.splice(0,0,n),r.items=E(r,n.type),C(e)}return Promise.resolve()},this.getConfiguration=function(){return e},this.init=function(t){e=p(),h(t,e),N(e),t.tabs?(k(e),e.tabs.unshift(d())):e.tabs=T(e.packs,e.packsRoot);var n=y(e.tabs,u.mru.TAB_ID);return n.packs=m(),e.packs=e.packs.concat(n.packs),f.publish(s.personalExpression.CONFIG_INITIALIZED,e),x(e)},e=p(),e.tabs.push(d()),e.packs=e.tabs[0].packs=m()}var t="pes",n=e("lodash-compat"),r=e("utils/common/cache/instance"),i=e("constants/common"),s=e("constants/common").events,o=e("swx-i18n").localization,u=e("services/pes/constants"),a=e("utils/chat/pesUtils"),f=e("services/pubSub/pubSub"),l=e("services/serviceLocator"),c=e("experience/settings"),h=e("utils/common/builderMixin");return n.extend(p,h),p}),define("services/pes.v2/config",["require","lodash-compat","constants/common","swx-i18n","services/pes/constants","utils/chat/pesUtils","services/serviceLocator","utils/common/builderMixin","experience/settings"],function(e){function l(){function c(){return{itemsRoot:"",emoticonsRoot:"",packsRoot:"",items:[],packs:[],tabs:[]}}function h(e){a.hasOwnProperty(r.personalExpression.CONFIG_INITIALIZED)&&t.forEach(a[r.personalExpression.CONFIG_INITIALIZED],function(t){t(e)})}function p(e,t){var r=(t||"#")+"/"+e.id+"/views/thumbnail",i=u.resolve(n.serviceLocator.FEATURE_FLAGS);return i.isFeatureOn(n.featureFlags.PES_CDN_AUTH_ENABLED)&&(r=o.rewriteUrls(r,f.pesCDNAuthentication.rewriteRules)),{id:e.id,type:s.itemTypes.tab.id,title:e.title,thumbnailUrl:r,packs:[e]}}function d(e,n){return t.find(e,{id:n})}function v(e){return(e.title||"").indexOf(s.FEATURED_IN_PREFIX)===0}function m(e,n){var r=[];return e&&(e.forEach(function(e){if(!v(e)){var t=p(e,n);r.push(t)}}),e.forEach(function(e){if(v(e)){var o=e.title.replace(s.FEATURED_IN_PREFIX,""),u=t.find(r,{title:o});u?(e.title=i.fetch({key:"pes_featured_title"}),e.isHidden=!1,u.packs.splice(0,0,e)):e.isHidden===!1&&(e.title=o,u=p(e,n),r.push(u))}})),r}function g(e){e.packs.forEach(function(t){var n=[];t.items.forEach(function(t){n.push(d(e.items,t))}),t.items=n})}function y(e){e.tabs.forEach(function(t){var n=[];t.sections.forEach(function(t){var r=d(e.packs,t.pack);r&&r.items&&r.items.length&&n.push(r)}),t.packs=n,t.type=s.itemTypes.tab.id,t.thumbnailUrl=p(t,e.tabsRoot).thumbnailUrl})}var e,a={},l;this.getConfiguration=function(){return e},this.init=function(n){return e=c(),t.assign(e,n),g(e),n.tabs?y(e):e.tabs=m(e.packs,e.packsRoot),h(e),e},this.cdnTokenUpdated=function(t){if(e._cdnToken===t)return;e._cdnToken=t,e._requiresCDNUrlAuthentication&&h(e)},this.on=function(n,r){if(!n||!r)return;return a.hasOwnProperty(n)||(a[n]=[]),t.any(a[n],function(e){return e===r})||a[n].push(r),{cancel:this.off.bind(this,n,r)}},this.off=function(n,r){return a.hasOwnProperty(n)?t.first(t.remove(a[n],function(e){return e===r})):null},e=c(),u.resolve(n.serviceLocator.FEATURE_FLAGS).isFeatureOn(n.featureFlags.PES_V2_ENABLED)&&(l=u.resolve(n.serviceLocator.PES_CONFIG_SERVICE),l.getConfiguration=this.getConfiguration.bind(this))}var t=e("lodash-compat"),n=e("constants/common"),r=n.events,i=e("swx-i18n").localization,s=e("services/pes/constants"),o=e("utils/chat/pesUtils"),u=e("services/serviceLocator"),a=e("utils/common/builderMixin"),f=e("experience/settings");return t.assign(l,a),l}),define("text!views/experience/splashScreen.html",[],function(){return'<!-- ko if: isVisible -->\r\n<div class="swx shellSplashScreen themeBlue" id="swxSplashScreen">\r\n    <div class="shellSplashLogoContainer" data-bind="if: showLogo">\r\n        <div class="shellSplashLogo shellSplashLogoSkype" data-bind="if: !useBusinessWording">\r\n            <span class="iconfont logoSkypeLarge"></span>\r\n        </div>\r\n        <div class="shellSplashLogo shellSplashLogoSkypeForBusiness" data-bind="if: useBusinessWording">\r\n            <span class="iconfont iconSkypeForBusinessLarge"></span>\r\n            <p class="logoText" data-bind="l10n: { \'key\': \'splashScreen_text_logo_4b\' }"></p>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="shellSplashPage">\r\n        <!-- ko if: showLoader -->\r\n        <div class="shellSpinnerContainer">\r\n            <div class="swx-spinner white">\r\n                <div class="circle one">\r\n                    <div class="rotate">\r\n                        <div class="position">\r\n                            <div class="scale">\r\n                                <div class="shape"></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="circle two">\r\n                    <div class="rotate">\r\n                        <div class="position">\r\n                            <div class="scale">\r\n                                <div class="shape"></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="circle three">\r\n                    <div class="rotate">\r\n                        <div class="position">\r\n                            <div class="scale">\r\n                                <div class="shape"></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="circle four">\r\n                    <div class="rotate">\r\n                        <div class="position">\r\n                            <div class="scale">\r\n                                <div class="shape"></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="fontSize-h4" aria-live="polite" data-bind="html: loadingText"></div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: showSignIn -->\r\n        <div class="shellSplashContent">\r\n            <h1 class="fontSize-h2" aria-live="polite" data-bind="html: signInTitle"></h1>\r\n            <p class="fontSize-h4" aria-live="polite" data-bind="html: signInDescription"></p>\r\n            <a class="btn" href="#" data-bind="click: signIn, visible: isSignInEnabled">\r\n                <span data-bind="l10n: { \'key\': \'splashScreen_signIn_button\' }"></span>\r\n            </a>\r\n            <!-- ko if: isSignInExternalEnabled() -->\r\n            <a class="btn" href="#" data-bind="click: signInExternal">\r\n                <span data-bind="l10n: { \'key\': \'splashScreen_signInExternal_button\' }"></span>\r\n            </a>\r\n            <!-- /ko -->\r\n            <!-- ko if: isSignInNotificationEnabled() -->\r\n            <a class="btn" href="#" data-bind="click: notifySignIn">\r\n                <span data-bind="text: getSignInButtonText()"></span>\r\n            </a>\r\n            <!-- /ko -->\r\n            <a class="fontSize-h4" target="_blank" data-bind="attr: {href: learnMoreUrl}, text: signInLearnMoreText, visible: isLearnMoreLinkVisible"></a>\r\n            <!-- ko if: isFeedbackEnabled() -->\r\n            <a class="btn" data-bind="attr: { href: feedbackPageUrl(), target: feedbackPageTarget()}">\r\n                <span data-bind="l10n: { \'key\': \'giveFeedback_button_label\' }"></span>\r\n            </a>\r\n            <!-- /ko -->\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n</div>\r\n<!-- /ko -->\r\n'}),define("telemetry/chat/splashScreenEvent",["require","exports","module","usertiming","experience/settings","constants/common","telemetry/chat/telemetryEnumerator","ui/telemetry/telemetryClient","utils/chat/dateTime"],function(e,t){function c(){function p(){var e=l,t=f.EXPERIENCE.SPLASH_TIME,r=n.getEntriesByName(a.EXPERIENCE.CONTENT_INIT);if(r.length>0){n.measure(t,a.EXPERIENCE.CONTENT_INIT,a.TIMELINE.SYNC_END_OK);var i=n.getEntriesByName(t);i&&i.length>0&&(e=i[0].duration)}else{n.measure(t,a.EXPERIENCE.CONTENT_INIT,a.TIMELINE.SYNC_END_ERROR);var s=n.getEntriesByName(t);s&&s.length>0&&(e=s[0].duration)}return e}function d(){var e=l,t=n.getEntriesByName(f.TIMELINE.TTL),r=n.getEntriesByName(f.TIMELINE.TTL);return t&&t.length>0?e=t[0].duration:r&&r.length>0&&(e=r[0].duration),e}var e=this,t=i.telemetry.splashScreenEvent.TYPE,c,h={isSignInEnabled:l,isLearnMoreLinkVisible:l,timeToSplash:l,timeToSplashGroup:l};e.startSplashScreenMeasure=function(e,t){c=u.getDate(),h.isSignInEnabled=typeof e=="undefined"?l:e,h.isLearnMoreLinkVisible=typeof t=="undefined"?l:t},e.publish=function(){c&&(h.timeToSplash=u.getDate()-c,h.timeToSplashGroup=s.getSecondsDurationGroupFromMs(h.timeToSplash)),h.timeToContent=p(),h.timeToContentGroup=s.getSecondsDurationGroupFromMs(h.timeToContent),h.timelineTTL=d(),h.timelineTTLGroup=s.getSecondsDurationGroupFromMs(h.timelineTTL),o.get().sendEvent(r.telemetry.uiTenantToken,t,h)}}var n=e("usertiming"),r=e("experience/settings"),i=e("constants/common"),s=e("telemetry/chat/telemetryEnumerator"),o=e("ui/telemetry/telemetryClient"),u=e("utils/chat/dateTime"),a=i.telemetry.performanceMarks,f=i.telemetry.measurements,l=i.telemetry.NOT_AVAILABLE;t.build=function(){return new c}}),define("utils/common/signInNotificationHandler",["require","exports","module","constants/common","experience/settings","ui/telemetry/actions/actionNames","browser/window","browser/document","notifications/common/notification","services/serviceLocator","notifications/common/notificationHub"],function(e,t){function l(e,t,n){function l(){var e=r.loginPopup,t=e.redirectUrl+"?origin="+o.location.origin;return e.loginUrl+"?response_type=token"+"&client_id="+s.encodeURIComponent(e.clientId)+"&redirect_uri="+s.encodeURIComponent(t)+"&resource="+s.encodeURIComponent(e.resourceUrl)}function c(e,t){e=e||r.loginPopup.defaultWidth,t=t||r.loginPopup.defaultHeight;var n=s.screenLeft!==undefined?s.screenLeft:screen.left,i=s.screenTop!==undefined?s.screenTop:screen.top,u=s.innerWidth?s.innerWidth:o.documentElement.clientWidth?o.documentElement.clientWidth:screen.width,a=s.innerHeight?s.innerHeight:o.documentElement.clientHeight?o.documentElement.clientHeight:screen.height,f=u/2-e/2+n,l=a/2-t/2+i;return"scrollbars=1,status=0,menubar=0,toolbar=0,resizable=1,width="+e+",height="+t+",left="+f+",top="+l}function p(){var e=s.open(u.url,u.name,u.props);if(!e){e=s.open(u.url,u.name);if(!e)throw new Error("Creating external sign in page has failed")}return e}var u=this,a=null,f=null;u.url=e||l(),u.name=t||"O365_ExternalSignInWindow",u.props=n||c(),u.open=function(e){if(!e)throw new Error('"callback" parameter is required');if(f===null||f.closed||!f.focus)try{f=p()}catch(t){return}else f.focus();h(i.externalSignIn.openSignInWindow),a&&s.clearInterval(a),a=s.setInterval(function(){f.closed&&(e(),s.clearInterval(a),a=null)},100)}}function c(){function c(){return r.initParams&&!!r.initParams.resigninAllowed}var e=this,t=r.splashScreen.signInNotificationEnabled,s=new u(n.notifications.SIGN_IN_REQUEST),o=new l,a=!1;e.isEnabled=function(){return t&&c()},e.setSignInPopup=function(e){a=e},e.notify=function(){function t(e){h(e),f.notify(s)}if(!e.isEnabled())return;if(a)try{o.open(t.bind(null,i.externalSignIn.signInRequestAfterTokenRefresh))}catch(n){}else t(i.externalSignIn.signInRequest)}}function h(e){var t=a.resolve(n.serviceLocator.ACTION_TELEMETRY);t.recordAction(e)}var n=e("constants/common"),r=e("experience/settings"),i=e("ui/telemetry/actions/actionNames"),s=e("browser/window"),o=e("browser/document"),u=e("notifications/common/notification"),a=e("services/serviceLocator"),f=e("notifications/common/notificationHub");t.build=function(){return new c}}),define("ui/viewModels/experience/splashScreen",["require","vendor/knockout","cafe/applicationInstance","utils/common/accessibility","services/serviceLocator","constants/common","swx-enums","ui/telemetry/actions/actionNames","text!views/experience/splashScreen.html","experience/api/authentication","experience/authContext","experience/settings","browser/detect","browser/window","browser/document","lodash-compat","swx-i18n","telemetry/chat/splashScreenEvent","utils/common/feedback","utils/common/signInNotificationHandler"],function(e){function w(){function L(){var n=document.createElement("div");n.id="splashScreenElement",n.innerHTML=a,t.applyBindings(e,n),S&&S.appendChild(n)}function A(){e.showLoader(!1),e.showSignIn(!1),C.publish()}function O(t){var n=v.assign({text:m.fetch({key:"splashScreen_text_loading"})},t);e.showSignIn(!1),e.showLoader(!0),r.updateAriaLiveHtml(e.loadingText,n.text)}function M(t){var n=l.get().implicitSignIn||l.get().implicitSignOut,i=v.assign({title:n?"":J("splashScreen_signedOut_title"),description:"",showButton:!1,isSignInExternalEnabled:!1,isSignInPopupEnabled:!1,showLearnMore:!1,isFeedbackEnabled:!1},t);e.showLoader(!1),e.showSignIn(!0),e.signInTitle(""),e.signInDescription(""),i.title&&r.updateAriaLiveHtml(e.signInTitle,i.title),i.description&&r.updateAriaLiveHtml(e.signInDescription,i.description),e.isSignInEnabled(i.showButton),e.isSignInExternalEnabled(i.isSignInExternalEnabled),e.isLearnMoreLinkVisible(i.showLearnMore),e.isFeedbackEnabled(i.isFeedbackEnabled),k.setSignInPopup(i.isSignInPopupEnabled),e.isSignInNotificationEnabled(k.isEnabled())}function D(){M(),C.startSplashScreenMeasure(e.showSignIn(),e.isLearnMoreLinkVisible());var t=n.get().signInManager.state;t.when(o.loginState.SigningIn,function(){O({text:J("splashScreen_text_signingIn")})}),t.when(o.loginState.SigningOut,j),t.when(o.loginState.SignedOut,F)}function P(){var e=h.getBrowserInfo();return e.isIeEngine||e.isEdge}function H(e){var t={title:J("splashScreen_signInFailed_title"),description:J("splashScreen_signInFailed_description"),isFeedbackEnabled:w.isFeatureOn(s.featureFlags.HAS_FEEDBACK_LINK_ON_ERROR)};if(R(e))return;U(e)&&(t.title=m.fetch({key:"splashScreen_signInFailed_description_age_restriction"}),t.description="",t.isFeedbackEnabled=!1),T&&(t.description=m.fetch({key:"skypeUnavailable_title"}),t.isFeedbackEnabled=!1),z(e)&&(t.description=m.fetch({key:"splashScreen_signInFailed_description_exceeded_endpoints"}),t.isFeedbackEnabled=!1),W(e)&&(t.title=m.fetch({key:"splashScreen_signInFailed_title_security_validation"}),t.description="",t.isSignInExternalEnabled=!0,t.isFeedbackEnabled=!1),X(e)&&(t.description=m.fetch({key:"splashScreen_signInFailed_aad_description"}),t.isFeedbackEnabled=!1,t.isSignInPopupEnabled=!0),t.showLearnMore=!!c.splashScreen.learnMoreUrl&&!!P(),M(t)}function B(e){T=!1,M(e),E.publish(s.apiUIEvents.SWX_ON_SIGN_OUT)}function j(){B({showButton:w.isFeatureOn(s.featureFlags.RE_AUTH_ENABLED)&&!k.isEnabled()})}function F(e,t){if(!t||t!==o.loginState.SignedIn)return;B({title:m.fetch({key:"splashScreen_disconnected_title"}),description:J("splashScreen_disconnected_description")})}function I(){if(!N){E.subscribe(s.apiUIEvents.SWX_TIMELINE_LOADED,A);return}E.subscribe(s.apiUIEvents.SWX_SINGLE_CONVERSATION,function(n){if(!n){e.showLoader(!1),e.showSignIn(!1);return}M({title:J("splashScreen_signInFailed_title"),description:J("splashScreen_signInFailed_description")})})}function q(){E.subscribe(s.events.system.EXPERIENCE_READY,D),E.subscribe(s.events.auth.SIGNIN_FAILED,H),I()}function R(e){try{return e.message===s.api.auth.errorTypes.SIGN_IN_CANCELED_ERROR&&JSON.parse(e.details.reason).code===s.api.auth.errorTypes.SIGNED_OUT_ERROR}catch(t){}}function U(e){var t=new RegExp(s.api.auth.errorTypes.AGE_RESTRICTION_ERROR+"$"),n="error_description";if(e&&e[n])return t.test(e[n])}function z(e){return e&&e.name===s.api.auth.errorTypes.TOO_MANY_CONNECTIONS_ERROR}function W(e){return e&&e.message===s.silentLogin.errorMessages.INVALID_GRANT}function X(e){var t;if(e&&e.message===s.api.auth.errorTypes.LOGIN_REQUIRED_ERROR)return!0;try{return t=JSON.parse(e.details.reason),t.code===s.api.auth.errorTypes.OAUTH_FAILED_ERROR&&t.error===s.api.auth.errorTypes.LOGIN_REQUIRED_ERROR}catch(n){}}function V(){var e=c.webLoginClientId,t=c.appBaseUrl+"/assets/externalSignInHandler.html?origin="+d.location.origin,n="999";return c.webLoginUrl+"?client_id="+p.encodeURIComponent(e)+"&redirect_uri="+p.encodeURIComponent(t)+"&partner="+p.encodeURIComponent(n)}function $(e){var t=i.resolve(s.serviceLocator.ACTION_TELEMETRY);t.recordAction(e)}function J(e){return m.fetch({key:N?e+"_wac":e})}var e=this,w=i.resolve(s.serviceLocator.FEATURE_FLAGS),E=i.resolve(s.serviceLocator.PUBSUB),S,x="swx-container",T=!1,N=w.isFeatureOn(s.featureFlags.SINGLE_CONVERSATION_MODE),C=g.build(),k=b.build();this.showLoader=t.observable(!1),this.showSignIn=t.observable(!1),this.isVisible=t.computed(function(){return e.showLoader()||e.showSignIn()}),this.isSignInEnabled=t.observable(!1),this.isSignInExternalEnabled=t.observable(!1),this.isSignInNotificationEnabled=t.observable(!1),this.isLearnMoreLinkVisible=t.observable(!1),this.isFeedbackEnabled=t.observable(!1),this.useBusinessWording=w.isFeatureOn(s.featureFlags.USE_BUSINESS_WORDING),this.showLogo=!N,this.loadingText=t.observable(""),this.signInTitle=t.observable(""),this.signInDescription=t.observable(""),this.signInLearnMoreText=m.fetch({key:"splashScreen_learn_more"}),this.learnMoreUrl=c.splashScreen.learnMoreUrl,this.signIn=function(e){f.signIn(A,H,e),T=!0},this.signInExternal=function(){var t,n,r=V();$(u.externalSignIn.signIn),t=p.open(r),n=p.setInterval(function(){t.closed&&(e.signIn({isExternalSignIn:!0}),p.clearInterval(n))},100)},this.notifySignIn=k.notify,this.getSignInButtonText=J.bind(null,"splashScreen_signIn_button"),this.feedbackPageUrl=t.pureComputed(function(){return y.getFeedbackPageUrl()}),this.feedbackPageTarget=function(){return y.getFeedbackPageTarget()},this.init=function(n){if(!n)return;S=n,S.classList.add(x);var r=document.getElementById("splashScreenElement");r&&t.removeNode(r),L(),!e.showLoader()&&!e.showSignIn()&&O(),T=!1,E.publish(s.apiUIEvents.SWX_SPLASHSCREEN_LOADED)},q()}var t=e("vendor/knockout"),n=e("cafe/applicationInstance"),r=e("utils/common/accessibility"),i=e("services/serviceLocator"),s=e("constants/common"),o=e("swx-enums"),u=e("ui/telemetry/actions/actionNames"),a=e("text!views/experience/splashScreen.html"),f=e("experience/api/authentication"),l=e("experience/authContext"),c=e("experience/settings"),h=e("browser/detect"),p=e("browser/window"),d=e("browser/document"),v=e("lodash-compat"),m=e("swx-i18n").localization,g=e("telemetry/chat/splashScreenEvent"),y=e("utils/common/feedback"),b=e("utils/common/signInNotificationHandler");return w}),define("services/subscriptions/subscriptionProvider",["require","lodash-compat","vendor/knockout","cafe/applicationInstance"],function(e){function i(){function i(){function n(){e.persons.observable(t.persons())}var t=r.get().personsAndGroupsManager.all;e.persons.observable.extend({rateLimit:{timeout:50,method:"notifyWhenChangesStop"}}),t.persons.subscribe(),t.persons.changed(n)}var e={persons:{observable:n.observableArray(),initialize:t.once(i)}};this.getPersonsObservable=function(){return e.persons.initialize(),e.persons.observable}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("cafe/applicationInstance");return i}),define("services/pes.v2/bingSearch/urlPreviewService",["require","lodash-compat","utils/common/builderMixin","reqwest","cafe/applicationInstance","experience/settings","utils/common/url","constants/common","utils/common/cancelation","services/serviceLocator"],function(e){function l(e,t,n){this.defaultServiceHost=e,this.defaultServceEndpoint=t,this.defaultTokenProvider=n}function c(e,t,n){var i;if(!e||!n)return Promise.resolve();i={url:o.buildUrl(t.serviceHost+t.serviceEndpoint,{url:e}),method:"GET",crossOrigin:!0,dataType:"json",headers:{Authorization:"skype_token "+n}};var s=a.adaptAbortable(r.compat(i));return a.makeCancelable(s,t.cancelationToken)}var t=e("lodash-compat"),n=e("utils/common/builderMixin"),r=e("reqwest"),i=e("cafe/applicationInstance"),s=e("experience/settings"),o=e("utils/common/url"),u=e("constants/common"),a=e("utils/common/cancelation"),f=e("services/serviceLocator");return l.prototype.getPreviewFor=function(n,r){var o=f.resolve(u.serviceLocator.FEATURE_FLAGS),a=o.isFeatureOn(u.featureFlags.NEW_URLP_DOMAIN_ENABLED)?s.urlPServiceHost:s.amdServiceHost;return r=t.defaults({},r,{serviceHost:this.defaultServiceHost,tokenProvider:this.defaultTokenProvider,serviceEndpoint:this.defaultServceEndpoint},{tokenProvider:function(){return i.get().signInManager._skypeToken&&i.get().signInManager._skypeToken()},serviceHost:a,serviceEndpoint:"/v1/url/info"}),r.skypeToken?c(n,r,r.skypeToken):Promise.resolve(r.tokenProvider()).then(c.bind(null,n,r))},t.extend(l,n),l}),define("services/store/pes/storeService",["require","lodash-compat","services/store/pes/catalogItemProcessor","experience/settings","jSkype/client","utils/common/builderMixin","services/pes.v2/configSync","reqwest"],function(e){function l(e){var n={dataType:"json",crossOrigin:!0};return e&&t.extend(n,e),n}function c(){return o.get().signInManager._skypeToken()}function h(){}var t=e("lodash-compat"),n=e("services/store/pes/catalogItemProcessor"),r=e("experience/settings"),i=r.pesStoreServices,s=r.entitlementService,o=e("jSkype/client"),u=e("utils/common/builderMixin"),a=e("services/pes.v2/configSync"),f=e("reqwest");return h.prototype.loadCatalog=function(){var t=l({url:"https://"+i.catalogApiHost+i.catalogServiceEndpoint.replace("${lang}",r.locale.pes),headers:{Accept:"application/json; ver="+i.catalogServiceVersion}});return i.catalogDogfoodContentEnabled&&(t.headers["X-Skype-Config-Namespace"]="showNonDiscoverable"),Promise.resolve(f.compat(t)).then(function(e){var t=e.skus;return n.processSKUs(t),t}).catch(function(){return[]})},h.prototype.getItems=function(t){var r;return t?(r=l({url:t}),Promise.resolve(f.compat(r)).then(function(e){return n.processTabConfig(e),n.loadStyles(e,a.latestToken,a._requiresCDNUrlAuthentication),e}).catch(function(){return null})):Promise.reject("No valid config url Specified")},h.prototype.getItemsForTabs=function(t){var n=this;return Promise.resolve(n.loadCatalog()).then(function(e){return t.forEach(function(t){var r,i;for(r=0;r<e.length;r++){i=e[r];if(i.id===t.id){t.pesConfig=n.getItems(i.items);break}}}),t})},h.prototype.getTabsFromEntitlement=function(){var e=o.get().personsAndGroupsManager.mePerson,t;return t=l({url:s.host+s.listingEndpoint.substring(1).replace("${username}",e.id())}),Promise.resolve(c()).catch(function(){return null}).then(function(e){return e?(t.headers={"X-Skypetoken":e,Accept:"application/json; ver=3.0"},f.compat(t)):Promise.reject("Invalid Skype token")}).catch(function(){}).then(function(e){var t=[];return e&&(t=e.reduce(function(e,t){var n,r;return t.service==="sticker"&&t.attributes&&t.attributes.pack&&(n=t.attributes.pack,r=(new Date(t.start)).getTime(),e.push({id:n,purchaseDateTime:r})),e.sort(function(e,t){return e.purchaseDateTime-t.purchaseDateTime})},t)),t})},h.prototype.downloadPurchasedTabsFromEntitlement=function(){var t=this;return Promise.resolve(t.getTabsFromEntitlement()).then(function(e){return t.getItemsForTabs(e)}).then(function(e){var t=[];return e.forEach(function(e){e.pesConfig&&t.push(e)}),t})},h.prototype.buyTab=function(t){var n,r;return t?(r=t.__metadata.links.apiPurchase,n=l({url:r.hrefFull,type:"post",data:r.data}),Promise.resolve(c()).catch(function(){return null}).then(function(e){return e?(n.headers={"X-Skypetoken":e,Accept:"application/json; ver="+i.catalogPurchaseApiVersion},f.compat(n)):Promise.reject("Invalid Skype token")}).catch(function(){return null}).then(function(e){return e?"success":Promise.reject("error purchasing tab")})):Promise.reject("Not a valid tab")},t.extend(h,u),h}),define("experience/serviceLocatorInitializer",["require","exports","module","swx-service-locator","constants/common","experience/featureFlags/api","services/controls/controlsBuilder","services/navigation/navigationContext","ui/modelObservers/modelObserver","services/pes/mruService","experience/settings","services/pes.v2/mruService","services/pes.v2/bingSearch/bingSearchService","swx-giphy-service","services/pes/config","services/pes.v2/config","services/pubSub/pubSub","services/serviceLocator","ui/viewModels/experience/splashScreen","services/subscriptions/subscriptionProvider","utils/people/progressiveTimeout","services/pes.v2/bingSearch/urlPreviewService","ui/telemetry/actions/actionTelemetryApi","services/store/pes/storeService"],function(e,t){var n=e("swx-service-locator"),r=e("constants/common"),i=e("experience/featureFlags/api"),s=e("services/controls/controlsBuilder"),o=e("services/navigation/navigationContext"),u=e("ui/modelObservers/modelObserver"),a=e("services/pes/mruService"),f=e("experience/settings"),l=e("services/pes.v2/mruService"),c=e("services/pes.v2/bingSearch/bingSearchService"),h=e("swx-giphy-service"),p=e("services/pes/config"),d=e("services/pes.v2/config"),v=e("services/pubSub/pubSub"),m=e("services/serviceLocator"),g=e("ui/viewModels/experience/splashScreen"),y=e("services/subscriptions/subscriptionProvider"),b=e("utils/people/progressiveTimeout").classFunction,w=e("services/pes.v2/bingSearch/urlPreviewService"),E=e("ui/telemetry/actions/actionTelemetryApi"),S=e("services/store/pes/storeService");t.registerDependencies=function(e){var t=e&&e.settings||f,x=r.serviceLocator;return n.serviceLocatorBuilder().withService({name:x.PUBSUB,build:function(){return v}}).withService({name:x.FEATURE_FLAGS,build:function(){return new i(t)}}).buildSync(m),n.serviceLocatorBuilder().withService({name:x.CONTROLS_BUILDER,build:function(){return new s}}).withService({name:x.NAVIGATION_CONTEXT,build:function(){return new o}}).withService({name:x.MODEL_UI_OBSERVER,build:function(){return u.build()}}).withService({name:x.SUBSCRIPTION_PROVIDER,build:function(){return new y}}).withService({name:x.ACTION_TELEMETRY,build:function(){return E.build()}}).withService({name:x.PROGRESSIVE_TIMEOUT,build:function(){return new b}}).withService({name:x.PES_MRU_SERVICE,build:function(){return a.build()}}).withService({name:x.PES_CONFIG_SERVICE,build:function(){return p.build()}}).withService({name:x.PES_BING_SEARCH_SERVICE,build:function(){return c.build()}}).withService({name:x.PES_GIPHY_SEARCH_SERVICE,build:function(){return h.build(t.pesSearchServices.giphy)}}).withService({name:x.URL_PREVIEW_SERVICE,build:function(){return w.build()}}).buildSync(m),n.serviceLocatorBuilder().withService({name:x.PES_2_MRU_SERVICE,build:function(){return l.build()}}).withService({name:x.PES_2_CONFIG_SERVICE,build:function(){return d.build()}}).withService({name:x.PES_STORE_SERVICE,build:function(){return S.build()}}).buildSync(m),n.serviceLocatorBuilder().withService({name:x.SPLASH_SCREEN,build:function(){return new g}}).buildSync(m),m}}),define("utils/common/applicationReactivationManager",["require","exports","module","cafe/applicationInstance","constants/common","browser/document","browser/window","browser/dom"],function(e,t){function f(){n.get().suspended(!1),u=null}function l(){return n.get().suspended()}function c(){s.addEventListener(r.events.browser.FOCUS,p),s.addEventListener(r.events.browser.BLUR,d),i.addEventListener(r.events.browser.VISIBILITYCHANGE,p)}function h(){s.removeEventListener(r.events.browser.FOCUS,p),s.removeEventListener(r.events.browser.BLUR,d),i.removeEventListener(r.events.browser.VISIBILITYCHANGE,p)}function p(){!o.isDocumentHidden()&&l()?u||(u=s.setTimeout(f,a)):d()}function d(){u&&(s.clearTimeout(u),u=null)}var n=e("cafe/applicationInstance"),r=e("constants/common"),i=e("browser/document"),s=e("browser/window"),o=e("browser/dom"),u,a=3e3;t.init=function(){n.get().suspended.when(!0,c),n.get().suspended.when(!1,h)}}),define("utils/common/activityReportManager",["require","exports","module","cafe/applicationInstance","constants/common","browser/document","browser/window","browser/dom"],function(e,t){function l(){n.get().personsAndGroupsManager.mePerson.active(!0),u=null}function c(){n.get().personsAndGroupsManager.mePerson.active(!1),a=null}function h(){return n.get().personsAndGroupsManager.mePerson.active()}function p(){s.addEventListener(r.events.browser.FOCUS,v),s.addEventListener(r.events.browser.BLUR,m),i.addEventListener(r.events.browser.VISIBILITYCHANGE,v)}function d(){s.removeEventListener(r.events.browser.FOCUS,v),s.removeEventListener(r.events.browser.BLUR,m),i.removeEventListener(r.events.browser.VISIBILITYCHANGE,v)}function v(){!o.isDocumentHidden()&&!h()?u||(u=s.setTimeout(l,f)):m()}function m(){u&&(s.clearTimeout(u),u=null)}function g(){s.addEventListener(r.events.browser.FOCUS,E),s.addEventListener(r.events.browser.BLUR,w),i.addEventListener(r.events.browser.VISIBILITYCHANGE,b)}function y(){s.removeEventListener(r.events.browser.FOCUS,E),s.removeEventListener(r.events.browser.BLUR,w),i.removeEventListener(r.events.browser.VISIBILITYCHANGE,b)}function b(){o.isDocumentHidden()&&h()?a||(a=s.setTimeout(c,f)):E()}function w(){h()&&(a||(a=s.setTimeout(c,f)))}function E(){a&&(s.clearTimeout(a),a=null)}function S(){p(),y()}function x(){d(),g()}var n=e("cafe/applicationInstance"),r=e("constants/common"),i=e("browser/document"),s=e("browser/window"),o=e("browser/dom"),u,a,f=3e3;t.init=function(){var e=n.get().personsAndGroupsManager.mePerson.active;e.when(!0,x),e.when(!1,S)}}),define("telemetry/usage/inAppActivityTracker",["require","exports","module","swx-enums","constants/common","browser/document","experience/settings","utils/common/localStorage","ui/telemetry/telemetryClient","browser/window"],function(e,t){function p(){var e=i.getElementsByClassName(r.experience.RENDERER_CLASS);for(var t=e.length-1;t>=0;--t)if(e[t].getBoundingClientRect().width!==0)return!0;return!1}function d(){var e=o.get(f.APP_FOCUSED_TIME_KEY),t=o.get(f.APP_CLOSED_TIME_KEY),n=o.get(f.SIGNED_IN_TIME_KEY);n&&t?v(parseInt(n,10),parseInt(t,10),f.APP_EXIT_POINT_REASON.APP_CLOSED,f.APP_ENTRY_POINT_REASON.APP_OPENED):e&&t&&v(parseInt(e,10),parseInt(t,10),f.APP_EXIT_POINT_REASON.APP_CLOSED,f.APP_ENTRY_POINT_REASON.APP_FOREGROUNDED),o.remove(f.APP_FOCUSED_TIME_KEY),o.remove(f.APP_CLOSED_TIME_KEY),o.remove(f.SIGNED_IN_TIME_KEY)}function v(e,t,n,i){var o=(t-e)/1e3,a=r.telemetry.inappActivity.KPI_INAPP_ACTIVITY_END,f={Entry_Point:i,Exit_Point:n,Foreground_Start_Time:e.toString(),Foregrounded_Duration:o.toString()};if(o<=0)return;u.get().sendEvent(s.telemetry.uiTenantToken,a,f)}function m(e,t){var n=r.telemetry.inappActivity.KPI_INAPP_ACTIVITY_START,i={Entry_Point:t,Foreground_Start_Time:e.toString()};u.get().sendEvent(s.telemetry.uiTenantToken,n,i)}function g(){o.set(f.APP_CLOSED_TIME_KEY,(new Date).getTime())}function y(){c||(c=setInterval(g,f.INTERVAL_30_SECONDS))}function b(){c&&(c=clearInterval(c))}function w(){p()?l||E():(o.remove(f.APP_FOCUSED_TIME_KEY),b())}function E(){if(!h)return;var e=(new Date).getTime();o.set(f.APP_FOCUSED_TIME_KEY,e),m(e,f.APP_ENTRY_POINT_REASON.APP_FOREGROUNDED),y(),l=!0}function S(){if(!h)return;var e=o.get(f.APP_FOCUSED_TIME_KEY),t=o.get(f.SIGNED_IN_TIME_KEY),n=(new Date).getTime();t?(v(parseInt(t,10),n,f.APP_EXIT_POINT_REASON.APP_BACKGROUNDED,f.APP_ENTRY_POINT_REASON.APP_OPENED),o.remove(f.SIGNED_IN_TIME_KEY)):e&&(v(parseInt(e,10),n,f.APP_EXIT_POINT_REASON.APP_BACKGROUNDED,f.APP_ENTRY_POINT_REASON.APP_FOREGROUNDED),o.remove(f.APP_FOCUSED_TIME_KEY)),b(),l=!1}function x(){setTimeout(function(){var e=p()&&i.hasFocus();e&&!l?E():!e&&l&&S()},f.TIMEOUT_1_SECOND)}function T(e){if(e===n.loginState.SignedIn){h=!0;if(p()&&i.hasFocus()){var t=(new Date).getTime();o.set(f.SIGNED_IN_TIME_KEY,t),m(t,f.APP_ENTRY_POINT_REASON.APP_OPENED),y(),l=!0}}}var n=e("swx-enums"),r=e("constants/common"),i=e("browser/document"),s=e("experience/settings"),o=e("utils/common/localStorage"),u=e("ui/telemetry/telemetryClient"),a=e("browser/window"),f={APP_FOCUSED_TIME_KEY:"swx|AppFocusedTimeMs",APP_CLOSED_TIME_KEY:"swx|appClosedTimeMs",SIGNED_IN_TIME_KEY:"swx|SingedInTimeMs",APP_ENTRY_POINT_REASON:{APP_OPENED:"Opened",APP_FOREGROUNDED:"Foregrounded"},APP_EXIT_POINT_REASON:{APP_CLOSED:"Closed",APP_BACKGROUNDED:"Backgrounded"},TIMEOUT_1_SECOND:1e3,INTERVAL_30_SECONDS:3e4},l,c,h;t.init=function(e){h=!1,l=!1,d(),e.state.changed(T),a.addEventListener(r.events.browser.FOCUS,w),a.addEventListener(r.events.browser.BLUR,S),a.addEventListener(r.events.browser.CLICK,x),a.addEventListener(r.events.browser.BEFOREUNLOAD,function(){o.set(f.APP_CLOSED_TIME_KEY,(new Date).getTime());return})},t.inappActivityConstants=f}),define("ui/telemetry/identityTelemetry",["require","exports","module","browser/window","swx-enums","cafe/applicationInstance"],function(e,t){function o(e){e.setCommonProperty("user_id",u,s.Identity),e.setCommonProperty("signed_in",a)}function u(){var e="ANONYMOUS";if(i.get().signInManager.state()===r.loginState.SignedIn)try{e=i.get().personsAndGroupsManager.mePerson.id()}catch(t){}return e}function a(){var e=0;try{e=i.get().signInManager.state()===r.loginState.SignedIn?1:0}catch(t){}return e}var n=e("browser/window"),r=e("swx-enums"),i=e("cafe/applicationInstance"),s;t.addIdentityToAllEvents=function(e){s=s||n.skypeTelemetryManager.PIIType,o(e)}}),define("telemetry/errors/runtimeErrorsHandler",["require","exports","module","browser/window","vendor/knockout","constants/common","experience/settings","services/serviceLocator","ui/telemetry/telemetryClient"],function(e,t){function a(e){f(e)&&h(e)}function f(e){var t=e.stack||e.error&&e.error.stack;return(l(e.filename)||l(t))&&!c(e.message)}function l(e){return e&&e.indexOf(s.packageUrl)>=0}function c(e){return e&&e.indexOf(t.DEFAULT_SCRIPT_ERROR_MESSAGE)>=0}function h(e){var t=i.telemetry.runtimeErrors.TYPE,n={message:e.message==null?i.NOT_AVAILABLE:e.message,fileName:e.filename||i.NOT_AVAILABLE,lineNumber:e.lineno||e.error&&e.error.lineNumber||i.NOT_AVAILABLE,columnNumber:e.colno||e.error&&e.error.columnNumber||i.NOT_AVAILABLE,stack:e.stack||e.error&&e.error.stack||i.NOT_AVAILABLE};u.get().sendEvent(s.telemetry.uiTenantToken,t,n)}var n=e("browser/window"),r=e("vendor/knockout"),i=e("constants/common"),s=e("experience/settings"),o=e("services/serviceLocator"),u=e("ui/telemetry/telemetryClient");t.DEFAULT_SCRIPT_ERROR_MESSAGE="Script error",t.init=function(){var e=o.resolve(i.serviceLocator.FEATURE_FLAGS);e.isFeatureOn(i.featureFlags.TELEMETRY_RUNTIME_ERRORS_ENABLED)&&(n.addEventListener("error",a),r.onError=a)}}),define("experience/experience",["require","exports","module","helpers/polyfills","lodash-compat","usertiming","browser/detect","browser/window","constants/common","swx-enums","cafe/applicationInstance","jCafe","experience/api/builder","experience/componentsLoader","experience/settings","experience/telemetryFactory","experience/koBindingsRegistrar","notifications/init","utils/calling/callingStack","services/calling/autoCalling","services/g11n/init","services/i18n/init","services/pes.v2/configSync","services/serviceLocator","experience/serviceLocatorInitializer","utils/common/appVisibilityProvider","utils/common/applicationFocusManager","utils/common/applicationReactivationManager","utils/common/activityReportManager","utils/common/elementQueryHelper","swx-utils-common","swx-utils-common","utils/common/prefetcher","swx-utils-common","telemetry/usage/inAppActivityTracker","ui/telemetry/identityTelemetry","ui/telemetry/telemetryClient","ui/viewModels/calling/helpers/conversationTracker","telemetry/errors/runtimeErrorsHandler","ui/modalDialog/welcomeDialog","utils/common/styleModeHelper"],function(e,t){function q(){var e=h.platformId,t=R(),n=h.biAppName;h.uiVersion=e+"/"+t+"//"+n,h.displayAppVersion&&!F.get().isIntegratedProperty()&&(document.title="Skype "+t)}function R(){try{var e=h.version.split(".");return e.length<4?e[0]+"."+e[1]+".0."+e[2]:h.version}catch(t){return"0.0.0.0"}}function U(e,t){var n=E.resolve(o.serviceLocator.PUBSUB);n.publish(o.events.system.EXPERIENCE_INITIALIZED,{configLoadDuration:e.configLoadDuration,packageLoadDuration:e.packageLoadDuration,experienceInitializeDuration:t.duration()}),r.mark(I.EXPERIENCE.TTL_START)}function z(){var e=P.get(),t;D.addIdentityToAllEvents(e),t=f.Application.create({settings:h,telemetryManager:e}),a.set(t)}function W(){var e={};return e.serviceLocatorInitializer=S.registerDependencies({settings:h}),e.initApplication=z(),e.overrideSettings=Q(),e.runtimeErrorsHandler=B.init(),e.instrumentTelemetryEvents=K(),e.loadCss=et(),e.initCallingStack=$(),e.initAutoCalling=J(),e.prefetcher=O.prefetchAssets(),e.appVisibilityProvider=x.init(),e.inAppActivityTracker=_.init(a.get().signInManager),e.appReactivationManager=N.init(),e.activityReportManager=C.init(),e.elementQueryHelper=k.initialiseSelectors(),e.notifications=v.init(),e.conversationTracker=H.init(),e.welcomeDialog=j.init(),e.subscribeVisibilityProvider=it(),e.loadYoutubePlayerAPI=Z(),e.initTranslatorService=G(),e.initUserPreferences=Y(),e}function X(e){n.merge(h,e.config),n.merge(h.initParams,e.initParams),["locale","variant"].forEach(function(e){h.initParams[e]=h.initParams[e].toLowerCase()}),h.sessionId=L.create(),V()}function V(){var e=i.getBrowserInfo();e.isShellApp&&(h.mode=undefined,h.featureFlags.showSplashScreen=!1,h.isPollingEnabled=!1)}function $(){m.init(h)}function J(){g.init()}function K(){var e=p.build();e.init("experience"),e.init("people")}function Q(){var e=i.getBrowserInfo(),t=E.resolve(o.serviceLocator.FEATURE_FLAGS);if(t.isFeatureOn(o.featureFlags.URL_OVERRIDE_ENABLED)){var n=e.getUrlParams();n.locale&&(h.initParams.locale=n.locale.toLowerCase()),n.variant&&(h.initParams.variant=n.variant.toLowerCase())}}function G(){var e=a.get().translatorService;return e?(new Promise(function(e){a.get().signInManager.state.once(u.loginState.SignedIn,e)})).then(function(){return e.supportedLanguages.get()}):Promise.resolve()}function Y(){var e,t;return e=new Promise(function(e){function t(){n.unsubscribe(o.apiUIEvents.SWX_TIMELINE_LOADED,t),e()}var n=E.resolve(o.serviceLocator.PUBSUB);n.subscribe(o.apiUIEvents.SWX_TIMELINE_LOADED,t)}),t=new Promise(function(e){a.get().signInManager.state.once(u.loginState.SignedIn,e)}),Promise.all([e,t]).then(function(){var e=a.get().personsAndGroupsManager.mePerson.preferences(),t=n.map(e,function(e){return e.value.get()});return Promise.all(t)})}function Z(){var e=E.resolve(o.serviceLocator.FEATURE_FLAGS);(e.isFeatureOn(o.featureFlags.YOUTUBE_PLAYER_ENABLED)||e.isFeatureOn(o.featureFlags.URL_PREVIEW_LOAD_YOUTUBE_PLAYER))&&A.loadScript(h.youtubeApiUrl)}function et(){var e=h.assetsBaseUrl,t=h.appBaseUrl;A.loadStyle(e+"/css/common.css"),A.loadStyle(t+"/css/swx.css")}function tt(){var e=i.getBrowserInfo(),t=E.resolve(o.serviceLocator.FEATURE_FLAGS);return t.isFeatureOn(o.featureFlags.FAIL_INITIALIZATION_FOR_IE_AND_EDGE)&&(e.isEdge||e.isIeEngine)}function nt(){rt(),a.get()._standbyMode&&a.get()._standbyMode(!1)}function rt(){T.focusTrackingEnabled=!0}function it(){var e=E.resolve(o.serviceLocator.PUBSUB);e.subscribe(o.apiUIEvents.SWX_TIMELINE_LOADED,nt)}e("helpers/polyfills");var n=e("lodash-compat"),r=e("usertiming"),i=e("browser/detect"),s=e("browser/window"),o=e("constants/common"),u=e("swx-enums"),a=e("cafe/applicationInstance"),f=e("jCafe"),l=e("experience/api/builder"),c=e("experience/componentsLoader"),h=e("experience/settings"),p=e("experience/telemetryFactory"),d=e("experience/koBindingsRegistrar"),v=e("notifications/init"),m=e("utils/calling/callingStack"),g=e("services/calling/autoCalling"),y=e("services/g11n/init"),b=e("services/i18n/init"),w=e("services/pes.v2/configSync"),E=e("services/serviceLocator"),S=e("experience/serviceLocatorInitializer"),x=e("utils/common/appVisibilityProvider"),T=e("utils/common/applicationFocusManager"),N=e("utils/common/applicationReactivationManager"),C=e("utils/common/activityReportManager"),k=e("utils/common/elementQueryHelper"),L=e("swx-utils-common").guid,A=e("swx-utils-common").loader,O=e("utils/common/prefetcher"),M=e("swx-utils-common").stopwatch,_=e("telemetry/usage/inAppActivityTracker"),D=e("ui/telemetry/identityTelemetry"),P=e("ui/telemetry/telemetryClient"),H=e("ui/viewModels/calling/helpers/conversationTracker"),B=e("telemetry/errors/runtimeErrorsHandler"),j=e("ui/modalDialog/welcomeDialog"),F=e("utils/common/styleModeHelper"),I=o.telemetry.performanceMarks;s._perfRefForUserTimingPolyfill=s.performance,t.init=function(t,n,r){function f(){U(t,i)}function p(){n(l.get())}function v(){var e=E.resolve(o.serviceLocator.PUBSUB);e.publish(o.events.system.EXPERIENCE_READY),a.get().signInManager.state.once(u.loginState.SignedIn,function(){w.init()})}var i=M.build(),s;return X(t),q(),s=W(),tt()?(r("Failing initialize for IE and Edge enabled"),s.everything=Promise.reject(),s):(s.i18nInit=Promise.all([y.init(h),b.init(h,document.documentElement)]),s.componentsLoaderInit=s.i18nInit.then(function(){return Promise.all([c.init()])}),s.componentsReady=s.componentsLoaderInit.then(f),s.apiReady=s.componentsReady.then(p),s.experienceReady=s.apiReady.then(v),s.everything=s.experienceReady.catch(function(e){return r(e),Promise.reject(e)}),d.registerBindings(),s)},s.Skype&&s.Skype.onExperienceLoaded&&s.Skype.onExperienceLoaded(t)}),define("fullExperience",function(){}),require(["experience/experience"])})()